<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Build: Arms Dealer Init.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="classes.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir_3179ea33d55a76dc38212d9eab798728.html">export</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_e5664b4b56927c8728eb3192fa60e338.html">hdc2</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_1eb12a41a47efb9efcd82fa98f4f4dbd.html">FTP</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_80cc1f21a78ab7941088ea567f236150.html">ja2src</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_994ab287602efefceafe55287a3657d6.html">Build</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_43ed33c8f48e75fecb0508860a16371c.html">Tactical</a></div>
<h1>Arms Dealer Init.cpp</h1><a href="Arms_01Dealer_01Init_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#ifdef PRECOMPILEDHEADERS</span>
<a name="l00002"></a>00002 <span class="preprocessor"></span><span class="preprocessor">      #include "<a class="code" href="Tactical_01All_8h.html">Tactical All.h</a>"</span>
<a name="l00003"></a>00003 <span class="preprocessor">#else</span>
<a name="l00004"></a>00004 <span class="preprocessor"></span><span class="preprocessor">      #include "<a class="code" href="Types_8h.html">Types.h</a>"</span>
<a name="l00005"></a>00005 <span class="preprocessor">      #include "stdlib.h"</span>
<a name="l00006"></a>00006 <span class="preprocessor">      #include "<a class="code" href="Arms_01Dealer_01Init_8h.html">Arms Dealer Init.h</a>"</span>
<a name="l00007"></a>00007 <span class="preprocessor">      #include "String.h"</span>
<a name="l00008"></a>00008 <span class="preprocessor">      #include "Debug.h"</span>
<a name="l00009"></a>00009 <span class="preprocessor">      #include "Random.h"</span>
<a name="l00010"></a>00010 <span class="preprocessor">      #include "<a class="code" href="Weapons_8h.html">Weapons.h</a>"</span>
<a name="l00011"></a>00011 <span class="preprocessor">      #include "<a class="code" href="FileMan_8h.html">FileMan.h</a>"</span>
<a name="l00012"></a>00012 <span class="preprocessor">      #include "<a class="code" href="Game_01Clock_8h.html">Game Clock.h</a>"</span>
<a name="l00013"></a>00013 <span class="preprocessor">      #include "<a class="code" href="ArmsDealerInvInit_8h.html">ArmsDealerInvInit.h</a>"</span>
<a name="l00014"></a>00014 <span class="preprocessor">      #include "Message.h"</span>
<a name="l00015"></a>00015 <span class="preprocessor">      #include "soldier profile.h"</span>
<a name="l00016"></a>00016 <span class="preprocessor">      #include "<a class="code" href="Handle_01Items_8h.html">Handle Items.h</a>"</span>
<a name="l00017"></a>00017 <span class="preprocessor">#endif</span>
<a name="l00018"></a>00018 <span class="preprocessor"></span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 <span class="comment">// To reduce memory fragmentation from frequent MemRealloc(), we allocate memory for more than one special slot each</span>
<a name="l00022"></a>00022 <span class="comment">// time we run out of space.  Odds are that if we need one, we'll need another soon.</span>
<a name="l00023"></a>00023 <span class="preprocessor">#define SPECIAL_ITEMS_ALLOCED_AT_ONCE                 3</span>
<a name="l00024"></a>00024 <span class="preprocessor"></span><span class="comment">// Once allocated, the special item slots remain allocated for the duration of the game, or until the dealer dies.</span>
<a name="l00025"></a>00025 <span class="comment">// This is a little bit wasteful, but saves an awful lot of hassles, and avoid unnecessary memory fragmentation</span>
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 <span class="preprocessor">#define     MIN_REPAIR_TIME_IN_MINUTES                      15          // minutes</span>
<a name="l00028"></a>00028 <span class="preprocessor"></span><span class="preprocessor">#define MIN_REPAIR_COST                                                       10          // dollars</span>
<a name="l00029"></a>00029 <span class="preprocessor"></span>
<a name="l00030"></a>00030 <span class="comment">// price classes</span>
<a name="l00031"></a>00031 <span class="preprocessor">#define PRICE_CLASS_JUNK                                                      0</span>
<a name="l00032"></a>00032 <span class="preprocessor"></span><span class="preprocessor">#define PRICE_CLASS_CHEAP                                                     1</span>
<a name="l00033"></a>00033 <span class="preprocessor"></span><span class="preprocessor">#define PRICE_CLASS_EXPENSIVE                                     2</span>
<a name="l00034"></a>00034 <span class="preprocessor"></span>
<a name="l00035"></a>00035 <span class="keywordtype">void</span> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#72662d24512ddc3e917937e7063d7c55">ConvertCreatureBloodToElixir</a>( <span class="keywordtype">void</span> );
<a name="l00036"></a>00036 
<a name="l00037"></a><a class="code" href="ShopKeeper_01Interface_8cpp.html#396ff211074975473456e0ecf8b7b893">00037</a> <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#396ff211074975473456e0ecf8b7b893">gubLastSpecialItemAddedAtElement</a> = 255;
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 <span class="comment">// THIS STRUCTURE HAS UNCHANGING INFO THAT DOESN'T GET SAVED/RESTORED/RESET</span>
<a name="l00041"></a>00041 <span class="comment">// TODO: externalize </span>
<a name="l00042"></a><a class="code" href="Arms_01Dealer_01Init_8h.html#230ecf6873ae948a09ae12f5b69c22e0">00042</a> <a class="code" href="structARMS__DEALER__INFO.html">ARMS_DEALER_INFO</a>  <a class="code" href="Arms_01Dealer_01Init_8cpp.html#230ecf6873ae948a09ae12f5b69c22e0">ArmsDealerInfo</a>[ <a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc263581bcab1b191450fad78bf9d0a07e86">NUM_ARMS_DEALERS</a> ] = 
<a name="l00043"></a>00043 {
<a name="l00044"></a>00044                                                       <span class="comment">//Buying          Selling     Merc ID#    Type                                                  Initial                                   Flags </span>
<a name="l00045"></a>00045                                                       <span class="comment">//Price                 Price                                     Of                                                                Cash  </span>
<a name="l00046"></a>00046                                                       <span class="comment">//Modifier  Modifier                            Dealer</span>
<a name="l00047"></a>00047 
<a name="l00048"></a>00048 <span class="comment">/* Tony  */</span>                         { 0.75f,    1.25f,      <a class="code" href="Soldier_01Profile_8h.html#acaa92dcb344e96138c964deae3e2fa1cf72cbaf4c89fc240465f4d1397a5b8c">TONY</a>,             <a class="code" href="Arms_01Dealer_01Init_8h.html#a53acfc1f86c3ba3efc58c4c0b7a8b06eade7933dd7641117a2fc26b1b0dd061">ARMS_DEALER_BUYS_SELLS</a>, 15000,      ARMS_DEALER_SOME_USED_ITEMS | ARMS_DEALER_GIVES_CHANGE      },
<a name="l00049"></a>00049 <span class="comment">/* Franz Hinkle */</span>      { 1.0f,           1.5f,       <a class="code" href="Soldier_01Profile_8h.html#acaa92dcb344e96138c964deae3e2fa1dcda4f3676fdbf1782374e8046b9443f">FRANZ</a>,            <a class="code" href="Arms_01Dealer_01Init_8h.html#a53acfc1f86c3ba3efc58c4c0b7a8b06eade7933dd7641117a2fc26b1b0dd061">ARMS_DEALER_BUYS_SELLS</a>, 5000, ARMS_DEALER_SOME_USED_ITEMS | ARMS_DEALER_GIVES_CHANGE      },
<a name="l00050"></a>00050 <span class="comment">/* Keith Hemps */</span>       { 0.75f,    1.0f,       <a class="code" href="Soldier_01Profile_8h.html#acaa92dcb344e96138c964deae3e2fa16e3d4638889291fbd253574d01f6baa2">KEITH</a>,            <a class="code" href="Arms_01Dealer_01Init_8h.html#a53acfc1f86c3ba3efc58c4c0b7a8b06eade7933dd7641117a2fc26b1b0dd061">ARMS_DEALER_BUYS_SELLS</a>, 1500, ARMS_DEALER_ONLY_USED_ITEMS | ARMS_DEALER_GIVES_CHANGE      },
<a name="l00051"></a>00051 <span class="comment">/* Jake Cameron */</span>      { 0.8f,           1.1f,       <a class="code" href="Soldier_01Profile_8h.html#acaa92dcb344e96138c964deae3e2fa14a05cb11f6240930a26c89de9bce1710">JAKE</a>,             <a class="code" href="Arms_01Dealer_01Init_8h.html#a53acfc1f86c3ba3efc58c4c0b7a8b06eade7933dd7641117a2fc26b1b0dd061">ARMS_DEALER_BUYS_SELLS</a>, 2500, ARMS_DEALER_ONLY_USED_ITEMS | ARMS_DEALER_GIVES_CHANGE      },
<a name="l00052"></a>00052 <span class="comment">/* Gabby Mulnick*/</span>      { 1.0f,           1.0f,       <a class="code" href="Soldier_01Profile_8h.html#acaa92dcb344e96138c964deae3e2fa1664caa3c281309dd8938f272042346e3">GABBY</a>,            <a class="code" href="Arms_01Dealer_01Init_8h.html#a53acfc1f86c3ba3efc58c4c0b7a8b06eade7933dd7641117a2fc26b1b0dd061">ARMS_DEALER_BUYS_SELLS</a>, 3000, ARMS_DEALER_GIVES_CHANGE                                                                                                },
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 <span class="comment">/* Devin Connell*/</span>      { 0.75f,    1.25f,      <a class="code" href="Soldier_01Profile_8h.html#acaa92dcb344e96138c964deae3e2fa1a7b01111f61e6e4c37c9083bd91b0d20">DEVIN</a>,            <a class="code" href="Arms_01Dealer_01Init_8h.html#a53acfc1f86c3ba3efc58c4c0b7a8b06dbc52cc2cbf69932510155b9768621a2">ARMS_DEALER_SELLS_ONLY</a>, 5000, ARMS_DEALER_GIVES_CHANGE                                                                                                },
<a name="l00055"></a>00055 <span class="comment">/* Howard Filmore*/</span>     { 1.0f,           1.0f,       <a class="code" href="Soldier_01Profile_8h.html#acaa92dcb344e96138c964deae3e2fa189cf152d0147870b93b9368c26c740aa">HOWARD</a>,           <a class="code" href="Arms_01Dealer_01Init_8h.html#a53acfc1f86c3ba3efc58c4c0b7a8b06dbc52cc2cbf69932510155b9768621a2">ARMS_DEALER_SELLS_ONLY</a>, 3000, ARMS_DEALER_GIVES_CHANGE                                                                                                },
<a name="l00056"></a>00056 <span class="comment">/* Sam Rozen */</span>               { 1.0f,           1.0f,       <a class="code" href="Soldier_01Profile_8h.html#acaa92dcb344e96138c964deae3e2fa15e72f846ee5b2e4e04de87e6bd3e6662">SAM</a>,              <a class="code" href="Arms_01Dealer_01Init_8h.html#a53acfc1f86c3ba3efc58c4c0b7a8b06dbc52cc2cbf69932510155b9768621a2">ARMS_DEALER_SELLS_ONLY</a>, 3000, ARMS_DEALER_GIVES_CHANGE                                                                                                },
<a name="l00057"></a>00057 <span class="comment">/* Frank */</span>                         { 1.0f,           1.0f,       <a class="code" href="Soldier_01Profile_8h.html#acaa92dcb344e96138c964deae3e2fa1e15043570385ee40433fcf6ece9678bc">FRANK</a>,            <a class="code" href="Arms_01Dealer_01Init_8h.html#a53acfc1f86c3ba3efc58c4c0b7a8b06dbc52cc2cbf69932510155b9768621a2">ARMS_DEALER_SELLS_ONLY</a>,  500, ARMS_DEALER_ACCEPTS_GIFTS                                                                                               },
<a name="l00058"></a>00058 
<a name="l00059"></a>00059 <span class="comment">/* Bar Bro 1 */</span>               { 1.0f,           1.0f,       <a class="code" href="Soldier_01Profile_8h.html#acaa92dcb344e96138c964deae3e2fa1737b675309e5cd511168f50ee2f6b612">HERVE</a>,            <a class="code" href="Arms_01Dealer_01Init_8h.html#a53acfc1f86c3ba3efc58c4c0b7a8b06dbc52cc2cbf69932510155b9768621a2">ARMS_DEALER_SELLS_ONLY</a>,  250, ARMS_DEALER_ACCEPTS_GIFTS                                                                                               },
<a name="l00060"></a>00060 <span class="comment">/* Bar Bro 2 */</span>               { 1.0f,           1.0f,       <a class="code" href="Soldier_01Profile_8h.html#acaa92dcb344e96138c964deae3e2fa18c0f57de6038a950d4813a05d38bbf28">PETER</a>,            <a class="code" href="Arms_01Dealer_01Init_8h.html#a53acfc1f86c3ba3efc58c4c0b7a8b06dbc52cc2cbf69932510155b9768621a2">ARMS_DEALER_SELLS_ONLY</a>,  250, ARMS_DEALER_ACCEPTS_GIFTS                                                                                               },
<a name="l00061"></a>00061 <span class="comment">/* Bar Bro 3 */</span>               { 1.0f,           1.0f,       <a class="code" href="Soldier_01Profile_8h.html#acaa92dcb344e96138c964deae3e2fa16db81aa485f7cd0c1a844d0afafa9ca1">ALBERTO</a>,    <a class="code" href="Arms_01Dealer_01Init_8h.html#a53acfc1f86c3ba3efc58c4c0b7a8b06dbc52cc2cbf69932510155b9768621a2">ARMS_DEALER_SELLS_ONLY</a>,  250, ARMS_DEALER_ACCEPTS_GIFTS                                                                                               },
<a name="l00062"></a>00062 <span class="comment">/* Bar Bro 4 */</span>               { 1.0f,           1.0f,       <a class="code" href="Soldier_01Profile_8h.html#acaa92dcb344e96138c964deae3e2fa1c16317c1ae7b8552e19a99fbe2644047">CARLO</a>,            <a class="code" href="Arms_01Dealer_01Init_8h.html#a53acfc1f86c3ba3efc58c4c0b7a8b06dbc52cc2cbf69932510155b9768621a2">ARMS_DEALER_SELLS_ONLY</a>,  250, ARMS_DEALER_ACCEPTS_GIFTS                                                                                               },
<a name="l00063"></a>00063 
<a name="l00064"></a>00064 <span class="comment">/* Micky O'Brien*/</span>      { 1.0f,           1.4f,       <a class="code" href="Soldier_01Profile_8h.html#acaa92dcb344e96138c964deae3e2fa1d0f9f738b853d9fb02cb08a5b941129e">MICKY</a>,            <a class="code" href="Arms_01Dealer_01Init_8h.html#a53acfc1f86c3ba3efc58c4c0b7a8b0618b0a0d047f3ae9e91f1915e5905eb05">ARMS_DEALER_BUYS_ONLY</a>, 10000, ARMS_DEALER_HAS_NO_INVENTORY | ARMS_DEALER_GIVES_CHANGE },
<a name="l00065"></a>00065 
<a name="l00066"></a>00066                                                             <span class="comment">//Repair    Repair</span>
<a name="l00067"></a>00067                                                             <span class="comment">//Speed           Cost</span>
<a name="l00068"></a>00068 <span class="comment">/* Arnie Brunzwell*/</span>{ 0.1f,         0.8f,       <a class="code" href="Soldier_01Profile_8h.html#acaa92dcb344e96138c964deae3e2fa1a9ff2f72766e0f4ea63bd2ff06525b70">ARNIE</a>,            <a class="code" href="Arms_01Dealer_01Init_8h.html#a53acfc1f86c3ba3efc58c4c0b7a8b0660294909c8977216b64281ee7a5c37b6">ARMS_DEALER_REPAIRS</a>,          1500, ARMS_DEALER_HAS_NO_INVENTORY | ARMS_DEALER_GIVES_CHANGE     },
<a name="l00069"></a>00069 <span class="comment">/* Fredo */</span>                         { 0.6f,           0.6f,       <a class="code" href="Soldier_01Profile_8h.html#acaa92dcb344e96138c964deae3e2fa193147ef3c4942477c343fbfff042f74a">FREDO</a>,            <a class="code" href="Arms_01Dealer_01Init_8h.html#a53acfc1f86c3ba3efc58c4c0b7a8b0660294909c8977216b64281ee7a5c37b6">ARMS_DEALER_REPAIRS</a>,          1000, ARMS_DEALER_HAS_NO_INVENTORY | ARMS_DEALER_GIVES_CHANGE },
<a name="l00070"></a>00070 <span class="comment">/* Perko */</span>                         { 1.0f,           0.4f,   <a class="code" href="Soldier_01Profile_8h.html#acaa92dcb344e96138c964deae3e2fa1e613c598ab95e140ed18597eb2850fd5">PERKO</a>,          <a class="code" href="Arms_01Dealer_01Init_8h.html#a53acfc1f86c3ba3efc58c4c0b7a8b0660294909c8977216b64281ee7a5c37b6">ARMS_DEALER_REPAIRS</a>,          1000, ARMS_DEALER_HAS_NO_INVENTORY | ARMS_DEALER_GIVES_CHANGE },
<a name="l00071"></a>00071 
<a name="l00072"></a>00072 <span class="comment">/* Elgin */</span>                         { 1.0f,           1.0f,   <a class="code" href="Soldier_01Profile_8h.html#acaa92dcb344e96138c964deae3e2fa15da4ab939d10603943ec76360a90bc18">DRUGGIST</a>, <a class="code" href="Arms_01Dealer_01Init_8h.html#a53acfc1f86c3ba3efc58c4c0b7a8b06dbc52cc2cbf69932510155b9768621a2">ARMS_DEALER_SELLS_ONLY</a>,  500, ARMS_DEALER_ACCEPTS_GIFTS                                                                                               },
<a name="l00073"></a>00073 <span class="comment">/* Manny */</span>                         { 1.0f,           1.0f,   <a class="code" href="Soldier_01Profile_8h.html#acaa92dcb344e96138c964deae3e2fa1b678aa503cc3b74de91ca9429dfc1cff">MANNY</a>,          <a class="code" href="Arms_01Dealer_01Init_8h.html#a53acfc1f86c3ba3efc58c4c0b7a8b06dbc52cc2cbf69932510155b9768621a2">ARMS_DEALER_SELLS_ONLY</a>,  500, ARMS_DEALER_ACCEPTS_GIFTS                                                                                               },
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 };
<a name="l00076"></a>00076 
<a name="l00077"></a>00077 
<a name="l00078"></a>00078 <span class="comment">// THESE GET SAVED/RESTORED/RESET</span>
<a name="l00079"></a><a class="code" href="Arms_01Dealer_01Init_8h.html#efac177a506b89c636fdab5eeccd37d8">00079</a> <a class="code" href="structARMS__DEALER__STATUS.html">ARMS_DEALER_STATUS</a>      <a class="code" href="Arms_01Dealer_01Init_8cpp.html#efac177a506b89c636fdab5eeccd37d8">gArmsDealerStatus</a>[ <a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc263581bcab1b191450fad78bf9d0a07e86">NUM_ARMS_DEALERS</a> ];
<a name="l00080"></a><a class="code" href="Arms_01Dealer_01Init_8h.html#a0ee8dd58d74bb9c65fabb67dd534f11">00080</a> <a class="code" href="structDEALER__ITEM__HEADER.html">DEALER_ITEM_HEADER</a>      <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ <a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc263581bcab1b191450fad78bf9d0a07e86">NUM_ARMS_DEALERS</a> ][ <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f40efaf5227d3f780f8db037c71e3f903f">MAXITEMS</a> ];
<a name="l00081"></a>00081 
<a name="l00082"></a>00082 
<a name="l00083"></a>00083 
<a name="l00084"></a>00084 
<a name="l00085"></a>00085 
<a name="l00086"></a>00086 <span class="keywordtype">void</span>        <a class="code" href="Arms_01Dealer_01Init_8cpp.html#affd6acf301899d888adce4940375db8">InitializeOneArmsDealer</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer );
<a name="l00087"></a>00087 
<a name="l00088"></a>00088 <span class="keywordtype">void</span>        <a class="code" href="Arms_01Dealer_01Init_8cpp.html#441e77fff63243b1c6e003bb4290dceb">AddAmmoToArmsDealerInventory</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usItemIndex, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubShotsLeft );
<a name="l00089"></a>00089 <span class="keywordtype">void</span>        <a class="code" href="Arms_01Dealer_01Init_8cpp.html#0da9a30648c5360e44cac7e2461ea3bb">AddItemToArmsDealerInventory</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usItemIndex, <a class="code" href="structSPECIAL__ITEM__INFO.html">SPECIAL_ITEM_INFO</a> *pSpclItemInfo, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubHowMany );
<a name="l00090"></a>00090 <span class="keywordtype">void</span>        <a class="code" href="Arms_01Dealer_01Init_8cpp.html#89b4d162e27a07efbc4302a1e9bc3bb2">AddSpecialItemToArmsDealerInventoryAtElement</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usItemIndex, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubElement, <a class="code" href="structSPECIAL__ITEM__INFO.html">SPECIAL_ITEM_INFO</a> *pSpclItemInfo );
<a name="l00091"></a>00091 
<a name="l00092"></a>00092 <span class="keywordtype">void</span>        <a class="code" href="Arms_01Dealer_01Init_8cpp.html#8ca2d85db785fd88a7b7fa6bdbf89896">RemoveRandomItemFromArmsDealerInventory</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usItemIndex, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubHowMany );
<a name="l00093"></a>00093 
<a name="l00094"></a>00094 <span class="keywordtype">void</span>        <a class="code" href="Arms_01Dealer_01Init_8cpp.html#0ee4c19243f47e68051f8447b1f4e2c5">DailyCheckOnItemQuantities</a>();
<a name="l00095"></a>00095 <span class="keywordtype">void</span>        <a class="code" href="Arms_01Dealer_01Init_8cpp.html#308aadd42362ef844033079fe0cfd0f3">SimulateArmsDealerCustomer</a>();
<a name="l00096"></a>00096 
<a name="l00097"></a>00097 <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#e33c5434950a10299aa06eaafef7ff60">AdjustCertainDealersInventory</a>();
<a name="l00098"></a>00098 <span class="keywordtype">void</span>        <a class="code" href="Arms_01Dealer_01Init_8cpp.html#3428766845dee467769c0391d5d01849">LimitArmsDealersInventory</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uDealerItemType, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubMaxNumberOfItemType );
<a name="l00099"></a>00099 <span class="keywordtype">void</span>        <a class="code" href="Arms_01Dealer_01Init_8cpp.html#113775735a030623aeb8036767973b92">GuaranteeAtLeastOneItemOfType</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDealerItemType );
<a name="l00100"></a>00100 <span class="keywordtype">void</span>        <a class="code" href="Quests_8cpp.html#5a7dd258af5c2805c1eb015dae61f6e7">GuaranteeAtLeastXItemsOfIndex</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usItemIndex, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubHowMany );
<a name="l00101"></a>00101 
<a name="l00102"></a>00102 <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#5b455b495d2c965f53bf107893c5fde3">AllocMemsetSpecialItemArray</a>( <a class="code" href="structDEALER__ITEM__HEADER.html">DEALER_ITEM_HEADER</a> *pDealerItem, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubElementsNeeded );
<a name="l00103"></a>00103 <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#ff5263f30d648f749ea192e5a9a7dd56">ResizeSpecialItemArray</a>( <a class="code" href="structDEALER__ITEM__HEADER.html">DEALER_ITEM_HEADER</a> *pDealerItem, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubElementsNeeded );
<a name="l00104"></a>00104 <span class="keywordtype">void</span>        <a class="code" href="Arms_01Dealer_01Init_8cpp.html#99b7de7235e1411faa3c0702f649fa0a">FreeSpecialItemArray</a>( <a class="code" href="structDEALER__ITEM__HEADER.html">DEALER_ITEM_HEADER</a> *pDealerItem );
<a name="l00105"></a>00105 
<a name="l00106"></a>00106 <span class="keywordtype">void</span>        <a class="code" href="Arms_01Dealer_01Init_8cpp.html#b4ad9adfcf547f74c00bca868388cd37">ArmsDealerGetsFreshStock</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usItemIndex, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubNumItems );
<a name="l00107"></a>00107 <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#0432d6e6217897f6122ade9ca9fcdd28">ItemContainsLiquid</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usItemIndex );
<a name="l00108"></a>00108 <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>       <a class="code" href="Arms_01Dealer_01Init_8cpp.html#ebacdf7da42ad4183e9347b9680efa50">DetermineDealerItemCondition</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usItemIndex );
<a name="l00109"></a>00109 
<a name="l00110"></a>00110 <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#5c176cb71e619d5e26c1af3f23d94a8f">IsItemInfoSpecial</a>( <a class="code" href="structSPECIAL__ITEM__INFO.html">SPECIAL_ITEM_INFO</a> *pSpclItemInfo );
<a name="l00111"></a>00111 
<a name="l00112"></a>00112 <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#94141d72a212e3ef2f176d7fe84bcb31">DoesItemAppearInDealerInventoryList</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usItemIndex, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fPurchaseFromPlayer );
<a name="l00113"></a>00113 
<a name="l00114"></a>00114 <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#d3b4787f28244e41090dd4bb349d970a">LoadIncompleteArmsDealersStatus</a>( <a class="code" href="LibraryDataBase_8h.html#210e2fc1c18208cbf159ef9c087d6721">HWFILE</a> hFile, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fIncludesElgin, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fIncludesManny );
<a name="l00115"></a>00115 
<a name="l00116"></a>00116 <span class="comment">//INT16 GetSpecialItemFromArmsDealerInventory( UINT8 ubArmsDealer, UINT16 usItemIndex, SPECIAL_ITEM_INFO *pSpclItemInfo );</span>
<a name="l00117"></a>00117 
<a name="l00118"></a>00118 <span class="keywordtype">void</span> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#e104fca6b6bf33638d8f2df3949066bd">GuaranteeMinimumAlcohol</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer );
<a name="l00119"></a>00119 
<a name="l00120"></a>00120 <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#5e66eb4229dd9479536b22c5320de161">ItemIsARocketRifle</a>( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sItemIndex );
<a name="l00121"></a>00121 
<a name="l00122"></a>00122 <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#9ce40c5f0ccbf3380aafb62c47b00fb7">GetArmsDealerShopHours</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> *puiOpeningTime, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> *puiClosingTime );
<a name="l00123"></a>00123 
<a name="l00124"></a>00124 
<a name="l00125"></a>00125 
<a name="l00126"></a><a class="code" href="Arms_01Dealer_01Init_8h.html#8934340df1a3ec993b3993ec0907ce74">00126</a> <span class="keywordtype">void</span> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#8934340df1a3ec993b3993ec0907ce74">InitAllArmsDealers</a>()
<a name="l00127"></a>00127 {
<a name="l00128"></a>00128       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>       ubArmsDealer;
<a name="l00129"></a>00129 
<a name="l00130"></a>00130       <span class="comment">//Memset all dealers' status tables to zeroes</span>
<a name="l00131"></a>00131       memset( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#efac177a506b89c636fdab5eeccd37d8">gArmsDealerStatus</a>, 0, <span class="keyword">sizeof</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#efac177a506b89c636fdab5eeccd37d8">gArmsDealerStatus</a> ) );
<a name="l00132"></a>00132 
<a name="l00133"></a>00133       <span class="comment">//Memset all dealers' inventory tables to zeroes</span>
<a name="l00134"></a>00134       memset( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>, 0, <span class="keyword">sizeof</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a> ) );
<a name="l00135"></a>00135 
<a name="l00136"></a>00136       <span class="comment">//Initialize the initial status &amp; inventory for each of the arms dealers</span>
<a name="l00137"></a>00137       <span class="keywordflow">for</span>( ubArmsDealer = 0; ubArmsDealer &lt; <a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc263581bcab1b191450fad78bf9d0a07e86">NUM_ARMS_DEALERS</a>; ubArmsDealer++ )
<a name="l00138"></a>00138       {
<a name="l00139"></a>00139             <a class="code" href="Arms_01Dealer_01Init_8cpp.html#affd6acf301899d888adce4940375db8">InitializeOneArmsDealer</a>( ubArmsDealer );
<a name="l00140"></a>00140       }
<a name="l00141"></a>00141 
<a name="l00142"></a>00142       <span class="comment">//make sure certain items are in stock and certain limits are respected</span>
<a name="l00143"></a>00143       <a class="code" href="Arms_01Dealer_01Init_8cpp.html#e33c5434950a10299aa06eaafef7ff60">AdjustCertainDealersInventory</a>( );
<a name="l00144"></a>00144 }
<a name="l00145"></a>00145 
<a name="l00146"></a>00146 
<a name="l00147"></a><a class="code" href="Arms_01Dealer_01Init_8cpp.html#affd6acf301899d888adce4940375db8">00147</a> <span class="keywordtype">void</span> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#affd6acf301899d888adce4940375db8">InitializeOneArmsDealer</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer )
<a name="l00148"></a>00148 {
<a name="l00149"></a>00149       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>      usItemIndex;
<a name="l00150"></a>00150       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>       ubNumItems=0;
<a name="l00151"></a>00151 
<a name="l00152"></a>00152 
<a name="l00153"></a>00153       memset( &amp;( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#efac177a506b89c636fdab5eeccd37d8">gArmsDealerStatus</a>[ ubArmsDealer ] ), 0, <span class="keyword">sizeof</span>( <a class="code" href="structARMS__DEALER__STATUS.html">ARMS_DEALER_STATUS</a> ) );
<a name="l00154"></a>00154       memset( &amp;( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ] ), 0, <span class="keyword">sizeof</span>( <a class="code" href="structDEALER__ITEM__HEADER.html">DEALER_ITEM_HEADER</a> ) * <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f40efaf5227d3f780f8db037c71e3f903f">MAXITEMS</a> );
<a name="l00155"></a>00155 
<a name="l00156"></a>00156 
<a name="l00157"></a>00157       <span class="comment">//Reset the arms dealers cash on hand to the default initial value</span>
<a name="l00158"></a>00158       <a class="code" href="Arms_01Dealer_01Init_8cpp.html#efac177a506b89c636fdab5eeccd37d8">gArmsDealerStatus</a>[ ubArmsDealer ].<a class="code" href="structARMS__DEALER__STATUS.html#d38e8396a23c958c7c5d715313008499">uiArmsDealersCash</a> = <a class="code" href="Arms_01Dealer_01Init_8cpp.html#230ecf6873ae948a09ae12f5b69c22e0">ArmsDealerInfo</a>[ ubArmsDealer ].<a class="code" href="structARMS__DEALER__INFO.html#e306d3b9235c687feda92e20f24e4c99">iInitialCash</a>;
<a name="l00159"></a>00159 
<a name="l00160"></a>00160       <span class="comment">//if the arms dealer isn't supposed to have any items (includes all repairmen)</span>
<a name="l00161"></a>00161       <span class="keywordflow">if</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#230ecf6873ae948a09ae12f5b69c22e0">ArmsDealerInfo</a>[ ubArmsDealer ].uiFlags &amp; ARMS_DEALER_HAS_NO_INVENTORY )
<a name="l00162"></a>00162       {
<a name="l00163"></a>00163             <span class="keywordflow">return</span>;
<a name="l00164"></a>00164       }
<a name="l00165"></a>00165 
<a name="l00166"></a>00166 
<a name="l00167"></a>00167       <span class="comment">//loop through all the item types</span>
<a name="l00168"></a>00168       <span class="keywordflow">for</span>( usItemIndex = 1; usItemIndex &lt; MAXITEMS; usItemIndex++ )
<a name="l00169"></a>00169       {
<a name="l00170"></a>00170             <span class="keywordflow">if</span> ( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usItemIndex].usItemClass  == 0 )
<a name="l00171"></a>00171                   <span class="keywordflow">break</span>;
<a name="l00172"></a>00172             <span class="comment">//Can the item be sold by the arms dealer</span>
<a name="l00173"></a>00173             <span class="keywordflow">if</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#8ce74faa7791774f2a1276a41e140daf">CanDealerTransactItem</a>( ubArmsDealer, usItemIndex, FALSE ) )
<a name="l00174"></a>00174             {
<a name="l00175"></a>00175                   <span class="comment">//Setup an initial amount for the items (treat items as new, how many are used isn't known yet)</span>
<a name="l00176"></a>00176                   ubNumItems = <a class="code" href="ArmsDealerInvInit_8cpp.html#3306b0b785109de24a014a38ce39cc4f">DetermineInitialInvItems</a>( ubArmsDealer, usItemIndex, <a class="code" href="ArmsDealerInvInit_8cpp.html#a7fa16b786e59b82a6893a265e878b42">GetDealersMaxItemAmount</a>( ubArmsDealer, usItemIndex ), FALSE );
<a name="l00177"></a>00177 
<a name="l00178"></a>00178                   <span class="comment">//if there are any initial items</span>
<a name="l00179"></a>00179                   <span class="keywordflow">if</span>( ubNumItems &gt; 0 )
<a name="l00180"></a>00180                   {
<a name="l00181"></a>00181                         <a class="code" href="Arms_01Dealer_01Init_8cpp.html#b4ad9adfcf547f74c00bca868388cd37">ArmsDealerGetsFreshStock</a>( ubArmsDealer, usItemIndex, ubNumItems );
<a name="l00182"></a>00182                   }
<a name="l00183"></a>00183             }
<a name="l00184"></a>00184       }
<a name="l00185"></a>00185 }
<a name="l00186"></a>00186 
<a name="l00187"></a>00187 
<a name="l00188"></a><a class="code" href="Arms_01Dealer_01Init_8h.html#93a1f439dd655bf9e0b657c36adfed91">00188</a> <span class="keywordtype">void</span> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#93a1f439dd655bf9e0b657c36adfed91">ShutDownArmsDealers</a>()
<a name="l00189"></a>00189 {
<a name="l00190"></a>00190       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>       ubArmsDealer;
<a name="l00191"></a>00191       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>      usItemIndex;
<a name="l00192"></a>00192 
<a name="l00193"></a>00193       <span class="comment">// loop through all the dealers</span>
<a name="l00194"></a>00194       <span class="keywordflow">for</span>( ubArmsDealer=0; ubArmsDealer&lt;<a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc263581bcab1b191450fad78bf9d0a07e86">NUM_ARMS_DEALERS</a>; ubArmsDealer++ )
<a name="l00195"></a>00195       {
<a name="l00196"></a>00196             <span class="comment">//loop through all the item types</span>
<a name="l00197"></a>00197             <span class="keywordflow">for</span>( usItemIndex = 1; usItemIndex &lt; <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f40efaf5227d3f780f8db037c71e3f903f">MAXITEMS</a>; usItemIndex++ )
<a name="l00198"></a>00198             {
<a name="l00199"></a>00199                   <span class="keywordflow">if</span> ( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usItemIndex].usItemClass  == 0 )
<a name="l00200"></a>00200                         <span class="keywordflow">break</span>;
<a name="l00201"></a>00201                   <span class="keywordflow">if</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].ubElementsAlloced &gt; 0 )
<a name="l00202"></a>00202                   {
<a name="l00203"></a>00203                         <a class="code" href="Arms_01Dealer_01Init_8cpp.html#99b7de7235e1411faa3c0702f649fa0a">FreeSpecialItemArray</a>( &amp;<a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ] );
<a name="l00204"></a>00204                   }
<a name="l00205"></a>00205             }
<a name="l00206"></a>00206       }
<a name="l00207"></a>00207 }
<a name="l00208"></a>00208 
<a name="l00209"></a>00209 
<a name="l00210"></a>00210 
<a name="l00211"></a><a class="code" href="Arms_01Dealer_01Init_8h.html#744b906c9fed8b5b3ac6e23a1665327b">00211</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#744b906c9fed8b5b3ac6e23a1665327b">SaveArmsDealerInventoryToSaveGameFile</a>( <a class="code" href="LibraryDataBase_8h.html#210e2fc1c18208cbf159ef9c087d6721">HWFILE</a> hFile )
<a name="l00212"></a>00212 {
<a name="l00213"></a>00213       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>      uiNumBytesWritten;
<a name="l00214"></a>00214       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>       ubArmsDealer;
<a name="l00215"></a>00215       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>      usItemIndex;
<a name="l00216"></a>00216 
<a name="l00217"></a>00217 
<a name="l00218"></a>00218       <span class="comment">//Save the arms dealers status</span>
<a name="l00219"></a>00219       <span class="keywordflow">if</span> (!<a class="code" href="FileMan_8cpp.html#09ed41c07d607c8c64a7e2b9fb25660c">FileWrite</a>( hFile, <a class="code" href="Arms_01Dealer_01Init_8cpp.html#efac177a506b89c636fdab5eeccd37d8">gArmsDealerStatus</a>, <span class="keyword">sizeof</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#efac177a506b89c636fdab5eeccd37d8">gArmsDealerStatus</a> ), &amp;uiNumBytesWritten ))
<a name="l00220"></a>00220       {
<a name="l00221"></a>00221             <span class="keywordflow">return</span>( FALSE );
<a name="l00222"></a>00222       }
<a name="l00223"></a>00223 
<a name="l00224"></a>00224       <span class="comment">//save the dealers inventory item headers (all at once)</span>
<a name="l00225"></a>00225       <span class="keywordflow">if</span> (!<a class="code" href="FileMan_8cpp.html#09ed41c07d607c8c64a7e2b9fb25660c">FileWrite</a>( hFile, <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>, <span class="keyword">sizeof</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a> ), &amp;uiNumBytesWritten ))
<a name="l00226"></a>00226       {
<a name="l00227"></a>00227             <span class="keywordflow">return</span>( FALSE );
<a name="l00228"></a>00228       }
<a name="l00229"></a>00229 
<a name="l00230"></a>00230       <span class="comment">//loop through all the dealers inventories</span>
<a name="l00231"></a>00231       <span class="keywordflow">for</span>( ubArmsDealer=0; ubArmsDealer&lt;<a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc263581bcab1b191450fad78bf9d0a07e86">NUM_ARMS_DEALERS</a>; ubArmsDealer++ )
<a name="l00232"></a>00232       {
<a name="l00233"></a>00233             <span class="comment">//loop through this dealer's individual items</span>
<a name="l00234"></a>00234             <span class="keywordflow">for</span>(usItemIndex = 1; usItemIndex &lt; <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f40efaf5227d3f780f8db037c71e3f903f">MAXITEMS</a>; usItemIndex++ )
<a name="l00235"></a>00235             {
<a name="l00236"></a>00236                   <span class="keywordflow">if</span> ( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usItemIndex].usItemClass  == 0 )
<a name="l00237"></a>00237                         <span class="keywordflow">break</span>;
<a name="l00238"></a>00238                   <span class="comment">//if there are any special item elements allocated for this item, save them</span>
<a name="l00239"></a>00239                   <span class="keywordflow">if</span>( gArmsDealersInventory[ ubArmsDealer ][ usItemIndex ].ubElementsAlloced &gt; 0 )
<a name="l00240"></a>00240                   {
<a name="l00241"></a>00241                         <span class="keywordflow">if</span> (!<a class="code" href="FileMan_8cpp.html#09ed41c07d607c8c64a7e2b9fb25660c">FileWrite</a>( hFile, &amp;gArmsDealersInventory[ ubArmsDealer ][ usItemIndex ].SpecialItem[0], <span class="keyword">sizeof</span>( <a class="code" href="structDEALER__SPECIAL__ITEM.html">DEALER_SPECIAL_ITEM</a> ) * gArmsDealersInventory[ ubArmsDealer ][ usItemIndex ].ubElementsAlloced, &amp;uiNumBytesWritten ))
<a name="l00242"></a>00242                         {
<a name="l00243"></a>00243                               <span class="keywordflow">return</span>( FALSE );
<a name="l00244"></a>00244                         }
<a name="l00245"></a>00245                   }
<a name="l00246"></a>00246             }
<a name="l00247"></a>00247       }
<a name="l00248"></a>00248 
<a name="l00249"></a>00249       <span class="keywordflow">return</span>( TRUE );
<a name="l00250"></a>00250 }
<a name="l00251"></a>00251 
<a name="l00252"></a>00252 
<a name="l00253"></a><a class="code" href="Arms_01Dealer_01Init_8h.html#cceffce1b316b659db736e85e5e84d0f">00253</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#cceffce1b316b659db736e85e5e84d0f">LoadArmsDealerInventoryFromSavedGameFile</a>( <a class="code" href="LibraryDataBase_8h.html#210e2fc1c18208cbf159ef9c087d6721">HWFILE</a> hFile, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fIncludesElgin, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fIncludesManny )
<a name="l00254"></a>00254 {
<a name="l00255"></a>00255       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>      uiNumBytesRead;
<a name="l00256"></a>00256       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>       ubArmsDealer;
<a name="l00257"></a>00257       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>      usItemIndex;
<a name="l00258"></a>00258 
<a name="l00259"></a>00259 
<a name="l00260"></a>00260       <span class="comment">//Free all the dealers special inventory arrays</span>
<a name="l00261"></a>00261       <a class="code" href="Arms_01Dealer_01Init_8cpp.html#93a1f439dd655bf9e0b657c36adfed91">ShutDownArmsDealers</a>();
<a name="l00262"></a>00262 
<a name="l00263"></a>00263       <span class="comment">// Elgin was added to the dealers list in Game Version #54, enlarging these 2 tables...</span>
<a name="l00264"></a>00264       <span class="comment">// Manny was added to the dealers list in Game Version #55, enlarging these 2 tables...</span>
<a name="l00265"></a>00265       <span class="keywordflow">if</span> ( fIncludesElgin &amp;&amp; fIncludesManny )
<a name="l00266"></a>00266       {
<a name="l00267"></a>00267             <span class="comment">// info for all dealers is in the save file</span>
<a name="l00268"></a>00268 
<a name="l00269"></a>00269             <span class="comment">//Load the arms dealers status</span>
<a name="l00270"></a>00270             <span class="keywordflow">if</span> ( !<a class="code" href="FileMan_8cpp.html#1b213074411fd4c1dc8fd345e787b17e">FileRead</a>( hFile, <a class="code" href="Arms_01Dealer_01Init_8cpp.html#efac177a506b89c636fdab5eeccd37d8">gArmsDealerStatus</a>, <span class="keyword">sizeof</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#efac177a506b89c636fdab5eeccd37d8">gArmsDealerStatus</a> ), &amp;uiNumBytesRead ))
<a name="l00271"></a>00271             {
<a name="l00272"></a>00272                   <span class="keywordflow">return</span>( FALSE );
<a name="l00273"></a>00273             }
<a name="l00274"></a>00274 
<a name="l00275"></a>00275             <span class="comment">//load the dealers inventory item headers (all at once)</span>
<a name="l00276"></a>00276             <span class="keywordflow">if</span> ( !<a class="code" href="FileMan_8cpp.html#1b213074411fd4c1dc8fd345e787b17e">FileRead</a>( hFile, <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>, <span class="keyword">sizeof</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a> ), &amp;uiNumBytesRead ))
<a name="l00277"></a>00277             {
<a name="l00278"></a>00278                   <span class="keywordflow">return</span>( FALSE );
<a name="l00279"></a>00279             }
<a name="l00280"></a>00280       }
<a name="l00281"></a>00281       <span class="keywordflow">else</span>
<a name="l00282"></a>00282       {
<a name="l00283"></a>00283             <span class="keywordflow">if</span> ( !<a class="code" href="Arms_01Dealer_01Init_8cpp.html#d3b4787f28244e41090dd4bb349d970a">LoadIncompleteArmsDealersStatus</a>( hFile, fIncludesElgin, fIncludesManny ) )
<a name="l00284"></a>00284             {
<a name="l00285"></a>00285                   <span class="keywordflow">return</span>( FALSE );
<a name="l00286"></a>00286             }
<a name="l00287"></a>00287       }
<a name="l00288"></a>00288 
<a name="l00289"></a>00289       <span class="comment">//loop through all the dealers inventories</span>
<a name="l00290"></a>00290       <span class="keywordflow">for</span>( ubArmsDealer=0; ubArmsDealer&lt;<a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc263581bcab1b191450fad78bf9d0a07e86">NUM_ARMS_DEALERS</a>; ubArmsDealer++ )
<a name="l00291"></a>00291       {
<a name="l00292"></a>00292             <span class="comment">//loop through this dealer's individual items</span>
<a name="l00293"></a>00293             <span class="keywordflow">for</span>(usItemIndex = 1; usItemIndex &lt; <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f40efaf5227d3f780f8db037c71e3f903f">MAXITEMS</a>; usItemIndex++ )
<a name="l00294"></a>00294             {
<a name="l00295"></a>00295                   <span class="keywordflow">if</span> ( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usItemIndex].usItemClass  == 0 )
<a name="l00296"></a>00296                         <span class="keywordflow">break</span>;
<a name="l00297"></a>00297                   <span class="comment">//if there are any elements allocated for this item, load them</span>
<a name="l00298"></a>00298                   <span class="keywordflow">if</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ubArmsDealer][usItemIndex].ubElementsAlloced &gt; 0 )
<a name="l00299"></a>00299                   {
<a name="l00300"></a>00300                         <span class="comment">//Allocate memory for the inventory</span>
<a name="l00301"></a>00301                         <span class="keywordflow">if</span> ( !<a class="code" href="Arms_01Dealer_01Init_8cpp.html#5b455b495d2c965f53bf107893c5fde3">AllocMemsetSpecialItemArray</a>( &amp;<a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ], <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ubArmsDealer][usItemIndex].ubElementsAlloced ))
<a name="l00302"></a>00302                               <span class="keywordflow">return</span>(FALSE);
<a name="l00303"></a>00303 
<a name="l00304"></a>00304                         <span class="keywordflow">if</span> (!<a class="code" href="FileMan_8cpp.html#1b213074411fd4c1dc8fd345e787b17e">FileRead</a>( hFile, &amp;<a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ubArmsDealer][usItemIndex].SpecialItem[0], <span class="keyword">sizeof</span>( <a class="code" href="structDEALER__SPECIAL__ITEM.html">DEALER_SPECIAL_ITEM</a> ) * <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].ubElementsAlloced, &amp;uiNumBytesRead ))
<a name="l00305"></a>00305                         {
<a name="l00306"></a>00306                               <span class="keywordflow">return</span>( FALSE );
<a name="l00307"></a>00307                         }
<a name="l00308"></a>00308                   }
<a name="l00309"></a>00309             }
<a name="l00310"></a>00310       }
<a name="l00311"></a>00311 
<a name="l00312"></a>00312       <span class="keywordflow">return</span>( TRUE );
<a name="l00313"></a>00313 }
<a name="l00314"></a>00314 
<a name="l00315"></a>00315 
<a name="l00316"></a><a class="code" href="Arms_01Dealer_01Init_8h.html#9a03e1638e54eeb9dc9a8debcf0f05e0">00316</a> <span class="keywordtype">void</span> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#9a03e1638e54eeb9dc9a8debcf0f05e0">DailyUpdateOfArmsDealersInventory</a>()
<a name="l00317"></a>00317 {
<a name="l00318"></a>00318       <span class="comment">// if Gabby has creature blood, start turning it into extra elixir</span>
<a name="l00319"></a>00319       <a class="code" href="Arms_01Dealer_01Init_8cpp.html#72662d24512ddc3e917937e7063d7c55">ConvertCreatureBloodToElixir</a>();
<a name="l00320"></a>00320 
<a name="l00321"></a>00321       <span class="comment">//Simulate other customers buying inventory from the dealer</span>
<a name="l00322"></a>00322       <a class="code" href="Arms_01Dealer_01Init_8cpp.html#308aadd42362ef844033079fe0cfd0f3">SimulateArmsDealerCustomer</a>();
<a name="l00323"></a>00323 
<a name="l00324"></a>00324       <span class="comment">//if there are some items that are out of stock, order some more</span>
<a name="l00325"></a>00325       <a class="code" href="Arms_01Dealer_01Init_8cpp.html#0ee4c19243f47e68051f8447b1f4e2c5">DailyCheckOnItemQuantities</a>();
<a name="l00326"></a>00326 
<a name="l00327"></a>00327       <span class="comment">//make sure certain items are in stock and certain limits are respected</span>
<a name="l00328"></a>00328       <a class="code" href="Arms_01Dealer_01Init_8cpp.html#e33c5434950a10299aa06eaafef7ff60">AdjustCertainDealersInventory</a>( );
<a name="l00329"></a>00329 }
<a name="l00330"></a>00330 
<a name="l00331"></a>00331 
<a name="l00332"></a>00332 <span class="comment">// Once a day, loop through each dealer's inventory items and possibly sell some</span>
<a name="l00333"></a><a class="code" href="Arms_01Dealer_01Init_8cpp.html#308aadd42362ef844033079fe0cfd0f3">00333</a> <span class="keywordtype">void</span> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#308aadd42362ef844033079fe0cfd0f3">SimulateArmsDealerCustomer</a>()
<a name="l00334"></a>00334 {
<a name="l00335"></a>00335       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>       ubArmsDealer=0;
<a name="l00336"></a>00336       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>      usItemIndex;
<a name="l00337"></a>00337       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>   ubItemsSold=0;
<a name="l00338"></a>00338       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>       ubElement;
<a name="l00339"></a>00339       <a class="code" href="structSPECIAL__ITEM__INFO.html">SPECIAL_ITEM_INFO</a> SpclItemInfo;
<a name="l00340"></a>00340 
<a name="l00341"></a>00341 
<a name="l00342"></a>00342       <span class="comment">//loop through all the arms dealers</span>
<a name="l00343"></a>00343       <span class="keywordflow">for</span>( ubArmsDealer=0;ubArmsDealer&lt;<a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc263581bcab1b191450fad78bf9d0a07e86">NUM_ARMS_DEALERS</a>;ubArmsDealer++ )
<a name="l00344"></a>00344       {
<a name="l00345"></a>00345             <span class="keywordflow">if</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#efac177a506b89c636fdab5eeccd37d8">gArmsDealerStatus</a>[ ubArmsDealer ].fOutOfBusiness )
<a name="l00346"></a>00346                   <span class="keywordflow">continue</span>;
<a name="l00347"></a>00347 
<a name="l00348"></a>00348             <span class="comment">//if the arms dealer isn't supposed to have any items (includes all repairmen)</span>
<a name="l00349"></a>00349             <span class="keywordflow">if</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#230ecf6873ae948a09ae12f5b69c22e0">ArmsDealerInfo</a>[ ubArmsDealer ].uiFlags &amp; ARMS_DEALER_HAS_NO_INVENTORY )
<a name="l00350"></a>00350                   <span class="keywordflow">continue</span>;
<a name="l00351"></a>00351 
<a name="l00352"></a>00352             <span class="comment">//loop through all items of the same type</span>
<a name="l00353"></a>00353             <span class="keywordflow">for</span>( usItemIndex = 1; usItemIndex &lt; <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f40efaf5227d3f780f8db037c71e3f903f">MAXITEMS</a>; usItemIndex++ )
<a name="l00354"></a>00354             {
<a name="l00355"></a>00355                   <span class="keywordflow">if</span> ( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usItemIndex].usItemClass  == 0 )
<a name="l00356"></a>00356                         <span class="keywordflow">break</span>;
<a name="l00357"></a>00357                   <span class="comment">//if there are some of these in stock</span>
<a name="l00358"></a>00358                   <span class="keywordflow">if</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].ubTotalItems &gt; 0)
<a name="l00359"></a>00359                   {
<a name="l00360"></a>00360                         <span class="comment">// first, try to sell all the new (perfect) ones</span>
<a name="l00361"></a>00361                         <span class="keywordflow">if</span> ( usItemIndex == <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f49a0f7934440a6de3b55b1778d2a56bbf">JAR_ELIXIR</a> )
<a name="l00362"></a>00362                         {
<a name="l00363"></a>00363                               <span class="comment">// only allow selling of standard # of items so those converted from blood given by player will be available</span>
<a name="l00364"></a>00364                               ubItemsSold = <a class="code" href="ArmsDealerInvInit_8cpp.html#15a1c6492f91995453c58702c88c9298">HowManyItemsAreSold</a>( ubArmsDealer, usItemIndex, (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>) __min( 3, <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].ubPerfectItems), FALSE);
<a name="l00365"></a>00365                         }
<a name="l00366"></a>00366                         <span class="keywordflow">else</span>
<a name="l00367"></a>00367                         {
<a name="l00368"></a>00368                               ubItemsSold = <a class="code" href="ArmsDealerInvInit_8cpp.html#15a1c6492f91995453c58702c88c9298">HowManyItemsAreSold</a>( ubArmsDealer, usItemIndex, <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].ubPerfectItems, FALSE);
<a name="l00369"></a>00369                         }
<a name="l00370"></a>00370                         <span class="keywordflow">if</span> ( ubItemsSold &gt; 0)
<a name="l00371"></a>00371                         {
<a name="l00372"></a>00372                               <span class="comment">// create item info describing a perfect item</span>
<a name="l00373"></a>00373                               <a class="code" href="Arms_01Dealer_01Init_8cpp.html#b4a1eb863f49bc02f992d8874ff97777">SetSpecialItemInfoToDefaults</a>( &amp;SpclItemInfo );
<a name="l00374"></a>00374                               <span class="comment">//Now remove that many NEW ones (condition 100) of that item</span>
<a name="l00375"></a>00375                               <a class="code" href="Arms_01Dealer_01Init_8cpp.html#20c2feeb94c93f8c59da42a4c81a1fbf">RemoveItemFromArmsDealerInventory</a>( ubArmsDealer, usItemIndex, &amp;SpclItemInfo, ubItemsSold);
<a name="l00376"></a>00376                         }
<a name="l00377"></a>00377 
<a name="l00378"></a>00378                         <span class="comment">// next, try to sell all the used ones, gotta do these one at a time so we can remove them by element</span>
<a name="l00379"></a>00379                         <span class="keywordflow">for</span> ( ubElement = 0; ubElement &lt; <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].<a class="code" href="structDEALER__ITEM__HEADER.html#26a9a14e537aa677de5829a0e6eb4171">ubElementsAlloced</a>; ubElement++ )
<a name="l00380"></a>00380                         {
<a name="l00381"></a>00381                               <span class="comment">// don't worry about negative condition, repairmen can't come this far, they don't sell!</span>
<a name="l00382"></a>00382                               <span class="keywordflow">if</span> ( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].SpecialItem[ ubElement ].fActive )
<a name="l00383"></a>00383                               {
<a name="l00384"></a>00384                                     <span class="comment">// try selling just this one</span>
<a name="l00385"></a>00385                                     <span class="keywordflow">if</span> (<a class="code" href="ArmsDealerInvInit_8cpp.html#15a1c6492f91995453c58702c88c9298">HowManyItemsAreSold</a>( ubArmsDealer, usItemIndex, 1, TRUE) &gt; 0)
<a name="l00386"></a>00386                                     {
<a name="l00387"></a>00387                                           <span class="comment">//Sold, now remove that particular USED one!</span>
<a name="l00388"></a>00388                                           <a class="code" href="Arms_01Dealer_01Init_8cpp.html#b06b400d722cf13e1815c1b538c1ea0e">RemoveSpecialItemFromArmsDealerInventoryAtElement</a>( ubArmsDealer, usItemIndex, ubElement );
<a name="l00389"></a>00389                                     }
<a name="l00390"></a>00390                               }
<a name="l00391"></a>00391                         }
<a name="l00392"></a>00392                   }
<a name="l00393"></a>00393             }
<a name="l00394"></a>00394       }
<a name="l00395"></a>00395 }
<a name="l00396"></a>00396 
<a name="l00397"></a>00397 
<a name="l00398"></a><a class="code" href="Arms_01Dealer_01Init_8cpp.html#0ee4c19243f47e68051f8447b1f4e2c5">00398</a> <span class="keywordtype">void</span> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#0ee4c19243f47e68051f8447b1f4e2c5">DailyCheckOnItemQuantities</a>()
<a name="l00399"></a>00399 {
<a name="l00400"></a>00400       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>       ubArmsDealer;
<a name="l00401"></a>00401       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>      usItemIndex;
<a name="l00402"></a>00402       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>       ubMaxSupply;
<a name="l00403"></a>00403       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>       ubNumItems;
<a name="l00404"></a>00404       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>      uiArrivalDay;
<a name="l00405"></a>00405       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fPrevElig;
<a name="l00406"></a>00406       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>       ubReorderDays;
<a name="l00407"></a>00407 
<a name="l00408"></a>00408 
<a name="l00409"></a>00409       <span class="comment">//loop through all the arms dealers</span>
<a name="l00410"></a>00410       <span class="keywordflow">for</span>( ubArmsDealer=0;ubArmsDealer&lt;<a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc263581bcab1b191450fad78bf9d0a07e86">NUM_ARMS_DEALERS</a>;ubArmsDealer++ )
<a name="l00411"></a>00411       {
<a name="l00412"></a>00412             <span class="keywordflow">if</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#efac177a506b89c636fdab5eeccd37d8">gArmsDealerStatus</a>[ ubArmsDealer ].fOutOfBusiness )
<a name="l00413"></a>00413                   <span class="keywordflow">continue</span>;
<a name="l00414"></a>00414 
<a name="l00415"></a>00415             <span class="comment">//Reset the arms dealers cash on hand to the default initial value</span>
<a name="l00416"></a>00416             <a class="code" href="Arms_01Dealer_01Init_8cpp.html#efac177a506b89c636fdab5eeccd37d8">gArmsDealerStatus</a>[ ubArmsDealer ].<a class="code" href="structARMS__DEALER__STATUS.html#d38e8396a23c958c7c5d715313008499">uiArmsDealersCash</a> = <a class="code" href="Arms_01Dealer_01Init_8cpp.html#230ecf6873ae948a09ae12f5b69c22e0">ArmsDealerInfo</a>[ ubArmsDealer ].<a class="code" href="structARMS__DEALER__INFO.html#e306d3b9235c687feda92e20f24e4c99">iInitialCash</a>;
<a name="l00417"></a>00417 
<a name="l00418"></a>00418             <span class="comment">//if the arms dealer isn't supposed to have any items (includes all repairmen)</span>
<a name="l00419"></a>00419             <span class="keywordflow">if</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#230ecf6873ae948a09ae12f5b69c22e0">ArmsDealerInfo</a>[ ubArmsDealer ].uiFlags &amp; ARMS_DEALER_HAS_NO_INVENTORY )
<a name="l00420"></a>00420                   <span class="keywordflow">continue</span>;
<a name="l00421"></a>00421 
<a name="l00422"></a>00422 
<a name="l00423"></a>00423             <span class="comment">//loop through all items of the same type</span>
<a name="l00424"></a>00424             <span class="keywordflow">for</span>( usItemIndex = 1; usItemIndex &lt; <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f40efaf5227d3f780f8db037c71e3f903f">MAXITEMS</a>; usItemIndex++ )
<a name="l00425"></a>00425             {
<a name="l00426"></a>00426                   <span class="keywordflow">if</span> ( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usItemIndex].usItemClass  == 0 )
<a name="l00427"></a>00427                         <span class="keywordflow">break</span>;
<a name="l00428"></a>00428                   <span class="comment">//if the dealer can sell the item type</span>
<a name="l00429"></a>00429                   <span class="keywordflow">if</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#8ce74faa7791774f2a1276a41e140daf">CanDealerTransactItem</a>( ubArmsDealer, usItemIndex, FALSE ) )
<a name="l00430"></a>00430                   {
<a name="l00431"></a>00431                         <span class="comment">//if there are no items on order</span>
<a name="l00432"></a>00432                         <span class="keywordflow">if</span> ( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].ubQtyOnOrder == 0 )
<a name="l00433"></a>00433                         {
<a name="l00434"></a>00434                               ubMaxSupply = <a class="code" href="ArmsDealerInvInit_8cpp.html#a7fa16b786e59b82a6893a265e878b42">GetDealersMaxItemAmount</a>( ubArmsDealer, usItemIndex );
<a name="l00435"></a>00435 
<a name="l00436"></a>00436                               <span class="comment">//if the qty on hand is half the desired amount or fewer</span>
<a name="l00437"></a>00437                               <span class="keywordflow">if</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].ubTotalItems &lt;= (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)( ubMaxSupply / 2 ) )
<a name="l00438"></a>00438                               {
<a name="l00439"></a>00439                                     <span class="comment">// remember value of the "previously eligible" flag</span>
<a name="l00440"></a>00440                                     fPrevElig = <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].fPreviouslyEligible;
<a name="l00441"></a>00441 
<a name="l00442"></a>00442                                     <span class="comment">//determine if the item can be restocked (assume new, use items aren't checked for until the stuff arrives)</span>
<a name="l00443"></a>00443                                     <span class="keywordflow">if</span> (<a class="code" href="ArmsDealerInvInit_8cpp.html#0680250236ad157b10c1f0e62aec0c71">ItemTransactionOccurs</a>( ubArmsDealer, usItemIndex, DEALER_BUYING, FALSE ))
<a name="l00444"></a>00444                                     {
<a name="l00445"></a>00445                                           <span class="comment">// figure out how many items to reorder (items are reordered an entire batch at a time)</span>
<a name="l00446"></a>00446                                           ubNumItems = <a class="code" href="ArmsDealerInvInit_8cpp.html#278563d2b72f533e0d588f095d6393b4">HowManyItemsToReorder</a>( ubMaxSupply, <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].ubTotalItems );
<a name="l00447"></a>00447 
<a name="l00448"></a>00448                                           <span class="comment">// if this is the first day the player is eligible to have access to this thing</span>
<a name="l00449"></a>00449                                           <span class="keywordflow">if</span> ( !fPrevElig )
<a name="l00450"></a>00450                                           {
<a name="l00451"></a>00451                                                 <span class="comment">// eliminate the ordering delay and stock the items instantly!</span>
<a name="l00452"></a>00452                                                 <span class="comment">// This is just a way to reward the player right away for making progress without the reordering lag...</span>
<a name="l00453"></a>00453                                                 <a class="code" href="Arms_01Dealer_01Init_8cpp.html#b4ad9adfcf547f74c00bca868388cd37">ArmsDealerGetsFreshStock</a>( ubArmsDealer, usItemIndex, ubNumItems );
<a name="l00454"></a>00454                                           }
<a name="l00455"></a>00455                                           <span class="keywordflow">else</span>
<a name="l00456"></a>00456                                           {
<a name="l00457"></a>00457                                                 <span class="keywordflow">if</span> ( ( ubArmsDealer == <a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc26f86e6d09e82882b36412949efab8f5a9">ARMS_DEALER_TONY</a> ) || ( ubArmsDealer == <a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc2601cbe42a520e66ed1b2763bbcd5453e1">ARMS_DEALER_DEVIN</a> ) )
<a name="l00458"></a>00458                                                 {
<a name="l00459"></a>00459                                                       <span class="comment">// the stuff Tony and Devin sell is imported, so it takes longer to arrive (for game balance)</span>
<a name="l00460"></a>00460                                                       ubReorderDays = ( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>) ( 2 + <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 2 ) );   <span class="comment">// 2-3 days</span>
<a name="l00461"></a>00461                                                 }
<a name="l00462"></a>00462                                                 <span class="keywordflow">else</span>
<a name="l00463"></a>00463                                                 {
<a name="l00464"></a>00464                                                       ubReorderDays = ( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>) ( 1 + <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 2 ) );   <span class="comment">// 1-2 days</span>
<a name="l00465"></a>00465                                                 }
<a name="l00466"></a>00466 
<a name="l00467"></a>00467                                                 <span class="comment">//Determine when the inventory should arrive</span>
<a name="l00468"></a>00468                                                 uiArrivalDay = <a class="code" href="Game_01Clock_8cpp.html#41db6fb136e18cfede5f7c1eea89d7fb">GetWorldDay</a>() + ubReorderDays;   <span class="comment">// consider changing this to minutes</span>
<a name="l00469"></a>00469 
<a name="l00470"></a>00470                                                 <span class="comment">// post new order</span>
<a name="l00471"></a>00471                                                 <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].<a class="code" href="structDEALER__ITEM__HEADER.html#cfc3aee32c2a8230315f3290e1ad0c93">ubQtyOnOrder</a> = ubNumItems;
<a name="l00472"></a>00472                                                 <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].<a class="code" href="structDEALER__ITEM__HEADER.html#ba119e01e014fc9c3305cbb791c2b567">uiOrderArrivalTime</a> = uiArrivalDay;
<a name="l00473"></a>00473                                           }
<a name="l00474"></a>00474                                     }
<a name="l00475"></a>00475                               }
<a name="l00476"></a>00476                         }
<a name="l00477"></a>00477                         <span class="keywordflow">else</span> <span class="comment">//items are on order</span>
<a name="l00478"></a>00478                         {
<a name="l00479"></a>00479                               <span class="comment">//and today is the day the items come in</span>
<a name="l00480"></a>00480                               <span class="keywordflow">if</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].uiOrderArrivalTime &gt;= <a class="code" href="Game_01Clock_8cpp.html#41db6fb136e18cfede5f7c1eea89d7fb">GetWorldDay</a>() )
<a name="l00481"></a>00481                               {
<a name="l00482"></a>00482                                     <a class="code" href="Arms_01Dealer_01Init_8cpp.html#b4ad9adfcf547f74c00bca868388cd37">ArmsDealerGetsFreshStock</a>( ubArmsDealer, usItemIndex, <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].ubQtyOnOrder);
<a name="l00483"></a>00483 
<a name="l00484"></a>00484                                     <span class="comment">//reset order</span>
<a name="l00485"></a>00485                                     <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].<a class="code" href="structDEALER__ITEM__HEADER.html#cfc3aee32c2a8230315f3290e1ad0c93">ubQtyOnOrder</a> = 0;
<a name="l00486"></a>00486                                     <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].<a class="code" href="structDEALER__ITEM__HEADER.html#ba119e01e014fc9c3305cbb791c2b567">uiOrderArrivalTime</a> = 0;
<a name="l00487"></a>00487                               }
<a name="l00488"></a>00488                         }
<a name="l00489"></a>00489                   }
<a name="l00490"></a>00490             }
<a name="l00491"></a>00491       }
<a name="l00492"></a>00492 }
<a name="l00493"></a>00493 
<a name="l00494"></a><a class="code" href="Arms_01Dealer_01Init_8cpp.html#72662d24512ddc3e917937e7063d7c55">00494</a> <span class="keywordtype">void</span> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#72662d24512ddc3e917937e7063d7c55">ConvertCreatureBloodToElixir</a>( <span class="keywordtype">void</span> )
<a name="l00495"></a>00495 {
<a name="l00496"></a>00496       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubBloodAvailable;
<a name="l00497"></a>00497       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubAmountToConvert;
<a name="l00498"></a>00498       <a class="code" href="structSPECIAL__ITEM__INFO.html">SPECIAL_ITEM_INFO</a> SpclItemInfo;
<a name="l00499"></a>00499 
<a name="l00500"></a>00500       ubBloodAvailable = <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ <a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc26e37ce5ce10b2ab923bfa9bfa4c87caa4">ARMS_DEALER_GABBY</a> ][ <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f40b6d110b7726364ba2ebfda0a07d316d">JAR_CREATURE_BLOOD</a> ].<a class="code" href="structDEALER__ITEM__HEADER.html#f4e90d47661b87353a9076c5e53cd453">ubTotalItems</a>;
<a name="l00501"></a>00501       <span class="keywordflow">if</span> ( ubBloodAvailable )
<a name="l00502"></a>00502       {
<a name="l00503"></a>00503             <span class="comment">// start converting blood into elixir!</span>
<a name="l00504"></a>00504             <span class="comment">//ubAmountToConvert = (UINT8) __min( 5 + Random( 3 ), ubBloodAvailable );</span>
<a name="l00505"></a>00505             ubAmountToConvert = ubBloodAvailable;
<a name="l00506"></a>00506 
<a name="l00507"></a>00507             <span class="comment">// create item info describing a perfect item</span>
<a name="l00508"></a>00508             <a class="code" href="Arms_01Dealer_01Init_8cpp.html#b4a1eb863f49bc02f992d8874ff97777">SetSpecialItemInfoToDefaults</a>( &amp;SpclItemInfo );
<a name="l00509"></a>00509 
<a name="l00510"></a>00510             <span class="comment">//Now remove that many NEW ones (condition 100) of that item</span>
<a name="l00511"></a>00511             <a class="code" href="Arms_01Dealer_01Init_8cpp.html#20c2feeb94c93f8c59da42a4c81a1fbf">RemoveItemFromArmsDealerInventory</a>( <a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc26e37ce5ce10b2ab923bfa9bfa4c87caa4">ARMS_DEALER_GABBY</a>, <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f40b6d110b7726364ba2ebfda0a07d316d">JAR_CREATURE_BLOOD</a>, &amp;SpclItemInfo, ubAmountToConvert );
<a name="l00512"></a>00512 
<a name="l00513"></a>00513             <a class="code" href="Arms_01Dealer_01Init_8cpp.html#b4ad9adfcf547f74c00bca868388cd37">ArmsDealerGetsFreshStock</a>( <a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc26e37ce5ce10b2ab923bfa9bfa4c87caa4">ARMS_DEALER_GABBY</a>, <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f49a0f7934440a6de3b55b1778d2a56bbf">JAR_ELIXIR</a>, ubAmountToConvert );
<a name="l00514"></a>00514       }
<a name="l00515"></a>00515 }
<a name="l00516"></a>00516 
<a name="l00517"></a><a class="code" href="Arms_01Dealer_01Init_8cpp.html#e33c5434950a10299aa06eaafef7ff60">00517</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#e33c5434950a10299aa06eaafef7ff60">AdjustCertainDealersInventory</a>( )
<a name="l00518"></a>00518 {
<a name="l00519"></a>00519       <span class="comment">//Adjust Tony's items (this restocks *instantly* 1/day, doesn't use the reorder system)</span>
<a name="l00520"></a>00520       <a class="code" href="Arms_01Dealer_01Init_8cpp.html#113775735a030623aeb8036767973b92">GuaranteeAtLeastOneItemOfType</a>( <a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc26f86e6d09e82882b36412949efab8f5a9">ARMS_DEALER_TONY</a>, ARMS_DEALER_BIG_GUNS );
<a name="l00521"></a>00521       <a class="code" href="Arms_01Dealer_01Init_8cpp.html#3428766845dee467769c0391d5d01849">LimitArmsDealersInventory</a>( <a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc26f86e6d09e82882b36412949efab8f5a9">ARMS_DEALER_TONY</a>, ARMS_DEALER_BIG_GUNS, 2 );
<a name="l00522"></a>00522       <a class="code" href="Arms_01Dealer_01Init_8cpp.html#3428766845dee467769c0391d5d01849">LimitArmsDealersInventory</a>( <a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc26f86e6d09e82882b36412949efab8f5a9">ARMS_DEALER_TONY</a>, ARMS_DEALER_HANDGUNCLASS, 3 );
<a name="l00523"></a>00523       <a class="code" href="Arms_01Dealer_01Init_8cpp.html#3428766845dee467769c0391d5d01849">LimitArmsDealersInventory</a>( <a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc26f86e6d09e82882b36412949efab8f5a9">ARMS_DEALER_TONY</a>, ARMS_DEALER_AMMO, 8 );
<a name="l00524"></a>00524 
<a name="l00525"></a>00525       <span class="comment">//Adjust all bartenders' alcohol levels to a minimum</span>
<a name="l00526"></a>00526       <a class="code" href="Arms_01Dealer_01Init_8cpp.html#e104fca6b6bf33638d8f2df3949066bd">GuaranteeMinimumAlcohol</a>( <a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc26c3ab4d103cbd98c8f968dbc601468bd5">ARMS_DEALER_FRANK</a> );
<a name="l00527"></a>00527       <a class="code" href="Arms_01Dealer_01Init_8cpp.html#e104fca6b6bf33638d8f2df3949066bd">GuaranteeMinimumAlcohol</a>( <a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc26186cde48a1caa6224e75373684ef8833">ARMS_DEALER_BAR_BRO_1</a> );
<a name="l00528"></a>00528       <a class="code" href="Arms_01Dealer_01Init_8cpp.html#e104fca6b6bf33638d8f2df3949066bd">GuaranteeMinimumAlcohol</a>( <a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc26a3c3e925dcb359cf46d45e2234a19874">ARMS_DEALER_BAR_BRO_2</a> );
<a name="l00529"></a>00529       <a class="code" href="Arms_01Dealer_01Init_8cpp.html#e104fca6b6bf33638d8f2df3949066bd">GuaranteeMinimumAlcohol</a>( <a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc26c2aae502a2aa06d2ec9c6c7b412bc400">ARMS_DEALER_BAR_BRO_3</a> );
<a name="l00530"></a>00530       <a class="code" href="Arms_01Dealer_01Init_8cpp.html#e104fca6b6bf33638d8f2df3949066bd">GuaranteeMinimumAlcohol</a>( <a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc26566c3d7546e8beae06c00989098a2a2f">ARMS_DEALER_BAR_BRO_4</a> );
<a name="l00531"></a>00531       <a class="code" href="Arms_01Dealer_01Init_8cpp.html#e104fca6b6bf33638d8f2df3949066bd">GuaranteeMinimumAlcohol</a>( <a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc26a4727a7692738c50dd304ad80a2f97c0">ARMS_DEALER_ELGIN</a> );
<a name="l00532"></a>00532       <a class="code" href="Arms_01Dealer_01Init_8cpp.html#e104fca6b6bf33638d8f2df3949066bd">GuaranteeMinimumAlcohol</a>( <a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc26cdc4677dee3c3f8777a0c76add856981">ARMS_DEALER_MANNY</a> );
<a name="l00533"></a>00533 
<a name="l00534"></a>00534       <span class="comment">//make sure Sam (hardware guy) has at least one empty jar</span>
<a name="l00535"></a>00535       <a class="code" href="Quests_8cpp.html#5a7dd258af5c2805c1eb015dae61f6e7">GuaranteeAtLeastXItemsOfIndex</a>( <a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc26165cf5dc927ae36b6c18f9daca6f3dc4">ARMS_DEALER_SAM</a>, <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f49748b81f88c2d93310782f561431a724">JAR</a>, 1 );
<a name="l00536"></a>00536 
<a name="l00537"></a>00537       <span class="keywordflow">if</span> ( <a class="code" href="Quests_8cpp.html#6744b59d27bf2791d0c2fefe18e548d3">CheckFact</a>( <a class="code" href="Quests_8h.html#aead3e57f613f07868a1b2afb6b943f1b416e804b2ede7bc41d91e8a909f2164">FACT_ESTONI_REFUELLING_POSSIBLE</a>, 0 ) )
<a name="l00538"></a>00538       {
<a name="l00539"></a>00539             <span class="comment">// gas is restocked regularly, unlike most items</span>
<a name="l00540"></a>00540             <a class="code" href="Quests_8cpp.html#5a7dd258af5c2805c1eb015dae61f6e7">GuaranteeAtLeastXItemsOfIndex</a>( <a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc26193bcc1758ce5a4f097271ef36cfffba">ARMS_DEALER_JAKE</a>, <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f468cde494e8a6fd23c437ebf3c3056da3">GAS_CAN</a>, ( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ) ( 4 + <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 3 ) ) );
<a name="l00541"></a>00541       }
<a name="l00542"></a>00542 
<a name="l00543"></a>00543       <span class="comment">//If the player hasn't bought a video camera from Franz yet, make sure Franz has one to sell</span>
<a name="l00544"></a>00544       <span class="keywordflow">if</span>( !( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#efac177a506b89c636fdab5eeccd37d8">gArmsDealerStatus</a>[ <a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc264db5b4ca17b51b96660f6c5d61a20b62">ARMS_DEALER_FRANZ</a> ].ubSpecificDealerFlags &amp; ARMS_DEALER_FLAG__FRANZ_HAS_SOLD_VIDEO_CAMERA_TO_PLAYER ) )
<a name="l00545"></a>00545       {
<a name="l00546"></a>00546             <a class="code" href="Quests_8cpp.html#5a7dd258af5c2805c1eb015dae61f6e7">GuaranteeAtLeastXItemsOfIndex</a>( <a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc264db5b4ca17b51b96660f6c5d61a20b62">ARMS_DEALER_FRANZ</a>, <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f45bec2b0551e06159304c50ed518da9e1">VIDEO_CAMERA</a>, 1 );
<a name="l00547"></a>00547       }
<a name="l00548"></a>00548 
<a name="l00549"></a>00549       <span class="keywordflow">return</span>( TRUE );
<a name="l00550"></a>00550 }
<a name="l00551"></a>00551 
<a name="l00552"></a>00552 
<a name="l00553"></a>00553 
<a name="l00554"></a><a class="code" href="Arms_01Dealer_01Init_8cpp.html#3428766845dee467769c0391d5d01849">00554</a> <span class="keywordtype">void</span> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#3428766845dee467769c0391d5d01849">LimitArmsDealersInventory</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDealerItemType, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubMaxNumberOfItemType )
<a name="l00555"></a>00555 {
<a name="l00556"></a>00556       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>      usItemIndex=0;
<a name="l00557"></a>00557       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>      uiItemsToRemove=0;
<a name="l00558"></a>00558       <a class="code" href="structSPECIAL__ITEM__INFO.html">SPECIAL_ITEM_INFO</a> SpclItemInfo;
<a name="l00559"></a>00559 
<a name="l00560"></a>00560       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>      usAvailableItem[ <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f40efaf5227d3f780f8db037c71e3f903f">MAXITEMS</a> ] = { NOTHING };
<a name="l00561"></a>00561       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>       ubNumberOfAvailableItem[ <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f40efaf5227d3f780f8db037c71e3f903f">MAXITEMS</a> ] = { 0 };
<a name="l00562"></a>00562       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>      uiTotalNumberOfItems = 0, uiRandomChoice;
<a name="l00563"></a>00563       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>      uiNumAvailableItems = 0, uiIndex;
<a name="l00564"></a>00564 
<a name="l00565"></a>00565       <span class="comment">// not permitted for repair dealers - would take extra code to avoid counting items under repair!</span>
<a name="l00566"></a>00566       Assert( !<a class="code" href="Arms_01Dealer_01Init_8cpp.html#160b9cd6e425f5db5ac75fc6269d2f70">DoesDealerDoRepairs</a>( ubArmsDealer ) );
<a name="l00567"></a>00567 
<a name="l00568"></a>00568       <span class="keywordflow">if</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#efac177a506b89c636fdab5eeccd37d8">gArmsDealerStatus</a>[ ubArmsDealer ].fOutOfBusiness )
<a name="l00569"></a>00569             <span class="keywordflow">return</span>;
<a name="l00570"></a>00570 
<a name="l00571"></a>00571       <span class="comment">//loop through all items of the same class and count the number in stock</span>
<a name="l00572"></a>00572       <span class="keywordflow">for</span>( usItemIndex = 1; usItemIndex &lt; <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f40efaf5227d3f780f8db037c71e3f903f">MAXITEMS</a>; usItemIndex++ )
<a name="l00573"></a>00573       {
<a name="l00574"></a>00574             <span class="keywordflow">if</span> ( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usItemIndex].usItemClass  == 0 )
<a name="l00575"></a>00575                   <span class="keywordflow">break</span>;
<a name="l00576"></a>00576             <span class="comment">//if there is some items in stock</span>
<a name="l00577"></a>00577             <span class="keywordflow">if</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].ubTotalItems &gt; 0)
<a name="l00578"></a>00578             {
<a name="l00579"></a>00579                   <span class="comment">//if the item is of the same dealer item type</span>
<a name="l00580"></a>00580                   <span class="keywordflow">if</span>( uiDealerItemType &amp; <a class="code" href="Arms_01Dealer_01Init_8cpp.html#610daafe85457924e375c3cbcd983e6c">GetArmsDealerItemTypeFromItemNumber</a>( usItemIndex ) )
<a name="l00581"></a>00581                   {
<a name="l00582"></a>00582                         usAvailableItem[ uiNumAvailableItems ] = usItemIndex;
<a name="l00583"></a>00583 
<a name="l00584"></a>00584                         <span class="comment">//if the dealer item type is ammo</span>
<a name="l00585"></a>00585                         <span class="keywordflow">if</span>( uiDealerItemType == ARMS_DEALER_AMMO )
<a name="l00586"></a>00586                         {
<a name="l00587"></a>00587                               <span class="comment">// all ammo of same type counts as only one item</span>
<a name="l00588"></a>00588                               ubNumberOfAvailableItem[ uiNumAvailableItems ] = 1;
<a name="l00589"></a>00589                               uiTotalNumberOfItems++;
<a name="l00590"></a>00590                         }
<a name="l00591"></a>00591                         <span class="keywordflow">else</span>
<a name="l00592"></a>00592                         {
<a name="l00593"></a>00593                               <span class="comment">// items being repaired don't count against the limit</span>
<a name="l00594"></a>00594                               ubNumberOfAvailableItem[ uiNumAvailableItems ] = <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].<a class="code" href="structDEALER__ITEM__HEADER.html#f4e90d47661b87353a9076c5e53cd453">ubTotalItems</a>;
<a name="l00595"></a>00595                               uiTotalNumberOfItems += ubNumberOfAvailableItem[ uiNumAvailableItems ];
<a name="l00596"></a>00596                         }
<a name="l00597"></a>00597                         uiNumAvailableItems++;
<a name="l00598"></a>00598                   }
<a name="l00599"></a>00599             }
<a name="l00600"></a>00600       }
<a name="l00601"></a>00601 
<a name="l00602"></a>00602       <span class="comment">//if there is more of the given type than we want</span>
<a name="l00603"></a>00603       <span class="keywordflow">if</span>( uiNumAvailableItems &gt; ubMaxNumberOfItemType )
<a name="l00604"></a>00604       {
<a name="l00605"></a>00605             uiItemsToRemove = uiNumAvailableItems - ubMaxNumberOfItemType;
<a name="l00606"></a>00606 
<a name="l00607"></a>00607             <span class="keywordflow">do</span>
<a name="l00608"></a>00608             {
<a name="l00609"></a>00609                   uiRandomChoice = <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( uiTotalNumberOfItems );
<a name="l00610"></a>00610 
<a name="l00611"></a>00611                   <span class="keywordflow">for</span> ( uiIndex = 0; uiIndex &lt; uiNumAvailableItems; uiIndex++ )
<a name="l00612"></a>00612                   {
<a name="l00613"></a>00613                         <span class="keywordflow">if</span> ( uiRandomChoice &lt;= ubNumberOfAvailableItem[ uiIndex ] )
<a name="l00614"></a>00614                         {
<a name="l00615"></a>00615                               usItemIndex = usAvailableItem[ uiIndex ];
<a name="l00616"></a>00616                               <span class="keywordflow">if</span> ( uiDealerItemType == ARMS_DEALER_AMMO )
<a name="l00617"></a>00617                               {
<a name="l00618"></a>00618                                     <span class="comment">// remove all of them, since each ammo item counts as only one "item" here</span>
<a name="l00619"></a>00619                                     <span class="comment">// create item info describing a perfect item</span>
<a name="l00620"></a>00620                                     <a class="code" href="Arms_01Dealer_01Init_8cpp.html#b4a1eb863f49bc02f992d8874ff97777">SetSpecialItemInfoToDefaults</a>( &amp;SpclItemInfo );
<a name="l00621"></a>00621                                     <span class="comment">// ammo will always be only condition 100, there's never any in special slots</span>
<a name="l00622"></a>00622                                     <a class="code" href="Arms_01Dealer_01Init_8cpp.html#20c2feeb94c93f8c59da42a4c81a1fbf">RemoveItemFromArmsDealerInventory</a>( ubArmsDealer, usItemIndex, &amp;SpclItemInfo, <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].ubTotalItems );
<a name="l00623"></a>00623                               }
<a name="l00624"></a>00624                               <span class="keywordflow">else</span>
<a name="l00625"></a>00625                               {
<a name="l00626"></a>00626                                     <span class="comment">// pick 1 random one, don't care about its condition</span>
<a name="l00627"></a>00627                                     <a class="code" href="Arms_01Dealer_01Init_8cpp.html#8ca2d85db785fd88a7b7fa6bdbf89896">RemoveRandomItemFromArmsDealerInventory</a>( ubArmsDealer, usItemIndex, 1 );
<a name="l00628"></a>00628                               }
<a name="l00629"></a>00629                               <span class="comment">// now remove entry from the array by replacing it with the last and decrementing</span>
<a name="l00630"></a>00630                               <span class="comment">// the size of the array</span>
<a name="l00631"></a>00631                               usAvailableItem[ uiIndex ] = usAvailableItem[ uiNumAvailableItems -  1 ];
<a name="l00632"></a>00632                               ubNumberOfAvailableItem[ uiIndex ] = ubNumberOfAvailableItem[ uiNumAvailableItems - 1 ];
<a name="l00633"></a>00633                               uiNumAvailableItems--;
<a name="l00634"></a>00634 
<a name="l00635"></a>00635                               <span class="comment">// decrement count of # of items to remove</span>
<a name="l00636"></a>00636                               uiItemsToRemove--;
<a name="l00637"></a>00637                               <span class="keywordflow">break</span>; <span class="comment">// and out of 'for' loop</span>
<a name="l00638"></a>00638 
<a name="l00639"></a>00639                         }
<a name="l00640"></a>00640                         <span class="keywordflow">else</span>
<a name="l00641"></a>00641                         {
<a name="l00642"></a>00642                               <span class="comment">// next item!</span>
<a name="l00643"></a>00643                               uiRandomChoice -= ubNumberOfAvailableItem[ uiIndex ];
<a name="l00644"></a>00644                         }
<a name="l00645"></a>00645                   }
<a name="l00646"></a>00646 
<a name="l00647"></a>00647                   <span class="comment">/*</span>
<a name="l00648"></a>00648 <span class="comment">                  //loop through all items of the same type</span>
<a name="l00649"></a>00649 <span class="comment">                  for( usItemIndex = 1; usItemIndex &lt; MAXITEMS; usItemIndex++ )</span>
<a name="l00650"></a>00650 <span class="comment">                  {</span>
<a name="l00651"></a>00651 <span class="comment">                        //if there are some non-repairing items in stock</span>
<a name="l00652"></a>00652 <span class="comment">                        if( gArmsDealersInventory[ ubArmsDealer ][ usItemIndex ].ubTotalItems )</span>
<a name="l00653"></a>00653 <span class="comment">                        {</span>
<a name="l00654"></a>00654 <span class="comment">                              //if the item is of the same dealer item type</span>
<a name="l00655"></a>00655 <span class="comment">                              if( uiDealerItemType &amp; GetArmsDealerItemTypeFromItemNumber( usItemIndex ) )</span>
<a name="l00656"></a>00656 <span class="comment">                              {</span>
<a name="l00657"></a>00657 <span class="comment">                                    // a random chance that the item will be removed</span>
<a name="l00658"></a>00658 <span class="comment">                                    if( Random( 100 ) &lt; 30 )</span>
<a name="l00659"></a>00659 <span class="comment">                                    {</span>
<a name="l00660"></a>00660 <span class="comment">                                          //remove the item</span>
<a name="l00661"></a>00661 <span class="comment"></span>
<a name="l00662"></a>00662 <span class="comment">                                          //if the dealer item type is ammo</span>
<a name="l00663"></a>00663 <span class="comment">                                          if( uiDealerItemType == ARMS_DEALER_AMMO )</span>
<a name="l00664"></a>00664 <span class="comment">                                          {</span>
<a name="l00665"></a>00665 <span class="comment">                                                // remove all of them, since each ammo item counts as only one "item" here</span>
<a name="l00666"></a>00666 <span class="comment"></span>
<a name="l00667"></a>00667 <span class="comment">                                                // create item info describing a perfect item</span>
<a name="l00668"></a>00668 <span class="comment">                                                SetSpecialItemInfoToDefaults( &amp;SpclItemInfo );</span>
<a name="l00669"></a>00669 <span class="comment">                                                // ammo will always be only condition 100, there's never any in special slots</span>
<a name="l00670"></a>00670 <span class="comment">                                                RemoveItemFromArmsDealerInventory( ubArmsDealer, usItemIndex, &amp;SpclItemInfo, gArmsDealersInventory[ ubArmsDealer ][ usItemIndex ].ubTotalItems );</span>
<a name="l00671"></a>00671 <span class="comment">                                          }</span>
<a name="l00672"></a>00672 <span class="comment">                                          else</span>
<a name="l00673"></a>00673 <span class="comment">                                          {</span>
<a name="l00674"></a>00674 <span class="comment">                                                // pick 1 random one, don't care about its condition</span>
<a name="l00675"></a>00675 <span class="comment">                                                RemoveRandomItemFromArmsDealerInventory( ubArmsDealer, usItemIndex, 1 );</span>
<a name="l00676"></a>00676 <span class="comment">                                          }</span>
<a name="l00677"></a>00677 <span class="comment"></span>
<a name="l00678"></a>00678 <span class="comment">                                          uiItemsToRemove--;</span>
<a name="l00679"></a>00679 <span class="comment">                                          if( uiItemsToRemove == 0)</span>
<a name="l00680"></a>00680 <span class="comment">                                                break;</span>
<a name="l00681"></a>00681 <span class="comment">                                    }</span>
<a name="l00682"></a>00682 <span class="comment">                              }</span>
<a name="l00683"></a>00683 <span class="comment">                        }</span>
<a name="l00684"></a>00684 <span class="comment">                  }</span>
<a name="l00685"></a>00685 <span class="comment">                  */</span>
<a name="l00686"></a>00686             } <span class="keywordflow">while</span> (uiItemsToRemove &gt; 0);
<a name="l00687"></a>00687       }
<a name="l00688"></a>00688 }
<a name="l00689"></a>00689 
<a name="l00690"></a>00690 
<a name="l00691"></a><a class="code" href="Arms_01Dealer_01Init_8cpp.html#113775735a030623aeb8036767973b92">00691</a> <span class="keywordtype">void</span> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#113775735a030623aeb8036767973b92">GuaranteeAtLeastOneItemOfType</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDealerItemType )
<a name="l00692"></a>00692 {
<a name="l00693"></a>00693       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usItemIndex;
<a name="l00694"></a>00694       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubChance;
<a name="l00695"></a>00695       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fFoundEligibleItemOfSameType = FALSE;
<a name="l00696"></a>00696       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fItemHasBeenAdded = FALSE;
<a name="l00697"></a>00697       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fFailedOnce = FALSE;
<a name="l00698"></a>00698       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>      usAvailableItem[ <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f40efaf5227d3f780f8db037c71e3f903f">MAXITEMS</a> ] = { NOTHING };
<a name="l00699"></a>00699       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>       ubChanceForAvailableItem[ <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f40efaf5227d3f780f8db037c71e3f903f">MAXITEMS</a> ] = { 0 };
<a name="l00700"></a>00700       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>      uiTotalChances = 0;
<a name="l00701"></a>00701       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>      uiNumAvailableItems = 0, uiIndex, uiRandomChoice;
<a name="l00702"></a>00702       
<a name="l00703"></a>00703       <span class="comment">// not permitted for repair dealers - would take extra code to avoid counting items under repair!</span>
<a name="l00704"></a>00704       Assert( !<a class="code" href="Arms_01Dealer_01Init_8cpp.html#160b9cd6e425f5db5ac75fc6269d2f70">DoesDealerDoRepairs</a>( ubArmsDealer ) );
<a name="l00705"></a>00705 
<a name="l00706"></a>00706       <span class="keywordflow">if</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#efac177a506b89c636fdab5eeccd37d8">gArmsDealerStatus</a>[ ubArmsDealer ].fOutOfBusiness )
<a name="l00707"></a>00707             <span class="keywordflow">return</span>;
<a name="l00708"></a>00708 
<a name="l00709"></a>00709       <span class="comment">//loop through all items of the same type</span>
<a name="l00710"></a>00710       <span class="keywordflow">for</span>( usItemIndex = 1; usItemIndex &lt; <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f40efaf5227d3f780f8db037c71e3f903f">MAXITEMS</a>; usItemIndex++ )
<a name="l00711"></a>00711       {
<a name="l00712"></a>00712             <span class="keywordflow">if</span> ( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usItemIndex].usItemClass  == 0 )
<a name="l00713"></a>00713                   <span class="keywordflow">break</span>;
<a name="l00714"></a>00714             <span class="comment">//if the item is of the same dealer item type</span>
<a name="l00715"></a>00715             <span class="keywordflow">if</span>( uiDealerItemType &amp; <a class="code" href="Arms_01Dealer_01Init_8cpp.html#610daafe85457924e375c3cbcd983e6c">GetArmsDealerItemTypeFromItemNumber</a>( usItemIndex ) )
<a name="l00716"></a>00716             {
<a name="l00717"></a>00717                   <span class="comment">//if there are any of these in stock</span>
<a name="l00718"></a>00718                   <span class="keywordflow">if</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].ubTotalItems &gt; 0 )
<a name="l00719"></a>00719                   {
<a name="l00720"></a>00720                         <span class="comment">//there is already at least 1 item of that type, return</span>
<a name="l00721"></a>00721                         <span class="keywordflow">return</span>;
<a name="l00722"></a>00722                   }
<a name="l00723"></a>00723 
<a name="l00724"></a>00724                   <span class="comment">// if he can stock it (it appears in his inventory list)</span>
<a name="l00725"></a>00725                   <span class="keywordflow">if</span>( <a class="code" href="ArmsDealerInvInit_8cpp.html#a7fa16b786e59b82a6893a265e878b42">GetDealersMaxItemAmount</a>( ubArmsDealer, usItemIndex ) &gt; 0)
<a name="l00726"></a>00726                   {
<a name="l00727"></a>00727                         <span class="comment">// and the stage of the game gives him a chance to have it (assume new)</span>
<a name="l00728"></a>00728                         ubChance = <a class="code" href="ArmsDealerInvInit_8cpp.html#06497d4c237786fc9f5b8df11fef98b7">ChanceOfItemTransaction</a>( ubArmsDealer, usItemIndex, DEALER_BUYING, FALSE );
<a name="l00729"></a>00729                         <span class="keywordflow">if</span> ( ubChance &gt; 0 )
<a name="l00730"></a>00730                         {
<a name="l00731"></a>00731                               usAvailableItem[ uiNumAvailableItems ] = usItemIndex;
<a name="l00732"></a>00732                               ubChanceForAvailableItem[ uiNumAvailableItems ] = ubChance;
<a name="l00733"></a>00733                               uiNumAvailableItems++;
<a name="l00734"></a>00734                               uiTotalChances += ubChance; 
<a name="l00735"></a>00735                         }
<a name="l00736"></a>00736                   }
<a name="l00737"></a>00737             }
<a name="l00738"></a>00738       }
<a name="l00739"></a>00739 
<a name="l00740"></a>00740       <span class="comment">// if there aren't any such items, the following loop would never finish, so quit before trying it!</span>
<a name="l00741"></a>00741       <span class="keywordflow">if</span> (uiNumAvailableItems == 0)
<a name="l00742"></a>00742       {
<a name="l00743"></a>00743             <span class="keywordflow">return</span>;
<a name="l00744"></a>00744       }
<a name="l00745"></a>00745 
<a name="l00746"></a>00746 
<a name="l00747"></a>00747       <span class="comment">// CJC: randomly pick one of available items by weighted random selection.</span>
<a name="l00748"></a>00748 
<a name="l00749"></a>00749       <span class="comment">// randomize number within uiTotalChances and then loop forwards till we find that item</span>
<a name="l00750"></a>00750       uiRandomChoice = <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( uiTotalChances );
<a name="l00751"></a>00751 
<a name="l00752"></a>00752       <span class="keywordflow">for</span> ( uiIndex = 0; uiIndex &lt; uiNumAvailableItems; uiIndex++ )
<a name="l00753"></a>00753       {
<a name="l00754"></a>00754             <span class="keywordflow">if</span> ( uiRandomChoice &lt;= ubChanceForAvailableItem[ uiIndex ] )
<a name="l00755"></a>00755             {
<a name="l00756"></a>00756                   <a class="code" href="Arms_01Dealer_01Init_8cpp.html#b4ad9adfcf547f74c00bca868388cd37">ArmsDealerGetsFreshStock</a>( ubArmsDealer, usAvailableItem[ uiIndex ], 1 );
<a name="l00757"></a>00757                   <span class="keywordflow">return</span>;
<a name="l00758"></a>00758             }
<a name="l00759"></a>00759             <span class="keywordflow">else</span>
<a name="l00760"></a>00760             {
<a name="l00761"></a>00761                   <span class="comment">// next item!</span>
<a name="l00762"></a>00762                   uiRandomChoice -= ubChanceForAvailableItem[ uiIndex ];
<a name="l00763"></a>00763             }
<a name="l00764"></a>00764       }
<a name="l00765"></a>00765 
<a name="l00766"></a>00766       <span class="comment">// internal logic failure!</span>
<a name="l00767"></a>00767 }
<a name="l00768"></a>00768 
<a name="l00769"></a>00769 
<a name="l00770"></a><a class="code" href="Quests_8cpp.html#5a7dd258af5c2805c1eb015dae61f6e7">00770</a> <span class="keywordtype">void</span> <a class="code" href="Quests_8cpp.html#5a7dd258af5c2805c1eb015dae61f6e7">GuaranteeAtLeastXItemsOfIndex</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usItemIndex, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubHowMany )
<a name="l00771"></a>00771 {
<a name="l00772"></a>00772       <span class="comment">// not permitted for repair dealers - would take extra code to avoid counting items under repair!</span>
<a name="l00773"></a>00773       Assert( !<a class="code" href="Arms_01Dealer_01Init_8cpp.html#160b9cd6e425f5db5ac75fc6269d2f70">DoesDealerDoRepairs</a>( ubArmsDealer ) );
<a name="l00774"></a>00774 
<a name="l00775"></a>00775       <span class="keywordflow">if</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#efac177a506b89c636fdab5eeccd37d8">gArmsDealerStatus</a>[ ubArmsDealer ].fOutOfBusiness )
<a name="l00776"></a>00776             <span class="keywordflow">return</span>;
<a name="l00777"></a>00777 
<a name="l00778"></a>00778       <span class="comment">//if there are any of these in stock</span>
<a name="l00779"></a>00779       <span class="keywordflow">if</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].ubTotalItems &gt;= ubHowMany )
<a name="l00780"></a>00780       {
<a name="l00781"></a>00781             <span class="comment">// have what we need...</span>
<a name="l00782"></a>00782             <span class="keywordflow">return</span>;
<a name="l00783"></a>00783       }
<a name="l00784"></a>00784 
<a name="l00785"></a>00785       <span class="comment">// if he can stock it (it appears in his inventory list)</span>
<a name="l00786"></a>00786 <span class="comment">// RESTRICTION REMOVED: Jake must be able to guarantee GAS even though it's not in his list, it's presence is conditional</span>
<a name="l00787"></a>00787 <span class="comment">//    if( GetDealersMaxItemAmount( ubArmsDealer, usItemIndex ) &gt; 0)</span>
<a name="l00788"></a>00788       {
<a name="l00789"></a>00789             <span class="comment">//add the item</span>
<a name="l00790"></a>00790             <a class="code" href="Arms_01Dealer_01Init_8cpp.html#b4ad9adfcf547f74c00bca868388cd37">ArmsDealerGetsFreshStock</a>( ubArmsDealer, usItemIndex, (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>)( ubHowMany - <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].ubTotalItems ) );
<a name="l00791"></a>00791       }
<a name="l00792"></a>00792 }
<a name="l00793"></a>00793 
<a name="l00794"></a>00794 
<a name="l00795"></a>00795 
<a name="l00796"></a><a class="code" href="Arms_01Dealer_01Init_8h.html#610daafe85457924e375c3cbcd983e6c">00796</a> <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#610daafe85457924e375c3cbcd983e6c">GetArmsDealerItemTypeFromItemNumber</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usItem )
<a name="l00797"></a>00797 {
<a name="l00798"></a>00798       <span class="keywordflow">switch</span>( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ usItem ].usItemClass )
<a name="l00799"></a>00799       {
<a name="l00800"></a>00800             <span class="keywordflow">case</span> IC_NONE:
<a name="l00801"></a>00801                   <span class="keywordflow">return</span>( 0 );
<a name="l00802"></a>00802                   <span class="keywordflow">break</span>;
<a name="l00803"></a>00803 
<a name="l00804"></a>00804             <span class="keywordflow">case</span> IC_GUN:
<a name="l00805"></a>00805                   <span class="keywordflow">switch</span>(  <a class="code" href="Weapons_8cpp.html#fac72e30bc7c36f55257eac0542ce51d">Weapon</a>[ <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ usItem ].ubClassIndex ].ubWeaponClass )
<a name="l00806"></a>00806                   {
<a name="l00807"></a>00807                         <span class="keywordflow">case</span> <a class="code" href="Weapons_8h.html#05e096ce80431f81e498481ee057b488f7e7aff1564e2c1aecfa3d0467429df1">HANDGUNCLASS</a>:
<a name="l00808"></a>00808                               <span class="keywordflow">return</span>( ARMS_DEALER_HANDGUNCLASS );
<a name="l00809"></a>00809                               <span class="keywordflow">break</span>;
<a name="l00810"></a>00810                         <span class="keywordflow">case</span> <a class="code" href="Weapons_8h.html#05e096ce80431f81e498481ee057b4888822d630b63f2c2e2db48ee4e5c2040a">RIFLECLASS</a>:
<a name="l00811"></a>00811                               <span class="keywordflow">if</span> ( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#5e66eb4229dd9479536b22c5320de161">ItemIsARocketRifle</a>( usItem ) )
<a name="l00812"></a>00812                                     <span class="keywordflow">return</span>( ARMS_DEALER_ROCKET_RIFLE );
<a name="l00813"></a>00813                               <span class="keywordflow">else</span>
<a name="l00814"></a>00814                                     <span class="keywordflow">return</span>( ARMS_DEALER_RIFLECLASS );
<a name="l00815"></a>00815                               <span class="keywordflow">break</span>;
<a name="l00816"></a>00816                         <span class="keywordflow">case</span> <a class="code" href="Weapons_8h.html#05e096ce80431f81e498481ee057b4888ee72a10a5ffffd8dc818c0b82fec603">SHOTGUNCLASS</a>:
<a name="l00817"></a>00817                               <span class="keywordflow">return</span>( ARMS_DEALER_SHOTGUNCLASS );
<a name="l00818"></a>00818                               <span class="keywordflow">break</span>;
<a name="l00819"></a>00819                         <span class="keywordflow">case</span> <a class="code" href="Weapons_8h.html#05e096ce80431f81e498481ee057b48871993496eba3acda94ed6f73fb7cf9c2">SMGCLASS</a>:
<a name="l00820"></a>00820                               <span class="keywordflow">return</span>( ARMS_DEALER_SMGCLASS );
<a name="l00821"></a>00821                               <span class="keywordflow">break</span>;
<a name="l00822"></a>00822                         <span class="keywordflow">case</span> <a class="code" href="Weapons_8h.html#05e096ce80431f81e498481ee057b488d089a715700b4b66d825f261d5d83352">MGCLASS</a>:
<a name="l00823"></a>00823                               <span class="keywordflow">return</span>( ARMS_DEALER_MGCLASS );
<a name="l00824"></a>00824                               <span class="keywordflow">break</span>;
<a name="l00825"></a>00825                         <span class="keywordflow">case</span> <a class="code" href="Weapons_8h.html#05e096ce80431f81e498481ee057b4889f614242c835cca44bd180bdda4a682f">MONSTERCLASS</a>:
<a name="l00826"></a>00826                               <span class="keywordflow">return</span>( 0 );
<a name="l00827"></a>00827                               <span class="keywordflow">break</span>;
<a name="l00828"></a>00828                         <span class="keywordflow">case</span> <a class="code" href="Weapons_8h.html#05e096ce80431f81e498481ee057b488659a2388232a49637647d2bb5aa7a21c">KNIFECLASS</a>:
<a name="l00829"></a>00829                               <span class="keywordflow">return</span>( ARMS_DEALER_KNIFECLASS );
<a name="l00830"></a>00830                               <span class="keywordflow">break</span>;
<a name="l00831"></a>00831                   }
<a name="l00832"></a>00832                   <span class="keywordflow">break</span>;
<a name="l00833"></a>00833 
<a name="l00834"></a>00834             <span class="keywordflow">case</span> IC_PUNCH:
<a name="l00835"></a>00835                   <span class="keywordflow">if</span> (usItem == NOTHING)
<a name="l00836"></a>00836                   {
<a name="l00837"></a>00837                         <span class="keywordflow">return</span>( 0 );
<a name="l00838"></a>00838                   }
<a name="l00839"></a>00839                   <span class="comment">// else treat as blade</span>
<a name="l00840"></a>00840             <span class="keywordflow">case</span> IC_BLADE:
<a name="l00841"></a>00841             <span class="keywordflow">case</span> IC_THROWING_KNIFE:
<a name="l00842"></a>00842                   <span class="keywordflow">return</span>( ARMS_DEALER_BLADE );
<a name="l00843"></a>00843                   <span class="keywordflow">break</span>;
<a name="l00844"></a>00844             <span class="keywordflow">case</span> IC_LAUNCHER:
<a name="l00845"></a>00845                   <span class="keywordflow">return</span>( ARMS_DEALER_LAUNCHER );
<a name="l00846"></a>00846                   <span class="keywordflow">break</span>;
<a name="l00847"></a>00847             <span class="keywordflow">case</span> IC_ARMOUR:
<a name="l00848"></a>00848                   <span class="keywordflow">return</span>( ARMS_DEALER_ARMOUR );
<a name="l00849"></a>00849                   <span class="keywordflow">break</span>;
<a name="l00850"></a>00850             <span class="keywordflow">case</span> IC_MEDKIT:
<a name="l00851"></a>00851                   <span class="keywordflow">return</span>( ARMS_DEALER_MEDKIT );
<a name="l00852"></a>00852                   <span class="keywordflow">break</span>;
<a name="l00853"></a>00853             <span class="keywordflow">case</span> IC_KIT:
<a name="l00854"></a>00854                   <span class="keywordflow">return</span>( ARMS_DEALER_KIT );
<a name="l00855"></a>00855                   <span class="keywordflow">break</span>;
<a name="l00856"></a>00856             <span class="keywordflow">case</span> IC_MISC:
<a name="l00857"></a>00857             {
<a name="l00858"></a>00858                   <span class="keywordflow">if</span> ( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a> [usItem].alcohol )
<a name="l00859"></a>00859                         <span class="keywordflow">return</span>( ARMS_DEALER_ALCOHOL );
<a name="l00860"></a>00860                   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a> [usItem].electronic )
<a name="l00861"></a>00861                         <span class="keywordflow">return</span>( ARMS_DEALER_ELECTRONICS );
<a name="l00862"></a>00862                   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a> [usItem].hardware )
<a name="l00863"></a>00863                         <span class="keywordflow">return</span>( ARMS_DEALER_HARDWARE );
<a name="l00864"></a>00864                   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a> [usItem].medical )
<a name="l00865"></a>00865                         <span class="keywordflow">return</span>( ARMS_DEALER_MEDICAL );
<a name="l00866"></a>00866                   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a> [usItem].attachment )
<a name="l00867"></a>00867                         <span class="keywordflow">return</span>( ARMS_DEALER_ATTACHMENTS );
<a name="l00868"></a>00868                   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a> [usItem].detonator || <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a> [usItem].remotedetonator || <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a> [usItem].remotetrigger )
<a name="l00869"></a>00869                         <span class="keywordflow">return</span>( ARMS_DEALER_DETONATORS );
<a name="l00870"></a>00870                   <span class="keywordflow">else</span>
<a name="l00871"></a>00871                         <span class="keywordflow">return</span>( ARMS_DEALER_MISC );
<a name="l00872"></a>00872                   <span class="comment">//switch on the type of item</span>
<a name="l00873"></a>00873 <span class="comment">//                switch( usItem )</span>
<a name="l00874"></a>00874 <span class="comment">//                {</span>
<a name="l00875"></a>00875 <span class="comment">//                      case BEER:</span>
<a name="l00876"></a>00876 <span class="comment">//                      case WINE:</span>
<a name="l00877"></a>00877 <span class="comment">//                      case ALCOHOL:</span>
<a name="l00878"></a>00878 <span class="comment">//                            return( ARMS_DEALER_ALCOHOL );</span>
<a name="l00879"></a>00879 <span class="comment">//                            break;</span>
<a name="l00880"></a>00880 <span class="comment">//</span>
<a name="l00881"></a>00881 <span class="comment">//                      case METALDETECTOR:</span>
<a name="l00882"></a>00882 <span class="comment">//                      case LASERSCOPE:</span><span class="comment"></span>
<a name="l00883"></a>00883 <span class="comment">////                    case REMDETONATOR:</span>
<a name="l00884"></a>00884 <span class="comment"></span><span class="comment">//                            return( ARMS_DEALER_ELECTRONICS );</span>
<a name="l00885"></a>00885 <span class="comment">//                            break;</span>
<a name="l00886"></a>00886 <span class="comment">//</span>
<a name="l00887"></a>00887 <span class="comment">//                      case CANTEEN:</span>
<a name="l00888"></a>00888 <span class="comment">//                      case CROWBAR:</span>
<a name="l00889"></a>00889 <span class="comment">//                      case WIRECUTTERS:</span>
<a name="l00890"></a>00890 <span class="comment">//                            return( ARMS_DEALER_HARDWARE );</span>
<a name="l00891"></a>00891 <span class="comment">//                            break;</span>
<a name="l00892"></a>00892 <span class="comment">//</span>
<a name="l00893"></a>00893 <span class="comment">//                      case ADRENALINE_BOOSTER:</span>
<a name="l00894"></a>00894 <span class="comment">//                      case REGEN_BOOSTER:</span>
<a name="l00895"></a>00895 <span class="comment">//                      case SYRINGE_3:</span>
<a name="l00896"></a>00896 <span class="comment">//                      case SYRINGE_4:</span>
<a name="l00897"></a>00897 <span class="comment">//                      case SYRINGE_5:</span>
<a name="l00898"></a>00898 <span class="comment">//                            return( ARMS_DEALER_MEDICAL );</span>
<a name="l00899"></a>00899 <span class="comment">//                            break;</span>
<a name="l00900"></a>00900 <span class="comment">//</span>
<a name="l00901"></a>00901 <span class="comment">//                      case SILENCER:</span>
<a name="l00902"></a>00902 <span class="comment">//                      case SNIPERSCOPE:</span>
<a name="l00903"></a>00903 <span class="comment">//                      case BIPOD:</span>
<a name="l00904"></a>00904 <span class="comment">//                      case DUCKBILL:</span>
<a name="l00905"></a>00905 <span class="comment">//                            return( ARMS_DEALER_ATTACHMENTS );</span>
<a name="l00906"></a>00906 <span class="comment">//                            break;</span>
<a name="l00907"></a>00907 <span class="comment">//</span>
<a name="l00908"></a>00908 <span class="comment">//                      case DETONATOR:</span>
<a name="l00909"></a>00909 <span class="comment">//                      case REMDETONATOR:</span>
<a name="l00910"></a>00910 <span class="comment">//                      case REMOTEBOMBTRIGGER:</span>
<a name="l00911"></a>00911 <span class="comment">//                            return( ARMS_DEALER_DETONATORS );</span>
<a name="l00912"></a>00912 <span class="comment">//                            break;</span>
<a name="l00913"></a>00913 <span class="comment">//</span>
<a name="l00914"></a>00914 <span class="comment">//                      default:</span>
<a name="l00915"></a>00915 <span class="comment">//                            return( ARMS_DEALER_MISC );</span>
<a name="l00916"></a>00916 <span class="comment">//</span>
<a name="l00917"></a>00917 <span class="comment">//                            break;</span>
<a name="l00918"></a>00918 <span class="comment">//          }</span>
<a name="l00919"></a>00919 
<a name="l00920"></a>00920             }
<a name="l00921"></a>00921             <span class="keywordflow">break</span>;
<a name="l00922"></a>00922             <span class="keywordflow">case</span> IC_AMMO:
<a name="l00923"></a>00923                   <span class="keywordflow">return</span>( ARMS_DEALER_AMMO );
<a name="l00924"></a>00924                   <span class="keywordflow">break</span>;
<a name="l00925"></a>00925             <span class="keywordflow">case</span> IC_FACE:
<a name="l00926"></a>00926                   <span class="keywordflow">if</span> (<a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usItem].electronic )
<a name="l00927"></a>00927                         <span class="keywordflow">return</span> ARMS_DEALER_ELECTRONICS;
<a name="l00928"></a>00928                   <span class="keywordflow">else</span>
<a name="l00929"></a>00929                         <span class="keywordflow">return</span> ARMS_DEALER_FACE;
<a name="l00930"></a>00930                   <span class="comment">//switch( usItem )</span>
<a name="l00931"></a>00931                   <span class="comment">//{</span>
<a name="l00932"></a>00932                   <span class="comment">//    case EXTENDEDEAR:</span>
<a name="l00933"></a>00933                   <span class="comment">//    case NIGHTGOGGLES:</span>
<a name="l00934"></a>00934                   <span class="comment">//    case ROBOT_REMOTE_CONTROL:</span>
<a name="l00935"></a>00935                   <span class="comment">//          return( ARMS_DEALER_ELECTRONICS );</span>
<a name="l00936"></a>00936                   <span class="comment">//    break;</span>
<a name="l00937"></a>00937 
<a name="l00938"></a>00938                   <span class="comment">//    default:</span>
<a name="l00939"></a>00939                   <span class="comment">//          return( ARMS_DEALER_FACE );</span>
<a name="l00940"></a>00940                   <span class="comment">//}</span>
<a name="l00941"></a>00941                   <span class="keywordflow">break</span>;
<a name="l00942"></a>00942             <span class="keywordflow">case</span> IC_THROWN:
<a name="l00943"></a>00943                   <span class="keywordflow">return</span>( 0 );
<a name="l00944"></a>00944 <span class="comment">//                return( ARMS_DEALER_THROWN );</span>
<a name="l00945"></a>00945                   
<a name="l00946"></a>00946                   <span class="keywordflow">break</span>;
<a name="l00947"></a>00947             <span class="keywordflow">case</span> IC_KEY:
<a name="l00948"></a>00948                   <span class="keywordflow">return</span>( 0 );
<a name="l00949"></a>00949 <span class="comment">//                return( ARMS_DEALER_KEY );</span>
<a name="l00950"></a>00950                   <span class="keywordflow">break</span>;
<a name="l00951"></a>00951             <span class="keywordflow">case</span> IC_GRENADE:
<a name="l00952"></a>00952                   <span class="keywordflow">return</span>( ARMS_DEALER_GRENADE );
<a name="l00953"></a>00953                   <span class="keywordflow">break</span>;
<a name="l00954"></a>00954             <span class="keywordflow">case</span> IC_BOMB:
<a name="l00955"></a>00955                   <span class="keywordflow">return</span>( ARMS_DEALER_BOMB );
<a name="l00956"></a>00956                   <span class="keywordflow">break</span>;
<a name="l00957"></a>00957             <span class="keywordflow">case</span> IC_EXPLOSV:
<a name="l00958"></a>00958                   <span class="keywordflow">return</span>( ARMS_DEALER_EXPLOSV );
<a name="l00959"></a>00959                   <span class="keywordflow">break</span>;
<a name="l00960"></a>00960             <span class="keywordflow">case</span> IC_TENTACLES:
<a name="l00961"></a>00961             <span class="keywordflow">case</span> IC_MONEY:
<a name="l00962"></a>00962                   <span class="keywordflow">return</span>( 0 );
<a name="l00963"></a>00963                   <span class="keywordflow">break</span>;
<a name="l00964"></a>00964 
<a name="l00965"></a>00965       <span class="comment">//    case IC_APPLIABLE:</span>
<a name="l00966"></a>00966                   <span class="keywordflow">break</span>;
<a name="l00967"></a>00967 
<a name="l00968"></a>00968             <span class="keywordflow">default</span>:
<a name="l00969"></a>00969                   AssertMsg( FALSE, <a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>( <span class="stringliteral">"GetArmsDealerItemTypeFromItemNumber(), invalid class %d for item %d.  DF 0."</span>, <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ usItem ].usItemClass, usItem ) );
<a name="l00970"></a>00970                   <span class="keywordflow">break</span>;
<a name="l00971"></a>00971       }
<a name="l00972"></a>00972       <span class="keywordflow">return</span>( 0 );
<a name="l00973"></a>00973 }
<a name="l00974"></a>00974 
<a name="l00975"></a>00975 
<a name="l00976"></a>00976 
<a name="l00977"></a><a class="code" href="Arms_01Dealer_01Init_8h.html#2cd9afebbc87f9c3d1050e8d3ec914ab">00977</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#2cd9afebbc87f9c3d1050e8d3ec914ab">IsMercADealer</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubMercID )
<a name="l00978"></a>00978 {
<a name="l00979"></a>00979       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> cnt;
<a name="l00980"></a>00980 
<a name="l00981"></a>00981       <span class="comment">// Manny is not actually a valid dealer unless a particular event sets that fact</span>
<a name="l00982"></a>00982       <span class="keywordflow">if</span>( ( ubMercID == <a class="code" href="Soldier_01Profile_8h.html#acaa92dcb344e96138c964deae3e2fa1b678aa503cc3b74de91ca9429dfc1cff">MANNY</a> ) &amp;&amp; !<a class="code" href="Quests_8cpp.html#6744b59d27bf2791d0c2fefe18e548d3">CheckFact</a>( <a class="code" href="Quests_8h.html#aead3e57f613f07868a1b2afb6b943f1ee7210d263a543586d92b8cdc3c5b087">FACT_MANNY_IS_BARTENDER</a>, 0 ) )
<a name="l00983"></a>00983       {
<a name="l00984"></a>00984             <span class="keywordflow">return</span>( FALSE );
<a name="l00985"></a>00985       }
<a name="l00986"></a>00986 
<a name="l00987"></a>00987       <span class="comment">//loop through the list of arms dealers</span>
<a name="l00988"></a>00988       <span class="keywordflow">for</span>( cnt=0; cnt&lt;<a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc263581bcab1b191450fad78bf9d0a07e86">NUM_ARMS_DEALERS</a>; cnt++ )
<a name="l00989"></a>00989       {
<a name="l00990"></a>00990             <span class="keywordflow">if</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#230ecf6873ae948a09ae12f5b69c22e0">ArmsDealerInfo</a>[ cnt ].ubShopKeeperID == ubMercID )
<a name="l00991"></a>00991                   <span class="keywordflow">return</span>( TRUE );
<a name="l00992"></a>00992       }
<a name="l00993"></a>00993       <span class="keywordflow">return</span>( FALSE );
<a name="l00994"></a>00994 }
<a name="l00995"></a>00995 
<a name="l00996"></a>00996 
<a name="l00997"></a>00997 
<a name="l00998"></a><a class="code" href="Arms_01Dealer_01Init_8h.html#6038dfdede5a24e964d56fc20d5cc962">00998</a> <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#6038dfdede5a24e964d56fc20d5cc962">GetArmsDealerIDFromMercID</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubMercID )
<a name="l00999"></a>00999 {
<a name="l01000"></a>01000       <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>  cnt;
<a name="l01001"></a>01001 
<a name="l01002"></a>01002       <span class="comment">//loop through the list of arms dealers</span>
<a name="l01003"></a>01003       <span class="keywordflow">for</span>( cnt=0; cnt&lt;<a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc263581bcab1b191450fad78bf9d0a07e86">NUM_ARMS_DEALERS</a>; cnt++ )
<a name="l01004"></a>01004       {
<a name="l01005"></a>01005             <span class="keywordflow">if</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#230ecf6873ae948a09ae12f5b69c22e0">ArmsDealerInfo</a>[ cnt ].ubShopKeeperID == ubMercID )
<a name="l01006"></a>01006                   <span class="keywordflow">return</span>( cnt );
<a name="l01007"></a>01007       }
<a name="l01008"></a>01008 
<a name="l01009"></a>01009       <span class="keywordflow">return</span>( -1 );
<a name="l01010"></a>01010 }
<a name="l01011"></a>01011 
<a name="l01012"></a>01012 
<a name="l01013"></a>01013 
<a name="l01014"></a><a class="code" href="Arms_01Dealer_01Init_8h.html#4abccf042f29d20401147089a1f15010">01014</a> <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#4abccf042f29d20401147089a1f15010">GetTypeOfArmsDealer</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>    ubDealerID )
<a name="l01015"></a>01015 {
<a name="l01016"></a>01016       <span class="keywordflow">return</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#230ecf6873ae948a09ae12f5b69c22e0">ArmsDealerInfo</a>[ ubDealerID ].ubTypeOfArmsDealer );
<a name="l01017"></a>01017 }
<a name="l01018"></a>01018 
<a name="l01019"></a>01019 
<a name="l01020"></a><a class="code" href="Arms_01Dealer_01Init_8h.html#160b9cd6e425f5db5ac75fc6269d2f70">01020</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a>     <a class="code" href="Arms_01Dealer_01Init_8cpp.html#160b9cd6e425f5db5ac75fc6269d2f70">DoesDealerDoRepairs</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer )
<a name="l01021"></a>01021 {
<a name="l01022"></a>01022       <span class="keywordflow">if</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#230ecf6873ae948a09ae12f5b69c22e0">ArmsDealerInfo</a>[ ubArmsDealer ].ubTypeOfArmsDealer == <a class="code" href="Arms_01Dealer_01Init_8h.html#a53acfc1f86c3ba3efc58c4c0b7a8b0660294909c8977216b64281ee7a5c37b6">ARMS_DEALER_REPAIRS</a> )
<a name="l01023"></a>01023             <span class="keywordflow">return</span>( TRUE );
<a name="l01024"></a>01024       <span class="keywordflow">else</span>
<a name="l01025"></a>01025             <span class="keywordflow">return</span>( FALSE );
<a name="l01026"></a>01026 }
<a name="l01027"></a>01027 
<a name="l01028"></a>01028 
<a name="l01029"></a>01029 <span class="comment">/*</span>
<a name="l01030"></a>01030 <span class="comment">INT16 GetSpecialItemFromArmsDealerInventory( UINT8 ubArmsDealer, UINT16 usItemIndex, SPECIAL_ITEM_INFO *pSpclItemInfo )</span>
<a name="l01031"></a>01031 <span class="comment">{</span>
<a name="l01032"></a>01032 <span class="comment">      UINT8 ubElement;</span>
<a name="l01033"></a>01033 <span class="comment"></span>
<a name="l01034"></a>01034 <span class="comment">      // this function won't find perfect items!</span>
<a name="l01035"></a>01035 <span class="comment">      Assert( IsItemInfoSpecial( pSpclItemInfo ) );</span>
<a name="l01036"></a>01036 <span class="comment"></span>
<a name="l01037"></a>01037 <span class="comment">      for( ubElement = 0; ubElement &lt; gArmsDealersInventory[ ubArmsDealer ][ usItemIndex ].ubElementsAlloced; ubElement++ )</span>
<a name="l01038"></a>01038 <span class="comment">      {</span>
<a name="l01039"></a>01039 <span class="comment">            // if this is the one we're looking for</span>
<a name="l01040"></a>01040 <span class="comment">            if( memcmp( &amp;(gArmsDealersInventory[ ubArmsDealer ][ usItemIndex ].SpecialItem[ ubElement ].Info), pSpclItemInfo, sizeof( SPECIAL_ITEM_INFO ) ) == 0 )</span>
<a name="l01041"></a>01041 <span class="comment">            {</span>
<a name="l01042"></a>01042 <span class="comment">                  return( ubElement );</span>
<a name="l01043"></a>01043 <span class="comment">            }</span>
<a name="l01044"></a>01044 <span class="comment">      }</span>
<a name="l01045"></a>01045 <span class="comment"></span>
<a name="l01046"></a>01046 <span class="comment">      // not found!</span>
<a name="l01047"></a>01047 <span class="comment">      return( -1 );</span>
<a name="l01048"></a>01048 <span class="comment">}</span>
<a name="l01049"></a>01049 <span class="comment">*/</span>
<a name="l01050"></a>01050 
<a name="l01051"></a>01051 
<a name="l01052"></a><a class="code" href="Arms_01Dealer_01Init_8h.html#716ef93060fbfe55964399f2303bcf8e">01052</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#716ef93060fbfe55964399f2303bcf8e">RepairmanIsFixingItemsButNoneAreDoneYet</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubProfileID )
<a name="l01053"></a>01053 {
<a name="l01054"></a>01054       <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>        bArmsDealer;
<a name="l01055"></a>01055       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fHaveOnlyUnRepairedItems=FALSE;
<a name="l01056"></a>01056       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>       ubElement;
<a name="l01057"></a>01057       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>      usItemIndex;
<a name="l01058"></a>01058 
<a name="l01059"></a>01059 
<a name="l01060"></a>01060       bArmsDealer = <a class="code" href="Arms_01Dealer_01Init_8cpp.html#6038dfdede5a24e964d56fc20d5cc962">GetArmsDealerIDFromMercID</a>( ubProfileID );
<a name="l01061"></a>01061       <span class="keywordflow">if</span>( bArmsDealer == -1 )
<a name="l01062"></a>01062             <span class="keywordflow">return</span>( FALSE );
<a name="l01063"></a>01063 
<a name="l01064"></a>01064       <span class="comment">//if the dealer is not a repair dealer, return</span>
<a name="l01065"></a>01065       <span class="keywordflow">if</span>( !<a class="code" href="Arms_01Dealer_01Init_8cpp.html#160b9cd6e425f5db5ac75fc6269d2f70">DoesDealerDoRepairs</a>( bArmsDealer ) )
<a name="l01066"></a>01066             <span class="keywordflow">return</span>( FALSE );
<a name="l01067"></a>01067 
<a name="l01068"></a>01068       <span class="comment">//loop through the dealers inventory and check if there are only unrepaired items</span>
<a name="l01069"></a>01069       <span class="keywordflow">for</span>( usItemIndex = 1; usItemIndex &lt; <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f40efaf5227d3f780f8db037c71e3f903f">MAXITEMS</a>; usItemIndex++ )
<a name="l01070"></a>01070       {
<a name="l01071"></a>01071             <span class="keywordflow">if</span> ( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usItemIndex].usItemClass  == 0 )
<a name="l01072"></a>01072                   <span class="keywordflow">break</span>;
<a name="l01073"></a>01073             <span class="comment">//if there is some items in stock</span>
<a name="l01074"></a>01074             <span class="keywordflow">if</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ bArmsDealer ][ usItemIndex ].ubTotalItems )
<a name="l01075"></a>01075             {
<a name="l01076"></a>01076                   <span class="comment">//loop through the array of items</span>
<a name="l01077"></a>01077                   <span class="keywordflow">for</span>( ubElement=0; ubElement&lt; <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ bArmsDealer ][ usItemIndex ].<a class="code" href="structDEALER__ITEM__HEADER.html#26a9a14e537aa677de5829a0e6eb4171">ubElementsAlloced</a>; ubElement++ )
<a name="l01078"></a>01078                   {
<a name="l01079"></a>01079                         <span class="keywordflow">if</span> ( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ bArmsDealer ][ usItemIndex ].SpecialItem[ ubElement ].fActive )
<a name="l01080"></a>01080                         {
<a name="l01081"></a>01081                               <span class="comment">//if the items status is below 0, the item is being repaired</span>
<a name="l01082"></a>01082                               <span class="keywordflow">if</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ bArmsDealer ][ usItemIndex ].SpecialItem[ ubElement ].Info.bItemCondition &lt; 0 )
<a name="l01083"></a>01083                               {
<a name="l01084"></a>01084                                     <span class="comment">//if the item has been repaired</span>
<a name="l01085"></a>01085                                     <span class="keywordflow">if</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ bArmsDealer ][ usItemIndex ].<a class="code" href="structDEALER__ITEM__HEADER.html#bfdb0e8735b1864b79c158d6e65412ef">SpecialItem</a>[ ubElement ].<a class="code" href="structDEALER__SPECIAL__ITEM.html#f253fcbc3cf87461c26529265734ea44">uiRepairDoneTime</a> &lt;= <a class="code" href="Game_01Clock_8cpp.html#4d255e800fba4d64144a7639d5f3421d">GetWorldTotalMin</a>() )
<a name="l01086"></a>01086                                     {
<a name="l01087"></a>01087                                           <span class="comment">//A repair item is ready, therefore, return false</span>
<a name="l01088"></a>01088                                           <span class="keywordflow">return</span>( FALSE );
<a name="l01089"></a>01089                                     }
<a name="l01090"></a>01090                                     <span class="keywordflow">else</span>
<a name="l01091"></a>01091                                     {
<a name="l01092"></a>01092                                           fHaveOnlyUnRepairedItems = TRUE;
<a name="l01093"></a>01093                                     }
<a name="l01094"></a>01094                               }
<a name="l01095"></a>01095                         }
<a name="l01096"></a>01096                   }
<a name="l01097"></a>01097             }
<a name="l01098"></a>01098       }
<a name="l01099"></a>01099 
<a name="l01100"></a>01100       <span class="keywordflow">return</span>( fHaveOnlyUnRepairedItems );
<a name="l01101"></a>01101 }
<a name="l01102"></a>01102 
<a name="l01103"></a>01103 
<a name="l01104"></a><a class="code" href="Arms_01Dealer_01Init_8h.html#e4f2a9d02f86c6ae7c54aef2c833ab0f">01104</a> <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#e4f2a9d02f86c6ae7c54aef2c833ab0f">GetTimeToFixItemBeingRepaired</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usItemIndex, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubElement )
<a name="l01105"></a>01105 {
<a name="l01106"></a>01106       <span class="comment">//dealer must be a repair dealer</span>
<a name="l01107"></a>01107       Assert( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#160b9cd6e425f5db5ac75fc6269d2f70">DoesDealerDoRepairs</a>( ubArmsDealer ) );
<a name="l01108"></a>01108       <span class="comment">// element index must be valid</span>
<a name="l01109"></a>01109       Assert( ubElement &lt; <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].ubElementsAlloced );
<a name="l01110"></a>01110       <span class="comment">// that item must be active</span>
<a name="l01111"></a>01111       Assert( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].SpecialItem[ ubElement ].fActive );
<a name="l01112"></a>01112       <span class="comment">// that item must be in repair</span>
<a name="l01113"></a>01113       Assert( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].SpecialItem[ ubElement ].Info.bItemCondition &lt; 0 );
<a name="l01114"></a>01114 
<a name="l01115"></a>01115       <span class="comment">//if the item has already been repaired</span>
<a name="l01116"></a>01116       <span class="keywordflow">if</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].SpecialItem[ ubElement ].uiRepairDoneTime &lt;= <a class="code" href="Game_01Clock_8cpp.html#4d255e800fba4d64144a7639d5f3421d">GetWorldTotalMin</a>() )
<a name="l01117"></a>01117             <span class="keywordflow">return</span>( 0 );
<a name="l01118"></a>01118 
<a name="l01119"></a>01119       <span class="comment">//Return how many more minutes it will take to fix the item</span>
<a name="l01120"></a>01120       <span class="keywordflow">return</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].SpecialItem[ ubElement ].uiRepairDoneTime - <a class="code" href="Game_01Clock_8cpp.html#4d255e800fba4d64144a7639d5f3421d">GetWorldTotalMin</a>() );
<a name="l01121"></a>01121 }
<a name="l01122"></a>01122 
<a name="l01123"></a>01123 
<a name="l01124"></a><a class="code" href="Arms_01Dealer_01Init_8h.html#8ce74faa7791774f2a1276a41e140daf">01124</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#8ce74faa7791774f2a1276a41e140daf">CanDealerTransactItem</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usItemIndex, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fPurchaseFromPlayer )
<a name="l01125"></a>01125 {
<a name="l01126"></a>01126       <span class="keywordflow">switch</span> ( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#230ecf6873ae948a09ae12f5b69c22e0">ArmsDealerInfo</a>[ ubArmsDealer ].ubTypeOfArmsDealer )
<a name="l01127"></a>01127       {
<a name="l01128"></a>01128             <span class="keywordflow">case</span> <a class="code" href="Arms_01Dealer_01Init_8h.html#a53acfc1f86c3ba3efc58c4c0b7a8b06dbc52cc2cbf69932510155b9768621a2">ARMS_DEALER_SELLS_ONLY</a>:
<a name="l01129"></a>01129                   <span class="keywordflow">if</span> ( fPurchaseFromPlayer )
<a name="l01130"></a>01130                   {
<a name="l01131"></a>01131                         <span class="comment">// this dealer only sells stuff to player, so he can't buy anything from him</span>
<a name="l01132"></a>01132                         <span class="keywordflow">return</span>( FALSE );
<a name="l01133"></a>01133                   }
<a name="l01134"></a>01134                   <span class="keywordflow">break</span>;
<a name="l01135"></a>01135 
<a name="l01136"></a>01136             <span class="keywordflow">case</span> <a class="code" href="Arms_01Dealer_01Init_8h.html#a53acfc1f86c3ba3efc58c4c0b7a8b0618b0a0d047f3ae9e91f1915e5905eb05">ARMS_DEALER_BUYS_ONLY</a>:
<a name="l01137"></a>01137                   <span class="keywordflow">if</span> ( !fPurchaseFromPlayer )
<a name="l01138"></a>01138                   {
<a name="l01139"></a>01139                         <span class="comment">// this dealer only buys stuff from player, so he can't sell anything to him</span>
<a name="l01140"></a>01140                         <span class="keywordflow">return</span>( FALSE );
<a name="l01141"></a>01141                   }
<a name="l01142"></a>01142                   <span class="keywordflow">break</span>;
<a name="l01143"></a>01143 
<a name="l01144"></a>01144             <span class="keywordflow">case</span> <a class="code" href="Arms_01Dealer_01Init_8h.html#a53acfc1f86c3ba3efc58c4c0b7a8b06eade7933dd7641117a2fc26b1b0dd061">ARMS_DEALER_BUYS_SELLS</a>:
<a name="l01145"></a>01145                   <span class="keywordflow">switch</span> ( ubArmsDealer )
<a name="l01146"></a>01146                   {
<a name="l01147"></a>01147                         <span class="keywordflow">case</span> <a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc26193bcc1758ce5a4f097271ef36cfffba">ARMS_DEALER_JAKE</a>:
<a name="l01148"></a>01148                         <span class="keywordflow">case</span> <a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc26111ab63611a206b04416d64f43b03fe0">ARMS_DEALER_KEITH</a>:
<a name="l01149"></a>01149                         <span class="keywordflow">case</span> <a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc264db5b4ca17b51b96660f6c5d61a20b62">ARMS_DEALER_FRANZ</a>:
<a name="l01150"></a>01150                               <span class="keywordflow">if</span> ( fPurchaseFromPlayer )
<a name="l01151"></a>01151                               {
<a name="l01152"></a>01152                                     <span class="comment">// these guys will buy nearly anything from the player, regardless of what they carry for sale!</span>
<a name="l01153"></a>01153                                     <span class="keywordflow">return</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#0af7fa35d43c03ed62399c88fa427158">CalcValueOfItemToDealer</a>( ubArmsDealer, usItemIndex, FALSE ) &gt; 0 );
<a name="l01154"></a>01154                               }
<a name="l01155"></a>01155                               <span class="comment">//else selling inventory uses their inventory list</span>
<a name="l01156"></a>01156                               <span class="keywordflow">break</span>;
<a name="l01157"></a>01157 
<a name="l01158"></a>01158                         <span class="keywordflow">default</span>:
<a name="l01159"></a>01159                               <span class="comment">// the others go by their inventory list</span>
<a name="l01160"></a>01160                               <span class="keywordflow">break</span>;
<a name="l01161"></a>01161                   }
<a name="l01162"></a>01162                   <span class="keywordflow">break</span>;
<a name="l01163"></a>01163 
<a name="l01164"></a>01164             <span class="keywordflow">case</span> <a class="code" href="Arms_01Dealer_01Init_8h.html#a53acfc1f86c3ba3efc58c4c0b7a8b0660294909c8977216b64281ee7a5c37b6">ARMS_DEALER_REPAIRS</a>:
<a name="l01165"></a>01165                   <span class="comment">// repairmen don't have a complete list of what they'll repair in their inventory,</span>
<a name="l01166"></a>01166                   <span class="comment">// so we must check the item's properties instead.</span>
<a name="l01167"></a>01167                   <span class="keywordflow">return</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#4f53de9538c252842e64e6eac9b1326d">CanDealerRepairItem</a>( ubArmsDealer, usItemIndex ) );
<a name="l01168"></a>01168 
<a name="l01169"></a>01169             <span class="keywordflow">default</span>:
<a name="l01170"></a>01170                   AssertMsg( FALSE, <a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>( <span class="stringliteral">"CanDealerTransactItem(), type of dealer %d.  AM 0."</span>, <a class="code" href="Arms_01Dealer_01Init_8cpp.html#230ecf6873ae948a09ae12f5b69c22e0">ArmsDealerInfo</a>[ ubArmsDealer ].ubTypeOfArmsDealer ) );
<a name="l01171"></a>01171                   <span class="keywordflow">return</span>(FALSE);
<a name="l01172"></a>01172       }
<a name="l01173"></a>01173 
<a name="l01174"></a>01174       <span class="keywordflow">return</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#94141d72a212e3ef2f176d7fe84bcb31">DoesItemAppearInDealerInventoryList</a>( ubArmsDealer, usItemIndex, fPurchaseFromPlayer ) );
<a name="l01175"></a>01175 }
<a name="l01176"></a>01176 
<a name="l01177"></a>01177 
<a name="l01178"></a><a class="code" href="Arms_01Dealer_01Init_8h.html#4f53de9538c252842e64e6eac9b1326d">01178</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#4f53de9538c252842e64e6eac9b1326d">CanDealerRepairItem</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usItemIndex )
<a name="l01179"></a>01179 {
<a name="l01180"></a>01180 <span class="comment">//    UINT32 uiFlags;</span>
<a name="l01181"></a>01181 
<a name="l01182"></a>01182 <span class="comment">//    uiFlags = Item[ usItemIndex ].fFlags;</span>
<a name="l01183"></a>01183 
<a name="l01184"></a>01184       <span class="comment">// can't repair anything that's not repairable!</span>
<a name="l01185"></a>01185 <span class="comment">//    if ( !( uiFlags &amp; ITEM_REPAIRABLE ) )</span>
<a name="l01186"></a>01186       <span class="keywordflow">if</span> ( !( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ usItemIndex ].repairable  ) )
<a name="l01187"></a>01187       {
<a name="l01188"></a>01188             <span class="keywordflow">return</span>(FALSE);
<a name="l01189"></a>01189       }
<a name="l01190"></a>01190 
<a name="l01191"></a>01191       <span class="keywordflow">switch</span> ( ubArmsDealer )
<a name="l01192"></a>01192       {
<a name="l01193"></a>01193             <span class="keywordflow">case</span> <a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc268f51c71a65830127c801f52a8a48a907">ARMS_DEALER_ARNIE</a>:
<a name="l01194"></a>01194             <span class="keywordflow">case</span> <a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc26beca6f2eaa6e04da384ed35299eed6c6">ARMS_DEALER_PERKO</a>:
<a name="l01195"></a>01195                   <span class="comment">// repairs ANYTHING non-electronic</span>
<a name="l01196"></a>01196 <span class="comment">//                if ( !( uiFlags &amp; ITEM_ELECTRONIC ) )</span>
<a name="l01197"></a>01197                   <span class="keywordflow">if</span> ( !( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ usItemIndex ].electronic ) )
<a name="l01198"></a>01198                   {
<a name="l01199"></a>01199                         <span class="keywordflow">return</span>(TRUE);
<a name="l01200"></a>01200                   }
<a name="l01201"></a>01201                   <span class="keywordflow">break</span>;
<a name="l01202"></a>01202 
<a name="l01203"></a>01203             <span class="keywordflow">case</span> <a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc265c995026b7aa1751a756e7fa9bc66cf7">ARMS_DEALER_FREDO</a>:
<a name="l01204"></a>01204                   <span class="comment">// repairs ONLY electronics</span>
<a name="l01205"></a>01205 <span class="comment">//                if ( uiFlags &amp; ITEM_ELECTRONIC )</span>
<a name="l01206"></a>01206                   <span class="keywordflow">if</span> ( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ usItemIndex ].electronic  )
<a name="l01207"></a>01207                   {
<a name="l01208"></a>01208                         <span class="keywordflow">return</span>(TRUE);
<a name="l01209"></a>01209                   }
<a name="l01210"></a>01210                   <span class="keywordflow">break</span>;
<a name="l01211"></a>01211 
<a name="l01212"></a>01212             <span class="keywordflow">default</span>:
<a name="l01213"></a>01213                   AssertMsg( FALSE, <a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>( <span class="stringliteral">"CanDealerRepairItem(), Arms Dealer %d is not a recognized repairman!.  AM 1."</span>, ubArmsDealer ) );
<a name="l01214"></a>01214       }
<a name="l01215"></a>01215 
<a name="l01216"></a>01216       <span class="comment">// can't repair this...</span>
<a name="l01217"></a>01217       <span class="keywordflow">return</span>(FALSE);
<a name="l01218"></a>01218 }
<a name="l01219"></a>01219 
<a name="l01220"></a>01220 
<a name="l01221"></a><a class="code" href="Arms_01Dealer_01Init_8cpp.html#5b455b495d2c965f53bf107893c5fde3">01221</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#5b455b495d2c965f53bf107893c5fde3">AllocMemsetSpecialItemArray</a>( <a class="code" href="structDEALER__ITEM__HEADER.html">DEALER_ITEM_HEADER</a> *pDealerItem, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubElementsNeeded )
<a name="l01222"></a>01222 {
<a name="l01223"></a>01223       Assert(pDealerItem);
<a name="l01224"></a>01224       Assert( ubElementsNeeded &gt; 0);
<a name="l01225"></a>01225 
<a name="l01226"></a>01226       pDealerItem-&gt;<a class="code" href="structDEALER__ITEM__HEADER.html#bfdb0e8735b1864b79c158d6e65412ef">SpecialItem</a> = (<a class="code" href="structDEALER__SPECIAL__ITEM.html">DEALER_SPECIAL_ITEM</a> *) MemAlloc( <span class="keyword">sizeof</span>( <a class="code" href="structDEALER__SPECIAL__ITEM.html">DEALER_SPECIAL_ITEM</a> ) * ubElementsNeeded );
<a name="l01227"></a>01227       <span class="keywordflow">if</span>( pDealerItem-&gt;<a class="code" href="structDEALER__ITEM__HEADER.html#bfdb0e8735b1864b79c158d6e65412ef">SpecialItem</a> == NULL )
<a name="l01228"></a>01228       {
<a name="l01229"></a>01229             Assert( 0 );
<a name="l01230"></a>01230             <span class="keywordflow">return</span>(FALSE);
<a name="l01231"></a>01231       }
<a name="l01232"></a>01232 
<a name="l01233"></a>01233       <span class="comment">// zero them out (they're inactive until an item is actually added)</span>
<a name="l01234"></a>01234       memset( pDealerItem-&gt;<a class="code" href="structDEALER__ITEM__HEADER.html#bfdb0e8735b1864b79c158d6e65412ef">SpecialItem</a>, 0, <span class="keyword">sizeof</span>( DEALER_SPECIAL_ITEM ) * ubElementsNeeded );
<a name="l01235"></a>01235 
<a name="l01236"></a>01236       pDealerItem-&gt;<a class="code" href="structDEALER__ITEM__HEADER.html#26a9a14e537aa677de5829a0e6eb4171">ubElementsAlloced</a> = ubElementsNeeded;
<a name="l01237"></a>01237 
<a name="l01238"></a>01238       <span class="keywordflow">return</span>(TRUE);
<a name="l01239"></a>01239 }
<a name="l01240"></a>01240 
<a name="l01241"></a>01241 
<a name="l01242"></a><a class="code" href="Arms_01Dealer_01Init_8cpp.html#ff5263f30d648f749ea192e5a9a7dd56">01242</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#ff5263f30d648f749ea192e5a9a7dd56">ResizeSpecialItemArray</a>( <a class="code" href="structDEALER__ITEM__HEADER.html">DEALER_ITEM_HEADER</a> *pDealerItem, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubElementsNeeded )
<a name="l01243"></a>01243 {
<a name="l01244"></a>01244       Assert(pDealerItem);
<a name="l01245"></a>01245       <span class="comment">// must already have a ptr allocated!</span>
<a name="l01246"></a>01246       Assert(pDealerItem-&gt;<a class="code" href="structDEALER__ITEM__HEADER.html#bfdb0e8735b1864b79c158d6e65412ef">SpecialItem</a>);
<a name="l01247"></a>01247 
<a name="l01248"></a>01248       
<a name="l01249"></a>01249       <span class="keywordflow">if</span> ( ubElementsNeeded == pDealerItem-&gt;<a class="code" href="structDEALER__ITEM__HEADER.html#26a9a14e537aa677de5829a0e6eb4171">ubElementsAlloced</a>)
<a name="l01250"></a>01250       {
<a name="l01251"></a>01251             <span class="comment">// shouldn't have been called, but what they hey, it's not exactly a problem</span>
<a name="l01252"></a>01252             <span class="keywordflow">return</span>(TRUE);
<a name="l01253"></a>01253       }
<a name="l01254"></a>01254 
<a name="l01255"></a>01255       <span class="comment">// already allocated, but change its size</span>
<a name="l01256"></a>01256       pDealerItem-&gt;<a class="code" href="structDEALER__ITEM__HEADER.html#bfdb0e8735b1864b79c158d6e65412ef">SpecialItem</a> = (<a class="code" href="structDEALER__SPECIAL__ITEM.html">DEALER_SPECIAL_ITEM</a> *) MemRealloc( pDealerItem-&gt;<a class="code" href="structDEALER__ITEM__HEADER.html#bfdb0e8735b1864b79c158d6e65412ef">SpecialItem</a>, <span class="keyword">sizeof</span>( <a class="code" href="structDEALER__SPECIAL__ITEM.html">DEALER_SPECIAL_ITEM</a> ) * ubElementsNeeded );
<a name="l01257"></a>01257       <span class="keywordflow">if</span>( pDealerItem-&gt;<a class="code" href="structDEALER__ITEM__HEADER.html#bfdb0e8735b1864b79c158d6e65412ef">SpecialItem</a> == NULL )
<a name="l01258"></a>01258       {
<a name="l01259"></a>01259             Assert( 0 );
<a name="l01260"></a>01260             <span class="keywordflow">return</span>(FALSE);
<a name="l01261"></a>01261       }
<a name="l01262"></a>01262 
<a name="l01263"></a>01263       <span class="comment">// if adding more elements</span>
<a name="l01264"></a>01264       <span class="keywordflow">if</span> ( ubElementsNeeded &gt; pDealerItem-&gt;<a class="code" href="structDEALER__ITEM__HEADER.html#26a9a14e537aa677de5829a0e6eb4171">ubElementsAlloced</a>)
<a name="l01265"></a>01265       {
<a name="l01266"></a>01266             <span class="comment">// zero them out (they're inactive until an item is actually added)</span>
<a name="l01267"></a>01267             memset( &amp;(pDealerItem-&gt;<a class="code" href="structDEALER__ITEM__HEADER.html#bfdb0e8735b1864b79c158d6e65412ef">SpecialItem</a>[pDealerItem-&gt;<a class="code" href="structDEALER__ITEM__HEADER.html#26a9a14e537aa677de5829a0e6eb4171">ubElementsAlloced</a>]), 0, <span class="keyword">sizeof</span>( DEALER_SPECIAL_ITEM ) * ( ubElementsNeeded - pDealerItem-&gt;<a class="code" href="structDEALER__ITEM__HEADER.html#26a9a14e537aa677de5829a0e6eb4171">ubElementsAlloced</a>) );
<a name="l01268"></a>01268       }
<a name="l01269"></a>01269 
<a name="l01270"></a>01270       pDealerItem-&gt;<a class="code" href="structDEALER__ITEM__HEADER.html#26a9a14e537aa677de5829a0e6eb4171">ubElementsAlloced</a> = ubElementsNeeded;
<a name="l01271"></a>01271 
<a name="l01272"></a>01272       <span class="keywordflow">return</span>(TRUE);
<a name="l01273"></a>01273 }
<a name="l01274"></a>01274 
<a name="l01275"></a>01275 
<a name="l01276"></a><a class="code" href="Arms_01Dealer_01Init_8cpp.html#99b7de7235e1411faa3c0702f649fa0a">01276</a> <span class="keywordtype">void</span> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#99b7de7235e1411faa3c0702f649fa0a">FreeSpecialItemArray</a>( <a class="code" href="structDEALER__ITEM__HEADER.html">DEALER_ITEM_HEADER</a> *pDealerItem)
<a name="l01277"></a>01277 {
<a name="l01278"></a>01278       Assert(pDealerItem);
<a name="l01279"></a>01279       <span class="comment">// must already have a ptr allocated!</span>
<a name="l01280"></a>01280       Assert(pDealerItem-&gt;<a class="code" href="structDEALER__ITEM__HEADER.html#bfdb0e8735b1864b79c158d6e65412ef">SpecialItem</a>);
<a name="l01281"></a>01281 
<a name="l01282"></a>01282       MemFree( pDealerItem-&gt;<a class="code" href="structDEALER__ITEM__HEADER.html#bfdb0e8735b1864b79c158d6e65412ef">SpecialItem</a> );
<a name="l01283"></a>01283       pDealerItem-&gt;<a class="code" href="structDEALER__ITEM__HEADER.html#bfdb0e8735b1864b79c158d6e65412ef">SpecialItem</a> = NULL;
<a name="l01284"></a>01284 
<a name="l01285"></a>01285       pDealerItem-&gt;<a class="code" href="structDEALER__ITEM__HEADER.html#26a9a14e537aa677de5829a0e6eb4171">ubElementsAlloced</a> = 0;
<a name="l01286"></a>01286       pDealerItem-&gt;<a class="code" href="structDEALER__ITEM__HEADER.html#f4e90d47661b87353a9076c5e53cd453">ubTotalItems</a> = pDealerItem-&gt;<a class="code" href="structDEALER__ITEM__HEADER.html#02f751b0130183b055b9012df527b1d8">ubPerfectItems</a>;
<a name="l01287"></a>01287 
<a name="l01288"></a>01288       <span class="comment">// doesn't effect perfect items, orders or stray bullets!</span>
<a name="l01289"></a>01289 }
<a name="l01290"></a>01290 
<a name="l01291"></a>01291 
<a name="l01292"></a>01292 
<a name="l01293"></a><a class="code" href="Arms_01Dealer_01Init_8cpp.html#b4ad9adfcf547f74c00bca868388cd37">01293</a> <span class="keywordtype">void</span> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#b4ad9adfcf547f74c00bca868388cd37">ArmsDealerGetsFreshStock</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usItemIndex, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubNumItems )
<a name="l01294"></a>01294 {
<a name="l01295"></a>01295       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubCnt;
<a name="l01296"></a>01296       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubItemCondition;
<a name="l01297"></a>01297       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubPerfectOnes = 0;
<a name="l01298"></a>01298       <a class="code" href="structSPECIAL__ITEM__INFO.html">SPECIAL_ITEM_INFO</a> SpclItemInfo;
<a name="l01299"></a>01299 
<a name="l01300"></a>01300       <span class="comment">// create item info describing a perfect item</span>
<a name="l01301"></a>01301       <a class="code" href="Arms_01Dealer_01Init_8cpp.html#b4a1eb863f49bc02f992d8874ff97777">SetSpecialItemInfoToDefaults</a>( &amp;SpclItemInfo );
<a name="l01302"></a>01302 
<a name="l01303"></a>01303 
<a name="l01304"></a>01304       <span class="comment">// determine the condition of each one, counting up new ones, but adding damaged ones right away</span>
<a name="l01305"></a>01305       <span class="keywordflow">for</span> ( ubCnt = 0; ubCnt &lt; ubNumItems; ubCnt++ )
<a name="l01306"></a>01306       {
<a name="l01307"></a>01307             ubItemCondition = <a class="code" href="Arms_01Dealer_01Init_8cpp.html#ebacdf7da42ad4183e9347b9680efa50">DetermineDealerItemCondition</a>( ubArmsDealer, usItemIndex);
<a name="l01308"></a>01308 
<a name="l01309"></a>01309             <span class="comment">// if the item is brand new</span>
<a name="l01310"></a>01310             <span class="keywordflow">if</span> ( ubItemCondition == 100)
<a name="l01311"></a>01311             {
<a name="l01312"></a>01312                   ubPerfectOnes++;
<a name="l01313"></a>01313             }
<a name="l01314"></a>01314             <span class="keywordflow">else</span>
<a name="l01315"></a>01315             {
<a name="l01316"></a>01316                   <span class="comment">// add a used item with that condition to his inventory</span>
<a name="l01317"></a>01317                   SpclItemInfo.<a class="code" href="structSPECIAL__ITEM__INFO.html#a63af49b3ae129222cab2d4de0b44b8a">bItemCondition</a> = (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>) ubItemCondition;
<a name="l01318"></a>01318                   <a class="code" href="Arms_01Dealer_01Init_8cpp.html#0da9a30648c5360e44cac7e2461ea3bb">AddItemToArmsDealerInventory</a>( ubArmsDealer, usItemIndex, &amp;SpclItemInfo, 1 );
<a name="l01319"></a>01319             }
<a name="l01320"></a>01320       }
<a name="l01321"></a>01321 
<a name="l01322"></a>01322       <span class="comment">// now add all the perfect ones, in one shot</span>
<a name="l01323"></a>01323       <span class="keywordflow">if</span> ( ubPerfectOnes &gt; 0)
<a name="l01324"></a>01324       {
<a name="l01325"></a>01325             SpclItemInfo.<a class="code" href="structSPECIAL__ITEM__INFO.html#a63af49b3ae129222cab2d4de0b44b8a">bItemCondition</a> = 100;
<a name="l01326"></a>01326             <a class="code" href="Arms_01Dealer_01Init_8cpp.html#0da9a30648c5360e44cac7e2461ea3bb">AddItemToArmsDealerInventory</a>( ubArmsDealer, usItemIndex, &amp;SpclItemInfo, ubPerfectOnes );
<a name="l01327"></a>01327       }
<a name="l01328"></a>01328 }
<a name="l01329"></a>01329 
<a name="l01330"></a>01330 
<a name="l01331"></a>01331 
<a name="l01332"></a><a class="code" href="Arms_01Dealer_01Init_8cpp.html#ebacdf7da42ad4183e9347b9680efa50">01332</a> <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#ebacdf7da42ad4183e9347b9680efa50">DetermineDealerItemCondition</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usItemIndex )
<a name="l01333"></a>01333 {
<a name="l01334"></a>01334       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubCondition = 100;
<a name="l01335"></a>01335 
<a name="l01336"></a>01336       <span class="comment">// if it's a damagable item, and not a liquid (those are always sold full)</span>
<a name="l01337"></a>01337 <span class="comment">//    if ( ( Item[ usItemIndex ].fFlags &amp; ITEM_DAMAGEABLE ) &amp;&amp; !ItemContainsLiquid( usItemIndex ) )</span>
<a name="l01338"></a>01338       <span class="keywordflow">if</span> ( ( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ usItemIndex ].damageable ) &amp;&amp; !<a class="code" href="Arms_01Dealer_01Init_8cpp.html#0432d6e6217897f6122ade9ca9fcdd28">ItemContainsLiquid</a>( usItemIndex ) )
<a name="l01339"></a>01339       {
<a name="l01340"></a>01340             <span class="comment">// if he ONLY has used items, or 50% of the time if he carries both used &amp; new items</span>
<a name="l01341"></a>01341             <span class="keywordflow">if</span> ( ( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#230ecf6873ae948a09ae12f5b69c22e0">ArmsDealerInfo</a>[ ubArmsDealer ].uiFlags &amp; ARMS_DEALER_ONLY_USED_ITEMS ) ||
<a name="l01342"></a>01342                    ( ( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#230ecf6873ae948a09ae12f5b69c22e0">ArmsDealerInfo</a>[ ubArmsDealer ].uiFlags &amp; ARMS_DEALER_SOME_USED_ITEMS ) &amp;&amp; ( <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 100 ) &lt; 50 ) ) )
<a name="l01343"></a>01343             {
<a name="l01344"></a>01344                   <span class="comment">// make the item a used one</span>
<a name="l01345"></a>01345                   ubCondition = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>)(20 + <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 60 ));
<a name="l01346"></a>01346             }
<a name="l01347"></a>01347       }
<a name="l01348"></a>01348 
<a name="l01349"></a>01349       <span class="keywordflow">return</span>( ubCondition);
<a name="l01350"></a>01350 }
<a name="l01351"></a>01351 
<a name="l01352"></a>01352 
<a name="l01353"></a>01353 
<a name="l01354"></a><a class="code" href="Arms_01Dealer_01Init_8cpp.html#0432d6e6217897f6122ade9ca9fcdd28">01354</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#0432d6e6217897f6122ade9ca9fcdd28">ItemContainsLiquid</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usItemIndex )
<a name="l01355"></a>01355 {
<a name="l01356"></a>01356       <span class="keywordflow">if</span>(<a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usItemIndex].containsliquid)
<a name="l01357"></a>01357             <span class="keywordflow">return</span> TRUE;
<a name="l01358"></a>01358       <span class="keywordflow">else</span>
<a name="l01359"></a>01359             <span class="keywordflow">return</span> FALSE;
<a name="l01360"></a>01360 
<a name="l01361"></a>01361       <span class="comment">//switch ( usItemIndex )</span>
<a name="l01362"></a>01362       <span class="comment">//{</span>
<a name="l01363"></a>01363       <span class="comment">//    case CANTEEN:</span>
<a name="l01364"></a>01364       <span class="comment">//    case BEER:</span>
<a name="l01365"></a>01365       <span class="comment">//    case ALCOHOL:</span>
<a name="l01366"></a>01366       <span class="comment">//    case JAR_HUMAN_BLOOD:</span>
<a name="l01367"></a>01367       <span class="comment">//    case JAR_CREATURE_BLOOD:</span>
<a name="l01368"></a>01368       <span class="comment">//    case JAR_QUEEN_CREATURE_BLOOD:</span>
<a name="l01369"></a>01369       <span class="comment">//    case JAR_ELIXIR:</span>
<a name="l01370"></a>01370       <span class="comment">//    case GAS_CAN:</span>
<a name="l01371"></a>01371       <span class="comment">//          return( TRUE );</span>
<a name="l01372"></a>01372       <span class="comment">//}</span>
<a name="l01373"></a>01373 
<a name="l01374"></a>01374       <span class="comment">//return( FALSE );</span>
<a name="l01375"></a>01375 }
<a name="l01376"></a>01376 
<a name="l01377"></a>01377 
<a name="l01378"></a>01378 <span class="comment">/*</span>
<a name="l01379"></a>01379 <span class="comment">UINT32 CountTotalItemsInArmsDealersInventory( UINT8 ubArmsDealer )</span>
<a name="l01380"></a>01380 <span class="comment">{</span>
<a name="l01381"></a>01381 <span class="comment">      UINT32      uiNumOfItems=0;</span>
<a name="l01382"></a>01382 <span class="comment">      UINT16      usItemIndex;</span>
<a name="l01383"></a>01383 <span class="comment"></span>
<a name="l01384"></a>01384 <span class="comment">      //loop through all the items in this dealer's inventory</span>
<a name="l01385"></a>01385 <span class="comment">      for( usItemIndex = 1; usItemIndex &lt; MAXITEMS; usItemIndex++ )</span>
<a name="l01386"></a>01386 <span class="comment">      {</span>
<a name="l01387"></a>01387 <span class="comment">            // This counts each pack of ammo or stacked item as one.  See the "distinct" version of this for an alternate version</span>
<a name="l01388"></a>01388 <span class="comment">            uiNumOfItems += gArmsDealersInventory[ ubArmsDealer ][ usItemIndex ].ubTotalItems;</span>
<a name="l01389"></a>01389 <span class="comment">      }</span>
<a name="l01390"></a>01390 <span class="comment"></span>
<a name="l01391"></a>01391 <span class="comment">      return( uiNumOfItems );</span>
<a name="l01392"></a>01392 <span class="comment">}</span>
<a name="l01393"></a>01393 <span class="comment">*/</span>
<a name="l01394"></a>01394 
<a name="l01395"></a>01395 
<a name="l01396"></a><a class="code" href="Arms_01Dealer_01Init_8h.html#fb00fc990c19684966bd66afa6662076">01396</a> <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#fb00fc990c19684966bd66afa6662076">CountDistinctItemsInArmsDealersInventory</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer )
<a name="l01397"></a>01397 {
<a name="l01398"></a>01398       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>      uiNumOfItems=0;
<a name="l01399"></a>01399       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>      usItemIndex;
<a name="l01400"></a>01400 
<a name="l01401"></a>01401 
<a name="l01402"></a>01402       <span class="keywordflow">for</span>( usItemIndex = 1; usItemIndex &lt; <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f40efaf5227d3f780f8db037c71e3f903f">MAXITEMS</a>; usItemIndex++ )
<a name="l01403"></a>01403       {
<a name="l01404"></a>01404             <span class="keywordflow">if</span> ( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usItemIndex].usItemClass  == 0 )
<a name="l01405"></a>01405                   <span class="keywordflow">break</span>;
<a name="l01406"></a>01406             <span class="comment">//if there are any items </span>
<a name="l01407"></a>01407             <span class="keywordflow">if</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].ubTotalItems &gt; 0 )
<a name="l01408"></a>01408             {
<a name="l01409"></a>01409                   <span class="comment">// if there are any items in perfect condition</span>
<a name="l01410"></a>01410                   <span class="keywordflow">if</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].ubPerfectItems &gt; 0 )
<a name="l01411"></a>01411                   {
<a name="l01412"></a>01412                         <span class="comment">// if the items can be stacked</span>
<a name="l01413"></a>01413                         <span class="comment">// NOTE: This test must match the one inside AddItemsToTempDealerInventory() exactly!</span>
<a name="l01414"></a>01414                         <span class="keywordflow">if</span> ( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#c994bda542c061511bb0176f4fe2ee67">DealerItemIsSafeToStack</a>( usItemIndex ) )
<a name="l01415"></a>01415                         {
<a name="l01416"></a>01416                               <span class="comment">// regardless of how many there are, they count as 1 *distinct* item!  They will all be together in one box...</span>
<a name="l01417"></a>01417                               uiNumOfItems++;
<a name="l01418"></a>01418                         }
<a name="l01419"></a>01419                         <span class="keywordflow">else</span>
<a name="l01420"></a>01420                         {
<a name="l01421"></a>01421                               <span class="comment">// non-stacking items must be stored in one / box , because each may have unique fields besides bStatus[]</span>
<a name="l01422"></a>01422                               <span class="comment">// Example: guns all have ammo, ammo type, etc.  We need these uniquely represented for pricing &amp; manipulation</span>
<a name="l01423"></a>01423                               uiNumOfItems += <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].<a class="code" href="structDEALER__ITEM__HEADER.html#02f751b0130183b055b9012df527b1d8">ubPerfectItems</a>;
<a name="l01424"></a>01424                         }
<a name="l01425"></a>01425                   }
<a name="l01426"></a>01426 
<a name="l01427"></a>01427                   <span class="comment">// each *active* special item counts as one additional distinct item (each one occupied a separate shopkeeper box!)</span>
<a name="l01428"></a>01428                   <span class="comment">// NOTE: This is including items being repaired!!!</span>
<a name="l01429"></a>01429                   uiNumOfItems += <a class="code" href="Arms_01Dealer_01Init_8cpp.html#4068f4357d4746ecf545fae73ba713d7">CountActiveSpecialItemsInArmsDealersInventory</a>( ubArmsDealer, usItemIndex);
<a name="l01430"></a>01430             }
<a name="l01431"></a>01431       }
<a name="l01432"></a>01432 
<a name="l01433"></a>01433       <span class="keywordflow">return</span>( uiNumOfItems );
<a name="l01434"></a>01434 }
<a name="l01435"></a>01435 
<a name="l01436"></a>01436 
<a name="l01437"></a><a class="code" href="Arms_01Dealer_01Init_8h.html#4068f4357d4746ecf545fae73ba713d7">01437</a> <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#4068f4357d4746ecf545fae73ba713d7">CountActiveSpecialItemsInArmsDealersInventory</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usItemIndex )
<a name="l01438"></a>01438 {
<a name="l01439"></a>01439       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubActiveSpecialItems = 0;
<a name="l01440"></a>01440       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubElement;
<a name="l01441"></a>01441 
<a name="l01442"></a>01442 
<a name="l01443"></a>01443       <span class="comment">// next, try to sell all the used ones, gotta do these one at a time so we can remove them by element</span>
<a name="l01444"></a>01444       <span class="keywordflow">for</span> ( ubElement = 0; ubElement &lt; <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].<a class="code" href="structDEALER__ITEM__HEADER.html#26a9a14e537aa677de5829a0e6eb4171">ubElementsAlloced</a>; ubElement++ )
<a name="l01445"></a>01445       {
<a name="l01446"></a>01446             <span class="comment">// don't worry about negative condition, repairmen can't come this far, they don't sell!</span>
<a name="l01447"></a>01447             <span class="keywordflow">if</span> ( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].SpecialItem[ ubElement ].fActive )
<a name="l01448"></a>01448             {
<a name="l01449"></a>01449                   ubActiveSpecialItems++;
<a name="l01450"></a>01450             }
<a name="l01451"></a>01451       }
<a name="l01452"></a>01452 
<a name="l01453"></a>01453       <span class="keywordflow">return</span>( ubActiveSpecialItems );
<a name="l01454"></a>01454 }
<a name="l01455"></a>01455 
<a name="l01456"></a>01456 
<a name="l01457"></a><a class="code" href="Arms_01Dealer_01Init_8h.html#cad6fde24b801cb8aca9d36518a4d86f">01457</a> <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#cad6fde24b801cb8aca9d36518a4d86f">CountTotalItemsRepairDealerHasInForRepairs</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer )
<a name="l01458"></a>01458 {
<a name="l01459"></a>01459       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>      usItemIndex;
<a name="l01460"></a>01460       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>      usHowManyInForRepairs = 0;
<a name="l01461"></a>01461 
<a name="l01462"></a>01462       <span class="comment">//if the dealer is not a repair dealer, no need to count, return 0</span>
<a name="l01463"></a>01463       <span class="keywordflow">if</span>( !<a class="code" href="Arms_01Dealer_01Init_8cpp.html#160b9cd6e425f5db5ac75fc6269d2f70">DoesDealerDoRepairs</a>( ubArmsDealer ) )
<a name="l01464"></a>01464             <span class="keywordflow">return</span>( 0 );
<a name="l01465"></a>01465 
<a name="l01466"></a>01466       <span class="comment">//loop through the dealers inventory and count the number of items in for repairs</span>
<a name="l01467"></a>01467       <span class="keywordflow">for</span>( usItemIndex=0; usItemIndex &lt; <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f40efaf5227d3f780f8db037c71e3f903f">MAXITEMS</a>; usItemIndex++ )
<a name="l01468"></a>01468       {
<a name="l01469"></a>01469             <span class="keywordflow">if</span> ( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usItemIndex].usItemClass  == 0 )
<a name="l01470"></a>01470                   <span class="keywordflow">break</span>;
<a name="l01471"></a>01471             usHowManyInForRepairs += <a class="code" href="Arms_01Dealer_01Init_8cpp.html#cf6490b8ee12f24e171dd00d1d769129">CountSpecificItemsRepairDealerHasInForRepairs</a>( ubArmsDealer, usItemIndex );
<a name="l01472"></a>01472       }
<a name="l01473"></a>01473 
<a name="l01474"></a>01474       <span class="keywordflow">return</span>( usHowManyInForRepairs );
<a name="l01475"></a>01475 }
<a name="l01476"></a>01476 
<a name="l01477"></a>01477 
<a name="l01478"></a><a class="code" href="Arms_01Dealer_01Init_8h.html#cf6490b8ee12f24e171dd00d1d769129">01478</a> <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#cf6490b8ee12f24e171dd00d1d769129">CountSpecificItemsRepairDealerHasInForRepairs</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usItemIndex )
<a name="l01479"></a>01479 {
<a name="l01480"></a>01480       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>       ubElement;
<a name="l01481"></a>01481       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>       ubHowManyInForRepairs = 0;
<a name="l01482"></a>01482 
<a name="l01483"></a>01483       <span class="comment">//if the dealer is not a repair dealer, no need to count, return 0</span>
<a name="l01484"></a>01484       <span class="keywordflow">if</span>( !<a class="code" href="Arms_01Dealer_01Init_8cpp.html#160b9cd6e425f5db5ac75fc6269d2f70">DoesDealerDoRepairs</a>( ubArmsDealer ) )
<a name="l01485"></a>01485             <span class="keywordflow">return</span>( 0 );
<a name="l01486"></a>01486 
<a name="l01487"></a>01487 
<a name="l01488"></a>01488       <span class="comment">//if there is some items in stock</span>
<a name="l01489"></a>01489       <span class="keywordflow">if</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].ubTotalItems )
<a name="l01490"></a>01490       {
<a name="l01491"></a>01491             <span class="comment">//loop through the array of items</span>
<a name="l01492"></a>01492             <span class="keywordflow">for</span>( ubElement = 0; ubElement &lt; <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].<a class="code" href="structDEALER__ITEM__HEADER.html#26a9a14e537aa677de5829a0e6eb4171">ubElementsAlloced</a>; ubElement++ )
<a name="l01493"></a>01493             {
<a name="l01494"></a>01494                   <span class="keywordflow">if</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].SpecialItem[ ubElement ].fActive)
<a name="l01495"></a>01495                   {
<a name="l01496"></a>01496                         <span class="comment">//if the item's status is below 0, the item is being repaired</span>
<a name="l01497"></a>01497                         <span class="keywordflow">if</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].SpecialItem[ ubElement ].Info.bItemCondition &lt; 0 )
<a name="l01498"></a>01498                         {
<a name="l01499"></a>01499                               ubHowManyInForRepairs++;
<a name="l01500"></a>01500                         }
<a name="l01501"></a>01501                   }
<a name="l01502"></a>01502             }
<a name="l01503"></a>01503       }
<a name="l01504"></a>01504 
<a name="l01505"></a>01505       <span class="keywordflow">return</span>( ubHowManyInForRepairs );
<a name="l01506"></a>01506 }
<a name="l01507"></a>01507 
<a name="l01508"></a>01508 
<a name="l01509"></a>01509 
<a name="l01510"></a><a class="code" href="Arms_01Dealer_01Init_8h.html#4fc5f58a492f2f862120986533f66f0b">01510</a> <span class="keywordtype">void</span> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#4fc5f58a492f2f862120986533f66f0b">AddObjectToArmsDealerInventory</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer, <a class="code" href="structOBJECTTYPE.html">OBJECTTYPE</a> *pObject )
<a name="l01511"></a>01511 {
<a name="l01512"></a>01512       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubCnt;
<a name="l01513"></a>01513       <a class="code" href="structSPECIAL__ITEM__INFO.html">SPECIAL_ITEM_INFO</a> SpclItemInfo;
<a name="l01514"></a>01514 
<a name="l01515"></a>01515 
<a name="l01516"></a>01516       <a class="code" href="Arms_01Dealer_01Init_8cpp.html#8c87923914aad21c8e8e9227e6f96d65">SetSpecialItemInfoFromObject</a>( &amp;SpclItemInfo, pObject );
<a name="l01517"></a>01517 
<a name="l01518"></a>01518 
<a name="l01519"></a>01519       <span class="comment">// split up all the components of an objecttype and add them as seperate items into the dealer's inventory</span>
<a name="l01520"></a>01520       <span class="keywordflow">switch</span> ( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a> [ pObject-&gt;<a class="code" href="structOBJECTTYPE.html#4fbe05335f161f08f354566b8e5a0a19">usItem</a> ].usItemClass )
<a name="l01521"></a>01521       {
<a name="l01522"></a>01522             <span class="keywordflow">case</span> IC_GUN:
<a name="l01523"></a>01523                   <span class="comment">// add the gun (keeps the object's status and imprintID)</span>
<a name="l01524"></a>01524                   <span class="comment">// if the gun was jammed, this will forget about the jam (i.e. dealer immediately unjams anything he buys)</span>
<a name="l01525"></a>01525                   <a class="code" href="Arms_01Dealer_01Init_8cpp.html#0da9a30648c5360e44cac7e2461ea3bb">AddItemToArmsDealerInventory</a>( ubArmsDealer, pObject-&gt;<a class="code" href="structOBJECTTYPE.html#4fbe05335f161f08f354566b8e5a0a19">usItem</a>, &amp;SpclItemInfo, 1 );
<a name="l01526"></a>01526 
<a name="l01527"></a>01527                   <span class="comment">// if any GunAmmoItem is specified</span>
<a name="l01528"></a>01528                   <span class="keywordflow">if</span>( pObject-&gt;<a class="code" href="structOBJECTTYPE.html#7b0dbe4816379f07f63493c422871c04">usGunAmmoItem</a> != <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4c157bdf0b85a40d2619cbc8bc1ae5fe2">NONE</a>)
<a name="l01529"></a>01529                   {
<a name="l01530"></a>01530                         <span class="comment">// if it's regular ammo</span>
<a name="l01531"></a>01531                         <span class="keywordflow">if</span>( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ pObject-&gt;<a class="code" href="structOBJECTTYPE.html#7b0dbe4816379f07f63493c422871c04">usGunAmmoItem</a> ].usItemClass == IC_AMMO )
<a name="l01532"></a>01532                         {
<a name="l01533"></a>01533                               <span class="comment">// and there are some remaining</span>
<a name="l01534"></a>01534                               <span class="keywordflow">if</span> ( pObject-&gt;<a class="code" href="structOBJECTTYPE.html#d8f322b99df185cfeb027d9e0ec42964">ubGunShotsLeft</a> &gt; 0 )
<a name="l01535"></a>01535                               {
<a name="l01536"></a>01536                                     <span class="comment">// add the bullets of its remaining ammo</span>
<a name="l01537"></a>01537                                     <a class="code" href="Arms_01Dealer_01Init_8cpp.html#441e77fff63243b1c6e003bb4290dceb">AddAmmoToArmsDealerInventory</a>( ubArmsDealer, pObject-&gt;<a class="code" href="structOBJECTTYPE.html#7b0dbe4816379f07f63493c422871c04">usGunAmmoItem</a>, pObject-&gt;<a class="code" href="structOBJECTTYPE.html#d8f322b99df185cfeb027d9e0ec42964">ubGunShotsLeft</a> );
<a name="l01538"></a>01538                               }
<a name="l01539"></a>01539                         }
<a name="l01540"></a>01540                         <span class="keywordflow">else</span>  <span class="comment">// assume it's attached ammo (mortar shells, grenades)</span>
<a name="l01541"></a>01541                         {
<a name="l01542"></a>01542                               <span class="comment">// add the launchable item (can't be imprinted, or have attachments!)</span>
<a name="l01543"></a>01543                               <a class="code" href="Arms_01Dealer_01Init_8cpp.html#b4a1eb863f49bc02f992d8874ff97777">SetSpecialItemInfoToDefaults</a>( &amp;SpclItemInfo );
<a name="l01544"></a>01544                               SpclItemInfo.<a class="code" href="structSPECIAL__ITEM__INFO.html#a63af49b3ae129222cab2d4de0b44b8a">bItemCondition</a> = pObject-&gt;<a class="code" href="structOBJECTTYPE.html#0af7158b191023801d20e3ea4c0f5585">bGunAmmoStatus</a>;
<a name="l01545"></a>01545 
<a name="l01546"></a>01546                               <span class="comment">// if the gun it was in was jammed, get rid of the negative status now</span>
<a name="l01547"></a>01547                               <span class="keywordflow">if</span> ( SpclItemInfo.<a class="code" href="structSPECIAL__ITEM__INFO.html#a63af49b3ae129222cab2d4de0b44b8a">bItemCondition</a> &lt; 0 )
<a name="l01548"></a>01548                               {
<a name="l01549"></a>01549                                     SpclItemInfo.<a class="code" href="structSPECIAL__ITEM__INFO.html#a63af49b3ae129222cab2d4de0b44b8a">bItemCondition</a> *= -1;
<a name="l01550"></a>01550                               }
<a name="l01551"></a>01551 
<a name="l01552"></a>01552                               <a class="code" href="Arms_01Dealer_01Init_8cpp.html#0da9a30648c5360e44cac7e2461ea3bb">AddItemToArmsDealerInventory</a>( ubArmsDealer, pObject-&gt;<a class="code" href="structOBJECTTYPE.html#7b0dbe4816379f07f63493c422871c04">usGunAmmoItem</a>, &amp;SpclItemInfo, 1 );
<a name="l01553"></a>01553                         }
<a name="l01554"></a>01554                   }
<a name="l01555"></a>01555                   <span class="keywordflow">break</span>;
<a name="l01556"></a>01556 
<a name="l01557"></a>01557             <span class="keywordflow">case</span> IC_AMMO:
<a name="l01558"></a>01558                   <span class="comment">// add the contents of each magazine (multiple mags may have vastly different #bullets left)</span>
<a name="l01559"></a>01559                   <span class="keywordflow">for</span> ( ubCnt = 0; ubCnt &lt; pObject-&gt;<a class="code" href="structOBJECTTYPE.html#84ab3cbeb7dfdcc2e5ad4051e165d294">ubNumberOfObjects</a>; ubCnt++ )
<a name="l01560"></a>01560                   {
<a name="l01561"></a>01561                         <a class="code" href="Arms_01Dealer_01Init_8cpp.html#441e77fff63243b1c6e003bb4290dceb">AddAmmoToArmsDealerInventory</a>( ubArmsDealer, pObject-&gt;<a class="code" href="structOBJECTTYPE.html#4fbe05335f161f08f354566b8e5a0a19">usItem</a>, pObject-&gt;<a class="code" href="structOBJECTTYPE.html#afe493c2c0509d6ba3f24133cb8e517f">ubShotsLeft</a>[ ubCnt ] );
<a name="l01562"></a>01562                   }
<a name="l01563"></a>01563                   <span class="keywordflow">break</span>;
<a name="l01564"></a>01564 
<a name="l01565"></a>01565             <span class="keywordflow">default</span>:
<a name="l01566"></a>01566                   <span class="comment">// add each object seperately (multiple objects may have vastly different statuses, keep any imprintID)</span>
<a name="l01567"></a>01567                   <span class="keywordflow">for</span> ( ubCnt = 0; ubCnt &lt; pObject-&gt;<a class="code" href="structOBJECTTYPE.html#84ab3cbeb7dfdcc2e5ad4051e165d294">ubNumberOfObjects</a>; ubCnt++ )
<a name="l01568"></a>01568                   {
<a name="l01569"></a>01569                         SpclItemInfo.<a class="code" href="structSPECIAL__ITEM__INFO.html#a63af49b3ae129222cab2d4de0b44b8a">bItemCondition</a> = pObject-&gt;<a class="code" href="structOBJECTTYPE.html#aa0827e15c8e54d285d2850ea5ffbb07">bStatus</a>[ ubCnt ];
<a name="l01570"></a>01570                         <a class="code" href="Arms_01Dealer_01Init_8cpp.html#0da9a30648c5360e44cac7e2461ea3bb">AddItemToArmsDealerInventory</a>( ubArmsDealer, pObject-&gt;<a class="code" href="structOBJECTTYPE.html#4fbe05335f161f08f354566b8e5a0a19">usItem</a>, &amp;SpclItemInfo, 1 );
<a name="l01571"></a>01571                   }
<a name="l01572"></a>01572                   <span class="keywordflow">break</span>;
<a name="l01573"></a>01573       }
<a name="l01574"></a>01574 
<a name="l01575"></a>01575 
<a name="l01576"></a>01576       <span class="comment">// loop through any detachable attachments and add them as seperate items</span>
<a name="l01577"></a>01577       <span class="keywordflow">for</span>( ubCnt = 0; ubCnt &lt; MAX_ATTACHMENTS; ubCnt++ )
<a name="l01578"></a>01578       {
<a name="l01579"></a>01579             <span class="keywordflow">if</span>( pObject-&gt;<a class="code" href="structOBJECTTYPE.html#427bef1c8b3d44d79d8f552ca1d774aa">usAttachItem</a>[ ubCnt ] != <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4c157bdf0b85a40d2619cbc8bc1ae5fe2">NONE</a> )
<a name="l01580"></a>01580             {
<a name="l01581"></a>01581 <span class="comment">// ARM: Note: this is only used for selling, not repairs, so attachmentes are seperated when sold to a dealer</span>
<a name="l01582"></a>01582                   <span class="comment">// If the attachment is detachable</span>
<a name="l01583"></a>01583 <span class="comment">//                if (! (Item[ pObject-&gt;usAttachItem[ubCnt] ].fFlags &amp; ITEM_INSEPARABLE ) )</span>
<a name="l01584"></a>01584                   <a class="code" href="Soldier_01Ani_8cpp.html#c294aa65f0375eb6343a2de2a25dafcc">if</a> (! (<a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ pObject-&gt;<a class="code" href="structOBJECTTYPE.html#427bef1c8b3d44d79d8f552ca1d774aa">usAttachItem</a>[ubCnt] ].inseparable  ) )
<a name="l01585"></a>01585                   {
<a name="l01586"></a>01586                         <span class="comment">// add this particular attachment (they can't be imprinted, or themselves have attachments!)</span>
<a name="l01587"></a>01587                         <a class="code" href="Arms_01Dealer_01Init_8cpp.html#b4a1eb863f49bc02f992d8874ff97777">SetSpecialItemInfoToDefaults</a>( &amp;SpclItemInfo );
<a name="l01588"></a>01588                         SpclItemInfo.bItemCondition = pObject-&gt;<a class="code" href="structOBJECTTYPE.html#502ef8951e7613e2466bdf83927a7281">bAttachStatus</a>[ ubCnt ];
<a name="l01589"></a>01589                         <a class="code" href="Arms_01Dealer_01Init_8cpp.html#0da9a30648c5360e44cac7e2461ea3bb">AddItemToArmsDealerInventory</a>( ubArmsDealer, pObject-&gt;<a class="code" href="structOBJECTTYPE.html#427bef1c8b3d44d79d8f552ca1d774aa">usAttachItem</a>[ ubCnt ], &amp;SpclItemInfo, 1 );
<a name="l01590"></a>01590                   }
<a name="l01591"></a>01591             }
<a name="l01592"></a>01592       }
<a name="l01593"></a>01593 
<a name="l01594"></a>01594 
<a name="l01595"></a>01595       <span class="comment">// nuke the original object to prevent any possible item duplication</span>
<a name="l01596"></a>01596       memset( pObject, 0, <span class="keyword">sizeof</span>( <a class="code" href="structOBJECTTYPE.html">OBJECTTYPE</a> ) );
<a name="l01597"></a>01597 }
<a name="l01598"></a>01598 
<a name="l01599"></a>01599 
<a name="l01600"></a><a class="code" href="Arms_01Dealer_01Init_8cpp.html#441e77fff63243b1c6e003bb4290dceb">01600</a> <span class="keywordtype">void</span> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#441e77fff63243b1c6e003bb4290dceb">AddAmmoToArmsDealerInventory</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usItemIndex, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubShotsLeft )
<a name="l01601"></a>01601 {
<a name="l01602"></a>01602       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubMagCapacity;
<a name="l01603"></a>01603       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *pubStrayAmmo;
<a name="l01604"></a>01604       <a class="code" href="structSPECIAL__ITEM__INFO.html">SPECIAL_ITEM_INFO</a> SpclItemInfo;
<a name="l01605"></a>01605 
<a name="l01606"></a>01606 
<a name="l01607"></a>01607 
<a name="l01608"></a>01608       <span class="comment">// Ammo only, please!!!</span>
<a name="l01609"></a>01609       <span class="keywordflow">if</span> (<a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a> [ usItemIndex ].usItemClass != IC_AMMO )
<a name="l01610"></a>01610       {
<a name="l01611"></a>01611             Assert(0);
<a name="l01612"></a>01612             <span class="keywordflow">return</span>;
<a name="l01613"></a>01613       }
<a name="l01614"></a>01614 
<a name="l01615"></a>01615       <span class="keywordflow">if</span> ( ubShotsLeft == 0)
<a name="l01616"></a>01616       {
<a name="l01617"></a>01617             <span class="keywordflow">return</span>;
<a name="l01618"></a>01618       }
<a name="l01619"></a>01619 
<a name="l01620"></a>01620 
<a name="l01621"></a>01621       ubMagCapacity = <a class="code" href="Weapons_8cpp.html#5881a7295b606ac73bf0dddd7d1c80a5">Magazine</a>[ <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ usItemIndex ].<a class="code" href="structINVTYPE.html#8f52f99607debfdbb9a8dbf9e43c1967">ubClassIndex</a> ].<a class="code" href="structMAGTYPE.html#484bd43dc25a2e771c600c98996ac5de">ubMagSize</a>;
<a name="l01622"></a>01622 
<a name="l01623"></a>01623       <span class="keywordflow">if</span> ( ubShotsLeft &gt;= ubMagCapacity )
<a name="l01624"></a>01624       {
<a name="l01625"></a>01625             <span class="comment">// add however many FULL magazines the #shot left represents      </span>
<a name="l01626"></a>01626             <a class="code" href="Arms_01Dealer_01Init_8cpp.html#b4a1eb863f49bc02f992d8874ff97777">SetSpecialItemInfoToDefaults</a>( &amp;SpclItemInfo );
<a name="l01627"></a>01627             <a class="code" href="Arms_01Dealer_01Init_8cpp.html#0da9a30648c5360e44cac7e2461ea3bb">AddItemToArmsDealerInventory</a>( ubArmsDealer, usItemIndex, &amp;SpclItemInfo, ( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ) ( ubShotsLeft / ubMagCapacity ) );
<a name="l01628"></a>01628             ubShotsLeft %= ubMagCapacity;
<a name="l01629"></a>01629       }
<a name="l01630"></a>01630 
<a name="l01631"></a>01631       <span class="comment">// any shots left now are "strays" - not enough to completely fill a magazine of this type</span>
<a name="l01632"></a>01632       <span class="keywordflow">if</span> ( ubShotsLeft &gt; 0 )
<a name="l01633"></a>01633       {
<a name="l01634"></a>01634             <span class="comment">// handle "stray" ammo - add it to the dealer's stray pile</span>
<a name="l01635"></a>01635             pubStrayAmmo = &amp;(<a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].<a class="code" href="structDEALER__ITEM__HEADER.html#52d52d400f5f9edbd4bd899b6aa83e3e">ubStrayAmmo</a>);
<a name="l01636"></a>01636             *pubStrayAmmo += ubShotsLeft;
<a name="l01637"></a>01637 
<a name="l01638"></a>01638             <span class="comment">// if dealer has accumulated enough stray ammo to make another full magazine, convert it!</span>
<a name="l01639"></a>01639             <span class="keywordflow">if</span> ( *pubStrayAmmo &gt;= ubMagCapacity )
<a name="l01640"></a>01640             {
<a name="l01641"></a>01641                   <a class="code" href="Arms_01Dealer_01Init_8cpp.html#b4a1eb863f49bc02f992d8874ff97777">SetSpecialItemInfoToDefaults</a>( &amp;SpclItemInfo );
<a name="l01642"></a>01642                   <a class="code" href="Arms_01Dealer_01Init_8cpp.html#0da9a30648c5360e44cac7e2461ea3bb">AddItemToArmsDealerInventory</a>( ubArmsDealer, usItemIndex, &amp;SpclItemInfo, ( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ) ( *pubStrayAmmo / ubMagCapacity ) );
<a name="l01643"></a>01643                   *pubStrayAmmo = *pubStrayAmmo % ubMagCapacity;
<a name="l01644"></a>01644             }
<a name="l01645"></a>01645             <span class="comment">// I know, I know, this is getting pretty anal...  But what the hell, it was easy enough to do.  ARM.</span>
<a name="l01646"></a>01646       }
<a name="l01647"></a>01647 }
<a name="l01648"></a>01648 
<a name="l01649"></a>01649 
<a name="l01650"></a>01650 <span class="comment">//Use AddObjectToArmsDealerInventory() instead of this when converting a complex item in OBJECTTYPE format.</span>
<a name="l01651"></a><a class="code" href="Arms_01Dealer_01Init_8cpp.html#0da9a30648c5360e44cac7e2461ea3bb">01651</a> <span class="keywordtype">void</span> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#0da9a30648c5360e44cac7e2461ea3bb">AddItemToArmsDealerInventory</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usItemIndex, <a class="code" href="structSPECIAL__ITEM__INFO.html">SPECIAL_ITEM_INFO</a> *pSpclItemInfo, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubHowMany )
<a name="l01652"></a>01652 {
<a name="l01653"></a>01653       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubRoomLeft;
<a name="l01654"></a>01654       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubElement;
<a name="l01655"></a>01655       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubElementsToAdd;
<a name="l01656"></a>01656       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fFoundOne;
<a name="l01657"></a>01657       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fSuccess;
<a name="l01658"></a>01658 
<a name="l01659"></a>01659 
<a name="l01660"></a>01660       Assert( ubHowMany &gt; 0);
<a name="l01661"></a>01661 
<a name="l01662"></a>01662       ubRoomLeft = 255 - <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].<a class="code" href="structDEALER__ITEM__HEADER.html#f4e90d47661b87353a9076c5e53cd453">ubTotalItems</a>;
<a name="l01663"></a>01663 
<a name="l01664"></a>01664       <span class="keywordflow">if</span> ( ubHowMany &gt; ubRoomLeft)
<a name="l01665"></a>01665       {
<a name="l01666"></a>01666             <span class="comment">// not enough room to store that many, any extras vanish into thin air!</span>
<a name="l01667"></a>01667             ubHowMany = ubRoomLeft;
<a name="l01668"></a>01668       }
<a name="l01669"></a>01669 
<a name="l01670"></a>01670       <span class="keywordflow">if</span> ( ubHowMany == 0)
<a name="l01671"></a>01671       {
<a name="l01672"></a>01672             <span class="keywordflow">return</span>;
<a name="l01673"></a>01673       }
<a name="l01674"></a>01674 
<a name="l01675"></a>01675 
<a name="l01676"></a>01676       <span class="comment">// decide whether this item is "special" or not</span>
<a name="l01677"></a>01677       <span class="keywordflow">if</span> ( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#5c176cb71e619d5e26c1af3f23d94a8f">IsItemInfoSpecial</a>( pSpclItemInfo ) )
<a name="l01678"></a>01678       {
<a name="l01679"></a>01679             <span class="comment">// Anything that's used/damaged or imprinted is store as a special item in the SpecialItem array,</span>
<a name="l01680"></a>01680             <span class="comment">// exactly one item per element.  We (re)allocate memory dynamically as necessary to hold the additional items.</span>
<a name="l01681"></a>01681 
<a name="l01682"></a>01682             <span class="keywordflow">do</span>
<a name="l01683"></a>01683             {
<a name="l01684"></a>01684                   <span class="comment">// search for an already allocated, empty element in the special item array</span>
<a name="l01685"></a>01685                   fFoundOne = FALSE;
<a name="l01686"></a>01686                   <span class="keywordflow">for</span> ( ubElement = 0; ubElement &lt; <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].<a class="code" href="structDEALER__ITEM__HEADER.html#26a9a14e537aa677de5829a0e6eb4171">ubElementsAlloced</a>; ubElement++ )
<a name="l01687"></a>01687                   {
<a name="l01688"></a>01688                         <span class="keywordflow">if</span> ( !( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].SpecialItem[ ubElement ].fActive ) )
<a name="l01689"></a>01689                         {
<a name="l01690"></a>01690                               <span class="comment">//Great!  Store it here, then.</span>
<a name="l01691"></a>01691                               <a class="code" href="Arms_01Dealer_01Init_8cpp.html#89b4d162e27a07efbc4302a1e9bc3bb2">AddSpecialItemToArmsDealerInventoryAtElement</a>( ubArmsDealer, usItemIndex, ubElement, pSpclItemInfo );
<a name="l01692"></a>01692                               fFoundOne = TRUE;
<a name="l01693"></a>01693                               <span class="keywordflow">break</span>;
<a name="l01694"></a>01694                         }
<a name="l01695"></a>01695                   }
<a name="l01696"></a>01696 
<a name="l01697"></a>01697                   <span class="comment">// if we didn't find any inactive elements already allocated</span>
<a name="l01698"></a>01698                   <span class="keywordflow">if</span> (!fFoundOne)
<a name="l01699"></a>01699                   {
<a name="l01700"></a>01700                         <span class="comment">// then we're going to have to allocate some more space...</span>
<a name="l01701"></a>01701                         ubElementsToAdd = max( SPECIAL_ITEMS_ALLOCED_AT_ONCE, ubHowMany);
<a name="l01702"></a>01702 
<a name="l01703"></a>01703                         <span class="comment">// if there aren't any allocated at all right now</span>
<a name="l01704"></a>01704                         <span class="keywordflow">if</span> ( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].ubElementsAlloced == 0 )
<a name="l01705"></a>01705                         {
<a name="l01706"></a>01706                               <span class="comment">// allocate new memory for the real buffer</span>
<a name="l01707"></a>01707                               fSuccess = <a class="code" href="Arms_01Dealer_01Init_8cpp.html#5b455b495d2c965f53bf107893c5fde3">AllocMemsetSpecialItemArray</a>( &amp;<a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ], ubElementsToAdd );
<a name="l01708"></a>01708                         }
<a name="l01709"></a>01709                         <span class="keywordflow">else</span>
<a name="l01710"></a>01710                         {
<a name="l01711"></a>01711                               <span class="comment">// we have some allocated, but they're all full and we need more.  MemRealloc existing amount + # addition elements</span>
<a name="l01712"></a>01712                               fSuccess = <a class="code" href="Arms_01Dealer_01Init_8cpp.html#ff5263f30d648f749ea192e5a9a7dd56">ResizeSpecialItemArray</a>( &amp;<a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ], (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>)( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].ubElementsAlloced + ubElementsToAdd ) );
<a name="l01713"></a>01713                         }
<a name="l01714"></a>01714 
<a name="l01715"></a>01715                         <span class="keywordflow">if</span> ( !fSuccess )
<a name="l01716"></a>01716                         {
<a name="l01717"></a>01717                               <span class="keywordflow">return</span>;
<a name="l01718"></a>01718                         }
<a name="l01719"></a>01719 
<a name="l01720"></a>01720                         <span class="comment">// now add the special item at the first of the newly added elements (still stored in ubElement!)</span>
<a name="l01721"></a>01721                         <a class="code" href="Arms_01Dealer_01Init_8cpp.html#89b4d162e27a07efbc4302a1e9bc3bb2">AddSpecialItemToArmsDealerInventoryAtElement</a>( ubArmsDealer, usItemIndex, ubElement, pSpclItemInfo );
<a name="l01722"></a>01722                   }
<a name="l01723"></a>01723 
<a name="l01724"></a>01724                   <span class="comment">// store the # of the element it was placed in globally so anyone who needs that can grab it there</span>
<a name="l01725"></a>01725                   <a class="code" href="Arms_01Dealer_01Init_8cpp.html#396ff211074975473456e0ecf8b7b893">gubLastSpecialItemAddedAtElement</a> = ubElement;
<a name="l01726"></a>01726 
<a name="l01727"></a>01727                   ubHowMany--;
<a name="l01728"></a>01728             } <span class="keywordflow">while</span> ( ubHowMany &gt; 0);
<a name="l01729"></a>01729       }
<a name="l01730"></a>01730       <span class="keywordflow">else</span>  <span class="comment">// adding perfect item(s)</span>
<a name="l01731"></a>01731       {
<a name="l01732"></a>01732             <span class="comment">// then it's stored as a "perfect" item, simply add it to that counter!</span>
<a name="l01733"></a>01733             <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].<a class="code" href="structDEALER__ITEM__HEADER.html#02f751b0130183b055b9012df527b1d8">ubPerfectItems</a> += ubHowMany;
<a name="l01734"></a>01734             <span class="comment">// increase total items of this type</span>
<a name="l01735"></a>01735             <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].<a class="code" href="structDEALER__ITEM__HEADER.html#f4e90d47661b87353a9076c5e53cd453">ubTotalItems</a> += ubHowMany;
<a name="l01736"></a>01736       }
<a name="l01737"></a>01737 }
<a name="l01738"></a>01738 
<a name="l01739"></a>01739 
<a name="l01740"></a><a class="code" href="Arms_01Dealer_01Init_8cpp.html#89b4d162e27a07efbc4302a1e9bc3bb2">01740</a> <span class="keywordtype">void</span> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#89b4d162e27a07efbc4302a1e9bc3bb2">AddSpecialItemToArmsDealerInventoryAtElement</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usItemIndex, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubElement, <a class="code" href="structSPECIAL__ITEM__INFO.html">SPECIAL_ITEM_INFO</a> *pSpclItemInfo )
<a name="l01741"></a>01741 {
<a name="l01742"></a>01742       Assert( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].ubTotalItems &lt; 255 );
<a name="l01743"></a>01743       Assert( ubElement &lt; <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].ubElementsAlloced );
<a name="l01744"></a>01744       Assert( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].SpecialItem[ ubElement ].fActive == FALSE );
<a name="l01745"></a>01745       Assert( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#5c176cb71e619d5e26c1af3f23d94a8f">IsItemInfoSpecial</a>( pSpclItemInfo ) );
<a name="l01746"></a>01746 
<a name="l01747"></a>01747 
<a name="l01748"></a>01748       <span class="comment">//Store the special values in that element, and make it active</span>
<a name="l01749"></a>01749       <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].<a class="code" href="structDEALER__ITEM__HEADER.html#bfdb0e8735b1864b79c158d6e65412ef">SpecialItem</a>[ ubElement ].<a class="code" href="structDEALER__SPECIAL__ITEM.html#8e5729c037fec59f4b84fb0461bdc94c">fActive</a> = TRUE;
<a name="l01750"></a>01750 
<a name="l01751"></a>01751       memcpy( &amp;(<a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].SpecialItem[ ubElement ].Info), pSpclItemInfo, <span class="keyword">sizeof</span>( <a class="code" href="structSPECIAL__ITEM__INFO.html">SPECIAL_ITEM_INFO</a> ) );
<a name="l01752"></a>01752 
<a name="l01753"></a>01753       <span class="comment">// increase the total items</span>
<a name="l01754"></a>01754       <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].<a class="code" href="structDEALER__ITEM__HEADER.html#f4e90d47661b87353a9076c5e53cd453">ubTotalItems</a>++;
<a name="l01755"></a>01755 }
<a name="l01756"></a>01756 
<a name="l01757"></a>01757 
<a name="l01758"></a>01758 
<a name="l01759"></a>01759 <span class="comment">// removes ubHowMany items of usItemIndex with the matching Info from dealer ubArmsDealer</span>
<a name="l01760"></a><a class="code" href="Arms_01Dealer_01Init_8h.html#20c2feeb94c93f8c59da42a4c81a1fbf">01760</a> <span class="keywordtype">void</span> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#20c2feeb94c93f8c59da42a4c81a1fbf">RemoveItemFromArmsDealerInventory</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usItemIndex, <a class="code" href="structSPECIAL__ITEM__INFO.html">SPECIAL_ITEM_INFO</a> *pSpclItemInfo, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubHowMany )
<a name="l01761"></a>01761 {
<a name="l01762"></a>01762       <a class="code" href="structDEALER__SPECIAL__ITEM.html">DEALER_SPECIAL_ITEM</a> *pSpecialItem;
<a name="l01763"></a>01763       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubElement;
<a name="l01764"></a>01764 
<a name="l01765"></a>01765 
<a name="l01766"></a>01766       Assert( ubHowMany &lt;= <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].ubTotalItems );
<a name="l01767"></a>01767 
<a name="l01768"></a>01768       <span class="keywordflow">if</span> ( ubHowMany == 0)
<a name="l01769"></a>01769       {
<a name="l01770"></a>01770             <span class="keywordflow">return</span>;
<a name="l01771"></a>01771       }
<a name="l01772"></a>01772 
<a name="l01773"></a>01773 
<a name="l01774"></a>01774       <span class="comment">// decide whether this item is "special" or not</span>
<a name="l01775"></a>01775       <span class="keywordflow">if</span> ( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#5c176cb71e619d5e26c1af3f23d94a8f">IsItemInfoSpecial</a>( pSpclItemInfo ) )
<a name="l01776"></a>01776       {
<a name="l01777"></a>01777             <span class="comment">// look through the elements, trying to find special items matching the specifications</span>
<a name="l01778"></a>01778             <span class="keywordflow">for</span> ( ubElement = 0; ubElement &lt; <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].<a class="code" href="structDEALER__ITEM__HEADER.html#26a9a14e537aa677de5829a0e6eb4171">ubElementsAlloced</a>; ubElement++ )
<a name="l01779"></a>01779             {
<a name="l01780"></a>01780                   pSpecialItem = &amp;(<a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].SpecialItem[ ubElement ]);
<a name="l01781"></a>01781 
<a name="l01782"></a>01782                   <span class="comment">// if this element is in use</span>
<a name="l01783"></a>01783                   <span class="keywordflow">if</span> ( pSpecialItem-&gt;<a class="code" href="structDEALER__SPECIAL__ITEM.html#8e5729c037fec59f4b84fb0461bdc94c">fActive</a> )
<a name="l01784"></a>01784                   {
<a name="l01785"></a>01785                         <span class="comment">// and its contents are exactly what we're looking for</span>
<a name="l01786"></a>01786                         <span class="keywordflow">if</span>( memcmp( &amp;(<a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].SpecialItem[ ubElement ].Info), pSpclItemInfo, <span class="keyword">sizeof</span>( <a class="code" href="structSPECIAL__ITEM__INFO.html">SPECIAL_ITEM_INFO</a> ) ) == 0 )
<a name="l01787"></a>01787                         {
<a name="l01788"></a>01788                               <span class="comment">// Got one!  Remove it</span>
<a name="l01789"></a>01789                               <a class="code" href="Arms_01Dealer_01Init_8cpp.html#b06b400d722cf13e1815c1b538c1ea0e">RemoveSpecialItemFromArmsDealerInventoryAtElement</a>( ubArmsDealer, usItemIndex, ubElement );
<a name="l01790"></a>01790 
<a name="l01791"></a>01791                               ubHowMany--;
<a name="l01792"></a>01792                               <span class="keywordflow">if</span> ( ubHowMany == 0)
<a name="l01793"></a>01793                               {
<a name="l01794"></a>01794                                     <span class="keywordflow">break</span>;
<a name="l01795"></a>01795                               }
<a name="l01796"></a>01796                         }
<a name="l01797"></a>01797                   }
<a name="l01798"></a>01798             }
<a name="l01799"></a>01799 
<a name="l01800"></a>01800             <span class="comment">// when we've searched all the special item elements, we'd better not have any more items to remove!</span>
<a name="l01801"></a>01801             Assert( ubHowMany == 0);
<a name="l01802"></a>01802       }
<a name="l01803"></a>01803       <span class="keywordflow">else</span>  <span class="comment">// removing perfect item(s)</span>
<a name="l01804"></a>01804       {
<a name="l01805"></a>01805             <span class="comment">// then it's stored as a "perfect" item, simply subtract from tha counter!</span>
<a name="l01806"></a>01806             Assert( ubHowMany &lt;= <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].ubPerfectItems );
<a name="l01807"></a>01807             <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].<a class="code" href="structDEALER__ITEM__HEADER.html#02f751b0130183b055b9012df527b1d8">ubPerfectItems</a> -= ubHowMany;
<a name="l01808"></a>01808             <span class="comment">// decrease total items of this type</span>
<a name="l01809"></a>01809             <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].<a class="code" href="structDEALER__ITEM__HEADER.html#f4e90d47661b87353a9076c5e53cd453">ubTotalItems</a> -= ubHowMany;
<a name="l01810"></a>01810       }
<a name="l01811"></a>01811 }
<a name="l01812"></a>01812 
<a name="l01813"></a>01813 
<a name="l01814"></a>01814 
<a name="l01815"></a><a class="code" href="Arms_01Dealer_01Init_8cpp.html#8ca2d85db785fd88a7b7fa6bdbf89896">01815</a> <span class="keywordtype">void</span> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#8ca2d85db785fd88a7b7fa6bdbf89896">RemoveRandomItemFromArmsDealerInventory</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usItemIndex, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubHowMany )
<a name="l01816"></a>01816 {
<a name="l01817"></a>01817       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubWhichOne;
<a name="l01818"></a>01818       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubSkippedAlready;
<a name="l01819"></a>01819       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fFoundIt;
<a name="l01820"></a>01820       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubElement;
<a name="l01821"></a>01821       <a class="code" href="structSPECIAL__ITEM__INFO.html">SPECIAL_ITEM_INFO</a> SpclItemInfo;
<a name="l01822"></a>01822 
<a name="l01823"></a>01823 
<a name="l01824"></a>01824       <span class="comment">// not permitted for repair dealers - would take extra code to subtract items under repair from ubTotalItems!!!</span>
<a name="l01825"></a>01825       Assert( !<a class="code" href="Arms_01Dealer_01Init_8cpp.html#160b9cd6e425f5db5ac75fc6269d2f70">DoesDealerDoRepairs</a>( ubArmsDealer ) );
<a name="l01826"></a>01826       <span class="comment">// Can't remove any items in for repair, though!</span>
<a name="l01827"></a>01827       Assert( ubHowMany &lt;= <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].ubTotalItems );
<a name="l01828"></a>01828 
<a name="l01829"></a>01829       <span class="keywordflow">while</span> ( ubHowMany &gt; 0)
<a name="l01830"></a>01830       {
<a name="l01831"></a>01831             <span class="comment">// pick a random one to get rid of</span>
<a name="l01832"></a>01832             ubWhichOne = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>)<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(<a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].ubTotalItems );
<a name="l01833"></a>01833 
<a name="l01834"></a>01834             <span class="comment">// if we picked one of the perfect ones...</span>
<a name="l01835"></a>01835             <span class="keywordflow">if</span> ( ubWhichOne &lt; <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].ubPerfectItems )
<a name="l01836"></a>01836             {
<a name="l01837"></a>01837                   <span class="comment">// create item info describing a perfect item</span>
<a name="l01838"></a>01838                   <a class="code" href="Arms_01Dealer_01Init_8cpp.html#b4a1eb863f49bc02f992d8874ff97777">SetSpecialItemInfoToDefaults</a>( &amp;SpclItemInfo );
<a name="l01839"></a>01839                   <span class="comment">// then that's easy, its condition is 100, so remove one of those</span>
<a name="l01840"></a>01840                   <a class="code" href="Arms_01Dealer_01Init_8cpp.html#20c2feeb94c93f8c59da42a4c81a1fbf">RemoveItemFromArmsDealerInventory</a>( ubArmsDealer, usItemIndex, &amp;SpclItemInfo, 1 );
<a name="l01841"></a>01841             }
<a name="l01842"></a>01842             <span class="keywordflow">else</span>
<a name="l01843"></a>01843             {
<a name="l01844"></a>01844                   <span class="comment">// Yikes!  Gotta look through the special items.  We already know it's not any of the perfect ones, subtract those</span>
<a name="l01845"></a>01845                   ubWhichOne -= <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].<a class="code" href="structDEALER__ITEM__HEADER.html#02f751b0130183b055b9012df527b1d8">ubPerfectItems</a>;
<a name="l01846"></a>01846                   ubSkippedAlready = 0;
<a name="l01847"></a>01847 
<a name="l01848"></a>01848                   fFoundIt = FALSE;
<a name="l01849"></a>01849 
<a name="l01850"></a>01850                   <span class="keywordflow">for</span> ( ubElement = 0; ubElement &lt; <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].<a class="code" href="structDEALER__ITEM__HEADER.html#26a9a14e537aa677de5829a0e6eb4171">ubElementsAlloced</a>; ubElement++ )
<a name="l01851"></a>01851                   {
<a name="l01852"></a>01852                         <span class="comment">// if this is an active special item, not in repair</span>
<a name="l01853"></a>01853                         <span class="keywordflow">if</span> ( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].SpecialItem[ ubElement ].fActive ) <span class="comment">// &amp;&amp;</span>
<a name="l01854"></a>01854 <span class="comment">//                             ( gArmsDealersInventory[ ubArmsDealer ][ usItemIndex ].SpecialItem[ ubElement ].Info.bItemCondition &gt; 0 ) )</span>
<a name="l01855"></a>01855                         {
<a name="l01856"></a>01856                               <span class="comment">// if we skipped the right amount of them</span>
<a name="l01857"></a>01857                               <span class="keywordflow">if</span> ( ubSkippedAlready == ubWhichOne )
<a name="l01858"></a>01858                               {
<a name="l01859"></a>01859                                     <span class="comment">// then this one is it!  That's the one we're gonna remove</span>
<a name="l01860"></a>01860                                     <a class="code" href="Arms_01Dealer_01Init_8cpp.html#b06b400d722cf13e1815c1b538c1ea0e">RemoveSpecialItemFromArmsDealerInventoryAtElement</a>( ubArmsDealer, usItemIndex, ubElement );
<a name="l01861"></a>01861                                     fFoundIt = TRUE;
<a name="l01862"></a>01862                                     <span class="keywordflow">break</span>;
<a name="l01863"></a>01863                               }
<a name="l01864"></a>01864                               <span class="keywordflow">else</span>
<a name="l01865"></a>01865                               {
<a name="l01866"></a>01866                                     <span class="comment">// keep looking...</span>
<a name="l01867"></a>01867                                     ubSkippedAlready++;
<a name="l01868"></a>01868                               }
<a name="l01869"></a>01869                         }
<a name="l01870"></a>01870                   }
<a name="l01871"></a>01871             
<a name="l01872"></a>01872                   <span class="comment">// this HAS to work, or the data structure is corrupt!</span>
<a name="l01873"></a>01873                   Assert(fFoundIt);
<a name="l01874"></a>01874             }
<a name="l01875"></a>01875 
<a name="l01876"></a>01876             ubHowMany--;
<a name="l01877"></a>01877       }
<a name="l01878"></a>01878 }
<a name="l01879"></a>01879 
<a name="l01880"></a>01880 
<a name="l01881"></a>01881 
<a name="l01882"></a><a class="code" href="Arms_01Dealer_01Init_8h.html#b06b400d722cf13e1815c1b538c1ea0e">01882</a> <span class="keywordtype">void</span> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#b06b400d722cf13e1815c1b538c1ea0e">RemoveSpecialItemFromArmsDealerInventoryAtElement</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usItemIndex, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubElement )
<a name="l01883"></a>01883 {
<a name="l01884"></a>01884       Assert( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].ubTotalItems &gt; 0 );
<a name="l01885"></a>01885       Assert( ubElement &lt; <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].ubElementsAlloced );
<a name="l01886"></a>01886       Assert( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].SpecialItem[ ubElement ].fActive == TRUE );
<a name="l01887"></a>01887 
<a name="l01888"></a>01888       <span class="comment">// wipe it out (turning off fActive)</span>
<a name="l01889"></a>01889       memset( &amp;( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].SpecialItem[ ubElement ] ), 0, <span class="keyword">sizeof</span>( <a class="code" href="structDEALER__SPECIAL__ITEM.html">DEALER_SPECIAL_ITEM</a> ) );
<a name="l01890"></a>01890 
<a name="l01891"></a>01891       <span class="comment">// one fewer item remains...</span>
<a name="l01892"></a>01892       <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].<a class="code" href="structDEALER__ITEM__HEADER.html#f4e90d47661b87353a9076c5e53cd453">ubTotalItems</a>--;
<a name="l01893"></a>01893 }
<a name="l01894"></a>01894 
<a name="l01895"></a>01895 
<a name="l01896"></a>01896 
<a name="l01897"></a><a class="code" href="Arms_01Dealer_01Init_8h.html#6f8c22491c954bfcb7f676ca3536e83b">01897</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#6f8c22491c954bfcb7f676ca3536e83b">AddDeadArmsDealerItemsToWorld</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubMercID )
<a name="l01898"></a>01898 {
<a name="l01899"></a>01899       <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>  bArmsDealer;
<a name="l01900"></a>01900       <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>;
<a name="l01901"></a>01901       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>      usItemIndex;      
<a name="l01902"></a>01902       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubElement;
<a name="l01903"></a>01903       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubHowManyMaxAtATime;
<a name="l01904"></a>01904       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubLeftToDrop;
<a name="l01905"></a>01905       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubNowDropping;
<a name="l01906"></a>01906       <a class="code" href="structOBJECTTYPE.html">OBJECTTYPE</a> TempObject;
<a name="l01907"></a>01907       <a class="code" href="structDEALER__SPECIAL__ITEM.html">DEALER_SPECIAL_ITEM</a> *pSpecialItem;
<a name="l01908"></a>01908       <a class="code" href="structSPECIAL__ITEM__INFO.html">SPECIAL_ITEM_INFO</a> SpclItemInfo;
<a name="l01909"></a>01909 
<a name="l01910"></a>01910 
<a name="l01911"></a>01911       <span class="comment">//Get Dealer ID from from merc Id</span>
<a name="l01912"></a>01912       bArmsDealer = <a class="code" href="Arms_01Dealer_01Init_8cpp.html#6038dfdede5a24e964d56fc20d5cc962">GetArmsDealerIDFromMercID</a>( ubMercID );
<a name="l01913"></a>01913       <span class="keywordflow">if</span>( bArmsDealer == -1 )
<a name="l01914"></a>01914       {
<a name="l01915"></a>01915             <span class="comment">// not a dealer, that's ok, we get called for every dude that croaks.</span>
<a name="l01916"></a>01916             <span class="keywordflow">return</span>( FALSE );
<a name="l01917"></a>01917       }
<a name="l01918"></a>01918 
<a name="l01919"></a>01919 
<a name="l01920"></a>01920       <span class="comment">// mark the dealer as being out of business!</span>
<a name="l01921"></a>01921       <a class="code" href="Arms_01Dealer_01Init_8cpp.html#efac177a506b89c636fdab5eeccd37d8">gArmsDealerStatus</a>[ bArmsDealer ].<a class="code" href="structARMS__DEALER__STATUS.html#e2b1bbdba603cdc64a4eac9b0c61584c">fOutOfBusiness</a> = TRUE;
<a name="l01922"></a>01922 
<a name="l01923"></a>01923 
<a name="l01924"></a>01924       <span class="comment">//Get a pointer to the dealer</span>
<a name="l01925"></a>01925       <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> = <a class="code" href="Soldier_01Profile_8cpp.html#2a54c4a06df8ed61529646f23682ef9d">FindSoldierByProfileID</a>( ubMercID, FALSE );
<a name="l01926"></a>01926       <span class="keywordflow">if</span>( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> == NULL )
<a name="l01927"></a>01927       {
<a name="l01928"></a>01928             <span class="comment">// This should never happen, a dealer getting knocked off without the sector being loaded, should it?</span>
<a name="l01929"></a>01929             <span class="comment">// If it's possible, we should modify code below to dump his belongings into the sector without using pSoldier-&gt;sGridNo</span>
<a name="l01930"></a>01930             Assert(0);
<a name="l01931"></a>01931             <span class="keywordflow">return</span>( FALSE );
<a name="l01932"></a>01932       }
<a name="l01933"></a>01933 
<a name="l01934"></a>01934 
<a name="l01935"></a>01935       <span class="comment">//loop through all the items in the dealer's inventory, and drop them all where the dealer was set up.</span>
<a name="l01936"></a>01936 
<a name="l01937"></a>01937       <span class="keywordflow">for</span>( usItemIndex = 1; usItemIndex &lt; <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f40efaf5227d3f780f8db037c71e3f903f">MAXITEMS</a>; usItemIndex++ )
<a name="l01938"></a>01938       {
<a name="l01939"></a>01939             <span class="keywordflow">if</span> ( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usItemIndex].usItemClass  == 0 )
<a name="l01940"></a>01940                   <span class="keywordflow">break</span>;
<a name="l01941"></a>01941             <span class="comment">//if the dealer has any items of this type</span>
<a name="l01942"></a>01942             <span class="keywordflow">if</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ bArmsDealer ][ usItemIndex ].ubTotalItems &gt; 0)
<a name="l01943"></a>01943             {
<a name="l01944"></a>01944                   <span class="comment">// if he has any perfect items of this time</span>
<a name="l01945"></a>01945                   <span class="keywordflow">if</span> ( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ bArmsDealer ][ usItemIndex ].ubPerfectItems &gt; 0 )
<a name="l01946"></a>01946                   {
<a name="l01947"></a>01947                         <span class="comment">// drop all the perfect items first</span>
<a name="l01948"></a>01948 
<a name="l01949"></a>01949                         <span class="comment">// drop stackable items like ammo in stacks of whatever will fit into a large pocket instead of one at a time</span>
<a name="l01950"></a>01950                         ubHowManyMaxAtATime = <a class="code" href="Items_8cpp.html#b9dea8d6005bdf44cf47646131d66667">ItemSlotLimit</a>( usItemIndex, <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc8785521434ace88498823088a193622a0ab42">BIGPOCK1POS</a> );
<a name="l01951"></a>01951                         <span class="keywordflow">if</span> ( ubHowManyMaxAtATime &lt; 1 )
<a name="l01952"></a>01952                         {
<a name="l01953"></a>01953                               ubHowManyMaxAtATime = 1;
<a name="l01954"></a>01954                         }
<a name="l01955"></a>01955 
<a name="l01956"></a>01956                         <span class="comment">// create item info describing a perfect item</span>
<a name="l01957"></a>01957                         <a class="code" href="Arms_01Dealer_01Init_8cpp.html#b4a1eb863f49bc02f992d8874ff97777">SetSpecialItemInfoToDefaults</a>( &amp;SpclItemInfo );
<a name="l01958"></a>01958 
<a name="l01959"></a>01959                         ubLeftToDrop = <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ bArmsDealer ][ usItemIndex ].<a class="code" href="structDEALER__ITEM__HEADER.html#02f751b0130183b055b9012df527b1d8">ubPerfectItems</a>;
<a name="l01960"></a>01960 
<a name="l01961"></a>01961         <span class="comment">// ATE: While it IS leagal here to use pSoldier-&gt;sInitialGridNo, cause of where this</span>
<a name="l01962"></a>01962         <span class="comment">// function is called, there are times when we're not guarenteed that sGridNo is good</span>
<a name="l01963"></a>01963                         <span class="keywordflow">while</span> ( ubLeftToDrop &gt; 0)
<a name="l01964"></a>01964                         {
<a name="l01965"></a>01965                               ubNowDropping = min( ubLeftToDrop, ubHowManyMaxAtATime );
<a name="l01966"></a>01966 
<a name="l01967"></a>01967                               <a class="code" href="Arms_01Dealer_01Init_8cpp.html#c6913d77b80e91fd19844e076df0d56f">MakeObjectOutOfDealerItems</a>( usItemIndex, &amp;SpclItemInfo, &amp;TempObject, ubNowDropping );
<a name="l01968"></a>01968                               <a class="code" href="Handle_01Items_8cpp.html#ca7f6f6da97e9a4c2b737296485f5c84">AddItemToPool</a>( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#51447f3682efa6541df7c607f8e36e78">sInitialGridNo</a>, &amp;TempObject, INVISIBLE, 0, 0, 0 );
<a name="l01969"></a>01969                               
<a name="l01970"></a>01970                               ubLeftToDrop -= ubNowDropping;
<a name="l01971"></a>01971                         }
<a name="l01972"></a>01972 
<a name="l01973"></a>01973                         <span class="comment">// remove them all from his inventory</span>
<a name="l01974"></a>01974                         <a class="code" href="Arms_01Dealer_01Init_8cpp.html#20c2feeb94c93f8c59da42a4c81a1fbf">RemoveItemFromArmsDealerInventory</a>( bArmsDealer, usItemIndex, &amp;SpclItemInfo, <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ bArmsDealer ][ usItemIndex ].ubPerfectItems );
<a name="l01975"></a>01975                   }
<a name="l01976"></a>01976 
<a name="l01977"></a>01977                   <span class="comment">// then drop all the special items</span>
<a name="l01978"></a>01978                   <span class="keywordflow">for</span> ( ubElement = 0; ubElement &lt; <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ bArmsDealer ][ usItemIndex ].<a class="code" href="structDEALER__ITEM__HEADER.html#26a9a14e537aa677de5829a0e6eb4171">ubElementsAlloced</a>; ubElement++ )
<a name="l01979"></a>01979                   {
<a name="l01980"></a>01980                         pSpecialItem = &amp;(<a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ bArmsDealer ][ usItemIndex ].SpecialItem[ ubElement ]);
<a name="l01981"></a>01981 
<a name="l01982"></a>01982                         <span class="keywordflow">if</span> ( pSpecialItem-&gt;<a class="code" href="structDEALER__SPECIAL__ITEM.html#8e5729c037fec59f4b84fb0461bdc94c">fActive</a> )
<a name="l01983"></a>01983                         {
<a name="l01984"></a>01984                               <a class="code" href="Arms_01Dealer_01Init_8cpp.html#c6913d77b80e91fd19844e076df0d56f">MakeObjectOutOfDealerItems</a>(usItemIndex, &amp;(pSpecialItem-&gt;<a class="code" href="structDEALER__SPECIAL__ITEM.html#78c6acb0b30410467408b1cc0de8cb3e">Info</a>), &amp;TempObject, 1 );
<a name="l01985"></a>01985                               <a class="code" href="Handle_01Items_8cpp.html#ca7f6f6da97e9a4c2b737296485f5c84">AddItemToPool</a>( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#51447f3682efa6541df7c607f8e36e78">sInitialGridNo</a>, &amp;TempObject, INVISIBLE, 0, 0, 0 );
<a name="l01986"></a>01986                               <a class="code" href="Arms_01Dealer_01Init_8cpp.html#20c2feeb94c93f8c59da42a4c81a1fbf">RemoveItemFromArmsDealerInventory</a>( bArmsDealer, usItemIndex, &amp;(pSpecialItem-&gt;<a class="code" href="structDEALER__SPECIAL__ITEM.html#78c6acb0b30410467408b1cc0de8cb3e">Info</a>), 1 );
<a name="l01987"></a>01987                         }
<a name="l01988"></a>01988                   }
<a name="l01989"></a>01989 
<a name="l01990"></a>01990                   <span class="comment">// release any memory allocated for special items, he won't need it now...</span>
<a name="l01991"></a>01991                   <span class="keywordflow">if</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ bArmsDealer ][ usItemIndex ].ubElementsAlloced &gt; 0 )
<a name="l01992"></a>01992                   {
<a name="l01993"></a>01993                         <a class="code" href="Arms_01Dealer_01Init_8cpp.html#99b7de7235e1411faa3c0702f649fa0a">FreeSpecialItemArray</a>( &amp;<a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ bArmsDealer ][ usItemIndex ] );
<a name="l01994"></a>01994                   }
<a name="l01995"></a>01995             }
<a name="l01996"></a>01996       }
<a name="l01997"></a>01997 
<a name="l01998"></a>01998       <span class="comment">//if the dealer has money</span>
<a name="l01999"></a>01999       <span class="keywordflow">if</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#efac177a506b89c636fdab5eeccd37d8">gArmsDealerStatus</a>[ bArmsDealer ].uiArmsDealersCash &gt; 0 )
<a name="l02000"></a>02000       {
<a name="l02001"></a>02001             <span class="comment">//Create the object</span>
<a name="l02002"></a>02002             memset( &amp;TempObject, 0, <span class="keyword">sizeof</span>( <a class="code" href="structOBJECTTYPE.html">OBJECTTYPE</a> ) );
<a name="l02003"></a>02003             <span class="keywordflow">if</span>( !<a class="code" href="Items_8cpp.html#4c9554fab4720df507dcd5c1bebbdff1">CreateMoney</a>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#efac177a506b89c636fdab5eeccd37d8">gArmsDealerStatus</a>[ bArmsDealer ].uiArmsDealersCash, &amp;TempObject ) )
<a name="l02004"></a>02004             {
<a name="l02005"></a>02005                   <span class="keywordflow">return</span>( FALSE );
<a name="l02006"></a>02006             }
<a name="l02007"></a>02007 
<a name="l02008"></a>02008             <span class="comment">//add the money item to the dealers feet</span>
<a name="l02009"></a>02009             <a class="code" href="Handle_01Items_8cpp.html#ca7f6f6da97e9a4c2b737296485f5c84">AddItemToPool</a>( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#51447f3682efa6541df7c607f8e36e78">sInitialGridNo</a>, &amp;TempObject, INVISIBLE, 0, 0, 0 );
<a name="l02010"></a>02010 
<a name="l02011"></a>02011             <a class="code" href="Arms_01Dealer_01Init_8cpp.html#efac177a506b89c636fdab5eeccd37d8">gArmsDealerStatus</a>[ bArmsDealer ].<a class="code" href="structARMS__DEALER__STATUS.html#d38e8396a23c958c7c5d715313008499">uiArmsDealersCash</a> = 0;
<a name="l02012"></a>02012       }
<a name="l02013"></a>02013 
<a name="l02014"></a>02014 
<a name="l02015"></a>02015       <span class="keywordflow">return</span>( TRUE );
<a name="l02016"></a>02016 }
<a name="l02017"></a>02017 
<a name="l02018"></a>02018 
<a name="l02019"></a><a class="code" href="Arms_01Dealer_01Init_8h.html#c6913d77b80e91fd19844e076df0d56f">02019</a> <span class="keywordtype">void</span> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#c6913d77b80e91fd19844e076df0d56f">MakeObjectOutOfDealerItems</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usItemIndex, <a class="code" href="structSPECIAL__ITEM__INFO.html">SPECIAL_ITEM_INFO</a> *pSpclItemInfo, OBJECTTYPE *pObject, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubHowMany )
<a name="l02020"></a>02020 {
<a name="l02021"></a>02021       <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bItemCondition;
<a name="l02022"></a>02022       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubCnt;
<a name="l02023"></a>02023 
<a name="l02024"></a>02024 
<a name="l02025"></a>02025       bItemCondition = pSpclItemInfo-&gt;<a class="code" href="structSPECIAL__ITEM__INFO.html#a63af49b3ae129222cab2d4de0b44b8a">bItemCondition</a>;
<a name="l02026"></a>02026 
<a name="l02027"></a>02027       <span class="comment">//if the item condition is below 0, the item is in for repairs, so flip the sign</span>
<a name="l02028"></a>02028       <span class="keywordflow">if</span>( bItemCondition &lt; 0 )
<a name="l02029"></a>02029       {
<a name="l02030"></a>02030             bItemCondition *= -1;
<a name="l02031"></a>02031       }
<a name="l02032"></a>02032 
<a name="l02033"></a>02033       memset( pObject, 0, <span class="keyword">sizeof</span>( OBJECTTYPE ) );
<a name="l02034"></a>02034 
<a name="l02035"></a>02035       <span class="comment">//Create the item object</span>
<a name="l02036"></a>02036       <a class="code" href="Items_8cpp.html#19aed5cbf530232ff0e01c7d6e58bd8e">CreateItems</a>( usItemIndex, bItemCondition, ubHowMany, pObject );
<a name="l02037"></a>02037 
<a name="l02038"></a>02038       <span class="comment">// set the ImprintID</span>
<a name="l02039"></a>02039       pObject-&gt;<a class="code" href="structOBJECTTYPE.html#bbf8833330a114c5ff8d0d95e51bee92">ubImprintID</a> = pSpclItemInfo-&gt;<a class="code" href="structSPECIAL__ITEM__INFO.html#96e004707e2126c879cd26b7a5ccac47">ubImprintID</a>;
<a name="l02040"></a>02040 
<a name="l02041"></a>02041       <span class="comment">// add any attachments we've been storing</span>
<a name="l02042"></a>02042       <span class="keywordflow">for</span> ( ubCnt = 0; ubCnt &lt; MAX_ATTACHMENTS; ubCnt++ )
<a name="l02043"></a>02043       {
<a name="l02044"></a>02044             <span class="keywordflow">if</span> ( pSpclItemInfo-&gt;<a class="code" href="structSPECIAL__ITEM__INFO.html#39d915d827ed63966b91e3c95a57e1bd">usAttachment</a>[ ubCnt ] != <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4c157bdf0b85a40d2619cbc8bc1ae5fe2">NONE</a> )
<a name="l02045"></a>02045             {
<a name="l02046"></a>02046                   <span class="comment">// store what it is, and its condition</span>
<a name="l02047"></a>02047                   pObject-&gt;<a class="code" href="structOBJECTTYPE.html#427bef1c8b3d44d79d8f552ca1d774aa">usAttachItem</a>[ ubCnt ]  = pSpclItemInfo-&gt;<a class="code" href="structSPECIAL__ITEM__INFO.html#39d915d827ed63966b91e3c95a57e1bd">usAttachment</a>[ ubCnt ];
<a name="l02048"></a>02048                   pObject-&gt;<a class="code" href="structOBJECTTYPE.html#502ef8951e7613e2466bdf83927a7281">bAttachStatus</a>[ ubCnt ] = pSpclItemInfo-&gt;<a class="code" href="structSPECIAL__ITEM__INFO.html#4cf8293f87f597df36d5c37632c06fe1">bAttachmentStatus</a>[ ubCnt ];
<a name="l02049"></a>02049             }
<a name="l02050"></a>02050       }
<a name="l02051"></a>02051 
<a name="l02052"></a>02052       <span class="comment">// if it's a gun</span>
<a name="l02053"></a>02053       <span class="keywordflow">if</span> (<a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a> [ pObject-&gt;usItem ].<a class="code" href="structINVTYPE.html#1f63e61536407cc997a998585017ba07">usItemClass</a> == IC_GUN )
<a name="l02054"></a>02054       {
<a name="l02055"></a>02055             <span class="comment">// Empty out the bullets put in by CreateItem().  We now sell all guns empty of bullets.  This is so that we don't </span>
<a name="l02056"></a>02056             <span class="comment">// have to keep track of #bullets in a gun throughout dealer inventory.  Without this, players could "reload" guns</span>
<a name="l02057"></a>02057             <span class="comment">// they don't have ammo for by selling them to Tony &amp; buying them right back fully loaded!  One could repeat this</span>
<a name="l02058"></a>02058             <span class="comment">// ad nauseum (empty the gun between visits) as a (really expensive) way to get unlimited special ammo like rockets.</span>
<a name="l02059"></a>02059             pObject-&gt;ubGunShotsLeft = 0;
<a name="l02060"></a>02060       }
<a name="l02061"></a>02061 }
<a name="l02062"></a>02062 
<a name="l02063"></a>02063 
<a name="l02064"></a>02064 
<a name="l02065"></a><a class="code" href="Arms_01Dealer_01Init_8h.html#3559196b87d87558bee81513d2c1923f">02065</a> <span class="keywordtype">void</span> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#3559196b87d87558bee81513d2c1923f">GiveObjectToArmsDealerForRepair</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer, OBJECTTYPE *pObject, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubOwnerProfileId )
<a name="l02066"></a>02066 {
<a name="l02067"></a>02067 <span class="comment">//    UINT8 ubCnt;</span>
<a name="l02068"></a>02068       <a class="code" href="structSPECIAL__ITEM__INFO.html">SPECIAL_ITEM_INFO</a> SpclItemInfo;
<a name="l02069"></a>02069 
<a name="l02070"></a>02070 
<a name="l02071"></a>02071       Assert( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#160b9cd6e425f5db5ac75fc6269d2f70">DoesDealerDoRepairs</a>( ubArmsDealer ) );
<a name="l02072"></a>02072 
<a name="l02073"></a>02073       <span class="comment">// Any object passed into here must already be:</span>
<a name="l02074"></a>02074       <span class="comment">//          a) Unstacked</span>
<a name="l02075"></a>02075       Assert( pObject-&gt;<a class="code" href="structOBJECTTYPE.html#84ab3cbeb7dfdcc2e5ad4051e165d294">ubNumberOfObjects</a> == 1 );
<a name="l02076"></a>02076 
<a name="l02077"></a>02077       <span class="comment">//          b) Repairable</span>
<a name="l02078"></a>02078       Assert( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#4f53de9538c252842e64e6eac9b1326d">CanDealerRepairItem</a>( ubArmsDealer, pObject-&gt;<a class="code" href="structOBJECTTYPE.html#4fbe05335f161f08f354566b8e5a0a19">usItem</a> ) );
<a name="l02079"></a>02079 
<a name="l02080"></a>02080       <span class="comment">//          c) Actually damaged, or a rocket rifle (being reset)</span>
<a name="l02081"></a>02081       Assert( ( pObject-&gt;<a class="code" href="structOBJECTTYPE.html#aa0827e15c8e54d285d2850ea5ffbb07">bStatus</a>[ 0 ] &lt; 100 ) || <a class="code" href="Arms_01Dealer_01Init_8cpp.html#5e66eb4229dd9479536b22c5320de161">ItemIsARocketRifle</a>( pObject-&gt;<a class="code" href="structOBJECTTYPE.html#4fbe05335f161f08f354566b8e5a0a19">usItem</a> ) );
<a name="l02082"></a>02082 
<a name="l02083"></a>02083 <span class="comment">/* ARM: Can now repair with removeable attachments still attached...</span>
<a name="l02084"></a>02084 <span class="comment">      //          d) Already stripped of all *detachable* attachments</span>
<a name="l02085"></a>02085 <span class="comment">      for( ubCnt = 0; ubCnt &lt; MAX_ATTACHMENTS; ubCnt++ )</span>
<a name="l02086"></a>02086 <span class="comment">      {</span>
<a name="l02087"></a>02087 <span class="comment">            if ( pObject-&gt;usAttachItem[ ubCnt ] != NONE )</span>
<a name="l02088"></a>02088 <span class="comment">            {</span>
<a name="l02089"></a>02089 <span class="comment">                  // If the attachment is detachable</span>
<a name="l02090"></a>02090 <span class="comment">                  if (! (Item[ pObject-&gt;usAttachItem[ubCnt] ].fFlags &amp; ITEM_INSEPARABLE ) )</span>
<a name="l02091"></a>02091 <span class="comment">                  {</span>
<a name="l02092"></a>02092 <span class="comment">                        Assert( 0 );</span>
<a name="l02093"></a>02093 <span class="comment">                  }</span>
<a name="l02094"></a>02094 <span class="comment">            }</span>
<a name="l02095"></a>02095 <span class="comment">      }</span>
<a name="l02096"></a>02096 <span class="comment">*/</span>
<a name="l02097"></a>02097 
<a name="l02098"></a>02098       <span class="comment">//          e) If a gun, stripped of any non-ammo-class GunAmmoItems, and bullets</span>
<a name="l02099"></a>02099       <span class="keywordflow">if</span> (<a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a> [ pObject-&gt;<a class="code" href="structOBJECTTYPE.html#4fbe05335f161f08f354566b8e5a0a19">usItem</a> ].usItemClass == IC_GUN )
<a name="l02100"></a>02100       {
<a name="l02101"></a>02101             <span class="comment">// if any GunAmmoItem is specified</span>
<a name="l02102"></a>02102             <span class="keywordflow">if</span>( pObject-&gt;<a class="code" href="structOBJECTTYPE.html#7b0dbe4816379f07f63493c422871c04">usGunAmmoItem</a> != <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4c157bdf0b85a40d2619cbc8bc1ae5fe2">NONE</a>)
<a name="l02103"></a>02103             {
<a name="l02104"></a>02104                   <span class="comment">// it better be regular ammo, and empty</span>
<a name="l02105"></a>02105                   Assert( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ pObject-&gt;<a class="code" href="structOBJECTTYPE.html#7b0dbe4816379f07f63493c422871c04">usGunAmmoItem</a> ].usItemClass == IC_AMMO );
<a name="l02106"></a>02106                   Assert( pObject-&gt;<a class="code" href="structOBJECTTYPE.html#d8f322b99df185cfeb027d9e0ec42964">ubGunShotsLeft</a> == 0 );
<a name="l02107"></a>02107             }
<a name="l02108"></a>02108       }
<a name="l02109"></a>02109 
<a name="l02110"></a>02110 
<a name="l02111"></a>02111       <a class="code" href="Arms_01Dealer_01Init_8cpp.html#8c87923914aad21c8e8e9227e6f96d65">SetSpecialItemInfoFromObject</a>( &amp;SpclItemInfo, pObject );
<a name="l02112"></a>02112 
<a name="l02113"></a>02113       <span class="comment">// ok, given all that, now everything is easy!</span>
<a name="l02114"></a>02114       <span class="comment">// if the gun was jammed, this will forget about the jam (i.e. dealer immediately unjams anything he will be repairing)</span>
<a name="l02115"></a>02115       <a class="code" href="Arms_01Dealer_01Init_8cpp.html#9c3d5bca7fc9a515a38748e19e065ff2">GiveItemToArmsDealerforRepair</a>( ubArmsDealer, pObject-&gt;<a class="code" href="structOBJECTTYPE.html#4fbe05335f161f08f354566b8e5a0a19">usItem</a>, &amp;SpclItemInfo, ubOwnerProfileId );
<a name="l02116"></a>02116 }
<a name="l02117"></a>02117 
<a name="l02118"></a>02118 
<a name="l02119"></a>02119 <span class="comment">//PLEASE: Use GiveObjectToArmsDealerForRepair() instead of this when repairing a item in OBJECTTYPE format.</span>
<a name="l02120"></a><a class="code" href="Arms_01Dealer_01Init_8h.html#9c3d5bca7fc9a515a38748e19e065ff2">02120</a> <span class="keywordtype">void</span> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#9c3d5bca7fc9a515a38748e19e065ff2">GiveItemToArmsDealerforRepair</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usItemIndex, <a class="code" href="structSPECIAL__ITEM__INFO.html">SPECIAL_ITEM_INFO</a> *pSpclItemInfo, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubOwnerProfileId )
<a name="l02121"></a>02121 {
<a name="l02122"></a>02122       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>      uiTimeWhenFreeToStartIt;
<a name="l02123"></a>02123       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>      uiMinutesToFix;
<a name="l02124"></a>02124       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>  uiMinutesShopClosedBeforeItsDone;
<a name="l02125"></a>02125       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>      uiDoneWhen;
<a name="l02126"></a>02126 
<a name="l02127"></a>02127 
<a name="l02128"></a>02128       Assert( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#160b9cd6e425f5db5ac75fc6269d2f70">DoesDealerDoRepairs</a>( ubArmsDealer ) );
<a name="l02129"></a>02129       Assert( pSpclItemInfo-&gt;<a class="code" href="structSPECIAL__ITEM__INFO.html#a63af49b3ae129222cab2d4de0b44b8a">bItemCondition</a> &gt; 0 );
<a name="l02130"></a>02130       Assert( ( pSpclItemInfo-&gt;<a class="code" href="structSPECIAL__ITEM__INFO.html#a63af49b3ae129222cab2d4de0b44b8a">bItemCondition</a> &lt; 100 ) || <a class="code" href="Arms_01Dealer_01Init_8cpp.html#5e66eb4229dd9479536b22c5320de161">ItemIsARocketRifle</a>( usItemIndex ) );
<a name="l02131"></a>02131 
<a name="l02132"></a>02132       <span class="comment">// figure out the earliest the repairman will be free to start repairing this item</span>
<a name="l02133"></a>02133       uiTimeWhenFreeToStartIt = <a class="code" href="Arms_01Dealer_01Init_8cpp.html#8402879bfcd0e524916f10a30c94b40b">WhenWillRepairmanBeAllDoneRepairing</a>( ubArmsDealer );
<a name="l02134"></a>02134 
<a name="l02135"></a>02135       <span class="comment">//Determine how long it will take to fix</span>
<a name="l02136"></a>02136       uiMinutesToFix = <a class="code" href="Arms_01Dealer_01Init_8cpp.html#effe881901a8c82f1a79d6907eaae763">CalculateSpecialItemRepairTime</a>( ubArmsDealer, usItemIndex, pSpclItemInfo );
<a name="l02137"></a>02137 
<a name="l02138"></a>02138       uiMinutesShopClosedBeforeItsDone = <a class="code" href="Arms_01Dealer_01Init_8cpp.html#7e3791d1dfd7770aa0c20a05d91a185f">CalculateOvernightRepairDelay</a>( ubArmsDealer, uiTimeWhenFreeToStartIt, uiMinutesToFix );
<a name="l02139"></a>02139 
<a name="l02140"></a>02140       <span class="comment">// clock time when this will finally be ready</span>
<a name="l02141"></a>02141       uiDoneWhen = uiTimeWhenFreeToStartIt + uiMinutesToFix + uiMinutesShopClosedBeforeItsDone;
<a name="l02142"></a>02142 
<a name="l02143"></a>02143       <span class="comment">// Negate the status</span>
<a name="l02144"></a>02144       pSpclItemInfo-&gt;<a class="code" href="structSPECIAL__ITEM__INFO.html#a63af49b3ae129222cab2d4de0b44b8a">bItemCondition</a> *= -1;
<a name="l02145"></a>02145 
<a name="l02146"></a>02146       <span class="comment">// give it to the dealer</span>
<a name="l02147"></a>02147       <a class="code" href="Arms_01Dealer_01Init_8cpp.html#0da9a30648c5360e44cac7e2461ea3bb">AddItemToArmsDealerInventory</a>( ubArmsDealer, usItemIndex, pSpclItemInfo, 1 );
<a name="l02148"></a>02148 
<a name="l02149"></a>02149       <span class="comment">//Set the time at which item will be fixed</span>
<a name="l02150"></a>02150       <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].<a class="code" href="structDEALER__ITEM__HEADER.html#bfdb0e8735b1864b79c158d6e65412ef">SpecialItem</a>[ <a class="code" href="Arms_01Dealer_01Init_8cpp.html#396ff211074975473456e0ecf8b7b893">gubLastSpecialItemAddedAtElement</a> ].<a class="code" href="structDEALER__SPECIAL__ITEM.html#f253fcbc3cf87461c26529265734ea44">uiRepairDoneTime</a> = uiDoneWhen;
<a name="l02151"></a>02151       <span class="comment">//Remember the original owner of the item</span>
<a name="l02152"></a>02152       <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].<a class="code" href="structDEALER__ITEM__HEADER.html#bfdb0e8735b1864b79c158d6e65412ef">SpecialItem</a>[ <a class="code" href="Arms_01Dealer_01Init_8cpp.html#396ff211074975473456e0ecf8b7b893">gubLastSpecialItemAddedAtElement</a> ].<a class="code" href="structDEALER__SPECIAL__ITEM.html#4e53a6a6fa4c315f35a9e42edd7b2286">ubOwnerProfileId</a> = ubOwnerProfileId;
<a name="l02153"></a>02153 }
<a name="l02154"></a>02154 
<a name="l02155"></a>02155 
<a name="l02156"></a>02156 
<a name="l02157"></a><a class="code" href="Arms_01Dealer_01Init_8h.html#8402879bfcd0e524916f10a30c94b40b">02157</a> <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#8402879bfcd0e524916f10a30c94b40b">WhenWillRepairmanBeAllDoneRepairing</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer )
<a name="l02158"></a>02158 {
<a name="l02159"></a>02159       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>      uiWhenFree;
<a name="l02160"></a>02160       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>      usItemIndex;
<a name="l02161"></a>02161       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>       ubElement;
<a name="l02162"></a>02162 
<a name="l02163"></a>02163       Assert( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#160b9cd6e425f5db5ac75fc6269d2f70">DoesDealerDoRepairs</a>( ubArmsDealer ) );
<a name="l02164"></a>02164 
<a name="l02165"></a>02165       <span class="comment">// if nothing is in for repairs, he'll be free RIGHT NOW!</span>
<a name="l02166"></a>02166       uiWhenFree = <a class="code" href="Game_01Clock_8cpp.html#4d255e800fba4d64144a7639d5f3421d">GetWorldTotalMin</a>();
<a name="l02167"></a>02167 
<a name="l02168"></a>02168       <span class="comment">//loop through the dealers inventory</span>
<a name="l02169"></a>02169       <span class="keywordflow">for</span>( usItemIndex = 1; usItemIndex &lt; <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f40efaf5227d3f780f8db037c71e3f903f">MAXITEMS</a>; usItemIndex++ )
<a name="l02170"></a>02170       {
<a name="l02171"></a>02171             <span class="keywordflow">if</span> ( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usItemIndex].usItemClass  == 0 )
<a name="l02172"></a>02172                   <span class="keywordflow">break</span>;
<a name="l02173"></a>02173             <span class="comment">//if there is some items in stock</span>
<a name="l02174"></a>02174             <span class="keywordflow">if</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].ubTotalItems &gt; 0 )
<a name="l02175"></a>02175             {
<a name="l02176"></a>02176                   <span class="keywordflow">for</span> ( ubElement = 0; ubElement &lt; <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].<a class="code" href="structDEALER__ITEM__HEADER.html#26a9a14e537aa677de5829a0e6eb4171">ubElementsAlloced</a>; ubElement++ )
<a name="l02177"></a>02177                   {
<a name="l02178"></a>02178                         <span class="keywordflow">if</span> ( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].SpecialItem[ ubElement ].fActive )
<a name="l02179"></a>02179                         {
<a name="l02180"></a>02180                               <span class="comment">//if the item is in for repairs</span>
<a name="l02181"></a>02181                               <span class="keywordflow">if</span>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].SpecialItem[ ubElement ].Info.bItemCondition &lt; 0 )
<a name="l02182"></a>02182                               {
<a name="l02183"></a>02183                                     <span class="comment">// if this item will be done later than the latest we've found so far</span>
<a name="l02184"></a>02184                                     <a class="code" href="Soldier_01Ani_8cpp.html#c294aa65f0375eb6343a2de2a25dafcc">if</a> ( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].SpecialItem[ ubElement ].uiRepairDoneTime &gt; uiWhenFree )
<a name="l02185"></a>02185                                     {
<a name="l02186"></a>02186                                           <span class="comment">// then we're busy til then!</span>
<a name="l02187"></a>02187                                           uiWhenFree = <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>[ ubArmsDealer ][ usItemIndex ].SpecialItem[ ubElement ].uiRepairDoneTime;
<a name="l02188"></a>02188                                     }
<a name="l02189"></a>02189                               }
<a name="l02190"></a>02190                         }
<a name="l02191"></a>02191                   }
<a name="l02192"></a>02192             }
<a name="l02193"></a>02193       }
<a name="l02194"></a>02194 
<a name="l02195"></a>02195       <span class="keywordflow">return</span>( uiWhenFree );
<a name="l02196"></a>02196 }
<a name="l02197"></a>02197 
<a name="l02198"></a>02198 
<a name="l02199"></a>02199 
<a name="l02200"></a><a class="code" href="Arms_01Dealer_01Init_8h.html#effe881901a8c82f1a79d6907eaae763">02200</a> <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#effe881901a8c82f1a79d6907eaae763">CalculateSpecialItemRepairTime</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usItemIndex, <a class="code" href="structSPECIAL__ITEM__INFO.html">SPECIAL_ITEM_INFO</a> *pSpclItemInfo )
<a name="l02201"></a>02201 {
<a name="l02202"></a>02202       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiRepairTime;
<a name="l02203"></a>02203       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubCnt;
<a name="l02204"></a>02204 
<a name="l02205"></a>02205       uiRepairTime = <a class="code" href="Arms_01Dealer_01Init_8cpp.html#d1c1c47ff7487941c114d81ff4ed7727">CalculateSimpleItemRepairTime</a>( ubArmsDealer, usItemIndex, pSpclItemInfo-&gt;<a class="code" href="structSPECIAL__ITEM__INFO.html#a63af49b3ae129222cab2d4de0b44b8a">bItemCondition</a> );
<a name="l02206"></a>02206 
<a name="l02207"></a>02207       <span class="comment">// add time to repair any attachments on it</span>
<a name="l02208"></a>02208       <span class="keywordflow">for</span> ( ubCnt = 0; ubCnt &lt; MAX_ATTACHMENTS; ubCnt++ )
<a name="l02209"></a>02209       {
<a name="l02210"></a>02210             <span class="keywordflow">if</span> ( pSpclItemInfo-&gt;<a class="code" href="structSPECIAL__ITEM__INFO.html#39d915d827ed63966b91e3c95a57e1bd">usAttachment</a>[ ubCnt ] != <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4c157bdf0b85a40d2619cbc8bc1ae5fe2">NONE</a> )
<a name="l02211"></a>02211             {
<a name="l02212"></a>02212                   <span class="comment">// if damaged and repairable</span>
<a name="l02213"></a>02213                   <a class="code" href="Soldier_01Ani_8cpp.html#c294aa65f0375eb6343a2de2a25dafcc">if</a> ( ( pSpclItemInfo-&gt;<a class="code" href="structSPECIAL__ITEM__INFO.html#4cf8293f87f597df36d5c37632c06fe1">bAttachmentStatus</a>[ ubCnt ] &lt; 100 ) &amp;&amp; <a class="code" href="Arms_01Dealer_01Init_8cpp.html#4f53de9538c252842e64e6eac9b1326d">CanDealerRepairItem</a>( ubArmsDealer, pSpclItemInfo-&gt;<a class="code" href="structSPECIAL__ITEM__INFO.html#39d915d827ed63966b91e3c95a57e1bd">usAttachment</a>[ ubCnt ] ) )
<a name="l02214"></a>02214                   {
<a name="l02215"></a>02215                         uiRepairTime += <a class="code" href="Arms_01Dealer_01Init_8cpp.html#d1c1c47ff7487941c114d81ff4ed7727">CalculateSimpleItemRepairTime</a>( ubArmsDealer, pSpclItemInfo-&gt;<a class="code" href="structSPECIAL__ITEM__INFO.html#39d915d827ed63966b91e3c95a57e1bd">usAttachment</a>[ ubCnt ], pSpclItemInfo-&gt;<a class="code" href="structSPECIAL__ITEM__INFO.html#4cf8293f87f597df36d5c37632c06fe1">bAttachmentStatus</a>[ ubCnt ] );
<a name="l02216"></a>02216                   }
<a name="l02217"></a>02217             }
<a name="l02218"></a>02218       }
<a name="l02219"></a>02219 
<a name="l02220"></a>02220       <span class="keywordflow">return</span>( uiRepairTime );
<a name="l02221"></a>02221 }
<a name="l02222"></a>02222 
<a name="l02223"></a>02223 
<a name="l02224"></a><a class="code" href="Arms_01Dealer_01Init_8h.html#64b7dd75cb71220ed420d3d2e358dbd1">02224</a> <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#64b7dd75cb71220ed420d3d2e358dbd1">CalculateObjectItemRepairTime</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer, OBJECTTYPE *pItemObject )
<a name="l02225"></a>02225 {
<a name="l02226"></a>02226       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiRepairTime;
<a name="l02227"></a>02227       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubCnt;
<a name="l02228"></a>02228 
<a name="l02229"></a>02229       uiRepairTime = <a class="code" href="Arms_01Dealer_01Init_8cpp.html#d1c1c47ff7487941c114d81ff4ed7727">CalculateSimpleItemRepairTime</a>( ubArmsDealer, pItemObject-&gt;<a class="code" href="structOBJECTTYPE.html#4fbe05335f161f08f354566b8e5a0a19">usItem</a>, pItemObject-&gt;<a class="code" href="structOBJECTTYPE.html#aa0827e15c8e54d285d2850ea5ffbb07">bStatus</a>[ 0 ] );
<a name="l02230"></a>02230 
<a name="l02231"></a>02231       <span class="comment">// add time to repair any attachments on it</span>
<a name="l02232"></a>02232       <span class="keywordflow">for</span> ( ubCnt = 0; ubCnt &lt; MAX_ATTACHMENTS; ubCnt++ )
<a name="l02233"></a>02233       {
<a name="l02234"></a>02234             <span class="keywordflow">if</span> ( pItemObject-&gt;<a class="code" href="structOBJECTTYPE.html#427bef1c8b3d44d79d8f552ca1d774aa">usAttachItem</a>[ ubCnt ] != <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4c157bdf0b85a40d2619cbc8bc1ae5fe2">NONE</a> )
<a name="l02235"></a>02235             {
<a name="l02236"></a>02236                   <span class="comment">// if damaged and repairable</span>
<a name="l02237"></a>02237                   <a class="code" href="Soldier_01Ani_8cpp.html#c294aa65f0375eb6343a2de2a25dafcc">if</a> ( ( pItemObject-&gt;<a class="code" href="structOBJECTTYPE.html#502ef8951e7613e2466bdf83927a7281">bAttachStatus</a>[ ubCnt ] &lt; 100 ) &amp;&amp; <a class="code" href="Arms_01Dealer_01Init_8cpp.html#4f53de9538c252842e64e6eac9b1326d">CanDealerRepairItem</a>( ubArmsDealer, pItemObject-&gt;<a class="code" href="structOBJECTTYPE.html#427bef1c8b3d44d79d8f552ca1d774aa">usAttachItem</a>[ ubCnt ] ) )
<a name="l02238"></a>02238                   {
<a name="l02239"></a>02239                         uiRepairTime += <a class="code" href="Arms_01Dealer_01Init_8cpp.html#d1c1c47ff7487941c114d81ff4ed7727">CalculateSimpleItemRepairTime</a>( ubArmsDealer, pItemObject-&gt;<a class="code" href="structOBJECTTYPE.html#427bef1c8b3d44d79d8f552ca1d774aa">usAttachItem</a>[ ubCnt ], pItemObject-&gt;<a class="code" href="structOBJECTTYPE.html#502ef8951e7613e2466bdf83927a7281">bAttachStatus</a>[ ubCnt ] );
<a name="l02240"></a>02240                   }
<a name="l02241"></a>02241             }
<a name="l02242"></a>02242       }
<a name="l02243"></a>02243 
<a name="l02244"></a>02244       <span class="keywordflow">return</span>( uiRepairTime );
<a name="l02245"></a>02245 }
<a name="l02246"></a>02246 
<a name="l02247"></a>02247 
<a name="l02248"></a><a class="code" href="Arms_01Dealer_01Init_8h.html#d1c1c47ff7487941c114d81ff4ed7727">02248</a> <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#d1c1c47ff7487941c114d81ff4ed7727">CalculateSimpleItemRepairTime</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usItemIndex, <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bItemCondition )
<a name="l02249"></a>02249 {
<a name="l02250"></a>02250       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>      uiTimeToRepair = 0;
<a name="l02251"></a>02251       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>      uiRepairCost = 0;
<a name="l02252"></a>02252 
<a name="l02253"></a>02253       Assert( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#160b9cd6e425f5db5ac75fc6269d2f70">DoesDealerDoRepairs</a>( ubArmsDealer ) );
<a name="l02254"></a>02254 
<a name="l02255"></a>02255       <span class="comment">// first calc what he'll charge - that takes care of item condition, repair ease, and his repair cost "markup"</span>
<a name="l02256"></a>02256       uiRepairCost = <a class="code" href="Arms_01Dealer_01Init_8cpp.html#4af1e8c0c43e686e7e609734e0067559">CalculateSimpleItemRepairCost</a>( ubArmsDealer, usItemIndex, bItemCondition );
<a name="l02257"></a>02257 
<a name="l02258"></a>02258       <span class="comment">// Now adjust that for the repairman's individual repair speed.</span>
<a name="l02259"></a>02259       <span class="comment">// For a repairman, his BUY modifier controls his REPAIR SPEED (1.0 means minutes to repair = price in $)</span>
<a name="l02260"></a>02260       <span class="comment">// with a REPAIR SPEED of 1.0, typical gun price of $2000, and a REPAIR COST of 0.5 this works out to 16.6 hrs</span>
<a name="l02261"></a>02261       <span class="comment">//           for a full 100% status repair...  Not bad.</span>
<a name="l02262"></a>02262       uiTimeToRepair = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)( uiRepairCost * <a class="code" href="Arms_01Dealer_01Init_8cpp.html#230ecf6873ae948a09ae12f5b69c22e0">ArmsDealerInfo</a>[ ubArmsDealer ].dRepairSpeed );
<a name="l02263"></a>02263 
<a name="l02264"></a>02264       <span class="comment">// repairs on electronic items take twice as long if the guy doesn't have the skill</span>
<a name="l02265"></a>02265       <span class="comment">// for dealers, this means anyone but Fredo the Electronics guy takes twice as long (but doesn't charge double)</span>
<a name="l02266"></a>02266       <span class="comment">// (Mind you, current he's the ONLY one who CAN repair Electronics at all!  Oh well.)</span>
<a name="l02267"></a>02267 <span class="comment">//    if( ( Item[ usItemIndex ].fFlags &amp; ITEM_ELECTRONIC ) &amp;&amp; ( ubArmsDealer != ARMS_DEALER_FREDO ) )</span>
<a name="l02268"></a>02268       <span class="keywordflow">if</span>( ( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ usItemIndex ].electronic  ) &amp;&amp; ( ubArmsDealer != <a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc265c995026b7aa1751a756e7fa9bc66cf7">ARMS_DEALER_FREDO</a> ) )
<a name="l02269"></a>02269       {
<a name="l02270"></a>02270             uiTimeToRepair *= 2;
<a name="l02271"></a>02271       }
<a name="l02272"></a>02272 
<a name="l02273"></a>02273       <span class="comment">// avoid "instant" repairs on really cheap, barely damaged crap...</span>
<a name="l02274"></a>02274       <span class="keywordflow">if</span> (uiTimeToRepair &lt; MIN_REPAIR_TIME_IN_MINUTES)
<a name="l02275"></a>02275       {
<a name="l02276"></a>02276             uiTimeToRepair = MIN_REPAIR_TIME_IN_MINUTES;
<a name="l02277"></a>02277       }
<a name="l02278"></a>02278 
<a name="l02279"></a>02279       <span class="keywordflow">return</span>( uiTimeToRepair );
<a name="l02280"></a>02280 }
<a name="l02281"></a>02281 
<a name="l02282"></a>02282 
<a name="l02283"></a>02283 
<a name="l02284"></a><a class="code" href="Arms_01Dealer_01Init_8h.html#0c9c6d2ec03bb839a6697f91b3cf2437">02284</a> <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#0c9c6d2ec03bb839a6697f91b3cf2437">CalculateSpecialItemRepairCost</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usItemIndex, <a class="code" href="structSPECIAL__ITEM__INFO.html">SPECIAL_ITEM_INFO</a> *pSpclItemInfo )
<a name="l02285"></a>02285 {
<a name="l02286"></a>02286       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiRepairCost;
<a name="l02287"></a>02287       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubCnt;
<a name="l02288"></a>02288 
<a name="l02289"></a>02289       uiRepairCost = <a class="code" href="Arms_01Dealer_01Init_8cpp.html#4af1e8c0c43e686e7e609734e0067559">CalculateSimpleItemRepairCost</a>( ubArmsDealer, usItemIndex, pSpclItemInfo-&gt;<a class="code" href="structSPECIAL__ITEM__INFO.html#a63af49b3ae129222cab2d4de0b44b8a">bItemCondition</a> );
<a name="l02290"></a>02290 
<a name="l02291"></a>02291       <span class="comment">// add cost of repairing any attachments on it</span>
<a name="l02292"></a>02292       <span class="keywordflow">for</span> ( ubCnt = 0; ubCnt &lt; MAX_ATTACHMENTS; ubCnt++ )
<a name="l02293"></a>02293       {
<a name="l02294"></a>02294             <span class="keywordflow">if</span> ( pSpclItemInfo-&gt;<a class="code" href="structSPECIAL__ITEM__INFO.html#39d915d827ed63966b91e3c95a57e1bd">usAttachment</a>[ ubCnt ] != <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4c157bdf0b85a40d2619cbc8bc1ae5fe2">NONE</a> )
<a name="l02295"></a>02295             {
<a name="l02296"></a>02296                   <span class="comment">// if damaged and repairable</span>
<a name="l02297"></a>02297                   <a class="code" href="Soldier_01Ani_8cpp.html#c294aa65f0375eb6343a2de2a25dafcc">if</a> ( ( pSpclItemInfo-&gt;<a class="code" href="structSPECIAL__ITEM__INFO.html#4cf8293f87f597df36d5c37632c06fe1">bAttachmentStatus</a>[ ubCnt ] &lt; 100 ) &amp;&amp; <a class="code" href="Arms_01Dealer_01Init_8cpp.html#4f53de9538c252842e64e6eac9b1326d">CanDealerRepairItem</a>( ubArmsDealer, pSpclItemInfo-&gt;<a class="code" href="structSPECIAL__ITEM__INFO.html#39d915d827ed63966b91e3c95a57e1bd">usAttachment</a>[ ubCnt ] ) )
<a name="l02298"></a>02298                   {
<a name="l02299"></a>02299                         uiRepairCost += <a class="code" href="Arms_01Dealer_01Init_8cpp.html#4af1e8c0c43e686e7e609734e0067559">CalculateSimpleItemRepairCost</a>( ubArmsDealer, pSpclItemInfo-&gt;<a class="code" href="structSPECIAL__ITEM__INFO.html#39d915d827ed63966b91e3c95a57e1bd">usAttachment</a>[ ubCnt ], pSpclItemInfo-&gt;<a class="code" href="structSPECIAL__ITEM__INFO.html#4cf8293f87f597df36d5c37632c06fe1">bAttachmentStatus</a>[ ubCnt ] );
<a name="l02300"></a>02300                   }
<a name="l02301"></a>02301             }
<a name="l02302"></a>02302       }
<a name="l02303"></a>02303 
<a name="l02304"></a>02304       <span class="keywordflow">return</span>( uiRepairCost );
<a name="l02305"></a>02305 }
<a name="l02306"></a>02306 
<a name="l02307"></a>02307 
<a name="l02308"></a><a class="code" href="Arms_01Dealer_01Init_8h.html#345a31389cf12f65f92bca0a1ed57a96">02308</a> <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#345a31389cf12f65f92bca0a1ed57a96">CalculateObjectItemRepairCost</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer, <a class="code" href="structOBJECTTYPE.html">OBJECTTYPE</a> *pItemObject )
<a name="l02309"></a>02309 {
<a name="l02310"></a>02310       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiRepairCost;
<a name="l02311"></a>02311       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubCnt;
<a name="l02312"></a>02312 
<a name="l02313"></a>02313       uiRepairCost = <a class="code" href="Arms_01Dealer_01Init_8cpp.html#4af1e8c0c43e686e7e609734e0067559">CalculateSimpleItemRepairCost</a>( ubArmsDealer, pItemObject-&gt;<a class="code" href="structOBJECTTYPE.html#4fbe05335f161f08f354566b8e5a0a19">usItem</a>, pItemObject-&gt;<a class="code" href="structOBJECTTYPE.html#aa0827e15c8e54d285d2850ea5ffbb07">bStatus</a>[ 0 ] );
<a name="l02314"></a>02314 
<a name="l02315"></a>02315       <span class="comment">// add cost of repairing any attachments on it</span>
<a name="l02316"></a>02316       <span class="keywordflow">for</span> ( ubCnt = 0; ubCnt &lt; MAX_ATTACHMENTS; ubCnt++ )
<a name="l02317"></a>02317       {
<a name="l02318"></a>02318             <span class="keywordflow">if</span> ( pItemObject-&gt;<a class="code" href="structOBJECTTYPE.html#427bef1c8b3d44d79d8f552ca1d774aa">usAttachItem</a>[ ubCnt ] != <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4c157bdf0b85a40d2619cbc8bc1ae5fe2">NONE</a> )
<a name="l02319"></a>02319             {
<a name="l02320"></a>02320                   <span class="comment">// if damaged and repairable</span>
<a name="l02321"></a>02321                   <a class="code" href="Soldier_01Ani_8cpp.html#c294aa65f0375eb6343a2de2a25dafcc">if</a> ( ( pItemObject-&gt;<a class="code" href="structOBJECTTYPE.html#502ef8951e7613e2466bdf83927a7281">bAttachStatus</a>[ ubCnt ] &lt; 100 ) &amp;&amp; <a class="code" href="Arms_01Dealer_01Init_8cpp.html#4f53de9538c252842e64e6eac9b1326d">CanDealerRepairItem</a>( ubArmsDealer, pItemObject-&gt;<a class="code" href="structOBJECTTYPE.html#427bef1c8b3d44d79d8f552ca1d774aa">usAttachItem</a>[ ubCnt ] ) )
<a name="l02322"></a>02322                   {
<a name="l02323"></a>02323                         uiRepairCost += <a class="code" href="Arms_01Dealer_01Init_8cpp.html#4af1e8c0c43e686e7e609734e0067559">CalculateSimpleItemRepairCost</a>( ubArmsDealer, pItemObject-&gt;<a class="code" href="structOBJECTTYPE.html#427bef1c8b3d44d79d8f552ca1d774aa">usAttachItem</a>[ ubCnt ], pItemObject-&gt;<a class="code" href="structOBJECTTYPE.html#502ef8951e7613e2466bdf83927a7281">bAttachStatus</a>[ ubCnt ] );
<a name="l02324"></a>02324                   }
<a name="l02325"></a>02325             }
<a name="l02326"></a>02326       }
<a name="l02327"></a>02327 
<a name="l02328"></a>02328       <span class="keywordflow">return</span>( uiRepairCost );
<a name="l02329"></a>02329 }
<a name="l02330"></a>02330 
<a name="l02331"></a>02331 
<a name="l02332"></a><a class="code" href="Arms_01Dealer_01Init_8h.html#4af1e8c0c43e686e7e609734e0067559">02332</a> <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#4af1e8c0c43e686e7e609734e0067559">CalculateSimpleItemRepairCost</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usItemIndex, <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bItemCondition )
<a name="l02333"></a>02333 {
<a name="l02334"></a>02334       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>      uiItemCost = 0;
<a name="l02335"></a>02335       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>      uiRepairCost = 0;
<a name="l02336"></a>02336       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a>       sRepairCostAdj = 0;
<a name="l02337"></a>02337 <span class="comment">//    UINT32      uiDifFrom10=0;</span>
<a name="l02338"></a>02338 
<a name="l02339"></a>02339       <span class="comment">// figure out the full value of the item, modified by this dealer's personal Sell (i.e. repair cost) modifier</span>
<a name="l02340"></a>02340       <span class="comment">// don't use CalcShopKeeperItemPrice - we want FULL value!!!</span>
<a name="l02341"></a>02341       uiItemCost = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)(( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ usItemIndex ].usPrice * <a class="code" href="Arms_01Dealer_01Init_8cpp.html#230ecf6873ae948a09ae12f5b69c22e0">ArmsDealerInfo</a>[ ubArmsDealer ].dRepairCost ) );
<a name="l02342"></a>02342 
<a name="l02343"></a>02343       <span class="comment">// get item's repair ease, for each + point is 10% easier, each - point is 10% harder to repair</span>
<a name="l02344"></a>02344       sRepairCostAdj = 100 - ( 10 * <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ usItemIndex ].<a class="code" href="structINVTYPE.html#b0545a2303702f3b3601e09c97d1a787">bRepairEase</a> );
<a name="l02345"></a>02345 
<a name="l02346"></a>02346       <span class="comment">// make sure it ain't somehow gone too low!</span>
<a name="l02347"></a>02347       <span class="keywordflow">if</span> (sRepairCostAdj &lt; 10)
<a name="l02348"></a>02348       {
<a name="l02349"></a>02349             sRepairCostAdj = 10;
<a name="l02350"></a>02350       }
<a name="l02351"></a>02351 
<a name="l02352"></a>02352       <span class="comment">// calculate repair cost, the more broken it is the more it costs, and the difficulty of repair it is also a factor</span>
<a name="l02353"></a>02353       uiRepairCost = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)( uiItemCost * ( sRepairCostAdj * (100 - bItemCondition) / ((<a class="code" href="Types_8h.html#8d06b04c04132c6f7c0fcb08c6167455">FLOAT</a>)100 * 100) ));
<a name="l02354"></a>02354 
<a name="l02355"></a>02355 <span class="comment">/*</span>
<a name="l02356"></a>02356 <span class="comment">      //if the price is not diviseble by 10, make it so</span>
<a name="l02357"></a>02357 <span class="comment">      uiDifFrom10 = 10 - uiRepairCost % 10;</span>
<a name="l02358"></a>02358 <span class="comment">      if( uiDifFrom10 != 0 )</span>
<a name="l02359"></a>02359 <span class="comment">      {</span>
<a name="l02360"></a>02360 <span class="comment">            uiRepairCost += uiDifFrom10;</span>
<a name="l02361"></a>02361 <span class="comment">      }</span>
<a name="l02362"></a>02362 <span class="comment">*/</span>
<a name="l02363"></a>02363 
<a name="l02364"></a>02364       <span class="keywordflow">if</span> ( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#5e66eb4229dd9479536b22c5320de161">ItemIsARocketRifle</a>( usItemIndex ) )
<a name="l02365"></a>02365       {
<a name="l02366"></a>02366             <span class="comment">// resetting imprinting for a rocket rifle costs something extra even if rifle is at 100%</span>
<a name="l02367"></a>02367             uiRepairCost += 100;
<a name="l02368"></a>02368       }
<a name="l02369"></a>02369 
<a name="l02370"></a>02370 
<a name="l02371"></a>02371       <span class="comment">// anything repairable has to have a minimum price</span>
<a name="l02372"></a>02372       <span class="keywordflow">if</span> ( uiRepairCost &lt; MIN_REPAIR_COST )
<a name="l02373"></a>02373       {
<a name="l02374"></a>02374             uiRepairCost = MIN_REPAIR_COST;
<a name="l02375"></a>02375       }
<a name="l02376"></a>02376 
<a name="l02377"></a>02377       <span class="keywordflow">return</span>( uiRepairCost );
<a name="l02378"></a>02378 }
<a name="l02379"></a>02379 
<a name="l02380"></a>02380 
<a name="l02381"></a>02381 
<a name="l02382"></a><a class="code" href="Arms_01Dealer_01Init_8h.html#b4a1eb863f49bc02f992d8874ff97777">02382</a> <span class="keywordtype">void</span> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#b4a1eb863f49bc02f992d8874ff97777">SetSpecialItemInfoToDefaults</a>( <a class="code" href="structSPECIAL__ITEM__INFO.html">SPECIAL_ITEM_INFO</a> *pSpclItemInfo )
<a name="l02383"></a>02383 {
<a name="l02384"></a>02384       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubCnt;
<a name="l02385"></a>02385 
<a name="l02386"></a>02386       memset( pSpclItemInfo, 0, <span class="keyword">sizeof</span>( <a class="code" href="structSPECIAL__ITEM__INFO.html">SPECIAL_ITEM_INFO</a> ) );
<a name="l02387"></a>02387 
<a name="l02388"></a>02388       pSpclItemInfo-&gt;<a class="code" href="structSPECIAL__ITEM__INFO.html#a63af49b3ae129222cab2d4de0b44b8a">bItemCondition</a> = 100;
<a name="l02389"></a>02389       pSpclItemInfo-&gt;<a class="code" href="structSPECIAL__ITEM__INFO.html#96e004707e2126c879cd26b7a5ccac47">ubImprintID</a> = NO_PROFILE;
<a name="l02390"></a>02390 
<a name="l02391"></a>02391       <span class="keywordflow">for</span> ( ubCnt = 0; ubCnt &lt; MAX_ATTACHMENTS; ubCnt++ )
<a name="l02392"></a>02392       {
<a name="l02393"></a>02393             pSpclItemInfo-&gt;<a class="code" href="structSPECIAL__ITEM__INFO.html#39d915d827ed63966b91e3c95a57e1bd">usAttachment</a>[ ubCnt ] = <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4c157bdf0b85a40d2619cbc8bc1ae5fe2">NONE</a>;
<a name="l02394"></a>02394             pSpclItemInfo-&gt;<a class="code" href="structSPECIAL__ITEM__INFO.html#4cf8293f87f597df36d5c37632c06fe1">bAttachmentStatus</a>[ ubCnt ] = 0;
<a name="l02395"></a>02395       }
<a name="l02396"></a>02396 }
<a name="l02397"></a>02397 
<a name="l02398"></a>02398 
<a name="l02399"></a><a class="code" href="Arms_01Dealer_01Init_8h.html#8c87923914aad21c8e8e9227e6f96d65">02399</a> <span class="keywordtype">void</span> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#8c87923914aad21c8e8e9227e6f96d65">SetSpecialItemInfoFromObject</a>( <a class="code" href="structSPECIAL__ITEM__INFO.html">SPECIAL_ITEM_INFO</a> *pSpclItemInfo, <a class="code" href="structOBJECTTYPE.html">OBJECTTYPE</a> *pObject )
<a name="l02400"></a>02400 {
<a name="l02401"></a>02401       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubCnt;
<a name="l02402"></a>02402 
<a name="l02403"></a>02403 
<a name="l02404"></a>02404       memset(pSpclItemInfo, 0, <span class="keyword">sizeof</span>( <a class="code" href="structSPECIAL__ITEM__INFO.html">SPECIAL_ITEM_INFO</a> ) );
<a name="l02405"></a>02405 
<a name="l02406"></a>02406 
<a name="l02407"></a>02407       <span class="keywordflow">if</span>( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ pObject-&gt;<a class="code" href="structOBJECTTYPE.html#4fbe05335f161f08f354566b8e5a0a19">usItem</a> ].usItemClass == IC_AMMO )
<a name="l02408"></a>02408       {
<a name="l02409"></a>02409             <span class="comment">// ammo condition is always 100, don't use status, which holds the #bullets</span>
<a name="l02410"></a>02410             pSpclItemInfo-&gt;<a class="code" href="structSPECIAL__ITEM__INFO.html#a63af49b3ae129222cab2d4de0b44b8a">bItemCondition</a> = 100;
<a name="l02411"></a>02411       }
<a name="l02412"></a>02412       <span class="keywordflow">else</span>
<a name="l02413"></a>02413       {
<a name="l02414"></a>02414             pSpclItemInfo-&gt;<a class="code" href="structSPECIAL__ITEM__INFO.html#a63af49b3ae129222cab2d4de0b44b8a">bItemCondition</a> = pObject-&gt;<a class="code" href="structOBJECTTYPE.html#aa0827e15c8e54d285d2850ea5ffbb07">bStatus</a>[ 0 ];
<a name="l02415"></a>02415       }
<a name="l02416"></a>02416 
<a name="l02417"></a>02417       <span class="comment">// only guns currently have imprintID properly initialized...</span>
<a name="l02418"></a>02418       <span class="keywordflow">if</span> ( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ pObject-&gt;<a class="code" href="structOBJECTTYPE.html#4fbe05335f161f08f354566b8e5a0a19">usItem</a> ].usItemClass == IC_GUN)
<a name="l02419"></a>02419       {
<a name="l02420"></a>02420             pSpclItemInfo-&gt;<a class="code" href="structSPECIAL__ITEM__INFO.html#96e004707e2126c879cd26b7a5ccac47">ubImprintID</a> = pObject-&gt;<a class="code" href="structOBJECTTYPE.html#bbf8833330a114c5ff8d0d95e51bee92">ubImprintID</a>;
<a name="l02421"></a>02421       }
<a name="l02422"></a>02422       <span class="keywordflow">else</span>
<a name="l02423"></a>02423       {
<a name="l02424"></a>02424             <span class="comment">// override garbage imprintIDs (generally 0) for non-guns</span>
<a name="l02425"></a>02425             pSpclItemInfo-&gt;<a class="code" href="structSPECIAL__ITEM__INFO.html#96e004707e2126c879cd26b7a5ccac47">ubImprintID</a> = NO_PROFILE;
<a name="l02426"></a>02426       }
<a name="l02427"></a>02427 
<a name="l02428"></a>02428       <span class="keywordflow">for</span> ( ubCnt = 0; ubCnt &lt; MAX_ATTACHMENTS; ubCnt++ )
<a name="l02429"></a>02429       {
<a name="l02430"></a>02430             <span class="keywordflow">if</span>( pObject-&gt;<a class="code" href="structOBJECTTYPE.html#427bef1c8b3d44d79d8f552ca1d774aa">usAttachItem</a>[ ubCnt ] != <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4c157bdf0b85a40d2619cbc8bc1ae5fe2">NONE</a> )
<a name="l02431"></a>02431             {
<a name="l02432"></a>02432                   <span class="comment">// store what it is</span>
<a name="l02433"></a>02433                   pSpclItemInfo-&gt;<a class="code" href="structSPECIAL__ITEM__INFO.html#39d915d827ed63966b91e3c95a57e1bd">usAttachment</a>[ ubCnt ] = pObject-&gt;<a class="code" href="structOBJECTTYPE.html#427bef1c8b3d44d79d8f552ca1d774aa">usAttachItem</a>[ ubCnt ];
<a name="l02434"></a>02434                   pSpclItemInfo-&gt;<a class="code" href="structSPECIAL__ITEM__INFO.html#4cf8293f87f597df36d5c37632c06fe1">bAttachmentStatus</a>[ ubCnt ] = pObject-&gt;<a class="code" href="structOBJECTTYPE.html#502ef8951e7613e2466bdf83927a7281">bAttachStatus</a>[ ubCnt ];
<a name="l02435"></a>02435             }
<a name="l02436"></a>02436             <span class="keywordflow">else</span>
<a name="l02437"></a>02437             {
<a name="l02438"></a>02438                   pSpclItemInfo-&gt;<a class="code" href="structSPECIAL__ITEM__INFO.html#39d915d827ed63966b91e3c95a57e1bd">usAttachment</a>[ ubCnt ] = <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4c157bdf0b85a40d2619cbc8bc1ae5fe2">NONE</a>;
<a name="l02439"></a>02439                   pSpclItemInfo-&gt;<a class="code" href="structSPECIAL__ITEM__INFO.html#4cf8293f87f597df36d5c37632c06fe1">bAttachmentStatus</a>[ ubCnt ] = 0;
<a name="l02440"></a>02440             }
<a name="l02441"></a>02441       }
<a name="l02442"></a>02442 }
<a name="l02443"></a>02443 
<a name="l02444"></a>02444 
<a name="l02445"></a>02445 
<a name="l02446"></a><a class="code" href="Arms_01Dealer_01Init_8cpp.html#5c176cb71e619d5e26c1af3f23d94a8f">02446</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#5c176cb71e619d5e26c1af3f23d94a8f">IsItemInfoSpecial</a>( <a class="code" href="structSPECIAL__ITEM__INFO.html">SPECIAL_ITEM_INFO</a> *pSpclItemInfo )
<a name="l02447"></a>02447 {
<a name="l02448"></a>02448       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubCnt;
<a name="l02449"></a>02449 
<a name="l02450"></a>02450 
<a name="l02451"></a>02451       <span class="comment">// being damaged / in repairs makes an item special</span>
<a name="l02452"></a>02452       <span class="keywordflow">if</span> ( pSpclItemInfo-&gt;<a class="code" href="structSPECIAL__ITEM__INFO.html#a63af49b3ae129222cab2d4de0b44b8a">bItemCondition</a> != 100 )
<a name="l02453"></a>02453       {
<a name="l02454"></a>02454             <span class="keywordflow">return</span>(TRUE);
<a name="l02455"></a>02455       }
<a name="l02456"></a>02456 
<a name="l02457"></a>02457       <span class="comment">// being imprinted makes an item special</span>
<a name="l02458"></a>02458       <span class="keywordflow">if</span> (pSpclItemInfo-&gt;<a class="code" href="structSPECIAL__ITEM__INFO.html#96e004707e2126c879cd26b7a5ccac47">ubImprintID</a> != NO_PROFILE)
<a name="l02459"></a>02459       {
<a name="l02460"></a>02460             <span class="keywordflow">return</span>(TRUE);
<a name="l02461"></a>02461       }
<a name="l02462"></a>02462 
<a name="l02463"></a>02463       <span class="comment">// having an attachment makes an item special</span>
<a name="l02464"></a>02464       <span class="keywordflow">for</span> ( ubCnt = 0; ubCnt &lt; MAX_ATTACHMENTS; ubCnt++ )
<a name="l02465"></a>02465       {
<a name="l02466"></a>02466             <span class="keywordflow">if</span> ( pSpclItemInfo-&gt;<a class="code" href="structSPECIAL__ITEM__INFO.html#39d915d827ed63966b91e3c95a57e1bd">usAttachment</a>[ ubCnt ] != <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4c157bdf0b85a40d2619cbc8bc1ae5fe2">NONE</a> )
<a name="l02467"></a>02467             {
<a name="l02468"></a>02468                   <span class="keywordflow">return</span>(TRUE);
<a name="l02469"></a>02469             }
<a name="l02470"></a>02470       }
<a name="l02471"></a>02471 
<a name="l02472"></a>02472       <span class="comment">// otherwise, it's just a "perfect" item, nothing special about it</span>
<a name="l02473"></a>02473       <span class="keywordflow">return</span>(FALSE);
<a name="l02474"></a>02474 }
<a name="l02475"></a>02475 
<a name="l02476"></a>02476 
<a name="l02477"></a>02477 
<a name="l02478"></a><a class="code" href="Arms_01Dealer_01Init_8cpp.html#94141d72a212e3ef2f176d7fe84bcb31">02478</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#94141d72a212e3ef2f176d7fe84bcb31">DoesItemAppearInDealerInventoryList</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usItemIndex, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fPurchaseFromPlayer )
<a name="l02479"></a>02479 {
<a name="l02480"></a>02480       <a class="code" href="structDEALER__POSSIBLE__INV.html">DEALER_POSSIBLE_INV</a> *pDealerInv=NULL;
<a name="l02481"></a>02481       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usCnt;
<a name="l02482"></a>02482 
<a name="l02483"></a>02483 
<a name="l02484"></a>02484       <span class="comment">// the others will buy only things that appear in their own "for sale" inventory lists</span>
<a name="l02485"></a>02485       pDealerInv = <a class="code" href="ArmsDealerInvInit_8cpp.html#1efa8254eb7ffa6b97abfa876d1fcf67">GetPointerToDealersPossibleInventory</a>( ubArmsDealer );
<a name="l02486"></a>02486       Assert( pDealerInv != NULL );
<a name="l02487"></a>02487 
<a name="l02488"></a>02488       <span class="comment">// loop through the dealers' possible inventory and see if the item exists there</span>
<a name="l02489"></a>02489       usCnt = 0;
<a name="l02490"></a>02490       <span class="keywordflow">while</span>( pDealerInv[ usCnt ].sItemIndex != LAST_DEALER_ITEM )
<a name="l02491"></a>02491       {
<a name="l02492"></a>02492             <span class="comment">//if the initial dealer inv contains the required item, the dealer can sell the item</span>
<a name="l02493"></a>02493             <span class="keywordflow">if</span>( pDealerInv[ usCnt ].sItemIndex == usItemIndex )
<a name="l02494"></a>02494             {
<a name="l02495"></a>02495                   <span class="comment">// if optimal quantity listed is 0, it means dealer won't sell it himself, but will buy it from the player!</span>
<a name="l02496"></a>02496                   <span class="keywordflow">if</span> ( ( pDealerInv[ usCnt ].ubOptimalNumber &gt; 0 ) || fPurchaseFromPlayer )
<a name="l02497"></a>02497                   {
<a name="l02498"></a>02498                         <span class="keywordflow">return</span>( TRUE );
<a name="l02499"></a>02499                   }
<a name="l02500"></a>02500             }
<a name="l02501"></a>02501 
<a name="l02502"></a>02502             usCnt++;
<a name="l02503"></a>02503       }
<a name="l02504"></a>02504 
<a name="l02505"></a>02505       <span class="keywordflow">return</span>( FALSE );
<a name="l02506"></a>02506 }
<a name="l02507"></a>02507 
<a name="l02508"></a>02508 
<a name="l02509"></a>02509 
<a name="l02510"></a><a class="code" href="Arms_01Dealer_01Init_8h.html#0af7fa35d43c03ed62399c88fa427158">02510</a> <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#0af7fa35d43c03ed62399c88fa427158">CalcValueOfItemToDealer</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usItemIndex, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fDealerSelling )
<a name="l02511"></a>02511 {
<a name="l02512"></a>02512       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usBasePrice;
<a name="l02513"></a>02513       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubItemPriceClass;
<a name="l02514"></a>02514       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubDealerPriceClass;
<a name="l02515"></a>02515       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usValueToThisDealer;
<a name="l02516"></a>02516 
<a name="l02517"></a>02517 
<a name="l02518"></a>02518       usBasePrice = <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ usItemIndex ].<a class="code" href="structINVTYPE.html#1796c829a66fa4f217f06cc293b7648b">usPrice</a>;
<a name="l02519"></a>02519 
<a name="l02520"></a>02520       <span class="keywordflow">if</span> ( usBasePrice == 0 )
<a name="l02521"></a>02521       {
<a name="l02522"></a>02522             <span class="comment">// worthless to any dealer</span>
<a name="l02523"></a>02523             <span class="keywordflow">return</span>( 0 );
<a name="l02524"></a>02524       }
<a name="l02525"></a>02525 
<a name="l02526"></a>02526 
<a name="l02527"></a>02527       <span class="comment">// figure out the price class this dealer prefers</span>
<a name="l02528"></a>02528       <span class="keywordflow">switch</span> ( ubArmsDealer )
<a name="l02529"></a>02529       {
<a name="l02530"></a>02530             <span class="keywordflow">case</span> <a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc26193bcc1758ce5a4f097271ef36cfffba">ARMS_DEALER_JAKE</a>:
<a name="l02531"></a>02531                   ubDealerPriceClass = PRICE_CLASS_JUNK;
<a name="l02532"></a>02532                   <span class="keywordflow">break</span>;
<a name="l02533"></a>02533             <span class="keywordflow">case</span> <a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc26111ab63611a206b04416d64f43b03fe0">ARMS_DEALER_KEITH</a>:
<a name="l02534"></a>02534                   ubDealerPriceClass = PRICE_CLASS_CHEAP;
<a name="l02535"></a>02535                   <span class="keywordflow">break</span>;
<a name="l02536"></a>02536             <span class="keywordflow">case</span> <a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc264db5b4ca17b51b96660f6c5d61a20b62">ARMS_DEALER_FRANZ</a>:
<a name="l02537"></a>02537                   ubDealerPriceClass = PRICE_CLASS_EXPENSIVE;
<a name="l02538"></a>02538                   <span class="keywordflow">break</span>;
<a name="l02539"></a>02539 
<a name="l02540"></a>02540             <span class="comment">// other dealers don't use this system</span>
<a name="l02541"></a>02541             <span class="keywordflow">default</span>:
<a name="l02542"></a>02542                   <span class="keywordflow">if</span> ( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#94141d72a212e3ef2f176d7fe84bcb31">DoesItemAppearInDealerInventoryList</a>( ubArmsDealer, usItemIndex, TRUE ) )
<a name="l02543"></a>02543                   {
<a name="l02544"></a>02544                         <span class="keywordflow">return</span>( usBasePrice );
<a name="l02545"></a>02545                   }
<a name="l02546"></a>02546                   <span class="keywordflow">else</span>
<a name="l02547"></a>02547                   {
<a name="l02548"></a>02548                         <span class="keywordflow">return</span>( 0 );
<a name="l02549"></a>02549                   }
<a name="l02550"></a>02550       }
<a name="l02551"></a>02551 
<a name="l02552"></a>02552 
<a name="l02553"></a>02553       <span class="comment">// the rest of this function applies only to the "general" dealers ( Jake, Keith, and Franz )</span>
<a name="l02554"></a>02554 
<a name="l02555"></a>02555       <span class="comment">// Micky &amp; Gabby specialize in creature parts &amp; such, the others don't buy these at all (exception: jars)</span>
<a name="l02556"></a>02556       <span class="keywordflow">if</span> ( ( !<a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usItemIndex].jar ) &amp;&amp;
<a name="l02557"></a>02557                         ( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#94141d72a212e3ef2f176d7fe84bcb31">DoesItemAppearInDealerInventoryList</a>( <a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc26cfc356831c92169409d616e24fbfa9af">ARMS_DEALER_MICKY</a>, usItemIndex, TRUE ) ||
<a name="l02558"></a>02558                               <a class="code" href="Arms_01Dealer_01Init_8cpp.html#94141d72a212e3ef2f176d7fe84bcb31">DoesItemAppearInDealerInventoryList</a>( <a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc26e37ce5ce10b2ab923bfa9bfa4c87caa4">ARMS_DEALER_GABBY</a>, usItemIndex, TRUE ) ) )
<a name="l02559"></a>02559       {
<a name="l02560"></a>02560             <span class="keywordflow">return</span>( 0 );
<a name="l02561"></a>02561       }
<a name="l02562"></a>02562 
<a name="l02563"></a>02563       <span class="keywordflow">if</span> ( ( ubArmsDealer == <a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc26111ab63611a206b04416d64f43b03fe0">ARMS_DEALER_KEITH</a> ) &amp;&amp; ( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a> [ usItemIndex].usItemClass &amp; ( IC_GUN | IC_LAUNCHER ) ) )
<a name="l02564"></a>02564       {
<a name="l02565"></a>02565             <span class="comment">// Keith won't buy guns until the Hillbillies are vanquished</span>
<a name="l02566"></a>02566             <span class="keywordflow">if</span>( <a class="code" href="Quests_8cpp.html#6744b59d27bf2791d0c2fefe18e548d3">CheckFact</a>( <a class="code" href="Quests_8h.html#aead3e57f613f07868a1b2afb6b943f1e0fdbf0cb27e9406b453ad06a297aeca">FACT_HILLBILLIES_KILLED</a>, <a class="code" href="Soldier_01Profile_8h.html#acaa92dcb344e96138c964deae3e2fa16e3d4638889291fbd253574d01f6baa2">KEITH</a> ) == FALSE )
<a name="l02567"></a>02567             {
<a name="l02568"></a>02568                   <span class="keywordflow">return</span>( 0 );
<a name="l02569"></a>02569             }
<a name="l02570"></a>02570       }
<a name="l02571"></a>02571 
<a name="l02572"></a>02572 
<a name="l02573"></a>02573       <span class="comment">// figure out which price class it belongs to</span>
<a name="l02574"></a>02574       <span class="keywordflow">if</span> ( usBasePrice &lt; 100 )
<a name="l02575"></a>02575       {
<a name="l02576"></a>02576             ubItemPriceClass = PRICE_CLASS_JUNK;
<a name="l02577"></a>02577       }
<a name="l02578"></a>02578       <span class="keywordflow">else</span>
<a name="l02579"></a>02579       <span class="keywordflow">if</span> ( usBasePrice &lt; 1000 )
<a name="l02580"></a>02580       {
<a name="l02581"></a>02581             ubItemPriceClass = PRICE_CLASS_CHEAP;
<a name="l02582"></a>02582       }
<a name="l02583"></a>02583       <span class="keywordflow">else</span>
<a name="l02584"></a>02584       {
<a name="l02585"></a>02585             ubItemPriceClass = PRICE_CLASS_EXPENSIVE;
<a name="l02586"></a>02586       }
<a name="l02587"></a>02587 
<a name="l02588"></a>02588 
<a name="l02589"></a>02589       <span class="keywordflow">if</span>( !fDealerSelling )
<a name="l02590"></a>02590       {
<a name="l02591"></a>02591             <span class="comment">// junk dealer won't buy expensive stuff at all, expensive dealer won't buy junk at all</span>
<a name="l02592"></a>02592             <span class="keywordflow">if</span> ( abs( (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>) ubDealerPriceClass - (INT8) ubItemPriceClass ) == 2 )
<a name="l02593"></a>02593             {
<a name="l02594"></a>02594                   <span class="keywordflow">return</span>( 0 );
<a name="l02595"></a>02595             }
<a name="l02596"></a>02596       }
<a name="l02597"></a>02597 
<a name="l02598"></a>02598       <span class="comment">// start with the base price</span>
<a name="l02599"></a>02599       usValueToThisDealer = usBasePrice;
<a name="l02600"></a>02600 
<a name="l02601"></a>02601       <span class="comment">// if it's out of their preferred price class</span>
<a name="l02602"></a>02602       <span class="keywordflow">if</span> ( ubDealerPriceClass != ubItemPriceClass )
<a name="l02603"></a>02603       {
<a name="l02604"></a>02604             <span class="comment">// exception: Gas (Jake's)</span>
<a name="l02605"></a>02605 <span class="comment">//          if ( usItemIndex != GAS_CAN )</span>
<a name="l02606"></a>02606             <span class="keywordflow">if</span> ( !<a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usItemIndex].gascan )
<a name="l02607"></a>02607             {
<a name="l02608"></a>02608                   <span class="comment">// they pay only 1/3 of true value!</span>
<a name="l02609"></a>02609                   usValueToThisDealer /= 3;
<a name="l02610"></a>02610             }
<a name="l02611"></a>02611       }
<a name="l02612"></a>02612 
<a name="l02613"></a>02613       <span class="comment">// Tony specializes in guns, weapons, and ammo, so make others pay much less for that kind of stuff</span>
<a name="l02614"></a>02614       <span class="keywordflow">if</span> ( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#94141d72a212e3ef2f176d7fe84bcb31">DoesItemAppearInDealerInventoryList</a>( <a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc26f86e6d09e82882b36412949efab8f5a9">ARMS_DEALER_TONY</a>, usItemIndex, TRUE ) )
<a name="l02615"></a>02615       {
<a name="l02616"></a>02616             <span class="comment">// others pay only 1/2 of that value!</span>
<a name="l02617"></a>02617             usValueToThisDealer /= 2;
<a name="l02618"></a>02618       }
<a name="l02619"></a>02619 
<a name="l02620"></a>02620       <span class="comment">// minimum bet $1 !</span>
<a name="l02621"></a>02621       <span class="keywordflow">if</span> ( usValueToThisDealer == 0 )
<a name="l02622"></a>02622       {
<a name="l02623"></a>02623             usValueToThisDealer = 1;
<a name="l02624"></a>02624       }
<a name="l02625"></a>02625 
<a name="l02626"></a>02626       <span class="keywordflow">return</span>( usValueToThisDealer );
<a name="l02627"></a>02627 }
<a name="l02628"></a>02628 
<a name="l02629"></a>02629 
<a name="l02630"></a>02630 
<a name="l02631"></a>02631 <span class="comment">// this only exists to support saves made with game versions &lt; 54 or 55!</span>
<a name="l02632"></a><a class="code" href="Arms_01Dealer_01Init_8cpp.html#d3b4787f28244e41090dd4bb349d970a">02632</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#d3b4787f28244e41090dd4bb349d970a">LoadIncompleteArmsDealersStatus</a>( <a class="code" href="LibraryDataBase_8h.html#210e2fc1c18208cbf159ef9c087d6721">HWFILE</a> hFile, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fIncludesElgin, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fIncludesManny )
<a name="l02633"></a>02633 {
<a name="l02634"></a>02634       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>  uiDealersSaved;
<a name="l02635"></a>02635       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>      uiNumBytesRead;
<a name="l02636"></a>02636 
<a name="l02637"></a>02637       Assert( !fIncludesElgin || !fIncludesManny );
<a name="l02638"></a>02638 
<a name="l02639"></a>02639       <span class="keywordflow">if</span> ( !fIncludesElgin )
<a name="l02640"></a>02640       {
<a name="l02641"></a>02641             <span class="comment">// read 2 fewer element without Elgin or Manny in there...</span>
<a name="l02642"></a>02642             uiDealersSaved = <a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc263581bcab1b191450fad78bf9d0a07e86">NUM_ARMS_DEALERS</a> - 2;
<a name="l02643"></a>02643       }
<a name="l02644"></a>02644       <span class="keywordflow">else</span>
<a name="l02645"></a>02645       {
<a name="l02646"></a>02646             <span class="comment">// read one fewer element without Elgin in there...</span>
<a name="l02647"></a>02647             uiDealersSaved = <a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc263581bcab1b191450fad78bf9d0a07e86">NUM_ARMS_DEALERS</a> - 1;
<a name="l02648"></a>02648       }
<a name="l02649"></a>02649 
<a name="l02650"></a>02650 
<a name="l02651"></a>02651       <span class="comment">// read in all other dealer's status</span>
<a name="l02652"></a>02652       <span class="keywordflow">if</span> (!<a class="code" href="FileMan_8cpp.html#1b213074411fd4c1dc8fd345e787b17e">FileRead</a>( hFile, <a class="code" href="Arms_01Dealer_01Init_8cpp.html#efac177a506b89c636fdab5eeccd37d8">gArmsDealerStatus</a>, uiDealersSaved * <span class="keyword">sizeof</span>( <a class="code" href="structARMS__DEALER__STATUS.html">ARMS_DEALER_STATUS</a> ), &amp;uiNumBytesRead ))
<a name="l02653"></a>02653       {
<a name="l02654"></a>02654             <span class="keywordflow">return</span>( FALSE );
<a name="l02655"></a>02655       }
<a name="l02656"></a>02656 
<a name="l02657"></a>02657       <span class="comment">// read in all other dealer's inventory</span>
<a name="l02658"></a>02658       <span class="keywordflow">if</span> (!<a class="code" href="FileMan_8cpp.html#1b213074411fd4c1dc8fd345e787b17e">FileRead</a>( hFile, <a class="code" href="Arms_01Dealer_01Init_8cpp.html#a0ee8dd58d74bb9c65fabb67dd534f11">gArmsDealersInventory</a>, uiDealersSaved * <span class="keyword">sizeof</span>( <a class="code" href="structDEALER__ITEM__HEADER.html">DEALER_ITEM_HEADER</a> ) * <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f40efaf5227d3f780f8db037c71e3f903f">MAXITEMS</a>, &amp;uiNumBytesRead ))
<a name="l02659"></a>02659       {
<a name="l02660"></a>02660             <span class="keywordflow">return</span>( FALSE );
<a name="l02661"></a>02661       }
<a name="l02662"></a>02662 
<a name="l02663"></a>02663       <span class="keywordflow">if</span> ( !fIncludesElgin )
<a name="l02664"></a>02664       {
<a name="l02665"></a>02665             <span class="comment">// initialize Elgin now...</span>
<a name="l02666"></a>02666             <a class="code" href="Arms_01Dealer_01Init_8cpp.html#affd6acf301899d888adce4940375db8">InitializeOneArmsDealer</a>( <a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc26a4727a7692738c50dd304ad80a2f97c0">ARMS_DEALER_ELGIN</a> );
<a name="l02667"></a>02667       }
<a name="l02668"></a>02668 
<a name="l02669"></a>02669       <span class="keywordflow">if</span> ( !fIncludesManny )
<a name="l02670"></a>02670       {
<a name="l02671"></a>02671             <span class="comment">// initialize Manny now...</span>
<a name="l02672"></a>02672             <a class="code" href="Arms_01Dealer_01Init_8cpp.html#affd6acf301899d888adce4940375db8">InitializeOneArmsDealer</a>( <a class="code" href="Arms_01Dealer_01Init_8h.html#35b7fa7665fe812ec8d7cf77bbcdbc26cdc4677dee3c3f8777a0c76add856981">ARMS_DEALER_MANNY</a> );
<a name="l02673"></a>02673       }
<a name="l02674"></a>02674 
<a name="l02675"></a>02675       <span class="keywordflow">return</span>(TRUE);
<a name="l02676"></a>02676 }
<a name="l02677"></a>02677 
<a name="l02678"></a>02678 
<a name="l02679"></a>02679 
<a name="l02680"></a><a class="code" href="Arms_01Dealer_01Init_8h.html#c994bda542c061511bb0176f4fe2ee67">02680</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#c994bda542c061511bb0176f4fe2ee67">DealerItemIsSafeToStack</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usItemIndex )
<a name="l02681"></a>02681 {
<a name="l02682"></a>02682       <span class="comment">// basically any item type with nothing unique about it besides its status can be stacked in dealer's inventory boxes...</span>
<a name="l02683"></a>02683       <span class="comment">// NOTE: This test is only applied to items already KNOWN to be perfect - special items are obviously not-stackable</span>
<a name="l02684"></a>02684 
<a name="l02685"></a>02685       <span class="keywordflow">if</span> ( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ usItemIndex ].usItemClass == IC_GUN )
<a name="l02686"></a>02686       {
<a name="l02687"></a>02687             <span class="keywordflow">return</span>( FALSE );
<a name="l02688"></a>02688       }
<a name="l02689"></a>02689 
<a name="l02690"></a>02690 <span class="comment">/*</span>
<a name="l02691"></a>02691 <span class="comment">      if ( ItemSlotLimit( usItemIndex, BIGPOCK1POS ) &gt; 1 )</span>
<a name="l02692"></a>02692 <span class="comment">      {</span>
<a name="l02693"></a>02693 <span class="comment">            return( TRUE );</span>
<a name="l02694"></a>02694 <span class="comment">      }</span>
<a name="l02695"></a>02695 <span class="comment">*/</span>
<a name="l02696"></a>02696 
<a name="l02697"></a>02697       <span class="keywordflow">return</span>( TRUE );
<a name="l02698"></a>02698 }
<a name="l02699"></a>02699 
<a name="l02700"></a>02700 
<a name="l02701"></a>02701 
<a name="l02702"></a><a class="code" href="Arms_01Dealer_01Init_8cpp.html#e104fca6b6bf33638d8f2df3949066bd">02702</a> <span class="keywordtype">void</span> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#e104fca6b6bf33638d8f2df3949066bd">GuaranteeMinimumAlcohol</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer )
<a name="l02703"></a>02703 {
<a name="l02704"></a>02704       <a class="code" href="Quests_8cpp.html#5a7dd258af5c2805c1eb015dae61f6e7">GuaranteeAtLeastXItemsOfIndex</a>( ubArmsDealer, <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4c8a993641cd5519ea457dec56a74e7f0">BEER</a>,          ( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ) ( <a class="code" href="ArmsDealerInvInit_8cpp.html#a7fa16b786e59b82a6893a265e878b42">GetDealersMaxItemAmount</a>( ubArmsDealer, <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4c8a993641cd5519ea457dec56a74e7f0">BEER</a> ) / 3 ) );
<a name="l02705"></a>02705       <a class="code" href="Quests_8cpp.html#5a7dd258af5c2805c1eb015dae61f6e7">GuaranteeAtLeastXItemsOfIndex</a>( ubArmsDealer, <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4cb94836c0e0eebd7547e6f567c4a70f4">WINE</a>,          ( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ) ( <a class="code" href="ArmsDealerInvInit_8cpp.html#a7fa16b786e59b82a6893a265e878b42">GetDealersMaxItemAmount</a>( ubArmsDealer, <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4cb94836c0e0eebd7547e6f567c4a70f4">WINE</a> ) / 3 ) );
<a name="l02706"></a>02706       <a class="code" href="Quests_8cpp.html#5a7dd258af5c2805c1eb015dae61f6e7">GuaranteeAtLeastXItemsOfIndex</a>( ubArmsDealer, <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4d9f270736707e262f45d89b3f0f2091c">ALCOHOL</a>, ( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ) ( <a class="code" href="ArmsDealerInvInit_8cpp.html#a7fa16b786e59b82a6893a265e878b42">GetDealersMaxItemAmount</a>( ubArmsDealer, <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4d9f270736707e262f45d89b3f0f2091c">ALCOHOL</a> ) / 3 ) );
<a name="l02707"></a>02707 }
<a name="l02708"></a>02708 
<a name="l02709"></a>02709 
<a name="l02710"></a>02710 
<a name="l02711"></a><a class="code" href="Arms_01Dealer_01Init_8cpp.html#5e66eb4229dd9479536b22c5320de161">02711</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#5e66eb4229dd9479536b22c5320de161">ItemIsARocketRifle</a>( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sItemIndex )
<a name="l02712"></a>02712 {
<a name="l02713"></a>02713       <span class="keywordflow">if</span> ( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[sItemIndex].fingerprintid  )
<a name="l02714"></a>02714       {
<a name="l02715"></a>02715             <span class="keywordflow">return</span>( TRUE );
<a name="l02716"></a>02716       }
<a name="l02717"></a>02717       <span class="keywordflow">else</span>
<a name="l02718"></a>02718       {
<a name="l02719"></a>02719             <span class="keywordflow">return</span>( FALSE );
<a name="l02720"></a>02720       }
<a name="l02721"></a>02721 }
<a name="l02722"></a>02722 
<a name="l02723"></a>02723 
<a name="l02724"></a>02724 
<a name="l02725"></a><a class="code" href="Arms_01Dealer_01Init_8cpp.html#9ce40c5f0ccbf3380aafb62c47b00fb7">02725</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#9ce40c5f0ccbf3380aafb62c47b00fb7">GetArmsDealerShopHours</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> *puiOpeningTime, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> *puiClosingTime )
<a name="l02726"></a>02726 {
<a name="l02727"></a>02727       <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>;
<a name="l02728"></a>02728 
<a name="l02729"></a>02729       <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> = <a class="code" href="Soldier_01Profile_8cpp.html#2a54c4a06df8ed61529646f23682ef9d">FindSoldierByProfileID</a>( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#230ecf6873ae948a09ae12f5b69c22e0">ArmsDealerInfo</a>[ ubArmsDealer ].ubShopKeeperID, FALSE );
<a name="l02730"></a>02730       <span class="keywordflow">if</span> ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> == NULL )
<a name="l02731"></a>02731       {
<a name="l02732"></a>02732             <span class="keywordflow">return</span>( FALSE );
<a name="l02733"></a>02733       }
<a name="l02734"></a>02734 
<a name="l02735"></a>02735       <span class="keywordflow">if</span> ( <a class="code" href="Scheduling_8cpp.html#ac39e16999597f207d32f0388f21804a">ExtractScheduleDoorLockAndUnlockInfo</a>( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>, puiOpeningTime, puiClosingTime ) == FALSE )
<a name="l02736"></a>02736       {
<a name="l02737"></a>02737             <span class="keywordflow">return</span>( FALSE );
<a name="l02738"></a>02738       }
<a name="l02739"></a>02739 
<a name="l02740"></a>02740       Assert( *puiOpeningTime &lt; *puiClosingTime );
<a name="l02741"></a>02741 
<a name="l02742"></a>02742       <span class="keywordflow">return</span>( TRUE );
<a name="l02743"></a>02743 }
<a name="l02744"></a>02744 
<a name="l02745"></a>02745 
<a name="l02746"></a>02746 
<a name="l02747"></a><a class="code" href="Arms_01Dealer_01Init_8h.html#7e3791d1dfd7770aa0c20a05d91a185f">02747</a> <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#7e3791d1dfd7770aa0c20a05d91a185f">CalculateOvernightRepairDelay</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiTimeWhenFreeToStartIt, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiMinutesToFix )
<a name="l02748"></a>02748 {
<a name="l02749"></a>02749       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOpeningTime, uiClosingTime;
<a name="l02750"></a>02750       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiMinutesClosedOvernight;
<a name="l02751"></a>02751       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDelayInDays = 0;
<a name="l02752"></a>02752       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDoneToday;
<a name="l02753"></a>02753 
<a name="l02754"></a>02754 
<a name="l02755"></a>02755       Assert( uiMinutesToFix &gt; 0 );
<a name="l02756"></a>02756 
<a name="l02757"></a>02757       <span class="comment">// convert world time into 24hr military time for the day he's gonna start on it</span>
<a name="l02758"></a>02758       uiTimeWhenFreeToStartIt = uiTimeWhenFreeToStartIt % NUM_MIN_IN_DAY;
<a name="l02759"></a>02759 
<a name="l02760"></a>02760       <span class="keywordflow">if</span> ( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#9ce40c5f0ccbf3380aafb62c47b00fb7">GetArmsDealerShopHours</a>( ubArmsDealer, &amp;uiOpeningTime, &amp;uiClosingTime ) == FALSE )
<a name="l02761"></a>02761       {
<a name="l02762"></a>02762             <span class="keywordflow">return</span>( 0 );
<a name="l02763"></a>02763       }
<a name="l02764"></a>02764 
<a name="l02765"></a>02765       <span class="comment">// if it won't get done by the end of a day</span>
<a name="l02766"></a>02766       <span class="keywordflow">while</span> ( ( uiTimeWhenFreeToStartIt + uiMinutesToFix ) &gt; uiClosingTime )
<a name="l02767"></a>02767       {
<a name="l02768"></a>02768             <span class="comment">// this is to handle existing saves with overnight repairs</span>
<a name="l02769"></a>02769             <span class="keywordflow">if</span> ( uiTimeWhenFreeToStartIt &lt; uiClosingTime )
<a name="l02770"></a>02770             {
<a name="l02771"></a>02771                   <span class="comment">// he gets this much done before closing</span>
<a name="l02772"></a>02772                   uiDoneToday = uiClosingTime - uiTimeWhenFreeToStartIt;
<a name="l02773"></a>02773                   <span class="comment">// subtract how much he got done</span>
<a name="l02774"></a>02774                   uiMinutesToFix -= uiDoneToday;
<a name="l02775"></a>02775                   Assert( uiMinutesToFix &gt; 0 );
<a name="l02776"></a>02776             }
<a name="l02777"></a>02777 
<a name="l02778"></a>02778             <span class="comment">// he starts back at it first thing in the morning</span>
<a name="l02779"></a>02779             uiTimeWhenFreeToStartIt = uiOpeningTime;
<a name="l02780"></a>02780             uiDelayInDays++;
<a name="l02781"></a>02781       }
<a name="l02782"></a>02782 
<a name="l02783"></a>02783       uiMinutesClosedOvernight = NUM_MIN_IN_DAY - ( uiClosingTime - uiOpeningTime );
<a name="l02784"></a>02784 
<a name="l02785"></a>02785       <span class="keywordflow">return</span> ( uiDelayInDays * uiMinutesClosedOvernight );
<a name="l02786"></a>02786 }
<a name="l02787"></a>02787 
<a name="l02788"></a>02788 
<a name="l02789"></a>02789 
<a name="l02790"></a><a class="code" href="Arms_01Dealer_01Init_8h.html#fed82cdd76b710b915a44ae4f8d143fd">02790</a> <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="Arms_01Dealer_01Init_8cpp.html#fed82cdd76b710b915a44ae4f8d143fd">CalculateMinutesClosedBetween</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubArmsDealer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiStartTime, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiEndTime )
<a name="l02791"></a>02791 {
<a name="l02792"></a>02792       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOpeningTime, uiClosingTime;
<a name="l02793"></a>02793       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiMinutesClosedOvernight;
<a name="l02794"></a>02794       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDaysDifference = 0;
<a name="l02795"></a>02795       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiMinutesClosed = 0;
<a name="l02796"></a>02796 
<a name="l02797"></a>02797       Assert( uiStartTime &lt;= uiEndTime );
<a name="l02798"></a>02798 
<a name="l02799"></a>02799       <span class="keywordflow">if</span> ( <a class="code" href="Arms_01Dealer_01Init_8cpp.html#9ce40c5f0ccbf3380aafb62c47b00fb7">GetArmsDealerShopHours</a>( ubArmsDealer, &amp;uiOpeningTime, &amp;uiClosingTime ) == FALSE )
<a name="l02800"></a>02800       {
<a name="l02801"></a>02801             <span class="keywordflow">return</span>( 0 );
<a name="l02802"></a>02802       }
<a name="l02803"></a>02803 
<a name="l02804"></a>02804       uiMinutesClosedOvernight = NUM_MIN_IN_DAY - ( uiClosingTime - uiOpeningTime );
<a name="l02805"></a>02805 
<a name="l02806"></a>02806       <span class="comment">// NOTE: this assumes stored are only closed overnight, so all we have to do is compare the day portion</span>
<a name="l02807"></a>02807       uiDaysDifference = ( uiEndTime / NUM_MIN_IN_DAY ) - ( uiStartTime / NUM_MIN_IN_DAY );
<a name="l02808"></a>02808 
<a name="l02809"></a>02809       <span class="keywordflow">if</span> ( uiDaysDifference &gt;= 2 )
<a name="l02810"></a>02810       {
<a name="l02811"></a>02811             <span class="comment">// close for 1 less than that many full nights...</span>
<a name="l02812"></a>02812             uiMinutesClosed = ( uiDaysDifference - 1 ) * uiMinutesClosedOvernight;
<a name="l02813"></a>02813       }
<a name="l02814"></a>02814 
<a name="l02815"></a>02815 
<a name="l02816"></a>02816       <span class="comment">// add partial day's closing</span>
<a name="l02817"></a>02817 
<a name="l02818"></a>02818       <span class="comment">// convert start and end times into 24hr military time</span>
<a name="l02819"></a>02819       uiStartTime = uiStartTime % NUM_MIN_IN_DAY;
<a name="l02820"></a>02820       uiEndTime = uiEndTime % NUM_MIN_IN_DAY;
<a name="l02821"></a>02821 
<a name="l02822"></a>02822       <span class="comment">// treat end time of midnight as 24:00 hours to prevent indefinite recursion and make formulas work</span>
<a name="l02823"></a>02823       <span class="keywordflow">if</span> ( uiEndTime == 0 )
<a name="l02824"></a>02824       {
<a name="l02825"></a>02825             uiEndTime = NUM_MIN_IN_DAY;
<a name="l02826"></a>02826       }
<a name="l02827"></a>02827 
<a name="l02828"></a>02828 
<a name="l02829"></a>02829       <span class="keywordflow">if</span> ( uiStartTime == uiEndTime )
<a name="l02830"></a>02830       {
<a name="l02831"></a>02831             <span class="keywordflow">if</span> ( uiDaysDifference == 0 )
<a name="l02832"></a>02832             {
<a name="l02833"></a>02833                   <span class="keywordflow">return</span>( 0 );
<a name="l02834"></a>02834             }
<a name="l02835"></a>02835             <span class="keywordflow">else</span>
<a name="l02836"></a>02836             {
<a name="l02837"></a>02837                   uiMinutesClosed += uiMinutesClosedOvernight;
<a name="l02838"></a>02838             }
<a name="l02839"></a>02839       }
<a name="l02840"></a>02840       <span class="keywordflow">if</span> ( uiStartTime &lt; uiEndTime )
<a name="l02841"></a>02841       {
<a name="l02842"></a>02842             <span class="keywordflow">if</span> ( uiStartTime &lt; uiOpeningTime )
<a name="l02843"></a>02843             {
<a name="l02844"></a>02844                   <span class="comment">// add how many minutes in the time range BEFORE the store opened that day</span>
<a name="l02845"></a>02845                   uiMinutesClosed += ( min( uiOpeningTime, uiEndTime ) - uiStartTime );
<a name="l02846"></a>02846             }
<a name="l02847"></a>02847 
<a name="l02848"></a>02848             <span class="keywordflow">if</span> ( uiEndTime &gt; uiClosingTime )
<a name="l02849"></a>02849             {
<a name="l02850"></a>02850                   <span class="comment">// add how many minutes in the time range AFTER the store closed that day</span>
<a name="l02851"></a>02851                   uiMinutesClosed += ( uiEndTime - max( uiClosingTime, uiStartTime ) );
<a name="l02852"></a>02852             }
<a name="l02853"></a>02853       }
<a name="l02854"></a>02854       <span class="keywordflow">else</span>
<a name="l02855"></a>02855       {
<a name="l02856"></a>02856             Assert( uiEndTime &lt; uiStartTime );
<a name="l02857"></a>02857 
<a name="l02858"></a>02858             <span class="comment">// recursive calls!  Add two separate times: before midnight, and after midnight</span>
<a name="l02859"></a>02859             uiMinutesClosed += <a class="code" href="Arms_01Dealer_01Init_8cpp.html#fed82cdd76b710b915a44ae4f8d143fd">CalculateMinutesClosedBetween</a>( ubArmsDealer, uiStartTime, NUM_MIN_IN_DAY );
<a name="l02860"></a>02860             uiMinutesClosed += <a class="code" href="Arms_01Dealer_01Init_8cpp.html#fed82cdd76b710b915a44ae4f8d143fd">CalculateMinutesClosedBetween</a>( ubArmsDealer, 0, uiEndTime );
<a name="l02861"></a>02861       }
<a name="l02862"></a>02862 
<a name="l02863"></a>02863       <span class="keywordflow">return</span> ( uiMinutesClosed );
<a name="l02864"></a>02864 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sat Sep 9 13:47:54 2006 for Build by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
