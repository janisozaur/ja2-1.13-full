<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Build: End Game.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="classes.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir_3179ea33d55a76dc38212d9eab798728.html">export</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_e5664b4b56927c8728eb3192fa60e338.html">hdc2</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_1eb12a41a47efb9efcd82fa98f4f4dbd.html">FTP</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_80cc1f21a78ab7941088ea567f236150.html">ja2src</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_994ab287602efefceafe55287a3657d6.html">Build</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_43ed33c8f48e75fecb0508860a16371c.html">Tactical</a></div>
<h1>End Game.cpp</h1><a href="End_01Game_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#ifdef PRECOMPILEDHEADERS</span>
<a name="l00002"></a>00002 <span class="preprocessor"></span><span class="preprocessor">      #include "<a class="code" href="Tactical_01All_8h.html">Tactical All.h</a>"</span>
<a name="l00003"></a>00003 <span class="preprocessor">      #include "<a class="code" href="PreBattle_01Interface_8h.html">PreBattle Interface.h</a>"</span>
<a name="l00004"></a>00004 <span class="preprocessor">      #include "<a class="code" href="Intro_8h.html">Intro.h</a>"</span>
<a name="l00005"></a>00005 <span class="preprocessor">#else</span>
<a name="l00006"></a>00006 <span class="preprocessor"></span><span class="preprocessor">      #include "<a class="code" href="Soldier_01Control_8h.html">Soldier Control.h</a>"</span>
<a name="l00007"></a>00007 <span class="preprocessor">      #include "<a class="code" href="Overhead_8h.html">Overhead.h</a>"</span>
<a name="l00008"></a>00008 <span class="preprocessor">      #include "<a class="code" href="Boxing_8h.html">Boxing.h</a>"</span>
<a name="l00009"></a>00009 <span class="preprocessor">      #include "<a class="code" href="Render_01Fun_8h.html">Render Fun.h</a>"</span>
<a name="l00010"></a>00010 <span class="preprocessor">      #include "Random.h"</span>
<a name="l00011"></a>00011 <span class="preprocessor">      #include "Worldman.h"</span>
<a name="l00012"></a>00012 <span class="preprocessor">      #include "<a class="code" href="Soldier_01Profile_8h.html">Soldier Profile.h</a>"</span>
<a name="l00013"></a>00013 <span class="preprocessor">      #include "<a class="code" href="NPC_8h.html">NPC.h</a>"</span>
<a name="l00014"></a>00014 <span class="preprocessor">      #include "Opplist.h"</span>
<a name="l00015"></a>00015 <span class="preprocessor">      #include "<a class="code" href="ai_8h.html">ai.h</a>"</span>
<a name="l00016"></a>00016 <span class="preprocessor">      #include "<a class="code" href="Dialogue_01Control_8h.html">Dialogue Control.h</a>"</span>
<a name="l00017"></a>00017 <span class="preprocessor">      #include "<a class="code" href="Handle_01UI_8h.html">Handle UI.h</a>"</span>
<a name="l00018"></a>00018 <span class="preprocessor">      #include "<a class="code" href="Points_8h.html">Points.h</a>"</span>
<a name="l00019"></a>00019 <span class="preprocessor">      #include "interface.h"</span>
<a name="l00020"></a>00020 <span class="preprocessor">      #include "end game.h"</span>
<a name="l00021"></a>00021 <span class="preprocessor">      #include "<a class="code" href="Intro_8h.html">Intro.h</a>"</span>
<a name="l00022"></a>00022 <span class="preprocessor">#endif</span>
<a name="l00023"></a>00023 <span class="preprocessor"></span>
<a name="l00024"></a><a class="code" href="End_01Game_8cpp.html#3fdbe4b9a0ac785fbee3c51b5dc1a80f">00024</a> <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> <a class="code" href="End_01Game_8cpp.html#3fdbe4b9a0ac785fbee3c51b5dc1a80f">sStatueGridNos</a>[] = { 13829, 13830, 13669, 13670 };
<a name="l00025"></a>00025 
<a name="l00026"></a><a class="code" href="End_01Game_8cpp.html#9eef2f3e00258140346b4055c7e1dee7">00026</a> <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *<a class="code" href="End_01Game_8cpp.html#9eef2f3e00258140346b4055c7e1dee7">gpKillerSoldier</a> = NULL;
<a name="l00027"></a><a class="code" href="End_01Game_8cpp.html#00f042bd0276d6a6a38c0de555ef6ab1">00027</a> <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a>                    <a class="code" href="End_01Game_8cpp.html#00f042bd0276d6a6a38c0de555ef6ab1">gsGridNo</a>;
<a name="l00028"></a><a class="code" href="End_01Game_8cpp.html#851b57cb6201ada299ec59563f2c1b99">00028</a> <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>                     <a class="code" href="End_01Game_8cpp.html#851b57cb6201ada299ec59563f2c1b99">gbLevel</a>;
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 <span class="comment">// This function checks if our statue exists in the current sector at given gridno</span>
<a name="l00032"></a><a class="code" href="End_01Game_8h.html#80a78e6f7eb417824ae32475041d995b">00032</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="End_01Game_8cpp.html#80a78e6f7eb417824ae32475041d995b">DoesO3SectorStatueExistHere</a>( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sGridNo )
<a name="l00033"></a>00033 {
<a name="l00034"></a>00034       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> cnt;
<a name="l00035"></a>00035       <a class="code" href="structEXITGRID.html">EXITGRID</a>                                              ExitGrid;
<a name="l00036"></a>00036 
<a name="l00037"></a>00037       <span class="comment">// First check current sector......</span>
<a name="l00038"></a>00038       <span class="keywordflow">if</span> ( <a class="code" href="strategicmap_8cpp.html#49d9aed144a633fda4ba1990f002d703">gWorldSectorX</a> == 3 &amp;&amp; <a class="code" href="strategicmap_8cpp.html#ea322310ced0e35ee18a2ee7b32aac5b">gWorldSectorY</a> == MAP_ROW_O &amp;&amp; <a class="code" href="strategicmap_8cpp.html#da715721a8ceedd42acf6ddb33e63ce0">gbWorldSectorZ</a> == 0 )
<a name="l00039"></a>00039       {
<a name="l00040"></a>00040             <span class="comment">// Check for exitence of and exit grid here...</span>
<a name="l00041"></a>00041             <span class="comment">// ( if it doesn't then the change has already taken place )</span>
<a name="l00042"></a>00042             <span class="keywordflow">if</span> ( !<a class="code" href="Exit_01Grids_8cpp.html#037545bb2441749cabcfd26c68bf9dba">GetExitGrid</a>( 13669, &amp;ExitGrid ) )
<a name="l00043"></a>00043             {
<a name="l00044"></a>00044                   <span class="keywordflow">for</span> ( cnt = 0; cnt &lt; 4; cnt++ )
<a name="l00045"></a>00045                   {
<a name="l00046"></a>00046                         <span class="keywordflow">if</span> ( <a class="code" href="End_01Game_8cpp.html#3fdbe4b9a0ac785fbee3c51b5dc1a80f">sStatueGridNos</a>[ cnt ] == sGridNo )
<a name="l00047"></a>00047                         {
<a name="l00048"></a>00048                               <span class="keywordflow">return</span>( TRUE );
<a name="l00049"></a>00049                         }
<a name="l00050"></a>00050                   }
<a name="l00051"></a>00051             }
<a name="l00052"></a>00052       }
<a name="l00053"></a>00053 
<a name="l00054"></a>00054       <span class="keywordflow">return</span>( FALSE );
<a name="l00055"></a>00055 }
<a name="l00056"></a>00056 
<a name="l00057"></a>00057 <span class="comment">// This function changes the graphic of the statue and adds the exit grid...</span>
<a name="l00058"></a><a class="code" href="End_01Game_8h.html#1217879bacb3dd196d8a87847e0e2d8a">00058</a> <span class="keywordtype">void</span> <a class="code" href="End_01Game_8cpp.html#1217879bacb3dd196d8a87847e0e2d8a">ChangeO3SectorStatue</a>( <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fFromExplosion )
<a name="l00059"></a>00059 {
<a name="l00060"></a>00060       <a class="code" href="structEXITGRID.html">EXITGRID</a>                                              ExitGrid;
<a name="l00061"></a>00061       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>                                                      usTileIndex;
<a name="l00062"></a>00062       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sX, sY;
<a name="l00063"></a>00063 
<a name="l00064"></a>00064       <span class="comment">// Remove old graphic</span>
<a name="l00065"></a>00065       <a class="code" href="SaveLoadMap_8cpp.html#b21040d8a2dd004ba4c9bd36ac249ff3">ApplyMapChangesToMapTempFile</a>( TRUE );
<a name="l00066"></a>00066       <span class="comment">// Remove it!</span>
<a name="l00067"></a>00067       <span class="comment">// Get index for it...</span>
<a name="l00068"></a>00068       <a class="code" href="tiledef_8cpp.html#88fb4209f479cf8705b24390553f0e16">GetTileIndexFromTypeSubIndex</a>( <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f79748bcddfc5eb94507987c6c8480b49102b0">EIGHTOSTRUCT</a>, (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)( 5 ), &amp;usTileIndex );                              
<a name="l00069"></a>00069       <a class="code" href="worldman_8cpp.html#d86473576ee54508483e8f6f988fb0c5">RemoveStruct</a>( 13830, usTileIndex );
<a name="l00070"></a>00070       
<a name="l00071"></a>00071       <span class="comment">// Add new one...</span>
<a name="l00072"></a>00072       <span class="keywordflow">if</span> ( fFromExplosion )
<a name="l00073"></a>00073       {
<a name="l00074"></a>00074             <span class="comment">// Use damaged peice</span>
<a name="l00075"></a>00075             <a class="code" href="tiledef_8cpp.html#88fb4209f479cf8705b24390553f0e16">GetTileIndexFromTypeSubIndex</a>( <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f79748bcddfc5eb94507987c6c8480b49102b0">EIGHTOSTRUCT</a>, (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)( 7 ), &amp;usTileIndex );                              
<a name="l00076"></a>00076       }
<a name="l00077"></a>00077       <span class="keywordflow">else</span>
<a name="l00078"></a>00078       {
<a name="l00079"></a>00079             <a class="code" href="tiledef_8cpp.html#88fb4209f479cf8705b24390553f0e16">GetTileIndexFromTypeSubIndex</a>( <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f79748bcddfc5eb94507987c6c8480b49102b0">EIGHTOSTRUCT</a>, (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)( 8 ), &amp;usTileIndex );                              
<a name="l00080"></a>00080             <span class="comment">// Play sound...</span>
<a name="l00081"></a>00081 
<a name="l00082"></a>00082     <a class="code" href="Sound_01Control_8cpp.html#6b140a8e4fcf89b7740c037ff12580a7">PlayJA2Sample</a>( <a class="code" href="Sound_01Control_8h.html#946995a6d03371486c23b23d9ca362b5dd5f211a6125bd8869088fcdb179ef5c">OPEN_STATUE</a>, RATE_11025, HIGHVOLUME, 1, MIDDLEPAN );                           
<a name="l00083"></a>00083 
<a name="l00084"></a>00084       }
<a name="l00085"></a>00085       <a class="code" href="worldman_8cpp.html#6a74993bd387fec96118ebb0e42f6681">AddStructToHead</a>( 13830, usTileIndex );
<a name="l00086"></a>00086 
<a name="l00087"></a>00087       <span class="comment">// Add exit grid</span>
<a name="l00088"></a>00088       ExitGrid.<a class="code" href="structEXITGRID.html#be2391f8f2c824649ea407d1e55f1d37">ubGotoSectorX</a> = 3;
<a name="l00089"></a>00089       ExitGrid.<a class="code" href="structEXITGRID.html#a4bb29c874b59f3fa036c74396e5d380">ubGotoSectorY</a> = MAP_ROW_O;
<a name="l00090"></a>00090       ExitGrid.<a class="code" href="structEXITGRID.html#dd200e8d180007d574c3fef1dd4c3f4a">ubGotoSectorZ</a> = 1;
<a name="l00091"></a>00091       ExitGrid.<a class="code" href="structEXITGRID.html#5f85afe87e9d6a769949974c656dd426">usGridNo</a> = 13037;
<a name="l00092"></a>00092 
<a name="l00093"></a>00093       <a class="code" href="Exit_01Grids_8cpp.html#83c0ba186ee387d93c4951e452775bcb">AddExitGridToWorld</a>( 13669, &amp;ExitGrid );
<a name="l00094"></a>00094       <a class="code" href="worlddef_8cpp.html#a1c640bcf89772795e6517da9963e0d7">gpWorldLevelData</a>[ 13669 ].<a class="code" href="structMAP__ELEMENT.html#430f12029207b5bb7b32ed30ef355253">uiFlags</a> |= MAPELEMENT_REVEALED;
<a name="l00095"></a>00095 
<a name="l00096"></a>00096       <span class="comment">// Turn off permenant changes....</span>
<a name="l00097"></a>00097       <a class="code" href="SaveLoadMap_8cpp.html#b21040d8a2dd004ba4c9bd36ac249ff3">ApplyMapChangesToMapTempFile</a>( FALSE );
<a name="l00098"></a>00098 
<a name="l00099"></a>00099       <span class="comment">// Re-render the world!</span>
<a name="l00100"></a>00100       <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#89eb954f99ad4f28b84d7cf675c8ed32">uiFlags</a> |= NOHIDE_REDUNDENCY;
<a name="l00101"></a>00101       <span class="comment">// FOR THE NEXT RENDER LOOP, RE-EVALUATE REDUNDENT TILES</span>
<a name="l00102"></a>00102       <a class="code" href="renderworld_8cpp.html#1e1ddb2858063ee68614cd6c221369bb">InvalidateWorldRedundency</a>( );
<a name="l00103"></a>00103       <a class="code" href="renderworld_8cpp.html#986f210b1a26336aa2943bdce24ffb94">SetRenderFlags</a>(RENDER_FLAG_FULL);
<a name="l00104"></a>00104 
<a name="l00105"></a>00105       <span class="comment">// Redo movement costs....</span>
<a name="l00106"></a>00106       <a class="code" href="Isometric_01Utils_8cpp.html#42da2d46d5074c97787f28fdf5c51073">ConvertGridNoToXY</a>( 13830, &amp;sX, &amp;sY );
<a name="l00107"></a>00107 
<a name="l00108"></a>00108       <a class="code" href="worlddef_8cpp.html#26ee830f0d9b77dea7feee9cde874558">RecompileLocalMovementCostsFromRadius</a>( 13830, 5 );
<a name="l00109"></a>00109 
<a name="l00110"></a>00110 }
<a name="l00111"></a>00111 
<a name="l00112"></a><a class="code" href="End_01Game_8cpp.html#9953739e26099f8b70675c109a80b4f5">00112</a> <span class="keywordtype">void</span> <a class="code" href="End_01Game_8cpp.html#9953739e26099f8b70675c109a80b4f5">DeidrannaTimerCallback</a>( <span class="keywordtype">void</span> )
<a name="l00113"></a>00113 {
<a name="l00114"></a>00114       <a class="code" href="End_01Game_8cpp.html#0e3e64f84b2253ec4a53637616c33269">HandleDeidrannaDeath</a>( <a class="code" href="End_01Game_8cpp.html#9eef2f3e00258140346b4055c7e1dee7">gpKillerSoldier</a>, <a class="code" href="End_01Game_8cpp.html#00f042bd0276d6a6a38c0de555ef6ab1">gsGridNo</a>, <a class="code" href="End_01Game_8cpp.html#851b57cb6201ada299ec59563f2c1b99">gbLevel</a> );
<a name="l00115"></a>00115 }
<a name="l00116"></a>00116 
<a name="l00117"></a>00117 
<a name="l00118"></a><a class="code" href="End_01Game_8h.html#a69cab42d668299325dddc4045680348">00118</a> <span class="keywordtype">void</span> <a class="code" href="End_01Game_8cpp.html#a69cab42d668299325dddc4045680348">BeginHandleDeidrannaDeath</a>( <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *pKillerSoldier, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sGridNo, <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bLevel )
<a name="l00119"></a>00119 {
<a name="l00120"></a>00120       <a class="code" href="End_01Game_8cpp.html#9eef2f3e00258140346b4055c7e1dee7">gpKillerSoldier</a> = pKillerSoldier;
<a name="l00121"></a>00121       <a class="code" href="End_01Game_8cpp.html#00f042bd0276d6a6a38c0de555ef6ab1">gsGridNo</a> = sGridNo;
<a name="l00122"></a>00122       <a class="code" href="End_01Game_8cpp.html#851b57cb6201ada299ec59563f2c1b99">gbLevel</a>  = bLevel;
<a name="l00123"></a>00123 
<a name="l00124"></a>00124       <span class="comment">// Lock the UI.....</span>
<a name="l00125"></a>00125       <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#89eb954f99ad4f28b84d7cf675c8ed32">uiFlags</a> |= ENGAGED_IN_CONV;
<a name="l00126"></a>00126       <span class="comment">// Increment refrence count...</span>
<a name="l00127"></a>00127       <a class="code" href="Dialogue_01Control_8cpp.html#802eda027df54e41eebb6020bfe41b46">giNPCReferenceCount</a> = 1;
<a name="l00128"></a>00128 
<a name="l00129"></a>00129       <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#89eb954f99ad4f28b84d7cf675c8ed32">uiFlags</a> |= IN_DEIDRANNA_ENDGAME;
<a name="l00130"></a>00130 
<a name="l00131"></a>00131       <a class="code" href="Timer_01Control_8cpp.html#ea6ae1cc206c97b220fafdb86bf158e5">SetCustomizableTimerCallbackAndDelay</a>( 2000, <a class="code" href="End_01Game_8cpp.html#9953739e26099f8b70675c109a80b4f5">DeidrannaTimerCallback</a>, FALSE );
<a name="l00132"></a>00132 
<a name="l00133"></a>00133 }
<a name="l00134"></a>00134 
<a name="l00135"></a><a class="code" href="End_01Game_8h.html#0e3e64f84b2253ec4a53637616c33269">00135</a> <span class="keywordtype">void</span> <a class="code" href="End_01Game_8cpp.html#0e3e64f84b2253ec4a53637616c33269">HandleDeidrannaDeath</a>( <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *pKillerSoldier, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sGridNo, <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bLevel )
<a name="l00136"></a>00136 {
<a name="l00137"></a>00137       <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *pTeamSoldier;
<a name="l00138"></a>00138       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> cnt;
<a name="l00139"></a>00139       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a>       sDistVisible = FALSE;
<a name="l00140"></a>00140       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>       ubKillerSoldierID = NOBODY;
<a name="l00141"></a>00141 
<a name="l00142"></a>00142       <span class="comment">// Start victory music here...</span>
<a name="l00143"></a>00143       <a class="code" href="Music_01Control_8cpp.html#6048469cd3be966558a4ba87cbbf41ef">SetMusicMode</a>( <a class="code" href="Music_01Control_8h.html#537bb0477379f935f13aee9969289d1fd196898e7cb7233a7031941002236f64">MUSIC_TACTICAL_VICTORY</a> );
<a name="l00144"></a>00144 
<a name="l00145"></a>00145 
<a name="l00146"></a>00146       <span class="keywordflow">if</span> ( pKillerSoldier )
<a name="l00147"></a>00147       {
<a name="l00148"></a>00148             <a class="code" href="Dialogue_01Control_8cpp.html#78d57daff1e69f02d5d83bd74d30e520">TacticalCharacterDialogue</a>( pKillerSoldier, <a class="code" href="Dialogue_01Control_8h.html#db9a2c9e383607c8609a364ff1521a294c3801fac6365827bf44fd3a07fe2704">QUOTE_KILLING_DEIDRANNA</a> );   
<a name="l00149"></a>00149             ubKillerSoldierID = pKillerSoldier-&gt;ubID;
<a name="l00150"></a>00150       }
<a name="l00151"></a>00151 
<a name="l00152"></a>00152       <span class="comment">// STEP 1 ) START ALL QUOTES GOING!</span>
<a name="l00153"></a>00153       <span class="comment">// OK - loop through all witnesses and see if they want to say something abou this...</span>
<a name="l00154"></a>00154       cnt = <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#2ecddfe580bb019bc92cc4859eaf3edc">Team</a>[ <a class="code" href="Campaign_8cpp.html#47b2067ff75193e24776eda5297400ff">gbPlayerNum</a> ].<a class="code" href="structTacticalTeamType.html#f8fe819ad07b242f5dbf97fd4c69b00d">bFirstID</a>;   
<a name="l00155"></a>00155 
<a name="l00156"></a>00156       <span class="comment">// run through list</span>
<a name="l00157"></a>00157       <span class="keywordflow">for</span> ( pTeamSoldier = <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ cnt ]; cnt &lt;= <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#2ecddfe580bb019bc92cc4859eaf3edc">Team</a>[ <a class="code" href="Campaign_8cpp.html#47b2067ff75193e24776eda5297400ff">gbPlayerNum</a> ].<a class="code" href="structTacticalTeamType.html#6a887279dad735dc302f21c1e559d5ce">bLastID</a>; cnt++,pTeamSoldier++ )
<a name="l00158"></a>00158       {
<a name="l00159"></a>00159             <span class="keywordflow">if</span> ( cnt != ubKillerSoldierID )
<a name="l00160"></a>00160             {
<a name="l00161"></a>00161                   <span class="keywordflow">if</span> ( OK_INSECTOR_MERC( pTeamSoldier ) &amp;&amp; !( pTeamSoldier-&gt;uiStatusFlags &amp; SOLDIER_GASSED ) &amp;&amp; !AM_AN_EPC( pTeamSoldier ) )
<a name="l00162"></a>00162                   {
<a name="l00163"></a>00163                               <span class="keywordflow">if</span> ( <a class="code" href="QARRAY_8cpp.html#4c3e016f09fa6ec775dbef8756c7a925">QuoteExp_WitnessDeidrannaDeath</a>[ pTeamSoldier-&gt;ubProfile ] )
<a name="l00164"></a>00164                               {
<a name="l00165"></a>00165                                     <span class="comment">// Can we see location?</span>
<a name="l00166"></a>00166                                     sDistVisible = <a class="code" href="opplist_8cpp.html#3024b66f9b450ab359bf03734c3aad9b">DistanceVisible</a>( pTeamSoldier, <a class="code" href="Overhead_01Types_8h.html#df5bf54a26a76adf253f57d88ade82b7680b9f541cb30851967400ce4b0f2807">DIRECTION_IRRELEVANT</a>, <a class="code" href="Overhead_01Types_8h.html#df5bf54a26a76adf253f57d88ade82b7680b9f541cb30851967400ce4b0f2807">DIRECTION_IRRELEVANT</a>, sGridNo, bLevel, pTeamSoldier );
<a name="l00167"></a>00167 
<a name="l00168"></a>00168                                     <span class="keywordflow">if</span> ( <a class="code" href="LOS_8cpp.html#7ccd0f206cf1c499fcb25349e20fd106">SoldierTo3DLocationLineOfSightTest</a>( pTeamSoldier, sGridNo,  bLevel, 3, (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>) sDistVisible, TRUE ) )
<a name="l00169"></a>00169                                     {
<a name="l00170"></a>00170                                           <a class="code" href="Dialogue_01Control_8cpp.html#78d57daff1e69f02d5d83bd74d30e520">TacticalCharacterDialogue</a>( pTeamSoldier, <a class="code" href="Dialogue_01Control_8h.html#db9a2c9e383607c8609a364ff1521a294c3801fac6365827bf44fd3a07fe2704">QUOTE_KILLING_DEIDRANNA</a> );     
<a name="l00171"></a>00171                                     }
<a name="l00172"></a>00172                               }
<a name="l00173"></a>00173                   }
<a name="l00174"></a>00174             }
<a name="l00175"></a>00175       }
<a name="l00176"></a>00176 
<a name="l00177"></a>00177       <span class="comment">// Set fact that she is dead!</span>
<a name="l00178"></a>00178       <a class="code" href="Quests_8cpp.html#d7278c1ec0f9cc2ac9af20f8a6b446db">SetFactTrue</a>( <a class="code" href="Quests_8h.html#aead3e57f613f07868a1b2afb6b943f1c2c1fc03e7f5f0870adbf041d9a26c6a">FACT_QUEEN_DEAD</a> );
<a name="l00179"></a>00179 
<a name="l00180"></a>00180       <a class="code" href="Strategic_01AI_8cpp.html#230d26f39269ac3fbef951d4dda19c6d">ExecuteStrategicAIAction</a>( <a class="code" href="Strategic_01AI_8h.html#b79db5277fcbe695243c6d68332cbf4c9d4b5dd879dcd0dc23de6868a4d42f01">STRATEGIC_AI_ACTION_QUEEN_DEAD</a>, 0, 0 );
<a name="l00181"></a>00181 
<a name="l00182"></a>00182       <span class="comment">// AFTER LAST ONE IS DONE - PUT SPECIAL EVENT ON QUEUE TO BEGIN FADE&lt; ETC</span>
<a name="l00183"></a>00183       <a class="code" href="Dialogue_01Control_8cpp.html#9c7b126747b7255086d33bd7c4764865">SpecialCharacterDialogueEvent</a>( DIALOGUE_SPECIAL_EVENT_MULTIPURPOSE, MULTIPURPOSE_SPECIAL_EVENT_DONE_KILLING_DEIDRANNA, 0,0,0,0 );
<a name="l00184"></a>00184 
<a name="l00185"></a>00185 }
<a name="l00186"></a>00186 
<a name="l00187"></a><a class="code" href="End_01Game_8cpp.html#9f6f4dbda352bdd801afee7cb6b74203">00187</a> <span class="keywordtype">void</span> <a class="code" href="End_01Game_8cpp.html#9f6f4dbda352bdd801afee7cb6b74203">DoneFadeInKilledQueen</a>( <span class="keywordtype">void</span> )
<a name="l00188"></a>00188 {
<a name="l00189"></a>00189       <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *pNPCSoldier;
<a name="l00190"></a>00190 
<a name="l00191"></a>00191       <span class="comment">// Locate gridno.....</span>
<a name="l00192"></a>00192 
<a name="l00193"></a>00193       <span class="comment">// Run NPC script</span>
<a name="l00194"></a>00194       pNPCSoldier = <a class="code" href="Soldier_01Profile_8cpp.html#2a54c4a06df8ed61529646f23682ef9d">FindSoldierByProfileID</a>( 136, FALSE );
<a name="l00195"></a>00195       <span class="keywordflow">if</span> ( !pNPCSoldier )
<a name="l00196"></a>00196       {
<a name="l00197"></a>00197             <span class="keywordflow">return</span>;
<a name="l00198"></a>00198       }
<a name="l00199"></a>00199 
<a name="l00200"></a>00200       <span class="comment">// Converse!</span>
<a name="l00201"></a>00201       <span class="comment">//InitiateConversation( pNPCSoldier, pSoldier, 0, 1 );</span>
<a name="l00202"></a>00202       <a class="code" href="NPC_8cpp.html#e001fe367bf9edf08b486f360857531e">TriggerNPCRecordImmediately</a>( pNPCSoldier-&gt;<a class="code" href="structSOLDIERTYPE.html#5a5648a1bb3507cc41f6be199c51a3f8">ubProfile</a>, 6 );
<a name="l00203"></a>00203 
<a name="l00204"></a>00204 }
<a name="l00205"></a>00205 
<a name="l00206"></a><a class="code" href="End_01Game_8cpp.html#7d20a1df0d807c2d9ed62dc793ad863b">00206</a> <span class="keywordtype">void</span> <a class="code" href="End_01Game_8cpp.html#7d20a1df0d807c2d9ed62dc793ad863b">DoneFadeOutKilledQueen</a>( <span class="keywordtype">void</span> )
<a name="l00207"></a>00207 {
<a name="l00208"></a>00208       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> cnt;
<a name="l00209"></a>00209       <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>, *pTeamSoldier;
<a name="l00210"></a>00210 
<a name="l00211"></a>00211       <span class="comment">// For one, loop through our current squad and move them over</span>
<a name="l00212"></a>00212       cnt = <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#2ecddfe580bb019bc92cc4859eaf3edc">Team</a>[ <a class="code" href="Campaign_8cpp.html#47b2067ff75193e24776eda5297400ff">gbPlayerNum</a> ].<a class="code" href="structTacticalTeamType.html#f8fe819ad07b242f5dbf97fd4c69b00d">bFirstID</a>;
<a name="l00213"></a>00213 
<a name="l00214"></a>00214       <span class="comment">// look for all mercs on the same team, </span>
<a name="l00215"></a>00215       <span class="keywordflow">for</span> ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> = <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ cnt ]; cnt &lt;= <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#2ecddfe580bb019bc92cc4859eaf3edc">Team</a>[ <a class="code" href="Campaign_8cpp.html#47b2067ff75193e24776eda5297400ff">gbPlayerNum</a> ].<a class="code" href="structTacticalTeamType.html#6a887279dad735dc302f21c1e559d5ce">bLastID</a>; cnt++,<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>++)
<a name="l00216"></a>00216       {       
<a name="l00217"></a>00217             <span class="comment">// Are we in this sector, On the current squad?</span>
<a name="l00218"></a>00218             <span class="keywordflow">if</span> ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#653dad4e2520784e293eca9f948b8532">bActive</a> &amp;&amp; <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#e308dea18533bf5ab2bcee5bbe27391c">bLife</a> &gt;= OKLIFE &amp;&amp; <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#b0096f321a0de4f0617283f7b3212aa0">bInSector</a> &amp;&amp; <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#4269b53195147b458cd1e6874429734b">bAssignment</a> == <a class="code" href="Squads_8cpp.html#7b191255333292b85d3e366c8def7a21">CurrentSquad</a>( ) )
<a name="l00219"></a>00219             {
<a name="l00220"></a>00220                   <a class="code" href="PreBattle_01Interface_8cpp.html#b63bc2c71a7f99c29899a3c46180807b">gfTacticalTraversal</a> = TRUE;
<a name="l00221"></a>00221                   <a class="code" href="Strategic_01Movement_8cpp.html#baf7126623d5439078fb8fd1fdf5d8e2">SetGroupSectorValue</a>( 3, MAP_ROW_P, 0, <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#7f3c88742fc830ce555bb016e9e68fcd">ubGroupID</a> );
<a name="l00222"></a>00222 
<a name="l00223"></a>00223                   <span class="comment">// Set next sectore</span>
<a name="l00224"></a>00224                   <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#6784346500db10daed06c2db02b855c0">sSectorX</a> = 3;
<a name="l00225"></a>00225                   <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#6dd68e70c3000beb79e4ac45d28a0cbf">sSectorY</a> = MAP_ROW_P;
<a name="l00226"></a>00226                   <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#b70b761f0405cc179c1ffba84484df28">bSectorZ</a> = 0;
<a name="l00227"></a>00227 
<a name="l00228"></a>00228                   <span class="comment">// Set gridno</span>
<a name="l00229"></a>00229                   <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#1e83daaaf894f2205884f2b37cc78b22">ubStrategicInsertionCode</a> = <a class="code" href="strategic_8h.html#ff44cf33e83896b8e5102305d23db5ac6a7bdb362607484db311fa7fef1dec3e">INSERTION_CODE_GRIDNO</a>;
<a name="l00230"></a>00230                   <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#a03e39af0c54104ce6b5713317655a70">usStrategicInsertionData</a> = 5687;
<a name="l00231"></a>00231                   <span class="comment">// Set direction to face....</span>
<a name="l00232"></a>00232                   <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#2d9015bbe94d02cd9c6b20515007d927">ubInsertionDirection</a>             = 100 + <a class="code" href="Overhead_01Types_8h.html#df5bf54a26a76adf253f57d88ade82b7c8aee466c121a3c3c942f58e1d8864d4">NORTHWEST</a>;
<a name="l00233"></a>00233             }
<a name="l00234"></a>00234       }
<a name="l00235"></a>00235 
<a name="l00236"></a>00236       <span class="comment">// Kill all enemies in world.....</span>
<a name="l00237"></a>00237       cnt = <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#2ecddfe580bb019bc92cc4859eaf3edc">Team</a>[ ENEMY_TEAM ].<a class="code" href="structTacticalTeamType.html#f8fe819ad07b242f5dbf97fd4c69b00d">bFirstID</a>;
<a name="l00238"></a>00238 
<a name="l00239"></a>00239       <span class="comment">// look for all mercs on the same team, </span>
<a name="l00240"></a>00240       <span class="keywordflow">for</span> ( pTeamSoldier = <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ cnt ]; cnt &lt;= <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#2ecddfe580bb019bc92cc4859eaf3edc">Team</a>[ ENEMY_TEAM ].<a class="code" href="structTacticalTeamType.html#6a887279dad735dc302f21c1e559d5ce">bLastID</a>; cnt++,pTeamSoldier++)
<a name="l00241"></a>00241       {       
<a name="l00242"></a>00242             <span class="comment">// Are we active and in sector.....</span>
<a name="l00243"></a>00243             <span class="keywordflow">if</span> ( pTeamSoldier-&gt;<a class="code" href="structSOLDIERTYPE.html#653dad4e2520784e293eca9f948b8532">bActive</a>  )
<a name="l00244"></a>00244             {
<a name="l00245"></a>00245                   <span class="comment">// For sure for flag thet they are dead is not set</span>
<a name="l00246"></a>00246                   <span class="comment">// Check for any more badguys</span>
<a name="l00247"></a>00247                   <span class="comment">// ON THE STRAGETY LAYER KILL BAD GUYS!</span>
<a name="l00248"></a>00248                   <a class="code" href="Soldier_01Ani_8cpp.html#c294aa65f0375eb6343a2de2a25dafcc">if</a> ( !pTeamSoldier-&gt;<a class="code" href="structSOLDIERTYPE.html#165874ef5822faaf165da91996ad4a7b">bNeutral</a> &amp;&amp; (pTeamSoldier-&gt;<a class="code" href="structSOLDIERTYPE.html#1e61c0006bacccf9457c3f6c43607578">bSide</a> != <a class="code" href="Campaign_8cpp.html#47b2067ff75193e24776eda5297400ff">gbPlayerNum</a> ) )
<a name="l00249"></a>00249                   {
<a name="l00250"></a>00250                         <a class="code" href="Queen_01Command_8cpp.html#1772190a0a0c19dfb080e209c6911bf3">ProcessQueenCmdImplicationsOfDeath</a>( pTeamSoldier );
<a name="l00251"></a>00251                   }
<a name="l00252"></a>00252             }
<a name="l00253"></a>00253       }
<a name="l00254"></a>00254 
<a name="l00255"></a>00255       <span class="comment">// 'End' battle</span>
<a name="l00256"></a>00256       <a class="code" href="Overhead_8cpp.html#1c57c83abe2ec2811e97884ab517cbb5">ExitCombatMode</a>();
<a name="l00257"></a>00257       <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#c03d0488eb9b578309b6f1cc9d3d05cb">fLastBattleWon</a> = TRUE;
<a name="l00258"></a>00258       <span class="comment">// Set enemy presence to false</span>
<a name="l00259"></a>00259       <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#a921ee4fc79277889d9c1cec0985d3a3">fEnemyInSector</a> = FALSE;
<a name="l00260"></a>00260 
<a name="l00261"></a>00261       <a class="code" href="Music_01Control_8cpp.html#6048469cd3be966558a4ba87cbbf41ef">SetMusicMode</a>( <a class="code" href="Music_01Control_8h.html#537bb0477379f935f13aee9969289d1fd196898e7cb7233a7031941002236f64">MUSIC_TACTICAL_VICTORY</a> );
<a name="l00262"></a>00262 
<a name="l00263"></a>00263       <a class="code" href="Morale_8cpp.html#83b28a6d9386bb3d8d581943fa7e9a28">HandleMoraleEvent</a>( NULL, <a class="code" href="Morale_8h.html#67ab756e41250f85e7e729e45554f3c3d917f4d923c7feb09ac47655e4f7fcf9">MORALE_QUEEN_BATTLE_WON</a>, 3, MAP_ROW_P, 0 );
<a name="l00264"></a>00264       <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#c03d88b7111537efc64a9bd5e158d281">HandleGlobalLoyaltyEvent</a>( <a class="code" href="Strategic_01Town_01Loyalty_8h.html#c87e57c62b9acde099ca97c24a49ddb7af71f198be80ba50dcb07634a85a0c21">GLOBAL_LOYALTY_QUEEN_BATTLE_WON</a>, 3, MAP_ROW_P, 0 );
<a name="l00265"></a>00265 
<a name="l00266"></a>00266       <a class="code" href="Music_01Control_8cpp.html#6048469cd3be966558a4ba87cbbf41ef">SetMusicMode</a>( <a class="code" href="Music_01Control_8h.html#537bb0477379f935f13aee9969289d1fd196898e7cb7233a7031941002236f64">MUSIC_TACTICAL_VICTORY</a> );
<a name="l00267"></a>00267                         
<a name="l00268"></a>00268       <a class="code" href="Player_01Command_8cpp.html#29e8261cbfadc378a3d712f04382d7db">SetThisSectorAsPlayerControlled</a>( <a class="code" href="strategicmap_8cpp.html#49d9aed144a633fda4ba1990f002d703">gWorldSectorX</a>, <a class="code" href="strategicmap_8cpp.html#ea322310ced0e35ee18a2ee7b32aac5b">gWorldSectorY</a>, <a class="code" href="strategicmap_8cpp.html#da715721a8ceedd42acf6ddb33e63ce0">gbWorldSectorZ</a>, TRUE );
<a name="l00269"></a>00269       
<a name="l00270"></a>00270       <span class="comment">// ATE: Force change of level set z to 1</span>
<a name="l00271"></a>00271       <a class="code" href="strategicmap_8cpp.html#da715721a8ceedd42acf6ddb33e63ce0">gbWorldSectorZ</a> = 1;
<a name="l00272"></a>00272 
<a name="l00273"></a>00273       <span class="comment">// Clear out dudes.......</span>
<a name="l00274"></a>00274       <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ <a class="code" href="Campaign_01Types_8h.html#38436632403fcee6aacb5b18c66026438a2eb9999a6ad7c69c9ddbe2d95696ca">SEC_P3</a> ].<a class="code" href="structSECTORINFO.html#d7d5ee63c0dc2ad3164c83541bd80906">ubNumAdmins</a> = 0;
<a name="l00275"></a>00275       <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ <a class="code" href="Campaign_01Types_8h.html#38436632403fcee6aacb5b18c66026438a2eb9999a6ad7c69c9ddbe2d95696ca">SEC_P3</a> ].<a class="code" href="structSECTORINFO.html#e36540b93256cfa71e45382f133d3696">ubNumTroops</a> = 0;
<a name="l00276"></a>00276       <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ <a class="code" href="Campaign_01Types_8h.html#38436632403fcee6aacb5b18c66026438a2eb9999a6ad7c69c9ddbe2d95696ca">SEC_P3</a> ].<a class="code" href="structSECTORINFO.html#3c5312672399c40ec5a395e8bcfb0104">ubNumElites</a> = 0;
<a name="l00277"></a>00277       <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ <a class="code" href="Campaign_01Types_8h.html#38436632403fcee6aacb5b18c66026438a2eb9999a6ad7c69c9ddbe2d95696ca">SEC_P3</a> ].<a class="code" href="structSECTORINFO.html#e1047265a56df6c7326b3e3464aeeae0">ubAdminsInBattle</a> = 0;
<a name="l00278"></a>00278       <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ <a class="code" href="Campaign_01Types_8h.html#38436632403fcee6aacb5b18c66026438a2eb9999a6ad7c69c9ddbe2d95696ca">SEC_P3</a> ].<a class="code" href="structSECTORINFO.html#946d7de687c0ed6992d9297ab78fdb52">ubTroopsInBattle</a> = 0;
<a name="l00279"></a>00279       <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ <a class="code" href="Campaign_01Types_8h.html#38436632403fcee6aacb5b18c66026438a2eb9999a6ad7c69c9ddbe2d95696ca">SEC_P3</a> ].<a class="code" href="structSECTORINFO.html#fcb6e4b81ad82c10ea061320799c79d7">ubElitesInBattle</a> = 0;
<a name="l00280"></a>00280 
<a name="l00281"></a>00281   <span class="comment">// ATE: GEt rid of elliot in P3...</span>
<a name="l00282"></a>00282   <a class="code" href="Soldier_01Profile_8cpp.html#1bcff2c50b375b1eb32800aa12000289">gMercProfiles</a>[ <a class="code" href="Soldier_01Profile_8h.html#acaa92dcb344e96138c964deae3e2fa16960fe1226f34f684b9dbdf6ab84817f">ELLIOT</a> ].<a class="code" href="structMERCPROFILESTRUCT.html#b0d6f66ec41a0d9c87fbc03dd9fed965">sSectorX</a> = 1;
<a name="l00283"></a>00283 
<a name="l00284"></a>00284       <a class="code" href="Tactical_01Save_8cpp.html#7afd883e19e5bf23659aecbcf34e762d">ChangeNpcToDifferentSector</a>( <a class="code" href="Soldier_01Profile_8h.html#acaa92dcb344e96138c964deae3e2fa1e71d909f0d555a51943a91934554f33d">DEREK</a>, 3, MAP_ROW_P, 0 );
<a name="l00285"></a>00285       <a class="code" href="Tactical_01Save_8cpp.html#7afd883e19e5bf23659aecbcf34e762d">ChangeNpcToDifferentSector</a>( <a class="code" href="Soldier_01Profile_8h.html#acaa92dcb344e96138c964deae3e2fa1d4dc1ab6b2e619d7037bb89161c2b71b">OLIVER</a>, 3, MAP_ROW_P, 0 );
<a name="l00286"></a>00286 
<a name="l00287"></a>00287 
<a name="l00288"></a>00288       <span class="comment">// OK, insertion data found, enter sector!</span>
<a name="l00289"></a>00289       <a class="code" href="strategicmap_8cpp.html#ed1731dd2cd018974e5f92118e13c7a1">SetCurrentWorldSector</a>( 3, MAP_ROW_P, 0 );
<a name="l00290"></a>00290 
<a name="l00291"></a>00291       <span class="comment">// OK, once down here, adjust the above map with crate info....</span>
<a name="l00292"></a>00292       <a class="code" href="PreBattle_01Interface_8cpp.html#b63bc2c71a7f99c29899a3c46180807b">gfTacticalTraversal</a> = FALSE;
<a name="l00293"></a>00293       <a class="code" href="PreBattle_01Interface_8cpp.html#3bf238aae0fedc5e2a886676384edda1">gpTacticalTraversalGroup</a> = NULL;
<a name="l00294"></a>00294       <a class="code" href="PreBattle_01Interface_8cpp.html#11296b3ccb2fd5e6b5e09ec3d77ff565">gpTacticalTraversalChosenSoldier</a> = NULL;
<a name="l00295"></a>00295 
<a name="l00296"></a>00296       <a class="code" href="Fade_01Screen_8cpp.html#cb4087996c1c2bd1383f2b7224505fdc">gFadeInDoneCallback</a> = <a class="code" href="End_01Game_8cpp.html#9f6f4dbda352bdd801afee7cb6b74203">DoneFadeInKilledQueen</a>;
<a name="l00297"></a>00297 
<a name="l00298"></a>00298       <a class="code" href="gamescreen_8cpp.html#7c5d78098499c16d5a59f15c896248dd">FadeInGameScreen</a>( );
<a name="l00299"></a>00299 }
<a name="l00300"></a>00300 
<a name="l00301"></a>00301 <span class="comment">// Called after all player quotes are done....</span>
<a name="l00302"></a><a class="code" href="End_01Game_8h.html#da0d51ec7739cd80c7148e49439d25b2">00302</a> <span class="keywordtype">void</span> <a class="code" href="End_01Game_8cpp.html#da0d51ec7739cd80c7148e49439d25b2">HandleDoneLastKilledQueenQuote</a>( )
<a name="l00303"></a>00303 {
<a name="l00304"></a>00304       <a class="code" href="Fade_01Screen_8cpp.html#94519d7763062ac6c03c761cbf2af2e3">gFadeOutDoneCallback</a> = <a class="code" href="End_01Game_8cpp.html#7d20a1df0d807c2d9ed62dc793ad863b">DoneFadeOutKilledQueen</a>;
<a name="l00305"></a>00305 
<a name="l00306"></a>00306       <a class="code" href="gamescreen_8cpp.html#3d092682cbc336d26097ba7440477576">FadeOutGameScreen</a>( );   
<a name="l00307"></a>00307 }
<a name="l00308"></a>00308 
<a name="l00309"></a>00309 
<a name="l00310"></a><a class="code" href="End_01Game_8h.html#ba2f2fd0612365e782d27f8d761a11b1">00310</a> <span class="keywordtype">void</span> <a class="code" href="End_01Game_8cpp.html#ba2f2fd0612365e782d27f8d761a11b1">EndQueenDeathEndgameBeginEndCimenatic</a>( )
<a name="l00311"></a>00311 {
<a name="l00312"></a>00312       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> cnt;
<a name="l00313"></a>00313       <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>;
<a name="l00314"></a>00314 
<a name="l00315"></a>00315       <span class="comment">// Start end cimimatic....</span>
<a name="l00316"></a>00316   <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#89eb954f99ad4f28b84d7cf675c8ed32">uiFlags</a> |= IN_ENDGAME_SEQUENCE;
<a name="l00317"></a>00317 
<a name="l00318"></a>00318       <span class="comment">// first thing is to loop through team and say end quote...</span>
<a name="l00319"></a>00319       cnt = <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#2ecddfe580bb019bc92cc4859eaf3edc">Team</a>[ <a class="code" href="Campaign_8cpp.html#47b2067ff75193e24776eda5297400ff">gbPlayerNum</a> ].<a class="code" href="structTacticalTeamType.html#f8fe819ad07b242f5dbf97fd4c69b00d">bFirstID</a>;
<a name="l00320"></a>00320 
<a name="l00321"></a>00321       <span class="comment">// look for all mercs on the same team, </span>
<a name="l00322"></a>00322       <span class="keywordflow">for</span> ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> = <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ cnt ]; cnt &lt;= <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#2ecddfe580bb019bc92cc4859eaf3edc">Team</a>[ <a class="code" href="Campaign_8cpp.html#47b2067ff75193e24776eda5297400ff">gbPlayerNum</a> ].<a class="code" href="structTacticalTeamType.html#6a887279dad735dc302f21c1e559d5ce">bLastID</a>; cnt++,<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>++)
<a name="l00323"></a>00323       {       
<a name="l00324"></a>00324             <span class="comment">// Are we in this sector, On the current squad?</span>
<a name="l00325"></a>00325             <span class="keywordflow">if</span> ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#653dad4e2520784e293eca9f948b8532">bActive</a> &amp;&amp; <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#e308dea18533bf5ab2bcee5bbe27391c">bLife</a> &gt;= OKLIFE &amp;&amp; !AM_AN_EPC( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> ) )
<a name="l00326"></a>00326             {
<a name="l00327"></a>00327                   <a class="code" href="Dialogue_01Control_8cpp.html#78d57daff1e69f02d5d83bd74d30e520">TacticalCharacterDialogue</a>( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>, <a class="code" href="Dialogue_01Control_8h.html#db9a2c9e383607c8609a364ff1521a2945e790d1bf194a4a590155ba22a47720">QUOTE_END_GAME_COMMENT</a> );    
<a name="l00328"></a>00328             }
<a name="l00329"></a>00329       }
<a name="l00330"></a>00330 
<a name="l00331"></a>00331       <span class="comment">// Add queue event to proceed w/ smacker cimimatic</span>
<a name="l00332"></a>00332       <a class="code" href="Dialogue_01Control_8cpp.html#9c7b126747b7255086d33bd7c4764865">SpecialCharacterDialogueEvent</a>( DIALOGUE_SPECIAL_EVENT_MULTIPURPOSE, MULTIPURPOSE_SPECIAL_EVENT_TEAM_MEMBERS_DONE_TALKING, 0,0,0,0 );
<a name="l00333"></a>00333 
<a name="l00334"></a>00334 }
<a name="l00335"></a>00335 
<a name="l00336"></a><a class="code" href="End_01Game_8h.html#242dd36210c2b06d9498b2dcc51ef989">00336</a> <span class="keywordtype">void</span> <a class="code" href="End_01Game_8cpp.html#242dd36210c2b06d9498b2dcc51ef989">EndQueenDeathEndgame</a>( )
<a name="l00337"></a>00337 {
<a name="l00338"></a>00338       <span class="comment">// Unset flags...</span>
<a name="l00339"></a>00339       <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#89eb954f99ad4f28b84d7cf675c8ed32">uiFlags</a> &amp;= (~ENGAGED_IN_CONV );
<a name="l00340"></a>00340       <span class="comment">// Increment refrence count...</span>
<a name="l00341"></a>00341       <a class="code" href="Dialogue_01Control_8cpp.html#802eda027df54e41eebb6020bfe41b46">giNPCReferenceCount</a> = 0;
<a name="l00342"></a>00342 
<a name="l00343"></a>00343       <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#89eb954f99ad4f28b84d7cf675c8ed32">uiFlags</a> &amp;= (~IN_DEIDRANNA_ENDGAME);
<a name="l00344"></a>00344 }
<a name="l00345"></a>00345 
<a name="l00346"></a>00346 
<a name="l00347"></a><a class="code" href="End_01Game_8cpp.html#394b3ab32e5caf9040b00ca500d04a5c">00347</a> <span class="keywordtype">void</span> <a class="code" href="End_01Game_8cpp.html#394b3ab32e5caf9040b00ca500d04a5c">DoneFadeOutEndCinematic</a>( <span class="keywordtype">void</span> )
<a name="l00348"></a>00348 {
<a name="l00349"></a>00349       <span class="comment">// DAVE PUT SMAKER STUFF HERE!!!!!!!!!!!!</span>
<a name="l00350"></a>00350       <span class="comment">// :)</span>
<a name="l00351"></a>00351   <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#89eb954f99ad4f28b84d7cf675c8ed32">uiFlags</a> &amp;= (~IN_ENDGAME_SEQUENCE);
<a name="l00352"></a>00352 
<a name="l00353"></a>00353 
<a name="l00354"></a>00354       <span class="comment">// For now, just quit the freaken game...</span>
<a name="l00355"></a>00355 <span class="comment">//    InternalLeaveTacticalScreen( MAINMENU_SCREEN );</span>
<a name="l00356"></a>00356 
<a name="l00357"></a>00357       <a class="code" href="gamescreen_8cpp.html#91036b4d0b9a861fdc906f07f19d35da">InternalLeaveTacticalScreen</a>( <a class="code" href="screenids_8h.html#a4ee5dea8709d2b490486a62df77faf25fa27d2c9471032b28795bfe2c40e1e8">INTRO_SCREEN</a> );
<a name="l00358"></a>00358 <span class="comment">//    guiCurrentScreen = INTRO_SCREEN;</span>
<a name="l00359"></a>00359 
<a name="l00360"></a>00360 
<a name="l00361"></a>00361       <a class="code" href="Intro_8cpp.html#271d6095af6de5761aff045d23fa4d2d">SetIntroType</a>( <a class="code" href="Intro_8h.html#fa9be5679ab03d785820f2474c5ccc6e9e840866f55eea840a38578db5dd4584">INTRO_ENDING</a> );
<a name="l00362"></a>00362 }
<a name="l00363"></a>00363 
<a name="l00364"></a>00364 <span class="comment">// OK, end death UI - fade to smaker....</span>
<a name="l00365"></a><a class="code" href="End_01Game_8h.html#9e7c830f62640479f3d3ce94e96bf383">00365</a> <span class="keywordtype">void</span> <a class="code" href="End_01Game_8cpp.html#9e7c830f62640479f3d3ce94e96bf383">HandleDoneLastEndGameQuote</a>( )
<a name="l00366"></a>00366 {
<a name="l00367"></a>00367       <a class="code" href="End_01Game_8cpp.html#242dd36210c2b06d9498b2dcc51ef989">EndQueenDeathEndgame</a>( );
<a name="l00368"></a>00368 
<a name="l00369"></a>00369       <a class="code" href="Fade_01Screen_8cpp.html#94519d7763062ac6c03c761cbf2af2e3">gFadeOutDoneCallback</a> = <a class="code" href="End_01Game_8cpp.html#394b3ab32e5caf9040b00ca500d04a5c">DoneFadeOutEndCinematic</a>;
<a name="l00370"></a>00370 
<a name="l00371"></a>00371       <a class="code" href="gamescreen_8cpp.html#3d092682cbc336d26097ba7440477576">FadeOutGameScreen</a>( );   
<a name="l00372"></a>00372 }
<a name="l00373"></a>00373 
<a name="l00374"></a>00374 
<a name="l00375"></a>00375 
<a name="l00376"></a><a class="code" href="End_01Game_8cpp.html#6cd81e3065864b5ff6aa904fb3c035f7">00376</a> <span class="keywordtype">void</span> <a class="code" href="End_01Game_8cpp.html#6cd81e3065864b5ff6aa904fb3c035f7">QueenBitchTimerCallback</a>( <span class="keywordtype">void</span> )
<a name="l00377"></a>00377 {
<a name="l00378"></a>00378       <a class="code" href="End_01Game_8cpp.html#f1b8c414feda78899959b8ce52c2bc88">HandleQueenBitchDeath</a>( <a class="code" href="End_01Game_8cpp.html#9eef2f3e00258140346b4055c7e1dee7">gpKillerSoldier</a>, <a class="code" href="End_01Game_8cpp.html#00f042bd0276d6a6a38c0de555ef6ab1">gsGridNo</a>, <a class="code" href="End_01Game_8cpp.html#851b57cb6201ada299ec59563f2c1b99">gbLevel</a> );
<a name="l00379"></a>00379 }
<a name="l00380"></a>00380 
<a name="l00381"></a>00381 
<a name="l00382"></a><a class="code" href="End_01Game_8h.html#df8a2374c294c1605b040428236f1bba">00382</a> <span class="keywordtype">void</span> <a class="code" href="End_01Game_8cpp.html#df8a2374c294c1605b040428236f1bba">BeginHandleQueenBitchDeath</a>( <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *pKillerSoldier, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sGridNo, <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bLevel )
<a name="l00383"></a>00383 {
<a name="l00384"></a>00384       <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *pTeamSoldier;
<a name="l00385"></a>00385       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> cnt;
<a name="l00386"></a>00386 
<a name="l00387"></a>00387 
<a name="l00388"></a>00388       <a class="code" href="End_01Game_8cpp.html#9eef2f3e00258140346b4055c7e1dee7">gpKillerSoldier</a> = pKillerSoldier;
<a name="l00389"></a>00389       <a class="code" href="End_01Game_8cpp.html#00f042bd0276d6a6a38c0de555ef6ab1">gsGridNo</a> = sGridNo;
<a name="l00390"></a>00390       <a class="code" href="End_01Game_8cpp.html#851b57cb6201ada299ec59563f2c1b99">gbLevel</a>  = bLevel;
<a name="l00391"></a>00391 
<a name="l00392"></a>00392       <span class="comment">// Lock the UI.....</span>
<a name="l00393"></a>00393        <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#89eb954f99ad4f28b84d7cf675c8ed32">uiFlags</a> |= ENGAGED_IN_CONV;
<a name="l00394"></a>00394       <span class="comment">// Increment refrence count...</span>
<a name="l00395"></a>00395        <a class="code" href="Dialogue_01Control_8cpp.html#802eda027df54e41eebb6020bfe41b46">giNPCReferenceCount</a> = 1;
<a name="l00396"></a>00396 
<a name="l00397"></a>00397       <span class="comment">// gTacticalStatus.uiFlags |= IN_DEIDRANNA_ENDGAME;</span>
<a name="l00398"></a>00398 
<a name="l00399"></a>00399       <a class="code" href="Timer_01Control_8cpp.html#ea6ae1cc206c97b220fafdb86bf158e5">SetCustomizableTimerCallbackAndDelay</a>( 3000, <a class="code" href="End_01Game_8cpp.html#6cd81e3065864b5ff6aa904fb3c035f7">QueenBitchTimerCallback</a>, FALSE );
<a name="l00400"></a>00400 
<a name="l00401"></a>00401 
<a name="l00402"></a>00402       <span class="comment">// Kill all enemies in creature team.....</span>
<a name="l00403"></a>00403       cnt = <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#2ecddfe580bb019bc92cc4859eaf3edc">Team</a>[ CREATURE_TEAM ].<a class="code" href="structTacticalTeamType.html#f8fe819ad07b242f5dbf97fd4c69b00d">bFirstID</a>;
<a name="l00404"></a>00404 
<a name="l00405"></a>00405       <span class="comment">// look for all mercs on the same team, </span>
<a name="l00406"></a>00406       <span class="keywordflow">for</span> ( pTeamSoldier = <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ cnt ]; cnt &lt;= <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#2ecddfe580bb019bc92cc4859eaf3edc">Team</a>[ CREATURE_TEAM ].<a class="code" href="structTacticalTeamType.html#6a887279dad735dc302f21c1e559d5ce">bLastID</a>; cnt++,pTeamSoldier++)
<a name="l00407"></a>00407       {       
<a name="l00408"></a>00408             <span class="comment">// Are we active and ALIVE and in sector.....</span>
<a name="l00409"></a>00409             <span class="keywordflow">if</span> ( pTeamSoldier-&gt;<a class="code" href="structSOLDIERTYPE.html#653dad4e2520784e293eca9f948b8532">bActive</a> &amp;&amp; pTeamSoldier-&gt;<a class="code" href="structSOLDIERTYPE.html#e308dea18533bf5ab2bcee5bbe27391c">bLife</a> &gt; 0 )
<a name="l00410"></a>00410             {
<a name="l00411"></a>00411                   <span class="comment">// For sure for flag thet they are dead is not set</span>
<a name="l00412"></a>00412                   <span class="comment">// Check for any more badguys</span>
<a name="l00413"></a>00413                   <span class="comment">// ON THE STRAGETY LAYER KILL BAD GUYS!</span>
<a name="l00414"></a>00414 
<a name="l00415"></a>00415                   <span class="comment">// HELLO!  THESE ARE CREATURES!  THEY CAN'T BE NEUTRAL!</span>
<a name="l00416"></a>00416                   <span class="comment">//if ( !pTeamSoldier-&gt;bNeutral &amp;&amp; (pTeamSoldier-&gt;bSide != gbPlayerNum ) )</span>
<a name="l00417"></a>00417                   {
<a name="l00418"></a>00418             <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#b44a086b36d7dd7af18e11f8fdea4d05">ubAttackBusyCount</a>++;
<a name="l00419"></a>00419                         <a class="code" href="Soldier_01Control_8cpp.html#fd682f78ff74004954749b59e523e7ce">EVENT_SoldierGotHit</a>( pTeamSoldier, 0, 10000, 0, pTeamSoldier-&gt;<a class="code" href="structSOLDIERTYPE.html#8aa6174a253c3fa21a3ec41ce0174340">bDirection</a>, 320, NOBODY , FIRE_WEAPON_NO_SPECIAL, pTeamSoldier-&gt;<a class="code" href="structSOLDIERTYPE.html#a2e765b8729e88a5e542a2e7852f0ccb">bAimShotLocation</a>, 0, NOWHERE );
<a name="l00420"></a>00420                   }
<a name="l00421"></a>00421             }
<a name="l00422"></a>00422       }
<a name="l00423"></a>00423 
<a name="l00424"></a>00424 
<a name="l00425"></a>00425 }
<a name="l00426"></a>00426 
<a name="l00427"></a><a class="code" href="End_01Game_8h.html#f1b8c414feda78899959b8ce52c2bc88">00427</a> <span class="keywordtype">void</span> <a class="code" href="End_01Game_8cpp.html#f1b8c414feda78899959b8ce52c2bc88">HandleQueenBitchDeath</a>( <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *pKillerSoldier, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sGridNo, <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bLevel )
<a name="l00428"></a>00428 {
<a name="l00429"></a>00429       <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *pTeamSoldier;
<a name="l00430"></a>00430       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> cnt;
<a name="l00431"></a>00431       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a>       sDistVisible = FALSE;
<a name="l00432"></a>00432       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>       ubKillerSoldierID = NOBODY;
<a name="l00433"></a>00433 
<a name="l00434"></a>00434       <span class="comment">// Start victory music here...</span>
<a name="l00435"></a>00435       <a class="code" href="Music_01Control_8cpp.html#6048469cd3be966558a4ba87cbbf41ef">SetMusicMode</a>( <a class="code" href="Music_01Control_8h.html#537bb0477379f935f13aee9969289d1fd196898e7cb7233a7031941002236f64">MUSIC_TACTICAL_VICTORY</a> );
<a name="l00436"></a>00436 
<a name="l00437"></a>00437       <span class="keywordflow">if</span> ( pKillerSoldier )
<a name="l00438"></a>00438       {
<a name="l00439"></a>00439             <a class="code" href="Dialogue_01Control_8cpp.html#78d57daff1e69f02d5d83bd74d30e520">TacticalCharacterDialogue</a>( pKillerSoldier, <a class="code" href="Dialogue_01Control_8h.html#db9a2c9e383607c8609a364ff1521a299733f0ccec22ff9bb55143c0d7819df9">QUOTE_KILLING_QUEEN</a> ); 
<a name="l00440"></a>00440             ubKillerSoldierID = pKillerSoldier-&gt;ubID;
<a name="l00441"></a>00441       }
<a name="l00442"></a>00442 
<a name="l00443"></a>00443       <span class="comment">// STEP 1 ) START ALL QUOTES GOING!</span>
<a name="l00444"></a>00444       <span class="comment">// OK - loop through all witnesses and see if they want to say something abou this...</span>
<a name="l00445"></a>00445       cnt = <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#2ecddfe580bb019bc92cc4859eaf3edc">Team</a>[ <a class="code" href="Campaign_8cpp.html#47b2067ff75193e24776eda5297400ff">gbPlayerNum</a> ].<a class="code" href="structTacticalTeamType.html#f8fe819ad07b242f5dbf97fd4c69b00d">bFirstID</a>;   
<a name="l00446"></a>00446 
<a name="l00447"></a>00447       <span class="comment">// run through list</span>
<a name="l00448"></a>00448       <span class="keywordflow">for</span> ( pTeamSoldier = <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ cnt ]; cnt &lt;= <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#2ecddfe580bb019bc92cc4859eaf3edc">Team</a>[ <a class="code" href="Campaign_8cpp.html#47b2067ff75193e24776eda5297400ff">gbPlayerNum</a> ].<a class="code" href="structTacticalTeamType.html#6a887279dad735dc302f21c1e559d5ce">bLastID</a>; cnt++,pTeamSoldier++ )
<a name="l00449"></a>00449       {
<a name="l00450"></a>00450             <span class="keywordflow">if</span> ( cnt != ubKillerSoldierID )
<a name="l00451"></a>00451             {
<a name="l00452"></a>00452                   <span class="keywordflow">if</span> ( OK_INSECTOR_MERC( pTeamSoldier ) &amp;&amp; !( pTeamSoldier-&gt;uiStatusFlags &amp; SOLDIER_GASSED ) &amp;&amp; !AM_AN_EPC( pTeamSoldier ) )
<a name="l00453"></a>00453                   {
<a name="l00454"></a>00454                               <span class="keywordflow">if</span> ( <a class="code" href="QARRAY_8cpp.html#4ab1a8c7de7d7700224f6941d9f6fa70">QuoteExp_WitnessQueenBugDeath</a>[ pTeamSoldier-&gt;ubProfile ] )
<a name="l00455"></a>00455                               {
<a name="l00456"></a>00456                                     <span class="comment">// Can we see location?</span>
<a name="l00457"></a>00457                                     sDistVisible = <a class="code" href="opplist_8cpp.html#3024b66f9b450ab359bf03734c3aad9b">DistanceVisible</a>( pTeamSoldier, <a class="code" href="Overhead_01Types_8h.html#df5bf54a26a76adf253f57d88ade82b7680b9f541cb30851967400ce4b0f2807">DIRECTION_IRRELEVANT</a>, <a class="code" href="Overhead_01Types_8h.html#df5bf54a26a76adf253f57d88ade82b7680b9f541cb30851967400ce4b0f2807">DIRECTION_IRRELEVANT</a>, sGridNo, bLevel, pTeamSoldier );
<a name="l00458"></a>00458 
<a name="l00459"></a>00459                                     <span class="keywordflow">if</span> ( <a class="code" href="LOS_8cpp.html#7ccd0f206cf1c499fcb25349e20fd106">SoldierTo3DLocationLineOfSightTest</a>( pTeamSoldier, sGridNo,  bLevel, 3, (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>) sDistVisible, TRUE ) )
<a name="l00460"></a>00460                                     {
<a name="l00461"></a>00461                                           <a class="code" href="Dialogue_01Control_8cpp.html#78d57daff1e69f02d5d83bd74d30e520">TacticalCharacterDialogue</a>( pTeamSoldier, <a class="code" href="Dialogue_01Control_8h.html#db9a2c9e383607c8609a364ff1521a299733f0ccec22ff9bb55143c0d7819df9">QUOTE_KILLING_QUEEN</a> );   
<a name="l00462"></a>00462                                     }
<a name="l00463"></a>00463                               }
<a name="l00464"></a>00464                   }
<a name="l00465"></a>00465             }
<a name="l00466"></a>00466       }
<a name="l00467"></a>00467 
<a name="l00468"></a>00468 
<a name="l00469"></a>00469       <span class="comment">// Set fact that she is dead!</span>
<a name="l00470"></a>00470       <span class="keywordflow">if</span> ( <a class="code" href="Quests_8cpp.html#6744b59d27bf2791d0c2fefe18e548d3">CheckFact</a>( <a class="code" href="Quests_8h.html#aead3e57f613f07868a1b2afb6b943f1c2c1fc03e7f5f0870adbf041d9a26c6a">FACT_QUEEN_DEAD</a>, 0 ) ) 
<a name="l00471"></a>00471   {
<a name="l00472"></a>00472      <a class="code" href="End_01Game_8cpp.html#ba2f2fd0612365e782d27f8d761a11b1">EndQueenDeathEndgameBeginEndCimenatic</a>( );
<a name="l00473"></a>00473   }
<a name="l00474"></a>00474   <span class="keywordflow">else</span>
<a name="l00475"></a>00475   {
<a name="l00476"></a>00476         <span class="comment">// Unset flags...</span>
<a name="l00477"></a>00477         <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#89eb954f99ad4f28b84d7cf675c8ed32">uiFlags</a> &amp;= (~ENGAGED_IN_CONV );
<a name="l00478"></a>00478         <span class="comment">// Increment refrence count...</span>
<a name="l00479"></a>00479         <a class="code" href="Dialogue_01Control_8cpp.html#802eda027df54e41eebb6020bfe41b46">giNPCReferenceCount</a> = 0;
<a name="l00480"></a>00480   }
<a name="l00481"></a>00481 }
<a name="l00482"></a>00482 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sat Sep 9 13:48:07 2006 for Build by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
