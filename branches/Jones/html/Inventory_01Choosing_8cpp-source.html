<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Build: Inventory Choosing.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="classes.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir_3179ea33d55a76dc38212d9eab798728.html">export</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_e5664b4b56927c8728eb3192fa60e338.html">hdc2</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_1eb12a41a47efb9efcd82fa98f4f4dbd.html">FTP</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_80cc1f21a78ab7941088ea567f236150.html">ja2src</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_994ab287602efefceafe55287a3657d6.html">Build</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_43ed33c8f48e75fecb0508860a16371c.html">Tactical</a></div>
<h1>Inventory Choosing.cpp</h1><a href="Inventory_01Choosing_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#ifdef PRECOMPILEDHEADERS</span>
<a name="l00002"></a>00002 <span class="preprocessor"></span><span class="preprocessor">      #include "<a class="code" href="Tactical_01All_8h.html">Tactical All.h</a>"</span>
<a name="l00003"></a>00003 <span class="preprocessor">#else</span>
<a name="l00004"></a>00004 <span class="preprocessor"></span><span class="preprocessor">      #include &lt;memory.h&gt;</span>
<a name="l00005"></a>00005 <span class="preprocessor">      #include "<a class="code" href="Inventory_01Choosing_8h.html">Inventory Choosing.h</a>"</span>
<a name="l00006"></a>00006 <span class="preprocessor">      #include "animation data.h"</span>
<a name="l00007"></a>00007 <span class="preprocessor">      #include "<a class="code" href="Items_8h.html">Items.h</a>"</span>
<a name="l00008"></a>00008 <span class="preprocessor">      #include "Random.h"</span>
<a name="l00009"></a>00009 <span class="preprocessor">      #include "<a class="code" href="Weapons_8h.html">Weapons.h</a>"</span>
<a name="l00010"></a>00010 <span class="preprocessor">      #include "<a class="code" href="Strategic_01Status_8h.html">Strategic Status.h</a>"</span>
<a name="l00011"></a>00011 <span class="preprocessor">      #include "<a class="code" href="Campaign_8h.html">Campaign.h</a>"</span>
<a name="l00012"></a>00012 <span class="preprocessor">      #include "<a class="code" href="GameSettings_8h.html">GameSettings.h</a>"</span>
<a name="l00013"></a>00013 <span class="preprocessor">#endif</span>
<a name="l00014"></a>00014 <span class="preprocessor"></span>
<a name="l00015"></a>00015 <span class="comment">/*</span>
<a name="l00016"></a>00016 <span class="comment">#define ENEMYAMMODROPRATE       100 //Madd 50      // % of time enemies drop ammunition</span>
<a name="l00017"></a>00017 <span class="comment">#define ENEMYGRENADEDROPRATE    100 //Madd 25      // % of time enemies drop grenades</span>
<a name="l00018"></a>00018 <span class="comment">#define ENEMYEQUIPDROPRATE       50 //Madd 15      // % of stuff enemies drop equipment</span>
<a name="l00019"></a>00019 <span class="comment"></span>
<a name="l00020"></a>00020 <span class="comment">// only 1/10th of what enemies drop...</span>
<a name="l00021"></a>00021 <span class="comment">#define MILITIAAMMODROPRATE      100 //Madd 5      // % of time enemies drop ammunition</span>
<a name="l00022"></a>00022 <span class="comment">#define MILITIAGRENADEDROPRATE       100 //Madd 3      // % of time enemies drop grenades</span>
<a name="l00023"></a>00023 <span class="comment">#define MILITIAEQUIPDROPRATE      50 //Madd 2      // % of stuff enemies drop equipment</span>
<a name="l00024"></a>00024 <span class="comment"></span>
<a name="l00025"></a>00025 <span class="comment">*/</span>
<a name="l00026"></a><a class="code" href="Inventory_01Choosing_8cpp.html#a0d357b24ce2c7b87d1bbea829572901">00026</a> <span class="keywordtype">int</span> <a class="code" href="Inventory_01Choosing_8cpp.html#a0d357b24ce2c7b87d1bbea829572901">ENEMYAMMODROPRATE</a>;       <span class="comment">//100 //Madd 50      // % of time enemies drop ammunition</span>
<a name="l00027"></a><a class="code" href="Inventory_01Choosing_8cpp.html#ecd621787a92f586f62ff5936b162176">00027</a> <span class="keywordtype">int</span> <a class="code" href="Inventory_01Choosing_8cpp.html#ecd621787a92f586f62ff5936b162176">ENEMYGRENADEDROPRATE</a>;    <span class="comment">//100 //Madd 25      // % of time enemies drop grenades</span>
<a name="l00028"></a><a class="code" href="Inventory_01Choosing_8cpp.html#0645639b633a79cecab87db112491adb">00028</a> <span class="keywordtype">int</span> <a class="code" href="Inventory_01Choosing_8cpp.html#0645639b633a79cecab87db112491adb">ENEMYEQUIPDROPRATE</a>;       <span class="comment">//50 //Madd 15      // % of stuff enemies drop equipment</span>
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 <span class="comment">// only 1/10th of what enemies drop...</span>
<a name="l00031"></a><a class="code" href="Inventory_01Choosing_8cpp.html#a5d3eaca7cbc1150abefa0e63d9a436b">00031</a> <span class="keywordtype">int</span> <a class="code" href="Inventory_01Choosing_8cpp.html#a5d3eaca7cbc1150abefa0e63d9a436b">MILITIAAMMODROPRATE</a>;      <span class="comment">//100 //Madd 5      // % of time enemies drop ammunition</span>
<a name="l00032"></a><a class="code" href="Inventory_01Choosing_8cpp.html#d70ea801a892f8b4e6ed4df1bea01a4c">00032</a> <span class="keywordtype">int</span> <a class="code" href="Inventory_01Choosing_8cpp.html#d70ea801a892f8b4e6ed4df1bea01a4c">MILITIAGRENADEDROPRATE</a>;    <span class="comment">//100 //Madd 3      // % of time enemies drop grenades</span>
<a name="l00033"></a><a class="code" href="Inventory_01Choosing_8cpp.html#f2daed9a7d7a7af6af3a9d686ce85786">00033</a> <span class="keywordtype">int</span> <a class="code" href="Inventory_01Choosing_8cpp.html#f2daed9a7d7a7af6af3a9d686ce85786">MILITIAEQUIPDROPRATE</a>;      <span class="comment">//50 //Madd 2      // % of stuff enemies drop equipment</span>
<a name="l00034"></a>00034 
<a name="l00035"></a><a class="code" href="Inventory_01Choosing_8cpp.html#2d7083e8d574d45cc0ad92a135f59a6a">00035</a> <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> <a class="code" href="Inventory_01Choosing_8cpp.html#2d7083e8d574d45cc0ad92a135f59a6a">itemMortar</a>;
<a name="l00036"></a><a class="code" href="Inventory_01Choosing_8cpp.html#6c873614bbc1a238e64d251869b9d58d">00036</a> <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> <a class="code" href="Inventory_01Choosing_8cpp.html#6c873614bbc1a238e64d251869b9d58d">itemGrenadeLauncher</a>;
<a name="l00037"></a><a class="code" href="Inventory_01Choosing_8cpp.html#334a50c6a2cca7fc7a50437bab467cc5">00037</a> <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> <a class="code" href="Inventory_01Choosing_8cpp.html#334a50c6a2cca7fc7a50437bab467cc5">itemLAW</a>;
<a name="l00038"></a><a class="code" href="Inventory_01Choosing_8cpp.html#ae704b4d20efa38b25703ad586ecf2cc">00038</a> <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> <a class="code" href="Inventory_01Choosing_8cpp.html#ae704b4d20efa38b25703ad586ecf2cc">itemRPG</a>;
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 <span class="preprocessor">#define MAX_MORTARS_PER_TEAM              1                 // one team can't randomly roll more than this many mortars per sector</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span>
<a name="l00042"></a>00042 
<a name="l00043"></a><a class="code" href="Inventory_01Choosing_8cpp.html#8a2f82db14ba3613cacf33726dd246fb">00043</a> <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="Inventory_01Choosing_8cpp.html#8a2f82db14ba3613cacf33726dd246fb">guiMortarsRolledByTeam</a> = 0;
<a name="l00044"></a>00044 
<a name="l00045"></a>00045 
<a name="l00046"></a><a class="code" href="Inventory_01Choosing_8cpp.html#b3638e427bde75a24b32e47cbad94747">00046</a> <a class="code" href="structARMY__GUN__CHOICE__TYPE.html">ARMY_GUN_CHOICE_TYPE</a> <a class="code" href="Inventory_01Choosing_8cpp.html#b3638e427bde75a24b32e47cbad94747">gRegularArmyGunChoices</a>[ARMY_GUN_LEVELS] =
<a name="l00047"></a>00047 {     <span class="comment">// INDEX          CLASS                    #CHOICES</span>
<a name="l00048"></a>00048       { <span class="comment">/* 0 - lo pistols                 */</span>    2,    <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f46c1c44f20d205421819801f5ccf21a93">SW38</a>,                         <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4840bb62eb75a475abe62986113e4a1f3">DESERTEAGLE</a>,            -1,                                 -1,                           -1                            },
<a name="l00049"></a>00049       { <span class="comment">/* 1 - hi pistols                 */</span>    2,    <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f479442aa770eff64d46fac74ca4efb6c9">GLOCK_17</a>,               <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4acbee7d305b310ee72fd0b767478b59f">BERETTA_93R</a>,            -1,                                 -1,                           -1                            },
<a name="l00050"></a>00050       { <span class="comment">/* 2 - lo SMG/shotgun */</span>    2,    <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f46b0e7cb2a9813f1d7dba93a9f4a3a3e2">M870</a>,                         <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4cdfb771d94fb2d565d3479f8d34ca9e9">MP5K</a>,                               -1,                                 -1,                           -1                            },
<a name="l00051"></a>00051       { <span class="comment">/* 3 - lo rifles                  */</span>    1,    <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4c8b5df7a4fdfdb479cf411c31aa051df">MINI14</a>,                       -1,                                       -1,                                 -1,                           -1                            },
<a name="l00052"></a>00052       { <span class="comment">/* 4 - hi SMGs                    */</span>    2,    <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f40cc5eb7bdbda94d4aab12ee28e21f751">MAC10</a>,                        <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f49646bbaf522354b6c689c43683e17cdc">COMMANDO</a>,                     -1,                                 -1,                           -1                            },
<a name="l00053"></a>00053       { <span class="comment">/* 5 - med rifles           */</span>    1,    <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f404ba2b54c392dee1b5bd7cd6ddc4a793">G41</a>,                          -1,                                       -1,                                 -1,                           -1                            },
<a name="l00054"></a>00054       { <span class="comment">/* 6 - sniper rifles  */</span>    1,    <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4ff5e2890115b8ebaa1c80f5e160da20a">M24</a>,                          -1,                                       -1,                                 -1,                           -1                            },
<a name="l00055"></a>00055       {     <span class="comment">/* 7 - hi rifles              */</span>    2,    <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f41f55ccf3f6b1f1108dcba91ce49ad9fa">M14</a>,                          <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f44f858b829392e960b43c57a9731c98ac">C7</a>,                                       -1,                                 -1,                           -1                            },
<a name="l00056"></a>00056       { <span class="comment">/* 8 - best rifle                 */</span>    1,    <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4fb9c41a73c55b497dded3a4ad3fc954f">FNFAL</a>,                        -1,                                       -1,                                 -1,                           -1                            },
<a name="l00057"></a>00057       { <span class="comment">/* 9 - machine guns         */</span>    1,    <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4ebf086b00f573eb00091f9d09413441e">MINIMI</a>,                       -1,                                       -1,                                 -1,                           -1                            },
<a name="l00058"></a>00058       { <span class="comment">/* 10- rocket rifle         */</span>    2,    <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f414fab61ccceae56bef78dd5713323132">ROCKET_RIFLE</a>,     <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4ebf086b00f573eb00091f9d09413441e">MINIMI</a>,                                         -1,                                 -1,                           -1                            },
<a name="l00059"></a>00059 };
<a name="l00060"></a>00060 
<a name="l00061"></a><a class="code" href="Inventory_01Choosing_8h.html#d0d4ecc439e1e3f426e907a64bd61a43">00061</a> <a class="code" href="structARMY__GUN__CHOICE__TYPE.html">ARMY_GUN_CHOICE_TYPE</a> <a class="code" href="Inventory_01Choosing_8cpp.html#d0d4ecc439e1e3f426e907a64bd61a43">gExtendedArmyGunChoices</a>[ARMY_GUN_LEVELS];<span class="comment">// =</span>
<a name="l00062"></a>00062 <span class="comment">//{   // INDEX          CLASS                    #CHOICES</span>
<a name="l00063"></a>00063 <span class="comment">//    { /* 0 - lo pistols                 */    6,    SW38,                         BARRACUDA,              DESERTEAGLE,      GLOCK_17,         M1911,      BERETTA_92F,-1,-1,-1,-1 ,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1 ,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1           },</span>
<a name="l00064"></a>00064 <span class="comment">//    { /* 1 - hi pist/shtgn  */    6,    GLOCK_18,               BERETTA_93R,            P7M8, M870,                   M950        ,FIVE7,-1,-1,-1,-1      ,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1            },</span>
<a name="l00065"></a>00065 <span class="comment">//    { /* 2 - lo SMGs/shtgn  */    6,     TYPE85,                      THOMPSON,               MP5, MP53,                          MP5K, MP5SD,-1,-1,-1,-1 ,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1},</span>
<a name="l00066"></a>00066 <span class="comment">//    { /* 3 - lo rifles      */    4,    MINI14,                       SKS,                                BENNELLI,                                 SPAS15,                             -1          ,-1,-1,-1,-1,-1         ,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1      },</span>
<a name="l00067"></a>00067 <span class="comment">//    { /* 4 - hi SMGs                    */    7,    MAC10,                        AKSU74,           MICRO_UZI,        COMMANDO,               M960,                         UMP45       ,MP5N,-1,-1,-1    ,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1            },</span>
<a name="l00068"></a>00068 <span class="comment">//    { /* 5 - med rifles           */    6,    AKM,                          G3A3,                               G41,                          AK74,                   M900  ,AK103,-1,-1,-1,-1      ,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1            },</span>
<a name="l00069"></a>00069 <span class="comment">//    { /* 6 - sniper rifles  */    6,    DRAGUNOV,               M24,                                PSG,                                VAL_SILENT,                         BARRETT           ,MSG90A1,-1,-1,-1,-1    ,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1      },</span>
<a name="l00070"></a>00070 <span class="comment">//    {     /* 7 - hi rifles              */    7,    FAMAS,                        M14,                                AUG,                          C7,                     ENFIELD,          G36K,G36C,-1,-1,-1      ,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1      },</span>
<a name="l00071"></a>00071 <span class="comment">//    { /* 8 - best rifle                 */    4,    FNFAL,                        P90,                                G11,                                TAR21,                              -1,         -1,-1,-1,-1,-1    ,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1            },</span>
<a name="l00072"></a>00072 <span class="comment">//    { /* 9 - machine guns         */    3,    MINIMI,                       RPK74,                              HK21E,                        -1,                           -1,-1,-1,-1,-1,-1 ,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1            },</span>
<a name="l00073"></a>00073 <span class="comment">//    { /* 10- rocket rifle         */    5,    ROCKET_RIFLE,     AUTO_ROCKET_RIFLE ,      RPK74,                       HK21E,            MINIMI , -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1},</span>
<a name="l00074"></a>00074 <span class="comment">//};</span>
<a name="l00075"></a>00075 
<a name="l00076"></a><a class="code" href="Inventory_01Choosing_8h.html#f01edfefa28e6b717c50b0e959a15aca">00076</a> <a class="code" href="structARMY__GUN__CHOICE__TYPE.html">ARMY_GUN_CHOICE_TYPE</a> <a class="code" href="Inventory_01Choosing_8cpp.html#f01edfefa28e6b717c50b0e959a15aca">gArmyItemChoices</a>[<a class="code" href="Inventory_01Choosing_8h.html#85d881cb3816f77e92c1c8f721b54fc4a24076c5787461b719a07136fd0bd57d">MAX_ITEM_TYPES</a>];
<a name="l00077"></a>00077 
<a name="l00078"></a>00078 <span class="keywordtype">void</span> <a class="code" href="Inventory_01Choosing_8cpp.html#b082ba4847029fe7febaae508656ef0c">RandomlyChooseWhichItemsAreDroppable</a>( <a class="code" href="structSOLDIERCREATE__STRUCT.html">SOLDIERCREATE_STRUCT</a> *pp, <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bSoldierClass );
<a name="l00079"></a>00079 <span class="keywordtype">void</span> <a class="code" href="Inventory_01Choosing_8cpp.html#7b06561ebf45847c6be61b9ce13abdf8">EquipTank</a>( <a class="code" href="structSOLDIERCREATE__STRUCT.html">SOLDIERCREATE_STRUCT</a> *pp );
<a name="l00080"></a>00080 
<a name="l00081"></a>00081 <span class="keywordtype">void</span> <a class="code" href="Inventory_01Choosing_8cpp.html#dec56b2d6d01cd758af90cea8cb0f05d">ChooseKitsForSoldierCreateStruct</a>( <a class="code" href="structSOLDIERCREATE__STRUCT.html">SOLDIERCREATE_STRUCT</a> *pp, <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bKitClass );
<a name="l00082"></a>00082 <span class="keywordtype">void</span> <a class="code" href="Inventory_01Choosing_8cpp.html#7f5ace37f536ebc50c3c623aca7dedf1">ChooseMiscGearForSoldierCreateStruct</a>( <a class="code" href="structSOLDIERCREATE__STRUCT.html">SOLDIERCREATE_STRUCT</a> *pp, <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bMiscClass );
<a name="l00083"></a>00083 <span class="keywordtype">void</span> <a class="code" href="Inventory_01Choosing_8cpp.html#9a77f08f7cbee7f9edf38814f48f3345">ChooseBombsForSoldierCreateStruct</a>( <a class="code" href="structSOLDIERCREATE__STRUCT.html">SOLDIERCREATE_STRUCT</a> *pp, <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bBombClass );
<a name="l00084"></a>00084 <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> <a class="code" href="Inventory_01Choosing_8cpp.html#661ec86e3a255acaad87210de3b4b24d">PickARandomItem</a>(<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> typeIndex);
<a name="l00085"></a>00085 <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> <a class="code" href="Inventory_01Choosing_8cpp.html#661ec86e3a255acaad87210de3b4b24d">PickARandomItem</a>(<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> typeIndex, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> maxCoolness);
<a name="l00086"></a>00086 <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> <a class="code" href="Inventory_01Choosing_8cpp.html#661ec86e3a255acaad87210de3b4b24d">PickARandomItem</a>(<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> typeIndex, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> maxCoolness, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> getMatchingCoolness);
<a name="l00087"></a>00087 <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> <a class="code" href="Inventory_01Choosing_8cpp.html#542239fb2c141fed4755889a76e7fc7d">PickARandomAttachment</a>(<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> typeIndex, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usBaseItem, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> maxCoolness, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> getMatchingCoolness);
<a name="l00088"></a>00088 
<a name="l00089"></a>00089 
<a name="l00090"></a><a class="code" href="Inventory_01Choosing_8h.html#2897b7ed2fe821a774157d16d4c1048a">00090</a> <span class="keywordtype">void</span> <a class="code" href="Inventory_01Choosing_8cpp.html#2897b7ed2fe821a774157d16d4c1048a">InitArmyGunTypes</a>(<span class="keywordtype">void</span>)
<a name="l00091"></a>00091 {
<a name="l00092"></a>00092       <a class="code" href="structARMY__GUN__CHOICE__TYPE.html">ARMY_GUN_CHOICE_TYPE</a> *pGunChoiceTable;
<a name="l00093"></a>00093       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiGunLevel;
<a name="l00094"></a>00094       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiChoice;
<a name="l00095"></a>00095       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> bItemNo;
<a name="l00096"></a>00096       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> ubWeapon;
<a name="l00097"></a>00097 
<a name="l00098"></a>00098       DebugMsg (<a class="code" href="DEBUG_8cpp.html#a7985c2fd033797fc67a03b2c26e07c6">TOPIC_JA2</a>,DBG_LEVEL_3,<span class="stringliteral">"InitArmyGunTypes "</span>);
<a name="l00099"></a>00099 
<a name="l00100"></a>00100       DebugMsg (<a class="code" href="DEBUG_8cpp.html#a7985c2fd033797fc67a03b2c26e07c6">TOPIC_JA2</a>,DBG_LEVEL_3,<span class="stringliteral">"InitArmyGunTypes set gun choice table"</span>);
<a name="l00101"></a>00101       <span class="comment">// depending on selection of the gun nut option</span>
<a name="l00102"></a>00102       <span class="comment">//if (gGameOptions.fGunNut)</span>
<a name="l00103"></a>00103       <span class="comment">//{</span>
<a name="l00104"></a>00104             <span class="comment">// use table of extended gun choices</span>
<a name="l00105"></a>00105             pGunChoiceTable = &amp;(<a class="code" href="Inventory_01Choosing_8cpp.html#d0d4ecc439e1e3f426e907a64bd61a43">gExtendedArmyGunChoices</a>[0]);
<a name="l00106"></a>00106       <span class="comment">//}</span>
<a name="l00107"></a>00107       <span class="comment">//else</span>
<a name="l00108"></a>00108       <span class="comment">//{</span>
<a name="l00109"></a>00109       <span class="comment">//    // use table of regular gun choices</span>
<a name="l00110"></a>00110       <span class="comment">//    pGunChoiceTable = &amp;(gRegularArmyGunChoices[0]);</span>
<a name="l00111"></a>00111       <span class="comment">//}</span>
<a name="l00112"></a>00112 
<a name="l00113"></a>00113       DebugMsg (<a class="code" href="DEBUG_8cpp.html#a7985c2fd033797fc67a03b2c26e07c6">TOPIC_JA2</a>,DBG_LEVEL_3,<span class="stringliteral">"InitArmyGunTypes pick a gun type"</span>);
<a name="l00114"></a>00114       <span class="comment">// for each gun category</span>
<a name="l00115"></a>00115       <span class="keywordflow">for</span> (uiGunLevel = 0; uiGunLevel &lt;   ARMY_GUN_LEVELS; uiGunLevel++)
<a name="l00116"></a>00116       {
<a name="l00117"></a>00117             <span class="comment">// choose one the of the possible gun choices to be used by the army for this game &amp; store it</span>
<a name="l00118"></a>00118             uiChoice = <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(pGunChoiceTable[ uiGunLevel ].ubChoices);
<a name="l00119"></a>00119 
<a name="l00120"></a>00120             bItemNo = pGunChoiceTable[ uiGunLevel ].<a class="code" href="structARMY__GUN__CHOICE__TYPE.html#bced712a10aec3048cb4f3d74fb7484a">bItemNo</a>[ uiChoice ];
<a name="l00121"></a>00121             AssertMsg(bItemNo != -1, <span class="stringliteral">"Invalid army gun choice in table"</span>);
<a name="l00122"></a>00122             <a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#7aef405e37d332977d4419a2abe4a65f">ubStandardArmyGunIndex</a>[uiGunLevel] = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>) bItemNo;
<a name="l00123"></a>00123       }
<a name="l00124"></a>00124 
<a name="l00125"></a>00125       DebugMsg (<a class="code" href="DEBUG_8cpp.html#a7985c2fd033797fc67a03b2c26e07c6">TOPIC_JA2</a>,DBG_LEVEL_3,<span class="stringliteral">"InitArmyGunTypes mark weapons as not dropped"</span>);
<a name="l00126"></a>00126       <span class="comment">// set all flags that track whether this weapon type has been dropped before to FALSE</span>
<a name="l00127"></a>00127       <span class="keywordflow">for</span> (ubWeapon = 0; ubWeapon &lt; <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f40efaf5227d3f780f8db037c71e3f903f">MAXITEMS</a>; ubWeapon++) 
<a name="l00128"></a>00128       {
<a name="l00129"></a>00129             DebugMsg (TOPIC_JA2,DBG_LEVEL_3,<a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>(<span class="stringliteral">"InitArmyGunTypes marking weapons %d"</span>, ubWeapon));
<a name="l00130"></a>00130             <a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#6f67468571f9de657cc64880427d5b0b">fWeaponDroppedAlready</a>[ubWeapon] = FALSE;
<a name="l00131"></a>00131       }
<a name="l00132"></a>00132 
<a name="l00133"></a>00133       DebugMsg (TOPIC_JA2,DBG_LEVEL_3,<span class="stringliteral">"InitArmyGunTypes marking 38s as dropped"</span>);
<a name="l00134"></a>00134       <span class="comment">// avoid auto-drops for the gun class with the crappiest guns in it</span>
<a name="l00135"></a>00135       <a class="code" href="Inventory_01Choosing_8cpp.html#63402030348a3f8904d9c817ef87b319">MarkAllWeaponsOfSameGunClassAsDropped</a>( <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f46c1c44f20d205421819801f5ccf21a93">SW38</a> );
<a name="l00136"></a>00136 
<a name="l00137"></a>00137       DebugMsg (TOPIC_JA2,DBG_LEVEL_3,<span class="stringliteral">"InitArmyGunTypes done"</span>);
<a name="l00138"></a>00138 }
<a name="l00139"></a>00139 
<a name="l00140"></a>00140 
<a name="l00141"></a>00141 
<a name="l00142"></a><a class="code" href="Inventory_01Choosing_8h.html#7c348c4359b431a3d9466ec081963a13">00142</a> <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> <a class="code" href="Inventory_01Choosing_8cpp.html#7c348c4359b431a3d9466ec081963a13">GetWeaponClass</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usGun )
<a name="l00143"></a>00143 {
<a name="l00144"></a>00144       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>            uiGunLevel, uiLoop;
<a name="l00145"></a>00145 
<a name="l00146"></a>00146       <span class="comment">// always use the extended list since it contains all guns...</span>
<a name="l00147"></a>00147       <span class="keywordflow">if</span> ( <a class="code" href="Weapons_8cpp.html#93a7bd0d2c7b34b8185a7b5fb6209ae8">IsWeapon</a> (usGun) )
<a name="l00148"></a>00148       {
<a name="l00149"></a>00149             <span class="keywordflow">for</span> (uiGunLevel = 0; uiGunLevel &lt;   ARMY_GUN_LEVELS; uiGunLevel++)
<a name="l00150"></a>00150             {
<a name="l00151"></a>00151                   <span class="keywordflow">for</span> ( uiLoop = 0; uiLoop &lt; <a class="code" href="Inventory_01Choosing_8cpp.html#d0d4ecc439e1e3f426e907a64bd61a43">gExtendedArmyGunChoices</a>[ uiGunLevel ].<a class="code" href="structARMY__GUN__CHOICE__TYPE.html#d58a9337516339578e15375b1cee9386">ubChoices</a>; uiLoop++ )
<a name="l00152"></a>00152                   {
<a name="l00153"></a>00153                         <span class="keywordflow">if</span> ( <a class="code" href="Inventory_01Choosing_8cpp.html#d0d4ecc439e1e3f426e907a64bd61a43">gExtendedArmyGunChoices</a>[ uiGunLevel ].bItemNo[ uiLoop ] == usGun )
<a name="l00154"></a>00154                         {
<a name="l00155"></a>00155                               <span class="keywordflow">return</span>( (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>) uiGunLevel );
<a name="l00156"></a>00156                         }
<a name="l00157"></a>00157                   }
<a name="l00158"></a>00158             }
<a name="l00159"></a>00159       }
<a name="l00160"></a>00160       <span class="keywordflow">return</span>( -1 );
<a name="l00161"></a>00161 }
<a name="l00162"></a>00162 
<a name="l00163"></a>00163 
<a name="l00164"></a>00164 
<a name="l00165"></a><a class="code" href="Inventory_01Choosing_8h.html#63402030348a3f8904d9c817ef87b319">00165</a> <span class="keywordtype">void</span> <a class="code" href="Inventory_01Choosing_8cpp.html#63402030348a3f8904d9c817ef87b319">MarkAllWeaponsOfSameGunClassAsDropped</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usWeapon )
<a name="l00166"></a>00166 {
<a name="l00167"></a>00167       <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bGunClass;
<a name="l00168"></a>00168       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiLoop;
<a name="l00169"></a>00169 
<a name="l00170"></a>00170       DebugMsg (<a class="code" href="DEBUG_8cpp.html#a7985c2fd033797fc67a03b2c26e07c6">TOPIC_JA2</a>,DBG_LEVEL_3,<span class="stringliteral">"MarkAllWeaponsOfSameGunClassAsDropped"</span>);
<a name="l00171"></a>00171 
<a name="l00172"></a>00172       
<a name="l00173"></a>00173       <span class="comment">// mark that item itself as dropped, whether or not it's part of a gun class</span>
<a name="l00174"></a>00174       <a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#6f67468571f9de657cc64880427d5b0b">fWeaponDroppedAlready</a>[ usWeapon ] = TRUE;
<a name="l00175"></a>00175 
<a name="l00176"></a>00176       bGunClass = <a class="code" href="Inventory_01Choosing_8cpp.html#7c348c4359b431a3d9466ec081963a13">GetWeaponClass</a>( usWeapon );
<a name="l00177"></a>00177 
<a name="l00178"></a>00178       <span class="comment">// if the gun belongs to a gun class (mortars, GLs, LAWs, etc. do not and are handled independently)</span>
<a name="l00179"></a>00179       <span class="keywordflow">if</span> ( bGunClass != -1 )
<a name="l00180"></a>00180       {
<a name="l00181"></a>00181             <span class="comment">// then mark EVERY gun in that class as dropped</span>
<a name="l00182"></a>00182             <span class="keywordflow">for</span> ( uiLoop = 0; uiLoop &lt; <a class="code" href="Inventory_01Choosing_8cpp.html#d0d4ecc439e1e3f426e907a64bd61a43">gExtendedArmyGunChoices</a>[ bGunClass ].<a class="code" href="structARMY__GUN__CHOICE__TYPE.html#d58a9337516339578e15375b1cee9386">ubChoices</a>; uiLoop++ )
<a name="l00183"></a>00183             {
<a name="l00184"></a>00184                   <a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#6f67468571f9de657cc64880427d5b0b">fWeaponDroppedAlready</a>[ <a class="code" href="Inventory_01Choosing_8cpp.html#d0d4ecc439e1e3f426e907a64bd61a43">gExtendedArmyGunChoices</a>[ bGunClass ].<a class="code" href="structARMY__GUN__CHOICE__TYPE.html#bced712a10aec3048cb4f3d74fb7484a">bItemNo</a>[ uiLoop ] ] = TRUE;
<a name="l00185"></a>00185             }
<a name="l00186"></a>00186       }
<a name="l00187"></a>00187 
<a name="l00188"></a>00188       DebugMsg (<a class="code" href="DEBUG_8cpp.html#a7985c2fd033797fc67a03b2c26e07c6">TOPIC_JA2</a>,DBG_LEVEL_3,<span class="stringliteral">"MarkAllWeaponsOfSameGunClassAsDropped done"</span>);
<a name="l00189"></a>00189 }
<a name="l00190"></a>00190 
<a name="l00191"></a>00191 
<a name="l00192"></a>00192 
<a name="l00193"></a>00193 <span class="comment">//Chooses equipment based on the relative equipment level (0-4) with best being 4.  It allocates a range </span>
<a name="l00194"></a>00194 <span class="comment">//of equipment to choose from.</span>
<a name="l00195"></a>00195 <span class="comment">//NOTE:  I'm just winging it for the decisions on which items that different groups can have.  Basically,</span>
<a name="l00196"></a>00196 <span class="comment">// there are variations, so a guy at a certain level may get a better gun and worse armour or vice versa.</span>
<a name="l00197"></a><a class="code" href="Inventory_01Choosing_8h.html#a19099e9b769c0b09938b469603a9e67">00197</a> <span class="keywordtype">void</span> <a class="code" href="Inventory_01Choosing_8cpp.html#a19099e9b769c0b09938b469603a9e67">GenerateRandomEquipment</a>( <a class="code" href="structSOLDIERCREATE__STRUCT.html">SOLDIERCREATE_STRUCT</a> *pp, <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bSoldierClass, <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bEquipmentRating )
<a name="l00198"></a>00198 {
<a name="l00199"></a>00199       DebugMsg(<a class="code" href="DEBUG_8cpp.html#a7985c2fd033797fc67a03b2c26e07c6">TOPIC_JA2</a>,DBG_LEVEL_3,<a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>(<span class="stringliteral">"GenerateRandomEquipment"</span>));
<a name="l00200"></a>00200       <a class="code" href="structOBJECTTYPE.html">OBJECTTYPE</a> *pItem;
<a name="l00201"></a>00201       <span class="comment">//general rating information</span>
<a name="l00202"></a>00202       <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bRating = 0;
<a name="l00203"></a>00203       <span class="comment">//numbers of items</span>
<a name="l00204"></a>00204       <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bAmmoClips = 0;
<a name="l00205"></a>00205       <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bGrenades = 0;
<a name="l00206"></a>00206       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fAttachment = FALSE;
<a name="l00207"></a>00207       <span class="comment">//item levels</span>
<a name="l00208"></a>00208       <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bWeaponClass = 0;
<a name="l00209"></a>00209       <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bHelmetClass = 0;
<a name="l00210"></a>00210       <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bVestClass = 0;
<a name="l00211"></a>00211       <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bLeggingClass = 0;
<a name="l00212"></a>00212       <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bAttachClass = 0;
<a name="l00213"></a>00213       <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bGrenadeClass = 0;
<a name="l00214"></a>00214       <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bKnifeClass = 0;
<a name="l00215"></a>00215       <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bKitClass = 0;
<a name="l00216"></a>00216       <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bMiscClass = 0;
<a name="l00217"></a>00217       <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bBombClass = 0;
<a name="l00218"></a>00218       <span class="comment">//special weapons</span>
<a name="l00219"></a>00219       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fMortar = FALSE;
<a name="l00220"></a>00220       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fGrenadeLauncher = FALSE;
<a name="l00221"></a>00221       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fLAW = FALSE;
<a name="l00222"></a>00222       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fRPG = FALSE;
<a name="l00223"></a>00223       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> i;
<a name="l00224"></a>00224       <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bEquipmentModifier;
<a name="l00225"></a>00225       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubMaxSpecialWeaponRoll;
<a name="l00226"></a>00226 
<a name="l00227"></a>00227 
<a name="l00228"></a>00228       Assert( pp );
<a name="l00229"></a>00229 
<a name="l00230"></a>00230       <span class="comment">// kids don't get anything 'cause they don't have any weapon animations and the rest is inappropriate</span>
<a name="l00231"></a>00231       <span class="keywordflow">if</span> ( ( pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#1d351f2d5d9f2786c4afb5333ab0ceee">bBodyType</a> == <a class="code" href="Animation_01Data_8h.html#d295a916825180b548473dec560093a7d280093211f32a309c7e52bc1e4570c8">HATKIDCIV</a> ) || ( pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#1d351f2d5d9f2786c4afb5333ab0ceee">bBodyType</a> == <a class="code" href="Animation_01Data_8h.html#d295a916825180b548473dec560093a7572e26862c1a3864663d8fe55b2f7f4d">KIDCIV</a> ) )
<a name="l00232"></a>00232       {
<a name="l00233"></a>00233             <span class="keywordflow">return</span>;
<a name="l00234"></a>00234       }
<a name="l00235"></a>00235 
<a name="l00236"></a>00236 
<a name="l00237"></a>00237       <span class="keywordflow">if</span> ( ( pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#1d351f2d5d9f2786c4afb5333ab0ceee">bBodyType</a> == <a class="code" href="Animation_01Data_8h.html#d295a916825180b548473dec560093a774887c6043843fcb84d7e6b341257354">TANK_NE</a> ) || ( pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#1d351f2d5d9f2786c4afb5333ab0ceee">bBodyType</a> == <a class="code" href="Animation_01Data_8h.html#d295a916825180b548473dec560093a708ba6f8fd9cf7e71998af76cccab9209">TANK_NW</a> ) )
<a name="l00238"></a>00238       {
<a name="l00239"></a>00239             <a class="code" href="Inventory_01Choosing_8cpp.html#7b06561ebf45847c6be61b9ce13abdf8">EquipTank</a>( pp );
<a name="l00240"></a>00240             <span class="keywordflow">return</span>;
<a name="l00241"></a>00241       }
<a name="l00242"></a>00242 
<a name="l00243"></a>00243 
<a name="l00244"></a>00244       Assert( ( bSoldierClass &gt;= <a class="code" href="Soldier_01Control_8h.html#d559b3ed307be626eacea8b56942de61f30fb6bcf992831fe7ec28f6fbee1871">SOLDIER_CLASS_NONE</a> ) &amp;&amp; ( bSoldierClass &lt;= <a class="code" href="Soldier_01Control_8h.html#d559b3ed307be626eacea8b56942de61f2c9f1bbece4a7bd58b4a83a54dac6b6">SOLDIER_CLASS_ELITE_MILITIA</a> ) );
<a name="l00245"></a>00245       Assert( ( bEquipmentRating &gt;= 0 ) &amp;&amp; ( bEquipmentRating &lt;= 4 ) );
<a name="l00246"></a>00246 
<a name="l00247"></a>00247 
<a name="l00248"></a>00248       <span class="comment">// equipment level is modified by 1/10 of the difficulty percentage, -5, so it's between -5 to +5</span>
<a name="l00249"></a>00249       <span class="comment">// (on normal, this is actually -4 to +4, easy is -5 to +3, and hard is -3 to +5)</span>
<a name="l00250"></a>00250       bEquipmentModifier = bEquipmentRating + ( ( <a class="code" href="Soldier_01Create_8cpp.html#433ca5a6b48ed78de02acdf1408198b5">CalcDifficultyModifier</a>( bSoldierClass ) / 10 ) - 5 );
<a name="l00251"></a>00251 
<a name="l00252"></a>00252       <span class="keywordflow">switch</span>( bSoldierClass )
<a name="l00253"></a>00253       {
<a name="l00254"></a>00254             <span class="keywordflow">case</span> <a class="code" href="Soldier_01Control_8h.html#d559b3ed307be626eacea8b56942de61f30fb6bcf992831fe7ec28f6fbee1871">SOLDIER_CLASS_NONE</a>:
<a name="l00255"></a>00255                   <span class="comment">// ammo is here only so that civilians with pre-assigned ammo will get some clips for it!</span>
<a name="l00256"></a>00256                   bAmmoClips = (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)(2 + <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 2 ));
<a name="l00257"></a>00257 
<a name="l00258"></a>00258                   <span class="comment">// civilians get nothing, anyone who should get something should be preassigned by Linda</span>
<a name="l00259"></a>00259                   <span class="keywordflow">break</span>;
<a name="l00260"></a>00260 
<a name="l00261"></a>00261             <span class="keywordflow">case</span> <a class="code" href="Soldier_01Control_8h.html#d559b3ed307be626eacea8b56942de61b149e8fdf658384dd176ef9e706f10dd">SOLDIER_CLASS_ADMINISTRATOR</a>:
<a name="l00262"></a>00262             <span class="keywordflow">case</span> <a class="code" href="Soldier_01Control_8h.html#d559b3ed307be626eacea8b56942de615d87e4b53a22c14df589d9df96ddb0dc">SOLDIER_CLASS_GREEN_MILITIA</a>:
<a name="l00263"></a>00263                   bRating = <a class="code" href="Inventory_01Choosing_8h.html#843b6364885d3a1a47722e792b0368ec0847c47615de85fa3eb04cca7dc19083">BAD_ADMINISTRATOR_EQUIPMENT_RATING</a> + bEquipmentModifier;
<a name="l00264"></a>00264                   bRating = (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)max( MIN_EQUIPMENT_CLASS, min( MAX_EQUIPMENT_CLASS, bRating ) );
<a name="l00265"></a>00265 
<a name="l00266"></a>00266                   bWeaponClass = bRating;
<a name="l00267"></a>00267 
<a name="l00268"></a>00268                   <span class="comment">//Note:  in some cases the class of armour and/or helmet won't be high enough to make </span>
<a name="l00269"></a>00269                   <span class="comment">//                 the lowest level.</span>
<a name="l00270"></a>00270                   bVestClass = bRating;
<a name="l00271"></a>00271                   bHelmetClass = bRating;
<a name="l00272"></a>00272                   <span class="comment">// no leggings</span>
<a name="l00273"></a>00273 
<a name="l00274"></a>00274                   <span class="keywordflow">if</span>( <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 2 ) )
<a name="l00275"></a>00275                         bKnifeClass = bRating;
<a name="l00276"></a>00276 
<a name="l00277"></a>00277                   bAmmoClips = (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)(3 + <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 2 ));
<a name="l00278"></a>00278 
<a name="l00279"></a>00279                   <span class="keywordflow">if</span>( bRating &gt;= <a class="code" href="Inventory_01Choosing_8h.html#843b6364885d3a1a47722e792b0368eccc8e83ffad3b1ea725a5a06f0336037f">GOOD_ADMINISTRATOR_EQUIPMENT_RATING</a> )
<a name="l00280"></a>00280                   {
<a name="l00281"></a>00281                         bAmmoClips++;
<a name="l00282"></a>00282 
<a name="l00283"></a>00283                         bKitClass = bRating;
<a name="l00284"></a>00284                         bMiscClass = bRating;
<a name="l00285"></a>00285                   }
<a name="l00286"></a>00286 
<a name="l00287"></a>00287                   <span class="keywordflow">if</span>( bRating &gt;= <a class="code" href="Inventory_01Choosing_8h.html#843b6364885d3a1a47722e792b0368ecd9249fc85563f17cb5f0032ed7e16e75">GREAT_ADMINISTRATOR_EQUIPMENT_RATING</a> )
<a name="l00288"></a>00288                   {
<a name="l00289"></a>00289                         bGrenades = 1, bGrenadeClass = bRating;
<a name="l00290"></a>00290                   }
<a name="l00291"></a>00291 
<a name="l00292"></a>00292                   <span class="keywordflow">if</span>( ( bRating &gt; MIN_EQUIPMENT_CLASS ) &amp;&amp; bRating &lt; MAX_EQUIPMENT_CLASS )
<a name="l00293"></a>00293                   { <span class="comment">//Randomly decide if there is to be an upgrade of guns vs armour (one goes up, the other down)</span>
<a name="l00294"></a>00294                         <span class="keywordflow">switch</span>( <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 5 ) )
<a name="l00295"></a>00295                         {
<a name="l00296"></a>00296                               <span class="keywordflow">case</span> 0:     bWeaponClass++, bVestClass--;                         <span class="keywordflow">break</span>;      <span class="comment">//better gun, worse armour</span>
<a name="l00297"></a>00297                               <span class="keywordflow">case</span> 1:     bWeaponClass--, bVestClass++;                         <span class="keywordflow">break</span>;      <span class="comment">//worse gun, better armour</span>
<a name="l00298"></a>00298                         }
<a name="l00299"></a>00299                   }
<a name="l00300"></a>00300                   <span class="keywordflow">break</span>;
<a name="l00301"></a>00301 
<a name="l00302"></a>00302             <span class="keywordflow">case</span> <a class="code" href="Soldier_01Control_8h.html#d559b3ed307be626eacea8b56942de61e155251ca19fc71034c52119253642b8">SOLDIER_CLASS_ARMY</a>:
<a name="l00303"></a>00303             <span class="keywordflow">case</span> <a class="code" href="Soldier_01Control_8h.html#d559b3ed307be626eacea8b56942de610534cbb3d918376e9f10be3bf049666e">SOLDIER_CLASS_REG_MILITIA</a>:
<a name="l00304"></a>00304                   <span class="comment">//army guys tend to have a broad range of equipment</span>
<a name="l00305"></a>00305                   bRating = <a class="code" href="Inventory_01Choosing_8h.html#843b6364885d3a1a47722e792b0368eca61f4b1bd1c02857e566ca7e89412a0e">BAD_ARMY_EQUIPMENT_RATING</a> + bEquipmentModifier;
<a name="l00306"></a>00306                   bRating = (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)max( MIN_EQUIPMENT_CLASS, min( MAX_EQUIPMENT_CLASS, bRating ) );
<a name="l00307"></a>00307 
<a name="l00308"></a>00308                   bWeaponClass = bRating;
<a name="l00309"></a>00309                   bVestClass = bRating;
<a name="l00310"></a>00310                   bHelmetClass = bRating;
<a name="l00311"></a>00311                   bGrenadeClass = bRating;
<a name="l00312"></a>00312 
<a name="l00313"></a>00313                   <span class="keywordflow">if</span>( ( bRating &gt;= <a class="code" href="Inventory_01Choosing_8h.html#843b6364885d3a1a47722e792b0368ec3eefd73c2b3d3ab9b010fedf21597734">GOOD_ARMY_EQUIPMENT_RATING</a> ) &amp;&amp; ( <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 100 ) &lt; 33 ) )
<a name="l00314"></a>00314                   {
<a name="l00315"></a>00315                         fAttachment = TRUE;
<a name="l00316"></a>00316                         bAttachClass = bRating;
<a name="l00317"></a>00317                   }
<a name="l00318"></a>00318 
<a name="l00319"></a>00319                   bAmmoClips = (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)(3 + <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 2 ));
<a name="l00320"></a>00320 
<a name="l00321"></a>00321                   <span class="keywordflow">if</span>( bRating &gt;= <a class="code" href="Inventory_01Choosing_8h.html#843b6364885d3a1a47722e792b0368ecab83902f20f86598e8d0acfbf4edef54">AVERAGE_ARMY_EQUIPMENT_RATING</a> )
<a name="l00322"></a>00322                   {
<a name="l00323"></a>00323                         bGrenades = (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 2 );
<a name="l00324"></a>00324                         bKitClass = bRating;
<a name="l00325"></a>00325                         bMiscClass = bRating;
<a name="l00326"></a>00326                   }
<a name="l00327"></a>00327 
<a name="l00328"></a>00328                   <span class="keywordflow">if</span>( bRating &gt;= <a class="code" href="Inventory_01Choosing_8h.html#843b6364885d3a1a47722e792b0368ec3eefd73c2b3d3ab9b010fedf21597734">GOOD_ARMY_EQUIPMENT_RATING</a> )
<a name="l00329"></a>00329                   {
<a name="l00330"></a>00330                         bGrenades++;
<a name="l00331"></a>00331                   }
<a name="l00332"></a>00332 
<a name="l00333"></a>00333                   <span class="keywordflow">if</span>( bRating &gt;= <a class="code" href="Inventory_01Choosing_8h.html#843b6364885d3a1a47722e792b0368ec8e9b611076ccd59d8ca220133aea8144">GREAT_ARMY_EQUIPMENT_RATING</a> )
<a name="l00334"></a>00334                   {
<a name="l00335"></a>00335                         bGrenades++;
<a name="l00336"></a>00336 
<a name="l00337"></a>00337                         bLeggingClass = bRating;
<a name="l00338"></a>00338 
<a name="l00339"></a>00339                         <span class="keywordflow">if</span> ( <a class="code" href="Random_8cpp.html#742221657b584d8416ada22fa8ff23dd">Chance</a>( 25 ) )
<a name="l00340"></a>00340                         {
<a name="l00341"></a>00341                               bBombClass = bRating;
<a name="l00342"></a>00342                         }
<a name="l00343"></a>00343                   }
<a name="l00344"></a>00344 
<a name="l00345"></a>00345                   <span class="keywordflow">if</span>( <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 2 ) )
<a name="l00346"></a>00346                         bKnifeClass = bRating;
<a name="l00347"></a>00347 
<a name="l00348"></a>00348                   <span class="keywordflow">if</span>( ( bRating &gt; MIN_EQUIPMENT_CLASS ) &amp;&amp; bRating &lt; MAX_EQUIPMENT_CLASS )
<a name="l00349"></a>00349                   {
<a name="l00350"></a>00350                         <span class="keywordflow">switch</span>( <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 7 ) )
<a name="l00351"></a>00351                         {
<a name="l00352"></a>00352                               <span class="keywordflow">case</span> 3:     bWeaponClass++, bVestClass--;       <span class="keywordflow">break</span>;      <span class="comment">//better gun, worse armour</span>
<a name="l00353"></a>00353                               <span class="keywordflow">case</span> 4: bWeaponClass--, bVestClass++;           <span class="keywordflow">break</span>;      <span class="comment">//worse gun, better armour</span>
<a name="l00354"></a>00354                               <span class="keywordflow">case</span> 5: bVestClass++, bHelmetClass--;           <span class="keywordflow">break</span>;      <span class="comment">//better armour, worse helmet</span>
<a name="l00355"></a>00355                               <span class="keywordflow">case</span> 6: bVestClass--, bHelmetClass++;           <span class="keywordflow">break</span>;      <span class="comment">//worse armour, better helmet</span>
<a name="l00356"></a>00356                         }
<a name="l00357"></a>00357                   }
<a name="l00358"></a>00358 
<a name="l00359"></a>00359                   <span class="comment">// if well-enough equipped, 1/5 chance of something really special</span>
<a name="l00360"></a>00360                   <span class="keywordflow">if</span>( ( bRating &gt;= <a class="code" href="Inventory_01Choosing_8h.html#843b6364885d3a1a47722e792b0368ec8e9b611076ccd59d8ca220133aea8144">GREAT_ARMY_EQUIPMENT_RATING</a> ) &amp;&amp; ( <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 100 ) &lt; 20 ) )
<a name="l00361"></a>00361                   {
<a name="l00362"></a>00362                         <span class="comment">//give this man a special weapon!  No mortars if underground, however</span>
<a name="l00363"></a>00363                         ubMaxSpecialWeaponRoll = ( !<a class="code" href="Auto_01Resolve_8h.html#4753f4fa3d21585d4f721d7deba0cc0e">IsAutoResolveActive</a>() &amp;&amp; ( <a class="code" href="strategicmap_8cpp.html#da715721a8ceedd42acf6ddb33e63ce0">gbWorldSectorZ</a> != 0 ) ) ? 6 : 7;
<a name="l00364"></a>00364                         <span class="keywordflow">switch</span> ( <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a> ( ubMaxSpecialWeaponRoll ) )
<a name="l00365"></a>00365                         {
<a name="l00366"></a>00366                               <span class="keywordflow">case</span> 0:
<a name="l00367"></a>00367                               <span class="keywordflow">case</span> 1:
<a name="l00368"></a>00368                               <span class="keywordflow">case</span> 2:
<a name="l00369"></a>00369                                     <span class="keywordflow">if</span> ( pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#aed615090c85062502ab030d1968858a">bExpLevel</a> &gt;= 3 )
<a name="l00370"></a>00370                                     {
<a name="l00371"></a>00371                                           <span class="comment">//grenade launcher</span>
<a name="l00372"></a>00372                                           fGrenadeLauncher = TRUE;
<a name="l00373"></a>00373                                           bGrenades = 3 + (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)(<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 3 )); <span class="comment">//3-5</span>
<a name="l00374"></a>00374                                     }
<a name="l00375"></a>00375                                     <span class="keywordflow">break</span>;
<a name="l00376"></a>00376 
<a name="l00377"></a>00377                               <span class="keywordflow">case</span> 3:
<a name="l00378"></a>00378                               <span class="keywordflow">case</span> 4:
<a name="l00379"></a>00379                                     <span class="keywordflow">if</span> ( pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#aed615090c85062502ab030d1968858a">bExpLevel</a> &gt;= 4 )
<a name="l00380"></a>00380                                     {
<a name="l00381"></a>00381                                           <span class="comment">// LAW rocket launcher</span>
<a name="l00382"></a>00382                                           fLAW = TRUE;
<a name="l00383"></a>00383                                     }
<a name="l00384"></a>00384                                     <span class="keywordflow">break</span>;
<a name="l00385"></a>00385                               <span class="keywordflow">case</span> 5:
<a name="l00386"></a>00386                                     <span class="keywordflow">if</span> ( pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#aed615090c85062502ab030d1968858a">bExpLevel</a> &gt;= 5 )
<a name="l00387"></a>00387                                     {
<a name="l00388"></a>00388                                           <span class="comment">// RPG rocket launcher</span>
<a name="l00389"></a>00389                                           fRPG = TRUE;
<a name="l00390"></a>00390                                           bGrenades = 2 + (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)(<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 3 )); <span class="comment">//2-4</span>
<a name="l00391"></a>00391                                           bGrenadeClass = RPG_GRENADE_CLASS;
<a name="l00392"></a>00392                                     }
<a name="l00393"></a>00393                                     <span class="keywordflow">break</span>;
<a name="l00394"></a>00394 
<a name="l00395"></a>00395                               <span class="keywordflow">case</span> 6:
<a name="l00396"></a>00396                                     <span class="comment">// one per team maximum!</span>
<a name="l00397"></a>00397                                     <span class="keywordflow">if</span> ( ( pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#aed615090c85062502ab030d1968858a">bExpLevel</a> &gt;= 5 ) &amp;&amp; ( <a class="code" href="Inventory_01Choosing_8cpp.html#8a2f82db14ba3613cacf33726dd246fb">guiMortarsRolledByTeam</a> &lt; MAX_MORTARS_PER_TEAM ) )
<a name="l00398"></a>00398                                     {
<a name="l00399"></a>00399                                           <span class="comment">//mortar</span>
<a name="l00400"></a>00400                                           fMortar = TRUE;
<a name="l00401"></a>00401                                           <a class="code" href="Inventory_01Choosing_8cpp.html#8a2f82db14ba3613cacf33726dd246fb">guiMortarsRolledByTeam</a>++;
<a name="l00402"></a>00402 
<a name="l00403"></a>00403                                           <span class="comment">// the grenades will actually represent mortar shells in this case</span>
<a name="l00404"></a>00404                                           bGrenades = 2 + (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)(<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 3 )); <span class="comment">//2-4</span>
<a name="l00405"></a>00405                                           bGrenadeClass = MORTAR_GRENADE_CLASS;
<a name="l00406"></a>00406                                     }
<a name="l00407"></a>00407                                     <span class="keywordflow">break</span>;
<a name="l00408"></a>00408                         }
<a name="l00409"></a>00409                   }
<a name="l00410"></a>00410                   <span class="keywordflow">break</span>;
<a name="l00411"></a>00411 
<a name="l00412"></a>00412             <span class="keywordflow">case</span> <a class="code" href="Soldier_01Control_8h.html#d559b3ed307be626eacea8b56942de61a3398ebdb00774b852a6dc6a1ba38764">SOLDIER_CLASS_ELITE</a>:
<a name="l00413"></a>00413             <span class="keywordflow">case</span> <a class="code" href="Soldier_01Control_8h.html#d559b3ed307be626eacea8b56942de61f2c9f1bbece4a7bd58b4a83a54dac6b6">SOLDIER_CLASS_ELITE_MILITIA</a>:
<a name="l00414"></a>00414                   bRating = <a class="code" href="Inventory_01Choosing_8h.html#843b6364885d3a1a47722e792b0368ecd5a462085bfab6542513bceff37015fa">BAD_ELITE_EQUIPMENT_RATING</a> + bEquipmentModifier;
<a name="l00415"></a>00415                   bRating = (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)max( MIN_EQUIPMENT_CLASS, min( MAX_EQUIPMENT_CLASS, bRating ) );
<a name="l00416"></a>00416 
<a name="l00417"></a>00417                   bWeaponClass = bRating;
<a name="l00418"></a>00418                   bHelmetClass = bRating;
<a name="l00419"></a>00419                   bVestClass = bRating;
<a name="l00420"></a>00420                   bLeggingClass = bRating;
<a name="l00421"></a>00421                   bAttachClass = bRating;
<a name="l00422"></a>00422                   bGrenadeClass = bRating;
<a name="l00423"></a>00423                   bKitClass = bRating;
<a name="l00424"></a>00424                   bMiscClass = bRating;
<a name="l00425"></a>00425 
<a name="l00426"></a>00426                   <span class="keywordflow">if</span> ( <a class="code" href="Random_8cpp.html#742221657b584d8416ada22fa8ff23dd">Chance</a>( 25 ) )
<a name="l00427"></a>00427                   {
<a name="l00428"></a>00428                         bBombClass = bRating;
<a name="l00429"></a>00429                   }
<a name="l00430"></a>00430 
<a name="l00431"></a>00431                   bAmmoClips = (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)(3 + <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 2 ));
<a name="l00432"></a>00432                   bGrenades = (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)(2 + <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 3 ));
<a name="l00433"></a>00433 
<a name="l00434"></a>00434                   <span class="keywordflow">if</span>( ( bRating &gt;= <a class="code" href="Inventory_01Choosing_8h.html#843b6364885d3a1a47722e792b0368ec77c4a2d54caf42cbee2a33bda0acf6ac">AVERAGE_ELITE_EQUIPMENT_RATING</a> ) &amp;&amp; ( <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 100 ) &lt; 75 ) )
<a name="l00435"></a>00435                   {
<a name="l00436"></a>00436                         fAttachment = TRUE;
<a name="l00437"></a>00437                         bAttachClass = bRating;
<a name="l00438"></a>00438                   }
<a name="l00439"></a>00439 
<a name="l00440"></a>00440                   <span class="keywordflow">if</span>( <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 2 ) )
<a name="l00441"></a>00441                         bKnifeClass = bRating;
<a name="l00442"></a>00442 
<a name="l00443"></a>00443                   <span class="keywordflow">if</span>( ( bRating &gt; MIN_EQUIPMENT_CLASS ) &amp;&amp; bRating &lt; MAX_EQUIPMENT_CLASS )
<a name="l00444"></a>00444                   {
<a name="l00445"></a>00445                         <span class="keywordflow">switch</span>( <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 11 ) )
<a name="l00446"></a>00446                         {
<a name="l00447"></a>00447                               <span class="keywordflow">case</span> 4:           bWeaponClass++, bVestClass--;       <span class="keywordflow">break</span>;
<a name="l00448"></a>00448                               <span class="keywordflow">case</span> 5:           bWeaponClass--, bVestClass--;       <span class="keywordflow">break</span>;
<a name="l00449"></a>00449                               <span class="keywordflow">case</span> 6:           bVestClass++, bHelmetClass--;       <span class="keywordflow">break</span>;
<a name="l00450"></a>00450                               <span class="keywordflow">case</span> 7:           bGrenades += 2;                                                   <span class="keywordflow">break</span>;
<a name="l00451"></a>00451                               <span class="keywordflow">case</span> 8:           bHelmetClass++;                                                   <span class="keywordflow">break</span>;
<a name="l00452"></a>00452                               <span class="keywordflow">case</span> 9:           bVestClass++;                                                           <span class="keywordflow">break</span>;
<a name="l00453"></a>00453                               <span class="keywordflow">case</span> 10:    bWeaponClass++;                                                   <span class="keywordflow">break</span>;
<a name="l00454"></a>00454                         }
<a name="l00455"></a>00455                   }
<a name="l00456"></a>00456 
<a name="l00457"></a>00457                   <span class="comment">// if well-enough equipped, 1/3 chance of something really special</span>
<a name="l00458"></a>00458                   <span class="keywordflow">if</span>( ( bRating &gt;= <a class="code" href="Inventory_01Choosing_8h.html#843b6364885d3a1a47722e792b0368ec5eac0c71b4c47c2b5c0f6e450b9299e3">GOOD_ELITE_EQUIPMENT_RATING</a> ) &amp;&amp; ( <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 100 ) &lt; 33 ) )
<a name="l00459"></a>00459                   {
<a name="l00460"></a>00460                         <span class="comment">//give this man a special weapon!  No mortars if underground, however</span>
<a name="l00461"></a>00461                         ubMaxSpecialWeaponRoll = ( !<a class="code" href="Auto_01Resolve_8h.html#4753f4fa3d21585d4f721d7deba0cc0e">IsAutoResolveActive</a>() &amp;&amp; ( <a class="code" href="strategicmap_8cpp.html#da715721a8ceedd42acf6ddb33e63ce0">gbWorldSectorZ</a> != 0 ) ) ? 6 : 7;
<a name="l00462"></a>00462                         <span class="keywordflow">switch</span> ( <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a> ( ubMaxSpecialWeaponRoll ) )
<a name="l00463"></a>00463                         {
<a name="l00464"></a>00464                               <span class="keywordflow">case</span> 0:
<a name="l00465"></a>00465                               <span class="keywordflow">case</span> 1:
<a name="l00466"></a>00466                               <span class="keywordflow">case</span> 2:
<a name="l00467"></a>00467                                     <span class="comment">//grenade launcher</span>
<a name="l00468"></a>00468                                     fGrenadeLauncher = TRUE;
<a name="l00469"></a>00469                                     bGrenades = 4 + (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)(<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 4 )); <span class="comment">//4-7</span>
<a name="l00470"></a>00470                                     <span class="keywordflow">break</span>;
<a name="l00471"></a>00471                               <span class="keywordflow">case</span> 3:
<a name="l00472"></a>00472                               <span class="keywordflow">case</span> 4:
<a name="l00473"></a>00473                                     <span class="comment">// LAW rocket launcher</span>
<a name="l00474"></a>00474                                     fLAW = TRUE;
<a name="l00475"></a>00475                                     <span class="keywordflow">break</span>;
<a name="l00476"></a>00476                               <span class="keywordflow">case</span> 5:
<a name="l00477"></a>00477                                     <span class="comment">// RPG rocket launcher</span>
<a name="l00478"></a>00478                                     fRPG = TRUE;
<a name="l00479"></a>00479                                     bGrenades = 3 + (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)(<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 5 )); <span class="comment">//3-7</span>
<a name="l00480"></a>00480                                     bGrenadeClass = RPG_GRENADE_CLASS;
<a name="l00481"></a>00481                                     <span class="keywordflow">break</span>;
<a name="l00482"></a>00482                               <span class="keywordflow">case</span> 6:
<a name="l00483"></a>00483                                     <span class="comment">// one per team maximum!</span>
<a name="l00484"></a>00484                                     <span class="keywordflow">if</span> ( <a class="code" href="Inventory_01Choosing_8cpp.html#8a2f82db14ba3613cacf33726dd246fb">guiMortarsRolledByTeam</a> &lt; MAX_MORTARS_PER_TEAM )
<a name="l00485"></a>00485                                     {
<a name="l00486"></a>00486                                           <span class="comment">//mortar</span>
<a name="l00487"></a>00487                                           fMortar = TRUE;
<a name="l00488"></a>00488                                           <a class="code" href="Inventory_01Choosing_8cpp.html#8a2f82db14ba3613cacf33726dd246fb">guiMortarsRolledByTeam</a>++;
<a name="l00489"></a>00489 
<a name="l00490"></a>00490                                           <span class="comment">// the grenades will actually represent mortar shells in this case</span>
<a name="l00491"></a>00491                                           bGrenades = 3 + (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)(<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 5 )); <span class="comment">//3-7</span>
<a name="l00492"></a>00492                                           bGrenadeClass = MORTAR_GRENADE_CLASS;
<a name="l00493"></a>00493                                     }
<a name="l00494"></a>00494                                     <span class="keywordflow">break</span>;
<a name="l00495"></a>00495                         }
<a name="l00496"></a>00496                   }
<a name="l00497"></a>00497                   <span class="keywordflow">break</span>;
<a name="l00498"></a>00498       }
<a name="l00499"></a>00499 
<a name="l00500"></a>00500       <span class="keywordflow">for</span> ( i = 0; i &lt; <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc878553e9a668bdf9e2a72b855424ee1bdabcf">NUM_INV_SLOTS</a>; i++ )
<a name="l00501"></a>00501       { <span class="comment">//clear items, but only if they have write status.</span>
<a name="l00502"></a>00502             <span class="keywordflow">if</span>( !(pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ i ].<a class="code" href="structOBJECTTYPE.html#0f1e67bac22f1b89c4040ef8a5ea48c2">fFlags</a> &amp; OBJECT_NO_OVERWRITE) )
<a name="l00503"></a>00503             {
<a name="l00504"></a>00504                   memset( &amp;(pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ i ]), 0, <span class="keyword">sizeof</span>( <a class="code" href="structOBJECTTYPE.html">OBJECTTYPE</a> ) );
<a name="l00505"></a>00505                   pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ i ].<a class="code" href="structOBJECTTYPE.html#0f1e67bac22f1b89c4040ef8a5ea48c2">fFlags</a> |= OBJECT_UNDROPPABLE;
<a name="l00506"></a>00506             }
<a name="l00507"></a>00507             <span class="keywordflow">else</span>
<a name="l00508"></a>00508             { <span class="comment">//check to see what kind of item is here.  If we find a gun, for example, it'll make the </span>
<a name="l00509"></a>00509                   <span class="comment">//bWeaponClass negative to signify that a gun has already been specified, and later</span>
<a name="l00510"></a>00510                   <span class="comment">//code will use that to determine that and to pick ammo for it.</span>
<a name="l00511"></a>00511                   pItem = &amp;pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ i ];
<a name="l00512"></a>00512                   <span class="keywordflow">if</span>( !pItem )
<a name="l00513"></a>00513                         <span class="keywordflow">continue</span>;
<a name="l00514"></a>00514                   <span class="keywordflow">switch</span>( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ pItem-&gt;<a class="code" href="structOBJECTTYPE.html#4fbe05335f161f08f354566b8e5a0a19">usItem</a> ].usItemClass )
<a name="l00515"></a>00515                   {
<a name="l00516"></a>00516                         <span class="keywordflow">case</span> IC_GUN:
<a name="l00517"></a>00517                               <a class="code" href="Soldier_01Ani_8cpp.html#c294aa65f0375eb6343a2de2a25dafcc">if</a> ( !Item[pItem-&gt;<a class="code" href="structOBJECTTYPE.html#4fbe05335f161f08f354566b8e5a0a19">usItem</a>].rocketlauncher )
<a name="l00518"></a>00518                               {
<a name="l00519"></a>00519                                     bWeaponClass *= -1;
<a name="l00520"></a>00520                               }
<a name="l00521"></a>00521                               <span class="keywordflow">else</span>  <span class="comment">// rocket launcher!</span>
<a name="l00522"></a>00522                               {
<a name="l00523"></a>00523                                     fLAW = FALSE;
<a name="l00524"></a>00524                               }
<a name="l00525"></a>00525                               pItem-&gt;<a class="code" href="structOBJECTTYPE.html#12f0c26ce1caf81be10485b077ced899">ubGunState</a> |= GS_CARTRIDGE_IN_CHAMBER;
<a name="l00526"></a>00526                               <span class="keywordflow">break</span>;
<a name="l00527"></a>00527                         <span class="keywordflow">case</span> IC_AMMO:
<a name="l00528"></a>00528                               bAmmoClips = 0;
<a name="l00529"></a>00529                               <span class="keywordflow">break</span>;
<a name="l00530"></a>00530                         <span class="keywordflow">case</span> IC_BLADE:
<a name="l00531"></a>00531                         <span class="keywordflow">case</span> IC_THROWING_KNIFE:
<a name="l00532"></a>00532                               bKnifeClass = 0;
<a name="l00533"></a>00533                               <span class="keywordflow">break</span>;
<a name="l00534"></a>00534                         <span class="keywordflow">case</span> IC_LAUNCHER:
<a name="l00535"></a>00535                               pItem-&gt;<a class="code" href="structOBJECTTYPE.html#12f0c26ce1caf81be10485b077ced899">ubGunState</a> |= GS_CARTRIDGE_IN_CHAMBER;
<a name="l00536"></a>00536                               fGrenadeLauncher = FALSE;
<a name="l00537"></a>00537                               fMortar = FALSE;
<a name="l00538"></a>00538                               fRPG = FALSE;
<a name="l00539"></a>00539                               <span class="keywordflow">break</span>;
<a name="l00540"></a>00540                         <span class="keywordflow">case</span> IC_ARMOUR:
<a name="l00541"></a>00541                               <span class="keywordflow">if</span>( i == <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc878551e1de377a2d80cf67fd63934f134956d">HELMETPOS</a> )
<a name="l00542"></a>00542                                     bHelmetClass = 0;
<a name="l00543"></a>00543                               <span class="keywordflow">else</span> <span class="keywordflow">if</span>( i == <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855afc78e6fc0aaffa92d59c2fe506f5c6a">VESTPOS</a> )
<a name="l00544"></a>00544                                     bVestClass = 0;
<a name="l00545"></a>00545                               <span class="keywordflow">else</span> <span class="keywordflow">if</span>( i == <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855c1f8517c3795dd56e0c2450e625753dc">LEGPOS</a> )
<a name="l00546"></a>00546                                     bLeggingClass = 0;
<a name="l00547"></a>00547                               <span class="keywordflow">break</span>;
<a name="l00548"></a>00548                         <span class="keywordflow">case</span> IC_GRENADE:
<a name="l00549"></a>00549                               bGrenades = 0;
<a name="l00550"></a>00550                               bGrenadeClass = 0;
<a name="l00551"></a>00551                               <span class="keywordflow">break</span>;
<a name="l00552"></a>00552                         <span class="keywordflow">case</span> IC_MEDKIT:
<a name="l00553"></a>00553                         <span class="keywordflow">case</span> IC_KIT:
<a name="l00554"></a>00554                               bKitClass = 0;
<a name="l00555"></a>00555                               <span class="keywordflow">break</span>;
<a name="l00556"></a>00556                         <span class="keywordflow">case</span> IC_MISC:
<a name="l00557"></a>00557                               bMiscClass = 0;
<a name="l00558"></a>00558                         <span class="keywordflow">case</span> IC_BOMB:
<a name="l00559"></a>00559                               bBombClass = 0;
<a name="l00560"></a>00560                               <span class="keywordflow">break</span>;
<a name="l00561"></a>00561                   }
<a name="l00562"></a>00562             }
<a name="l00563"></a>00563       }
<a name="l00564"></a>00564 
<a name="l00565"></a>00565 
<a name="l00566"></a>00566 
<a name="l00567"></a>00567       <span class="comment">// special: militia shouldn't drop bombs</span>
<a name="l00568"></a>00568       <span class="keywordflow">if</span> ( !( SOLDIER_CLASS_ENEMY( bSoldierClass ) ) )
<a name="l00569"></a>00569       {
<a name="l00570"></a>00570             bBombClass = 0;
<a name="l00571"></a>00571       }
<a name="l00572"></a>00572 
<a name="l00573"></a>00573 
<a name="l00574"></a>00574       <span class="comment">//Now actually choose the equipment!</span>
<a name="l00575"></a>00575       <a class="code" href="Inventory_01Choosing_8cpp.html#6332602acb607bc4c84cf254ad0fad48">ChooseWeaponForSoldierCreateStruct</a>( pp, bWeaponClass, bAmmoClips, bAttachClass, fAttachment );
<a name="l00576"></a>00576       <a class="code" href="Inventory_01Choosing_8cpp.html#459b87930a63962d48b3a322b0ff4aa3">ChooseSpecialWeaponsForSoldierCreateStruct</a>( pp, bKnifeClass, fGrenadeLauncher, fLAW, fMortar, fRPG );
<a name="l00577"></a>00577       <a class="code" href="Inventory_01Choosing_8cpp.html#2ad1e972d0324798e949bff53a0947de">ChooseGrenadesForSoldierCreateStruct</a>( pp, bGrenades, bGrenadeClass, fGrenadeLauncher );
<a name="l00578"></a>00578       <a class="code" href="Inventory_01Choosing_8cpp.html#4c06f0e7b116b48d636ac4a29bd9f4df">ChooseArmourForSoldierCreateStruct</a>( pp, bHelmetClass, bVestClass, bLeggingClass );
<a name="l00579"></a>00579       <a class="code" href="Inventory_01Choosing_8cpp.html#2c8b036efd74c74aef341a0b3e587431">ChooseFaceGearForSoldierCreateStruct</a>( pp );
<a name="l00580"></a>00580       <a class="code" href="Inventory_01Choosing_8cpp.html#dec56b2d6d01cd758af90cea8cb0f05d">ChooseKitsForSoldierCreateStruct</a>( pp, bKitClass );
<a name="l00581"></a>00581       <a class="code" href="Inventory_01Choosing_8cpp.html#7f5ace37f536ebc50c3c623aca7dedf1">ChooseMiscGearForSoldierCreateStruct</a>( pp, bMiscClass );
<a name="l00582"></a>00582       <a class="code" href="Inventory_01Choosing_8cpp.html#9a77f08f7cbee7f9edf38814f48f3345">ChooseBombsForSoldierCreateStruct</a>( pp, bBombClass );
<a name="l00583"></a>00583       <a class="code" href="Inventory_01Choosing_8cpp.html#d27e17be8811f5855b833042b25be167">ChooseLocationSpecificGearForSoldierCreateStruct</a>( pp );
<a name="l00584"></a>00584       <a class="code" href="Inventory_01Choosing_8cpp.html#b082ba4847029fe7febaae508656ef0c">RandomlyChooseWhichItemsAreDroppable</a>( pp, bSoldierClass );
<a name="l00585"></a>00585 
<a name="l00586"></a>00586       DebugMsg(<a class="code" href="DEBUG_8cpp.html#a7985c2fd033797fc67a03b2c26e07c6">TOPIC_JA2</a>,DBG_LEVEL_3,<a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>(<span class="stringliteral">"GenerateRandomEquipment done"</span>));
<a name="l00587"></a>00587 }
<a name="l00588"></a>00588 
<a name="l00589"></a>00589 
<a name="l00590"></a>00590 <span class="comment">//When using the class values, they should all range from 0-11, 0 meaning that there will be no </span>
<a name="l00591"></a>00591 <span class="comment">//selection for that particular type of item, and 1-11 means to choose an item if possible.  1 is</span>
<a name="l00592"></a>00592 <span class="comment">//the worst class of item, while 11 is the best.</span>
<a name="l00593"></a>00593 
<a name="l00594"></a><a class="code" href="Inventory_01Choosing_8h.html#6332602acb607bc4c84cf254ad0fad48">00594</a> <span class="keywordtype">void</span> <a class="code" href="Inventory_01Choosing_8cpp.html#6332602acb607bc4c84cf254ad0fad48">ChooseWeaponForSoldierCreateStruct</a>( <a class="code" href="structSOLDIERCREATE__STRUCT.html">SOLDIERCREATE_STRUCT</a> *pp, <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bWeaponClass, 
<a name="l00595"></a>00595                                                                                                                          <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bAmmoClips, <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bAttachClass, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fAttachment )
<a name="l00596"></a>00596 {
<a name="l00597"></a>00597       <span class="comment">//INVTYPE *pItem;</span>
<a name="l00598"></a>00598       <a class="code" href="structOBJECTTYPE.html">OBJECTTYPE</a> Object;
<a name="l00599"></a>00599       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> i;
<a name="l00600"></a>00600       <span class="comment">//UINT16 usRandom;</span>
<a name="l00601"></a>00601       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usNumMatches = 0;
<a name="l00602"></a>00602       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usGunIndex = 0;
<a name="l00603"></a>00603       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usAmmoIndex = 0;
<a name="l00604"></a>00604       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usAttachIndex = 0;
<a name="l00605"></a>00605       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usAttachIndex2 = 0;
<a name="l00606"></a>00606       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usScopeIndex = 0;
<a name="l00607"></a>00607       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubChanceStandardAmmo;
<a name="l00608"></a>00608       <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bStatus;
<a name="l00609"></a>00609 
<a name="l00610"></a>00610       DebugMsg (<a class="code" href="DEBUG_8cpp.html#a7985c2fd033797fc67a03b2c26e07c6">TOPIC_JA2</a>,DBG_LEVEL_3,<span class="stringliteral">"ChooseWeaponForSoldierCreateStruct"</span>);
<a name="l00611"></a>00611 
<a name="l00612"></a>00612       <span class="comment">// Choose weapon:</span>
<a name="l00613"></a>00613       <span class="comment">// WEAPONS are very important, and are therefore handled differently using special pre-generated tables.</span>
<a name="l00614"></a>00614       <span class="comment">// It was requested that enemies use only a small subset of guns with a lot duplication of the same gun type.</span>
<a name="l00615"></a>00615       
<a name="l00616"></a>00616       <span class="comment">// if gun was pre-selected (rcvd negative weapon class) and needs ammo</span>
<a name="l00617"></a>00617       <span class="keywordflow">if</span>( bWeaponClass &lt; 0 &amp;&amp; bAmmoClips )
<a name="l00618"></a>00618       { <span class="comment">//Linda has added a specific gun to the merc's inventory, but no ammo.  So, we </span>
<a name="l00619"></a>00619             <span class="comment">//will choose ammunition that works with the gun.</span>
<a name="l00620"></a>00620             <span class="keywordflow">for</span>( i = 0; i &lt; <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc878553e9a668bdf9e2a72b855424ee1bdabcf">NUM_INV_SLOTS</a>; i++ )
<a name="l00621"></a>00621             {
<a name="l00622"></a>00622                   <span class="keywordflow">if</span>( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ i ].<a class="code" href="structOBJECTTYPE.html#4fbe05335f161f08f354566b8e5a0a19">usItem</a> ].usItemClass == IC_GUN )
<a name="l00623"></a>00623                   {
<a name="l00624"></a>00624                         usGunIndex = pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ i ].<a class="code" href="structOBJECTTYPE.html#4fbe05335f161f08f354566b8e5a0a19">usItem</a>;
<a name="l00625"></a>00625                         ubChanceStandardAmmo = 100 - (bWeaponClass * -9);           <span class="comment">// weapon class is negative!</span>
<a name="l00626"></a>00626                         usAmmoIndex = <a class="code" href="Items_8cpp.html#e40bb7ac929a445e89e211cacc244ec2">RandomMagazine</a>( usGunIndex, ubChanceStandardAmmo );
<a name="l00627"></a>00627                         pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ i ].<a class="code" href="structOBJECTTYPE.html#3596f5a0fe872c599ca309a2749fc23e">ubGunAmmoType</a> = <a class="code" href="Weapons_8cpp.html#5881a7295b606ac73bf0dddd7d1c80a5">Magazine</a>[<a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usAmmoIndex].<a class="code" href="structINVTYPE.html#8f52f99607debfdbb9a8dbf9e43c1967">ubClassIndex</a>].<a class="code" href="structMAGTYPE.html#e47af2ccb17453ce07bed770d5a7834a">ubAmmoType</a>;
<a name="l00628"></a>00628                         pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ i ].<a class="code" href="structOBJECTTYPE.html#7b0dbe4816379f07f63493c422871c04">usGunAmmoItem</a> = usAmmoIndex;
<a name="l00629"></a>00629 
<a name="l00630"></a>00630                         <span class="keywordflow">if</span> ( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usGunIndex].fingerprintid )
<a name="l00631"></a>00631                         {
<a name="l00632"></a>00632                               pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ i ].<a class="code" href="structOBJECTTYPE.html#bbf8833330a114c5ff8d0d95e51bee92">ubImprintID</a> = (NO_PROFILE + 1);
<a name="l00633"></a>00633                         }
<a name="l00634"></a>00634 
<a name="l00635"></a>00635                         <span class="keywordflow">break</span>;
<a name="l00636"></a>00636                   }
<a name="l00637"></a>00637             }
<a name="l00638"></a>00638             <span class="keywordflow">if</span>( bAmmoClips &amp;&amp; usAmmoIndex )
<a name="l00639"></a>00639             {
<a name="l00640"></a>00640                   <a class="code" href="Items_8cpp.html#19aed5cbf530232ff0e01c7d6e58bd8e">CreateItems</a>( usAmmoIndex, 100, bAmmoClips, &amp;Object );
<a name="l00641"></a>00641                   Object.<a class="code" href="structOBJECTTYPE.html#0f1e67bac22f1b89c4040ef8a5ea48c2">fFlags</a> |= OBJECT_UNDROPPABLE;
<a name="l00642"></a>00642                   <a class="code" href="Inventory_01Choosing_8cpp.html#b427f7649fc2e022ea435eafc3737008">PlaceObjectInSoldierCreateStruct</a>( pp, &amp;Object );
<a name="l00643"></a>00643             }
<a name="l00644"></a>00644 
<a name="l00645"></a>00645             <span class="keywordflow">return</span>;
<a name="l00646"></a>00646       }
<a name="l00647"></a>00647 
<a name="l00648"></a>00648       <span class="keywordflow">if</span> (bWeaponClass &lt; 1)
<a name="l00649"></a>00649             <span class="keywordflow">return</span>; <span class="comment">//empty handed / pre-selected</span>
<a name="l00650"></a>00650 
<a name="l00651"></a>00651       <span class="comment">// reduce anything over 11 to 11</span>
<a name="l00652"></a>00652       <span class="keywordflow">if</span> (bWeaponClass &gt; ARMY_GUN_LEVELS)
<a name="l00653"></a>00653       {
<a name="l00654"></a>00654             bWeaponClass = ARMY_GUN_LEVELS;
<a name="l00655"></a>00655       }
<a name="l00656"></a>00656 
<a name="l00657"></a>00657 
<a name="l00658"></a>00658       <span class="comment">// the weapon class here ranges from 1 to 11, so subtract 1 to get a gun level</span>
<a name="l00659"></a>00659       usGunIndex = <a class="code" href="Inventory_01Choosing_8cpp.html#150703349e1bcb3a75a72fd68ee4d026">SelectStandardArmyGun</a>( (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>) (bWeaponClass - 1));
<a name="l00660"></a>00660 
<a name="l00661"></a>00661       <span class="comment">//sniper rifles get sniper scopes</span>
<a name="l00662"></a>00662       <span class="keywordflow">if</span> ( <a class="code" href="Weapons_8cpp.html#fac72e30bc7c36f55257eac0542ce51d">Weapon</a>[usGunIndex].ubWeaponType == <a class="code" href="Weapons_8h.html#ff0a3b1f6b4b74365e6016c44095ed31520c1662bd8af54af780415c24112621">GUN_SN_RIFLE</a> )
<a name="l00663"></a>00663       {
<a name="l00664"></a>00664             usScopeIndex = <a class="code" href="Inventory_01Choosing_8cpp.html#542239fb2c141fed4755889a76e7fc7d">PickARandomAttachment</a>(<a class="code" href="Inventory_01Choosing_8h.html#85d881cb3816f77e92c1c8f721b54fc45c5be91c4c56f94911a6c849fc4135aa">SCOPE</a>,usGunIndex,bAttachClass,TRUE);
<a name="l00665"></a>00665             <span class="keywordflow">if</span> ( usScopeIndex == 0 )
<a name="l00666"></a>00666             {
<a name="l00667"></a>00667                   <span class="comment">// find any one that works</span>
<a name="l00668"></a>00668                   usScopeIndex = <a class="code" href="Inventory_01Choosing_8cpp.html#542239fb2c141fed4755889a76e7fc7d">PickARandomAttachment</a>(<a class="code" href="Inventory_01Choosing_8h.html#85d881cb3816f77e92c1c8f721b54fc45c5be91c4c56f94911a6c849fc4135aa">SCOPE</a>,usGunIndex,bAttachClass,FALSE);
<a name="l00669"></a>00669             }
<a name="l00670"></a>00670       }
<a name="l00671"></a>00671       <span class="comment">//Choose attachment</span>
<a name="l00672"></a>00672       <span class="keywordflow">if</span>( bAttachClass &amp;&amp; ( fAttachment ))
<a name="l00673"></a>00673       {
<a name="l00674"></a>00674             usAttachIndex = <a class="code" href="Inventory_01Choosing_8cpp.html#542239fb2c141fed4755889a76e7fc7d">PickARandomAttachment</a>(<a class="code" href="Inventory_01Choosing_8h.html#85d881cb3816f77e92c1c8f721b54fc4b50bcd10824209794cc4b83f29617a31">ATTACHMENTS</a>,usGunIndex,bAttachClass,FALSE);
<a name="l00675"></a>00675 
<a name="l00676"></a>00676             <span class="keywordflow">if</span> ( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usGunIndex].defaultattachment &gt; 0 )
<a name="l00677"></a>00677             {
<a name="l00678"></a>00678 
<a name="l00679"></a>00679                   <span class="keywordflow">if</span> ( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usGunIndex].defaultattachment == usAttachIndex )
<a name="l00680"></a>00680                         usAttachIndex = 0;
<a name="l00681"></a>00681                   <span class="keywordflow">else</span>
<a name="l00682"></a>00682                   {
<a name="l00683"></a>00683                         <span class="comment">//check for incompatibilities </span>
<a name="l00684"></a>00684                         <span class="keywordflow">for</span>(i = 0;i&lt;<span class="keyword">sizeof</span>(<a class="code" href="Item_01Types_8h.html#9ae0473f9fe0c7777fbea28b80c7be05">IncompatibleAttachments</a>);i++)
<a name="l00685"></a>00685                         {
<a name="l00686"></a>00686                               <span class="keywordflow">if</span> ( <a class="code" href="Item_01Types_8h.html#9ae0473f9fe0c7777fbea28b80c7be05">IncompatibleAttachments</a>[i][0] == <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4c157bdf0b85a40d2619cbc8bc1ae5fe2">NONE</a> )
<a name="l00687"></a>00687                                     <span class="keywordflow">break</span>;
<a name="l00688"></a>00688                         
<a name="l00689"></a>00689                               <span class="keywordflow">if</span> ( <a class="code" href="Item_01Types_8h.html#9ae0473f9fe0c7777fbea28b80c7be05">IncompatibleAttachments</a>[i][0] == usAttachIndex &amp;&amp; <a class="code" href="Item_01Types_8h.html#9ae0473f9fe0c7777fbea28b80c7be05">IncompatibleAttachments</a>[i][1] == <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usGunIndex].defaultattachment )
<a name="l00690"></a>00690                               {
<a name="l00691"></a>00691                                     <span class="comment">// default attachment wins</span>
<a name="l00692"></a>00692                                     usAttachIndex = 0;
<a name="l00693"></a>00693                                     <span class="keywordflow">break</span>;
<a name="l00694"></a>00694                               }
<a name="l00695"></a>00695                         }
<a name="l00696"></a>00696                   }
<a name="l00697"></a>00697 
<a name="l00698"></a>00698                   <span class="keywordflow">if</span> ( usScopeIndex &gt; 0 )
<a name="l00699"></a>00699                   {
<a name="l00700"></a>00700                         <span class="keywordflow">if</span> ( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usGunIndex].defaultattachment == usScopeIndex )
<a name="l00701"></a>00701                               usScopeIndex = 0;
<a name="l00702"></a>00702                         <span class="keywordflow">else</span>
<a name="l00703"></a>00703                         {
<a name="l00704"></a>00704                               <span class="comment">//check for incompatibilities w/scope</span>
<a name="l00705"></a>00705                               <span class="keywordflow">for</span>(i = 0;i&lt;<span class="keyword">sizeof</span>(<a class="code" href="Item_01Types_8h.html#9ae0473f9fe0c7777fbea28b80c7be05">IncompatibleAttachments</a>);i++)
<a name="l00706"></a>00706                               {
<a name="l00707"></a>00707                                     <span class="keywordflow">if</span> ( <a class="code" href="Item_01Types_8h.html#9ae0473f9fe0c7777fbea28b80c7be05">IncompatibleAttachments</a>[i][0] == <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4c157bdf0b85a40d2619cbc8bc1ae5fe2">NONE</a> )
<a name="l00708"></a>00708                                           <span class="keywordflow">break</span>;
<a name="l00709"></a>00709                               
<a name="l00710"></a>00710                                     <span class="keywordflow">if</span> ( <a class="code" href="Item_01Types_8h.html#9ae0473f9fe0c7777fbea28b80c7be05">IncompatibleAttachments</a>[i][0] == usScopeIndex &amp;&amp; <a class="code" href="Item_01Types_8h.html#9ae0473f9fe0c7777fbea28b80c7be05">IncompatibleAttachments</a>[i][1] == <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usGunIndex].defaultattachment )
<a name="l00711"></a>00711                                     {
<a name="l00712"></a>00712                                           <span class="comment">// default attachment wins</span>
<a name="l00713"></a>00713                                           usScopeIndex = 0;
<a name="l00714"></a>00714                                           <span class="keywordflow">break</span>;
<a name="l00715"></a>00715                                     }
<a name="l00716"></a>00716                               }
<a name="l00717"></a>00717                         }
<a name="l00718"></a>00718                   }
<a name="l00719"></a>00719             }
<a name="l00720"></a>00720             <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( usScopeIndex &gt; 0 )
<a name="l00721"></a>00721             {
<a name="l00722"></a>00722                   <span class="comment">//check for incompatibilities with scope</span>
<a name="l00723"></a>00723                   <span class="keywordflow">for</span>(i = 0;i&lt;<span class="keyword">sizeof</span>(<a class="code" href="Item_01Types_8h.html#9ae0473f9fe0c7777fbea28b80c7be05">IncompatibleAttachments</a>);i++)
<a name="l00724"></a>00724                   {
<a name="l00725"></a>00725                         <span class="keywordflow">if</span> ( <a class="code" href="Item_01Types_8h.html#9ae0473f9fe0c7777fbea28b80c7be05">IncompatibleAttachments</a>[i][0] == <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4c157bdf0b85a40d2619cbc8bc1ae5fe2">NONE</a> )
<a name="l00726"></a>00726                               <span class="keywordflow">break</span>;
<a name="l00727"></a>00727                   
<a name="l00728"></a>00728                         <span class="keywordflow">if</span> ( <a class="code" href="Item_01Types_8h.html#9ae0473f9fe0c7777fbea28b80c7be05">IncompatibleAttachments</a>[i][0] == usAttachIndex &amp;&amp; <a class="code" href="Item_01Types_8h.html#9ae0473f9fe0c7777fbea28b80c7be05">IncompatibleAttachments</a>[i][1] == usScopeIndex )
<a name="l00729"></a>00729                         {
<a name="l00730"></a>00730                               <span class="comment">// scope wins</span>
<a name="l00731"></a>00731                               usAttachIndex = 0;
<a name="l00732"></a>00732                               <span class="keywordflow">break</span>;
<a name="l00733"></a>00733                         }
<a name="l00734"></a>00734                   }
<a name="l00735"></a>00735             }
<a name="l00736"></a>00736             <span class="keywordflow">else</span>
<a name="l00737"></a>00737             {
<a name="l00738"></a>00738                   <span class="comment">//check for chance of second attachment</span>
<a name="l00739"></a>00739                   <span class="keywordflow">if</span> ( ( bAttachClass - <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usAttachIndex].ubCoolness ) &gt; 0 &amp;&amp; <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(2) )
<a name="l00740"></a>00740                   {
<a name="l00741"></a>00741                         usAttachIndex2 = <a class="code" href="Inventory_01Choosing_8cpp.html#542239fb2c141fed4755889a76e7fc7d">PickARandomAttachment</a>(<a class="code" href="Inventory_01Choosing_8h.html#85d881cb3816f77e92c1c8f721b54fc4b50bcd10824209794cc4b83f29617a31">ATTACHMENTS</a>,usGunIndex,bAttachClass,FALSE);
<a name="l00742"></a>00742                                                 
<a name="l00743"></a>00743                         <span class="comment">//check for incompatibilities with 1st attachment</span>
<a name="l00744"></a>00744                         <span class="keywordflow">for</span>(i = 0;i&lt;<span class="keyword">sizeof</span>(<a class="code" href="Item_01Types_8h.html#9ae0473f9fe0c7777fbea28b80c7be05">IncompatibleAttachments</a>);i++)
<a name="l00745"></a>00745                         {
<a name="l00746"></a>00746                               <span class="keywordflow">if</span> ( <a class="code" href="Item_01Types_8h.html#9ae0473f9fe0c7777fbea28b80c7be05">IncompatibleAttachments</a>[i][0] == <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4c157bdf0b85a40d2619cbc8bc1ae5fe2">NONE</a> )
<a name="l00747"></a>00747                                     <span class="keywordflow">break</span>;
<a name="l00748"></a>00748                         
<a name="l00749"></a>00749                               <span class="keywordflow">if</span> ( <a class="code" href="Item_01Types_8h.html#9ae0473f9fe0c7777fbea28b80c7be05">IncompatibleAttachments</a>[i][0] == usAttachIndex &amp;&amp; <a class="code" href="Item_01Types_8h.html#9ae0473f9fe0c7777fbea28b80c7be05">IncompatibleAttachments</a>[i][1] == usAttachIndex2 )
<a name="l00750"></a>00750                               {
<a name="l00751"></a>00751                                     <span class="comment">// 1st attachment wins</span>
<a name="l00752"></a>00752                                     usAttachIndex2 = 0;
<a name="l00753"></a>00753                                     <span class="keywordflow">break</span>;
<a name="l00754"></a>00754                               }
<a name="l00755"></a>00755                         }
<a name="l00756"></a>00756                   }
<a name="l00757"></a>00757             }
<a name="l00758"></a>00758 
<a name="l00759"></a>00759             <span class="comment">//usNumMatches = 0;</span>
<a name="l00760"></a>00760             <span class="comment">//while( bAttachClass &amp;&amp; !usNumMatches )</span>
<a name="l00761"></a>00761             <span class="comment">//{ //Count the number of valid attachments.</span>
<a name="l00762"></a>00762             <span class="comment">//    for( i = 0; i &lt; MAXITEMS; i++ )</span>
<a name="l00763"></a>00763             <span class="comment">//    {</span>
<a name="l00764"></a>00764             <span class="comment">//          if ( Item[i].usItemClass  == 0 )</span>
<a name="l00765"></a>00765             <span class="comment">//                break;</span>
<a name="l00766"></a>00766             <span class="comment">//          pItem = &amp;Item[ i ];</span>
<a name="l00767"></a>00767             <span class="comment">//          if( pItem-&gt;usItemClass == IC_MISC &amp;&amp; pItem-&gt;ubCoolness &lt;= bAttachClass &amp;&amp; ValidAttachment( i, usGunIndex ) )</span>
<a name="l00768"></a>00768             <span class="comment">//                usNumMatches++;</span>
<a name="l00769"></a>00769             <span class="comment">//    }</span>
<a name="l00770"></a>00770             <span class="comment">//    if( !usNumMatches )</span>
<a name="l00771"></a>00771             <span class="comment">//    {</span>
<a name="l00772"></a>00772             <span class="comment">//          bAttachClass--;</span>
<a name="l00773"></a>00773             <span class="comment">//    }</span>
<a name="l00774"></a>00774             <span class="comment">//}</span>
<a name="l00775"></a>00775             <span class="comment">//if( usNumMatches )</span>
<a name="l00776"></a>00776             <span class="comment">//{</span>
<a name="l00777"></a>00777 
<a name="l00778"></a>00778             <span class="comment">//    else</span>
<a name="l00779"></a>00779             <span class="comment">//    {</span>
<a name="l00780"></a>00780             <span class="comment">//          usRandom = (UINT16)Random( usNumMatches );</span>
<a name="l00781"></a>00781             <span class="comment">//          for( i = 0; i &lt; MAXITEMS; i++ )</span>
<a name="l00782"></a>00782             <span class="comment">//          {</span>
<a name="l00783"></a>00783             <span class="comment">//                if ( Item[i].usItemClass  == 0 )</span>
<a name="l00784"></a>00784             <span class="comment">//                      break;</span>
<a name="l00785"></a>00785             <span class="comment">//                pItem = &amp;Item[ i ];</span>
<a name="l00786"></a>00786             <span class="comment">//                if( pItem-&gt;usItemClass == IC_MISC &amp;&amp; pItem-&gt;ubCoolness &lt;= bAttachClass &amp;&amp;  )</span>
<a name="l00787"></a>00787             <span class="comment">//                {     </span>
<a name="l00788"></a>00788             <span class="comment">//                      if( usRandom )</span>
<a name="l00789"></a>00789             <span class="comment">//                            usRandom--;</span>
<a name="l00790"></a>00790             <span class="comment">//                      else</span>
<a name="l00791"></a>00791             <span class="comment">//                      {</span>
<a name="l00792"></a>00792             <span class="comment">//                            usAttachIndex = i;</span>
<a name="l00793"></a>00793             <span class="comment">//                            break;</span>
<a name="l00794"></a>00794             <span class="comment">//                      }     </span>
<a name="l00795"></a>00795             <span class="comment">//                }</span>
<a name="l00796"></a>00796             <span class="comment">//          }</span>
<a name="l00797"></a>00797             <span class="comment">//    }                       </span>
<a name="l00798"></a>00798             <span class="comment">//}</span>
<a name="l00799"></a>00799       }
<a name="l00800"></a>00800       <span class="comment">//Now, we have chosen all of the correct items.  Now, we will assign them into the slots.</span>
<a name="l00801"></a>00801       <span class="comment">//Because we are dealing with enemies, automatically give them full ammo in their weapon.</span>
<a name="l00802"></a>00802       <span class="keywordflow">if</span>( !(pp-&gt;Inv[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855408e678e638d95e18d5e9a2a64a96e2e">HANDPOS</a> ].fFlags &amp; OBJECT_NO_OVERWRITE) )
<a name="l00803"></a>00803       {
<a name="l00804"></a>00804             <span class="keywordflow">switch</span>( pp-&gt;ubSoldierClass )
<a name="l00805"></a>00805             {
<a name="l00806"></a>00806                   <span class="keywordflow">case</span> <a class="code" href="Soldier_01Control_8h.html#d559b3ed307be626eacea8b56942de61b149e8fdf658384dd176ef9e706f10dd">SOLDIER_CLASS_ADMINISTRATOR</a>:
<a name="l00807"></a>00807                   <span class="keywordflow">case</span> <a class="code" href="Soldier_01Control_8h.html#d559b3ed307be626eacea8b56942de61e155251ca19fc71034c52119253642b8">SOLDIER_CLASS_ARMY</a>:
<a name="l00808"></a>00808                   <span class="keywordflow">case</span> <a class="code" href="Soldier_01Control_8h.html#d559b3ed307be626eacea8b56942de615d87e4b53a22c14df589d9df96ddb0dc">SOLDIER_CLASS_GREEN_MILITIA</a>:
<a name="l00809"></a>00809                   <span class="keywordflow">case</span> <a class="code" href="Soldier_01Control_8h.html#d559b3ed307be626eacea8b56942de610534cbb3d918376e9f10be3bf049666e">SOLDIER_CLASS_REG_MILITIA</a>:
<a name="l00810"></a>00810                         <span class="comment">//Admins/Troops: 60-75% + 1% every 4% progress</span>
<a name="l00811"></a>00811                         bStatus = (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)(60 + <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 16 ));
<a name="l00812"></a>00812                         bStatus += (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)(<a class="code" href="Campaign_8cpp.html#c301f0385a7e0d276efe888024738b09">HighestPlayerProgressPercentage</a>() / 4);
<a name="l00813"></a>00813                         bStatus = (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)min( 100, bStatus );
<a name="l00814"></a>00814                         <span class="keywordflow">break</span>;
<a name="l00815"></a>00815                   <span class="keywordflow">case</span> <a class="code" href="Soldier_01Control_8h.html#d559b3ed307be626eacea8b56942de61a3398ebdb00774b852a6dc6a1ba38764">SOLDIER_CLASS_ELITE</a>:
<a name="l00816"></a>00816                   <span class="keywordflow">case</span> <a class="code" href="Soldier_01Control_8h.html#d559b3ed307be626eacea8b56942de61f2c9f1bbece4a7bd58b4a83a54dac6b6">SOLDIER_CLASS_ELITE_MILITIA</a>:
<a name="l00817"></a>00817                         <span class="comment">//85-90% +  1% every 10% progress</span>
<a name="l00818"></a>00818                         bStatus = (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)(85 + <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 6 ));
<a name="l00819"></a>00819                         bStatus += (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)(<a class="code" href="Campaign_8cpp.html#c301f0385a7e0d276efe888024738b09">HighestPlayerProgressPercentage</a>() / 10);
<a name="l00820"></a>00820                         bStatus = (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)min( 100, bStatus );
<a name="l00821"></a>00821                         <span class="keywordflow">break</span>;
<a name="l00822"></a>00822                   <span class="keywordflow">default</span>:
<a name="l00823"></a>00823                         bStatus = (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)(50 + <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 51 ) );
<a name="l00824"></a>00824                         <span class="keywordflow">break</span>;
<a name="l00825"></a>00825             }
<a name="l00826"></a>00826             <span class="comment">// don't allow it to be lower than marksmanship, we don't want it to affect their chances of hitting</span>
<a name="l00827"></a>00827             bStatus = (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)max( pp-&gt;bMarksmanship, bStatus );
<a name="l00828"></a>00828 
<a name="l00829"></a>00829 
<a name="l00830"></a>00830             <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( usGunIndex, bStatus, &amp;(pp-&gt;Inv[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855408e678e638d95e18d5e9a2a64a96e2e">HANDPOS</a> ]) );
<a name="l00831"></a>00831             pp-&gt;Inv[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855408e678e638d95e18d5e9a2a64a96e2e">HANDPOS</a> ].fFlags |= OBJECT_UNDROPPABLE;
<a name="l00832"></a>00832 
<a name="l00833"></a>00833             <span class="comment">// Rocket Rifles must come pre-imprinted, in case carrier gets killed without getting a shot off</span>
<a name="l00834"></a>00834             <a class="code" href="Soldier_01Ani_8cpp.html#c294aa65f0375eb6343a2de2a25dafcc">if</a> ( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usGunIndex].fingerprintid )
<a name="l00835"></a>00835             {
<a name="l00836"></a>00836                   pp-&gt;Inv[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855408e678e638d95e18d5e9a2a64a96e2e">HANDPOS</a> ].ubImprintID = (NO_PROFILE + 1);
<a name="l00837"></a>00837             }
<a name="l00838"></a>00838       }
<a name="l00839"></a>00839       <span class="keywordflow">else</span>
<a name="l00840"></a>00840       { <span class="comment">//slot locked, so don't add any attachments to it!</span>
<a name="l00841"></a>00841             usAttachIndex = 0;
<a name="l00842"></a>00842       }
<a name="l00843"></a>00843 
<a name="l00844"></a>00844       DebugMsg (<a class="code" href="DEBUG_8cpp.html#a7985c2fd033797fc67a03b2c26e07c6">TOPIC_JA2</a>,DBG_LEVEL_3,<span class="stringliteral">"ChooseWeaponForSoldierCreateStruct: Gun Created"</span>);
<a name="l00845"></a>00845 
<a name="l00846"></a>00846       <span class="keywordflow">if</span>( usScopeIndex &gt; 0 &amp;&amp; <a class="code" href="Items_8cpp.html#4f7eb9b86edae3b13026cd2ee8aff179">ValidItemAttachment</a>(&amp;(pp-&gt;Inv[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855408e678e638d95e18d5e9a2a64a96e2e">HANDPOS</a> ]),usScopeIndex,TRUE,FALSE) )
<a name="l00847"></a>00847       {
<a name="l00848"></a>00848             DebugMsg (<a class="code" href="DEBUG_8cpp.html#a7985c2fd033797fc67a03b2c26e07c6">TOPIC_JA2</a>,DBG_LEVEL_3,<a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>(<span class="stringliteral">"ChooseWeaponForSoldierCreateStruct: Create Scope %d"</span>,usScopeIndex));
<a name="l00849"></a>00849             <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( usScopeIndex, 100, &amp;Object );
<a name="l00850"></a>00850             Object.fFlags |= OBJECT_UNDROPPABLE;
<a name="l00851"></a>00851             <a class="code" href="Items_8cpp.html#50949f80fa93497497e84d167eedd853">AttachObject</a>( NULL, &amp;(pp-&gt;Inv[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855408e678e638d95e18d5e9a2a64a96e2e">HANDPOS</a> ]), &amp;Object );       
<a name="l00852"></a>00852       }
<a name="l00853"></a>00853       <span class="keywordflow">if</span>( usAttachIndex &gt; 0 &amp;&amp; <a class="code" href="Items_8cpp.html#4f7eb9b86edae3b13026cd2ee8aff179">ValidItemAttachment</a>(&amp;(pp-&gt;Inv[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855408e678e638d95e18d5e9a2a64a96e2e">HANDPOS</a> ]),usAttachIndex,TRUE,FALSE))
<a name="l00854"></a>00854       {
<a name="l00855"></a>00855             DebugMsg (TOPIC_JA2,DBG_LEVEL_3,<a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>(<span class="stringliteral">"ChooseWeaponForSoldierCreateStruct: Create Attachment %d"</span>,usAttachIndex));
<a name="l00856"></a>00856             <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( usAttachIndex, 100, &amp;Object );
<a name="l00857"></a>00857             Object.fFlags |= OBJECT_UNDROPPABLE;
<a name="l00858"></a>00858             <a class="code" href="Items_8cpp.html#50949f80fa93497497e84d167eedd853">AttachObject</a>( NULL, &amp;(pp-&gt;Inv[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855408e678e638d95e18d5e9a2a64a96e2e">HANDPOS</a> ]), &amp;Object );       
<a name="l00859"></a>00859       }
<a name="l00860"></a>00860       <span class="keywordflow">if</span>( usAttachIndex2 &gt; 0 &amp;&amp; <a class="code" href="Items_8cpp.html#4f7eb9b86edae3b13026cd2ee8aff179">ValidItemAttachment</a>(&amp;(pp-&gt;Inv[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855408e678e638d95e18d5e9a2a64a96e2e">HANDPOS</a> ]),usAttachIndex2,TRUE,FALSE))
<a name="l00861"></a>00861       {
<a name="l00862"></a>00862             DebugMsg (TOPIC_JA2,DBG_LEVEL_3,<a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>(<span class="stringliteral">"ChooseWeaponForSoldierCreateStruct: Create 2nd Attachment %d"</span>,usAttachIndex2));
<a name="l00863"></a>00863             <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( usAttachIndex2, 100, &amp;Object );
<a name="l00864"></a>00864             Object.fFlags |= OBJECT_UNDROPPABLE;
<a name="l00865"></a>00865             <a class="code" href="Items_8cpp.html#50949f80fa93497497e84d167eedd853">AttachObject</a>( NULL, &amp;(pp-&gt;Inv[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855408e678e638d95e18d5e9a2a64a96e2e">HANDPOS</a> ]), &amp;Object );       
<a name="l00866"></a>00866       }
<a name="l00867"></a>00867 
<a name="l00868"></a>00868       DebugMsg (TOPIC_JA2,DBG_LEVEL_3,<a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>(<span class="stringliteral">"ChooseWeaponForSoldierCreateStruct: Set bullets"</span>));
<a name="l00869"></a>00869       <span class="comment">//set bullets = to magsize including any attachments (c-mag adapters, etc)</span>
<a name="l00870"></a>00870       pp-&gt;Inv[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855408e678e638d95e18d5e9a2a64a96e2e">HANDPOS</a> ].ubGunShotsLeft = <a class="code" href="Weapons_8cpp.html#a29b5174495cf6cb5ffb2c1cfdecaf29">GetMagSize</a>(&amp;pp-&gt;Inv[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855408e678e638d95e18d5e9a2a64a96e2e">HANDPOS</a> ]);
<a name="l00871"></a>00871 
<a name="l00872"></a>00872       DebugMsg (TOPIC_JA2,DBG_LEVEL_3,<a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>(<span class="stringliteral">"ChooseWeaponForSoldierCreateStruct: choose ammo"</span>));
<a name="l00873"></a>00873       <span class="keywordflow">if</span>( bAmmoClips )
<a name="l00874"></a>00874       { <span class="comment">//We have a gun, so choose ammo clips</span>
<a name="l00875"></a>00875 
<a name="l00876"></a>00876             <span class="comment">// check default ammo first...</span>
<a name="l00877"></a>00877             usAmmoIndex = <a class="code" href="Items_8cpp.html#59851a729f48458a1f7058845f91b392">DefaultMagazine</a>( usGunIndex );
<a name="l00878"></a>00878             <span class="keywordflow">if</span> ( <a class="code" href="Weapons_8cpp.html#5852b80d2b6910cbcd026d0957930f6d">AmmoTypes</a>[<a class="code" href="Weapons_8cpp.html#5881a7295b606ac73bf0dddd7d1c80a5">Magazine</a>[ <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ usAmmoIndex ].ubClassIndex ].ubAmmoType].standardIssue )
<a name="l00879"></a>00879                   ubChanceStandardAmmo = 80;
<a name="l00880"></a>00880             <span class="keywordflow">else</span>
<a name="l00881"></a>00881                   ubChanceStandardAmmo = 100 - (bWeaponClass * 9);
<a name="l00882"></a>00882 
<a name="l00883"></a>00883             <span class="comment">//switch( Magazine[ Item[ usAmmoIndex ].ubClassIndex ].ubAmmoType )</span>
<a name="l00884"></a>00884             <span class="comment">//{</span>
<a name="l00885"></a>00885             <span class="comment">//    case AMMO_AP:</span>
<a name="l00886"></a>00886             <span class="comment">//    case AMMO_SUPER_AP:</span>
<a name="l00887"></a>00887             <span class="comment">//          // assault rifle, rocket rifle (etc) - high chance of having AP ammo</span>
<a name="l00888"></a>00888             <span class="comment">//          ubChanceStandardAmmo = 80;</span>
<a name="l00889"></a>00889             <span class="comment">//          break;</span>
<a name="l00890"></a>00890             <span class="comment">//    default:</span>
<a name="l00891"></a>00891             <span class="comment">//          ubChanceStandardAmmo = 100 - (bWeaponClass * 9);</span>
<a name="l00892"></a>00892             <span class="comment">//          break;</span>
<a name="l00893"></a>00893             <span class="comment">//}</span>
<a name="l00894"></a>00894 
<a name="l00895"></a>00895             usAmmoIndex = <a class="code" href="Items_8cpp.html#e40bb7ac929a445e89e211cacc244ec2">RandomMagazine</a>( &amp;pp-&gt;Inv[<a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855408e678e638d95e18d5e9a2a64a96e2e">HANDPOS</a>], ubChanceStandardAmmo );
<a name="l00896"></a>00896             pp-&gt;Inv[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855408e678e638d95e18d5e9a2a64a96e2e">HANDPOS</a> ].ubGunAmmoType = <a class="code" href="Weapons_8cpp.html#5881a7295b606ac73bf0dddd7d1c80a5">Magazine</a>[<a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usAmmoIndex].<a class="code" href="structINVTYPE.html#8f52f99607debfdbb9a8dbf9e43c1967">ubClassIndex</a>].<a class="code" href="structMAGTYPE.html#e47af2ccb17453ce07bed770d5a7834a">ubAmmoType</a>;
<a name="l00897"></a>00897             pp-&gt;Inv[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855408e678e638d95e18d5e9a2a64a96e2e">HANDPOS</a> ].usGunAmmoItem = usAmmoIndex;
<a name="l00898"></a>00898       }
<a name="l00899"></a>00899 
<a name="l00900"></a>00900       <span class="comment">//Ammo</span>
<a name="l00901"></a>00901       DebugMsg (TOPIC_JA2,DBG_LEVEL_3,<a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>(<span class="stringliteral">"ChooseWeaponForSoldierCreateStruct: create ammo"</span>));
<a name="l00902"></a>00902       <span class="keywordflow">if</span>( bAmmoClips &amp;&amp; usAmmoIndex )
<a name="l00903"></a>00903       {
<a name="l00904"></a>00904             <span class="comment">//Madd: ensure a minimum # of bullets to make sure enemies don't run out and run away</span>
<a name="l00905"></a>00905             <span class="keywordflow">while</span> ( ( bAmmoClips * <a class="code" href="Weapons_8cpp.html#fac72e30bc7c36f55257eac0542ce51d">Weapon</a>[usGunIndex].ubMagSize - <a class="code" href="Weapons_8cpp.html#fac72e30bc7c36f55257eac0542ce51d">Weapon</a>[usGunIndex].ubMagSize) &lt; 20 ) <span class="comment">// each soldier should have at least 20 bullets, ie: 2 9mm 15rd clips, 3 7rd shotgun shells, 4 6rd speedloaders, etc.  </span>
<a name="l00906"></a>00906             {
<a name="l00907"></a>00907                   bAmmoClips++;
<a name="l00908"></a>00908             }
<a name="l00909"></a>00909 
<a name="l00910"></a>00910             <a class="code" href="Items_8cpp.html#19aed5cbf530232ff0e01c7d6e58bd8e">CreateItems</a>( usAmmoIndex, 100, bAmmoClips, &amp;Object );
<a name="l00911"></a>00911             Object.fFlags |= OBJECT_UNDROPPABLE;
<a name="l00912"></a>00912             <a class="code" href="Inventory_01Choosing_8cpp.html#b427f7649fc2e022ea435eafc3737008">PlaceObjectInSoldierCreateStruct</a>( pp, &amp;Object );
<a name="l00913"></a>00913       }
<a name="l00914"></a>00914 
<a name="l00915"></a>00915       DebugMsg (TOPIC_JA2,DBG_LEVEL_3,<a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>(<span class="stringliteral">"ChooseWeaponForSoldierCreateStruct: done"</span>));
<a name="l00916"></a>00916 }
<a name="l00917"></a>00917 
<a name="l00918"></a><a class="code" href="Inventory_01Choosing_8h.html#2ad1e972d0324798e949bff53a0947de">00918</a> <span class="keywordtype">void</span> <a class="code" href="Inventory_01Choosing_8cpp.html#2ad1e972d0324798e949bff53a0947de">ChooseGrenadesForSoldierCreateStruct</a>( <a class="code" href="structSOLDIERCREATE__STRUCT.html">SOLDIERCREATE_STRUCT</a> *pp, <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bGrenades, <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bGrenadeClass, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fGrenadeLauncher )
<a name="l00919"></a>00919 {
<a name="l00920"></a>00920       <a class="code" href="structOBJECTTYPE.html">OBJECTTYPE</a> Object;
<a name="l00921"></a>00921       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sNumPoints;
<a name="l00922"></a>00922       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usItem;
<a name="l00923"></a>00923       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubBaseQuality;
<a name="l00924"></a>00924       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubQualityVariation;
<a name="l00925"></a>00925       <span class="comment">//numbers of each type the player will get!</span>
<a name="l00926"></a>00926       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubNumStun = 0;
<a name="l00927"></a>00927       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubNumTear = 0;
<a name="l00928"></a>00928       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubNumMustard = 0;
<a name="l00929"></a>00929       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubNumMini = 0;
<a name="l00930"></a>00930       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubNumReg = 0;
<a name="l00931"></a>00931       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubNumSmoke = 0;
<a name="l00932"></a>00932       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubNumFlare = 0;
<a name="l00933"></a>00933       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> <a class="code" href="EditorTerrain_8cpp.html#65cba5cc1a46504f462c0ad312079485">count</a> = 0;
<a name="l00934"></a>00934 
<a name="l00935"></a>00935       DebugMsg (TOPIC_JA2,DBG_LEVEL_3,<span class="stringliteral">"ChooseGrenadesForSoldierCreateStruct"</span>);
<a name="l00936"></a>00936 
<a name="l00937"></a>00937       <span class="comment">//determine how many *points* the enemy will get to spend on grenades...</span>
<a name="l00938"></a>00938       sNumPoints = bGrenades * bGrenadeClass;
<a name="l00939"></a>00939 
<a name="l00940"></a>00940       <span class="comment">//no points, no grenades!</span>
<a name="l00941"></a>00941       <span class="keywordflow">if</span>( !sNumPoints )
<a name="l00942"></a>00942             <span class="keywordflow">return</span>;
<a name="l00943"></a>00943 
<a name="l00944"></a>00944       <span class="comment">// special mortar shell handling</span>
<a name="l00945"></a>00945       <span class="keywordflow">if</span> (bGrenadeClass == MORTAR_GRENADE_CLASS &amp;&amp; <a class="code" href="Inventory_01Choosing_8cpp.html#2d7083e8d574d45cc0ad92a135f59a6a">itemMortar</a> &gt; 0 )
<a name="l00946"></a>00946       {
<a name="l00947"></a>00947             usItem = <a class="code" href="Items_8cpp.html#d7c2d8520d4b0ff69819848200d2cf82">PickARandomLaunchable</a> ( <a class="code" href="Inventory_01Choosing_8cpp.html#2d7083e8d574d45cc0ad92a135f59a6a">itemMortar</a> );
<a name="l00948"></a>00948             <span class="keywordflow">if</span> ( usItem &gt; 0 )
<a name="l00949"></a>00949             {
<a name="l00950"></a>00950                   <a class="code" href="Items_8cpp.html#19aed5cbf530232ff0e01c7d6e58bd8e">CreateItems</a>( usItem, (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>) (80 + <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(21)), bGrenades, &amp;Object );
<a name="l00951"></a>00951                   Object.<a class="code" href="structOBJECTTYPE.html#0f1e67bac22f1b89c4040ef8a5ea48c2">fFlags</a> |= OBJECT_UNDROPPABLE;
<a name="l00952"></a>00952                   <a class="code" href="Inventory_01Choosing_8cpp.html#b427f7649fc2e022ea435eafc3737008">PlaceObjectInSoldierCreateStruct</a>( pp, &amp;Object );
<a name="l00953"></a>00953 
<a name="l00954"></a>00954                   <span class="keywordflow">return</span>;
<a name="l00955"></a>00955             }
<a name="l00956"></a>00956       }
<a name="l00957"></a>00957 
<a name="l00958"></a>00958       <span class="comment">// special rpg rocket handling</span>
<a name="l00959"></a>00959       <span class="keywordflow">if</span> (bGrenadeClass == RPG_GRENADE_CLASS &amp;&amp; <a class="code" href="Inventory_01Choosing_8cpp.html#ae704b4d20efa38b25703ad586ecf2cc">itemRPG</a> &gt; 0 )
<a name="l00960"></a>00960       {
<a name="l00961"></a>00961             usItem = <a class="code" href="Items_8cpp.html#d7c2d8520d4b0ff69819848200d2cf82">PickARandomLaunchable</a> ( <a class="code" href="Inventory_01Choosing_8cpp.html#ae704b4d20efa38b25703ad586ecf2cc">itemRPG</a> );
<a name="l00962"></a>00962             <span class="keywordflow">if</span> ( usItem &gt; 0 )
<a name="l00963"></a>00963             {
<a name="l00964"></a>00964                   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; bGrenades; i++ )
<a name="l00965"></a>00965                   {
<a name="l00966"></a>00966                         <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( usItem, (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>) (70 + <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(31)), &amp;Object ); 
<a name="l00967"></a>00967                         Object.<a class="code" href="structOBJECTTYPE.html#0f1e67bac22f1b89c4040ef8a5ea48c2">fFlags</a> |= OBJECT_UNDROPPABLE;
<a name="l00968"></a>00968                         <a class="code" href="Inventory_01Choosing_8cpp.html#b427f7649fc2e022ea435eafc3737008">PlaceObjectInSoldierCreateStruct</a>( pp, &amp;Object );
<a name="l00969"></a>00969                   }
<a name="l00970"></a>00970                   <span class="keywordflow">return</span>;
<a name="l00971"></a>00971             }
<a name="l00972"></a>00972       }
<a name="l00973"></a>00973 
<a name="l00974"></a>00974       Assert( bGrenadeClass &lt;= 11 );
<a name="l00975"></a>00975 
<a name="l00976"></a>00976       <span class="comment">//determine the quality of grenades.  The elite guys get the best quality, while the others</span>
<a name="l00977"></a>00977       <span class="comment">//get progressively worse.</span>
<a name="l00978"></a>00978       ubBaseQuality = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>)min( 45 + bGrenadeClass * 5, 90 );
<a name="l00979"></a>00979       ubQualityVariation = 101 - ubBaseQuality;
<a name="l00980"></a>00980 
<a name="l00981"></a>00981       <span class="comment">// Madd: GL guys don't get hand grenades anymore</span>
<a name="l00982"></a>00982       <span class="keywordflow">if</span> ( <a class="code" href="Inventory_01Choosing_8cpp.html#6c873614bbc1a238e64d251869b9d58d">itemGrenadeLauncher</a> &gt; 0 )
<a name="l00983"></a>00983       {
<a name="l00984"></a>00984             <span class="comment">//do this for every 1-2 grenades so that we can get more variety</span>
<a name="l00985"></a>00985             <span class="keywordflow">while</span> ( bGrenades &gt; 0 )
<a name="l00986"></a>00986             {
<a name="l00987"></a>00987                   count = <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(3);
<a name="l00988"></a>00988                   <span class="keywordflow">if</span> ( count &gt; bGrenades )
<a name="l00989"></a>00989                         count = bGrenades;
<a name="l00990"></a>00990 
<a name="l00991"></a>00991                   usItem = <a class="code" href="Items_8cpp.html#d7c2d8520d4b0ff69819848200d2cf82">PickARandomLaunchable</a> ( <a class="code" href="Inventory_01Choosing_8cpp.html#6c873614bbc1a238e64d251869b9d58d">itemGrenadeLauncher</a> );
<a name="l00992"></a>00992                   <span class="keywordflow">if</span> ( usItem &gt; 0 &amp;&amp; count &gt; 0 )
<a name="l00993"></a>00993                   {
<a name="l00994"></a>00994                         <a class="code" href="Items_8cpp.html#19aed5cbf530232ff0e01c7d6e58bd8e">CreateItems</a>( usItem, (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)(ubBaseQuality + <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( ubQualityVariation )), count, &amp;Object );
<a name="l00995"></a>00995                         Object.<a class="code" href="structOBJECTTYPE.html#0f1e67bac22f1b89c4040ef8a5ea48c2">fFlags</a> |= OBJECT_UNDROPPABLE;
<a name="l00996"></a>00996                         <a class="code" href="Inventory_01Choosing_8cpp.html#b427f7649fc2e022ea435eafc3737008">PlaceObjectInSoldierCreateStruct</a>( pp, &amp;Object );
<a name="l00997"></a>00997                   }
<a name="l00998"></a>00998                   bGrenades -= count;
<a name="l00999"></a>00999             }
<a name="l01000"></a>01000 
<a name="l01001"></a>01001             <span class="keywordflow">return</span>;
<a name="l01002"></a>01002       }
<a name="l01003"></a>01003 
<a name="l01004"></a>01004 
<a name="l01005"></a>01005       <span class="comment">//Madd: screw the original code; it's impossible to externalize and too complicated anyway</span>
<a name="l01006"></a>01006       <span class="comment">//do this for every 1-2 grenades so that we can get more variety</span>
<a name="l01007"></a>01007       <span class="keywordflow">while</span> ( bGrenades &gt; 0 )
<a name="l01008"></a>01008       {
<a name="l01009"></a>01009             count = <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(3);
<a name="l01010"></a>01010             <span class="keywordflow">if</span> ( count &gt; bGrenades )
<a name="l01011"></a>01011                   count = bGrenades;
<a name="l01012"></a>01012 
<a name="l01013"></a>01013             usItem = <a class="code" href="Inventory_01Choosing_8cpp.html#661ec86e3a255acaad87210de3b4b24d">PickARandomItem</a> ( <a class="code" href="Inventory_01Choosing_8h.html#85d881cb3816f77e92c1c8f721b54fc475f4fc5bd8ba1b6ea2a50cde14e1df9a">GRENADE</a> , bGrenadeClass, FALSE );
<a name="l01014"></a>01014             <span class="keywordflow">if</span> ( usItem &gt; 0 &amp;&amp; count &gt; 0 )
<a name="l01015"></a>01015             {
<a name="l01016"></a>01016                   <a class="code" href="Items_8cpp.html#19aed5cbf530232ff0e01c7d6e58bd8e">CreateItems</a>( usItem, (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)(ubBaseQuality + <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( ubQualityVariation )), count, &amp;Object );
<a name="l01017"></a>01017                   Object.<a class="code" href="structOBJECTTYPE.html#0f1e67bac22f1b89c4040ef8a5ea48c2">fFlags</a> |= OBJECT_UNDROPPABLE;
<a name="l01018"></a>01018                   <a class="code" href="Inventory_01Choosing_8cpp.html#b427f7649fc2e022ea435eafc3737008">PlaceObjectInSoldierCreateStruct</a>( pp, &amp;Object );
<a name="l01019"></a>01019             }
<a name="l01020"></a>01020             bGrenades -= count;
<a name="l01021"></a>01021       }
<a name="l01022"></a>01022       <span class="keywordflow">return</span>;
<a name="l01023"></a>01023 
<a name="l01024"></a>01024 <span class="comment"></span>
<a name="l01025"></a>01025 <span class="comment">      ////now, purchase the grenades.</span>
<a name="l01026"></a>01026 <span class="comment"></span>      <span class="comment">//while( sNumPoints &gt; 0 )</span>
<a name="l01027"></a>01027       <span class="comment">//{</span>
<a name="l01028"></a>01028       <span class="comment">//    if( sNumPoints &gt;= 20 )</span>
<a name="l01029"></a>01029       <span class="comment">//    { //Choose randomly between mustard and regular</span>
<a name="l01030"></a>01030       <span class="comment">//          if( Random( 2 ) &amp;&amp; !fGrenadeLauncher )</span>
<a name="l01031"></a>01031       <span class="comment">//                ubNumMustard++, sNumPoints -= 10;</span>
<a name="l01032"></a>01032       <span class="comment">//          else</span>
<a name="l01033"></a>01033       <span class="comment">//                ubNumReg++, sNumPoints -= 9;</span>
<a name="l01034"></a>01034       <span class="comment">//    }</span>
<a name="l01035"></a>01035 
<a name="l01036"></a>01036       <span class="comment">//    if( sNumPoints &gt;= 10 )</span>
<a name="l01037"></a>01037       <span class="comment">//    { //Choose randomly between any</span>
<a name="l01038"></a>01038       <span class="comment">//          switch( Random( 7 ) )</span>
<a name="l01039"></a>01039       <span class="comment">//          {</span>
<a name="l01040"></a>01040       <span class="comment">//                case 0:     if ( !fGrenadeLauncher )</span>
<a name="l01041"></a>01041       <span class="comment">//                                        {</span>
<a name="l01042"></a>01042       <span class="comment">//                                              ubNumMustard++;         sNumPoints -= 10; break;</span>
<a name="l01043"></a>01043       <span class="comment">//                                        }</span>
<a name="l01044"></a>01044       <span class="comment">//                                        // if grenade launcher, pick regular instead</span>
<a name="l01045"></a>01045       <span class="comment">//                case 1: ubNumReg++;                       sNumPoints -= 9;        break;</span>
<a name="l01046"></a>01046       <span class="comment">//                case 2: if ( !fGrenadeLauncher ) </span>
<a name="l01047"></a>01047       <span class="comment">//                                        {</span>
<a name="l01048"></a>01048       <span class="comment">//                                              ubNumMini++;                  sNumPoints -= 7;        break;</span>
<a name="l01049"></a>01049       <span class="comment">//                                        }</span>
<a name="l01050"></a>01050       <span class="comment">//                                        // if grenade launcher, pick tear instead</span>
<a name="l01051"></a>01051       <span class="comment">//                case 3: ubNumTear++;                sNumPoints -= 6;        break;</span>
<a name="l01052"></a>01052       <span class="comment">//                case 4: ubNumStun++;                sNumPoints -= 5;        break;</span>
<a name="l01053"></a>01053       <span class="comment">//                case 5: ubNumSmoke++;               sNumPoints -= 4;        break;</span>
<a name="l01054"></a>01054       <span class="comment">//                case 6: if (!fGrenadeLauncher )</span>
<a name="l01055"></a>01055       <span class="comment">//                            {</span>
<a name="l01056"></a>01056       <span class="comment">//                                  ubNumFlare++;                 sNumPoints -= 3;        </span>
<a name="l01057"></a>01057       <span class="comment">//                            }</span>
<a name="l01058"></a>01058       <span class="comment">//                            break;</span>
<a name="l01059"></a>01059       <span class="comment">//          }</span>
<a name="l01060"></a>01060       <span class="comment">//    }</span>
<a name="l01061"></a>01061 
<a name="l01062"></a>01062       <span class="comment">//    // JA2 Gold: don't make mini-grenades take all points available, and add chance of break lights</span>
<a name="l01063"></a>01063       <span class="comment">//    if( sNumPoints &gt;= 1 &amp;&amp; sNumPoints &lt; 10 )</span>
<a name="l01064"></a>01064       <span class="comment">//    {</span>
<a name="l01065"></a>01065       <span class="comment">//          switch( Random( 10 ) )</span>
<a name="l01066"></a>01066       <span class="comment">//          {</span>
<a name="l01067"></a>01067       <span class="comment">//                case 0:</span>
<a name="l01068"></a>01068       <span class="comment">//                case 1:</span>
<a name="l01069"></a>01069       <span class="comment">//                case 2:</span>
<a name="l01070"></a>01070       <span class="comment">//                      ubNumSmoke++;</span>
<a name="l01071"></a>01071       <span class="comment">//                      sNumPoints -= 4;</span>
<a name="l01072"></a>01072       <span class="comment">//                      break;</span>
<a name="l01073"></a>01073       <span class="comment">//                case 3:</span>
<a name="l01074"></a>01074       <span class="comment">//                case 4:</span>
<a name="l01075"></a>01075       <span class="comment">//                      ubNumTear++;</span>
<a name="l01076"></a>01076       <span class="comment">//                      sNumPoints -= 6;</span>
<a name="l01077"></a>01077       <span class="comment">//                      break;</span>
<a name="l01078"></a>01078       <span class="comment">//                case 5:</span>
<a name="l01079"></a>01079       <span class="comment">//                case 6:</span>
<a name="l01080"></a>01080       <span class="comment">//                      if (!fGrenadeLauncher)</span>
<a name="l01081"></a>01081       <span class="comment">//                      {</span>
<a name="l01082"></a>01082       <span class="comment">//                            ubNumFlare++;</span>
<a name="l01083"></a>01083       <span class="comment">//                            sNumPoints -= 3;</span>
<a name="l01084"></a>01084       <span class="comment">//                      }</span>
<a name="l01085"></a>01085       <span class="comment">//                      break;</span>
<a name="l01086"></a>01086       <span class="comment">//                case 7:</span>
<a name="l01087"></a>01087       <span class="comment">//                case 8:</span>
<a name="l01088"></a>01088       <span class="comment">//                      ubNumStun++;</span>
<a name="l01089"></a>01089       <span class="comment">//                      sNumPoints -= 5;</span>
<a name="l01090"></a>01090       <span class="comment">//                      break;</span>
<a name="l01091"></a>01091       <span class="comment">//                case 9:</span>
<a name="l01092"></a>01092       <span class="comment">//                      if (!fGrenadeLauncher)</span>
<a name="l01093"></a>01093       <span class="comment">//                      {</span>
<a name="l01094"></a>01094       <span class="comment">//                            ubNumMini++;</span>
<a name="l01095"></a>01095       <span class="comment">//                            sNumPoints -= 7;</span>
<a name="l01096"></a>01096       <span class="comment">//                      }</span>
<a name="l01097"></a>01097       <span class="comment">//                      break;</span>
<a name="l01098"></a>01098       <span class="comment">//          }</span>
<a name="l01099"></a>01099       <span class="comment">//    }</span>
<a name="l01100"></a>01100       <span class="comment">//    /*</span>
<a name="l01101"></a>01101       <span class="comment">//    if( usNumPoints &gt;= 1 &amp;&amp; usNumPoints &lt; 10 )</span>
<a name="l01102"></a>01102       <span class="comment">//    { //choose randomly between either stun or tear, (normal with rare chance)</span>
<a name="l01103"></a>01103       <span class="comment">//          switch( Random( 10 ) )</span>
<a name="l01104"></a>01104       <span class="comment">//          {</span>
<a name="l01105"></a>01105       <span class="comment">//                case 0:</span>
<a name="l01106"></a>01106       <span class="comment">//                case 1:</span>
<a name="l01107"></a>01107       <span class="comment">//                case 2:</span>
<a name="l01108"></a>01108       <span class="comment">//                case 3:</span>
<a name="l01109"></a>01109       <span class="comment">//                      ubNumSmoke++;</span>
<a name="l01110"></a>01110       <span class="comment">//                      if( usNumPoints &gt; 4 )</span>
<a name="l01111"></a>01111       <span class="comment">//                            usNumPoints -= 4;</span>
<a name="l01112"></a>01112       <span class="comment">//                      else</span>
<a name="l01113"></a>01113       <span class="comment">//                            usNumPoints = 0;</span>
<a name="l01114"></a>01114       <span class="comment">//                      break;</span>
<a name="l01115"></a>01115       <span class="comment">//                case 4:</span>
<a name="l01116"></a>01116       <span class="comment">//                case 5:</span>
<a name="l01117"></a>01117       <span class="comment">//                case 6:</span>
<a name="l01118"></a>01118       <span class="comment">//                      ubNumTear++;</span>
<a name="l01119"></a>01119       <span class="comment">//                      if( usNumPoints &gt; 6 )</span>
<a name="l01120"></a>01120       <span class="comment">//                            usNumPoints -= 6;</span>
<a name="l01121"></a>01121       <span class="comment">//                      else</span>
<a name="l01122"></a>01122       <span class="comment">//                            usNumPoints = 0;</span>
<a name="l01123"></a>01123       <span class="comment">//                      break;</span>
<a name="l01124"></a>01124       <span class="comment">//                case 7:</span>
<a name="l01125"></a>01125       <span class="comment">//                case 8:</span>
<a name="l01126"></a>01126       <span class="comment">//                      ubNumStun++;</span>
<a name="l01127"></a>01127       <span class="comment">//                      if( usNumPoints &gt; 5 )</span>
<a name="l01128"></a>01128       <span class="comment">//                            usNumPoints -= 5;</span>
<a name="l01129"></a>01129       <span class="comment">//                      else</span>
<a name="l01130"></a>01130       <span class="comment">//                            usNumPoints = 0;</span>
<a name="l01131"></a>01131       <span class="comment">//                      break;</span>
<a name="l01132"></a>01132       <span class="comment">//                case 9:</span>
<a name="l01133"></a>01133       <span class="comment">//                      ubNumMini++;</span>
<a name="l01134"></a>01134       <span class="comment">//                      usNumPoints = 0;</span>
<a name="l01135"></a>01135       <span class="comment">//                      break;</span>
<a name="l01136"></a>01136       <span class="comment">//          }</span>
<a name="l01137"></a>01137       <span class="comment">//    }</span>
<a name="l01138"></a>01138       <span class="comment">//    */</span>
<a name="l01139"></a>01139       <span class="comment">//}</span>
<a name="l01140"></a>01140 
<a name="l01141"></a>01141 <span class="comment"></span>
<a name="l01142"></a>01142 <span class="comment">      ////Create the grenades and add them to the soldier</span>
<a name="l01143"></a>01143 <span class="comment"></span>
<a name="l01144"></a>01144       <span class="comment">//if( ubNumSmoke )</span>
<a name="l01145"></a>01145       <span class="comment">//{</span>
<a name="l01146"></a>01146       <span class="comment">//    if ( fGrenadeLauncher )</span>
<a name="l01147"></a>01147       <span class="comment">//    {</span>
<a name="l01148"></a>01148       <span class="comment">//          usItem = GL_SMOKE_GRENADE;</span>
<a name="l01149"></a>01149       <span class="comment">//    }</span>
<a name="l01150"></a>01150       <span class="comment">//    else</span>
<a name="l01151"></a>01151       <span class="comment">//    {</span>
<a name="l01152"></a>01152       <span class="comment">//          usItem = SMOKE_GRENADE;</span>
<a name="l01153"></a>01153       <span class="comment">//    }</span>
<a name="l01154"></a>01154       <span class="comment">//    CreateItems( usItem, (INT8)(ubBaseQuality + Random( ubQualityVariation )), ubNumSmoke, &amp;Object );</span>
<a name="l01155"></a>01155       <span class="comment">//    Object.fFlags |= OBJECT_UNDROPPABLE;</span>
<a name="l01156"></a>01156       <span class="comment">//    PlaceObjectInSoldierCreateStruct( pp, &amp;Object );</span>
<a name="l01157"></a>01157       <span class="comment">//}</span>
<a name="l01158"></a>01158       <span class="comment">//if( ubNumTear )</span>
<a name="l01159"></a>01159       <span class="comment">//{</span>
<a name="l01160"></a>01160       <span class="comment">//    if ( fGrenadeLauncher )</span>
<a name="l01161"></a>01161       <span class="comment">//    {</span>
<a name="l01162"></a>01162       <span class="comment">//          usItem = GL_TEARGAS_GRENADE;</span>
<a name="l01163"></a>01163       <span class="comment">//    }</span>
<a name="l01164"></a>01164       <span class="comment">//    else</span>
<a name="l01165"></a>01165       <span class="comment">//    {</span>
<a name="l01166"></a>01166       <span class="comment">//          usItem = TEARGAS_GRENADE;</span>
<a name="l01167"></a>01167       <span class="comment">//    }</span>
<a name="l01168"></a>01168       <span class="comment">//    CreateItems( usItem, (INT8)(ubBaseQuality + Random( ubQualityVariation )), ubNumTear, &amp;Object );</span>
<a name="l01169"></a>01169       <span class="comment">//    Object.fFlags |= OBJECT_UNDROPPABLE;</span>
<a name="l01170"></a>01170       <span class="comment">//    PlaceObjectInSoldierCreateStruct( pp, &amp;Object );</span>
<a name="l01171"></a>01171       <span class="comment">//}</span>
<a name="l01172"></a>01172       <span class="comment">//if( ubNumStun )</span>
<a name="l01173"></a>01173       <span class="comment">//{</span>
<a name="l01174"></a>01174       <span class="comment">//    if ( fGrenadeLauncher )</span>
<a name="l01175"></a>01175       <span class="comment">//    {</span>
<a name="l01176"></a>01176       <span class="comment">//          usItem = GL_STUN_GRENADE;</span>
<a name="l01177"></a>01177       <span class="comment">//    }</span>
<a name="l01178"></a>01178       <span class="comment">//    else</span>
<a name="l01179"></a>01179       <span class="comment">//    {</span>
<a name="l01180"></a>01180       <span class="comment">//          usItem = STUN_GRENADE;</span>
<a name="l01181"></a>01181       <span class="comment">//    }</span>
<a name="l01182"></a>01182       <span class="comment">//    CreateItems( usItem, (INT8)(ubBaseQuality + Random( ubQualityVariation )), ubNumStun, &amp;Object );</span>
<a name="l01183"></a>01183       <span class="comment">//    Object.fFlags |= OBJECT_UNDROPPABLE;</span>
<a name="l01184"></a>01184       <span class="comment">//    PlaceObjectInSoldierCreateStruct( pp, &amp;Object );</span>
<a name="l01185"></a>01185       <span class="comment">//}</span>
<a name="l01186"></a>01186       <span class="comment">//if( ubNumReg )</span>
<a name="l01187"></a>01187       <span class="comment">//{</span>
<a name="l01188"></a>01188       <span class="comment">//    if ( fGrenadeLauncher )</span>
<a name="l01189"></a>01189       <span class="comment">//    {</span>
<a name="l01190"></a>01190       <span class="comment">//          usItem = GL_HE_GRENADE;</span>
<a name="l01191"></a>01191       <span class="comment">//    }</span>
<a name="l01192"></a>01192       <span class="comment">//    else</span>
<a name="l01193"></a>01193       <span class="comment">//    {</span>
<a name="l01194"></a>01194       <span class="comment">//          usItem = HAND_GRENADE;</span>
<a name="l01195"></a>01195       <span class="comment">//    }</span>
<a name="l01196"></a>01196       <span class="comment">//    CreateItems( usItem, (INT8)(ubBaseQuality + Random( ubQualityVariation )), ubNumReg, &amp;Object );</span>
<a name="l01197"></a>01197       <span class="comment">//    Object.fFlags |= OBJECT_UNDROPPABLE;</span>
<a name="l01198"></a>01198       <span class="comment">//    PlaceObjectInSoldierCreateStruct( pp, &amp;Object );</span>
<a name="l01199"></a>01199       <span class="comment">//}</span>
<a name="l01200"></a>01200 
<a name="l01201"></a>01201       <span class="comment">//if( ubNumMini )</span>
<a name="l01202"></a>01202       <span class="comment">//{</span>
<a name="l01203"></a>01203       <span class="comment">//    CreateItems( MINI_GRENADE, (INT8)(ubBaseQuality + Random( ubQualityVariation )), ubNumMini, &amp;Object );</span>
<a name="l01204"></a>01204       <span class="comment">//    Object.fFlags |= OBJECT_UNDROPPABLE;</span>
<a name="l01205"></a>01205       <span class="comment">//    PlaceObjectInSoldierCreateStruct( pp, &amp;Object );</span>
<a name="l01206"></a>01206       <span class="comment">//}</span>
<a name="l01207"></a>01207       <span class="comment">//if( ubNumMustard )</span>
<a name="l01208"></a>01208       <span class="comment">//{</span>
<a name="l01209"></a>01209       <span class="comment">//    CreateItems( MUSTARD_GRENADE, (INT8)(ubBaseQuality + Random( ubQualityVariation )), ubNumMustard, &amp;Object );</span>
<a name="l01210"></a>01210       <span class="comment">//    Object.fFlags |= OBJECT_UNDROPPABLE;</span>
<a name="l01211"></a>01211       <span class="comment">//    PlaceObjectInSoldierCreateStruct( pp, &amp;Object );</span>
<a name="l01212"></a>01212       <span class="comment">//}</span>
<a name="l01213"></a>01213       <span class="comment">//if( ubNumFlare )</span>
<a name="l01214"></a>01214       <span class="comment">//{</span>
<a name="l01215"></a>01215       <span class="comment">//    CreateItems( BREAK_LIGHT, (INT8)(ubBaseQuality + Random( ubQualityVariation )), ubNumFlare, &amp;Object );</span>
<a name="l01216"></a>01216       <span class="comment">//    Object.fFlags |= OBJECT_UNDROPPABLE;</span>
<a name="l01217"></a>01217       <span class="comment">//    PlaceObjectInSoldierCreateStruct( pp, &amp;Object );</span>
<a name="l01218"></a>01218       <span class="comment">//}</span>
<a name="l01219"></a>01219 
<a name="l01220"></a>01220 }
<a name="l01221"></a>01221 
<a name="l01222"></a><a class="code" href="Inventory_01Choosing_8h.html#644ef271ef6b18698f1b8a7faa8e8600">01222</a> <span class="keywordtype">void</span> <a class="code" href="Inventory_01Choosing_8cpp.html#4c06f0e7b116b48d636ac4a29bd9f4df">ChooseArmourForSoldierCreateStruct</a>( <a class="code" href="structSOLDIERCREATE__STRUCT.html">SOLDIERCREATE_STRUCT</a> *pp, <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bHelmetClass, <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bVestClass, <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bLeggingsClass )
<a name="l01223"></a>01223 {
<a name="l01224"></a>01224       DebugMsg (TOPIC_JA2,DBG_LEVEL_3,<span class="stringliteral">"ChooseArmourForSoldierCreateStruct"</span>);
<a name="l01225"></a>01225       <span class="comment">//UINT16 i;</span>
<a name="l01226"></a>01226       <span class="comment">//INVTYPE *pItem;</span>
<a name="l01227"></a>01227       <span class="comment">//UINT16 usRandom;</span>
<a name="l01228"></a>01228       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usItem = 0;
<a name="l01229"></a>01229       <span class="comment">//UINT16 usNumMatches;</span>
<a name="l01230"></a>01230 <span class="comment">//    INT8 bOrigVestClass = bVestClass;</span>
<a name="l01231"></a>01231       <a class="code" href="structOBJECTTYPE.html">OBJECTTYPE</a> Object;
<a name="l01232"></a>01232 
<a name="l01233"></a>01233       <span class="comment">//Madd: added minimum protection of 10 for armours to be used by enemies</span>
<a name="l01234"></a>01234 
<a name="l01235"></a>01235       <span class="comment">//Choose helmet</span>
<a name="l01236"></a>01236       <span class="keywordflow">if</span>( bHelmetClass )
<a name="l01237"></a>01237       {
<a name="l01238"></a>01238             usItem = <a class="code" href="Inventory_01Choosing_8cpp.html#661ec86e3a255acaad87210de3b4b24d">PickARandomItem</a>(<a class="code" href="Inventory_01Choosing_8h.html#85d881cb3816f77e92c1c8f721b54fc479ede55d79c4823510a452253427fbd8">HELMET</a>,bHelmetClass );
<a name="l01239"></a>01239             <span class="keywordflow">if</span> ( usItem &gt; 0 &amp;&amp; <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usItem].usItemClass == IC_ARMOUR &amp;&amp; !(pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc878551e1de377a2d80cf67fd63934f134956d">HELMETPOS</a> ].fFlags &amp; OBJECT_NO_OVERWRITE) &amp;&amp; <a class="code" href="Weapons_8cpp.html#54e6d0ad7e147f581bec4c56ca4a27cd">Armour</a>[ <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usItem].<a class="code" href="structINVTYPE.html#8f52f99607debfdbb9a8dbf9e43c1967">ubClassIndex</a> ].ubArmourClass == <a class="code" href="Weapons_8h.html#3212119ca5acac4c9ec6051987380876166c832f935517df6b39d78c7a3061e7">ARMOURCLASS_HELMET</a> )
<a name="l01240"></a>01240             {
<a name="l01241"></a>01241                   <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( usItem, (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)(70+<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(31)), &amp;(pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc878551e1de377a2d80cf67fd63934f134956d">HELMETPOS</a> ]) );
<a name="l01242"></a>01242                   pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc878551e1de377a2d80cf67fd63934f134956d">HELMETPOS</a> ].<a class="code" href="structOBJECTTYPE.html#0f1e67bac22f1b89c4040ef8a5ea48c2">fFlags</a> |= OBJECT_UNDROPPABLE;
<a name="l01243"></a>01243 
<a name="l01244"></a>01244                   <span class="comment">// roll to see if he gets an attachment, too.  Higher chance the higher his entitled helmet class is</span>
<a name="l01245"></a>01245                   <span class="keywordflow">if</span> (( <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> ) <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 100 ) &lt; ( 15 * ( bHelmetClass - <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usItem].ubCoolness ) ) )
<a name="l01246"></a>01246                   {
<a name="l01247"></a>01247                         <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usAttachment = <a class="code" href="Inventory_01Choosing_8cpp.html#542239fb2c141fed4755889a76e7fc7d">PickARandomAttachment</a>(<a class="code" href="Inventory_01Choosing_8h.html#85d881cb3816f77e92c1c8f721b54fc420240ab2bf3a39a655949f88025fd223">ARMOURATTACHMENT</a>,usItem, bHelmetClass, FALSE);
<a name="l01248"></a>01248                         <span class="keywordflow">if</span> ( usAttachment &gt; 0 )
<a name="l01249"></a>01249                         {
<a name="l01250"></a>01250                               <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( usAttachment, (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)(70+<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(31)), &amp;Object );
<a name="l01251"></a>01251                               Object.<a class="code" href="structOBJECTTYPE.html#0f1e67bac22f1b89c4040ef8a5ea48c2">fFlags</a> |= OBJECT_UNDROPPABLE;
<a name="l01252"></a>01252                               <a class="code" href="Items_8cpp.html#50949f80fa93497497e84d167eedd853">AttachObject</a>( NULL, &amp;(pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc878551e1de377a2d80cf67fd63934f134956d">HELMETPOS</a> ]), &amp;Object );           
<a name="l01253"></a>01253                         }
<a name="l01254"></a>01254                   }
<a name="l01255"></a>01255 
<a name="l01256"></a>01256             }
<a name="l01257"></a>01257 
<a name="l01258"></a>01258             <span class="comment">//usNumMatches = 0;</span>
<a name="l01259"></a>01259             <span class="comment">//while( bHelmetClass &amp;&amp; !usNumMatches )</span>
<a name="l01260"></a>01260             <span class="comment">//{ //First step is to count the number of helmets in the helmet class range.  If we</span>
<a name="l01261"></a>01261             <span class="comment">//    //don't find one, we keep lowering the class until we do.</span>
<a name="l01262"></a>01262             <span class="comment">//    for( i = 0; i &lt; MAXITEMS; i++ )</span>
<a name="l01263"></a>01263             <span class="comment">//    {</span>
<a name="l01264"></a>01264             <span class="comment">//          if ( Item[i].usItemClass  == 0 )</span>
<a name="l01265"></a>01265             <span class="comment">//                break;</span>
<a name="l01266"></a>01266             <span class="comment">//          pItem = &amp;Item[ i ];</span>
<a name="l01267"></a>01267             <span class="comment">//          // NOTE: This relies on treated armor to have a coolness of 0 in order for enemies not to be equipped with it</span>
<a name="l01268"></a>01268             <span class="comment">//          if( pItem-&gt;usItemClass == IC_ARMOUR &amp;&amp; pItem-&gt;ubCoolness == bHelmetClass )</span>
<a name="l01269"></a>01269             <span class="comment">//          {</span>
<a name="l01270"></a>01270             <span class="comment">//                if( Armour[ pItem-&gt;ubClassIndex ].ubArmourClass == ARMOURCLASS_HELMET &amp;&amp; Armour[ pItem-&gt;ubClassIndex ].ubProtection &gt;= 10 )</span>
<a name="l01271"></a>01271             <span class="comment">//                      usNumMatches++;</span>
<a name="l01272"></a>01272             <span class="comment">//          }</span>
<a name="l01273"></a>01273             <span class="comment">//    }</span>
<a name="l01274"></a>01274             <span class="comment">//    if( !usNumMatches )</span>
<a name="l01275"></a>01275             <span class="comment">//          bHelmetClass--;</span>
<a name="l01276"></a>01276             <span class="comment">//}</span>
<a name="l01277"></a>01277             <span class="comment">//if( usNumMatches )</span>
<a name="l01278"></a>01278             <span class="comment">//{ //There is a helmet that we can choose.</span>
<a name="l01279"></a>01279             <span class="comment">//    usRandom = (UINT16)Random( usNumMatches );</span>
<a name="l01280"></a>01280             <span class="comment">//    for( i = 0; i &lt; MAXITEMS; i++ )</span>
<a name="l01281"></a>01281             <span class="comment">//    {</span>
<a name="l01282"></a>01282             <span class="comment">//          if ( Item[i].usItemClass  == 0 )</span>
<a name="l01283"></a>01283             <span class="comment">//                break;</span>
<a name="l01284"></a>01284             <span class="comment">//          pItem = &amp;Item[ i ];</span>
<a name="l01285"></a>01285             <span class="comment">//          if( pItem-&gt;usItemClass == IC_ARMOUR &amp;&amp; pItem-&gt;ubCoolness == bHelmetClass )</span>
<a name="l01286"></a>01286             <span class="comment">//          {</span>
<a name="l01287"></a>01287             <span class="comment">//                if( Armour[ pItem-&gt;ubClassIndex ].ubArmourClass == ARMOURCLASS_HELMET &amp;&amp; Armour[ pItem-&gt;ubClassIndex ].ubProtection &gt;= 10 )</span>
<a name="l01288"></a>01288             <span class="comment">//                {</span>
<a name="l01289"></a>01289             <span class="comment">//                      if( usRandom )</span>
<a name="l01290"></a>01290             <span class="comment">//                            usRandom--;</span>
<a name="l01291"></a>01291             <span class="comment">//                      else</span>
<a name="l01292"></a>01292             <span class="comment">//                      {</span>
<a name="l01293"></a>01293             <span class="comment">//                            if( !(pp-&gt;Inv[ HELMETPOS ].fFlags &amp; OBJECT_NO_OVERWRITE) )</span>
<a name="l01294"></a>01294             <span class="comment">//                            {</span>
<a name="l01295"></a>01295             <span class="comment">//                                  CreateItem( i, (INT8)(70+Random(31)), &amp;(pp-&gt;Inv[ HELMETPOS ]) );</span>
<a name="l01296"></a>01296             <span class="comment">//                                  pp-&gt;Inv[ HELMETPOS ].fFlags |= OBJECT_UNDROPPABLE;</span>
<a name="l01297"></a>01297             <span class="comment">//                            }</span>
<a name="l01298"></a>01298             <span class="comment">//                            break;</span>
<a name="l01299"></a>01299             <span class="comment">//                      }</span>
<a name="l01300"></a>01300             <span class="comment">//                }</span>
<a name="l01301"></a>01301             <span class="comment">//          }</span>
<a name="l01302"></a>01302             <span class="comment">//    }</span>
<a name="l01303"></a>01303             <span class="comment">//}</span>
<a name="l01304"></a>01304       }
<a name="l01305"></a>01305 
<a name="l01306"></a>01306       <span class="comment">//Choose vest</span>
<a name="l01307"></a>01307       <span class="keywordflow">if</span>( bVestClass )
<a name="l01308"></a>01308       {
<a name="l01309"></a>01309             usItem = <a class="code" href="Inventory_01Choosing_8cpp.html#661ec86e3a255acaad87210de3b4b24d">PickARandomItem</a>(<a class="code" href="Inventory_01Choosing_8h.html#85d881cb3816f77e92c1c8f721b54fc43e74be9c4b6e1fac32337edc0d07050d">VEST</a>,bVestClass );
<a name="l01310"></a>01310             <span class="keywordflow">if</span> ( usItem &gt; 0 &amp;&amp; <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usItem].usItemClass == IC_ARMOUR &amp;&amp; !(pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855afc78e6fc0aaffa92d59c2fe506f5c6a">VESTPOS</a> ].fFlags &amp; OBJECT_NO_OVERWRITE) &amp;&amp; <a class="code" href="Weapons_8cpp.html#54e6d0ad7e147f581bec4c56ca4a27cd">Armour</a>[ <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usItem].<a class="code" href="structINVTYPE.html#8f52f99607debfdbb9a8dbf9e43c1967">ubClassIndex</a> ].ubArmourClass == <a class="code" href="Weapons_8h.html#3212119ca5acac4c9ec6051987380876182202b23e40d1e6c8201884fe88008e">ARMOURCLASS_VEST</a> )
<a name="l01311"></a>01311             {
<a name="l01312"></a>01312                   <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( usItem, (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)(70+<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(31)), &amp;(pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855afc78e6fc0aaffa92d59c2fe506f5c6a">VESTPOS</a> ]) );
<a name="l01313"></a>01313                   pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855afc78e6fc0aaffa92d59c2fe506f5c6a">VESTPOS</a> ].<a class="code" href="structOBJECTTYPE.html#0f1e67bac22f1b89c4040ef8a5ea48c2">fFlags</a> |= OBJECT_UNDROPPABLE;
<a name="l01314"></a>01314 
<a name="l01315"></a>01315                   <span class="comment">// roll to see if he gets a CERAMIC PLATES, too.  Higher chance the higher his entitled vest class is</span>
<a name="l01316"></a>01316                   <span class="keywordflow">if</span> (( <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> ) <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 100 ) &lt; ( 15 * ( bVestClass - <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usItem].ubCoolness ) ) )
<a name="l01317"></a>01317                   {
<a name="l01318"></a>01318                         <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usAttachment = <a class="code" href="Inventory_01Choosing_8cpp.html#542239fb2c141fed4755889a76e7fc7d">PickARandomAttachment</a>(<a class="code" href="Inventory_01Choosing_8h.html#85d881cb3816f77e92c1c8f721b54fc420240ab2bf3a39a655949f88025fd223">ARMOURATTACHMENT</a>,usItem, bVestClass, FALSE);
<a name="l01319"></a>01319                         <span class="keywordflow">if</span> ( usAttachment &gt; 0 )
<a name="l01320"></a>01320                         {
<a name="l01321"></a>01321                               <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( usAttachment, (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)(70+<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(31)), &amp;Object );
<a name="l01322"></a>01322                               Object.<a class="code" href="structOBJECTTYPE.html#0f1e67bac22f1b89c4040ef8a5ea48c2">fFlags</a> |= OBJECT_UNDROPPABLE;
<a name="l01323"></a>01323                               <a class="code" href="Items_8cpp.html#50949f80fa93497497e84d167eedd853">AttachObject</a>( NULL, &amp;(pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855afc78e6fc0aaffa92d59c2fe506f5c6a">VESTPOS</a> ]), &amp;Object );       
<a name="l01324"></a>01324                         }
<a name="l01325"></a>01325                   }
<a name="l01326"></a>01326 
<a name="l01327"></a>01327             }
<a name="l01328"></a>01328 
<a name="l01329"></a>01329             <span class="comment">//usNumMatches = 0;</span>
<a name="l01330"></a>01330             <span class="comment">//while( bVestClass &amp;&amp; !usNumMatches )</span>
<a name="l01331"></a>01331             <span class="comment">//{ //First step is to count the number of armours in the armour class range.  If we</span>
<a name="l01332"></a>01332             <span class="comment">//    //don't find one, we keep lowering the class until we do.</span>
<a name="l01333"></a>01333             <span class="comment">//    for( i = 0; i &lt; MAXITEMS; i++ )</span>
<a name="l01334"></a>01334             <span class="comment">//    {</span>
<a name="l01335"></a>01335             <span class="comment">//          if ( Item[i].usItemClass  == 0 )</span>
<a name="l01336"></a>01336             <span class="comment">//                break;</span>
<a name="l01337"></a>01337             <span class="comment">//          // these 3 have a non-zero coolness, and would otherwise be selected, so skip them</span>
<a name="l01338"></a>01338             <span class="comment">//          if ( Item[i].leatherjacket)</span>
<a name="l01339"></a>01339             <span class="comment">//                continue;</span>
<a name="l01340"></a>01340 
<a name="l01341"></a>01341             <span class="comment">//          pItem = &amp;Item[ i ];</span>
<a name="l01342"></a>01342             <span class="comment">//          // Madd: don't pick crappy armour like t-shirts, must be a minimum protection of ten</span>
<a name="l01343"></a>01343             <span class="comment">//          // NOTE: This relies on treated armor to have a coolness of 0 in order for enemies not to be equipped with it</span>
<a name="l01344"></a>01344             <span class="comment">//          if( pItem-&gt;usItemClass == IC_ARMOUR &amp;&amp; pItem-&gt;ubCoolness == bVestClass )</span>
<a name="l01345"></a>01345             <span class="comment">//          {</span>
<a name="l01346"></a>01346             <span class="comment">//                if( Armour[ pItem-&gt;ubClassIndex ].ubArmourClass == ARMOURCLASS_VEST &amp;&amp; Armour[pItem-&gt;ubClassIndex].ubProtection &gt;= 10 )</span>
<a name="l01347"></a>01347             <span class="comment">//                      usNumMatches++;</span>
<a name="l01348"></a>01348             <span class="comment">//          }</span>
<a name="l01349"></a>01349             <span class="comment">//    }</span>
<a name="l01350"></a>01350             <span class="comment">//    if( !usNumMatches )</span>
<a name="l01351"></a>01351             <span class="comment">//          bVestClass--;</span>
<a name="l01352"></a>01352             <span class="comment">//}</span>
<a name="l01353"></a>01353             <span class="comment">//if( usNumMatches )</span>
<a name="l01354"></a>01354             <span class="comment">//{ //There is an armour that we can choose.</span>
<a name="l01355"></a>01355             <span class="comment">//    usRandom = (UINT16)Random( usNumMatches );</span>
<a name="l01356"></a>01356             <span class="comment">//    for( i = 0; i &lt; MAXITEMS; i++ )</span>
<a name="l01357"></a>01357             <span class="comment">//    {</span>
<a name="l01358"></a>01358             <span class="comment">//          if ( Item[i].usItemClass  == 0 )</span>
<a name="l01359"></a>01359             <span class="comment">//                break;</span>
<a name="l01360"></a>01360 
<a name="l01361"></a>01361             <span class="comment">//          pItem = &amp;Item[ i ];</span>
<a name="l01362"></a>01362             <span class="comment">//          if( pItem-&gt;usItemClass == IC_ARMOUR &amp;&amp; pItem-&gt;ubCoolness == bVestClass )</span>
<a name="l01363"></a>01363             <span class="comment">//          {</span>
<a name="l01364"></a>01364             <span class="comment">//                if ( Item[i].leatherjacket )</span>
<a name="l01365"></a>01365             <span class="comment">//                      continue;</span>
<a name="l01366"></a>01366 
<a name="l01367"></a>01367             <span class="comment">//                // Madd: don't pick crappy armour like t-shirts, must be a minimum protection of ten</span>
<a name="l01368"></a>01368             <span class="comment">//                if( Armour[ pItem-&gt;ubClassIndex ].ubArmourClass == ARMOURCLASS_VEST &amp;&amp; Armour[ pItem-&gt;ubClassIndex ].ubProtection &gt;= 10 )</span>
<a name="l01369"></a>01369             <span class="comment">//                {</span>
<a name="l01370"></a>01370             <span class="comment">//                      if( usRandom )</span>
<a name="l01371"></a>01371             <span class="comment">//                            usRandom--;</span>
<a name="l01372"></a>01372             <span class="comment">//                      else</span>
<a name="l01373"></a>01373             <span class="comment">//                      {</span>
<a name="l01374"></a>01374             <span class="comment">//                            if( !(pp-&gt;Inv[ VESTPOS ].fFlags &amp; OBJECT_NO_OVERWRITE) )</span>
<a name="l01375"></a>01375             <span class="comment">//                            {</span>
<a name="l01376"></a>01376             <span class="comment">//                                  CreateItem( i, (INT8)(70+Random(31)), &amp;(pp-&gt;Inv[ VESTPOS ]) );</span>
<a name="l01377"></a>01377             <span class="comment">//                                  pp-&gt;Inv[ VESTPOS ].fFlags |= OBJECT_UNDROPPABLE;</span>
<a name="l01378"></a>01378 
<a name="l01379"></a>01379             <span class="comment">//                                  // roll to see if he gets a CERAMIC PLATES, too.  Higher chance the higher his entitled vest class is</span>
<a name="l01380"></a>01380             <span class="comment">//                                  if (( INT8 ) Random( 100 ) &lt; ( 15 * ( bOrigVestClass - pItem-&gt;ubCoolness ) ) )</span>
<a name="l01381"></a>01381             <span class="comment">//                                  {</span>
<a name="l01382"></a>01382             <span class="comment">//                                        UINT16 usAttachment = PickARandomItem(ARMOURATTACHMENT, bOrigVestClass);</span>
<a name="l01383"></a>01383             <span class="comment">//                                        if ( usAttachment &gt; 0 &amp;&amp; ValidAttachment(usAttachment, i ) )</span>
<a name="l01384"></a>01384             <span class="comment">//                                        {</span>
<a name="l01385"></a>01385             <span class="comment">//                                              CreateItem( usAttachment, (INT8)(70+Random(31)), &amp;Object );</span>
<a name="l01386"></a>01386             <span class="comment">//                                              Object.fFlags |= OBJECT_UNDROPPABLE;</span>
<a name="l01387"></a>01387             <span class="comment">//                                              AttachObject( NULL, &amp;(pp-&gt;Inv[ VESTPOS ]), &amp;Object );       </span>
<a name="l01388"></a>01388             <span class="comment">//                                        }</span>
<a name="l01389"></a>01389             <span class="comment">//                                  }</span>
<a name="l01390"></a>01390             <span class="comment">//                            }</span>
<a name="l01391"></a>01391             <span class="comment">//                            break;</span>
<a name="l01392"></a>01392             <span class="comment">//                      }</span>
<a name="l01393"></a>01393             <span class="comment">//                }</span>
<a name="l01394"></a>01394             <span class="comment">//          }</span>
<a name="l01395"></a>01395             <span class="comment">//    }</span>
<a name="l01396"></a>01396             <span class="comment">//}</span>
<a name="l01397"></a>01397       }
<a name="l01398"></a>01398       <span class="comment">//Choose Leggings</span>
<a name="l01399"></a>01399       <span class="keywordflow">if</span>( bLeggingsClass )
<a name="l01400"></a>01400       {
<a name="l01401"></a>01401             usItem = <a class="code" href="Inventory_01Choosing_8cpp.html#661ec86e3a255acaad87210de3b4b24d">PickARandomItem</a>(<a class="code" href="Inventory_01Choosing_8h.html#85d881cb3816f77e92c1c8f721b54fc484d7e0d15f894957f9c9921446f36cfb">LEGS</a>,bLeggingsClass);
<a name="l01402"></a>01402             <span class="keywordflow">if</span> ( usItem &gt; 0 &amp;&amp; <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usItem].usItemClass == IC_ARMOUR &amp;&amp; !(pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855c1f8517c3795dd56e0c2450e625753dc">LEGPOS</a> ].fFlags &amp; OBJECT_NO_OVERWRITE) &amp;&amp; <a class="code" href="Weapons_8cpp.html#54e6d0ad7e147f581bec4c56ca4a27cd">Armour</a>[ <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usItem].<a class="code" href="structINVTYPE.html#8f52f99607debfdbb9a8dbf9e43c1967">ubClassIndex</a> ].ubArmourClass == <a class="code" href="Weapons_8h.html#3212119ca5acac4c9ec6051987380876b152f690ea49882ae79230919f756060">ARMOURCLASS_LEGGINGS</a> )
<a name="l01403"></a>01403             {
<a name="l01404"></a>01404                   <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( usItem, (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)(70+<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(31)), &amp;(pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855c1f8517c3795dd56e0c2450e625753dc">LEGPOS</a> ]) );
<a name="l01405"></a>01405                   pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855c1f8517c3795dd56e0c2450e625753dc">LEGPOS</a> ].<a class="code" href="structOBJECTTYPE.html#0f1e67bac22f1b89c4040ef8a5ea48c2">fFlags</a> |= OBJECT_UNDROPPABLE;
<a name="l01406"></a>01406 
<a name="l01407"></a>01407                   <span class="comment">// roll to see if he gets an attachment, too.  Higher chance the higher his entitled Leggings class is</span>
<a name="l01408"></a>01408                   <span class="keywordflow">if</span> (( <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> ) <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 100 ) &lt; ( 15 * ( bLeggingsClass - <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usItem].ubCoolness ) ) )
<a name="l01409"></a>01409                   {
<a name="l01410"></a>01410                         <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usAttachment = <a class="code" href="Inventory_01Choosing_8cpp.html#542239fb2c141fed4755889a76e7fc7d">PickARandomAttachment</a>(<a class="code" href="Inventory_01Choosing_8h.html#85d881cb3816f77e92c1c8f721b54fc420240ab2bf3a39a655949f88025fd223">ARMOURATTACHMENT</a>,usItem, bLeggingsClass, FALSE);
<a name="l01411"></a>01411                         <span class="keywordflow">if</span> ( usAttachment &gt; 0 )
<a name="l01412"></a>01412                         {
<a name="l01413"></a>01413                               <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( usAttachment, (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)(70+<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(31)), &amp;Object );
<a name="l01414"></a>01414                               Object.<a class="code" href="structOBJECTTYPE.html#0f1e67bac22f1b89c4040ef8a5ea48c2">fFlags</a> |= OBJECT_UNDROPPABLE;
<a name="l01415"></a>01415                               <a class="code" href="Items_8cpp.html#50949f80fa93497497e84d167eedd853">AttachObject</a>( NULL, &amp;(pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855c1f8517c3795dd56e0c2450e625753dc">LEGPOS</a> ]), &amp;Object );        
<a name="l01416"></a>01416                         }
<a name="l01417"></a>01417                   }
<a name="l01418"></a>01418 
<a name="l01419"></a>01419             }
<a name="l01420"></a>01420 
<a name="l01421"></a>01421 
<a name="l01422"></a>01422             <span class="comment">//usNumMatches = 0;</span>
<a name="l01423"></a>01423             <span class="comment">//while( bLeggingsClass &amp;&amp; !usNumMatches )</span>
<a name="l01424"></a>01424             <span class="comment">//{ //First step is to count the number of Armours in the Armour class range.  If we</span>
<a name="l01425"></a>01425             <span class="comment">//    //don't find one, we keep lowering the class until we do.</span>
<a name="l01426"></a>01426             <span class="comment">//    for( i = 0; i &lt; MAXITEMS; i++ )</span>
<a name="l01427"></a>01427             <span class="comment">//    {</span>
<a name="l01428"></a>01428             <span class="comment">//          if ( Item[i].usItemClass  == 0 )</span>
<a name="l01429"></a>01429             <span class="comment">//                break;</span>
<a name="l01430"></a>01430             <span class="comment">//          pItem = &amp;Item[ i ];</span>
<a name="l01431"></a>01431             <span class="comment">//          // NOTE: This relies on treated armor to have a coolness of 0 in order for enemies not to be equipped with it</span>
<a name="l01432"></a>01432             <span class="comment">//          if( pItem-&gt;usItemClass == IC_ARMOUR &amp;&amp; pItem-&gt;ubCoolness == bLeggingsClass )</span>
<a name="l01433"></a>01433             <span class="comment">//          {</span>
<a name="l01434"></a>01434             <span class="comment">//                if( Armour[ pItem-&gt;ubClassIndex ].ubArmourClass == ARMOURCLASS_LEGGINGS &amp;&amp; Armour[ pItem-&gt;ubClassIndex ].ubProtection &gt;= 10 )</span>
<a name="l01435"></a>01435             <span class="comment">//                      usNumMatches++;</span>
<a name="l01436"></a>01436             <span class="comment">//          }</span>
<a name="l01437"></a>01437             <span class="comment">//    }</span>
<a name="l01438"></a>01438             <span class="comment">//    if( !usNumMatches )</span>
<a name="l01439"></a>01439             <span class="comment">//          bLeggingsClass--;</span>
<a name="l01440"></a>01440             <span class="comment">//}</span>
<a name="l01441"></a>01441             <span class="comment">//if( usNumMatches )</span>
<a name="l01442"></a>01442             <span class="comment">//{ //There is a legging that we can choose.</span>
<a name="l01443"></a>01443             <span class="comment">//    usRandom = (UINT16)Random( usNumMatches );</span>
<a name="l01444"></a>01444             <span class="comment">//    for( i = 0; i &lt; MAXITEMS; i++ )</span>
<a name="l01445"></a>01445             <span class="comment">//    {</span>
<a name="l01446"></a>01446             <span class="comment">//          if ( Item[i].usItemClass  == 0 )</span>
<a name="l01447"></a>01447             <span class="comment">//                break;</span>
<a name="l01448"></a>01448             <span class="comment">//          pItem = &amp;Item[ i ];</span>
<a name="l01449"></a>01449             <span class="comment">//          if( pItem-&gt;usItemClass == IC_ARMOUR &amp;&amp; pItem-&gt;ubCoolness == bLeggingsClass )</span>
<a name="l01450"></a>01450             <span class="comment">//          {</span>
<a name="l01451"></a>01451             <span class="comment">//                if( Armour[ pItem-&gt;ubClassIndex ].ubArmourClass == ARMOURCLASS_LEGGINGS &amp;&amp; Armour[ pItem-&gt;ubClassIndex ].ubProtection &gt;= 10 )</span>
<a name="l01452"></a>01452             <span class="comment">//                {</span>
<a name="l01453"></a>01453             <span class="comment">//                      if( usRandom )</span>
<a name="l01454"></a>01454             <span class="comment">//                            usRandom--;</span>
<a name="l01455"></a>01455             <span class="comment">//                      else</span>
<a name="l01456"></a>01456             <span class="comment">//                      {</span>
<a name="l01457"></a>01457             <span class="comment">//                            if( !(pp-&gt;Inv[ LEGPOS ].fFlags &amp; OBJECT_NO_OVERWRITE) )</span>
<a name="l01458"></a>01458             <span class="comment">//                            {</span>
<a name="l01459"></a>01459             <span class="comment">//                                  CreateItem( i, (INT8)(70+Random(31)), &amp;(pp-&gt;Inv[ LEGPOS ]) );</span>
<a name="l01460"></a>01460             <span class="comment">//                                  pp-&gt;Inv[ LEGPOS ].fFlags |= OBJECT_UNDROPPABLE;</span>
<a name="l01461"></a>01461             <span class="comment">//                                  break;</span>
<a name="l01462"></a>01462             <span class="comment">//                            }</span>
<a name="l01463"></a>01463             <span class="comment">//                      }</span>
<a name="l01464"></a>01464             <span class="comment">//                }</span>
<a name="l01465"></a>01465             <span class="comment">//          }</span>
<a name="l01466"></a>01466             <span class="comment">//    }</span>
<a name="l01467"></a>01467             <span class="comment">//}</span>
<a name="l01468"></a>01468       }
<a name="l01469"></a>01469 }
<a name="l01470"></a>01470 
<a name="l01471"></a><a class="code" href="Inventory_01Choosing_8h.html#459b87930a63962d48b3a322b0ff4aa3">01471</a> <span class="keywordtype">void</span> <a class="code" href="Inventory_01Choosing_8cpp.html#459b87930a63962d48b3a322b0ff4aa3">ChooseSpecialWeaponsForSoldierCreateStruct</a>( <a class="code" href="structSOLDIERCREATE__STRUCT.html">SOLDIERCREATE_STRUCT</a> *pp, <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bKnifeClass, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fGrenadeLauncher, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fLAW, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fMortar, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fRPG )
<a name="l01472"></a>01472 {
<a name="l01473"></a>01473       DebugMsg (TOPIC_JA2,DBG_LEVEL_3,<span class="stringliteral">"ChooseSpecialWeaponsForSoldierCreateStruct"</span>);
<a name="l01474"></a>01474       <span class="comment">//UINT16 i;</span>
<a name="l01475"></a>01475       <span class="comment">//INVTYPE *pItem;</span>
<a name="l01476"></a>01476       <span class="comment">//UINT16 usRandom;</span>
<a name="l01477"></a>01477       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usNumMatches = 0;
<a name="l01478"></a>01478       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usKnifeIndex = 0;
<a name="l01479"></a>01479       <a class="code" href="structOBJECTTYPE.html">OBJECTTYPE</a> Object;
<a name="l01480"></a>01480 
<a name="l01481"></a>01481       <a class="code" href="Inventory_01Choosing_8cpp.html#6c873614bbc1a238e64d251869b9d58d">itemGrenadeLauncher</a> = 0;
<a name="l01482"></a>01482       <a class="code" href="Inventory_01Choosing_8cpp.html#334a50c6a2cca7fc7a50437bab467cc5">itemLAW</a> = 0;
<a name="l01483"></a>01483       <a class="code" href="Inventory_01Choosing_8cpp.html#ae704b4d20efa38b25703ad586ecf2cc">itemRPG</a> = 0;
<a name="l01484"></a>01484       <a class="code" href="Inventory_01Choosing_8cpp.html#2d7083e8d574d45cc0ad92a135f59a6a">itemMortar</a>=0;
<a name="l01485"></a>01485 
<a name="l01486"></a>01486       <span class="comment">//Choose knife</span>
<a name="l01487"></a>01487       <span class="comment">//while( bKnifeClass &amp;&amp; !usNumMatches )</span>
<a name="l01488"></a>01488       <span class="comment">//{ //First step is to count the number of weapons in the weapon class range.  If we</span>
<a name="l01489"></a>01489       <span class="comment">//    //don't find one, we keep lowering the class until we do.</span>
<a name="l01490"></a>01490       <span class="comment">//    for( i = 0; i &lt; MAXITEMS; i++ )</span>
<a name="l01491"></a>01491       <span class="comment">//    {</span>
<a name="l01492"></a>01492       <span class="comment">//          if ( Item[i].usItemClass  == 0 )</span>
<a name="l01493"></a>01493       <span class="comment">//                break;</span>
<a name="l01494"></a>01494       <span class="comment">//          pItem = &amp;Item[ i ];</span>
<a name="l01495"></a>01495       <span class="comment">//          if( ( pItem-&gt;usItemClass == IC_BLADE || pItem-&gt;usItemClass == IC_THROWING_KNIFE ) &amp;&amp; pItem-&gt;ubCoolness == bKnifeClass )</span>
<a name="l01496"></a>01496       <span class="comment">//          {</span>
<a name="l01497"></a>01497       <span class="comment">//                usNumMatches++;</span>
<a name="l01498"></a>01498       <span class="comment">//          }</span>
<a name="l01499"></a>01499       <span class="comment">//    }</span>
<a name="l01500"></a>01500       <span class="comment">//    if( !usNumMatches )</span>
<a name="l01501"></a>01501       <span class="comment">//          bKnifeClass--;</span>
<a name="l01502"></a>01502       <span class="comment">//}</span>
<a name="l01503"></a>01503       <span class="comment">//if( usNumMatches )</span>
<a name="l01504"></a>01504       <span class="comment">//{ //There is a knife that we can choose.</span>
<a name="l01505"></a>01505       <span class="comment">//    usRandom = (UINT16)Random( usNumMatches );</span>
<a name="l01506"></a>01506       <span class="comment">//    for( i = 0; i &lt; MAXITEMS; i++ )</span>
<a name="l01507"></a>01507       <span class="comment">//    {</span>
<a name="l01508"></a>01508       <span class="comment">//          if ( Item[i].usItemClass  == 0 )</span>
<a name="l01509"></a>01509       <span class="comment">//                break;</span>
<a name="l01510"></a>01510       <span class="comment">//          pItem = &amp;Item[ i ];</span>
<a name="l01511"></a>01511       <span class="comment">//          if( ( pItem-&gt;usItemClass == IC_BLADE || pItem-&gt;usItemClass == IC_THROWING_KNIFE ) &amp;&amp; pItem-&gt;ubCoolness == bKnifeClass )</span>
<a name="l01512"></a>01512       <span class="comment">//          {</span>
<a name="l01513"></a>01513       <span class="comment">//                if( usRandom )</span>
<a name="l01514"></a>01514       <span class="comment">//                      usRandom--;</span>
<a name="l01515"></a>01515       <span class="comment">//                else</span>
<a name="l01516"></a>01516       <span class="comment">//                {</span>
<a name="l01517"></a>01517       <span class="comment">//                      usKnifeIndex = i;</span>
<a name="l01518"></a>01518       <span class="comment">//                      break;</span>
<a name="l01519"></a>01519       <span class="comment">//                }</span>
<a name="l01520"></a>01520       <span class="comment">//          }</span>
<a name="l01521"></a>01521       <span class="comment">//    }</span>
<a name="l01522"></a>01522       <span class="comment">//}</span>
<a name="l01523"></a>01523 
<a name="l01524"></a>01524       <span class="keywordflow">if</span> ( bKnifeClass )
<a name="l01525"></a>01525       {
<a name="l01526"></a>01526             usKnifeIndex = <a class="code" href="Inventory_01Choosing_8cpp.html#661ec86e3a255acaad87210de3b4b24d">PickARandomItem</a>(<a class="code" href="Inventory_01Choosing_8h.html#85d881cb3816f77e92c1c8f721b54fc4e90d36fc13914ca5e1a1aa42c0625c44">KNIVES</a>,bKnifeClass);
<a name="l01527"></a>01527 
<a name="l01528"></a>01528             <span class="keywordflow">if</span>( usKnifeIndex &gt; 0 )
<a name="l01529"></a>01529             {
<a name="l01530"></a>01530                   <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( usKnifeIndex, (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)(70 + <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 31 )), &amp;Object );
<a name="l01531"></a>01531                   Object.<a class="code" href="structOBJECTTYPE.html#0f1e67bac22f1b89c4040ef8a5ea48c2">fFlags</a> |= OBJECT_UNDROPPABLE;
<a name="l01532"></a>01532                   <a class="code" href="Inventory_01Choosing_8cpp.html#b427f7649fc2e022ea435eafc3737008">PlaceObjectInSoldierCreateStruct</a>( pp, &amp;Object );
<a name="l01533"></a>01533             }
<a name="l01534"></a>01534       }
<a name="l01535"></a>01535 
<a name="l01536"></a>01536 <span class="comment"></span>
<a name="l01537"></a>01537 <span class="comment">////test code</span>
<a name="l01538"></a>01538 <span class="comment"></span><span class="comment">//          CreateItem( 347, (INT8)(50 + Random( 51 )), &amp;Object );</span>
<a name="l01539"></a>01539 <span class="comment">//          PlaceObjectInSoldierCreateStruct( pp, &amp;Object );</span>
<a name="l01540"></a>01540 <span class="comment">//</span>
<a name="l01541"></a>01541 <span class="comment">//          CreateItem( 298, (INT8)(50 + Random( 51 )), &amp;Object );</span>
<a name="l01542"></a>01542 <span class="comment">//          PlaceObjectInSoldierCreateStruct( pp, &amp;Object );</span>
<a name="l01543"></a>01543 <span class="comment">//</span>
<a name="l01544"></a>01544 <span class="comment">//          CreateItem( 298, (INT8)(50 + Random( 51 )), &amp;Object );</span>
<a name="l01545"></a>01545 <span class="comment">//          PlaceObjectInSoldierCreateStruct( pp, &amp;Object );</span>
<a name="l01546"></a>01546 
<a name="l01547"></a>01547       <span class="keywordflow">if</span> ( <a class="code" href="Items_8cpp.html#a71edef11b5b44ceeaa1030c3a758db2">IsGrenadeLauncherAttached</a>(&amp;pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[<a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855408e678e638d95e18d5e9a2a64a96e2e">HANDPOS</a>]) ) <span class="comment">//Madd: if there's a grenade launcher attached to the gun, then use that instead of giving him another one</span>
<a name="l01548"></a>01548       {
<a name="l01549"></a>01549             <a class="code" href="Inventory_01Choosing_8cpp.html#6c873614bbc1a238e64d251869b9d58d">itemGrenadeLauncher</a> = <a class="code" href="Items_8cpp.html#7cb1bfb4454c9fec31dc641a715f6756">GetAttachedGrenadeLauncher</a>(&amp;pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[<a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855408e678e638d95e18d5e9a2a64a96e2e">HANDPOS</a>]);
<a name="l01550"></a>01550       }
<a name="l01551"></a>01551       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fGrenadeLauncher)
<a name="l01552"></a>01552       {
<a name="l01553"></a>01553             <a class="code" href="Inventory_01Choosing_8cpp.html#6c873614bbc1a238e64d251869b9d58d">itemGrenadeLauncher</a> = <a class="code" href="Inventory_01Choosing_8cpp.html#661ec86e3a255acaad87210de3b4b24d">PickARandomItem</a> ( <a class="code" href="Inventory_01Choosing_8h.html#85d881cb3816f77e92c1c8f721b54fc449b1b32bcee004b7712c9b9e017c8dbf">GRENADELAUNCHER</a> );
<a name="l01554"></a>01554             <span class="comment">// give grenade launcher</span>
<a name="l01555"></a>01555             <span class="keywordflow">if</span> ( <a class="code" href="Inventory_01Choosing_8cpp.html#6c873614bbc1a238e64d251869b9d58d">itemGrenadeLauncher</a> &gt; 0 )
<a name="l01556"></a>01556             {
<a name="l01557"></a>01557                   <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( <a class="code" href="Inventory_01Choosing_8cpp.html#6c873614bbc1a238e64d251869b9d58d">itemGrenadeLauncher</a>, (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)(50 + <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 51 )), &amp;Object );
<a name="l01558"></a>01558                   Object.<a class="code" href="structOBJECTTYPE.html#0f1e67bac22f1b89c4040ef8a5ea48c2">fFlags</a> |= OBJECT_UNDROPPABLE;
<a name="l01559"></a>01559                   <a class="code" href="Inventory_01Choosing_8cpp.html#b427f7649fc2e022ea435eafc3737008">PlaceObjectInSoldierCreateStruct</a>( pp, &amp;Object );
<a name="l01560"></a>01560             }
<a name="l01561"></a>01561       }
<a name="l01562"></a>01562 
<a name="l01563"></a>01563       <span class="keywordflow">if</span> (fLAW)
<a name="l01564"></a>01564       {
<a name="l01565"></a>01565             <span class="comment">// give rocket launcher</span>
<a name="l01566"></a>01566             <a class="code" href="Inventory_01Choosing_8cpp.html#334a50c6a2cca7fc7a50437bab467cc5">itemLAW</a> = <a class="code" href="Inventory_01Choosing_8cpp.html#661ec86e3a255acaad87210de3b4b24d">PickARandomItem</a> (<a class="code" href="Inventory_01Choosing_8h.html#85d881cb3816f77e92c1c8f721b54fc44071931fa71f92a01b6da770e6964c5a">SINGLESHOTROCKETLAUNCHER</a>);
<a name="l01567"></a>01567             <span class="keywordflow">if</span> ( <a class="code" href="Inventory_01Choosing_8cpp.html#334a50c6a2cca7fc7a50437bab467cc5">itemLAW</a> &gt; 0 )
<a name="l01568"></a>01568             {
<a name="l01569"></a>01569                   <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( <a class="code" href="Inventory_01Choosing_8cpp.html#334a50c6a2cca7fc7a50437bab467cc5">itemLAW</a>, (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)(50 + <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 51 )), &amp;Object );
<a name="l01570"></a>01570                   Object.<a class="code" href="structOBJECTTYPE.html#0f1e67bac22f1b89c4040ef8a5ea48c2">fFlags</a> |= OBJECT_UNDROPPABLE;
<a name="l01571"></a>01571                   <a class="code" href="Inventory_01Choosing_8cpp.html#b427f7649fc2e022ea435eafc3737008">PlaceObjectInSoldierCreateStruct</a>( pp, &amp;Object );
<a name="l01572"></a>01572             }
<a name="l01573"></a>01573       }
<a name="l01574"></a>01574       <span class="keywordflow">if</span> (fRPG)
<a name="l01575"></a>01575       {
<a name="l01576"></a>01576             <span class="comment">// give rpg</span>
<a name="l01577"></a>01577             <a class="code" href="Inventory_01Choosing_8cpp.html#ae704b4d20efa38b25703ad586ecf2cc">itemRPG</a> = <a class="code" href="Inventory_01Choosing_8cpp.html#661ec86e3a255acaad87210de3b4b24d">PickARandomItem</a> (<a class="code" href="Inventory_01Choosing_8h.html#85d881cb3816f77e92c1c8f721b54fc43792b28e6b4689c5858520c1df36e722">ROCKETLAUNCHER</a>);
<a name="l01578"></a>01578             <span class="keywordflow">if</span> ( <a class="code" href="Inventory_01Choosing_8cpp.html#ae704b4d20efa38b25703ad586ecf2cc">itemRPG</a> &gt; 0 )
<a name="l01579"></a>01579             {
<a name="l01580"></a>01580                   <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( <a class="code" href="Inventory_01Choosing_8cpp.html#ae704b4d20efa38b25703ad586ecf2cc">itemRPG</a>, (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)(50 + <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 51 )), &amp;Object );
<a name="l01581"></a>01581                   Object.<a class="code" href="structOBJECTTYPE.html#0f1e67bac22f1b89c4040ef8a5ea48c2">fFlags</a> |= OBJECT_UNDROPPABLE;
<a name="l01582"></a>01582                   <a class="code" href="Inventory_01Choosing_8cpp.html#b427f7649fc2e022ea435eafc3737008">PlaceObjectInSoldierCreateStruct</a>( pp, &amp;Object );
<a name="l01583"></a>01583             }
<a name="l01584"></a>01584       }
<a name="l01585"></a>01585 
<a name="l01586"></a>01586       <span class="keywordflow">if</span> (fMortar)
<a name="l01587"></a>01587       {
<a name="l01588"></a>01588             <span class="comment">// make sure we're not distributing them underground!</span>
<a name="l01589"></a>01589             Assert( <a class="code" href="Auto_01Resolve_8h.html#4753f4fa3d21585d4f721d7deba0cc0e">IsAutoResolveActive</a>() || ( <a class="code" href="strategicmap_8cpp.html#da715721a8ceedd42acf6ddb33e63ce0">gbWorldSectorZ</a> == 0 ) );
<a name="l01590"></a>01590 
<a name="l01591"></a>01591             <span class="comment">// give mortar</span>
<a name="l01592"></a>01592             <a class="code" href="Inventory_01Choosing_8cpp.html#2d7083e8d574d45cc0ad92a135f59a6a">itemMortar</a> = <a class="code" href="Inventory_01Choosing_8cpp.html#661ec86e3a255acaad87210de3b4b24d">PickARandomItem</a> (<a class="code" href="Inventory_01Choosing_8h.html#85d881cb3816f77e92c1c8f721b54fc4582e12c8c257bca70e19d2d0d1494b22">MORTARLAUNCHER</a>);
<a name="l01593"></a>01593             <span class="keywordflow">if</span> ( <a class="code" href="Inventory_01Choosing_8cpp.html#2d7083e8d574d45cc0ad92a135f59a6a">itemMortar</a> &gt; 0 )
<a name="l01594"></a>01594             {
<a name="l01595"></a>01595                   <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( <a class="code" href="Inventory_01Choosing_8cpp.html#2d7083e8d574d45cc0ad92a135f59a6a">itemMortar</a>, (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)(50 + <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 51 )), &amp;Object );
<a name="l01596"></a>01596                   Object.<a class="code" href="structOBJECTTYPE.html#0f1e67bac22f1b89c4040ef8a5ea48c2">fFlags</a> |= OBJECT_UNDROPPABLE;
<a name="l01597"></a>01597                   <a class="code" href="Inventory_01Choosing_8cpp.html#b427f7649fc2e022ea435eafc3737008">PlaceObjectInSoldierCreateStruct</a>( pp, &amp;Object );
<a name="l01598"></a>01598             }
<a name="l01599"></a>01599       }
<a name="l01600"></a>01600 
<a name="l01601"></a>01601 
<a name="l01602"></a>01602 }
<a name="l01603"></a>01603 
<a name="l01604"></a>01604 
<a name="l01605"></a><a class="code" href="Inventory_01Choosing_8h.html#2c8b036efd74c74aef341a0b3e587431">01605</a> <span class="keywordtype">void</span> <a class="code" href="Inventory_01Choosing_8cpp.html#2c8b036efd74c74aef341a0b3e587431">ChooseFaceGearForSoldierCreateStruct</a>( <a class="code" href="structSOLDIERCREATE__STRUCT.html">SOLDIERCREATE_STRUCT</a> *pp )
<a name="l01606"></a>01606 {
<a name="l01607"></a>01607       DebugMsg (TOPIC_JA2,DBG_LEVEL_3,<span class="stringliteral">"ChooseFaceGearForSoldierCreateStruct"</span>);
<a name="l01608"></a>01608       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> i;
<a name="l01609"></a>01609       <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bDifficultyRating = <a class="code" href="Soldier_01Create_8cpp.html#433ca5a6b48ed78de02acdf1408198b5">CalcDifficultyModifier</a>( pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#8c94f66e6fe51672802ee1ea24dddf07">ubSoldierClass</a> );
<a name="l01610"></a>01610       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usItem=0;
<a name="l01611"></a>01611 
<a name="l01612"></a>01612       <span class="keywordflow">if</span> ( <a class="code" href="strategicmap_8cpp.html#49d9aed144a633fda4ba1990f002d703">gWorldSectorX</a> == TIXA_SECTOR_X &amp;&amp; <a class="code" href="strategicmap_8cpp.html#ea322310ced0e35ee18a2ee7b32aac5b">gWorldSectorY</a> == TIXA_SECTOR_Y &amp;&amp; <a class="code" href="strategic_8cpp.html#6f48fb0ea28e3d4889423290f1a6ede8">StrategicMap</a>[ TIXA_SECTOR_X + TIXA_SECTOR_Y * MAP_WORLD_X ].fEnemyControlled )
<a name="l01613"></a>01613       { <span class="comment">//Tixa is a special case that is handled differently.</span>
<a name="l01614"></a>01614             <span class="keywordflow">return</span>;
<a name="l01615"></a>01615       }
<a name="l01616"></a>01616 
<a name="l01617"></a>01617       <span class="comment">//Look for any face item in the big pocket positions (the only place they can be added in the editor)</span>
<a name="l01618"></a>01618       <span class="comment">//If any are found, then don't assign any</span>
<a name="l01619"></a>01619       <span class="keywordflow">for</span>( i = <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc8785521434ace88498823088a193622a0ab42">BIGPOCK1POS</a>; i &lt; <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc8785571ec5bde48a89e74cbbb81af98298a4f">BIGPOCK4POS</a>; i++ )
<a name="l01620"></a>01620       {
<a name="l01621"></a>01621             <span class="keywordflow">if</span>( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ i ].<a class="code" href="structOBJECTTYPE.html#4fbe05335f161f08f354566b8e5a0a19">usItem</a> ].usItemClass == IC_FACE ) 
<a name="l01622"></a>01622             {
<a name="l01623"></a>01623                   <span class="keywordflow">return</span>;
<a name="l01624"></a>01624             }
<a name="l01625"></a>01625       }
<a name="l01626"></a>01626 
<a name="l01627"></a>01627       <span class="comment">//KM: (NEW)</span>
<a name="l01628"></a>01628       <span class="comment">//Note the lack of overwritable item checking here.  This is because faceitems are not</span>
<a name="l01629"></a>01629       <span class="comment">//supported in the editor, hence they can't have this status.</span>
<a name="l01630"></a>01630       <span class="keywordflow">switch</span>( pp-&gt;ubSoldierClass )
<a name="l01631"></a>01631       {
<a name="l01632"></a>01632             <span class="keywordflow">case</span> <a class="code" href="Soldier_01Control_8h.html#d559b3ed307be626eacea8b56942de61a3398ebdb00774b852a6dc6a1ba38764">SOLDIER_CLASS_ELITE</a>:
<a name="l01633"></a>01633             <span class="keywordflow">case</span> <a class="code" href="Soldier_01Control_8h.html#d559b3ed307be626eacea8b56942de61f2c9f1bbece4a7bd58b4a83a54dac6b6">SOLDIER_CLASS_ELITE_MILITIA</a>:
<a name="l01634"></a>01634                   <span class="comment">//All elites get a gasmask and either night goggles or uv goggles.</span>
<a name="l01635"></a>01635                   <span class="keywordflow">if</span>( <a class="code" href="Random_8cpp.html#742221657b584d8416ada22fa8ff23dd">Chance</a>( 75 ) )
<a name="l01636"></a>01636                   {
<a name="l01637"></a>01637                         usItem = <a class="code" href="Inventory_01Choosing_8cpp.html#661ec86e3a255acaad87210de3b4b24d">PickARandomItem</a>(<a class="code" href="Inventory_01Choosing_8h.html#85d881cb3816f77e92c1c8f721b54fc47b7516dca54351967c8403746feef1d8">GASMASKS</a>);
<a name="l01638"></a>01638                         <span class="keywordflow">if</span> ( usItem &gt; 0 )
<a name="l01639"></a>01639                         {
<a name="l01640"></a>01640                               <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( usItem, (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)(70+<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(31)), &amp;(pp-&gt;Inv[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855f026c5ea0db4ce18b3830d0c503fea79">HEAD1POS</a> ]) );
<a name="l01641"></a>01641                               pp-&gt;Inv[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855f026c5ea0db4ce18b3830d0c503fea79">HEAD1POS</a> ].fFlags |= OBJECT_UNDROPPABLE;
<a name="l01642"></a>01642                         }
<a name="l01643"></a>01643                   }
<a name="l01644"></a>01644                   <span class="keywordflow">else</span>
<a name="l01645"></a>01645                   {
<a name="l01646"></a>01646                         usItem = <a class="code" href="Inventory_01Choosing_8cpp.html#661ec86e3a255acaad87210de3b4b24d">PickARandomItem</a>(<a class="code" href="Inventory_01Choosing_8h.html#85d881cb3816f77e92c1c8f721b54fc4b7ef3a264a812ddb134ea69e65b9b77f">HEARINGAIDS</a>);
<a name="l01647"></a>01647                         <span class="keywordflow">if</span> ( usItem &gt; 0 )
<a name="l01648"></a>01648                         {
<a name="l01649"></a>01649                               <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( usItem, (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)(70+<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(31)), &amp;(pp-&gt;Inv[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855f026c5ea0db4ce18b3830d0c503fea79">HEAD1POS</a> ]) );
<a name="l01650"></a>01650                               pp-&gt;Inv[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855f026c5ea0db4ce18b3830d0c503fea79">HEAD1POS</a> ].fFlags |= OBJECT_UNDROPPABLE;
<a name="l01651"></a>01651                         }
<a name="l01652"></a>01652                   }
<a name="l01653"></a>01653                   <span class="keywordflow">if</span>( <a class="code" href="Random_8cpp.html#742221657b584d8416ada22fa8ff23dd">Chance</a>( 75 ) )
<a name="l01654"></a>01654                   {
<a name="l01655"></a>01655                         usItem = <a class="code" href="Inventory_01Choosing_8cpp.html#661ec86e3a255acaad87210de3b4b24d">PickARandomItem</a>(<a class="code" href="Inventory_01Choosing_8h.html#85d881cb3816f77e92c1c8f721b54fc4ef0cf78ec6117d3ab32d96a0199a0cf1">NVGLOW</a>);
<a name="l01656"></a>01656                         <span class="keywordflow">if</span> ( usItem &gt; 0 )
<a name="l01657"></a>01657                         {
<a name="l01658"></a>01658                               <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( usItem, (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)(70+<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(31)), &amp;(pp-&gt;Inv[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc878557e4acf2c955802ba2a98a2bcb522ae70">HEAD2POS</a> ]) );
<a name="l01659"></a>01659                               pp-&gt;Inv[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc878557e4acf2c955802ba2a98a2bcb522ae70">HEAD2POS</a> ].fFlags |= OBJECT_UNDROPPABLE;
<a name="l01660"></a>01660                         }
<a name="l01661"></a>01661                   }
<a name="l01662"></a>01662                   <span class="keywordflow">else</span>
<a name="l01663"></a>01663                   {
<a name="l01664"></a>01664                         usItem = <a class="code" href="Inventory_01Choosing_8cpp.html#661ec86e3a255acaad87210de3b4b24d">PickARandomItem</a>(<a class="code" href="Inventory_01Choosing_8h.html#85d881cb3816f77e92c1c8f721b54fc4bbb37e4c8facff64ace8b888b6e12ee8">NVGHIGH</a>);
<a name="l01665"></a>01665                         <span class="keywordflow">if</span> ( usItem &gt; 0 )
<a name="l01666"></a>01666                         {
<a name="l01667"></a>01667                               <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( usItem, (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)(70+<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(31)), &amp;(pp-&gt;Inv[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc878557e4acf2c955802ba2a98a2bcb522ae70">HEAD2POS</a> ]) );
<a name="l01668"></a>01668                               pp-&gt;Inv[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc878557e4acf2c955802ba2a98a2bcb522ae70">HEAD2POS</a> ].fFlags |= OBJECT_UNDROPPABLE;
<a name="l01669"></a>01669                         }
<a name="l01670"></a>01670                   }
<a name="l01671"></a>01671                   <span class="keywordflow">break</span>;
<a name="l01672"></a>01672             <span class="keywordflow">case</span> <a class="code" href="Soldier_01Control_8h.html#d559b3ed307be626eacea8b56942de61e155251ca19fc71034c52119253642b8">SOLDIER_CLASS_ARMY</a>:
<a name="l01673"></a>01673             <span class="keywordflow">case</span> <a class="code" href="Soldier_01Control_8h.html#d559b3ed307be626eacea8b56942de610534cbb3d918376e9f10be3bf049666e">SOLDIER_CLASS_REG_MILITIA</a>:
<a name="l01674"></a>01674                   <span class="keywordflow">if</span>( <a class="code" href="Random_8cpp.html#742221657b584d8416ada22fa8ff23dd">Chance</a>( bDifficultyRating / 2 ) )
<a name="l01675"></a>01675                   { <span class="comment">//chance of getting a face item</span>
<a name="l01676"></a>01676                         <span class="keywordflow">if</span>( <a class="code" href="Random_8cpp.html#742221657b584d8416ada22fa8ff23dd">Chance</a>( 50 ) )
<a name="l01677"></a>01677                         {
<a name="l01678"></a>01678                               usItem = <a class="code" href="Inventory_01Choosing_8cpp.html#661ec86e3a255acaad87210de3b4b24d">PickARandomItem</a>(<a class="code" href="Inventory_01Choosing_8h.html#85d881cb3816f77e92c1c8f721b54fc47b7516dca54351967c8403746feef1d8">GASMASKS</a>);
<a name="l01679"></a>01679                               <span class="keywordflow">if</span> ( usItem &gt; 0 )
<a name="l01680"></a>01680                               {
<a name="l01681"></a>01681                                     <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( usItem, (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)(70+<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(31)), &amp;(pp-&gt;Inv[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855f026c5ea0db4ce18b3830d0c503fea79">HEAD1POS</a> ]) );
<a name="l01682"></a>01682                                     pp-&gt;Inv[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855f026c5ea0db4ce18b3830d0c503fea79">HEAD1POS</a> ].fFlags |= OBJECT_UNDROPPABLE;
<a name="l01683"></a>01683                               }
<a name="l01684"></a>01684                         }
<a name="l01685"></a>01685                         <span class="keywordflow">else</span>
<a name="l01686"></a>01686                         {
<a name="l01687"></a>01687                               usItem = <a class="code" href="Inventory_01Choosing_8cpp.html#661ec86e3a255acaad87210de3b4b24d">PickARandomItem</a>(<a class="code" href="Inventory_01Choosing_8h.html#85d881cb3816f77e92c1c8f721b54fc4ef0cf78ec6117d3ab32d96a0199a0cf1">NVGLOW</a>);
<a name="l01688"></a>01688                               <span class="keywordflow">if</span> ( usItem &gt; 0 )
<a name="l01689"></a>01689                               {
<a name="l01690"></a>01690                                     <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( usItem, (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)(70+<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(31)), &amp;(pp-&gt;Inv[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855f026c5ea0db4ce18b3830d0c503fea79">HEAD1POS</a> ]) );
<a name="l01691"></a>01691                                     pp-&gt;Inv[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc878557e4acf2c955802ba2a98a2bcb522ae70">HEAD2POS</a> ].fFlags |= OBJECT_UNDROPPABLE;
<a name="l01692"></a>01692                               }
<a name="l01693"></a>01693                         }
<a name="l01694"></a>01694                   }
<a name="l01695"></a>01695                   <span class="keywordflow">if</span>( <a class="code" href="Random_8cpp.html#742221657b584d8416ada22fa8ff23dd">Chance</a>( bDifficultyRating / 3 ) )
<a name="l01696"></a>01696                   { <span class="comment">//chance of getting a extended ear</span>
<a name="l01697"></a>01697                         usItem = <a class="code" href="Inventory_01Choosing_8cpp.html#661ec86e3a255acaad87210de3b4b24d">PickARandomItem</a>(<a class="code" href="Inventory_01Choosing_8h.html#85d881cb3816f77e92c1c8f721b54fc4b7ef3a264a812ddb134ea69e65b9b77f">HEARINGAIDS</a>);
<a name="l01698"></a>01698                         <span class="keywordflow">if</span> ( usItem &gt; 0 )
<a name="l01699"></a>01699                         {
<a name="l01700"></a>01700                               <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( usItem, (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)(70+<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(31)), &amp;(pp-&gt;Inv[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc878557e4acf2c955802ba2a98a2bcb522ae70">HEAD2POS</a> ]) );
<a name="l01701"></a>01701                               pp-&gt;Inv[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc878557e4acf2c955802ba2a98a2bcb522ae70">HEAD2POS</a> ].fFlags |= OBJECT_UNDROPPABLE;
<a name="l01702"></a>01702                         }
<a name="l01703"></a>01703                   }
<a name="l01704"></a>01704                   <span class="keywordflow">break</span>;
<a name="l01705"></a>01705             <span class="keywordflow">case</span> <a class="code" href="Soldier_01Control_8h.html#d559b3ed307be626eacea8b56942de61b149e8fdf658384dd176ef9e706f10dd">SOLDIER_CLASS_ADMINISTRATOR</a>:
<a name="l01706"></a>01706             <span class="keywordflow">case</span> <a class="code" href="Soldier_01Control_8h.html#d559b3ed307be626eacea8b56942de615d87e4b53a22c14df589d9df96ddb0dc">SOLDIER_CLASS_GREEN_MILITIA</a>:
<a name="l01707"></a>01707                   <span class="keywordflow">break</span>;
<a name="l01708"></a>01708       }
<a name="l01709"></a>01709 }
<a name="l01710"></a>01710 
<a name="l01711"></a>01711 
<a name="l01712"></a>01712 
<a name="l01713"></a><a class="code" href="Inventory_01Choosing_8cpp.html#dec56b2d6d01cd758af90cea8cb0f05d">01713</a> <span class="keywordtype">void</span> <a class="code" href="Inventory_01Choosing_8cpp.html#dec56b2d6d01cd758af90cea8cb0f05d">ChooseKitsForSoldierCreateStruct</a>( <a class="code" href="structSOLDIERCREATE__STRUCT.html">SOLDIERCREATE_STRUCT</a> *pp, <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bKitClass )
<a name="l01714"></a>01714 {
<a name="l01715"></a>01715       DebugMsg (TOPIC_JA2,DBG_LEVEL_3,<span class="stringliteral">"ChooseKitsForSoldierCreateStruct"</span>);
<a name="l01716"></a>01716       <span class="comment">//UINT16 i;</span>
<a name="l01717"></a>01717       <span class="comment">//INVTYPE *pItem;</span>
<a name="l01718"></a>01718       <span class="comment">//UINT16 usRandom;</span>
<a name="l01719"></a>01719       <span class="comment">//UINT16 usNumMatches = 0;</span>
<a name="l01720"></a>01720       <a class="code" href="structOBJECTTYPE.html">OBJECTTYPE</a> Object;
<a name="l01721"></a>01721       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usKitItem = 0;
<a name="l01722"></a>01722 
<a name="l01723"></a>01723       <span class="comment">//Madd: specify kit items in xml instead</span>
<a name="l01724"></a>01724 
<a name="l01725"></a>01725       <span class="comment">// we want these mostly to be first aid and medical kits, and for those kit class doesn't matter, they're always useful</span>
<a name="l01726"></a>01726       <span class="comment">//if ( Chance( 50 ) )</span>
<a name="l01727"></a>01727       <span class="comment">//{</span>
<a name="l01728"></a>01728       <span class="comment">//    usKitItem = FIRSTAIDKIT;</span>
<a name="l01729"></a>01729       <span class="comment">//}</span>
<a name="l01730"></a>01730       <span class="comment">//else</span>
<a name="l01731"></a>01731       <span class="comment">//if ( Chance( 25 ) )</span>
<a name="l01732"></a>01732       <span class="comment">//{</span>
<a name="l01733"></a>01733       <span class="comment">//    usKitItem = MEDICKIT;</span>
<a name="l01734"></a>01734       <span class="comment">//}</span>
<a name="l01735"></a>01735       <span class="comment">//else</span>
<a name="l01736"></a>01736       <span class="comment">//{</span>
<a name="l01737"></a>01737       <span class="comment">//    // count how many non-medical KITS are eligible ( of sufficient or lower coolness)</span>
<a name="l01738"></a>01738       <span class="comment">//    for( i = 0; i &lt; MAXITEMS; i++ )</span>
<a name="l01739"></a>01739       <span class="comment">//    {</span>
<a name="l01740"></a>01740       <span class="comment">//          if ( Item[i].usItemClass  == 0 )</span>
<a name="l01741"></a>01741       <span class="comment">//                break;</span>
<a name="l01742"></a>01742       <span class="comment">//          pItem = &amp;Item[ i ];</span>
<a name="l01743"></a>01743       <span class="comment">//          // skip toolkits</span>
<a name="l01744"></a>01744       <span class="comment">//          if( ( pItem-&gt;usItemClass == IC_KIT ) &amp;&amp; ( pItem-&gt;ubCoolness &gt; 0 ) &amp;&amp; pItem-&gt;ubCoolness &lt;= bKitClass &amp;&amp; ( !Item[i].toolkit ) )</span>
<a name="l01745"></a>01745       <span class="comment">//          {</span>
<a name="l01746"></a>01746       <span class="comment">//                usNumMatches++;</span>
<a name="l01747"></a>01747       <span class="comment">//          }</span>
<a name="l01748"></a>01748       <span class="comment">//    }</span>
<a name="l01749"></a>01749 
<a name="l01750"></a>01750       <span class="comment">//    // if any are eligible, pick one of them at random</span>
<a name="l01751"></a>01751       <span class="comment">//    if( usNumMatches )</span>
<a name="l01752"></a>01752       <span class="comment">//    {</span>
<a name="l01753"></a>01753       <span class="comment">//          usRandom = (UINT16)Random( usNumMatches );</span>
<a name="l01754"></a>01754       <span class="comment">//          for( i = 0; i &lt; MAXITEMS; i++ )</span>
<a name="l01755"></a>01755       <span class="comment">//          {</span>
<a name="l01756"></a>01756       <span class="comment">//                if ( Item[i].usItemClass  == 0 )</span>
<a name="l01757"></a>01757       <span class="comment">//                      break;</span>
<a name="l01758"></a>01758       <span class="comment">//                pItem = &amp;Item[ i ];</span>
<a name="l01759"></a>01759       <span class="comment">//                // skip toolkits</span>
<a name="l01760"></a>01760       <span class="comment">//                if( ( pItem-&gt;usItemClass == IC_KIT ) &amp;&amp; ( pItem-&gt;ubCoolness &gt; 0 ) &amp;&amp; pItem-&gt;ubCoolness &lt;= bKitClass &amp;&amp; ( !Item[i].toolkit ) )</span>
<a name="l01761"></a>01761       <span class="comment">//                {</span>
<a name="l01762"></a>01762       <span class="comment">//                      if( usRandom )</span>
<a name="l01763"></a>01763       <span class="comment">//                            usRandom--;</span>
<a name="l01764"></a>01764       <span class="comment">//                      else</span>
<a name="l01765"></a>01765       <span class="comment">//                      {</span>
<a name="l01766"></a>01766       <span class="comment">//                            usKitItem = i;</span>
<a name="l01767"></a>01767       <span class="comment">//                            break;</span>
<a name="l01768"></a>01768       <span class="comment">//                      }</span>
<a name="l01769"></a>01769       <span class="comment">//                }</span>
<a name="l01770"></a>01770       <span class="comment">//          }</span>
<a name="l01771"></a>01771       <span class="comment">//    }</span>
<a name="l01772"></a>01772       <span class="comment">//}</span>
<a name="l01773"></a>01773 
<a name="l01774"></a>01774       <span class="comment">// if we still want more medical and first aid kits, we can just add extras of those item #s to the array</span>
<a name="l01775"></a>01775       usKitItem = <a class="code" href="Inventory_01Choosing_8cpp.html#661ec86e3a255acaad87210de3b4b24d">PickARandomItem</a>( <a class="code" href="Inventory_01Choosing_8h.html#85d881cb3816f77e92c1c8f721b54fc4a99325161eeec040cb76479029b441ac">KIT</a> , bKitClass, FALSE ); 
<a name="l01776"></a>01776       <span class="keywordflow">if</span> ( usKitItem &gt; 0 )
<a name="l01777"></a>01777       {
<a name="l01778"></a>01778             <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( usKitItem, (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)(80 + <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 21 )), &amp;Object );
<a name="l01779"></a>01779             Object.<a class="code" href="structOBJECTTYPE.html#0f1e67bac22f1b89c4040ef8a5ea48c2">fFlags</a> |= OBJECT_UNDROPPABLE;
<a name="l01780"></a>01780             <a class="code" href="Inventory_01Choosing_8cpp.html#b427f7649fc2e022ea435eafc3737008">PlaceObjectInSoldierCreateStruct</a>( pp, &amp;Object );
<a name="l01781"></a>01781       }
<a name="l01782"></a>01782 }
<a name="l01783"></a>01783 
<a name="l01784"></a>01784 
<a name="l01785"></a><a class="code" href="Inventory_01Choosing_8cpp.html#7f5ace37f536ebc50c3c623aca7dedf1">01785</a> <span class="keywordtype">void</span> <a class="code" href="Inventory_01Choosing_8cpp.html#7f5ace37f536ebc50c3c623aca7dedf1">ChooseMiscGearForSoldierCreateStruct</a>( <a class="code" href="structSOLDIERCREATE__STRUCT.html">SOLDIERCREATE_STRUCT</a> *pp, <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bMiscClass )
<a name="l01786"></a>01786 {
<a name="l01787"></a>01787       DebugMsg (TOPIC_JA2,DBG_LEVEL_3,<span class="stringliteral">"ChooseMiscGearForSoldierCreateStruct"</span>);
<a name="l01788"></a>01788       <span class="comment">//UINT16 i;</span>
<a name="l01789"></a>01789       <span class="comment">//INVTYPE *pItem;</span>
<a name="l01790"></a>01790       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usRandom;
<a name="l01791"></a>01791       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usItem = 0;
<a name="l01792"></a>01792       <a class="code" href="structOBJECTTYPE.html">OBJECTTYPE</a> Object;
<a name="l01793"></a>01793 
<a name="l01794"></a>01794       <span class="comment">//Madd: let's do this a couple times, so we can have &gt; 1 misc item per soldier</span>
<a name="l01795"></a>01795       usRandom = <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(3);
<a name="l01796"></a>01796 
<a name="l01797"></a>01797       <span class="keywordflow">if</span> ( usRandom )
<a name="l01798"></a>01798       {
<a name="l01799"></a>01799             <span class="keywordflow">for</span> ( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> i=0;i&lt;usRandom;i++ )
<a name="l01800"></a>01800             {
<a name="l01801"></a>01801                   usItem = <a class="code" href="Inventory_01Choosing_8cpp.html#661ec86e3a255acaad87210de3b4b24d">PickARandomItem</a> (<a class="code" href="Inventory_01Choosing_8h.html#85d881cb3816f77e92c1c8f721b54fc4e0c17131e4a223d562667b4690197bb1">MISCITEMS</a> , bMiscClass, FALSE);
<a name="l01802"></a>01802                   <span class="keywordflow">if</span> ( usItem &gt; 0 )
<a name="l01803"></a>01803                   {
<a name="l01804"></a>01804                         <span class="keywordtype">int</span> bStatus = 80 + <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 21 );
<a name="l01805"></a>01805                         <span class="keywordflow">if</span> ( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usItem].usItemClass == IC_MONEY )
<a name="l01806"></a>01806                               bStatus = 1 + <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 20 );
<a name="l01807"></a>01807 
<a name="l01808"></a>01808                         <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( usItem, (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)(bStatus), &amp;Object );
<a name="l01809"></a>01809                         Object.<a class="code" href="structOBJECTTYPE.html#0f1e67bac22f1b89c4040ef8a5ea48c2">fFlags</a> |= OBJECT_UNDROPPABLE;
<a name="l01810"></a>01810                         <a class="code" href="Inventory_01Choosing_8cpp.html#b427f7649fc2e022ea435eafc3737008">PlaceObjectInSoldierCreateStruct</a>( pp, &amp;Object );
<a name="l01811"></a>01811                   }
<a name="l01812"></a>01812             }
<a name="l01813"></a>01813       }
<a name="l01814"></a>01814             
<a name="l01815"></a>01815       <span class="comment">// Madd: code above is externalized</span><span class="comment"></span>
<a name="l01816"></a>01816 <span class="comment">      //// not all of these are IC_MISC, some are IC_PUNCH (not covered anywhere else)</span>
<a name="l01817"></a>01817 <span class="comment"></span>      <span class="comment">//INT32 iMiscItemsList[] =</span>
<a name="l01818"></a>01818       <span class="comment">//{</span>
<a name="l01819"></a>01819       <span class="comment">//    CANTEEN,</span>
<a name="l01820"></a>01820       <span class="comment">//    CANTEEN,</span>
<a name="l01821"></a>01821       <span class="comment">//    CANTEEN,</span>
<a name="l01822"></a>01822       <span class="comment">//    CANTEEN,</span>
<a name="l01823"></a>01823       <span class="comment">//    ALCOHOL,</span>
<a name="l01824"></a>01824       <span class="comment">//    ALCOHOL,</span>
<a name="l01825"></a>01825       <span class="comment">//    ADRENALINE_BOOSTER,</span>
<a name="l01826"></a>01826       <span class="comment">//    ADRENALINE_BOOSTER,</span>
<a name="l01827"></a>01827       <span class="comment">//    REGEN_BOOSTER,</span>
<a name="l01828"></a>01828       <span class="comment">//    BRASS_KNUCKLES,</span>
<a name="l01829"></a>01829       <span class="comment">//    CHEWING_GUM,</span>
<a name="l01830"></a>01830       <span class="comment">//    CIGARS,</span>
<a name="l01831"></a>01831       <span class="comment">//    GOLDWATCH,</span>
<a name="l01832"></a>01832       <span class="comment">//    -1</span>
<a name="l01833"></a>01833       <span class="comment">//};</span>
<a name="l01834"></a>01834 
<a name="l01835"></a>01835 <span class="comment"></span>
<a name="l01836"></a>01836 <span class="comment">      //// count how many are eligible</span>
<a name="l01837"></a>01837 <span class="comment"></span>      <span class="comment">//i = 0;</span>
<a name="l01838"></a>01838       <span class="comment">//while ( iMiscItemsList[ i ] != -1 )</span>
<a name="l01839"></a>01839       <span class="comment">//{</span>
<a name="l01840"></a>01840       <span class="comment">//    pItem = &amp;Item[ iMiscItemsList [ i ] ];</span>
<a name="l01841"></a>01841       <span class="comment">//    if( ( pItem-&gt;ubCoolness &gt; 0 ) &amp;&amp; ( pItem-&gt;ubCoolness &lt;= bMiscClass ) )</span>
<a name="l01842"></a>01842       <span class="comment">//    {</span>
<a name="l01843"></a>01843       <span class="comment">//          // exclude REGEN_BOOSTERs unless Sci-Fi flag is on</span>
<a name="l01844"></a>01844       <span class="comment">//          if ( ( iMiscItemsList [ i ] != REGEN_BOOSTER ) || ( gGameOptions.ubGameStyle == STYLE_SCIFI ) )</span>
<a name="l01845"></a>01845       <span class="comment">//          {</span>
<a name="l01846"></a>01846       <span class="comment">//                usNumMatches++;</span>
<a name="l01847"></a>01847       <span class="comment">//          }</span>
<a name="l01848"></a>01848       <span class="comment">//    }</span>
<a name="l01849"></a>01849 
<a name="l01850"></a>01850       <span class="comment">//    i++;</span>
<a name="l01851"></a>01851       <span class="comment">//}</span>
<a name="l01852"></a>01852 
<a name="l01853"></a>01853 <span class="comment"></span>
<a name="l01854"></a>01854 <span class="comment">      //// if any are eligible, pick one of them at random</span>
<a name="l01855"></a>01855 <span class="comment"></span>      <span class="comment">//if( usNumMatches )</span>
<a name="l01856"></a>01856       <span class="comment">//{</span>
<a name="l01857"></a>01857       <span class="comment">//    usRandom = (UINT16)Random( usNumMatches );</span>
<a name="l01858"></a>01858 
<a name="l01859"></a>01859       <span class="comment">//    i = 0;</span>
<a name="l01860"></a>01860       <span class="comment">//    while ( iMiscItemsList[ i ] != -1 )</span>
<a name="l01861"></a>01861       <span class="comment">//    {</span>
<a name="l01862"></a>01862       <span class="comment">//          pItem = &amp;Item[ iMiscItemsList [ i ] ];</span>
<a name="l01863"></a>01863       <span class="comment">//          if( ( pItem-&gt;ubCoolness &gt; 0 ) &amp;&amp; ( pItem-&gt;ubCoolness &lt;= bMiscClass ) )</span>
<a name="l01864"></a>01864       <span class="comment">//          {</span>
<a name="l01865"></a>01865       <span class="comment">//                // exclude REGEN_BOOSTERs unless Sci-Fi flag is on</span>
<a name="l01866"></a>01866       <span class="comment">//                if ( ( iMiscItemsList [ i ] != REGEN_BOOSTER ) || ( gGameOptions.ubGameStyle == STYLE_SCIFI ) )</span>
<a name="l01867"></a>01867       <span class="comment">//                {</span>
<a name="l01868"></a>01868       <span class="comment">//                      if( usRandom )</span>
<a name="l01869"></a>01869       <span class="comment">//                            usRandom--;</span>
<a name="l01870"></a>01870       <span class="comment">//                      else</span>
<a name="l01871"></a>01871       <span class="comment">//                      {</span>
<a name="l01872"></a>01872       <span class="comment">//                            CreateItem( ( UINT16 ) iMiscItemsList[ i ], (INT8)(80 + Random( 21 )), &amp;Object );</span>
<a name="l01873"></a>01873       <span class="comment">//                            Object.fFlags |= OBJECT_UNDROPPABLE;</span>
<a name="l01874"></a>01874       <span class="comment">//                            PlaceObjectInSoldierCreateStruct( pp, &amp;Object );</span>
<a name="l01875"></a>01875       <span class="comment">//                            break;</span>
<a name="l01876"></a>01876       <span class="comment">//                      }</span>
<a name="l01877"></a>01877       <span class="comment">//                }</span>
<a name="l01878"></a>01878       <span class="comment">//          }</span>
<a name="l01879"></a>01879 
<a name="l01880"></a>01880       <span class="comment">//          i++;</span>
<a name="l01881"></a>01881       <span class="comment">//    }</span>
<a name="l01882"></a>01882       <span class="comment">//}</span>
<a name="l01883"></a>01883 }
<a name="l01884"></a>01884 
<a name="l01885"></a>01885 
<a name="l01886"></a><a class="code" href="Inventory_01Choosing_8cpp.html#9a77f08f7cbee7f9edf38814f48f3345">01886</a> <span class="keywordtype">void</span> <a class="code" href="Inventory_01Choosing_8cpp.html#9a77f08f7cbee7f9edf38814f48f3345">ChooseBombsForSoldierCreateStruct</a>( <a class="code" href="structSOLDIERCREATE__STRUCT.html">SOLDIERCREATE_STRUCT</a> *pp, <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bBombClass )
<a name="l01887"></a>01887 {
<a name="l01888"></a>01888       DebugMsg (TOPIC_JA2,DBG_LEVEL_3,<span class="stringliteral">"ChooseBombsForSoldierCreateStruct"</span>);
<a name="l01889"></a>01889       <span class="comment">//UINT16 i;</span>
<a name="l01890"></a>01890       <span class="comment">//INVTYPE *pItem;</span>
<a name="l01891"></a>01891       <span class="comment">//UINT16 usRandom;</span>
<a name="l01892"></a>01892       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usItem = 0;
<a name="l01893"></a>01893       <a class="code" href="structOBJECTTYPE.html">OBJECTTYPE</a> Object;
<a name="l01894"></a>01894 
<a name="l01895"></a>01895       usItem = <a class="code" href="Inventory_01Choosing_8cpp.html#661ec86e3a255acaad87210de3b4b24d">PickARandomItem</a>( <a class="code" href="Inventory_01Choosing_8h.html#85d881cb3816f77e92c1c8f721b54fc4095285ba8fb2e1f9cfb29c80546f06e4">BOMB</a> , bBombClass, FALSE );
<a name="l01896"></a>01896       <span class="keywordflow">if</span> ( usItem &gt; 0 )
<a name="l01897"></a>01897       {
<a name="l01898"></a>01898             <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( usItem, (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)(80 + <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 21 )), &amp;Object );
<a name="l01899"></a>01899             Object.<a class="code" href="structOBJECTTYPE.html#0f1e67bac22f1b89c4040ef8a5ea48c2">fFlags</a> |= OBJECT_UNDROPPABLE;
<a name="l01900"></a>01900             <a class="code" href="Inventory_01Choosing_8cpp.html#b427f7649fc2e022ea435eafc3737008">PlaceObjectInSoldierCreateStruct</a>( pp, &amp;Object );
<a name="l01901"></a>01901       }
<a name="l01902"></a>01902 
<a name="l01903"></a>01903       <span class="comment">// Madd: externalized again</span><span class="comment"></span>
<a name="l01904"></a>01904 <span class="comment">      //// count how many are eligible</span>
<a name="l01905"></a>01905 <span class="comment"></span>      <span class="comment">//for( i = 0; i &lt; MAXITEMS; i++ )</span>
<a name="l01906"></a>01906       <span class="comment">//{</span>
<a name="l01907"></a>01907       <span class="comment">//    if ( Item[i].usItemClass  == 0 )</span>
<a name="l01908"></a>01908       <span class="comment">//          break;</span>
<a name="l01909"></a>01909       <span class="comment">//    pItem = &amp;Item[ i ];</span>
<a name="l01910"></a>01910       <span class="comment">//    if( ( pItem-&gt;usItemClass == IC_BOMB ) &amp;&amp; ( pItem-&gt;ubCoolness &gt; 0 ) &amp;&amp; ( pItem-&gt;ubCoolness &lt;= bBombClass ) )</span>
<a name="l01911"></a>01911       <span class="comment">//    {</span>
<a name="l01912"></a>01912       <span class="comment">//          usNumMatches++;</span>
<a name="l01913"></a>01913       <span class="comment">//    }</span>
<a name="l01914"></a>01914       <span class="comment">//}</span>
<a name="l01915"></a>01915 
<a name="l01916"></a>01916 <span class="comment"></span>
<a name="l01917"></a>01917 <span class="comment">      //// if any are eligible, pick one of them at random</span>
<a name="l01918"></a>01918 <span class="comment"></span>      <span class="comment">//if( usNumMatches )</span>
<a name="l01919"></a>01919       <span class="comment">//{</span>
<a name="l01920"></a>01920       <span class="comment">//    usRandom = (UINT16)Random( usNumMatches );</span>
<a name="l01921"></a>01921       <span class="comment">//    for( i = 0; i &lt; MAXITEMS; i++ )</span>
<a name="l01922"></a>01922       <span class="comment">//    {</span>
<a name="l01923"></a>01923       <span class="comment">//          if ( Item[i].usItemClass  == 0 )</span>
<a name="l01924"></a>01924       <span class="comment">//                break;</span>
<a name="l01925"></a>01925 
<a name="l01926"></a>01926       <span class="comment">//          pItem = &amp;Item[ i ];</span>
<a name="l01927"></a>01927       <span class="comment">//          if( ( pItem-&gt;usItemClass == IC_BOMB ) &amp;&amp; ( pItem-&gt;ubCoolness &gt; 0 ) &amp;&amp; ( pItem-&gt;ubCoolness &lt;= bBombClass ) )</span>
<a name="l01928"></a>01928       <span class="comment">//          {</span>
<a name="l01929"></a>01929       <span class="comment">//                if( usRandom )</span>
<a name="l01930"></a>01930       <span class="comment">//                      usRandom--;</span>
<a name="l01931"></a>01931       <span class="comment">//                else</span>
<a name="l01932"></a>01932       <span class="comment">//                {</span>
<a name="l01933"></a>01933       <span class="comment">//                      CreateItem( i, (INT8)(80 + Random( 21 )), &amp;Object );</span>
<a name="l01934"></a>01934       <span class="comment">//                      Object.fFlags |= OBJECT_UNDROPPABLE;</span>
<a name="l01935"></a>01935       <span class="comment">//                      PlaceObjectInSoldierCreateStruct( pp, &amp;Object );</span>
<a name="l01936"></a>01936       <span class="comment">//                      break;</span>
<a name="l01937"></a>01937       <span class="comment">//                }</span>
<a name="l01938"></a>01938       <span class="comment">//          }</span>
<a name="l01939"></a>01939       <span class="comment">//    }</span>
<a name="l01940"></a>01940       <span class="comment">//}</span>
<a name="l01941"></a>01941 }
<a name="l01942"></a>01942 
<a name="l01943"></a>01943 
<a name="l01944"></a>01944 
<a name="l01945"></a><a class="code" href="Inventory_01Choosing_8h.html#d27e17be8811f5855b833042b25be167">01945</a> <span class="keywordtype">void</span> <a class="code" href="Inventory_01Choosing_8cpp.html#d27e17be8811f5855b833042b25be167">ChooseLocationSpecificGearForSoldierCreateStruct</a>( <a class="code" href="structSOLDIERCREATE__STRUCT.html">SOLDIERCREATE_STRUCT</a> *pp )
<a name="l01946"></a>01946 {
<a name="l01947"></a>01947       DebugMsg (TOPIC_JA2,DBG_LEVEL_3,<span class="stringliteral">"ChooseLocationSpecificGearForSoldierCreateStruct"</span>);
<a name="l01948"></a>01948       <a class="code" href="structOBJECTTYPE.html">OBJECTTYPE</a>        Object;
<a name="l01949"></a>01949       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usItem = 0;
<a name="l01950"></a>01950       <span class="comment">// If this is Tixa and the player doesn't control Tixa then give all enemies gas masks,</span>
<a name="l01951"></a>01951       <span class="comment">// but somewhere on their person, not in their face positions</span>
<a name="l01952"></a>01952       <span class="keywordflow">if</span> ( <a class="code" href="strategicmap_8cpp.html#49d9aed144a633fda4ba1990f002d703">gWorldSectorX</a> == TIXA_SECTOR_X &amp;&amp; <a class="code" href="strategicmap_8cpp.html#ea322310ced0e35ee18a2ee7b32aac5b">gWorldSectorY</a> == TIXA_SECTOR_Y &amp;&amp; <a class="code" href="strategic_8cpp.html#6f48fb0ea28e3d4889423290f1a6ede8">StrategicMap</a>[ TIXA_SECTOR_X + TIXA_SECTOR_Y * MAP_WORLD_X ].fEnemyControlled )
<a name="l01953"></a>01953       {
<a name="l01954"></a>01954             usItem = <a class="code" href="Inventory_01Choosing_8cpp.html#661ec86e3a255acaad87210de3b4b24d">PickARandomItem</a>(<a class="code" href="Inventory_01Choosing_8h.html#85d881cb3816f77e92c1c8f721b54fc47b7516dca54351967c8403746feef1d8">GASMASKS</a>);
<a name="l01955"></a>01955             <span class="keywordflow">if</span> ( usItem &gt; 0 )
<a name="l01956"></a>01956             {
<a name="l01957"></a>01957                   <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( usItem, (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>) (95+<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(6)), &amp;Object );
<a name="l01958"></a>01958                   <a class="code" href="Inventory_01Choosing_8cpp.html#b427f7649fc2e022ea435eafc3737008">PlaceObjectInSoldierCreateStruct</a>( pp, &amp;Object );
<a name="l01959"></a>01959             }
<a name="l01960"></a>01960       }
<a name="l01961"></a>01961 }
<a name="l01962"></a>01962 
<a name="l01963"></a>01963 
<a name="l01964"></a>01964 
<a name="l01965"></a><a class="code" href="Inventory_01Choosing_8h.html#b427f7649fc2e022ea435eafc3737008">01965</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Inventory_01Choosing_8cpp.html#b427f7649fc2e022ea435eafc3737008">PlaceObjectInSoldierCreateStruct</a>( <a class="code" href="structSOLDIERCREATE__STRUCT.html">SOLDIERCREATE_STRUCT</a> *pp, <a class="code" href="structOBJECTTYPE.html">OBJECTTYPE</a> *pObject )
<a name="l01966"></a>01966 {
<a name="l01967"></a>01967       <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> i;
<a name="l01968"></a>01968       <span class="keywordflow">if</span>( !<a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ pObject-&gt;<a class="code" href="structOBJECTTYPE.html#4fbe05335f161f08f354566b8e5a0a19">usItem</a> ].ubPerPocket )
<a name="l01969"></a>01969       { <span class="comment">//ubPerPocket == 0 will only fit in large pockets.</span>
<a name="l01970"></a>01970             pObject-&gt;<a class="code" href="structOBJECTTYPE.html#84ab3cbeb7dfdcc2e5ad4051e165d294">ubNumberOfObjects</a> = 1;
<a name="l01971"></a>01971             <span class="keywordflow">for</span>( i = <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc8785521434ace88498823088a193622a0ab42">BIGPOCK1POS</a>; i &lt;= <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc8785571ec5bde48a89e74cbbb81af98298a4f">BIGPOCK4POS</a>; i++ )
<a name="l01972"></a>01972             {
<a name="l01973"></a>01973                   <span class="keywordflow">if</span>( !(pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ i ].<a class="code" href="structOBJECTTYPE.html#4fbe05335f161f08f354566b8e5a0a19">usItem</a>) &amp;&amp; !(pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ i ].<a class="code" href="structOBJECTTYPE.html#0f1e67bac22f1b89c4040ef8a5ea48c2">fFlags</a> &amp; OBJECT_NO_OVERWRITE) )
<a name="l01974"></a>01974                   {
<a name="l01975"></a>01975                         memcpy( &amp;(pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ i ]), pObject, <span class="keyword">sizeof</span>( <a class="code" href="structOBJECTTYPE.html">OBJECTTYPE</a> ) );
<a name="l01976"></a>01976                         <span class="keywordflow">return</span> TRUE;
<a name="l01977"></a>01977                   }
<a name="l01978"></a>01978             }
<a name="l01979"></a>01979             <span class="keywordflow">return</span> FALSE;
<a name="l01980"></a>01980       }
<a name="l01981"></a>01981       <span class="keywordflow">else</span>
<a name="l01982"></a>01982       {
<a name="l01983"></a>01983             pObject-&gt;ubNumberOfObjects = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>)min( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ pObject-&gt;usItem ].<a class="code" href="structINVTYPE.html#ce851088e4eacc8cc15bc6830ac68760">ubPerPocket</a>, pObject-&gt;ubNumberOfObjects );
<a name="l01984"></a>01984             <span class="comment">//try to get it into a small pocket first</span>
<a name="l01985"></a>01985             <span class="keywordflow">for</span>( i = <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc878551eb77e72bc2a6d90ace592f5bbaa2514">SMALLPOCK1POS</a>; i &lt;= <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855e7a9bbc37a973fe20ce49d9b0fade02e">SMALLPOCK8POS</a>; i++ )
<a name="l01986"></a>01986             {
<a name="l01987"></a>01987                   <span class="keywordflow">if</span>( !(pp-&gt;Inv[ i ].usItem) &amp;&amp; !(pp-&gt;Inv[ i ].fFlags &amp; OBJECT_NO_OVERWRITE) )
<a name="l01988"></a>01988                   {
<a name="l01989"></a>01989                         memcpy( &amp;(pp-&gt;Inv[ i ]), pObject, <span class="keyword">sizeof</span>( <a class="code" href="structOBJECTTYPE.html">OBJECTTYPE</a> ) );
<a name="l01990"></a>01990                         <span class="keywordflow">return</span> TRUE;
<a name="l01991"></a>01991                   }
<a name="l01992"></a>01992             }
<a name="l01993"></a>01993             <span class="keywordflow">for</span>( i = <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc8785521434ace88498823088a193622a0ab42">BIGPOCK1POS</a>; i &lt;= <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc8785571ec5bde48a89e74cbbb81af98298a4f">BIGPOCK4POS</a>; i++ )
<a name="l01994"></a>01994             { <span class="comment">//no space free in small pockets, so put it into a large pocket.</span>
<a name="l01995"></a>01995                   <span class="keywordflow">if</span>( !(pp-&gt;Inv[ i ].usItem) &amp;&amp; !(pp-&gt;Inv[ i ].fFlags &amp; OBJECT_NO_OVERWRITE) )
<a name="l01996"></a>01996                   {
<a name="l01997"></a>01997                         memcpy( &amp;(pp-&gt;Inv[ i ]), pObject, <span class="keyword">sizeof</span>( <a class="code" href="structOBJECTTYPE.html">OBJECTTYPE</a> ) );
<a name="l01998"></a>01998                         <span class="keywordflow">return</span> TRUE;
<a name="l01999"></a>01999                   }
<a name="l02000"></a>02000             }
<a name="l02001"></a>02001       }
<a name="l02002"></a>02002       <span class="keywordflow">return</span> FALSE;
<a name="l02003"></a>02003 }
<a name="l02004"></a>02004 
<a name="l02005"></a><a class="code" href="Inventory_01Choosing_8cpp.html#b082ba4847029fe7febaae508656ef0c">02005</a> <span class="keywordtype">void</span> <a class="code" href="Inventory_01Choosing_8cpp.html#b082ba4847029fe7febaae508656ef0c">RandomlyChooseWhichItemsAreDroppable</a>( <a class="code" href="structSOLDIERCREATE__STRUCT.html">SOLDIERCREATE_STRUCT</a> *pp, <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bSoldierClass )
<a name="l02006"></a>02006 {
<a name="l02007"></a>02007       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> i;
<a name="l02008"></a>02008       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> j;
<a name="l02009"></a>02009 <span class="comment">//    UINT16 usRandomNum;</span>
<a name="l02010"></a>02010       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiItemClass;
<a name="l02011"></a>02011       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubNumMatches = 0;
<a name="l02012"></a>02012       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usItem;
<a name="l02013"></a>02013       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubAmmoDropRate;
<a name="l02014"></a>02014       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubGrenadeDropRate;
<a name="l02015"></a>02015       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubOtherDropRate;
<a name="l02016"></a>02016       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fWeapon = FALSE;
<a name="l02017"></a>02017       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fGrenades = FALSE;    <span class="comment">// this includes all  grenades!</span>
<a name="l02018"></a>02018       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fAmmo = FALSE;
<a name="l02019"></a>02019       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fArmour = FALSE;
<a name="l02020"></a>02020       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fKnife = FALSE;
<a name="l02021"></a>02021       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fKit = FALSE;
<a name="l02022"></a>02022       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fFace = FALSE;
<a name="l02023"></a>02023       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fMisc = FALSE;
<a name="l02024"></a>02024       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiRandomValue = 0;
<a name="l02025"></a>02025 
<a name="l02026"></a>02026       <span class="comment">//Madd</span>
<a name="l02027"></a>02027 <span class="keywordflow">if</span> ( <a class="code" href="GameSettings_8cpp.html#955420499d1cb3101625c85ea703b6bb">gGameSettings</a>.<a class="code" href="structGAME__SETTINGS.html#9d80dbd111727423b8924b5e72e3a0ed">fOptions</a>[<a class="code" href="GameSettings_8h.html#394b3903fbf00ba2b6243f60689a5a5faa756058d248099c894175dd988210b1">TOPTION_DROP_ALL</a>] )
<a name="l02028"></a>02028 {
<a name="l02029"></a>02029       <a class="code" href="Inventory_01Choosing_8cpp.html#a0d357b24ce2c7b87d1bbea829572901">ENEMYAMMODROPRATE</a> = 100;      
<a name="l02030"></a>02030       <a class="code" href="Inventory_01Choosing_8cpp.html#ecd621787a92f586f62ff5936b162176">ENEMYGRENADEDROPRATE</a> = 100;   
<a name="l02031"></a>02031       <a class="code" href="Inventory_01Choosing_8cpp.html#0645639b633a79cecab87db112491adb">ENEMYEQUIPDROPRATE</a> = 50;      
<a name="l02032"></a>02032       <a class="code" href="Inventory_01Choosing_8cpp.html#a5d3eaca7cbc1150abefa0e63d9a436b">MILITIAAMMODROPRATE</a> = 100;      
<a name="l02033"></a>02033       <a class="code" href="Inventory_01Choosing_8cpp.html#d70ea801a892f8b4e6ed4df1bea01a4c">MILITIAGRENADEDROPRATE</a> = 100; 
<a name="l02034"></a>02034       <a class="code" href="Inventory_01Choosing_8cpp.html#f2daed9a7d7a7af6af3a9d686ce85786">MILITIAEQUIPDROPRATE</a> = 50;     
<a name="l02035"></a>02035 }
<a name="l02036"></a>02036 <span class="keywordflow">else</span>
<a name="l02037"></a>02037 {
<a name="l02038"></a>02038       <span class="comment">// Default random drop</span>
<a name="l02039"></a>02039       <span class="keywordflow">if</span> (<a class="code" href="GameSettings_8cpp.html#5c32f930e2fef384505c4b91803a92c2">gGameExternalOptions</a>.<a class="code" href="structGAME__EXTERNAL__OPTIONS.html#91ca30a5ad1050b5edf78964830f7b27">ubEnemiesItemDrop</a> == 0)
<a name="l02040"></a>02040       {
<a name="l02041"></a>02041             <a class="code" href="Inventory_01Choosing_8cpp.html#a0d357b24ce2c7b87d1bbea829572901">ENEMYAMMODROPRATE</a> = 50;      
<a name="l02042"></a>02042             <a class="code" href="Inventory_01Choosing_8cpp.html#ecd621787a92f586f62ff5936b162176">ENEMYGRENADEDROPRATE</a> = 25;
<a name="l02043"></a>02043             <a class="code" href="Inventory_01Choosing_8cpp.html#0645639b633a79cecab87db112491adb">ENEMYEQUIPDROPRATE</a> = 15;
<a name="l02044"></a>02044             <a class="code" href="Inventory_01Choosing_8cpp.html#a5d3eaca7cbc1150abefa0e63d9a436b">MILITIAAMMODROPRATE</a> = 5;     
<a name="l02045"></a>02045             <a class="code" href="Inventory_01Choosing_8cpp.html#d70ea801a892f8b4e6ed4df1bea01a4c">MILITIAGRENADEDROPRATE</a> = 3;    
<a name="l02046"></a>02046             <a class="code" href="Inventory_01Choosing_8cpp.html#f2daed9a7d7a7af6af3a9d686ce85786">MILITIAEQUIPDROPRATE</a> = 2;     
<a name="l02047"></a>02047       }
<a name="l02048"></a>02048       <span class="comment">// Get drop rate from XML-Files</span>
<a name="l02049"></a>02049       <span class="keywordflow">else</span>
<a name="l02050"></a>02050       {
<a name="l02051"></a>02051             <span class="comment">// Reset, because it is not used anymore</span>
<a name="l02052"></a>02052             <a class="code" href="Inventory_01Choosing_8cpp.html#a0d357b24ce2c7b87d1bbea829572901">ENEMYAMMODROPRATE</a> = -1;      
<a name="l02053"></a>02053             <a class="code" href="Inventory_01Choosing_8cpp.html#ecd621787a92f586f62ff5936b162176">ENEMYGRENADEDROPRATE</a> = -1;
<a name="l02054"></a>02054             <a class="code" href="Inventory_01Choosing_8cpp.html#0645639b633a79cecab87db112491adb">ENEMYEQUIPDROPRATE</a> = -1;
<a name="l02055"></a>02055             <a class="code" href="Inventory_01Choosing_8cpp.html#a5d3eaca7cbc1150abefa0e63d9a436b">MILITIAAMMODROPRATE</a> = -1;     
<a name="l02056"></a>02056             <a class="code" href="Inventory_01Choosing_8cpp.html#d70ea801a892f8b4e6ed4df1bea01a4c">MILITIAGRENADEDROPRATE</a> = -1;   
<a name="l02057"></a>02057             <a class="code" href="Inventory_01Choosing_8cpp.html#f2daed9a7d7a7af6af3a9d686ce85786">MILITIAEQUIPDROPRATE</a> = -1;   
<a name="l02058"></a>02058       }
<a name="l02059"></a>02059 }
<a name="l02060"></a>02060 
<a name="l02061"></a>02061 <span class="comment">/*</span>
<a name="l02062"></a>02062 <span class="comment">      //40% of soldiers will have droppable items.</span>
<a name="l02063"></a>02063 <span class="comment">      usRandomNum = (UINT16)Random( 1000 );</span>
<a name="l02064"></a>02064 <span class="comment">      if( usRandomNum &gt;= 400 )</span>
<a name="l02065"></a>02065 <span class="comment">            return;</span>
<a name="l02066"></a>02066 <span class="comment">      //so now the number is 0-399.  This is kind of like a D&amp;D die roll where</span>
<a name="l02067"></a>02067 <span class="comment">      //various numbers drop different items, or even more than one item.  At this</span>
<a name="l02068"></a>02068 <span class="comment">      //point, we don't care if the enemy has anything in the slot that is made droppable.</span>
<a name="l02069"></a>02069 <span class="comment">      //Any items containing the OBJECT_NO_OVERWRITE slot is rejected for droppable </span>
<a name="l02070"></a>02070 <span class="comment">      //consideration.  </span>
<a name="l02071"></a>02071 <span class="comment"></span>
<a name="l02072"></a>02072 <span class="comment">      if( usRandomNum &lt; 32 ) //3.2% of dead bodies present the possibility of several items (0-5 items : avg 3).</span>
<a name="l02073"></a>02073 <span class="comment">      { //31 is the magic number that allows all 5 item classes to be dropped!</span>
<a name="l02074"></a>02074 <span class="comment">            if( usRandomNum &amp; 16 )</span>
<a name="l02075"></a>02075 <span class="comment">                  fWeapon = TRUE;</span>
<a name="l02076"></a>02076 <span class="comment">            if( usRandomNum &amp; 8 )</span>
<a name="l02077"></a>02077 <span class="comment">                  fAmmo = TRUE;</span>
<a name="l02078"></a>02078 <span class="comment">            if( usRandomNum &amp; 4 )</span>
<a name="l02079"></a>02079 <span class="comment">                  fGrenades = TRUE;</span>
<a name="l02080"></a>02080 <span class="comment">            if( usRandomNum &amp; 2 )</span>
<a name="l02081"></a>02081 <span class="comment">                  fArmour = TRUE;</span>
<a name="l02082"></a>02082 <span class="comment">            if( usRandomNum &amp; 1 )</span>
<a name="l02083"></a>02083 <span class="comment">                  fMisc = TRUE;</span>
<a name="l02084"></a>02084 <span class="comment">      }</span>
<a name="l02085"></a>02085 <span class="comment">      else if( usRandomNum &lt; 100 ) //6.8% chance of getting 2-3 different items.</span>
<a name="l02086"></a>02086 <span class="comment">      { //do a more generalized approach to dropping items.</span>
<a name="l02087"></a>02087 <span class="comment">            switch( usRandomNum / 10 )</span>
<a name="l02088"></a>02088 <span class="comment">            {</span>
<a name="l02089"></a>02089 <span class="comment">                  case 3:     fWeapon = TRUE;                                                               fAmmo = TRUE;                                                                                               break;</span>
<a name="l02090"></a>02090 <span class="comment">                  case 4:     fWeapon = TRUE;   fGrenades = TRUE;                                                                                                                                     break;</span>
<a name="l02091"></a>02091 <span class="comment">                  case 5:                                                     fGrenades = TRUE;                                                                                           fMisc = TRUE;     break;</span>
<a name="l02092"></a>02092 <span class="comment">                  case 6:                                                     fGrenades = TRUE;                                           fArmour = TRUE;                                             break;</span>
<a name="l02093"></a>02093 <span class="comment">                  case 7:                                                                                                                 fAmmo = TRUE;     fArmour = TRUE;                                             break;</span>
<a name="l02094"></a>02094 <span class="comment">                  case 8:                                                                                                                 fAmmo = TRUE;     fArmour = TRUE;   fMisc = TRUE;     break;</span>
<a name="l02095"></a>02095 <span class="comment">                  case 9:                                                     fGrenades = TRUE; fAmmo = TRUE;                                                     fMisc = TRUE;     break;</span>
<a name="l02096"></a>02096 <span class="comment">            }</span>
<a name="l02097"></a>02097 <span class="comment">      }</span>
<a name="l02098"></a>02098 <span class="comment">      else</span>
<a name="l02099"></a>02099 <span class="comment">      {</span>
<a name="l02100"></a>02100 <span class="comment">            switch( usRandomNum / 50 ) //30% chance of getting 1-2 items (no weapons)</span>
<a name="l02101"></a>02101 <span class="comment">            {</span>
<a name="l02102"></a>02102 <span class="comment">                  case 2:                                                     fGrenades = TRUE;                                                                                                                                     break;</span>
<a name="l02103"></a>02103 <span class="comment">                  case 3:                                                                                                                 fAmmo = TRUE;                                                                                               break;</span>
<a name="l02104"></a>02104 <span class="comment">                  case 4:                                                                                                                                                     fArmour = TRUE;                                                   break;</span>
<a name="l02105"></a>02105 <span class="comment">                  case 5:                                                                                                                                                                                                           fMisc = TRUE;     break; </span>
<a name="l02106"></a>02106 <span class="comment">                  case 6:                                                                                                                 fAmmo = TRUE;                                                     fMisc = TRUE;     break;</span>
<a name="l02107"></a>02107 <span class="comment">                  case 7:                                                     fGrenades = TRUE; fAmmo = TRUE;                                                                                               break;</span>
<a name="l02108"></a>02108 <span class="comment">            }</span>
<a name="l02109"></a>02109 <span class="comment">      }</span>
<a name="l02110"></a>02110 <span class="comment"></span>
<a name="l02111"></a>02111 <span class="comment">      fKnife = (Random(3)) ? FALSE : TRUE;</span>
<a name="l02112"></a>02112 <span class="comment">*/</span>
<a name="l02113"></a>02113 
<a name="l02114"></a>02114 
<a name="l02115"></a>02115       <span class="keywordflow">if</span> ( SOLDIER_CLASS_MILITIA( bSoldierClass ) )
<a name="l02116"></a>02116       {
<a name="l02117"></a>02117             <span class="comment">// militia (they drop much less stuff)</span>
<a name="l02118"></a>02118             ubAmmoDropRate          = <a class="code" href="Inventory_01Choosing_8cpp.html#a5d3eaca7cbc1150abefa0e63d9a436b">MILITIAAMMODROPRATE</a>;
<a name="l02119"></a>02119             ubGrenadeDropRate = <a class="code" href="Inventory_01Choosing_8cpp.html#d70ea801a892f8b4e6ed4df1bea01a4c">MILITIAGRENADEDROPRATE</a>;
<a name="l02120"></a>02120             ubOtherDropRate = <a class="code" href="Inventory_01Choosing_8cpp.html#f2daed9a7d7a7af6af3a9d686ce85786">MILITIAEQUIPDROPRATE</a>;
<a name="l02121"></a>02121       }
<a name="l02122"></a>02122       <span class="keywordflow">else</span>
<a name="l02123"></a>02123       {
<a name="l02124"></a>02124             <span class="comment">// enemy army</span>
<a name="l02125"></a>02125             ubAmmoDropRate  = <a class="code" href="Inventory_01Choosing_8cpp.html#a0d357b24ce2c7b87d1bbea829572901">ENEMYAMMODROPRATE</a>;
<a name="l02126"></a>02126             ubGrenadeDropRate = <a class="code" href="Inventory_01Choosing_8cpp.html#ecd621787a92f586f62ff5936b162176">ENEMYGRENADEDROPRATE</a>;
<a name="l02127"></a>02127             ubOtherDropRate = <a class="code" href="Inventory_01Choosing_8cpp.html#0645639b633a79cecab87db112491adb">ENEMYEQUIPDROPRATE</a>;
<a name="l02128"></a>02128       }
<a name="l02129"></a>02129 
<a name="l02130"></a>02130       <span class="comment">// only enemy soldiers use auto-drop system!</span>
<a name="l02131"></a>02131       <span class="comment">// don't use the auto-drop system in auto-resolve: player won't see what's being used &amp; enemies will often win &amp; keep'em </span>
<a name="l02132"></a>02132       <span class="keywordflow">if</span> ( SOLDIER_CLASS_ENEMY( bSoldierClass ) &amp;&amp; !<a class="code" href="Auto_01Resolve_8h.html#4753f4fa3d21585d4f721d7deba0cc0e">IsAutoResolveActive</a>() )
<a name="l02133"></a>02133       {
<a name="l02134"></a>02134             <span class="comment">// SPECIAL handling for weapons: we'll always drop a weapon type that has never been dropped before</span>
<a name="l02135"></a>02135             <span class="keywordflow">for</span>( i = 0; i &lt; <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc878553e9a668bdf9e2a72b855424ee1bdabcf">NUM_INV_SLOTS</a>; i++ )
<a name="l02136"></a>02136             {
<a name="l02137"></a>02137                   usItem = pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ i ].<a class="code" href="structOBJECTTYPE.html#4fbe05335f161f08f354566b8e5a0a19">usItem</a>;
<a name="l02138"></a>02138 <span class="comment">//TODO: someday maybe               pp-&gt;Inv[i].fFlags &amp;= ~ITEM_REPAIRABLE;</span>
<a name="l02139"></a>02139 
<a name="l02140"></a>02140                   if ( <a class="code" href="GameSettings_8cpp.html#955420499d1cb3101625c85ea703b6bb">gGameSettings</a>.<a class="code" href="structGAME__SETTINGS.html#9d80dbd111727423b8924b5e72e3a0ed">fOptions</a>[<a class="code" href="GameSettings_8h.html#394b3903fbf00ba2b6243f60689a5a5faa756058d248099c894175dd988210b1">TOPTION_DROP_ALL</a>]  )
<a name="l02141"></a>02141                   {
<a name="l02142"></a>02142                         <span class="comment">// WANNE - "Drop all" should mean "Drop all"</span>
<a name="l02143"></a>02143                         <span class="comment">/*</span>
<a name="l02144"></a>02144 <span class="comment">                        if ( Item[ pp-&gt;Inv[ i ].usItem ].usItemClass == IC_FACE )</span>
<a name="l02145"></a>02145 <span class="comment">                        {</span>
<a name="l02146"></a>02146 <span class="comment">                              if( Random(100) &lt; ubOtherDropRate ) // way too many gas masks, nvg and extended ears getting dropped!</span>
<a name="l02147"></a>02147 <span class="comment">                                    pp-&gt;Inv[ i ].fFlags &amp;= ~OBJECT_UNDROPPABLE; </span>
<a name="l02148"></a>02148 <span class="comment">                        }</span>
<a name="l02149"></a>02149 <span class="comment">                        else</span>
<a name="l02150"></a>02150 <span class="comment">                        */</span>
<a name="l02151"></a>02151                         
<a name="l02152"></a>02152                         pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ i ].<a class="code" href="structOBJECTTYPE.html#0f1e67bac22f1b89c4040ef8a5ea48c2">fFlags</a> &amp;= ~OBJECT_UNDROPPABLE;
<a name="l02153"></a>02153                   }
<a name="l02154"></a>02154                   <span class="keywordflow">else</span>
<a name="l02155"></a>02155                   {
<a name="l02156"></a>02156                         <span class="comment">// Default random drop</span>
<a name="l02157"></a>02157                         <span class="keywordflow">if</span> (<a class="code" href="GameSettings_8cpp.html#5c32f930e2fef384505c4b91803a92c2">gGameExternalOptions</a>.<a class="code" href="structGAME__EXTERNAL__OPTIONS.html#91ca30a5ad1050b5edf78964830f7b27">ubEnemiesItemDrop</a> == 0)
<a name="l02158"></a>02158                         {
<a name="l02159"></a>02159                                     <span class="comment">// if it's a weapon (monster parts included - they won't drop due to checks elsewhere!)</span>
<a name="l02160"></a>02160                               if ((usItem &gt; <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4c157bdf0b85a40d2619cbc8bc1ae5fe2">NONE</a>) &amp;&amp; (usItem &lt; <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f40efaf5227d3f780f8db037c71e3f903f">MAXITEMS</a> )) <span class="comment">// Madd -- this should be ok set to maxitems instead of max_Weapons </span>
<a name="l02161"></a>02161                               {
<a name="l02162"></a>02162                                     <span class="comment">// and we're allowed to change its flags</span>
<a name="l02163"></a>02163                                     <span class="keywordflow">if</span>(! (pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ i ].<a class="code" href="structOBJECTTYPE.html#0f1e67bac22f1b89c4040ef8a5ea48c2">fFlags</a> &amp; OBJECT_NO_OVERWRITE ))
<a name="l02164"></a>02164                                     {
<a name="l02165"></a>02165                                           <span class="comment">// and it's never been dropped before in this game</span>
<a name="l02166"></a>02166                                           if (!<a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#6f67468571f9de657cc64880427d5b0b">fWeaponDroppedAlready</a>[usItem])
<a name="l02167"></a>02167                                           {
<a name="l02168"></a>02168                                                 <span class="comment">// mark it as droppable, and remember we did so.  If the player never kills this particular dude, oh well,</span>
<a name="l02169"></a>02169                                                 <span class="comment">// tough luck, he missed his chance for an easy reward, he'll have to wait til next time and need some luck...</span>
<a name="l02170"></a>02170                                                 pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ i ].<a class="code" href="structOBJECTTYPE.html#0f1e67bac22f1b89c4040ef8a5ea48c2">fFlags</a> &amp;= ~OBJECT_UNDROPPABLE;
<a name="l02171"></a>02171 
<a name="l02172"></a>02172                                                 <a class="code" href="Inventory_01Choosing_8cpp.html#63402030348a3f8904d9c817ef87b319">MarkAllWeaponsOfSameGunClassAsDropped</a>( usItem );
<a name="l02173"></a>02173                                           }
<a name="l02174"></a>02174                                     }
<a name="l02175"></a>02175                               }
<a name="l02176"></a>02176                         }
<a name="l02177"></a>02177                   }
<a name="l02178"></a>02178             }
<a name="l02179"></a>02179       }
<a name="l02180"></a>02180 
<a name="l02181"></a>02181       <span class="keywordflow">if</span> ( <a class="code" href="GameSettings_8cpp.html#955420499d1cb3101625c85ea703b6bb">gGameSettings</a>.<a class="code" href="structGAME__SETTINGS.html#9d80dbd111727423b8924b5e72e3a0ed">fOptions</a>[<a class="code" href="GameSettings_8h.html#394b3903fbf00ba2b6243f60689a5a5faa756058d248099c894175dd988210b1">TOPTION_DROP_ALL</a>]  )
<a name="l02182"></a>02182             <span class="keywordflow">return</span>;
<a name="l02183"></a>02183 
<a name="l02184"></a>02184 
<a name="l02185"></a>02185 
<a name="l02186"></a>02186       <span class="comment">// WANNE: Randomly choose which type of items should be dropped</span>
<a name="l02187"></a>02187       if (<a class="code" href="GameSettings_8cpp.html#5c32f930e2fef384505c4b91803a92c2">gGameExternalOptions</a>.<a class="code" href="structGAME__EXTERNAL__OPTIONS.html#91ca30a5ad1050b5edf78964830f7b27">ubEnemiesItemDrop</a> == 0)
<a name="l02188"></a>02188       {
<a name="l02189"></a>02189             <span class="keywordflow">if</span>( <span class="comment">/*gGameSettings.fOptions[TOPTION_DROP_ALL] ||*/</span> <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(100) &lt; ubAmmoDropRate )
<a name="l02190"></a>02190                   fAmmo = TRUE;
<a name="l02191"></a>02191 
<a name="l02192"></a>02192             <span class="keywordflow">if</span>( <span class="comment">/*gGameSettings.fOptions[TOPTION_DROP_ALL] ||*/</span> <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(100) &lt; ubOtherDropRate )
<a name="l02193"></a>02193                   fWeapon = TRUE;
<a name="l02194"></a>02194 
<a name="l02195"></a>02195             <span class="keywordflow">if</span>( <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(100) &lt; ubOtherDropRate )
<a name="l02196"></a>02196                   fArmour = TRUE;
<a name="l02197"></a>02197 
<a name="l02198"></a>02198             <span class="keywordflow">if</span>( <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(100) &lt; ubOtherDropRate )
<a name="l02199"></a>02199                   fKnife = TRUE;
<a name="l02200"></a>02200 
<a name="l02201"></a>02201             <span class="keywordflow">if</span>( <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(100) &lt; ubGrenadeDropRate )
<a name="l02202"></a>02202                   fGrenades = TRUE;
<a name="l02203"></a>02203 
<a name="l02204"></a>02204             <span class="keywordflow">if</span>( <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(100) &lt; ubOtherDropRate )
<a name="l02205"></a>02205                   fKit = TRUE;
<a name="l02206"></a>02206 
<a name="l02207"></a>02207             <span class="keywordflow">if</span>( <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(100) &lt; (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)(ubOtherDropRate / 3) )
<a name="l02208"></a>02208                   fFace = TRUE;
<a name="l02209"></a>02209 
<a name="l02210"></a>02210             <span class="keywordflow">if</span>( <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(100) &lt; ubOtherDropRate )
<a name="l02211"></a>02211                   fMisc = TRUE;
<a name="l02212"></a>02212 
<a name="l02213"></a>02213 
<a name="l02214"></a>02214             <span class="comment">//Now, that the flags are set for each item, we now have to search through the item slots to</span>
<a name="l02215"></a>02215             <span class="comment">//see if we can find a matching item, however, if we find any items in a particular class that</span>
<a name="l02216"></a>02216             <span class="comment">//have the OBJECT_NO_OVERWRITE flag set, we will not make any items droppable for that class</span>
<a name="l02217"></a>02217             <span class="comment">//because the editor would have specified it already.</span>
<a name="l02218"></a>02218             <span class="keywordflow">if</span>( fAmmo )
<a name="l02219"></a>02219             {
<a name="l02220"></a>02220                   <span class="comment">// now drops ALL ammo found, not just the first slot</span>
<a name="l02221"></a>02221                   <span class="keywordflow">for</span>( i = 0; i &lt; <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc878553e9a668bdf9e2a72b855424ee1bdabcf">NUM_INV_SLOTS</a>; i++ )
<a name="l02222"></a>02222                   {
<a name="l02223"></a>02223                         uiItemClass = <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ pp-&gt;Inv[ i ].usItem ].<a class="code" href="structINVTYPE.html#1f63e61536407cc997a998585017ba07">usItemClass</a>;
<a name="l02224"></a>02224                         <span class="keywordflow">if</span>( uiItemClass == IC_AMMO )
<a name="l02225"></a>02225                         {
<a name="l02226"></a>02226                               <span class="keywordflow">if</span>( pp-&gt;Inv[ i ].fFlags &amp; OBJECT_NO_OVERWRITE )
<a name="l02227"></a>02227                                     <span class="keywordflow">continue</span>;
<a name="l02228"></a>02228                               <span class="keywordflow">else</span>
<a name="l02229"></a>02229                               {
<a name="l02230"></a>02230                                     pp-&gt;Inv[ i ].fFlags &amp;= ~OBJECT_UNDROPPABLE;
<a name="l02231"></a>02231                               }
<a name="l02232"></a>02232                         }
<a name="l02233"></a>02233                   }
<a name="l02234"></a>02234             }
<a name="l02235"></a>02235 
<a name="l02236"></a>02236             <span class="keywordflow">if</span>( fWeapon )
<a name="l02237"></a>02237             {
<a name="l02238"></a>02238                   ubNumMatches = 0;
<a name="l02239"></a>02239                   <span class="keywordflow">for</span>( i = 0; i &lt; <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc878553e9a668bdf9e2a72b855424ee1bdabcf">NUM_INV_SLOTS</a>; i++ )
<a name="l02240"></a>02240                   {
<a name="l02241"></a>02241                         uiItemClass = <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ pp-&gt;Inv[ i ].usItem ].<a class="code" href="structINVTYPE.html#1f63e61536407cc997a998585017ba07">usItemClass</a>;
<a name="l02242"></a>02242                         <span class="keywordflow">if</span>( uiItemClass == IC_GUN || uiItemClass == IC_LAUNCHER )
<a name="l02243"></a>02243                         {
<a name="l02244"></a>02244                               <span class="keywordflow">if</span>( pp-&gt;Inv[ i ].fFlags &amp; OBJECT_NO_OVERWRITE )
<a name="l02245"></a>02245                                     <span class="keywordflow">break</span>;
<a name="l02246"></a>02246                               <span class="keywordflow">else</span>
<a name="l02247"></a>02247                                     ubNumMatches++;
<a name="l02248"></a>02248                         }
<a name="l02249"></a>02249                   }
<a name="l02250"></a>02250                   <span class="keywordflow">if</span> ( ubNumMatches &gt; 0 )
<a name="l02251"></a>02251                   {
<a name="l02252"></a>02252                         <span class="keywordflow">for</span>( i = 0; i &lt; <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc878553e9a668bdf9e2a72b855424ee1bdabcf">NUM_INV_SLOTS</a>; i++ )
<a name="l02253"></a>02253                         {
<a name="l02254"></a>02254                               uiItemClass = <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ pp-&gt;Inv[ i ].usItem ].<a class="code" href="structINVTYPE.html#1f63e61536407cc997a998585017ba07">usItemClass</a>;
<a name="l02255"></a>02255                               <span class="keywordflow">if</span>( uiItemClass == IC_GUN || uiItemClass == IC_LAUNCHER )
<a name="l02256"></a>02256                               {
<a name="l02257"></a>02257                                     <span class="keywordflow">if</span>( pp-&gt;Inv[ i ].fFlags &amp; OBJECT_NO_OVERWRITE )
<a name="l02258"></a>02258                                           <span class="keywordflow">break</span>;
<a name="l02259"></a>02259                                     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( ubNumMatches-- )  )
<a name="l02260"></a>02260                                     {
<a name="l02261"></a>02261                                           pp-&gt;Inv[ i ].fFlags &amp;= ~OBJECT_UNDROPPABLE;
<a name="l02262"></a>02262                                           <span class="keywordflow">break</span>;
<a name="l02263"></a>02263                                     }
<a name="l02264"></a>02264                               }
<a name="l02265"></a>02265                         }
<a name="l02266"></a>02266                   }
<a name="l02267"></a>02267             }
<a name="l02268"></a>02268 
<a name="l02269"></a>02269             <span class="keywordflow">if</span>( fArmour )
<a name="l02270"></a>02270             {
<a name="l02271"></a>02271                   ubNumMatches = 0;
<a name="l02272"></a>02272                   <span class="keywordflow">for</span>( i = 0; i &lt; <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc878553e9a668bdf9e2a72b855424ee1bdabcf">NUM_INV_SLOTS</a>; i++ )
<a name="l02273"></a>02273                   {
<a name="l02274"></a>02274                         uiItemClass = <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ pp-&gt;Inv[ i ].usItem ].<a class="code" href="structINVTYPE.html#1f63e61536407cc997a998585017ba07">usItemClass</a>;
<a name="l02275"></a>02275                         <span class="keywordflow">if</span>( uiItemClass == IC_ARMOUR )
<a name="l02276"></a>02276                         {
<a name="l02277"></a>02277                               <span class="keywordflow">if</span>( pp-&gt;Inv[ i ].fFlags &amp; OBJECT_NO_OVERWRITE )
<a name="l02278"></a>02278                                     <span class="keywordflow">break</span>;
<a name="l02279"></a>02279                               <span class="keywordflow">else</span>
<a name="l02280"></a>02280                                     ubNumMatches++;
<a name="l02281"></a>02281                         }
<a name="l02282"></a>02282                   }
<a name="l02283"></a>02283                   <span class="keywordflow">if</span> ( ubNumMatches &gt; 0 )
<a name="l02284"></a>02284                   {
<a name="l02285"></a>02285                         <span class="keywordflow">for</span>( i = 0; i &lt; <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc878553e9a668bdf9e2a72b855424ee1bdabcf">NUM_INV_SLOTS</a>; i++ )
<a name="l02286"></a>02286                         {
<a name="l02287"></a>02287                               uiItemClass = <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ pp-&gt;Inv[ i ].usItem ].<a class="code" href="structINVTYPE.html#1f63e61536407cc997a998585017ba07">usItemClass</a>;
<a name="l02288"></a>02288                               <span class="keywordflow">if</span>( uiItemClass == IC_ARMOUR )
<a name="l02289"></a>02289                               {
<a name="l02290"></a>02290                                     <span class="keywordflow">if</span>( pp-&gt;Inv[ i ].fFlags &amp; OBJECT_NO_OVERWRITE )
<a name="l02291"></a>02291                                           <span class="keywordflow">break</span>;
<a name="l02292"></a>02292                                     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( ubNumMatches-- ) )
<a name="l02293"></a>02293                                     {
<a name="l02294"></a>02294                                           pp-&gt;Inv[ i ].fFlags &amp;= ~OBJECT_UNDROPPABLE;
<a name="l02295"></a>02295                                           <span class="keywordflow">break</span>;
<a name="l02296"></a>02296                                     }
<a name="l02297"></a>02297                               }
<a name="l02298"></a>02298                         }
<a name="l02299"></a>02299                   }
<a name="l02300"></a>02300             }
<a name="l02301"></a>02301 
<a name="l02302"></a>02302             <span class="keywordflow">if</span>( fKnife)
<a name="l02303"></a>02303             {
<a name="l02304"></a>02304                   <span class="keywordflow">for</span>( i = 0; i &lt; <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc878553e9a668bdf9e2a72b855424ee1bdabcf">NUM_INV_SLOTS</a>; i++ )
<a name="l02305"></a>02305                   {
<a name="l02306"></a>02306                         <span class="comment">// drops FIRST knife found</span>
<a name="l02307"></a>02307                         uiItemClass = <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ pp-&gt;Inv[ i ].usItem ].<a class="code" href="structINVTYPE.html#1f63e61536407cc997a998585017ba07">usItemClass</a>;
<a name="l02308"></a>02308                         <span class="keywordflow">if</span>( uiItemClass == IC_BLADE || uiItemClass == IC_THROWING_KNIFE )
<a name="l02309"></a>02309                         {
<a name="l02310"></a>02310                               <span class="keywordflow">if</span>( pp-&gt;Inv[ i ].fFlags &amp; OBJECT_NO_OVERWRITE )
<a name="l02311"></a>02311                                     <span class="keywordflow">break</span>;
<a name="l02312"></a>02312                               <span class="keywordflow">else</span>
<a name="l02313"></a>02313                               {
<a name="l02314"></a>02314                                     pp-&gt;Inv[ i ].fFlags &amp;= ~OBJECT_UNDROPPABLE;
<a name="l02315"></a>02315                                     <span class="keywordflow">break</span>;
<a name="l02316"></a>02316                               }
<a name="l02317"></a>02317                         }
<a name="l02318"></a>02318                   }
<a name="l02319"></a>02319             }
<a name="l02320"></a>02320 
<a name="l02321"></a>02321             <span class="comment">// note that they'll only drop ONE TYPE of grenade if they have multiple types (very common)</span>
<a name="l02322"></a>02322             <span class="keywordflow">if</span>( fGrenades )
<a name="l02323"></a>02323             {
<a name="l02324"></a>02324                   ubNumMatches = 0;
<a name="l02325"></a>02325                   <span class="keywordflow">for</span>( i = 0; i &lt; <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc878553e9a668bdf9e2a72b855424ee1bdabcf">NUM_INV_SLOTS</a>; i++ )
<a name="l02326"></a>02326                   {
<a name="l02327"></a>02327                         uiItemClass = <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ pp-&gt;Inv[ i ].usItem ].<a class="code" href="structINVTYPE.html#1f63e61536407cc997a998585017ba07">usItemClass</a>;
<a name="l02328"></a>02328                         <span class="keywordflow">if</span>( uiItemClass == IC_GRENADE )
<a name="l02329"></a>02329                         {
<a name="l02330"></a>02330                               <span class="keywordflow">if</span>( pp-&gt;Inv[ i ].fFlags &amp; OBJECT_NO_OVERWRITE )
<a name="l02331"></a>02331                                     <span class="keywordflow">break</span>;
<a name="l02332"></a>02332                               <span class="keywordflow">else</span>
<a name="l02333"></a>02333                                     ubNumMatches++;
<a name="l02334"></a>02334                         }
<a name="l02335"></a>02335                   }
<a name="l02336"></a>02336                   <span class="keywordflow">if</span> ( ubNumMatches &gt; 0 )
<a name="l02337"></a>02337                   {
<a name="l02338"></a>02338                         <span class="keywordflow">for</span>( i = 0; i &lt; <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc878553e9a668bdf9e2a72b855424ee1bdabcf">NUM_INV_SLOTS</a>; i++ )
<a name="l02339"></a>02339                         {
<a name="l02340"></a>02340                               uiItemClass = <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ pp-&gt;Inv[ i ].usItem ].<a class="code" href="structINVTYPE.html#1f63e61536407cc997a998585017ba07">usItemClass</a>;
<a name="l02341"></a>02341                               <span class="keywordflow">if</span>( uiItemClass == IC_GRENADE )
<a name="l02342"></a>02342                               {
<a name="l02343"></a>02343                                     <span class="keywordflow">if</span>( pp-&gt;Inv[ i ].fFlags &amp; OBJECT_NO_OVERWRITE )
<a name="l02344"></a>02344                                           <span class="keywordflow">break</span>;
<a name="l02345"></a>02345                                     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( ubNumMatches-- )  )
<a name="l02346"></a>02346                                     {
<a name="l02347"></a>02347                                           pp-&gt;Inv[ i ].fFlags &amp;= ~OBJECT_UNDROPPABLE;
<a name="l02348"></a>02348                                           <span class="keywordflow">break</span>;
<a name="l02349"></a>02349                                     }
<a name="l02350"></a>02350                               }
<a name="l02351"></a>02351                         }
<a name="l02352"></a>02352                   }
<a name="l02353"></a>02353             }
<a name="l02354"></a>02354 
<a name="l02355"></a>02355             <span class="keywordflow">if</span>( fKit )
<a name="l02356"></a>02356             {
<a name="l02357"></a>02357                   ubNumMatches = 0;
<a name="l02358"></a>02358                   <span class="keywordflow">for</span>( i = 0; i &lt; <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc878553e9a668bdf9e2a72b855424ee1bdabcf">NUM_INV_SLOTS</a>; i++ )
<a name="l02359"></a>02359                   {
<a name="l02360"></a>02360                         uiItemClass = <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ pp-&gt;Inv[ i ].usItem ].<a class="code" href="structINVTYPE.html#1f63e61536407cc997a998585017ba07">usItemClass</a>;
<a name="l02361"></a>02361                         <span class="keywordflow">if</span>( uiItemClass == IC_MEDKIT || uiItemClass == IC_KIT )
<a name="l02362"></a>02362                         {
<a name="l02363"></a>02363                               <span class="keywordflow">if</span>( pp-&gt;Inv[ i ].fFlags &amp; OBJECT_NO_OVERWRITE )
<a name="l02364"></a>02364                                     <span class="keywordflow">break</span>;
<a name="l02365"></a>02365                               <span class="keywordflow">else</span>
<a name="l02366"></a>02366                                     ubNumMatches++;
<a name="l02367"></a>02367                         }
<a name="l02368"></a>02368                   }
<a name="l02369"></a>02369                   <span class="keywordflow">if</span> ( ubNumMatches &gt; 0 )
<a name="l02370"></a>02370                   {
<a name="l02371"></a>02371                         <span class="keywordflow">for</span>( i = 0; i &lt; <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc878553e9a668bdf9e2a72b855424ee1bdabcf">NUM_INV_SLOTS</a>; i++ )
<a name="l02372"></a>02372                         {
<a name="l02373"></a>02373                               uiItemClass = <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ pp-&gt;Inv[ i ].usItem ].<a class="code" href="structINVTYPE.html#1f63e61536407cc997a998585017ba07">usItemClass</a>;
<a name="l02374"></a>02374                               <span class="keywordflow">if</span>( uiItemClass == IC_MEDKIT || uiItemClass == IC_KIT )
<a name="l02375"></a>02375                               {
<a name="l02376"></a>02376                                     <span class="keywordflow">if</span>( pp-&gt;Inv[ i ].fFlags &amp; OBJECT_NO_OVERWRITE )
<a name="l02377"></a>02377                                           <span class="keywordflow">break</span>;
<a name="l02378"></a>02378                                     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( ubNumMatches-- )  )
<a name="l02379"></a>02379                                     {
<a name="l02380"></a>02380                                           pp-&gt;Inv[ i ].fFlags &amp;= ~OBJECT_UNDROPPABLE;
<a name="l02381"></a>02381                                           <span class="keywordflow">break</span>;
<a name="l02382"></a>02382                                     }
<a name="l02383"></a>02383                               }
<a name="l02384"></a>02384                         }
<a name="l02385"></a>02385                   }
<a name="l02386"></a>02386             }
<a name="l02387"></a>02387 
<a name="l02388"></a>02388             <span class="keywordflow">if</span>( fFace )
<a name="l02389"></a>02389             {
<a name="l02390"></a>02390                   ubNumMatches = 0;
<a name="l02391"></a>02391                   <span class="keywordflow">for</span>( i = 0; i &lt; <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc878553e9a668bdf9e2a72b855424ee1bdabcf">NUM_INV_SLOTS</a>; i++ )
<a name="l02392"></a>02392                   {
<a name="l02393"></a>02393                         uiItemClass = <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ pp-&gt;Inv[ i ].usItem ].<a class="code" href="structINVTYPE.html#1f63e61536407cc997a998585017ba07">usItemClass</a>;
<a name="l02394"></a>02394                         <span class="keywordflow">if</span>( uiItemClass == IC_FACE )
<a name="l02395"></a>02395                         {
<a name="l02396"></a>02396                               <span class="keywordflow">if</span>( pp-&gt;Inv[ i ].fFlags &amp; OBJECT_NO_OVERWRITE )
<a name="l02397"></a>02397                                     <span class="keywordflow">break</span>;
<a name="l02398"></a>02398                               <span class="keywordflow">else</span>
<a name="l02399"></a>02399                                     ubNumMatches++;
<a name="l02400"></a>02400                         }
<a name="l02401"></a>02401                   }
<a name="l02402"></a>02402                   <span class="keywordflow">if</span> ( ubNumMatches &gt; 0 )
<a name="l02403"></a>02403                   {
<a name="l02404"></a>02404                         <span class="keywordflow">for</span>( i = 0; i &lt; <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc878553e9a668bdf9e2a72b855424ee1bdabcf">NUM_INV_SLOTS</a>; i++ )
<a name="l02405"></a>02405                         {
<a name="l02406"></a>02406                               uiItemClass = <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ pp-&gt;Inv[ i ].usItem ].<a class="code" href="structINVTYPE.html#1f63e61536407cc997a998585017ba07">usItemClass</a>;
<a name="l02407"></a>02407                               <span class="keywordflow">if</span>( uiItemClass == IC_FACE )
<a name="l02408"></a>02408                               {
<a name="l02409"></a>02409                                     <span class="keywordflow">if</span>( pp-&gt;Inv[ i ].fFlags &amp; OBJECT_NO_OVERWRITE )
<a name="l02410"></a>02410                                           <span class="keywordflow">break</span>;
<a name="l02411"></a>02411                                     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( ubNumMatches-- ) )
<a name="l02412"></a>02412                                     {
<a name="l02413"></a>02413                                           pp-&gt;Inv[ i ].fFlags &amp;= ~OBJECT_UNDROPPABLE;
<a name="l02414"></a>02414                                           <span class="keywordflow">break</span>;
<a name="l02415"></a>02415                                     }
<a name="l02416"></a>02416                               }
<a name="l02417"></a>02417                         }
<a name="l02418"></a>02418                   }
<a name="l02419"></a>02419             }
<a name="l02420"></a>02420 
<a name="l02421"></a>02421             <span class="keywordflow">if</span>( fMisc )
<a name="l02422"></a>02422             {
<a name="l02423"></a>02423                   ubNumMatches = 0;
<a name="l02424"></a>02424                   <span class="keywordflow">for</span>( i = 0; i &lt; <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc878553e9a668bdf9e2a72b855424ee1bdabcf">NUM_INV_SLOTS</a>; i++ )
<a name="l02425"></a>02425                   {
<a name="l02426"></a>02426                         uiItemClass = <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ pp-&gt;Inv[ i ].usItem ].<a class="code" href="structINVTYPE.html#1f63e61536407cc997a998585017ba07">usItemClass</a>;
<a name="l02427"></a>02427                         <span class="keywordflow">if</span>( uiItemClass == IC_MISC )
<a name="l02428"></a>02428                         {
<a name="l02429"></a>02429                               <span class="keywordflow">if</span>( pp-&gt;Inv[ i ].fFlags &amp; OBJECT_NO_OVERWRITE )
<a name="l02430"></a>02430                                     <span class="keywordflow">break</span>;
<a name="l02431"></a>02431                               <span class="keywordflow">else</span>
<a name="l02432"></a>02432                                     ubNumMatches++;
<a name="l02433"></a>02433                         }
<a name="l02434"></a>02434                   }
<a name="l02435"></a>02435                   <span class="keywordflow">if</span> ( ubNumMatches &gt; 0 )
<a name="l02436"></a>02436                   {
<a name="l02437"></a>02437                         <span class="keywordflow">for</span>( i = 0; i &lt; <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc878553e9a668bdf9e2a72b855424ee1bdabcf">NUM_INV_SLOTS</a>; i++ )
<a name="l02438"></a>02438                         {
<a name="l02439"></a>02439                               uiItemClass = <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ pp-&gt;Inv[ i ].usItem ].<a class="code" href="structINVTYPE.html#1f63e61536407cc997a998585017ba07">usItemClass</a>;
<a name="l02440"></a>02440                               <span class="keywordflow">if</span>( uiItemClass == IC_MISC )
<a name="l02441"></a>02441                               {
<a name="l02442"></a>02442                                     <span class="keywordflow">if</span>( pp-&gt;Inv[ i ].fFlags &amp; OBJECT_NO_OVERWRITE )
<a name="l02443"></a>02443                                           <span class="keywordflow">break</span>;
<a name="l02444"></a>02444                                     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( ubNumMatches-- ) )
<a name="l02445"></a>02445                                     {
<a name="l02446"></a>02446                                           pp-&gt;Inv[ i ].fFlags &amp;= ~OBJECT_UNDROPPABLE;
<a name="l02447"></a>02447                                           <span class="keywordflow">break</span>;
<a name="l02448"></a>02448                                     }
<a name="l02449"></a>02449                               }
<a name="l02450"></a>02450                         }
<a name="l02451"></a>02451                   }
<a name="l02452"></a>02452             }
<a name="l02453"></a>02453       }
<a name="l02454"></a>02454       <span class="comment">// WANNE: Drop-rate from different XML-Files</span>
<a name="l02455"></a>02455       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="GameSettings_8cpp.html#5c32f930e2fef384505c4b91803a92c2">gGameExternalOptions</a>.<a class="code" href="structGAME__EXTERNAL__OPTIONS.html#91ca30a5ad1050b5edf78964830f7b27">ubEnemiesItemDrop</a> == 1)
<a name="l02456"></a>02456       {
<a name="l02457"></a>02457             <span class="comment">// Loop through the enemy inter</span>
<a name="l02458"></a>02458             <span class="keywordflow">for</span>( i = 0; i &lt; <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc878553e9a668bdf9e2a72b855424ee1bdabcf">NUM_INV_SLOTS</a>; i++ )
<a name="l02459"></a>02459                   {
<a name="l02460"></a>02460                         uiItemClass = <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ pp-&gt;Inv[ i ].usItem ].<a class="code" href="structINVTYPE.html#1f63e61536407cc997a998585017ba07">usItemClass</a>;
<a name="l02461"></a>02461 
<a name="l02462"></a>02462                         <span class="comment">// We are allowed to change the object and it is not the first (nothing) object</span>
<a name="l02463"></a>02463                         <span class="comment">//if(! (pp-&gt;Inv[ i ].fFlags &amp; OBJECT_NO_OVERWRITE ) &amp;&amp; pp-&gt;Inv[ i ].usItem != 0)</span>
<a name="l02464"></a>02464                         <span class="keywordflow">if</span>( pp-&gt;Inv[ i ].usItem != 0)
<a name="l02465"></a>02465                         {
<a name="l02466"></a>02466                               <span class="comment">// Weapon</span>
<a name="l02467"></a>02467                               <span class="keywordflow">if</span>( uiItemClass == IC_GUN)
<a name="l02468"></a>02468                               {
<a name="l02469"></a>02469                                     <span class="comment">// Find matching weaponType in the XML</span>
<a name="l02470"></a>02470                                     for (j = 0; j &lt; MAX_DROP_ITEMS; j++)
<a name="l02471"></a>02471                                     {
<a name="l02472"></a>02472                                           <span class="comment">// We have no more weapon items -&gt; exit from loop</span>
<a name="l02473"></a>02473                                           <span class="keywordflow">if</span> (j &gt; 0 &amp;&amp; <a class="code" href="EnemyItemDrops_8cpp.html#30181fd4ce2d13148b68e07c39f2ea3b">gEnemyWeaponDrops</a>[j].uiIndex == 0)
<a name="l02474"></a>02474                                                 <span class="keywordflow">break</span>;
<a name="l02475"></a>02475 
<a name="l02476"></a>02476                                           <span class="comment">// We found the matching weapon type</span>
<a name="l02477"></a>02477                                           <span class="keywordflow">if</span> (<a class="code" href="Weapons_8cpp.html#fac72e30bc7c36f55257eac0542ce51d">Weapon</a>[ <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ pp-&gt;Inv[ i ].usItem ].<a class="code" href="structINVTYPE.html#8f52f99607debfdbb9a8dbf9e43c1967">ubClassIndex</a> ].ubWeaponType == <a class="code" href="EnemyItemDrops_8cpp.html#30181fd4ce2d13148b68e07c39f2ea3b">gEnemyWeaponDrops</a>[j].<a class="code" href="structWEAPON__DROPS.html#9301792637ed7900d929ec3dbe5e23c3">ubWeaponType</a>)
<a name="l02478"></a>02478                                           {
<a name="l02479"></a>02479                                                 uiRandomValue = <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(100);
<a name="l02480"></a>02480 
<a name="l02481"></a>02481                                                 <span class="keywordflow">if</span> (uiRandomValue == 0)
<a name="l02482"></a>02482                                                       uiRandomValue++;
<a name="l02483"></a>02483 
<a name="l02484"></a>02484                                                 <span class="comment">// militia</span>
<a name="l02485"></a>02485                                                 <span class="keywordflow">if</span> ( SOLDIER_CLASS_MILITIA( bSoldierClass ) )
<a name="l02486"></a>02486                                                 {
<a name="l02487"></a>02487                                                       <span class="comment">// Drop the item!</span>
<a name="l02488"></a>02488                                                       <span class="keywordflow">if</span> (uiRandomValue &lt;= <a class="code" href="EnemyItemDrops_8cpp.html#30181fd4ce2d13148b68e07c39f2ea3b">gEnemyWeaponDrops</a>[j].ubMilitiaDropRate)
<a name="l02489"></a>02489                                                       {
<a name="l02490"></a>02490                                                             pp-&gt;Inv[ i ].fFlags &amp;= ~OBJECT_UNDROPPABLE;
<a name="l02491"></a>02491                                                       }
<a name="l02492"></a>02492                                                 }
<a name="l02493"></a>02493                                                 <span class="comment">// enemy</span>
<a name="l02494"></a>02494                                                 <span class="keywordflow">else</span>
<a name="l02495"></a>02495                                                 {
<a name="l02496"></a>02496                                                       <span class="comment">// Drop the item!</span>
<a name="l02497"></a>02497                                                       <span class="keywordflow">if</span> (uiRandomValue &lt;= <a class="code" href="EnemyItemDrops_8cpp.html#30181fd4ce2d13148b68e07c39f2ea3b">gEnemyWeaponDrops</a>[j].ubEnemyDropRate)
<a name="l02498"></a>02498                                                       {
<a name="l02499"></a>02499                                                             pp-&gt;Inv[ i ].fFlags &amp;= ~OBJECT_UNDROPPABLE;
<a name="l02500"></a>02500                                                       }
<a name="l02501"></a>02501                                                 }
<a name="l02502"></a>02502 
<a name="l02503"></a>02503                                                 <span class="keywordflow">break</span>;
<a name="l02504"></a>02504                                           }
<a name="l02505"></a>02505                                     }
<a name="l02506"></a>02506                               }
<a name="l02507"></a>02507                               <span class="comment">// Ammo</span>
<a name="l02508"></a>02508                               <span class="keywordflow">else</span> <span class="keywordflow">if</span> (uiItemClass == IC_AMMO)
<a name="l02509"></a>02509                               {
<a name="l02510"></a>02510                                     <span class="comment">// Find matching ammo in the XML</span>
<a name="l02511"></a>02511                                     <span class="keywordflow">for</span> (j = 0; j &lt; MAX_DROP_ITEMS; j++)
<a name="l02512"></a>02512                                     {
<a name="l02513"></a>02513                                           <span class="comment">// We have no more ammo items -&gt; exit from loop</span>
<a name="l02514"></a>02514                                           <span class="keywordflow">if</span> (j &gt; 0 &amp;&amp; <a class="code" href="EnemyItemDrops_8cpp.html#8b3e308194379cca0401597a71834f10">gEnemyAmmoDrops</a>[j].uiIndex == 0)
<a name="l02515"></a>02515                                                 <span class="keywordflow">break</span>;
<a name="l02516"></a>02516 
<a name="l02517"></a>02517                                           <span class="comment">// We found the matching ammo type</span>
<a name="l02518"></a>02518                                           <span class="keywordflow">if</span> (<a class="code" href="Weapons_8cpp.html#5881a7295b606ac73bf0dddd7d1c80a5">Magazine</a>[ <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ pp-&gt;Inv[ i ].usItem ].<a class="code" href="structINVTYPE.html#8f52f99607debfdbb9a8dbf9e43c1967">ubClassIndex</a> ].ubAmmoType == <a class="code" href="EnemyItemDrops_8cpp.html#8b3e308194379cca0401597a71834f10">gEnemyAmmoDrops</a>[j].<a class="code" href="structAMMO__DROPS.html#6defa0d17498355381ce52d7aaf317fc">uiType</a>)
<a name="l02519"></a>02519                                           {
<a name="l02520"></a>02520                                                 uiRandomValue = <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(100);
<a name="l02521"></a>02521 
<a name="l02522"></a>02522                                                 <span class="keywordflow">if</span> (uiRandomValue == 0)
<a name="l02523"></a>02523                                                       uiRandomValue++;
<a name="l02524"></a>02524 
<a name="l02525"></a>02525                                                 <span class="comment">// militia</span>
<a name="l02526"></a>02526                                                 <span class="keywordflow">if</span> ( SOLDIER_CLASS_MILITIA( bSoldierClass ) )
<a name="l02527"></a>02527                                                 {
<a name="l02528"></a>02528                                                       <span class="comment">// Drop the item!</span>
<a name="l02529"></a>02529                                                       <span class="keywordflow">if</span> (uiRandomValue &lt;= <a class="code" href="EnemyItemDrops_8cpp.html#8b3e308194379cca0401597a71834f10">gEnemyAmmoDrops</a>[j].ubMilitiaDropRate)
<a name="l02530"></a>02530                                                       {
<a name="l02531"></a>02531                                                             pp-&gt;Inv[ i ].fFlags &amp;= ~OBJECT_UNDROPPABLE;
<a name="l02532"></a>02532                                                       }
<a name="l02533"></a>02533                                                 }
<a name="l02534"></a>02534                                                 <span class="keywordflow">else</span>
<a name="l02535"></a>02535                                                 {
<a name="l02536"></a>02536                                                       <span class="comment">// Drop the item!</span>
<a name="l02537"></a>02537                                                       <span class="keywordflow">if</span> (uiRandomValue &lt;= <a class="code" href="EnemyItemDrops_8cpp.html#8b3e308194379cca0401597a71834f10">gEnemyAmmoDrops</a>[j].ubEnemyDropRate)
<a name="l02538"></a>02538                                                       {
<a name="l02539"></a>02539                                                             pp-&gt;Inv[ i ].fFlags &amp;= ~OBJECT_UNDROPPABLE;
<a name="l02540"></a>02540                                                       }
<a name="l02541"></a>02541                                                 }
<a name="l02542"></a>02542 
<a name="l02543"></a>02543                                                 <span class="keywordflow">break</span>;
<a name="l02544"></a>02544                                           }
<a name="l02545"></a>02545                                     }
<a name="l02546"></a>02546                               }
<a name="l02547"></a>02547                               <span class="comment">// Explosive</span>
<a name="l02548"></a>02548                               <span class="keywordflow">else</span> <span class="keywordflow">if</span> (uiItemClass == IC_GRENADE || uiItemClass == IC_BOMB)
<a name="l02549"></a>02549                               {
<a name="l02550"></a>02550                                     <span class="comment">// Find matching explosive in the XML</span>
<a name="l02551"></a>02551                                     <span class="keywordflow">for</span> (j = 0; j &lt; MAX_DROP_ITEMS; j++)
<a name="l02552"></a>02552                                     {
<a name="l02553"></a>02553                                           <span class="comment">// We have no more explosive items -&gt; exit from loop</span>
<a name="l02554"></a>02554                                           <span class="keywordflow">if</span> (j &gt; 0 &amp;&amp; <a class="code" href="EnemyItemDrops_8cpp.html#75644159033cad799e063a2a2aa9e18d">gEnemyExplosiveDrops</a>[j].uiIndex == 0)
<a name="l02555"></a>02555                                                 <span class="keywordflow">break</span>;
<a name="l02556"></a>02556 
<a name="l02557"></a>02557                                           <span class="comment">// We found the matching explosive type</span>
<a name="l02558"></a>02558                                           <span class="keywordflow">if</span> (<a class="code" href="Weapons_8cpp.html#2c2ae92d28e595deaada6adf85ed5c44">Explosive</a>[<a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ pp-&gt;Inv[ i ].usItem ].<a class="code" href="structINVTYPE.html#8f52f99607debfdbb9a8dbf9e43c1967">ubClassIndex</a>].ubType == <a class="code" href="EnemyItemDrops_8cpp.html#75644159033cad799e063a2a2aa9e18d">gEnemyExplosiveDrops</a>[j].<a class="code" href="structEXPLOSIVE__DROPS.html#c00e025f8164eaaf803ee22e63e8c869">ubType</a>)
<a name="l02559"></a>02559                                           {
<a name="l02560"></a>02560                                                 uiRandomValue = <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(100);
<a name="l02561"></a>02561 
<a name="l02562"></a>02562                                                 <span class="keywordflow">if</span> (uiRandomValue == 0)
<a name="l02563"></a>02563                                                       uiRandomValue++;
<a name="l02564"></a>02564 
<a name="l02565"></a>02565                                                 <span class="comment">// militia</span>
<a name="l02566"></a>02566                                                 <span class="keywordflow">if</span> ( SOLDIER_CLASS_MILITIA( bSoldierClass ) )
<a name="l02567"></a>02567                                                 {
<a name="l02568"></a>02568                                                       <span class="comment">// Drop the item!</span>
<a name="l02569"></a>02569                                                       <span class="keywordflow">if</span> (uiRandomValue &lt;= <a class="code" href="EnemyItemDrops_8cpp.html#75644159033cad799e063a2a2aa9e18d">gEnemyExplosiveDrops</a>[j].ubMilitiaDropRate)
<a name="l02570"></a>02570                                                       {
<a name="l02571"></a>02571                                                             pp-&gt;Inv[ i ].fFlags &amp;= ~OBJECT_UNDROPPABLE;
<a name="l02572"></a>02572                                                       }
<a name="l02573"></a>02573                                                 }
<a name="l02574"></a>02574                                                 <span class="comment">// enemy</span>
<a name="l02575"></a>02575                                                 <span class="keywordflow">else</span>
<a name="l02576"></a>02576                                                 {
<a name="l02577"></a>02577                                                       <span class="comment">// Drop the item!</span>
<a name="l02578"></a>02578                                                       <span class="keywordflow">if</span> (uiRandomValue &lt;= <a class="code" href="EnemyItemDrops_8cpp.html#75644159033cad799e063a2a2aa9e18d">gEnemyExplosiveDrops</a>[j].ubEnemyDropRate)
<a name="l02579"></a>02579                                                       {
<a name="l02580"></a>02580                                                             pp-&gt;Inv[ i ].fFlags &amp;= ~OBJECT_UNDROPPABLE;
<a name="l02581"></a>02581                                                       }
<a name="l02582"></a>02582                                                 }
<a name="l02583"></a>02583 
<a name="l02584"></a>02584                                                 
<a name="l02585"></a>02585                                                 <span class="keywordflow">break</span>;
<a name="l02586"></a>02586                                           }
<a name="l02587"></a>02587                                     }
<a name="l02588"></a>02588                               }
<a name="l02589"></a>02589                               <span class="comment">// Armour</span>
<a name="l02590"></a>02590                               <span class="keywordflow">else</span> <span class="keywordflow">if</span> (uiItemClass == IC_ARMOUR)
<a name="l02591"></a>02591                               {
<a name="l02592"></a>02592                                     <span class="comment">// Find matching armour in the XML</span>
<a name="l02593"></a>02593                                     <span class="keywordflow">for</span> (j = 0; j &lt; MAX_DROP_ITEMS; j++)
<a name="l02594"></a>02594                                     {
<a name="l02595"></a>02595                                           <span class="comment">// We have no more armour items -&gt; exit from loop</span>
<a name="l02596"></a>02596                                           <span class="keywordflow">if</span> (j &gt; 0 &amp;&amp; <a class="code" href="EnemyItemDrops_8cpp.html#5b6611cd5268248c180606e429bf47f2">gEnemyArmourDrops</a>[j].uiIndex == 0)
<a name="l02597"></a>02597                                                 <span class="keywordflow">break</span>;
<a name="l02598"></a>02598 
<a name="l02599"></a>02599                                           <span class="comment">// We found the matching armour type</span>
<a name="l02600"></a>02600                                           <span class="keywordflow">if</span> (<a class="code" href="Weapons_8cpp.html#54e6d0ad7e147f581bec4c56ca4a27cd">Armour</a>[ <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ pp-&gt;Inv[ i ].usItem ].<a class="code" href="structINVTYPE.html#8f52f99607debfdbb9a8dbf9e43c1967">ubClassIndex</a> ].ubArmourClass == <a class="code" href="EnemyItemDrops_8cpp.html#5b6611cd5268248c180606e429bf47f2">gEnemyArmourDrops</a>[j].<a class="code" href="structARMOUR__DROPS.html#545b8e540aa329fbdb035034f5c8c3a3">ubArmourClass</a>)
<a name="l02601"></a>02601                                           {
<a name="l02602"></a>02602                                                 uiRandomValue = <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(100);
<a name="l02603"></a>02603 
<a name="l02604"></a>02604                                                 <span class="keywordflow">if</span> (uiRandomValue == 0)
<a name="l02605"></a>02605                                                       uiRandomValue++;
<a name="l02606"></a>02606 
<a name="l02607"></a>02607                                                 <span class="comment">// militia</span>
<a name="l02608"></a>02608                                                 <span class="keywordflow">if</span> ( SOLDIER_CLASS_MILITIA( bSoldierClass ) )
<a name="l02609"></a>02609                                                 {
<a name="l02610"></a>02610                                                       <span class="comment">// Drop the item!</span>
<a name="l02611"></a>02611                                                       <span class="keywordflow">if</span> (uiRandomValue &lt;= <a class="code" href="EnemyItemDrops_8cpp.html#5b6611cd5268248c180606e429bf47f2">gEnemyArmourDrops</a>[j].ubMilitiaDropRate)
<a name="l02612"></a>02612                                                       {
<a name="l02613"></a>02613                                                             pp-&gt;Inv[ i ].fFlags &amp;= ~OBJECT_UNDROPPABLE;
<a name="l02614"></a>02614                                                       }
<a name="l02615"></a>02615                                                 }
<a name="l02616"></a>02616                                                 <span class="comment">// enemy</span>
<a name="l02617"></a>02617                                                 <span class="keywordflow">else</span>
<a name="l02618"></a>02618                                                 {
<a name="l02619"></a>02619                                                       <span class="comment">// Drop the item!</span>
<a name="l02620"></a>02620                                                       <span class="keywordflow">if</span> (uiRandomValue &lt;= <a class="code" href="EnemyItemDrops_8cpp.html#5b6611cd5268248c180606e429bf47f2">gEnemyArmourDrops</a>[j].ubEnemyDropRate)
<a name="l02621"></a>02621                                                       {
<a name="l02622"></a>02622                                                             pp-&gt;Inv[ i ].fFlags &amp;= ~OBJECT_UNDROPPABLE;
<a name="l02623"></a>02623                                                       }
<a name="l02624"></a>02624                                                 }
<a name="l02625"></a>02625 
<a name="l02626"></a>02626                                                 <span class="keywordflow">break</span>;
<a name="l02627"></a>02627                                           }
<a name="l02628"></a>02628                                     }
<a name="l02629"></a>02629                               }
<a name="l02630"></a>02630                               <span class="comment">// Misc</span>
<a name="l02631"></a>02631                               <span class="keywordflow">else</span> <span class="keywordflow">if</span> (uiItemClass == IC_BLADE || uiItemClass == IC_MEDKIT || uiItemClass == IC_KIT ||
<a name="l02632"></a>02632                                     uiItemClass == IC_THROWING_KNIFE || uiItemClass == IC_LAUNCHER || 
<a name="l02633"></a>02633                                     uiItemClass == IC_APPLIABLE || uiItemClass == IC_FACE || uiItemClass == IC_TENTACLES || 
<a name="l02634"></a>02634                                     uiItemClass == IC_THROWN || uiItemClass == IC_PUNCH || uiItemClass == IC_KEY || 
<a name="l02635"></a>02635                                     uiItemClass == IC_MISC || uiItemClass == IC_MONEY)
<a name="l02636"></a>02636                               {
<a name="l02637"></a>02637                                     <span class="comment">// Find matching armour in the XML</span>
<a name="l02638"></a>02638                                     <span class="keywordflow">for</span> (j = 0; j &lt; MAX_DROP_ITEMS; j++)
<a name="l02639"></a>02639                                     {
<a name="l02640"></a>02640                                           <span class="comment">// We have no more armour items -&gt; exit from loop</span>
<a name="l02641"></a>02641                                           <span class="keywordflow">if</span> (j &gt; 0 &amp;&amp; <a class="code" href="EnemyItemDrops_8cpp.html#ff78ce56fd6eb458baa7b0064cd7f7c0">gEnemyMiscDrops</a>[j].uiIndex == 0)
<a name="l02642"></a>02642                                                 <span class="keywordflow">break</span>;
<a name="l02643"></a>02643 
<a name="l02644"></a>02644                                           <span class="comment">// We found the matching armour type</span>
<a name="l02645"></a>02645                                           <span class="keywordflow">if</span> (<a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ pp-&gt;Inv[ i ].usItem ].<a class="code" href="structINVTYPE.html#1f63e61536407cc997a998585017ba07">usItemClass</a> == <a class="code" href="EnemyItemDrops_8cpp.html#ff78ce56fd6eb458baa7b0064cd7f7c0">gEnemyMiscDrops</a>[j].<a class="code" href="structMISC__DROPS.html#b4ba94b59aea1b11d88a5f9c1522a78b">usItemClass</a>)
<a name="l02646"></a>02646                                           {
<a name="l02647"></a>02647                                                 uiRandomValue = <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(100);
<a name="l02648"></a>02648 
<a name="l02649"></a>02649                                                 <span class="keywordflow">if</span> (uiRandomValue == 0)
<a name="l02650"></a>02650                                                       uiRandomValue++;
<a name="l02651"></a>02651 
<a name="l02652"></a>02652                                                 <span class="comment">// militia</span>
<a name="l02653"></a>02653                                                 <span class="keywordflow">if</span> ( SOLDIER_CLASS_MILITIA( bSoldierClass ) )
<a name="l02654"></a>02654                                                 {
<a name="l02655"></a>02655                                                       <span class="comment">// Drop the item!</span>
<a name="l02656"></a>02656                                                       <span class="keywordflow">if</span> (uiRandomValue &lt;= <a class="code" href="EnemyItemDrops_8cpp.html#ff78ce56fd6eb458baa7b0064cd7f7c0">gEnemyMiscDrops</a>[j].ubMilitiaDropRate)
<a name="l02657"></a>02657                                                       {
<a name="l02658"></a>02658                                                             pp-&gt;Inv[ i ].fFlags &amp;= ~OBJECT_UNDROPPABLE;
<a name="l02659"></a>02659                                                       }
<a name="l02660"></a>02660                                                 }
<a name="l02661"></a>02661                                                 <span class="comment">// enemy</span>
<a name="l02662"></a>02662                                                 <span class="keywordflow">else</span>
<a name="l02663"></a>02663                                                 {
<a name="l02664"></a>02664                                                       <span class="comment">// Drop the item!</span>
<a name="l02665"></a>02665                                                       <span class="keywordflow">if</span> (uiRandomValue &lt;= <a class="code" href="EnemyItemDrops_8cpp.html#ff78ce56fd6eb458baa7b0064cd7f7c0">gEnemyMiscDrops</a>[j].ubEnemyDropRate)
<a name="l02666"></a>02666                                                       {
<a name="l02667"></a>02667                                                             pp-&gt;Inv[ i ].fFlags &amp;= ~OBJECT_UNDROPPABLE;
<a name="l02668"></a>02668                                                       }
<a name="l02669"></a>02669                                                 }
<a name="l02670"></a>02670 
<a name="l02671"></a>02671                                                 <span class="keywordflow">break</span>;
<a name="l02672"></a>02672                                           }
<a name="l02673"></a>02673                                     }
<a name="l02674"></a>02674                               }
<a name="l02675"></a>02675                         }
<a name="l02676"></a>02676                   }
<a name="l02677"></a>02677       }
<a name="l02678"></a>02678 }
<a name="l02679"></a>02679 
<a name="l02680"></a>02680 
<a name="l02681"></a><a class="code" href="Inventory_01Choosing_8h.html#3720751e9cfe901bea91c7c5efeefcce">02681</a> <span class="keywordtype">void</span> <a class="code" href="Inventory_01Choosing_8cpp.html#3720751e9cfe901bea91c7c5efeefcce">AssignCreatureInventory</a>( <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> )
<a name="l02682"></a>02682 {
<a name="l02683"></a>02683       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiChanceToDrop = 0;
<a name="l02684"></a>02684       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fMaleCreature = FALSE;
<a name="l02685"></a>02685       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fBloodcat = FALSE;
<a name="l02686"></a>02686 
<a name="l02687"></a>02687       <span class="comment">// all creature items in this first section are only offensive/defensive placeholders, and</span>
<a name="l02688"></a>02688       <span class="comment">// never get dropped, because they're not real items!</span>
<a name="l02689"></a>02689       <span class="keywordflow">switch</span>( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#b082364eed3d7883662f69e1fd96be1a">ubBodyType</a>)
<a name="l02690"></a>02690       {
<a name="l02691"></a>02691             <span class="keywordflow">case</span> <a class="code" href="Animation_01Data_8h.html#d295a916825180b548473dec560093a78e8f2de8ab141e991ee2b34ebb1dfda1">ADULTFEMALEMONSTER</a>:
<a name="l02692"></a>02692                   <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f42dc34b69ab85cd189ce02fe24a4c840e">CREATURE_OLD_FEMALE_CLAWS</a>,    100, &amp;(<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#13c875b952b6d634680165d127a9870b">inv</a>[<a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855408e678e638d95e18d5e9a2a64a96e2e">HANDPOS</a>]) );
<a name="l02693"></a>02693                   <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4083e06c4837ce52412f21628c1415a3b">CREATURE_OLD_FEMALE_HIDE</a>,           100, &amp;(<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#13c875b952b6d634680165d127a9870b">inv</a>[<a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc878551e1de377a2d80cf67fd63934f134956d">HELMETPOS</a>]) );
<a name="l02694"></a>02694                   <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4083e06c4837ce52412f21628c1415a3b">CREATURE_OLD_FEMALE_HIDE</a>,           100, &amp;(<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#13c875b952b6d634680165d127a9870b">inv</a>[<a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855afc78e6fc0aaffa92d59c2fe506f5c6a">VESTPOS</a>]) );
<a name="l02695"></a>02695                   <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4083e06c4837ce52412f21628c1415a3b">CREATURE_OLD_FEMALE_HIDE</a>,           100, &amp;(<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#13c875b952b6d634680165d127a9870b">inv</a>[<a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855c1f8517c3795dd56e0c2450e625753dc">LEGPOS</a>]) );                
<a name="l02696"></a>02696                   uiChanceToDrop = 30;
<a name="l02697"></a>02697                   <span class="keywordflow">break</span>;
<a name="l02698"></a>02698             <span class="keywordflow">case</span> <a class="code" href="Animation_01Data_8h.html#d295a916825180b548473dec560093a79dec21a470d88f8b8a8704cb9b5ac827">AM_MONSTER</a>:
<a name="l02699"></a>02699                   <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4d3bc1189ca2f9edeb2b0f9c4078ec35e">CREATURE_OLD_MALE_CLAWS</a>,            100, &amp;(<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#13c875b952b6d634680165d127a9870b">inv</a>[<a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855408e678e638d95e18d5e9a2a64a96e2e">HANDPOS</a>]) );
<a name="l02700"></a>02700                   <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4fc17f6c6b2f7571c62184561de9d0ed6">CREATURE_OLD_MALE_SPIT</a>,             100, &amp;(<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#13c875b952b6d634680165d127a9870b">inv</a>[<a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855009684dc553cebead620fa082b29cb86">SECONDHANDPOS</a>]) );
<a name="l02701"></a>02701                   <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f48fd4246e25a68f7eacf1833f29133cfd">CREATURE_OLD_MALE_HIDE</a>,             100, &amp;(<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#13c875b952b6d634680165d127a9870b">inv</a>[<a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc878551e1de377a2d80cf67fd63934f134956d">HELMETPOS</a>]) );
<a name="l02702"></a>02702                   <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f48fd4246e25a68f7eacf1833f29133cfd">CREATURE_OLD_MALE_HIDE</a>,             100, &amp;(<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#13c875b952b6d634680165d127a9870b">inv</a>[<a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855afc78e6fc0aaffa92d59c2fe506f5c6a">VESTPOS</a>]) );
<a name="l02703"></a>02703                   <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f48fd4246e25a68f7eacf1833f29133cfd">CREATURE_OLD_MALE_HIDE</a>,             100, &amp;(<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#13c875b952b6d634680165d127a9870b">inv</a>[<a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855c1f8517c3795dd56e0c2450e625753dc">LEGPOS</a>]) );                
<a name="l02704"></a>02704                   uiChanceToDrop = 30;
<a name="l02705"></a>02705                   fMaleCreature = TRUE;
<a name="l02706"></a>02706                   <span class="keywordflow">break</span>;
<a name="l02707"></a>02707             <span class="keywordflow">case</span> <a class="code" href="Animation_01Data_8h.html#d295a916825180b548473dec560093a75f60be3c60e156d8cec34802d7f3607b">YAF_MONSTER</a>:
<a name="l02708"></a>02708                   <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4f34ff86c4e9e9052cd67735d78b6f141">CREATURE_YOUNG_FEMALE_CLAWS</a>,        100, &amp;(<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#13c875b952b6d634680165d127a9870b">inv</a>[<a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855408e678e638d95e18d5e9a2a64a96e2e">HANDPOS</a>]) );
<a name="l02709"></a>02709                   <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4c5884185b1340b38e672efc711baff55">CREATURE_YOUNG_FEMALE_HIDE</a>,               100, &amp;(<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#13c875b952b6d634680165d127a9870b">inv</a>[<a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc878551e1de377a2d80cf67fd63934f134956d">HELMETPOS</a>]) );
<a name="l02710"></a>02710                   <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4c5884185b1340b38e672efc711baff55">CREATURE_YOUNG_FEMALE_HIDE</a>,               100, &amp;(<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#13c875b952b6d634680165d127a9870b">inv</a>[<a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855afc78e6fc0aaffa92d59c2fe506f5c6a">VESTPOS</a>]) );
<a name="l02711"></a>02711                   <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4c5884185b1340b38e672efc711baff55">CREATURE_YOUNG_FEMALE_HIDE</a>,               100, &amp;(<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#13c875b952b6d634680165d127a9870b">inv</a>[<a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855c1f8517c3795dd56e0c2450e625753dc">LEGPOS</a>]) );                
<a name="l02712"></a>02712                   uiChanceToDrop = 15;
<a name="l02713"></a>02713                   <span class="keywordflow">break</span>;
<a name="l02714"></a>02714             <span class="keywordflow">case</span> <a class="code" href="Animation_01Data_8h.html#d295a916825180b548473dec560093a725460f03079c143c4456f779763fa23b">YAM_MONSTER</a>:
<a name="l02715"></a>02715                   <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f45300e3b2d51e4ce95d10006d3e9f6be4">CREATURE_YOUNG_MALE_CLAWS</a>,          100, &amp;(<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#13c875b952b6d634680165d127a9870b">inv</a>[<a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855408e678e638d95e18d5e9a2a64a96e2e">HANDPOS</a>]) );
<a name="l02716"></a>02716                   <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f42060dc27510858b6a32ef2699b4048f5">CREATURE_YOUNG_MALE_SPIT</a>,                 100, &amp;(<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#13c875b952b6d634680165d127a9870b">inv</a>[<a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855009684dc553cebead620fa082b29cb86">SECONDHANDPOS</a>]) );
<a name="l02717"></a>02717                   <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f41507ce4e9165916646f5d241d010d920">CREATURE_YOUNG_MALE_HIDE</a>,                 100, &amp;(<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#13c875b952b6d634680165d127a9870b">inv</a>[<a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc878551e1de377a2d80cf67fd63934f134956d">HELMETPOS</a>]) );
<a name="l02718"></a>02718                   <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f41507ce4e9165916646f5d241d010d920">CREATURE_YOUNG_MALE_HIDE</a>,                 100, &amp;(<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#13c875b952b6d634680165d127a9870b">inv</a>[<a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855afc78e6fc0aaffa92d59c2fe506f5c6a">VESTPOS</a>]) );
<a name="l02719"></a>02719                   <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f41507ce4e9165916646f5d241d010d920">CREATURE_YOUNG_MALE_HIDE</a>,                 100, &amp;(<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#13c875b952b6d634680165d127a9870b">inv</a>[<a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855c1f8517c3795dd56e0c2450e625753dc">LEGPOS</a>]) );                
<a name="l02720"></a>02720                   uiChanceToDrop = 15;
<a name="l02721"></a>02721                   fMaleCreature = TRUE;
<a name="l02722"></a>02722                   <span class="keywordflow">break</span>;
<a name="l02723"></a>02723             <span class="keywordflow">case</span> <a class="code" href="Animation_01Data_8h.html#d295a916825180b548473dec560093a7e687bcc336b8be3ac4aac1346046d095">INFANT_MONSTER</a>:
<a name="l02724"></a>02724                   <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4ea340324feb67ded0aed3a4d92ad0463">CREATURE_INFANT_SPIT</a>,               100, &amp;(<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#13c875b952b6d634680165d127a9870b">inv</a>[<a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855408e678e638d95e18d5e9a2a64a96e2e">HANDPOS</a>]) );
<a name="l02725"></a>02725                   <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f49f8f51e15da512eb6bd1b52dd42e2c8b">CREATURE_INFANT_HIDE</a>,               100, &amp;(<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#13c875b952b6d634680165d127a9870b">inv</a>[<a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc878551e1de377a2d80cf67fd63934f134956d">HELMETPOS</a>]) );
<a name="l02726"></a>02726                   <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f49f8f51e15da512eb6bd1b52dd42e2c8b">CREATURE_INFANT_HIDE</a>,               100, &amp;(<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#13c875b952b6d634680165d127a9870b">inv</a>[<a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855afc78e6fc0aaffa92d59c2fe506f5c6a">VESTPOS</a>]) );
<a name="l02727"></a>02727                   <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f49f8f51e15da512eb6bd1b52dd42e2c8b">CREATURE_INFANT_HIDE</a>,               100, &amp;(<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#13c875b952b6d634680165d127a9870b">inv</a>[<a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855c1f8517c3795dd56e0c2450e625753dc">LEGPOS</a>]) );
<a name="l02728"></a>02728                   uiChanceToDrop = 5;
<a name="l02729"></a>02729                   <span class="keywordflow">break</span>;
<a name="l02730"></a>02730             <span class="keywordflow">case</span> <a class="code" href="Animation_01Data_8h.html#d295a916825180b548473dec560093a7c6b7363ef12dbe5ad2377613a3d33db9">LARVAE_MONSTER</a>:
<a name="l02731"></a>02731                   uiChanceToDrop = 0;
<a name="l02732"></a>02732                   <span class="keywordflow">break</span>;
<a name="l02733"></a>02733             <span class="keywordflow">case</span> <a class="code" href="Animation_01Data_8h.html#d295a916825180b548473dec560093a75f327a7c32f4f979f42e8d6f6adbf587">QUEENMONSTER</a>:
<a name="l02734"></a>02734                   <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f497bb534f1878ab0e63b249662f8c41a8">CREATURE_QUEEN_SPIT</a>,                100, &amp;(<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#13c875b952b6d634680165d127a9870b">inv</a>[<a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855408e678e638d95e18d5e9a2a64a96e2e">HANDPOS</a>]) );
<a name="l02735"></a>02735                   <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f48f21e0c0cf917abfd2c33dd126aca4da">CREATURE_QUEEN_TENTACLES</a>, 100, &amp;(<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#13c875b952b6d634680165d127a9870b">inv</a>[<a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855009684dc553cebead620fa082b29cb86">SECONDHANDPOS</a>]) );                   
<a name="l02736"></a>02736                   <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4e777fce16b90db825d1afc0f1d27abb6">CREATURE_QUEEN_HIDE</a>,                100, &amp;(<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#13c875b952b6d634680165d127a9870b">inv</a>[<a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc878551e1de377a2d80cf67fd63934f134956d">HELMETPOS</a>]) );
<a name="l02737"></a>02737                   <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4e777fce16b90db825d1afc0f1d27abb6">CREATURE_QUEEN_HIDE</a>,                100, &amp;(<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#13c875b952b6d634680165d127a9870b">inv</a>[<a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855afc78e6fc0aaffa92d59c2fe506f5c6a">VESTPOS</a>]) );
<a name="l02738"></a>02738                   <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4e777fce16b90db825d1afc0f1d27abb6">CREATURE_QUEEN_HIDE</a>,                100, &amp;(<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#13c875b952b6d634680165d127a9870b">inv</a>[<a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855c1f8517c3795dd56e0c2450e625753dc">LEGPOS</a>]) );
<a name="l02739"></a>02739                   <span class="comment">// she can't drop anything, because the items are unreachable anyways (she's too big!)</span>
<a name="l02740"></a>02740                   uiChanceToDrop = 0;
<a name="l02741"></a>02741                   <span class="keywordflow">break</span>;
<a name="l02742"></a>02742             <span class="keywordflow">case</span> <a class="code" href="Animation_01Data_8h.html#d295a916825180b548473dec560093a7fa470b7d78ba43f21bfd04c49f02a70b">BLOODCAT</a>:
<a name="l02743"></a>02743                   <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f46ee57e58546cb80d6f37a4b83eff5b89">BLOODCAT_CLAW_ATTACK</a>,         100, &amp;(<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#13c875b952b6d634680165d127a9870b">inv</a>[<a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855408e678e638d95e18d5e9a2a64a96e2e">HANDPOS</a>]) );
<a name="l02744"></a>02744                   <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4d016aa33fb746f5eab2c31a54782231c">BLOODCAT_BITE</a>,          100, &amp;(<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#13c875b952b6d634680165d127a9870b">inv</a>[<a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855009684dc553cebead620fa082b29cb86">SECONDHANDPOS</a>]) );
<a name="l02745"></a>02745                   fBloodcat = TRUE;
<a name="l02746"></a>02746                   uiChanceToDrop = 30;
<a name="l02747"></a>02747                   <span class="keywordflow">break</span>;
<a name="l02748"></a>02748 
<a name="l02749"></a>02749             <span class="keywordflow">default</span>:
<a name="l02750"></a>02750                   AssertMsg( FALSE, <a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>( <span class="stringliteral">"Invalid creature bodytype %d"</span>, <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#b082364eed3d7883662f69e1fd96be1a">ubBodyType</a> ) );
<a name="l02751"></a>02751                   <span class="keywordflow">return</span>;
<a name="l02752"></a>02752       }
<a name="l02753"></a>02753 
<a name="l02754"></a>02754       <span class="comment">// decide if the creature will drop any REAL bodyparts</span>
<a name="l02755"></a>02755       <span class="keywordflow">if</span> (<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(100) &lt; uiChanceToDrop)
<a name="l02756"></a>02756       {
<a name="l02757"></a>02757             <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( (<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>)(fBloodcat ? <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f485510795019565183ff5e9e040d0bb8d">BLOODCAT_CLAWS</a> : <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4ab4d61be90a835865bdda31b360c0b58">CREATURE_PART_CLAWS</a>), (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>) (80 + <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(21)), &amp;(<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#13c875b952b6d634680165d127a9870b">inv</a>[<a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc8785521434ace88498823088a193622a0ab42">BIGPOCK1POS</a>]) );
<a name="l02758"></a>02758       }
<a name="l02759"></a>02759 
<a name="l02760"></a>02760       <span class="keywordflow">if</span> (<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(100) &lt; uiChanceToDrop)
<a name="l02761"></a>02761       {
<a name="l02762"></a>02762             <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( (<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>)(fBloodcat ? <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f47a30969d6755d6a46f7e95fe06952113">BLOODCAT_TEETH</a> : <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4cd0b73ec704c215d430331d33863295c">CREATURE_PART_FLESH</a>), (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>) (80 + <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(21)), &amp;(<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#13c875b952b6d634680165d127a9870b">inv</a>[<a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc8785587b4fd997e9021e5ac9368ce323b57bc">BIGPOCK2POS</a>]) );
<a name="l02763"></a>02763       }
<a name="l02764"></a>02764 
<a name="l02765"></a>02765       <span class="comment">// as requested by ATE, males are more likely to drop their "organs" (he actually suggested this, I'm serious!)</span>
<a name="l02766"></a>02766       <span class="keywordflow">if</span> (fMaleCreature)
<a name="l02767"></a>02767       {
<a name="l02768"></a>02768             <span class="comment">// increase chance by 50%</span>
<a name="l02769"></a>02769             uiChanceToDrop += (uiChanceToDrop / 2);
<a name="l02770"></a>02770       }
<a name="l02771"></a>02771 
<a name="l02772"></a>02772       <span class="keywordflow">if</span> (<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(100) &lt; uiChanceToDrop)
<a name="l02773"></a>02773       {
<a name="l02774"></a>02774             <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( (<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>)(fBloodcat ? <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f44720e17e78e858e971ebd278e6954e07">BLOODCAT_PELT</a> : <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4a98b25df9c4422817185d754b9a1eb5a">CREATURE_PART_ORGAN</a>), (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>) (80 + <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(21)), &amp;(<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#13c875b952b6d634680165d127a9870b">inv</a>[<a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855eda6a2f9d1c54da91d76989eb4ab3569">BIGPOCK3POS</a>]) );
<a name="l02775"></a>02775       }
<a name="l02776"></a>02776 }
<a name="l02777"></a>02777 
<a name="l02778"></a><a class="code" href="Inventory_01Choosing_8h.html#c3463d20966d85d2d76626eb3c663084">02778</a> <span class="keywordtype">void</span> <a class="code" href="Inventory_01Choosing_8cpp.html#c3463d20966d85d2d76626eb3c663084">ReplaceExtendedGuns</a>( <a class="code" href="structSOLDIERCREATE__STRUCT.html">SOLDIERCREATE_STRUCT</a> *pp, <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bSoldierClass )
<a name="l02779"></a>02779 {
<a name="l02780"></a>02780       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>                        uiLoop, uiLoop2, uiAttachDestIndex;
<a name="l02781"></a>02781       <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>                          bWeaponClass;
<a name="l02782"></a>02782       <a class="code" href="structOBJECTTYPE.html">OBJECTTYPE</a>        OldObj;
<a name="l02783"></a>02783       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>                        usItem, usNewGun, usAmmo, usNewAmmo;
<a name="l02784"></a>02784 
<a name="l02785"></a>02785       <span class="keywordflow">for</span> ( uiLoop = 0; uiLoop &lt; <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc878553e9a668bdf9e2a72b855424ee1bdabcf">NUM_INV_SLOTS</a>; uiLoop++ )
<a name="l02786"></a>02786       {
<a name="l02787"></a>02787             usItem = pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ uiLoop ].<a class="code" href="structOBJECTTYPE.html#4fbe05335f161f08f354566b8e5a0a19">usItem</a>;
<a name="l02788"></a>02788 
<a name="l02789"></a>02789             if ( ( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ usItem ].usItemClass &amp; IC_GUN ) &amp;&amp; <a class="code" href="Items_8cpp.html#20b1b9e6ebeac3d48fbcb6e4d1116b8b">ExtendedGunListGun</a>( usItem ) )
<a name="l02790"></a>02790             {
<a name="l02791"></a>02791                   <span class="keywordflow">if</span> ( bSoldierClass == <a class="code" href="Soldier_01Control_8h.html#d559b3ed307be626eacea8b56942de61f30fb6bcf992831fe7ec28f6fbee1871">SOLDIER_CLASS_NONE</a> )
<a name="l02792"></a>02792                   {
<a name="l02793"></a>02793                         usNewGun = <a class="code" href="Items_8cpp.html#824d40a8f0c1ae81cf6be781625f3316">StandardGunListReplacement</a>( usItem );
<a name="l02794"></a>02794                   }
<a name="l02795"></a>02795                   <span class="keywordflow">else</span>
<a name="l02796"></a>02796                   {
<a name="l02797"></a>02797                         bWeaponClass = <a class="code" href="Inventory_01Choosing_8cpp.html#7c348c4359b431a3d9466ec081963a13">GetWeaponClass</a>( usItem );
<a name="l02798"></a>02798                         AssertMsg( bWeaponClass != -1, <a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>( <span class="stringliteral">"Gun %d does not have a match in the extended gun array"</span>, usItem ) );
<a name="l02799"></a>02799                         usNewGun = <a class="code" href="Inventory_01Choosing_8cpp.html#150703349e1bcb3a75a72fd68ee4d026">SelectStandardArmyGun</a>( bWeaponClass );
<a name="l02800"></a>02800                   }
<a name="l02801"></a>02801 
<a name="l02802"></a>02802                   <span class="keywordflow">if</span> ( usNewGun != NOTHING )
<a name="l02803"></a>02803                   {
<a name="l02804"></a>02804                         <span class="comment">// have to replace!  but first (ugh) must store backup (b/c of attachments)</span>
<a name="l02805"></a>02805                         <a class="code" href="Items_8cpp.html#25cc2fd376c658259a0f0b5849b5b044">CopyObj</a>( &amp;(pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ uiLoop ]), &amp;OldObj );
<a name="l02806"></a>02806                         <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( usNewGun, OldObj.<a class="code" href="structOBJECTTYPE.html#7bd2fad965762b335e47ea796f4af82c">bGunStatus</a>, &amp;(pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ uiLoop ]) );
<a name="l02807"></a>02807                         pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ uiLoop ].<a class="code" href="structOBJECTTYPE.html#0f1e67bac22f1b89c4040ef8a5ea48c2">fFlags</a> = OldObj.<a class="code" href="structOBJECTTYPE.html#0f1e67bac22f1b89c4040ef8a5ea48c2">fFlags</a>;
<a name="l02808"></a>02808 
<a name="l02809"></a>02809                         <span class="comment">// copy any valid attachments; for others, just drop them...</span>
<a name="l02810"></a>02810                         <span class="keywordflow">if</span> ( <a class="code" href="Items_8cpp.html#b08c657801100e879ca5b922d1ee96a8">ItemHasAttachments</a>( &amp;OldObj ) )
<a name="l02811"></a>02811                         {
<a name="l02812"></a>02812                               <span class="comment">// we're going to copy into the first attachment position first :-)</span>
<a name="l02813"></a>02813                               uiAttachDestIndex = 0;
<a name="l02814"></a>02814                               <span class="comment">// loop!</span>
<a name="l02815"></a>02815                               <span class="keywordflow">for</span> ( uiLoop2 = 0; uiLoop2 &lt; MAX_ATTACHMENTS; uiLoop2++ )
<a name="l02816"></a>02816                               {
<a name="l02817"></a>02817                                     <span class="keywordflow">if</span> ( ( OldObj.<a class="code" href="structOBJECTTYPE.html#427bef1c8b3d44d79d8f552ca1d774aa">usAttachItem</a>[ uiLoop2 ] != NOTHING ) &amp;&amp; <a class="code" href="Items_8cpp.html#c2738205478e5d719720738a44f447e4">ValidAttachment</a>( OldObj.<a class="code" href="structOBJECTTYPE.html#427bef1c8b3d44d79d8f552ca1d774aa">usAttachItem</a>[ uiLoop2 ], usNewGun ) )
<a name="l02818"></a>02818                                     {
<a name="l02819"></a>02819                                           pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ uiLoop ].<a class="code" href="structOBJECTTYPE.html#427bef1c8b3d44d79d8f552ca1d774aa">usAttachItem</a>[ uiAttachDestIndex ] = OldObj.<a class="code" href="structOBJECTTYPE.html#427bef1c8b3d44d79d8f552ca1d774aa">usAttachItem</a>[ uiLoop2 ];
<a name="l02820"></a>02820                                           pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ uiLoop ].<a class="code" href="structOBJECTTYPE.html#502ef8951e7613e2466bdf83927a7281">bAttachStatus</a>[ uiAttachDestIndex ] = OldObj.<a class="code" href="structOBJECTTYPE.html#502ef8951e7613e2466bdf83927a7281">bAttachStatus</a>[ uiLoop2 ];
<a name="l02821"></a>02821                                           uiAttachDestIndex++;
<a name="l02822"></a>02822                                     }
<a name="l02823"></a>02823                               }
<a name="l02824"></a>02824                         }
<a name="l02825"></a>02825 
<a name="l02826"></a>02826                         <span class="comment">// must search through inventory and replace ammo accordingly</span>
<a name="l02827"></a>02827                         <span class="keywordflow">for</span> ( uiLoop2 = 0; uiLoop2 &lt; NUM_INV_SLOTS; uiLoop2++ )
<a name="l02828"></a>02828                         {
<a name="l02829"></a>02829                               usAmmo = pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ uiLoop2 ].<a class="code" href="structOBJECTTYPE.html#4fbe05335f161f08f354566b8e5a0a19">usItem</a>;
<a name="l02830"></a>02830                               if ( (<a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[ usAmmo ].usItemClass &amp; IC_AMMO) )
<a name="l02831"></a>02831                               {
<a name="l02832"></a>02832                                     usNewAmmo = <a class="code" href="Items_8cpp.html#015ab772887220c323bc29e3fb46478f">FindReplacementMagazineIfNecessary</a>( usItem, usAmmo, usNewGun );
<a name="l02833"></a>02833                                     <span class="keywordflow">if</span> (usNewAmmo != NOTHING )
<a name="l02834"></a>02834                                     {
<a name="l02835"></a>02835                                           <span class="comment">// found a new magazine, replace...</span>
<a name="l02836"></a>02836                                           <a class="code" href="Items_8cpp.html#19aed5cbf530232ff0e01c7d6e58bd8e">CreateItems</a>( usNewAmmo, 100, pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ uiLoop2 ].<a class="code" href="structOBJECTTYPE.html#84ab3cbeb7dfdcc2e5ad4051e165d294">ubNumberOfObjects</a>, &amp;( pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ uiLoop2 ] ) );
<a name="l02837"></a>02837                                     }
<a name="l02838"></a>02838                               }
<a name="l02839"></a>02839                         }
<a name="l02840"></a>02840                   }
<a name="l02841"></a>02841             }
<a name="l02842"></a>02842 
<a name="l02843"></a>02843       }
<a name="l02844"></a>02844 }
<a name="l02845"></a>02845 
<a name="l02846"></a>02846 
<a name="l02847"></a>02847 
<a name="l02848"></a><a class="code" href="Inventory_01Choosing_8h.html#150703349e1bcb3a75a72fd68ee4d026">02848</a> <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> <a class="code" href="Inventory_01Choosing_8cpp.html#150703349e1bcb3a75a72fd68ee4d026">SelectStandardArmyGun</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> uiGunLevel )
<a name="l02849"></a>02849 {
<a name="l02850"></a>02850       <a class="code" href="structARMY__GUN__CHOICE__TYPE.html">ARMY_GUN_CHOICE_TYPE</a> *pGunChoiceTable;
<a name="l02851"></a>02851       <span class="keywordtype">int</span> uiChoice;
<a name="l02852"></a>02852       <span class="keywordtype">int</span> usGunIndex;
<a name="l02853"></a>02853 
<a name="l02854"></a>02854       <span class="comment">// pick the standard army gun for this weapon class from table</span>
<a name="l02855"></a>02855 <span class="comment">//    usGunIndex = gStrategicStatus.ubStandardArmyGunIndex[uiGunLevel];</span>
<a name="l02856"></a>02856 
<a name="l02857"></a>02857       <span class="comment">// decided to randomize it afterall instead of repeating the same weapon over and over</span>
<a name="l02858"></a>02858 
<a name="l02859"></a>02859       <span class="comment">// depending on selection of the gun nut option</span>
<a name="l02860"></a>02860       <span class="comment">//if (gGameOptions.fGunNut)</span>
<a name="l02861"></a>02861       <span class="comment">//{</span>
<a name="l02862"></a>02862             <span class="comment">// use table of extended gun choices</span>
<a name="l02863"></a>02863             pGunChoiceTable = &amp;(<a class="code" href="Inventory_01Choosing_8cpp.html#d0d4ecc439e1e3f426e907a64bd61a43">gExtendedArmyGunChoices</a>[0]);
<a name="l02864"></a>02864       <span class="comment">//}</span>
<a name="l02865"></a>02865       <span class="comment">//else</span>
<a name="l02866"></a>02866       <span class="comment">//{</span>
<a name="l02867"></a>02867       <span class="comment">//    // use table of regular gun choices</span>
<a name="l02868"></a>02868       <span class="comment">//    pGunChoiceTable = &amp;(gRegularArmyGunChoices[0]);</span>
<a name="l02869"></a>02869       <span class="comment">//}</span>
<a name="l02870"></a>02870 
<a name="l02871"></a>02871       <span class="comment">// choose one the of the possible gun choices</span>
<a name="l02872"></a>02872       usGunIndex = -1;
<a name="l02873"></a>02873 
<a name="l02874"></a>02874       <span class="keywordflow">while</span> (usGunIndex == -1)
<a name="l02875"></a>02875       {
<a name="l02876"></a>02876             uiChoice = <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(pGunChoiceTable[ uiGunLevel ].ubChoices);
<a name="l02877"></a>02877             usGunIndex = pGunChoiceTable[ uiGunLevel ].<a class="code" href="structARMY__GUN__CHOICE__TYPE.html#bced712a10aec3048cb4f3d74fb7484a">bItemNo</a>[ uiChoice ];
<a name="l02878"></a>02878 
<a name="l02879"></a>02879             <span class="keywordflow">if</span> (!<a class="code" href="Items_8cpp.html#0c0c320ba47a98a66433812fdcddb559">ItemIsLegal</a>(usGunIndex)) <span class="comment">//Madd: check for tons of guns</span>
<a name="l02880"></a>02880                   usGunIndex = -1;
<a name="l02881"></a>02881 
<a name="l02882"></a>02882             <span class="comment">//Check to avoid an endless loop looking for "normal" guns</span>
<a name="l02883"></a>02883             <span class="keywordflow">if</span> (usGunIndex == -1)
<a name="l02884"></a>02884             {
<a name="l02885"></a>02885                   <span class="comment">//Madd: there better be something from the original JA2 guns here somewhere (biggunlist=0)! </span>
<a name="l02886"></a>02886                   <span class="keywordtype">int</span> numTries = 0;
<a name="l02887"></a>02887                   <span class="comment">//Try 5 more times...</span>
<a name="l02888"></a>02888                   <span class="keywordflow">while</span> (numTries &lt; 5 &amp;&amp; usGunIndex == -1)
<a name="l02889"></a>02889                   {                 
<a name="l02890"></a>02890                         uiChoice = <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(pGunChoiceTable[ uiGunLevel ].ubChoices);
<a name="l02891"></a>02891                         usGunIndex = pGunChoiceTable[ uiGunLevel ].<a class="code" href="structARMY__GUN__CHOICE__TYPE.html#bced712a10aec3048cb4f3d74fb7484a">bItemNo</a>[ uiChoice ];
<a name="l02892"></a>02892 
<a name="l02893"></a>02893                         <span class="keywordflow">if</span> (!<a class="code" href="Items_8cpp.html#0c0c320ba47a98a66433812fdcddb559">ItemIsLegal</a>(usGunIndex)) <span class="comment">//Madd: check for tons of guns</span>
<a name="l02894"></a>02894                               usGunIndex = -1;
<a name="l02895"></a>02895 
<a name="l02896"></a>02896                         numTries++;
<a name="l02897"></a>02897                   }
<a name="l02898"></a>02898 
<a name="l02899"></a>02899                   <span class="keywordflow">if</span> (usGunIndex == -1) <span class="comment">//We still haven't found one!  Start just looping through the guns then</span>
<a name="l02900"></a>02900                   {
<a name="l02901"></a>02901                         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;pGunChoiceTable[uiGunLevel].<a class="code" href="structARMY__GUN__CHOICE__TYPE.html#d58a9337516339578e15375b1cee9386">ubChoices</a>;i++)
<a name="l02902"></a>02902                         {
<a name="l02903"></a>02903                               usGunIndex = pGunChoiceTable[ uiGunLevel ].bItemNo[ i ];
<a name="l02904"></a>02904                               
<a name="l02905"></a>02905                               <span class="keywordflow">if</span> (!<a class="code" href="Items_8cpp.html#0c0c320ba47a98a66433812fdcddb559">ItemIsLegal</a>(usGunIndex)) 
<a name="l02906"></a>02906                                     usGunIndex = -1;
<a name="l02907"></a>02907                               <span class="keywordflow">else</span>
<a name="l02908"></a>02908                                     <span class="keywordflow">break</span>;
<a name="l02909"></a>02909                         }
<a name="l02910"></a>02910                   }
<a name="l02911"></a>02911 
<a name="l02912"></a>02912                   <span class="keywordflow">if</span> ( usGunIndex == -1 )
<a name="l02913"></a>02913                   {
<a name="l02914"></a>02914                         <span class="comment">//Still nothing?  Then he gets a glock</span>
<a name="l02915"></a>02915                         usGunIndex = <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f479442aa770eff64d46fac74ca4efb6c9">GLOCK_17</a>;
<a name="l02916"></a>02916                   }
<a name="l02917"></a>02917 
<a name="l02918"></a>02918             }
<a name="l02919"></a>02919 
<a name="l02920"></a>02920       }
<a name="l02921"></a>02921 
<a name="l02922"></a>02922       Assert(usGunIndex);
<a name="l02923"></a>02923 
<a name="l02924"></a>02924       <span class="keywordflow">return</span>(usGunIndex);
<a name="l02925"></a>02925 }
<a name="l02926"></a>02926 
<a name="l02927"></a>02927 
<a name="l02928"></a>02928 
<a name="l02929"></a><a class="code" href="Inventory_01Choosing_8cpp.html#7b06561ebf45847c6be61b9ce13abdf8">02929</a> <span class="keywordtype">void</span> <a class="code" href="Inventory_01Choosing_8cpp.html#7b06561ebf45847c6be61b9ce13abdf8">EquipTank</a>( <a class="code" href="structSOLDIERCREATE__STRUCT.html">SOLDIERCREATE_STRUCT</a> *pp )
<a name="l02930"></a>02930 {
<a name="l02931"></a>02931       <a class="code" href="structOBJECTTYPE.html">OBJECTTYPE</a> Object;
<a name="l02932"></a>02932 
<a name="l02933"></a>02933       <span class="comment">// tanks get special equipment, and they drop nothing (MGs are hard-mounted &amp; non-removable)</span>
<a name="l02934"></a>02934 
<a name="l02935"></a>02935       <span class="comment">// main cannon</span>
<a name="l02936"></a>02936       <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f40c14890166c49212f97709670da968fb">TANK_CANNON</a>, ( <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> )( 80 + <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 21 ) ), &amp;( pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855408e678e638d95e18d5e9a2a64a96e2e">HANDPOS</a> ]) );
<a name="l02937"></a>02937       pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855408e678e638d95e18d5e9a2a64a96e2e">HANDPOS</a> ].<a class="code" href="structOBJECTTYPE.html#0f1e67bac22f1b89c4040ef8a5ea48c2">fFlags</a> |= OBJECT_UNDROPPABLE;
<a name="l02938"></a>02938 
<a name="l02939"></a>02939       <span class="comment">// machine gun</span>
<a name="l02940"></a>02940       <a class="code" href="Items_8cpp.html#19aed5cbf530232ff0e01c7d6e58bd8e">CreateItems</a>( <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4ebf086b00f573eb00091f9d09413441e">MINIMI</a>, ( <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> )( 80 + <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 21 ) ), 1, &amp;Object );
<a name="l02941"></a>02941       Object.<a class="code" href="structOBJECTTYPE.html#0f1e67bac22f1b89c4040ef8a5ea48c2">fFlags</a> |= OBJECT_UNDROPPABLE;
<a name="l02942"></a>02942       <a class="code" href="Inventory_01Choosing_8cpp.html#b427f7649fc2e022ea435eafc3737008">PlaceObjectInSoldierCreateStruct</a>( pp, &amp;Object );
<a name="l02943"></a>02943 
<a name="l02944"></a>02944       <span class="comment">// tanks don't deplete shells or ammo...</span>
<a name="l02945"></a>02945       <a class="code" href="Items_8cpp.html#19aed5cbf530232ff0e01c7d6e58bd8e">CreateItems</a>( <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f487f4903a63342e972aa8ab7bc19d8481">TANK_SHELL</a>, 100, 1, &amp;Object );
<a name="l02946"></a>02946       Object.<a class="code" href="structOBJECTTYPE.html#0f1e67bac22f1b89c4040ef8a5ea48c2">fFlags</a> |= OBJECT_UNDROPPABLE;
<a name="l02947"></a>02947       <a class="code" href="Inventory_01Choosing_8cpp.html#b427f7649fc2e022ea435eafc3737008">PlaceObjectInSoldierCreateStruct</a>( pp, &amp;Object );
<a name="l02948"></a>02948 
<a name="l02949"></a>02949       <span class="comment">// armour equal to spectra all over (for vs explosives)</span>
<a name="l02950"></a>02950       <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4f25135e7d6cd610310efba76dd6e2565">SPECTRA_VEST</a>, 100, &amp;(pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855afc78e6fc0aaffa92d59c2fe506f5c6a">VESTPOS</a> ]) );
<a name="l02951"></a>02951       pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855afc78e6fc0aaffa92d59c2fe506f5c6a">VESTPOS</a> ].<a class="code" href="structOBJECTTYPE.html#0f1e67bac22f1b89c4040ef8a5ea48c2">fFlags</a> |= OBJECT_UNDROPPABLE;
<a name="l02952"></a>02952       <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f4a1a02fc3752b43ecfcda8d002bdfbc9c">SPECTRA_HELMET</a>, 100, &amp;(pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc878551e1de377a2d80cf67fd63934f134956d">HELMETPOS</a> ]) );
<a name="l02953"></a>02953       pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc878551e1de377a2d80cf67fd63934f134956d">HELMETPOS</a> ].<a class="code" href="structOBJECTTYPE.html#0f1e67bac22f1b89c4040ef8a5ea48c2">fFlags</a> |= OBJECT_UNDROPPABLE;
<a name="l02954"></a>02954       <a class="code" href="Items_8cpp.html#153f1fcda178d6758ff8b01cf7999170">CreateItem</a>( <a class="code" href="Item_01Types_8h.html#572f9555da77e1b21f4cd40aed8d20f46117d7b7959b72c932de0dfe458f381c">SPECTRA_LEGGINGS</a>, 100, &amp;(pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855c1f8517c3795dd56e0c2450e625753dc">LEGPOS</a> ]) );
<a name="l02955"></a>02955       pp-&gt;<a class="code" href="structSOLDIERCREATE__STRUCT.html#77f67dd5bf56fd387974309de1a5d3ea">Inv</a>[ <a class="code" href="Soldier_01Control_8h.html#2a5937706f1724c8f06a0396bdc87855c1f8517c3795dd56e0c2450e625753dc">LEGPOS</a> ].<a class="code" href="structOBJECTTYPE.html#0f1e67bac22f1b89c4040ef8a5ea48c2">fFlags</a> |= OBJECT_UNDROPPABLE;
<a name="l02956"></a>02956 
<a name="l02957"></a>02957 }
<a name="l02958"></a>02958 
<a name="l02959"></a>02959 
<a name="l02960"></a>02960 
<a name="l02961"></a><a class="code" href="Inventory_01Choosing_8h.html#b337229d4d34dd6a42e77fb32dbc1b42">02961</a> <span class="keywordtype">void</span> <a class="code" href="Inventory_01Choosing_8cpp.html#b337229d4d34dd6a42e77fb32dbc1b42">ResetMortarsOnTeamCount</a>( <span class="keywordtype">void</span> )
<a name="l02962"></a>02962 {
<a name="l02963"></a>02963       <a class="code" href="Inventory_01Choosing_8cpp.html#8a2f82db14ba3613cacf33726dd246fb">guiMortarsRolledByTeam</a> = 0;
<a name="l02964"></a>02964 }
<a name="l02965"></a>02965 
<a name="l02966"></a><a class="code" href="Inventory_01Choosing_8cpp.html#661ec86e3a255acaad87210de3b4b24d">02966</a> <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> <a class="code" href="Inventory_01Choosing_8cpp.html#661ec86e3a255acaad87210de3b4b24d">PickARandomItem</a>(<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> typeIndex)
<a name="l02967"></a>02967 {
<a name="l02968"></a>02968       <span class="keywordflow">return</span> <a class="code" href="Inventory_01Choosing_8cpp.html#661ec86e3a255acaad87210de3b4b24d">PickARandomItem</a>(typeIndex,100,FALSE);
<a name="l02969"></a>02969 }
<a name="l02970"></a><a class="code" href="Inventory_01Choosing_8cpp.html#72ad8d96347526749fd8d093cfb27d3e">02970</a> <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> <a class="code" href="Inventory_01Choosing_8cpp.html#661ec86e3a255acaad87210de3b4b24d">PickARandomItem</a>(<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> typeIndex, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> maxCoolness)
<a name="l02971"></a>02971 {
<a name="l02972"></a>02972       <span class="keywordflow">return</span> <a class="code" href="Inventory_01Choosing_8cpp.html#661ec86e3a255acaad87210de3b4b24d">PickARandomItem</a>(typeIndex,maxCoolness,TRUE);
<a name="l02973"></a>02973 }
<a name="l02974"></a><a class="code" href="Inventory_01Choosing_8cpp.html#b042546a6f78c65ae0f1802d0740e9b4">02974</a> <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> <a class="code" href="Inventory_01Choosing_8cpp.html#661ec86e3a255acaad87210de3b4b24d">PickARandomItem</a>(<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> typeIndex, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> maxCoolness, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> getMatchingCoolness)
<a name="l02975"></a>02975 {
<a name="l02976"></a>02976       <span class="comment">//DebugMsg (TOPIC_JA2,DBG_LEVEL_3,String("PickARandomItem: typeIndex = %d, maxCoolness = %d, getMatchingCoolness = %d",typeIndex,maxCoolness,getMatchingCoolness));</span>
<a name="l02977"></a>02977 
<a name="l02978"></a>02978       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usItem = 0;
<a name="l02979"></a>02979       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiChoice;
<a name="l02980"></a>02980       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> defaultItem = 0;
<a name="l02981"></a>02981 
<a name="l02982"></a>02982       <span class="keywordflow">if</span> ( <a class="code" href="Inventory_01Choosing_8cpp.html#f01edfefa28e6b717c50b0e959a15aca">gArmyItemChoices</a>[ typeIndex ].ubChoices &lt;= 0 )
<a name="l02983"></a>02983             <span class="keywordflow">return</span> 0;
<a name="l02984"></a>02984 
<a name="l02985"></a>02985       <span class="comment">// check up to 10 times for an item with a matching coolness</span>
<a name="l02986"></a>02986       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i &lt; 10;i++)
<a name="l02987"></a>02987       {
<a name="l02988"></a>02988             <span class="comment">//if we've already tried more times then there are items + 1, limit the looping to speed up the game, and just plain give up</span>
<a name="l02989"></a>02989             <span class="keywordflow">if</span> ( i &gt; <a class="code" href="Inventory_01Choosing_8cpp.html#f01edfefa28e6b717c50b0e959a15aca">gArmyItemChoices</a>[ typeIndex ].ubChoices )
<a name="l02990"></a>02990                   <span class="keywordflow">break</span>;
<a name="l02991"></a>02991 
<a name="l02992"></a>02992             <span class="comment">// a chance for nothing!</span>
<a name="l02993"></a>02993             uiChoice = <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(<a class="code" href="Inventory_01Choosing_8cpp.html#f01edfefa28e6b717c50b0e959a15aca">gArmyItemChoices</a>[ typeIndex ].ubChoices + (<span class="keywordtype">int</span>) ( <a class="code" href="Inventory_01Choosing_8cpp.html#f01edfefa28e6b717c50b0e959a15aca">gArmyItemChoices</a>[ typeIndex ].ubChoices / 3 ));
<a name="l02994"></a>02994             <span class="keywordflow">if</span> ( uiChoice &gt;= <a class="code" href="Inventory_01Choosing_8cpp.html#f01edfefa28e6b717c50b0e959a15aca">gArmyItemChoices</a>[ typeIndex ].ubChoices )
<a name="l02995"></a>02995             {     
<a name="l02996"></a>02996                   <span class="keywordflow">if</span> ( !getMatchingCoolness )
<a name="l02997"></a>02997                         <span class="keywordflow">return</span> 0;
<a name="l02998"></a>02998                   <span class="keywordflow">else</span>
<a name="l02999"></a>02999                         uiChoice = <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(<a class="code" href="Inventory_01Choosing_8cpp.html#f01edfefa28e6b717c50b0e959a15aca">gArmyItemChoices</a>[ typeIndex ].ubChoices);
<a name="l03000"></a>03000             }
<a name="l03001"></a>03001             usItem = <a class="code" href="Inventory_01Choosing_8cpp.html#f01edfefa28e6b717c50b0e959a15aca">gArmyItemChoices</a>[ typeIndex ].<a class="code" href="structARMY__GUN__CHOICE__TYPE.html#bced712a10aec3048cb4f3d74fb7484a">bItemNo</a>[ uiChoice ];
<a name="l03002"></a>03002 
<a name="l03003"></a>03003             <span class="comment">//Madd: quickfix: don't use NVGs during the day, and no sungoggles at night either</span>
<a name="l03004"></a>03004             <span class="keywordflow">if</span> ( usItem &gt;= 0 &amp;&amp; <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usItem].ubCoolness &lt;= maxCoolness &amp;&amp; <a class="code" href="Items_8cpp.html#0c0c320ba47a98a66433812fdcddb559">ItemIsLegal</a>(usItem) &amp;&amp; (( <a class="code" href="Game_01Clock_8cpp.html#5880271c0d898c339f6f8269cd22cf54">DayTime</a>() &amp;&amp; <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usItem].nightvisionrangebonus == 0 ) || ( <a class="code" href="Game_01Clock_8cpp.html#91be080ca4f751a06c76f34485f568ab">NightTime</a>() &amp;&amp; <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usItem].dayvisionrangebonus == 0 )))
<a name="l03005"></a>03005             {
<a name="l03006"></a>03006                   <span class="comment">// pick a default item in case we don't find anything with a matching coolness, but pick the coolest item we can find</span>
<a name="l03007"></a>03007                   <span class="keywordflow">if</span> ( defaultItem == 0 || <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usItem].ubCoolness &gt; <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[defaultItem].ubCoolness )
<a name="l03008"></a>03008                         defaultItem = usItem;
<a name="l03009"></a>03009 
<a name="l03010"></a>03010                   <span class="comment">// found something with the right coolness</span>
<a name="l03011"></a>03011                   <span class="keywordflow">if</span> ( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usItem].ubCoolness == maxCoolness || !getMatchingCoolness )
<a name="l03012"></a>03012                         <span class="keywordflow">return</span> usItem;
<a name="l03013"></a>03013             }
<a name="l03014"></a>03014       }
<a name="l03015"></a>03015 
<a name="l03016"></a>03016       <span class="comment">// couldn't find anything with the exact matching coolness, so return the best item we did find</span>
<a name="l03017"></a>03017       <span class="keywordflow">return</span> defaultItem;
<a name="l03018"></a>03018 }
<a name="l03019"></a><a class="code" href="Inventory_01Choosing_8cpp.html#542239fb2c141fed4755889a76e7fc7d">03019</a> <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> <a class="code" href="Inventory_01Choosing_8cpp.html#542239fb2c141fed4755889a76e7fc7d">PickARandomAttachment</a>(<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> typeIndex, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usBaseItem, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> maxCoolness, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> getMatchingCoolness)
<a name="l03020"></a>03020 {
<a name="l03021"></a>03021       <span class="comment">//DebugMsg (TOPIC_JA2,DBG_LEVEL_3,String("PickARandomAttachment: baseItem = %d, typeIndex = %d, maxCoolness = %d, getMatchingCoolness = %d",usBaseItem, typeIndex,maxCoolness,getMatchingCoolness));</span>
<a name="l03022"></a>03022 
<a name="l03023"></a>03023       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usItem = 0;
<a name="l03024"></a>03024       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiChoice;
<a name="l03025"></a>03025       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> defaultItem = 0;
<a name="l03026"></a>03026 
<a name="l03027"></a>03027 <span class="comment">//    DebugMsg (TOPIC_JA2,DBG_LEVEL_3,String("PickARandomAttachment: # choices = %d", gArmyItemChoices[ typeIndex ].ubChoices ));</span>
<a name="l03028"></a>03028       <span class="keywordflow">if</span> ( <a class="code" href="Inventory_01Choosing_8cpp.html#f01edfefa28e6b717c50b0e959a15aca">gArmyItemChoices</a>[ typeIndex ].ubChoices &lt;= 0 )
<a name="l03029"></a>03029             <span class="keywordflow">return</span> 0;
<a name="l03030"></a>03030 
<a name="l03031"></a>03031       <span class="comment">// check up to 10 times for an item with a matching coolness</span>
<a name="l03032"></a>03032       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i &lt; 10;i++)
<a name="l03033"></a>03033       {
<a name="l03034"></a>03034             <span class="comment">//if we've already tried more times then there are items + 1, limit the looping to speed up the game, and just plain give up</span>
<a name="l03035"></a>03035             <span class="keywordflow">if</span> ( i &gt; <a class="code" href="Inventory_01Choosing_8cpp.html#f01edfefa28e6b717c50b0e959a15aca">gArmyItemChoices</a>[ typeIndex ].ubChoices )
<a name="l03036"></a>03036                   <span class="keywordflow">break</span>;
<a name="l03037"></a>03037 
<a name="l03038"></a>03038             uiChoice = <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(<a class="code" href="Inventory_01Choosing_8cpp.html#f01edfefa28e6b717c50b0e959a15aca">gArmyItemChoices</a>[ typeIndex ].ubChoices);
<a name="l03039"></a>03039             usItem = <a class="code" href="Inventory_01Choosing_8cpp.html#f01edfefa28e6b717c50b0e959a15aca">gArmyItemChoices</a>[ typeIndex ].<a class="code" href="structARMY__GUN__CHOICE__TYPE.html#bced712a10aec3048cb4f3d74fb7484a">bItemNo</a>[ uiChoice ];
<a name="l03040"></a>03040 
<a name="l03041"></a>03041             <span class="keywordflow">if</span> ( usItem &gt;= 0 &amp;&amp; <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usItem].ubCoolness &lt;= maxCoolness &amp;&amp; <a class="code" href="Items_8cpp.html#c2738205478e5d719720738a44f447e4">ValidAttachment</a>(usItem,usBaseItem))
<a name="l03042"></a>03042             {
<a name="l03043"></a>03043                   <span class="comment">// pick a default item in case we don't find anything with a matching coolness, but pick the coolest item we can find</span>
<a name="l03044"></a>03044                   <span class="keywordflow">if</span> ( defaultItem == 0 || <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usItem].ubCoolness &gt; <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[defaultItem].ubCoolness )
<a name="l03045"></a>03045                         defaultItem = usItem;
<a name="l03046"></a>03046 
<a name="l03047"></a>03047                   <span class="comment">// found something with the right coolness</span>
<a name="l03048"></a>03048                   <span class="keywordflow">if</span> ( <a class="code" href="Item_01Types_8h.html#f9dc4cc7a3a99ad5944940cfb7c82237">Item</a>[usItem].ubCoolness == maxCoolness || !getMatchingCoolness )
<a name="l03049"></a>03049                   {
<a name="l03050"></a>03050 <span class="comment">//                      DebugMsg (TOPIC_JA2,DBG_LEVEL_3,String("PickARandomAttachment: baseItem = %d, usItem = %d",usBaseItem, usItem));</span>
<a name="l03051"></a>03051                         <span class="keywordflow">if</span> (<a class="code" href="Items_8cpp.html#0c0c320ba47a98a66433812fdcddb559">ItemIsLegal</a>(usItem))
<a name="l03052"></a>03052                               <span class="keywordflow">return</span> usItem;
<a name="l03053"></a>03053                   }
<a name="l03054"></a>03054             }
<a name="l03055"></a>03055       }
<a name="l03056"></a>03056 
<a name="l03057"></a>03057       <span class="comment">// couldn't find anything with the exact matching coolness, so return the best item we did find</span>
<a name="l03058"></a>03058 <span class="comment">//    DebugMsg (TOPIC_JA2,DBG_LEVEL_3,String("PickARandomAttachment: baseItem = %d, defaultItem = %d",usBaseItem, defaultItem));</span>
<a name="l03059"></a>03059       <span class="keywordflow">if</span> (<a class="code" href="Items_8cpp.html#0c0c320ba47a98a66433812fdcddb559">ItemIsLegal</a>(usItem))
<a name="l03060"></a>03060             <span class="keywordflow">return</span> defaultItem;
<a name="l03061"></a>03061       <span class="keywordflow">else</span>
<a name="l03062"></a>03062             <span class="keywordflow">return</span> 0;
<a name="l03063"></a>03063 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sat Sep 9 13:48:23 2006 for Build by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
