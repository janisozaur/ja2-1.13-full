<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Build: LoadScreen.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="classes.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir_3179ea33d55a76dc38212d9eab798728.html">export</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_e5664b4b56927c8728eb3192fa60e338.html">hdc2</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_1eb12a41a47efb9efcd82fa98f4f4dbd.html">FTP</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_80cc1f21a78ab7941088ea567f236150.html">ja2src</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_994ab287602efefceafe55287a3657d6.html">Build</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_33ea1c43094532be6a81f120546fc3d7.html">Editor</a></div>
<h1>LoadScreen.cpp</h1><a href="LoadScreen_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#ifdef PRECOMPILEDHEADERS</span>
<a name="l00002"></a>00002 <span class="preprocessor"></span><span class="preprocessor">      #include "<a class="code" href="Editor_01All_8h.html">Editor All.h</a>"</span>
<a name="l00003"></a>00003 <span class="preprocessor">#else</span>
<a name="l00004"></a>00004 <span class="preprocessor"></span><span class="preprocessor">      #include "<a class="code" href="builddefines_8h.html">builddefines.h</a>"</span>
<a name="l00005"></a>00005 <span class="preprocessor">#endif</span>
<a name="l00006"></a>00006 <span class="preprocessor"></span>
<a name="l00007"></a>00007 <span class="preprocessor">#ifdef JA2EDITOR</span>
<a name="l00008"></a>00008 <span class="preprocessor"></span>
<a name="l00009"></a>00009 <span class="preprocessor">#ifndef PRECOMPILEDHEADERS</span>
<a name="l00010"></a>00010 <span class="preprocessor"></span><span class="preprocessor">      #include &lt;stdio.h&gt;</span>
<a name="l00011"></a>00011 <span class="preprocessor">      #include "<a class="code" href="Font_01Control_8h.html">Font Control.h</a>"</span> 
<a name="l00012"></a>00012 <span class="preprocessor">      #include "<a class="code" href="renderworld_8h.html">renderworld.h</a>"</span>
<a name="l00013"></a>00013 <span class="preprocessor">      #include "render dirty.h"</span>
<a name="l00014"></a>00014 <span class="preprocessor">      #include "loadscreen.h"</span>
<a name="l00015"></a>00015 <span class="preprocessor">      #include "<a class="code" href="selectwin_8h.html">selectwin.h</a>"</span>
<a name="l00016"></a>00016 <span class="preprocessor">      #include "<a class="code" href="EditorDefines_8h.html">EditorDefines.h</a>"</span>
<a name="l00017"></a>00017 <span class="preprocessor">      #include "<a class="code" href="messagebox_8h.html">messagebox.h</a>"</span>
<a name="l00018"></a>00018 <span class="preprocessor">      #include "<a class="code" href="Text_01Input_8h.html">Text Input.h</a>"</span>
<a name="l00019"></a>00019 <span class="preprocessor">      #include "<a class="code" href="Soldier_01Create_8h.html">Soldier Create.h</a>"</span>
<a name="l00020"></a>00020 <span class="preprocessor">      #include "<a class="code" href="Soldier_01Init_01List_8h.html">Soldier Init List.h</a>"</span>
<a name="l00021"></a>00021 <span class="preprocessor">      #include "<a class="code" href="EditorBuildings_8h.html">EditorBuildings.h</a>"</span>
<a name="l00022"></a>00022 <span class="preprocessor">      #include "<a class="code" href="Editor_01Taskbar_01Utils_8h.html">Editor Taskbar Utils.h</a>"</span>
<a name="l00023"></a>00023 <span class="preprocessor">      #include "<a class="code" href="Editor_01Undo_8h.html">Editor Undo.h</a>"</span>
<a name="l00024"></a>00024 <span class="preprocessor">      #include "<a class="code" href="editscreen_8h.html">editscreen.h</a>"</span>
<a name="l00025"></a>00025 <span class="preprocessor">      #include "<a class="code" href="strategicmap_8h.html">strategicmap.h</a>"</span>
<a name="l00026"></a>00026 <span class="preprocessor">      #include "<a class="code" href="Editor_01Modes_8h.html">Editor Modes.h</a>"</span>
<a name="l00027"></a>00027 <span class="preprocessor">      #include "<a class="code" href="Map_01Information_8h.html">Map Information.h</a>"</span>
<a name="l00028"></a>00028 <span class="preprocessor">      #include "<a class="code" href="Sys_01Globals_8h.html">Sys Globals.h</a>"</span>
<a name="l00029"></a>00029 <span class="preprocessor">      #include "<a class="code" href="Sector_01Summary_8h.html">Sector Summary.h</a>"</span>
<a name="l00030"></a>00030 <span class="preprocessor">      #include "<a class="code" href="newsmooth_8h.html">newsmooth.h</a>"</span>
<a name="l00031"></a>00031 <span class="preprocessor">      #include "<a class="code" href="Simple_01Render_01Utils_8h.html">Simple Render Utils.h</a>"</span>
<a name="l00032"></a>00032 <span class="preprocessor">      #include "<a class="code" href="Animated_01ProgressBar_8h.html">Animated ProgressBar.h</a>"</span>
<a name="l00033"></a>00033 <span class="preprocessor">      #include "<a class="code" href="EditorMercs_8h.html">EditorMercs.h</a>"</span>
<a name="l00034"></a>00034 <span class="preprocessor">      #include "<a class="code" href="lighting_8h.html">lighting.h</a>"</span>
<a name="l00035"></a>00035 <span class="preprocessor">      #include "<a class="code" href="EditorMapInfo_8h.html">EditorMapInfo.h</a>"</span>
<a name="l00036"></a>00036 <span class="preprocessor">      #include "<a class="code" href="environment_8h.html">environment.h</a>"</span>
<a name="l00037"></a>00037 <span class="preprocessor">      #include "<a class="code" href="edit__sys_8h.html">edit_sys.h</a>"</span>
<a name="l00038"></a>00038 <span class="preprocessor">      #include "<a class="code" href="EditorItems_8h.html">EditorItems.h</a>"</span>
<a name="l00039"></a>00039 <span class="preprocessor">      #include "<a class="code" href="english_8h.html">english.h</a>"</span>
<a name="l00040"></a>00040 <span class="preprocessor">      #include "<a class="code" href="gameloop_8h.html">gameloop.h</a>"</span>
<a name="l00041"></a>00041 <span class="preprocessor">      #include "<a class="code" href="message_8h.html">message.h</a>"</span>
<a name="l00042"></a>00042 <span class="preprocessor">      #include "<a class="code" href="pits_8h.html">pits.h</a>"</span>
<a name="l00043"></a>00043 <span class="preprocessor">      #include "<a class="code" href="Item_01Statistics_8h.html">Item Statistics.h</a>"</span>
<a name="l00044"></a>00044 <span class="preprocessor">      #include "<a class="code" href="Scheduling_8h.html">Scheduling.h</a>"</span>
<a name="l00045"></a>00045 <span class="preprocessor">#endif</span>
<a name="l00046"></a>00046 <span class="preprocessor"></span>
<a name="l00047"></a>00047 <span class="comment">//===========================================================================</span>
<a name="l00048"></a>00048 
<a name="l00049"></a><a class="code" href="worlddef_8cpp.html#cde876a04c710f16b877d2d0002a6c2d">00049</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="LoadScreen_8cpp.html#cde876a04c710f16b877d2d0002a6c2d">gfErrorCatch</a> = FALSE;
<a name="l00050"></a><a class="code" href="worlddef_8cpp.html#fc61e27e3d4a4dc4fdf6383ad547aecd">00050</a> <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> <a class="code" href="LoadScreen_8cpp.html#fc61e27e3d4a4dc4fdf6383ad547aecd">gzErrorCatchString</a>[ 256 ] = L<span class="stringliteral">""</span>;
<a name="l00051"></a><a class="code" href="LoadScreen_8cpp.html#20d1f6dc47370f558e0583c8c4e7c313">00051</a> <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> <a class="code" href="LoadScreen_8cpp.html#20d1f6dc47370f558e0583c8c4e7c313">giErrorCatchMessageBox</a> = 0;
<a name="l00052"></a>00052 
<a name="l00053"></a>00053 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="editscreen_8cpp.html#f695c4be5ee8d5be805ea475e2b168cd">RemoveMercsInSector</a>();
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 <span class="keyword">enum</span>{
<a name="l00056"></a>00056       <a class="code" href="LoadScreen_8cpp.html#f9bdc3014f3d54c426b6d2df10de4960152a2a2058cc5f436d5528e0bfa9b1f5">DIALOG_NONE</a>,
<a name="l00057"></a>00057       <a class="code" href="LoadScreen_8cpp.html#f9bdc3014f3d54c426b6d2df10de49601b312278c9afeabd86b3bb4ab178ecf8">DIALOG_SAVE</a>,
<a name="l00058"></a>00058       <a class="code" href="LoadScreen_8cpp.html#f9bdc3014f3d54c426b6d2df10de496088a277ead75be15a416e01e349f3d2bd">DIALOG_LOAD</a>,
<a name="l00059"></a>00059       <a class="code" href="LoadScreen_8cpp.html#f9bdc3014f3d54c426b6d2df10de4960032ac5436ce32d651982f9a7a5809daf">DIALOG_CANCEL</a>,
<a name="l00060"></a>00060       <a class="code" href="LoadScreen_8cpp.html#f9bdc3014f3d54c426b6d2df10de496021427825a88c29315f0348666ddaaf97">DIALOG_DELETE</a>
<a name="l00061"></a>00061 };
<a name="l00062"></a>00062 
<a name="l00063"></a>00063 <span class="keyword">extern</span> <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> <a class="code" href="LoadScreen_8cpp.html#7f2f33b17493b587901eab2252c50eb6">Counter</a>;
<a name="l00064"></a>00064 
<a name="l00065"></a>00065 <span class="comment">//Hook into the text input code.  These callbacks help give back control, so we</span>
<a name="l00066"></a>00066 <span class="comment">//can use the dialog interface in conjunction with the </span>
<a name="l00067"></a>00067 <span class="keywordtype">void</span> <a class="code" href="LoadScreen_8cpp.html#f30ce5b6f85deceea09c7cf3293b831a">FDlgOkCallback</a>( <a class="code" href="struct__GUI__BUTTON.html">GUI_BUTTON</a> *butn, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> reason );
<a name="l00068"></a>00068 <span class="keywordtype">void</span> <a class="code" href="LoadScreen_8cpp.html#290c1b35c25fae6611f19d55c9fcac35">FDlgCancelCallback</a>( <a class="code" href="struct__GUI__BUTTON.html">GUI_BUTTON</a> *butn, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> reason );
<a name="l00069"></a>00069 <span class="keywordtype">void</span> <a class="code" href="LoadScreen_8cpp.html#674fe75c4617cdc24bc87c5b10771399">FDlgUpCallback</a>( <a class="code" href="struct__GUI__BUTTON.html">GUI_BUTTON</a> *butn, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> reason );
<a name="l00070"></a>00070 <span class="keywordtype">void</span> <a class="code" href="LoadScreen_8cpp.html#89d650e2b6c222efd8f93c6e98bdd3b1">FDlgDwnCallback</a>( <a class="code" href="struct__GUI__BUTTON.html">GUI_BUTTON</a> *butn, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> reason );
<a name="l00071"></a>00071 <span class="keywordtype">void</span> <a class="code" href="LoadScreen_8cpp.html#4f5c38bdf483e6953e81a15d172aa213">FDlgNamesCallback</a>( <a class="code" href="struct__GUI__BUTTON.html">GUI_BUTTON</a> *butn, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> reason );
<a name="l00072"></a>00072 <span class="keywordtype">void</span> <a class="code" href="LoadScreen_8cpp.html#4a24bd2a603492746c0d06a548ecdbeb">UpdateWorldInfoCallback</a>( <a class="code" href="struct__GUI__BUTTON.html">GUI_BUTTON</a> *b, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> reason );
<a name="l00073"></a>00073 <span class="keywordtype">void</span> <a class="code" href="LoadScreen_8cpp.html#074e102c76d3995943f14362c08f493d">FileDialogModeCallback</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubID, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fEntering );
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="LoadScreen_8cpp.html#4cf935782804f03f8715cdd7f87f2941">ProcessLoadSaveScreenMessageBoxResult</a>();
<a name="l00076"></a>00076 <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="LoadScreen_8cpp.html#68fbaa4dd1c6fecdaf051a6310c9ac81">RemoveFromFDlgList</a>( <a class="code" href="struct__FDLG__LIST__TAG.html">FDLG_LIST</a> **head, <a class="code" href="struct__FDLG__LIST__TAG.html">FDLG_LIST</a> *node );
<a name="l00077"></a>00077 
<a name="l00078"></a>00078 <span class="keywordtype">void</span> <a class="code" href="LoadScreen_8cpp.html#a0f4f2b198dc9379a57f4eb047617e33">DrawFileDialog</a>();
<a name="l00079"></a>00079 <span class="keywordtype">void</span> <a class="code" href="LoadScreen_8cpp.html#2d60bde417f5c4932c03e3c697dc7761">HandleMainKeyEvents</a>( <a class="code" href="structInputAtom.html">InputAtom</a> *pEvent ); 
<a name="l00080"></a>00080 <span class="keywordtype">void</span> <a class="code" href="LoadScreen_8cpp.html#41a70de77129cc4ec6f10533cb9bb753">SetTopFileToLetter</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usLetter );
<a name="l00081"></a>00081 
<a name="l00082"></a><a class="code" href="LoadScreen_8cpp.html#af40284bcf5db835ad81993f0f083b4f">00082</a> <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> <a class="code" href="LoadScreen_8cpp.html#af40284bcf5db835ad81993f0f083b4f">iTotalFiles</a>;
<a name="l00083"></a><a class="code" href="LoadScreen_8cpp.html#79220a8a0aa9753cc18ffd6b5fc41af8">00083</a> <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> <a class="code" href="LoadScreen_8cpp.html#79220a8a0aa9753cc18ffd6b5fc41af8">iTopFileShown</a>;
<a name="l00084"></a><a class="code" href="LoadScreen_8cpp.html#8a920e48f1c1b7160ad1ad85725ac98a">00084</a> <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> <a class="code" href="LoadScreen_8cpp.html#8a920e48f1c1b7160ad1ad85725ac98a">iCurrFileShown</a>;
<a name="l00085"></a><a class="code" href="LoadScreen_8cpp.html#6c2d4b83e871f3075db623297046cabf">00085</a> <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> <a class="code" href="LoadScreen_8cpp.html#6c2d4b83e871f3075db623297046cabf">iLastFileClicked</a>;
<a name="l00086"></a><a class="code" href="LoadScreen_8cpp.html#5b44b96529e4b2986672c752f4339312">00086</a> <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> <a class="code" href="LoadScreen_8cpp.html#5b44b96529e4b2986672c752f4339312">iLastClickTime</a>;
<a name="l00087"></a>00087 
<a name="l00088"></a><a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">00088</a> <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a>[31];
<a name="l00089"></a>00089 
<a name="l00090"></a><a class="code" href="LoadScreen_8cpp.html#29b63ea968cd6c6eed712af82bb78c6f">00090</a> <a class="code" href="struct__FDLG__LIST__TAG.html">FDLG_LIST</a> *<a class="code" href="LoadScreen_8cpp.html#29b63ea968cd6c6eed712af82bb78c6f">FileList</a> = NULL;
<a name="l00091"></a>00091 
<a name="l00092"></a><a class="code" href="LoadScreen_8h.html#a4f68159b63f4db51c1e9aa217085555">00092</a> <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> <a class="code" href="LoadScreen_8cpp.html#a4f68159b63f4db51c1e9aa217085555">iFDlgState</a> = <a class="code" href="LoadScreen_8cpp.html#f9bdc3014f3d54c426b6d2df10de4960152a2a2058cc5f436d5528e0bfa9b1f5">DIALOG_NONE</a>;
<a name="l00093"></a><a class="code" href="LoadScreen_8h.html#ea89943feac0e7c4b9061b57b1dca606">00093</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="LoadScreen_8cpp.html#ea89943feac0e7c4b9061b57b1dca606">gfDestroyFDlg</a> = FALSE;
<a name="l00094"></a><a class="code" href="LoadScreen_8cpp.html#4913515e1b230a105860c7c319fd3a69">00094</a> <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> <a class="code" href="LoadScreen_8cpp.html#4913515e1b230a105860c7c319fd3a69">iFileDlgButtons</a>[7];
<a name="l00095"></a>00095 
<a name="l00096"></a><a class="code" href="LoadScreen_8cpp.html#84e2524827ba1f3efbb1f2ab02cb442d">00096</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="LoadScreen_8cpp.html#84e2524827ba1f3efbb1f2ab02cb442d">gfLoadError</a>;
<a name="l00097"></a><a class="code" href="LoadScreen_8cpp.html#ae946e10162e8ee15f889fd30302e596">00097</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="LoadScreen_8cpp.html#ae946e10162e8ee15f889fd30302e596">gfReadOnly</a>;
<a name="l00098"></a><a class="code" href="LoadScreen_8cpp.html#8b40d98ae1a89c67f8818397c6d28255">00098</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="LoadScreen_8cpp.html#8b40d98ae1a89c67f8818397c6d28255">gfFileExists</a>;
<a name="l00099"></a><a class="code" href="LoadScreen_8cpp.html#91b2a108c21fb11d89af4e5f3b97817f">00099</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="LoadScreen_8cpp.html#91b2a108c21fb11d89af4e5f3b97817f">gfIllegalName</a>;
<a name="l00100"></a><a class="code" href="LoadScreen_8cpp.html#b43c1e38d7a5e1dfcca76d3fcf09a0aa">00100</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="LoadScreen_8cpp.html#b43c1e38d7a5e1dfcca76d3fcf09a0aa">gfDeleteFile</a>;
<a name="l00101"></a><a class="code" href="LoadScreen_8cpp.html#5615f1416e14f1149b1c98cd2128c3dd">00101</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="LoadScreen_8cpp.html#5615f1416e14f1149b1c98cd2128c3dd">gfNoFiles</a>;
<a name="l00102"></a>00102 
<a name="l00103"></a><a class="code" href="LoadScreen_8cpp.html#60f9817576e6b78becea64bef06407bc">00103</a> <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> <a class="code" href="LoadScreen_8cpp.html#60f9817576e6b78becea64bef06407bc">zOrigName</a>[60];
<a name="l00104"></a><a class="code" href="LoadScreen_8cpp.html#4fc225cd94b5bc30eb7df3f90b110245">00104</a> <a class="code" href="struct__GETFILESTRUCT__TAG.html">GETFILESTRUCT</a> <a class="code" href="LoadScreen_8cpp.html#4fc225cd94b5bc30eb7df3f90b110245">FileInfo</a>;
<a name="l00105"></a>00105 
<a name="l00106"></a><a class="code" href="LoadScreen_8cpp.html#bd87611619e376f44f139d079b362200">00106</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="LoadScreen_8cpp.html#bd87611619e376f44f139d079b362200">fEnteringLoadSaveScreen</a> = TRUE;
<a name="l00107"></a><a class="code" href="LoadScreen_8cpp.html#f9e30be3493bfd5dd0991403bd575c7f">00107</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="LoadScreen_8cpp.html#f9e30be3493bfd5dd0991403bd575c7f">gfPassedSaveCheck</a> = FALSE;
<a name="l00108"></a>00108 
<a name="l00109"></a><a class="code" href="LoadScreen_8cpp.html#e3ef96201acb4cc43c0b3ea6b3ae26fb">00109</a> <a class="code" href="struct__MOUSE__REGION.html">MOUSE_REGION</a> <a class="code" href="LoadScreen_8cpp.html#e3ef96201acb4cc43c0b3ea6b3ae26fb">BlanketRegion</a>;
<a name="l00110"></a>00110 
<a name="l00111"></a><a class="code" href="LoadScreen_8cpp.html#a7dca02c7858594c51d265593187229b">00111</a> <a class="code" href="Types_8h.html#2f68f0189367ead40015f7c0ec68eb9e">CHAR8</a>  <a class="code" href="LoadScreen_8cpp.html#a7dca02c7858594c51d265593187229b">gszCurrFilename</a>[80];
<a name="l00112"></a>00112 
<a name="l00113"></a>00113 <span class="keyword">enum</span>{
<a name="l00114"></a>00114       <a class="code" href="LoadScreen_8cpp.html#db49720dc49f7d4e4cf9adbf2948e4094866d0bde1bc87a00642120e2e517b8c">IOSTATUS_NONE</a>,
<a name="l00115"></a>00115       <a class="code" href="LoadScreen_8cpp.html#db49720dc49f7d4e4cf9adbf2948e4092a08c52c59022a7f53ca802e874d6b01">INITIATE_MAP_SAVE</a>,
<a name="l00116"></a>00116       <a class="code" href="LoadScreen_8cpp.html#db49720dc49f7d4e4cf9adbf2948e40917e7f46a56e0fa9ae3b98f02a4809dae">SAVING_MAP</a>,
<a name="l00117"></a>00117       <a class="code" href="LoadScreen_8cpp.html#db49720dc49f7d4e4cf9adbf2948e40906307193c24b68a9d23c6b91982c6b5b">INITIATE_MAP_LOAD</a>,
<a name="l00118"></a>00118       <a class="code" href="LoadScreen_8cpp.html#db49720dc49f7d4e4cf9adbf2948e4090e240497198f4fc7d7f0d8f1565ca50a">LOADING_MAP</a>
<a name="l00119"></a>00119 };
<a name="l00120"></a><a class="code" href="LoadScreen_8cpp.html#d3c970f25d546d5a5f50c4707d4598ed">00120</a> <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> <a class="code" href="LoadScreen_8cpp.html#d3c970f25d546d5a5f50c4707d4598ed">gbCurrentFileIOStatus</a>;  <span class="comment">//1 init saving message, 2 save, 3 init loading message, 4 load, 0 none</span>
<a name="l00121"></a>00121 <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="LoadScreen_8cpp.html#2967ee50affa57514d2003964c08cb52">ProcessFileIO</a>();
<a name="l00122"></a>00122 
<a name="l00123"></a>00123 <span class="comment">//BOOLEAN fSavingFile;</span>
<a name="l00124"></a>00124 <span class="keyword">extern</span> <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> <a class="code" href="EditorDefines_8h.html#c9bd166a4c5d3459f355418b7e95ec93">gusLightLevel</a>, <a class="code" href="editscreen_8cpp.html#38dc35df678699b3e87c9a3575e2f848">gusSavedLightLevel</a>;
<a name="l00125"></a><a class="code" href="jascreens_8h.html#a69e9c1f15cc6152f5179a69c51d0402">00125</a> <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="LoadScreen_8cpp.html#a69e9c1f15cc6152f5179a69c51d0402">LoadSaveScreenInit</a>(<span class="keywordtype">void</span>)
<a name="l00126"></a>00126 {
<a name="l00127"></a>00127       <a class="code" href="Sector_01Summary_8cpp.html#a8db70ba693fe3891c7525a350d912ea">gfUpdateSummaryInfo</a> = TRUE;
<a name="l00128"></a>00128       <a class="code" href="LoadScreen_8cpp.html#bd87611619e376f44f139d079b362200">fEnteringLoadSaveScreen</a> = TRUE;
<a name="l00129"></a>00129       <span class="keywordflow">return</span> TRUE;
<a name="l00130"></a>00130 }
<a name="l00131"></a>00131 
<a name="l00132"></a><a class="code" href="jascreens_8h.html#2893fdefa6d378cdacbe0064d1dcf14a">00132</a> <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="LoadScreen_8cpp.html#2893fdefa6d378cdacbe0064d1dcf14a">LoadSaveScreenShutdown</a>(<span class="keywordtype">void</span>)
<a name="l00133"></a>00133 {
<a name="l00134"></a>00134  <span class="keywordflow">return</span> TRUE;
<a name="l00135"></a>00135 }
<a name="l00136"></a>00136 
<a name="l00137"></a><a class="code" href="LoadScreen_8cpp.html#701d801259dd43c9e2443ebaeff161d3">00137</a> <span class="keywordtype">void</span> <a class="code" href="LoadScreen_8cpp.html#701d801259dd43c9e2443ebaeff161d3">LoadSaveScreenEntry</a>()
<a name="l00138"></a>00138 {
<a name="l00139"></a>00139       <a class="code" href="LoadScreen_8cpp.html#bd87611619e376f44f139d079b362200">fEnteringLoadSaveScreen</a> = FALSE;
<a name="l00140"></a>00140       <a class="code" href="LoadScreen_8cpp.html#d3c970f25d546d5a5f50c4707d4598ed">gbCurrentFileIOStatus</a>   = <a class="code" href="LoadScreen_8cpp.html#db49720dc49f7d4e4cf9adbf2948e4094866d0bde1bc87a00642120e2e517b8c">IOSTATUS_NONE</a>;
<a name="l00141"></a>00141 
<a name="l00142"></a>00142       <a class="code" href="LoadScreen_8cpp.html#ae946e10162e8ee15f889fd30302e596">gfReadOnly</a> = FALSE;
<a name="l00143"></a>00143       <a class="code" href="LoadScreen_8cpp.html#8b40d98ae1a89c67f8818397c6d28255">gfFileExists</a> = FALSE;
<a name="l00144"></a>00144       <a class="code" href="LoadScreen_8cpp.html#84e2524827ba1f3efbb1f2ab02cb442d">gfLoadError</a> = FALSE;
<a name="l00145"></a>00145       <a class="code" href="LoadScreen_8cpp.html#91b2a108c21fb11d89af4e5f3b97817f">gfIllegalName</a> = FALSE;
<a name="l00146"></a>00146       <a class="code" href="LoadScreen_8cpp.html#b43c1e38d7a5e1dfcca76d3fcf09a0aa">gfDeleteFile</a> = FALSE;
<a name="l00147"></a>00147       <a class="code" href="LoadScreen_8cpp.html#5615f1416e14f1149b1c98cd2128c3dd">gfNoFiles</a> = FALSE;
<a name="l00148"></a>00148 
<a name="l00149"></a>00149       <span class="comment">// setup filename dialog box</span>
<a name="l00150"></a>00150       <span class="comment">// (*.dat and *.map) as file filter</span>
<a name="l00151"></a>00151 
<a name="l00152"></a>00152       <span class="comment">// If user clicks on a filename in the window, then turn off string focus and re-init the string with the new name.</span>
<a name="l00153"></a>00153       <span class="comment">// If user hits ENTER or presses OK, then continue with the file loading/saving</span>
<a name="l00154"></a>00154 
<a name="l00155"></a>00155       <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#29b63ea968cd6c6eed712af82bb78c6f">FileList</a> )
<a name="l00156"></a>00156             <a class="code" href="LoadScreen_8cpp.html#f660863d8c04aa3ff731cb1672d14b58">TrashFDlgList</a>( <a class="code" href="LoadScreen_8cpp.html#29b63ea968cd6c6eed712af82bb78c6f">FileList</a> );
<a name="l00157"></a>00157 
<a name="l00158"></a>00158       <a class="code" href="LoadScreen_8cpp.html#79220a8a0aa9753cc18ffd6b5fc41af8">iTopFileShown</a> = <a class="code" href="LoadScreen_8cpp.html#af40284bcf5db835ad81993f0f083b4f">iTotalFiles</a> = 0;
<a name="l00159"></a>00159       <span class="keywordflow">if</span>( <a class="code" href="FileMan_8cpp.html#814a806a26f52acf155468be489ff535">GetFileFirst</a>(<span class="stringliteral">"MAPS\\*.dat"</span>, &amp;<a class="code" href="LoadScreen_8cpp.html#4fc225cd94b5bc30eb7df3f90b110245">FileInfo</a>) )
<a name="l00160"></a>00160       {
<a name="l00161"></a>00161             FileList = <a class="code" href="LoadScreen_8cpp.html#f33ad971c655faf8b21b2150e9b58d91">AddToFDlgList</a>( FileList, &amp;<a class="code" href="LoadScreen_8cpp.html#4fc225cd94b5bc30eb7df3f90b110245">FileInfo</a> );
<a name="l00162"></a>00162             <a class="code" href="LoadScreen_8cpp.html#af40284bcf5db835ad81993f0f083b4f">iTotalFiles</a>++;
<a name="l00163"></a>00163             <span class="keywordflow">while</span>( <a class="code" href="FileMan_8cpp.html#e21cd66082366a00e7e2f26f372177bf">GetFileNext</a>(&amp;<a class="code" href="LoadScreen_8cpp.html#4fc225cd94b5bc30eb7df3f90b110245">FileInfo</a>) )
<a name="l00164"></a>00164             {
<a name="l00165"></a>00165                   FileList = <a class="code" href="LoadScreen_8cpp.html#f33ad971c655faf8b21b2150e9b58d91">AddToFDlgList</a>( FileList, &amp;<a class="code" href="LoadScreen_8cpp.html#4fc225cd94b5bc30eb7df3f90b110245">FileInfo</a> );
<a name="l00166"></a>00166                   <a class="code" href="LoadScreen_8cpp.html#af40284bcf5db835ad81993f0f083b4f">iTotalFiles</a>++;
<a name="l00167"></a>00167             }
<a name="l00168"></a>00168             <a class="code" href="FileMan_8cpp.html#a095bb229d99e56752ea744a55422be8">GetFileClose</a>(&amp;<a class="code" href="LoadScreen_8cpp.html#4fc225cd94b5bc30eb7df3f90b110245">FileInfo</a>);
<a name="l00169"></a>00169       }
<a name="l00170"></a>00170 
<a name="l00171"></a>00171       swprintf( <a class="code" href="LoadScreen_8cpp.html#60f9817576e6b78becea64bef06407bc">zOrigName</a>, L<span class="stringliteral">"%s Map (*.dat)"</span>, <a class="code" href="EditorDefines_8h.html#ea401eeecb648bbbe96d6caf33fa7aac">iCurrentAction</a> == <a class="code" href="EditorDefines_8h.html#b04a0655cd1e3bcac5e8f48c18df1a574eb3737a7354a8763f5b2a2ced0166f0">ACTION_SAVE_MAP</a> ? L<span class="stringliteral">"Save"</span> : L<span class="stringliteral">"Load"</span> );
<a name="l00172"></a>00172 
<a name="l00173"></a>00173       swprintf( <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a>, L<span class="stringliteral">"%S"</span>, <a class="code" href="editscreen_8cpp.html#01a5706b7f6b82381c641d1b0933ca57">gubFilename</a> );
<a name="l00174"></a>00174 
<a name="l00175"></a>00175       <a class="code" href="LoadScreen_8cpp.html#30542ad6fc049e28aed9dd98042ea6b9">CreateFileDialog</a>( <a class="code" href="LoadScreen_8cpp.html#60f9817576e6b78becea64bef06407bc">zOrigName</a> );
<a name="l00176"></a>00176 
<a name="l00177"></a>00177       <span class="keywordflow">if</span>( !<a class="code" href="LoadScreen_8cpp.html#af40284bcf5db835ad81993f0f083b4f">iTotalFiles</a> )
<a name="l00178"></a>00178       {
<a name="l00179"></a>00179             <a class="code" href="LoadScreen_8cpp.html#5615f1416e14f1149b1c98cd2128c3dd">gfNoFiles</a> = TRUE;
<a name="l00180"></a>00180             <span class="keywordflow">if</span>( <a class="code" href="EditorDefines_8h.html#ea401eeecb648bbbe96d6caf33fa7aac">iCurrentAction</a> == <a class="code" href="EditorDefines_8h.html#b04a0655cd1e3bcac5e8f48c18df1a57760bd1a91db316cecf6d04b4ee45e0a9">ACTION_LOAD_MAP</a> )
<a name="l00181"></a>00181                   <a class="code" href="Button_01System_8cpp.html#f47071abdc2fdbae8fae4688cedaddfc">DisableButton</a>( <a class="code" href="LoadScreen_8cpp.html#4913515e1b230a105860c7c319fd3a69">iFileDlgButtons</a>[0] );
<a name="l00182"></a>00182       }
<a name="l00183"></a>00183 
<a name="l00184"></a>00184       <a class="code" href="LoadScreen_8cpp.html#6c2d4b83e871f3075db623297046cabf">iLastFileClicked</a> = -1;
<a name="l00185"></a>00185       <a class="code" href="LoadScreen_8cpp.html#5b44b96529e4b2986672c752f4339312">iLastClickTime</a> = 0;
<a name="l00186"></a>00186 
<a name="l00187"></a>00187 }
<a name="l00188"></a>00188 
<a name="l00189"></a><a class="code" href="LoadScreen_8cpp.html#4cf935782804f03f8715cdd7f87f2941">00189</a> <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="LoadScreen_8cpp.html#4cf935782804f03f8715cdd7f87f2941">ProcessLoadSaveScreenMessageBoxResult</a>()
<a name="l00190"></a>00190 {
<a name="l00191"></a>00191       <a class="code" href="struct__FDLG__LIST__TAG.html">FDLG_LIST</a> *curr, *temp;
<a name="l00192"></a>00192       <a class="code" href="EditorDefines_8h.html#5a075eed02dac8017c99a606bc7124c3">gfRenderWorld</a> = TRUE;
<a name="l00193"></a>00193       <a class="code" href="messagebox_8cpp.html#d177a6411da8905eda26837dfa1699c1">RemoveMessageBox</a>();
<a name="l00194"></a>00194       <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#91b2a108c21fb11d89af4e5f3b97817f">gfIllegalName</a> )
<a name="l00195"></a>00195       {
<a name="l00196"></a>00196             <a class="code" href="LoadScreen_8cpp.html#bd87611619e376f44f139d079b362200">fEnteringLoadSaveScreen</a> = TRUE;
<a name="l00197"></a>00197             <a class="code" href="LoadScreen_8cpp.html#24cfd80fa1e9d886174d56d2bb21ea93">RemoveFileDialog</a>();
<a name="l00198"></a>00198             <a class="code" href="Simple_01Render_01Utils_8cpp.html#31324950ad85a80baf8ca1187ecde54c">MarkWorldDirty</a>();
<a name="l00199"></a>00199             <span class="keywordflow">return</span> <a class="code" href="messagebox_8cpp.html#1a8f6fe19237af83a754c711ab210c27">gfMessageBoxResult</a> ? <a class="code" href="screenids_8h.html#a4ee5dea8709d2b490486a62df77faf28c585abe4ae19e69bcb3032f5a4bc714">LOADSAVE_SCREEN</a> : <a class="code" href="screenids_8h.html#a4ee5dea8709d2b490486a62df77faf21d939a0a63d99da9d7fe3bb42922c6fe">EDIT_SCREEN</a>;
<a name="l00200"></a>00200       }
<a name="l00201"></a>00201       <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#b43c1e38d7a5e1dfcca76d3fcf09a0aa">gfDeleteFile</a> )
<a name="l00202"></a>00202       {
<a name="l00203"></a>00203             <span class="keywordflow">if</span>( <a class="code" href="messagebox_8cpp.html#1a8f6fe19237af83a754c711ab210c27">gfMessageBoxResult</a> )
<a name="l00204"></a>00204             { <span class="comment">//delete file</span>
<a name="l00205"></a>00205                   <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> <a class="code" href="Sound_01Control_8cpp.html#6150e0515f7202e2fb518f7206ed97dc">x</a>;
<a name="l00206"></a>00206                   curr = <a class="code" href="LoadScreen_8cpp.html#29b63ea968cd6c6eed712af82bb78c6f">FileList</a>;
<a name="l00207"></a>00207                   <span class="keywordflow">for</span>( x = 0; x &lt; <a class="code" href="LoadScreen_8cpp.html#8a920e48f1c1b7160ad1ad85725ac98a">iCurrFileShown</a> &amp;&amp; x &lt; <a class="code" href="LoadScreen_8cpp.html#af40284bcf5db835ad81993f0f083b4f">iTotalFiles</a> &amp;&amp; curr; x++ )
<a name="l00208"></a>00208                   {
<a name="l00209"></a>00209                         curr = curr-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#b7de2d598cdc28e20a02aff085c02a98">pNext</a>;
<a name="l00210"></a>00210                   }
<a name="l00211"></a>00211                   <span class="keywordflow">if</span>( curr )
<a name="l00212"></a>00212                   {
<a name="l00213"></a>00213                         <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#ae946e10162e8ee15f889fd30302e596">gfReadOnly</a> )
<a name="l00214"></a>00214                         {
<a name="l00215"></a>00215                               <a class="code" href="FileMan_8cpp.html#ad7c00aee1214361479a45a31dc1668f">FileClearAttributes</a>( <a class="code" href="LoadScreen_8cpp.html#a7dca02c7858594c51d265593187229b">gszCurrFilename</a> );
<a name="l00216"></a>00216                               gfReadOnly = FALSE;
<a name="l00217"></a>00217                         }
<a name="l00218"></a>00218                         <a class="code" href="FileMan_8cpp.html#12ec9d9b03c4bea61fe2afecae64a230">FileDelete</a>( <a class="code" href="LoadScreen_8cpp.html#a7dca02c7858594c51d265593187229b">gszCurrFilename</a> );
<a name="l00219"></a>00219 
<a name="l00220"></a>00220                         <span class="comment">//File is deleted so redo the text fields so they show the </span>
<a name="l00221"></a>00221                         <span class="comment">//next file in the list.</span>
<a name="l00222"></a>00222                         temp = curr-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#b7de2d598cdc28e20a02aff085c02a98">pNext</a>;
<a name="l00223"></a>00223                         <span class="keywordflow">if</span>( !temp )
<a name="l00224"></a>00224                               temp = curr-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#e33a2c2e790ffd701f2145fa87ec3889">pPrev</a>;
<a name="l00225"></a>00225                         <span class="keywordflow">if</span>( !temp )
<a name="l00226"></a>00226                               <a class="code" href="Sys_01Globals_8h.html#3d1e5716a3d04a53b8846319dd57da83">wcscpy</a>( <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a>, L<span class="stringliteral">""</span> );
<a name="l00227"></a>00227                         <span class="keywordflow">else</span>
<a name="l00228"></a>00228                               swprintf( gzFilename, L<span class="stringliteral">"%S"</span>, temp-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#7de5ba8db78346865d64b61974a001a5">FileInfo</a>.<a class="code" href="struct__GETFILESTRUCT__TAG.html#1b5e35ca9109baa1edcecfcf46a54ef5">zFileName</a> );
<a name="l00229"></a>00229                         <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#959a90f653b5c2aca8adca4af875cf3d">ValidFilename</a>() )
<a name="l00230"></a>00230                         {
<a name="l00231"></a>00231                               <a class="code" href="Text_01Input_8cpp.html#885260f81e60cfffe73a8a6147c716f4">SetInputFieldStringWith16BitString</a>( 0, gzFilename );
<a name="l00232"></a>00232                         }
<a name="l00233"></a>00233                         <span class="keywordflow">else</span>
<a name="l00234"></a>00234                         {
<a name="l00235"></a>00235                               <a class="code" href="Text_01Input_8cpp.html#885260f81e60cfffe73a8a6147c716f4">SetInputFieldStringWith16BitString</a>( 0, L<span class="stringliteral">""</span> );
<a name="l00236"></a>00236                               <a class="code" href="Sys_01Globals_8h.html#3d1e5716a3d04a53b8846319dd57da83">wcscpy</a>( gzFilename, L<span class="stringliteral">""</span> );
<a name="l00237"></a>00237                         }
<a name="l00238"></a>00238                         <a class="code" href="LoadScreen_8cpp.html#68fbaa4dd1c6fecdaf051a6310c9ac81">RemoveFromFDlgList</a>( &amp;<a class="code" href="LoadScreen_8cpp.html#29b63ea968cd6c6eed712af82bb78c6f">FileList</a>, curr );
<a name="l00239"></a>00239                         <a class="code" href="LoadScreen_8cpp.html#af40284bcf5db835ad81993f0f083b4f">iTotalFiles</a>--;
<a name="l00240"></a>00240                         <span class="keywordflow">if</span>( !<a class="code" href="LoadScreen_8cpp.html#af40284bcf5db835ad81993f0f083b4f">iTotalFiles</a> )
<a name="l00241"></a>00241                         {
<a name="l00242"></a>00242                               <a class="code" href="LoadScreen_8cpp.html#5615f1416e14f1149b1c98cd2128c3dd">gfNoFiles</a> = TRUE;
<a name="l00243"></a>00243                               <span class="keywordflow">if</span>( <a class="code" href="EditorDefines_8h.html#ea401eeecb648bbbe96d6caf33fa7aac">iCurrentAction</a> == <a class="code" href="EditorDefines_8h.html#b04a0655cd1e3bcac5e8f48c18df1a57760bd1a91db316cecf6d04b4ee45e0a9">ACTION_LOAD_MAP</a> )
<a name="l00244"></a>00244                                     <a class="code" href="Button_01System_8cpp.html#f47071abdc2fdbae8fae4688cedaddfc">DisableButton</a>( <a class="code" href="LoadScreen_8cpp.html#4913515e1b230a105860c7c319fd3a69">iFileDlgButtons</a>[0] );
<a name="l00245"></a>00245                         }
<a name="l00246"></a>00246                         <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#8a920e48f1c1b7160ad1ad85725ac98a">iCurrFileShown</a> &gt;= <a class="code" href="LoadScreen_8cpp.html#af40284bcf5db835ad81993f0f083b4f">iTotalFiles</a> )
<a name="l00247"></a>00247                               <a class="code" href="LoadScreen_8cpp.html#8a920e48f1c1b7160ad1ad85725ac98a">iCurrFileShown</a>--;
<a name="l00248"></a>00248                         <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#8a920e48f1c1b7160ad1ad85725ac98a">iCurrFileShown</a> &lt; <a class="code" href="LoadScreen_8cpp.html#79220a8a0aa9753cc18ffd6b5fc41af8">iTopFileShown</a> )
<a name="l00249"></a>00249                               <a class="code" href="LoadScreen_8cpp.html#79220a8a0aa9753cc18ffd6b5fc41af8">iTopFileShown</a> -= 8;
<a name="l00250"></a>00250                         <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#79220a8a0aa9753cc18ffd6b5fc41af8">iTopFileShown</a> &lt; 0 )
<a name="l00251"></a>00251                               <a class="code" href="LoadScreen_8cpp.html#79220a8a0aa9753cc18ffd6b5fc41af8">iTopFileShown</a> = 0;
<a name="l00252"></a>00252                   }
<a name="l00253"></a>00253             }
<a name="l00254"></a>00254             <a class="code" href="Simple_01Render_01Utils_8cpp.html#31324950ad85a80baf8ca1187ecde54c">MarkWorldDirty</a>();
<a name="l00255"></a>00255             <a class="code" href="renderworld_8cpp.html#07e1fbf450cc1f0c2abad57af4384ea7">RenderWorld</a>();
<a name="l00256"></a>00256             <a class="code" href="LoadScreen_8cpp.html#b43c1e38d7a5e1dfcca76d3fcf09a0aa">gfDeleteFile</a> = FALSE;
<a name="l00257"></a>00257             <a class="code" href="LoadScreen_8cpp.html#a4f68159b63f4db51c1e9aa217085555">iFDlgState</a> = <a class="code" href="LoadScreen_8cpp.html#f9bdc3014f3d54c426b6d2df10de4960152a2a2058cc5f436d5528e0bfa9b1f5">DIALOG_NONE</a>;
<a name="l00258"></a>00258             <span class="keywordflow">return</span> <a class="code" href="screenids_8h.html#a4ee5dea8709d2b490486a62df77faf28c585abe4ae19e69bcb3032f5a4bc714">LOADSAVE_SCREEN</a>;
<a name="l00259"></a>00259       }
<a name="l00260"></a>00260       <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#84e2524827ba1f3efbb1f2ab02cb442d">gfLoadError</a> )
<a name="l00261"></a>00261       {
<a name="l00262"></a>00262             <a class="code" href="LoadScreen_8cpp.html#bd87611619e376f44f139d079b362200">fEnteringLoadSaveScreen</a> = TRUE;
<a name="l00263"></a>00263             <span class="keywordflow">return</span> <a class="code" href="messagebox_8cpp.html#1a8f6fe19237af83a754c711ab210c27">gfMessageBoxResult</a> ? <a class="code" href="screenids_8h.html#a4ee5dea8709d2b490486a62df77faf28c585abe4ae19e69bcb3032f5a4bc714">LOADSAVE_SCREEN</a> : <a class="code" href="screenids_8h.html#a4ee5dea8709d2b490486a62df77faf21d939a0a63d99da9d7fe3bb42922c6fe">EDIT_SCREEN</a>;
<a name="l00264"></a>00264       }
<a name="l00265"></a>00265       <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#ae946e10162e8ee15f889fd30302e596">gfReadOnly</a> )
<a name="l00266"></a>00266       { <span class="comment">//file is readonly.  Result will determine if the file dialog stays up.</span>
<a name="l00267"></a>00267             <a class="code" href="LoadScreen_8cpp.html#bd87611619e376f44f139d079b362200">fEnteringLoadSaveScreen</a> = TRUE;
<a name="l00268"></a>00268             <a class="code" href="LoadScreen_8cpp.html#24cfd80fa1e9d886174d56d2bb21ea93">RemoveFileDialog</a>();
<a name="l00269"></a>00269             <span class="keywordflow">return</span> <a class="code" href="messagebox_8cpp.html#1a8f6fe19237af83a754c711ab210c27">gfMessageBoxResult</a> ? <a class="code" href="screenids_8h.html#a4ee5dea8709d2b490486a62df77faf28c585abe4ae19e69bcb3032f5a4bc714">LOADSAVE_SCREEN</a> : <a class="code" href="screenids_8h.html#a4ee5dea8709d2b490486a62df77faf21d939a0a63d99da9d7fe3bb42922c6fe">EDIT_SCREEN</a>;
<a name="l00270"></a>00270       }
<a name="l00271"></a>00271       <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#8b40d98ae1a89c67f8818397c6d28255">gfFileExists</a> )
<a name="l00272"></a>00272       {
<a name="l00273"></a>00273             <span class="keywordflow">if</span>( <a class="code" href="messagebox_8cpp.html#1a8f6fe19237af83a754c711ab210c27">gfMessageBoxResult</a> )
<a name="l00274"></a>00274             { <span class="comment">//okay to overwrite file</span>
<a name="l00275"></a>00275                   <a class="code" href="LoadScreen_8cpp.html#24cfd80fa1e9d886174d56d2bb21ea93">RemoveFileDialog</a>();
<a name="l00276"></a>00276                   <a class="code" href="LoadScreen_8cpp.html#d3c970f25d546d5a5f50c4707d4598ed">gbCurrentFileIOStatus</a> = <a class="code" href="LoadScreen_8cpp.html#db49720dc49f7d4e4cf9adbf2948e4092a08c52c59022a7f53ca802e874d6b01">INITIATE_MAP_SAVE</a>;
<a name="l00277"></a>00277                   <span class="keywordflow">return</span> <a class="code" href="screenids_8h.html#a4ee5dea8709d2b490486a62df77faf28c585abe4ae19e69bcb3032f5a4bc714">LOADSAVE_SCREEN</a>;
<a name="l00278"></a>00278             }
<a name="l00279"></a>00279             <a class="code" href="LoadScreen_8cpp.html#bd87611619e376f44f139d079b362200">fEnteringLoadSaveScreen</a> = TRUE;
<a name="l00280"></a>00280             <a class="code" href="LoadScreen_8cpp.html#24cfd80fa1e9d886174d56d2bb21ea93">RemoveFileDialog</a>();
<a name="l00281"></a>00281             <span class="keywordflow">return</span> <a class="code" href="screenids_8h.html#a4ee5dea8709d2b490486a62df77faf21d939a0a63d99da9d7fe3bb42922c6fe">EDIT_SCREEN</a> ;
<a name="l00282"></a>00282       }
<a name="l00283"></a>00283       Assert( 0 );
<a name="l00284"></a>00284       <span class="keywordflow">return</span> <a class="code" href="screenids_8h.html#a4ee5dea8709d2b490486a62df77faf28c585abe4ae19e69bcb3032f5a4bc714">LOADSAVE_SCREEN</a>;
<a name="l00285"></a>00285 }
<a name="l00286"></a>00286 
<a name="l00287"></a><a class="code" href="jascreens_8h.html#16ad67dcc372a6e73a7a8aba15660eee">00287</a> <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="LoadScreen_8cpp.html#16ad67dcc372a6e73a7a8aba15660eee">LoadSaveScreenHandle</a>(<span class="keywordtype">void</span>)
<a name="l00288"></a>00288 {
<a name="l00289"></a>00289       <a class="code" href="struct__FDLG__LIST__TAG.html">FDLG_LIST</a> *FListNode;
<a name="l00290"></a>00290       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> <a class="code" href="Sound_01Control_8cpp.html#6150e0515f7202e2fb518f7206ed97dc">x</a>;
<a name="l00291"></a>00291       <a class="code" href="structInputAtom.html">InputAtom</a> DialogEvent;
<a name="l00292"></a>00292 
<a name="l00293"></a>00293       <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#bd87611619e376f44f139d079b362200">fEnteringLoadSaveScreen</a> )
<a name="l00294"></a>00294       {
<a name="l00295"></a>00295             <a class="code" href="LoadScreen_8cpp.html#701d801259dd43c9e2443ebaeff161d3">LoadSaveScreenEntry</a>();
<a name="l00296"></a>00296       }
<a name="l00297"></a>00297 
<a name="l00298"></a>00298       <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#d3c970f25d546d5a5f50c4707d4598ed">gbCurrentFileIOStatus</a> ) <span class="comment">//loading or saving map</span>
<a name="l00299"></a>00299       {
<a name="l00300"></a>00300             <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiScreen;
<a name="l00301"></a>00301             uiScreen = <a class="code" href="LoadScreen_8cpp.html#2967ee50affa57514d2003964c08cb52">ProcessFileIO</a>();
<a name="l00302"></a>00302             <span class="keywordflow">if</span>( uiScreen == <a class="code" href="screenids_8h.html#a4ee5dea8709d2b490486a62df77faf21d939a0a63d99da9d7fe3bb42922c6fe">EDIT_SCREEN</a> &amp;&amp; <a class="code" href="LoadScreen_8cpp.html#d3c970f25d546d5a5f50c4707d4598ed">gbCurrentFileIOStatus</a> == <a class="code" href="LoadScreen_8cpp.html#db49720dc49f7d4e4cf9adbf2948e4090e240497198f4fc7d7f0d8f1565ca50a">LOADING_MAP</a> )
<a name="l00303"></a>00303                   <a class="code" href="Animated_01ProgressBar_8cpp.html#27b91e4c8bd3719a3266aaa45fb29c9e">RemoveProgressBar</a>( 0 );
<a name="l00304"></a>00304             <span class="keywordflow">return</span> uiScreen;
<a name="l00305"></a>00305       }
<a name="l00306"></a>00306 
<a name="l00307"></a>00307       <span class="keywordflow">if</span>( <a class="code" href="messagebox_8cpp.html#7ec00e961b916b3b350dfde8697c213d">gubMessageBoxStatus</a> )
<a name="l00308"></a>00308       {
<a name="l00309"></a>00309             <span class="keywordflow">if</span>( <a class="code" href="messagebox_8cpp.html#6c9d870e0a89fd1e4daa776856626274">MessageBoxHandled</a>() )
<a name="l00310"></a>00310                   <span class="keywordflow">return</span> <a class="code" href="LoadScreen_8cpp.html#4cf935782804f03f8715cdd7f87f2941">ProcessLoadSaveScreenMessageBoxResult</a>();
<a name="l00311"></a>00311             <span class="keywordflow">return</span> <a class="code" href="screenids_8h.html#a4ee5dea8709d2b490486a62df77faf28c585abe4ae19e69bcb3032f5a4bc714">LOADSAVE_SCREEN</a>;
<a name="l00312"></a>00312       }
<a name="l00313"></a>00313       
<a name="l00314"></a>00314       <span class="comment">//handle all key input.</span>
<a name="l00315"></a>00315       <span class="keywordflow">while</span>( <a class="code" href="input_8cpp.html#aa80627b666beae961462d3619bfa8b3">DequeueEvent</a>(&amp;DialogEvent) )
<a name="l00316"></a>00316       {
<a name="l00317"></a>00317             <span class="keywordflow">if</span>( !<a class="code" href="Text_01Input_8cpp.html#e40026592a0bc40b2d5247f00eaaed33">HandleTextInput</a>(&amp;DialogEvent) &amp;&amp; (DialogEvent.<a class="code" href="structInputAtom.html#3cf53aa0e37277ff1a69bb6230e600ce">usEvent</a> == KEY_DOWN || DialogEvent.<a class="code" href="structInputAtom.html#3cf53aa0e37277ff1a69bb6230e600ce">usEvent</a> == KEY_REPEAT) )
<a name="l00318"></a>00318             { 
<a name="l00319"></a>00319                   <a class="code" href="LoadScreen_8cpp.html#2d60bde417f5c4932c03e3c697dc7761">HandleMainKeyEvents</a>( &amp;DialogEvent );
<a name="l00320"></a>00320             }
<a name="l00321"></a>00321       }
<a name="l00322"></a>00322       
<a name="l00323"></a>00323       <a class="code" href="LoadScreen_8cpp.html#a0f4f2b198dc9379a57f4eb047617e33">DrawFileDialog</a>();
<a name="l00324"></a>00324 
<a name="l00325"></a>00325       <span class="comment">// Skip to first filename to show</span>
<a name="l00326"></a>00326       FListNode = <a class="code" href="LoadScreen_8cpp.html#29b63ea968cd6c6eed712af82bb78c6f">FileList</a>;
<a name="l00327"></a>00327       <span class="keywordflow">for</span>(x=0;x&lt;<a class="code" href="LoadScreen_8cpp.html#79220a8a0aa9753cc18ffd6b5fc41af8">iTopFileShown</a> &amp;&amp; x&lt;<a class="code" href="LoadScreen_8cpp.html#af40284bcf5db835ad81993f0f083b4f">iTotalFiles</a> &amp;&amp; FListNode != NULL;x++)
<a name="l00328"></a>00328       {
<a name="l00329"></a>00329             FListNode = FListNode-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#b7de2d598cdc28e20a02aff085c02a98">pNext</a>;
<a name="l00330"></a>00330       }
<a name="l00331"></a>00331 
<a name="l00332"></a>00332       <span class="comment">// Show up to 8 filenames in the window</span>
<a name="l00333"></a>00333       <a class="code" href="Font_8cpp.html#fa4871009f0473cca0380217753947dc">SetFont</a>( FONT12POINT1 );
<a name="l00334"></a>00334       <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#5615f1416e14f1149b1c98cd2128c3dd">gfNoFiles</a> )
<a name="l00335"></a>00335       {
<a name="l00336"></a>00336             <a class="code" href="Font_8cpp.html#388be5810478c3f3bdb861f144085d70">SetFontForeground</a>( FONT_LTRED );
<a name="l00337"></a>00337             <a class="code" href="Font_8cpp.html#a1fe8cc526be9e2c96b5dd66e348506f">SetFontBackground</a>( 142 );
<a name="l00338"></a>00338         <a class="code" href="Font_8cpp.html#b3e12cf19a0ca58abf6689cc8eca3ead">mprintf</a>( 226, 126, L<span class="stringliteral">"NO FILES IN \\MAPS DIRECTORY"</span> );
<a name="l00339"></a>00339       }
<a name="l00340"></a>00340       <span class="keywordflow">else</span> <span class="keywordflow">for</span>(x=<a class="code" href="LoadScreen_8cpp.html#79220a8a0aa9753cc18ffd6b5fc41af8">iTopFileShown</a>;x&lt;(<a class="code" href="LoadScreen_8cpp.html#79220a8a0aa9753cc18ffd6b5fc41af8">iTopFileShown</a>+8) &amp;&amp; x&lt;<a class="code" href="LoadScreen_8cpp.html#af40284bcf5db835ad81993f0f083b4f">iTotalFiles</a> &amp;&amp; FListNode != NULL; x++)
<a name="l00341"></a>00341       {
<a name="l00342"></a>00342             <span class="keywordflow">if</span>( !<a class="code" href="Text_01Input_8cpp.html#e6073d61d51215b4fee18b33fa69f2e4">EditingText</a>() &amp;&amp; x == <a class="code" href="LoadScreen_8cpp.html#8a920e48f1c1b7160ad1ad85725ac98a">iCurrFileShown</a>  )
<a name="l00343"></a>00343             {
<a name="l00344"></a>00344                   <a class="code" href="Font_8cpp.html#388be5810478c3f3bdb861f144085d70">SetFontForeground</a>( FONT_GRAY2 );
<a name="l00345"></a>00345                   <a class="code" href="Font_8cpp.html#a1fe8cc526be9e2c96b5dd66e348506f">SetFontBackground</a>( FONT_METALGRAY );
<a name="l00346"></a>00346             }
<a name="l00347"></a>00347             <span class="keywordflow">else</span>
<a name="l00348"></a>00348             {
<a name="l00349"></a>00349                   <a class="code" href="Font_8cpp.html#388be5810478c3f3bdb861f144085d70">SetFontForeground</a>( FONT_BLACK );
<a name="l00350"></a>00350                   <a class="code" href="Font_8cpp.html#a1fe8cc526be9e2c96b5dd66e348506f">SetFontBackground</a>( 142 );
<a name="l00351"></a>00351             }
<a name="l00352"></a>00352             <a class="code" href="Font_8cpp.html#b3e12cf19a0ca58abf6689cc8eca3ead">mprintf</a>( 186,(73+ (x-<a class="code" href="LoadScreen_8cpp.html#79220a8a0aa9753cc18ffd6b5fc41af8">iTopFileShown</a>)*15 ), L<span class="stringliteral">"%S"</span>, FListNode-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#7de5ba8db78346865d64b61974a001a5">FileInfo</a>.<a class="code" href="struct__GETFILESTRUCT__TAG.html#1b5e35ca9109baa1edcecfcf46a54ef5">zFileName</a>);
<a name="l00353"></a>00353             FListNode = FListNode-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#b7de2d598cdc28e20a02aff085c02a98">pNext</a>;
<a name="l00354"></a>00354       }
<a name="l00355"></a>00355 
<a name="l00356"></a>00356       <a class="code" href="Text_01Input_8cpp.html#1956083de1b05d735adeeb2579a2735c">RenderAllTextFields</a>();
<a name="l00357"></a>00357 
<a name="l00358"></a>00358       <a class="code" href="video_8cpp.html#02ed05b095e30f580eeba68eff78327c">InvalidateScreen</a>();
<a name="l00359"></a>00359 
<a name="l00360"></a>00360       <a class="code" href="Render_01Dirty_8cpp.html#8db36a227ea1a41076c6dc7de2a28084">ExecuteBaseDirtyRectQueue</a>();
<a name="l00361"></a>00361       <a class="code" href="video_8cpp.html#cb214b937b77ff6e2f5f80a7fe45ea5a">EndFrameBufferRender</a>();
<a name="l00362"></a>00362 
<a name="l00363"></a>00363       <span class="keywordflow">switch</span>( <a class="code" href="LoadScreen_8cpp.html#a4f68159b63f4db51c1e9aa217085555">iFDlgState</a> )
<a name="l00364"></a>00364       {
<a name="l00365"></a>00365             <span class="keywordflow">case</span> <a class="code" href="LoadScreen_8cpp.html#f9bdc3014f3d54c426b6d2df10de4960032ac5436ce32d651982f9a7a5809daf">DIALOG_CANCEL</a>:
<a name="l00366"></a>00366                   <a class="code" href="LoadScreen_8cpp.html#24cfd80fa1e9d886174d56d2bb21ea93">RemoveFileDialog</a>();
<a name="l00367"></a>00367                   <a class="code" href="LoadScreen_8cpp.html#bd87611619e376f44f139d079b362200">fEnteringLoadSaveScreen</a> = TRUE;
<a name="l00368"></a>00368                   <span class="keywordflow">return</span> <a class="code" href="screenids_8h.html#a4ee5dea8709d2b490486a62df77faf21d939a0a63d99da9d7fe3bb42922c6fe">EDIT_SCREEN</a>;
<a name="l00369"></a>00369             <span class="keywordflow">case</span> <a class="code" href="LoadScreen_8cpp.html#f9bdc3014f3d54c426b6d2df10de496021427825a88c29315f0348666ddaaf97">DIALOG_DELETE</a>:
<a name="l00370"></a>00370                   sprintf( <a class="code" href="LoadScreen_8cpp.html#a7dca02c7858594c51d265593187229b">gszCurrFilename</a>, <span class="stringliteral">"MAPS\\%S"</span>, <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a> );
<a name="l00371"></a>00371                   <span class="keywordflow">if</span>( <a class="code" href="FileMan_8cpp.html#814a806a26f52acf155468be489ff535">GetFileFirst</a>(<a class="code" href="LoadScreen_8cpp.html#a7dca02c7858594c51d265593187229b">gszCurrFilename</a>, &amp;<a class="code" href="LoadScreen_8cpp.html#4fc225cd94b5bc30eb7df3f90b110245">FileInfo</a>) )
<a name="l00372"></a>00372                   {
<a name="l00373"></a>00373                         <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> <a class="code" href="Button_01System_8cpp.html#ac22642f3052cc77a6991a262ce4ad23">str</a>[40];
<a name="l00374"></a>00374                         <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#4fc225cd94b5bc30eb7df3f90b110245">FileInfo</a>.<a class="code" href="struct__GETFILESTRUCT__TAG.html#553fdea84c84030e0a6df2355f04d165">uiFileAttribs</a> &amp; (FILE_IS_READONLY|FILE_IS_HIDDEN|FILE_IS_SYSTEM) )
<a name="l00375"></a>00375                         {
<a name="l00376"></a>00376                               swprintf( str, L<span class="stringliteral">" Delete READ-ONLY file %s? "</span>, <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a> );
<a name="l00377"></a>00377                               <a class="code" href="LoadScreen_8cpp.html#ae946e10162e8ee15f889fd30302e596">gfReadOnly</a> = TRUE;
<a name="l00378"></a>00378                         }
<a name="l00379"></a>00379                         <span class="keywordflow">else</span>
<a name="l00380"></a>00380                               swprintf( str, L<span class="stringliteral">" Delete file %s? "</span>, <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a> );
<a name="l00381"></a>00381                         <a class="code" href="LoadScreen_8cpp.html#b43c1e38d7a5e1dfcca76d3fcf09a0aa">gfDeleteFile</a> = TRUE;
<a name="l00382"></a>00382                         <a class="code" href="messagebox_8cpp.html#00e4123be5ce441eefddb453f73b7493">CreateMessageBox</a>( str );
<a name="l00383"></a>00383                   }
<a name="l00384"></a>00384                   <span class="keywordflow">return</span> <a class="code" href="screenids_8h.html#a4ee5dea8709d2b490486a62df77faf28c585abe4ae19e69bcb3032f5a4bc714">LOADSAVE_SCREEN</a>;
<a name="l00385"></a>00385             <span class="keywordflow">case</span> <a class="code" href="LoadScreen_8cpp.html#f9bdc3014f3d54c426b6d2df10de49601b312278c9afeabd86b3bb4ab178ecf8">DIALOG_SAVE</a>:
<a name="l00386"></a>00386                   <span class="keywordflow">if</span>( !<a class="code" href="LoadScreen_8cpp.html#65e9d12bc60feb6ee32a669a38397a0d">ExtractFilenameFromFields</a>() )
<a name="l00387"></a>00387                   {
<a name="l00388"></a>00388                         <a class="code" href="messagebox_8cpp.html#00e4123be5ce441eefddb453f73b7493">CreateMessageBox</a>( L<span class="stringliteral">" Illegal filename.  Try another filename? "</span> );
<a name="l00389"></a>00389                         <a class="code" href="LoadScreen_8cpp.html#91b2a108c21fb11d89af4e5f3b97817f">gfIllegalName</a> = TRUE;
<a name="l00390"></a>00390                         <a class="code" href="LoadScreen_8cpp.html#a4f68159b63f4db51c1e9aa217085555">iFDlgState</a> = <a class="code" href="LoadScreen_8cpp.html#f9bdc3014f3d54c426b6d2df10de4960152a2a2058cc5f436d5528e0bfa9b1f5">DIALOG_NONE</a>;
<a name="l00391"></a>00391                         <span class="keywordflow">return</span> <a class="code" href="screenids_8h.html#a4ee5dea8709d2b490486a62df77faf28c585abe4ae19e69bcb3032f5a4bc714">LOADSAVE_SCREEN</a>;
<a name="l00392"></a>00392                   }
<a name="l00393"></a>00393                   sprintf( <a class="code" href="LoadScreen_8cpp.html#a7dca02c7858594c51d265593187229b">gszCurrFilename</a>, <span class="stringliteral">"MAPS\\%S"</span>, <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a> );
<a name="l00394"></a>00394                   <span class="keywordflow">if</span> ( <a class="code" href="FileMan_8cpp.html#8eb098ceba9cecc2c60c7e40c964e147">FileExists</a>( <a class="code" href="LoadScreen_8cpp.html#a7dca02c7858594c51d265593187229b">gszCurrFilename</a> ) ) 
<a name="l00395"></a>00395                   {
<a name="l00396"></a>00396                         <a class="code" href="LoadScreen_8cpp.html#8b40d98ae1a89c67f8818397c6d28255">gfFileExists</a> = TRUE;
<a name="l00397"></a>00397                         <a class="code" href="LoadScreen_8cpp.html#ae946e10162e8ee15f889fd30302e596">gfReadOnly</a> = FALSE;
<a name="l00398"></a>00398                         <span class="keywordflow">if</span>( <a class="code" href="FileMan_8cpp.html#814a806a26f52acf155468be489ff535">GetFileFirst</a>(<a class="code" href="LoadScreen_8cpp.html#a7dca02c7858594c51d265593187229b">gszCurrFilename</a>, &amp;<a class="code" href="LoadScreen_8cpp.html#4fc225cd94b5bc30eb7df3f90b110245">FileInfo</a>) )
<a name="l00399"></a>00399                         {
<a name="l00400"></a>00400                               <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#4fc225cd94b5bc30eb7df3f90b110245">FileInfo</a>.<a class="code" href="struct__GETFILESTRUCT__TAG.html#553fdea84c84030e0a6df2355f04d165">uiFileAttribs</a> &amp; (FILE_IS_READONLY|FILE_IS_DIRECTORY|FILE_IS_HIDDEN|FILE_IS_SYSTEM|FILE_IS_OFFLINE|FILE_IS_TEMPORARY) )
<a name="l00401"></a>00401                                     <a class="code" href="LoadScreen_8cpp.html#ae946e10162e8ee15f889fd30302e596">gfReadOnly</a> = TRUE;
<a name="l00402"></a>00402                               <a class="code" href="FileMan_8cpp.html#a095bb229d99e56752ea744a55422be8">GetFileClose</a>(&amp;<a class="code" href="LoadScreen_8cpp.html#4fc225cd94b5bc30eb7df3f90b110245">FileInfo</a>);
<a name="l00403"></a>00403                         }
<a name="l00404"></a>00404                         <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#ae946e10162e8ee15f889fd30302e596">gfReadOnly</a> )
<a name="l00405"></a>00405                               <a class="code" href="messagebox_8cpp.html#00e4123be5ce441eefddb453f73b7493">CreateMessageBox</a>( L<span class="stringliteral">" File is read only!  Choose a different name? "</span> );
<a name="l00406"></a>00406                         <span class="keywordflow">else</span>
<a name="l00407"></a>00407                               <a class="code" href="messagebox_8cpp.html#00e4123be5ce441eefddb453f73b7493">CreateMessageBox</a>( L<span class="stringliteral">" File exists, Overwrite? "</span> );
<a name="l00408"></a>00408                         <span class="keywordflow">return</span>( <a class="code" href="screenids_8h.html#a4ee5dea8709d2b490486a62df77faf28c585abe4ae19e69bcb3032f5a4bc714">LOADSAVE_SCREEN</a> );
<a name="l00409"></a>00409                   }     
<a name="l00410"></a>00410                   <a class="code" href="LoadScreen_8cpp.html#24cfd80fa1e9d886174d56d2bb21ea93">RemoveFileDialog</a>();
<a name="l00411"></a>00411                   <a class="code" href="LoadScreen_8cpp.html#d3c970f25d546d5a5f50c4707d4598ed">gbCurrentFileIOStatus</a> = <a class="code" href="LoadScreen_8cpp.html#db49720dc49f7d4e4cf9adbf2948e4092a08c52c59022a7f53ca802e874d6b01">INITIATE_MAP_SAVE</a>;
<a name="l00412"></a>00412                   <span class="keywordflow">return</span> <a class="code" href="screenids_8h.html#a4ee5dea8709d2b490486a62df77faf28c585abe4ae19e69bcb3032f5a4bc714">LOADSAVE_SCREEN</a> ;
<a name="l00413"></a>00413             <span class="keywordflow">case</span> <a class="code" href="LoadScreen_8cpp.html#f9bdc3014f3d54c426b6d2df10de496088a277ead75be15a416e01e349f3d2bd">DIALOG_LOAD</a>:
<a name="l00414"></a>00414                   <span class="keywordflow">if</span>( !<a class="code" href="LoadScreen_8cpp.html#65e9d12bc60feb6ee32a669a38397a0d">ExtractFilenameFromFields</a>() )
<a name="l00415"></a>00415                   {
<a name="l00416"></a>00416                         <a class="code" href="messagebox_8cpp.html#00e4123be5ce441eefddb453f73b7493">CreateMessageBox</a>( L<span class="stringliteral">" Illegal filename.  Try another filename? "</span> );
<a name="l00417"></a>00417                         <a class="code" href="LoadScreen_8cpp.html#91b2a108c21fb11d89af4e5f3b97817f">gfIllegalName</a> = TRUE;
<a name="l00418"></a>00418                         <a class="code" href="LoadScreen_8cpp.html#a4f68159b63f4db51c1e9aa217085555">iFDlgState</a> = <a class="code" href="LoadScreen_8cpp.html#f9bdc3014f3d54c426b6d2df10de4960152a2a2058cc5f436d5528e0bfa9b1f5">DIALOG_NONE</a>;
<a name="l00419"></a>00419                         <span class="keywordflow">return</span> <a class="code" href="screenids_8h.html#a4ee5dea8709d2b490486a62df77faf28c585abe4ae19e69bcb3032f5a4bc714">LOADSAVE_SCREEN</a>;
<a name="l00420"></a>00420                   }
<a name="l00421"></a>00421                   <a class="code" href="LoadScreen_8cpp.html#24cfd80fa1e9d886174d56d2bb21ea93">RemoveFileDialog</a>();
<a name="l00422"></a>00422                   <a class="code" href="Animated_01ProgressBar_8cpp.html#d377396e8c5ae9a8c8383d3ef6e963a9">CreateProgressBar</a>( 0, 118, 183, 522, 202 );
<a name="l00423"></a>00423                   <a class="code" href="Animated_01ProgressBar_8cpp.html#e3c5454cfaff4aea0825296026d6051b">DefineProgressBarPanel</a>( 0, 65, 79, 94, 100, 155, 540, 235 );
<a name="l00424"></a>00424                   swprintf( <a class="code" href="LoadScreen_8cpp.html#60f9817576e6b78becea64bef06407bc">zOrigName</a>, L<span class="stringliteral">"Loading map:  %s"</span>, <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a> );
<a name="l00425"></a>00425                   <a class="code" href="Animated_01ProgressBar_8cpp.html#12c62255d4a96c6fe7e09e2e75788e41">SetProgressBarTitle</a>( 0, <a class="code" href="LoadScreen_8cpp.html#60f9817576e6b78becea64bef06407bc">zOrigName</a>, BLOCKFONT2, FONT_RED, FONT_NEARBLACK );
<a name="l00426"></a>00426                   <a class="code" href="LoadScreen_8cpp.html#d3c970f25d546d5a5f50c4707d4598ed">gbCurrentFileIOStatus</a> = <a class="code" href="LoadScreen_8cpp.html#db49720dc49f7d4e4cf9adbf2948e40906307193c24b68a9d23c6b91982c6b5b">INITIATE_MAP_LOAD</a>;
<a name="l00427"></a>00427                   <span class="keywordflow">return</span> <a class="code" href="screenids_8h.html#a4ee5dea8709d2b490486a62df77faf28c585abe4ae19e69bcb3032f5a4bc714">LOADSAVE_SCREEN</a> ;
<a name="l00428"></a>00428             <span class="keywordflow">default</span>:
<a name="l00429"></a>00429                   <a class="code" href="LoadScreen_8cpp.html#a4f68159b63f4db51c1e9aa217085555">iFDlgState</a> = <a class="code" href="LoadScreen_8cpp.html#f9bdc3014f3d54c426b6d2df10de4960152a2a2058cc5f436d5528e0bfa9b1f5">DIALOG_NONE</a>;
<a name="l00430"></a>00430       }
<a name="l00431"></a>00431       <a class="code" href="LoadScreen_8cpp.html#a4f68159b63f4db51c1e9aa217085555">iFDlgState</a> = <a class="code" href="LoadScreen_8cpp.html#f9bdc3014f3d54c426b6d2df10de4960152a2a2058cc5f436d5528e0bfa9b1f5">DIALOG_NONE</a>;
<a name="l00432"></a>00432       <span class="keywordflow">return</span> <a class="code" href="screenids_8h.html#a4ee5dea8709d2b490486a62df77faf28c585abe4ae19e69bcb3032f5a4bc714">LOADSAVE_SCREEN</a> ;
<a name="l00433"></a>00433 }
<a name="l00434"></a>00434 
<a name="l00435"></a>00435 
<a name="l00436"></a><a class="code" href="LoadScreen_8h.html#30542ad6fc049e28aed9dd98042ea6b9">00436</a> <span class="keywordtype">void</span> <a class="code" href="LoadScreen_8cpp.html#30542ad6fc049e28aed9dd98042ea6b9">CreateFileDialog</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *zTitle )
<a name="l00437"></a>00437 {
<a name="l00438"></a>00438 
<a name="l00439"></a>00439       <a class="code" href="LoadScreen_8cpp.html#a4f68159b63f4db51c1e9aa217085555">iFDlgState</a> = <a class="code" href="LoadScreen_8cpp.html#f9bdc3014f3d54c426b6d2df10de4960152a2a2058cc5f436d5528e0bfa9b1f5">DIALOG_NONE</a>;
<a name="l00440"></a>00440 
<a name="l00441"></a>00441       <a class="code" href="Editor_01Taskbar_01Utils_8cpp.html#72804c1d07f8cfa8d5c7c22e9cc73624">DisableEditorTaskbar</a>();
<a name="l00442"></a>00442 
<a name="l00443"></a>00443       <a class="code" href="mousesystem_8cpp.html#dce08766ef4cbacb9372efe12d26a1e0">MSYS_DefineRegion</a>( &amp;<a class="code" href="LoadScreen_8cpp.html#e3ef96201acb4cc43c0b3ea6b3ae26fb">BlanketRegion</a>, 0, 0, <a class="code" href="renderworld_8cpp.html#829facd7abae54fcc284037c443e54bf">gsVIEWPORT_END_X</a>, <a class="code" href="HelpScreen_8cpp.html#268f46eb948cd6eb0f3406b688e4ccaa">gsVIEWPORT_END_Y</a>, MSYS_PRIORITY_HIGH - 5, 0, 0, 0 );
<a name="l00444"></a>00444 
<a name="l00445"></a>00445       <span class="comment">//Okay and cancel buttons</span>
<a name="l00446"></a>00446       <a class="code" href="LoadScreen_8cpp.html#4913515e1b230a105860c7c319fd3a69">iFileDlgButtons</a>[0] = <a class="code" href="Button_01System_8cpp.html#16393e47d05ca56c74fc5c61f889e3e5">CreateTextButton</a>( L<span class="stringliteral">"Okay"</span>, FONT12POINT1, FONT_BLACK, FONT_BLACK,
<a name="l00447"></a>00447             BUTTON_USE_DEFAULT, 354, 225, 50, 30, BUTTON_NO_TOGGLE,     MSYS_PRIORITY_HIGH, DEFAULT_MOVE_CALLBACK, <a class="code" href="LoadScreen_8cpp.html#f30ce5b6f85deceea09c7cf3293b831a">FDlgOkCallback</a> );
<a name="l00448"></a>00448       <a class="code" href="LoadScreen_8cpp.html#4913515e1b230a105860c7c319fd3a69">iFileDlgButtons</a>[1] = <a class="code" href="Button_01System_8cpp.html#16393e47d05ca56c74fc5c61f889e3e5">CreateTextButton</a>( L<span class="stringliteral">"Cancel"</span>, FONT12POINT1, FONT_BLACK, FONT_BLACK,
<a name="l00449"></a>00449             BUTTON_USE_DEFAULT, 406, 225, 50, 30, BUTTON_NO_TOGGLE, MSYS_PRIORITY_HIGH, DEFAULT_MOVE_CALLBACK, <a class="code" href="LoadScreen_8cpp.html#290c1b35c25fae6611f19d55c9fcac35">FDlgCancelCallback</a> );
<a name="l00450"></a>00450 
<a name="l00451"></a>00451       <span class="comment">//Scroll buttons</span>
<a name="l00452"></a>00452       <a class="code" href="LoadScreen_8cpp.html#4913515e1b230a105860c7c319fd3a69">iFileDlgButtons</a>[2] = <a class="code" href="Button_01System_8cpp.html#69d6ea0a3c6c05b8e9d7d0251c237039">CreateSimpleButton</a>( 426,92,<span class="stringliteral">"EDITOR//uparrow.sti"</span>, BUTTON_NO_TOGGLE,
<a name="l00453"></a>00453                                                                                                 MSYS_PRIORITY_HIGH, <a class="code" href="LoadScreen_8cpp.html#674fe75c4617cdc24bc87c5b10771399">FDlgUpCallback</a> );
<a name="l00454"></a>00454       <a class="code" href="LoadScreen_8cpp.html#4913515e1b230a105860c7c319fd3a69">iFileDlgButtons</a>[3] = <a class="code" href="Button_01System_8cpp.html#69d6ea0a3c6c05b8e9d7d0251c237039">CreateSimpleButton</a>( 426,182,<span class="stringliteral">"EDITOR//downarrow.sti"</span>, BUTTON_NO_TOGGLE,
<a name="l00455"></a>00455                                                                                                 MSYS_PRIORITY_HIGH, <a class="code" href="LoadScreen_8cpp.html#89d650e2b6c222efd8f93c6e98bdd3b1">FDlgDwnCallback</a> );
<a name="l00456"></a>00456 
<a name="l00457"></a>00457       <span class="comment">//File list window</span>
<a name="l00458"></a>00458       <a class="code" href="LoadScreen_8cpp.html#4913515e1b230a105860c7c319fd3a69">iFileDlgButtons</a>[4] = <a class="code" href="Button_01System_8cpp.html#71e1290225dfbcecda8d398b5a2d68eb">CreateHotSpot</a>( (179+4), (69+3), (179+4+240), (69+120+3), MSYS_PRIORITY_HIGH-1, BUTTON_NO_CALLBACK, <a class="code" href="LoadScreen_8cpp.html#4f5c38bdf483e6953e81a15d172aa213">FDlgNamesCallback</a>);     
<a name="l00459"></a>00459       <span class="comment">//Title button</span>
<a name="l00460"></a>00460       <a class="code" href="LoadScreen_8cpp.html#4913515e1b230a105860c7c319fd3a69">iFileDlgButtons</a>[5] = <a class="code" href="Button_01System_8cpp.html#16393e47d05ca56c74fc5c61f889e3e5">CreateTextButton</a>(zTitle, HUGEFONT, FONT_LTKHAKI, FONT_DKKHAKI,
<a name="l00461"></a>00461             BUTTON_USE_DEFAULT,179,39,281,30,BUTTON_NO_TOGGLE,
<a name="l00462"></a>00462             MSYS_PRIORITY_HIGH-2,BUTTON_NO_CALLBACK,BUTTON_NO_CALLBACK);
<a name="l00463"></a>00463       <a class="code" href="Button_01System_8cpp.html#f47071abdc2fdbae8fae4688cedaddfc">DisableButton</a>(<a class="code" href="LoadScreen_8cpp.html#4913515e1b230a105860c7c319fd3a69">iFileDlgButtons</a>[5]);
<a name="l00464"></a>00464       <a class="code" href="Button_01System_8cpp.html#f1899e657d89d03df63c66e6f6e5be1c">SpecifyDisabledButtonStyle</a>( <a class="code" href="LoadScreen_8cpp.html#4913515e1b230a105860c7c319fd3a69">iFileDlgButtons</a>[5], <a class="code" href="Button_01System_8h.html#8420dba71b9cc240cf981b0bef8920040ad52c8d1b5449350d6e9b6ae93d8b12">DISABLED_STYLE_NONE</a> );
<a name="l00465"></a>00465 
<a name="l00466"></a>00466       <a class="code" href="LoadScreen_8cpp.html#4913515e1b230a105860c7c319fd3a69">iFileDlgButtons</a>[6] = -1;
<a name="l00467"></a>00467       <span class="keywordflow">if</span>( <a class="code" href="EditorDefines_8h.html#ea401eeecb648bbbe96d6caf33fa7aac">iCurrentAction</a> == <a class="code" href="EditorDefines_8h.html#b04a0655cd1e3bcac5e8f48c18df1a574eb3737a7354a8763f5b2a2ced0166f0">ACTION_SAVE_MAP</a> )
<a name="l00468"></a>00468       {     <span class="comment">//checkboxes</span>
<a name="l00469"></a>00469             <span class="comment">//The update world info checkbox</span>
<a name="l00470"></a>00470             <a class="code" href="LoadScreen_8cpp.html#4913515e1b230a105860c7c319fd3a69">iFileDlgButtons</a>[6] = <a class="code" href="Button_01System_8cpp.html#c3a718bcaa4462199883f68bcf73cb53">CreateCheckBoxButton</a>( 183, 229, <span class="stringliteral">"EDITOR//smcheckbox.sti"</span>, MSYS_PRIORITY_HIGH, <a class="code" href="LoadScreen_8cpp.html#4a24bd2a603492746c0d06a548ecdbeb">UpdateWorldInfoCallback</a> );
<a name="l00471"></a>00471             <span class="keywordflow">if</span>( <a class="code" href="Sector_01Summary_8cpp.html#a8db70ba693fe3891c7525a350d912ea">gfUpdateSummaryInfo</a> )
<a name="l00472"></a>00472                   <a class="code" href="Button_01System_8cpp.html#99f9e9d9b2c22bc0d2d8166c4bb2f353">ButtonList</a>[ <a class="code" href="LoadScreen_8cpp.html#4913515e1b230a105860c7c319fd3a69">iFileDlgButtons</a>[6] ]-&gt;<a class="code" href="struct__GUI__BUTTON.html#1ad6f5c9eb46ea98b25449008c9563d0">uiFlags</a> |= BUTTON_CLICKED_ON;
<a name="l00473"></a>00473       }
<a name="l00474"></a>00474 
<a name="l00475"></a>00475       <span class="comment">//Add the text input fields</span>
<a name="l00476"></a>00476       <a class="code" href="Text_01Input_8cpp.html#39e67eb1ac199063d64ffe2d7a6e5d01">InitTextInputModeWithScheme</a>( <a class="code" href="Text_01Input_8h.html#e19c22873075001400e66566d60b3d189162bce5f8a748e2d7cb1eddf453bbfd">DEFAULT_SCHEME</a> );
<a name="l00477"></a>00477       <span class="comment">//field 1 (filename) </span>
<a name="l00478"></a>00478       <a class="code" href="Text_01Input_8cpp.html#cf7fe686ea0fdf92aa466738d4066332">AddTextInputField</a>( <span class="comment">/*233*/</span>183, 195, 190, 20, MSYS_PRIORITY_HIGH, <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a>, 30, <a class="code" href="Text_01Input_8h.html#a684652a3ad226861d3cd9c8bee090eb027100766d0873a25fd25f7842843ffe">INPUTTYPE_EXCLUSIVE_DOSFILENAME</a> );
<a name="l00479"></a>00479       <span class="comment">//field 2 -- user field that allows mouse/key interaction with the filename list</span>
<a name="l00480"></a>00480       <a class="code" href="Text_01Input_8cpp.html#a9d62cf5d43d926b04384016a240c617">AddUserInputField</a>( <a class="code" href="LoadScreen_8cpp.html#074e102c76d3995943f14362c08f493d">FileDialogModeCallback</a> );
<a name="l00481"></a>00481 
<a name="l00482"></a>00482 }
<a name="l00483"></a>00483 
<a name="l00484"></a><a class="code" href="LoadScreen_8cpp.html#4a24bd2a603492746c0d06a548ecdbeb">00484</a> <span class="keywordtype">void</span> <a class="code" href="LoadScreen_8cpp.html#4a24bd2a603492746c0d06a548ecdbeb">UpdateWorldInfoCallback</a>( <a class="code" href="struct__GUI__BUTTON.html">GUI_BUTTON</a> *b, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> reason )
<a name="l00485"></a>00485 {
<a name="l00486"></a>00486       <span class="keywordflow">if</span>( reason &amp; MSYS_CALLBACK_REASON_LBUTTON_UP )
<a name="l00487"></a>00487             <a class="code" href="Sector_01Summary_8cpp.html#a8db70ba693fe3891c7525a350d912ea">gfUpdateSummaryInfo</a> = b-&gt;<a class="code" href="struct__GUI__BUTTON.html#1ad6f5c9eb46ea98b25449008c9563d0">uiFlags</a> &amp; BUTTON_CLICKED_ON ? TRUE : FALSE;
<a name="l00488"></a>00488 }
<a name="l00489"></a>00489 
<a name="l00490"></a>00490 <span class="comment">//This is a hook into the text input code.  This callback is called whenever the user is currently</span>
<a name="l00491"></a>00491 <span class="comment">//editing text, and presses Tab to transfer to the file dialog mode.  When this happens, we set the text</span>
<a name="l00492"></a>00492 <span class="comment">//field to the currently selected file in the list which is already know.</span>
<a name="l00493"></a><a class="code" href="LoadScreen_8cpp.html#074e102c76d3995943f14362c08f493d">00493</a> <span class="keywordtype">void</span> <a class="code" href="LoadScreen_8cpp.html#074e102c76d3995943f14362c08f493d">FileDialogModeCallback</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubID, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fEntering )
<a name="l00494"></a>00494 {
<a name="l00495"></a>00495       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> <a class="code" href="Sound_01Control_8cpp.html#6150e0515f7202e2fb518f7206ed97dc">x</a>;
<a name="l00496"></a>00496       <a class="code" href="struct__FDLG__LIST__TAG.html">FDLG_LIST</a> *FListNode;
<a name="l00497"></a>00497       <span class="keywordflow">if</span>( fEntering )
<a name="l00498"></a>00498       {
<a name="l00499"></a>00499             <span class="comment">// Skip to first filename</span>
<a name="l00500"></a>00500             FListNode = <a class="code" href="LoadScreen_8cpp.html#29b63ea968cd6c6eed712af82bb78c6f">FileList</a>;
<a name="l00501"></a>00501             <span class="keywordflow">for</span>(x=0;x&lt;<a class="code" href="LoadScreen_8cpp.html#79220a8a0aa9753cc18ffd6b5fc41af8">iTopFileShown</a> &amp;&amp; x&lt;<a class="code" href="LoadScreen_8cpp.html#af40284bcf5db835ad81993f0f083b4f">iTotalFiles</a> &amp;&amp; FListNode != NULL;x++)
<a name="l00502"></a>00502             {
<a name="l00503"></a>00503                   FListNode = FListNode-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#b7de2d598cdc28e20a02aff085c02a98">pNext</a>;
<a name="l00504"></a>00504             }
<a name="l00505"></a>00505             <span class="comment">// Find the already selected filename</span>
<a name="l00506"></a>00506             <span class="keywordflow">for</span>(x = <a class="code" href="LoadScreen_8cpp.html#79220a8a0aa9753cc18ffd6b5fc41af8">iTopFileShown</a>; x &lt; <a class="code" href="LoadScreen_8cpp.html#79220a8a0aa9753cc18ffd6b5fc41af8">iTopFileShown</a> + 8 &amp;&amp; x &lt; <a class="code" href="LoadScreen_8cpp.html#af40284bcf5db835ad81993f0f083b4f">iTotalFiles</a> &amp;&amp; FListNode != NULL; x++ )
<a name="l00507"></a>00507             {
<a name="l00508"></a>00508                   <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#8a920e48f1c1b7160ad1ad85725ac98a">iCurrFileShown</a> == (x-<a class="code" href="LoadScreen_8cpp.html#79220a8a0aa9753cc18ffd6b5fc41af8">iTopFileShown</a>) )
<a name="l00509"></a>00509                   {
<a name="l00510"></a>00510                         FListNode-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#7de5ba8db78346865d64b61974a001a5">FileInfo</a>.<a class="code" href="struct__GETFILESTRUCT__TAG.html#1b5e35ca9109baa1edcecfcf46a54ef5">zFileName</a>[30] = 0;
<a name="l00511"></a>00511                         <a class="code" href="Text_01Input_8cpp.html#a76c38a5799b50166d17ac0607f1e8ad">SetInputFieldStringWith8BitString</a>( 0, (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)FListNode-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#7de5ba8db78346865d64b61974a001a5">FileInfo</a>.<a class="code" href="struct__GETFILESTRUCT__TAG.html#1b5e35ca9109baa1edcecfcf46a54ef5">zFileName</a> );
<a name="l00512"></a>00512                         <span class="keywordflow">return</span>;
<a name="l00513"></a>00513                   }
<a name="l00514"></a>00514                   FListNode = FListNode-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#b7de2d598cdc28e20a02aff085c02a98">pNext</a>;
<a name="l00515"></a>00515             }
<a name="l00516"></a>00516       }
<a name="l00517"></a>00517 }
<a name="l00518"></a>00518 
<a name="l00519"></a><a class="code" href="LoadScreen_8h.html#24cfd80fa1e9d886174d56d2bb21ea93">00519</a> <span class="keywordtype">void</span> <a class="code" href="LoadScreen_8cpp.html#24cfd80fa1e9d886174d56d2bb21ea93">RemoveFileDialog</a>(<span class="keywordtype">void</span>)
<a name="l00520"></a>00520 {
<a name="l00521"></a>00521       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> <a class="code" href="Sound_01Control_8cpp.html#6150e0515f7202e2fb518f7206ed97dc">x</a>;
<a name="l00522"></a>00522 
<a name="l00523"></a>00523       <a class="code" href="mousesystem_8cpp.html#f2581a6cadb531c87ebd6b3f5b70f258">MSYS_RemoveRegion</a>( &amp;<a class="code" href="LoadScreen_8cpp.html#e3ef96201acb4cc43c0b3ea6b3ae26fb">BlanketRegion</a> );
<a name="l00524"></a>00524 
<a name="l00525"></a>00525       <span class="keywordflow">for</span>(x=0; x&lt;6; x++)
<a name="l00526"></a>00526       {
<a name="l00527"></a>00527             <a class="code" href="Button_01System_8cpp.html#daa181fdf3d05f2242b5d9cbeb91e9bf">RemoveButton</a>(<a class="code" href="LoadScreen_8cpp.html#4913515e1b230a105860c7c319fd3a69">iFileDlgButtons</a>[x]);
<a name="l00528"></a>00528       }
<a name="l00529"></a>00529 
<a name="l00530"></a>00530       <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#4913515e1b230a105860c7c319fd3a69">iFileDlgButtons</a>[6] != -1 )
<a name="l00531"></a>00531       {
<a name="l00532"></a>00532             <a class="code" href="Button_01System_8cpp.html#daa181fdf3d05f2242b5d9cbeb91e9bf">RemoveButton</a>( <a class="code" href="LoadScreen_8cpp.html#4913515e1b230a105860c7c319fd3a69">iFileDlgButtons</a>[6] );
<a name="l00533"></a>00533       }
<a name="l00534"></a>00534 
<a name="l00535"></a>00535       <a class="code" href="LoadScreen_8cpp.html#f660863d8c04aa3ff731cb1672d14b58">TrashFDlgList</a>( <a class="code" href="LoadScreen_8cpp.html#29b63ea968cd6c6eed712af82bb78c6f">FileList</a> );
<a name="l00536"></a>00536       FileList = NULL;
<a name="l00537"></a>00537 
<a name="l00538"></a>00538       <a class="code" href="video_8cpp.html#02ed05b095e30f580eeba68eff78327c">InvalidateScreen</a>( );
<a name="l00539"></a>00539 
<a name="l00540"></a>00540       <a class="code" href="Editor_01Taskbar_01Utils_8cpp.html#e4686c5023e4bf16c4ab9d802aeaa64e">EnableEditorTaskbar</a>();
<a name="l00541"></a>00541       <a class="code" href="Text_01Input_8cpp.html#6d18fece3d742aca76d344f0ba9247ef">KillTextInputMode</a>();
<a name="l00542"></a>00542       <a class="code" href="Simple_01Render_01Utils_8cpp.html#31324950ad85a80baf8ca1187ecde54c">MarkWorldDirty</a>();
<a name="l00543"></a>00543       <a class="code" href="renderworld_8cpp.html#07e1fbf450cc1f0c2abad57af4384ea7">RenderWorld</a>();
<a name="l00544"></a>00544       <a class="code" href="video_8cpp.html#cb214b937b77ff6e2f5f80a7fe45ea5a">EndFrameBufferRender</a>();
<a name="l00545"></a>00545 }
<a name="l00546"></a>00546 
<a name="l00547"></a><a class="code" href="LoadScreen_8cpp.html#a0f4f2b198dc9379a57f4eb047617e33">00547</a> <span class="keywordtype">void</span> <a class="code" href="LoadScreen_8cpp.html#a0f4f2b198dc9379a57f4eb047617e33">DrawFileDialog</a>(<span class="keywordtype">void</span>)
<a name="l00548"></a>00548 {
<a name="l00549"></a>00549       <a class="code" href="vsurface_8cpp.html#10d0257b54c4d27b2d82ead2a46cd581">ColorFillVideoSurfaceArea</a>(FRAME_BUFFER,   179, 69, (179+281), 261, <a class="code" href="himage_8cpp.html#d29939ffcd39c7d1cc0a91222702d361">Get16BPPColor</a>(FROMRGB(136, 138, 135)) );
<a name="l00550"></a>00550       <a class="code" href="vsurface_8cpp.html#10d0257b54c4d27b2d82ead2a46cd581">ColorFillVideoSurfaceArea</a>(FRAME_BUFFER,   180, 70, (179+281), 261, <a class="code" href="himage_8cpp.html#d29939ffcd39c7d1cc0a91222702d361">Get16BPPColor</a>(FROMRGB(24, 61, 81)) );
<a name="l00551"></a>00551       <a class="code" href="vsurface_8cpp.html#10d0257b54c4d27b2d82ead2a46cd581">ColorFillVideoSurfaceArea</a>(FRAME_BUFFER,   180, 70, (179+280), 260, <a class="code" href="himage_8cpp.html#d29939ffcd39c7d1cc0a91222702d361">Get16BPPColor</a>(FROMRGB(65, 79, 94)) );
<a name="l00552"></a>00552 
<a name="l00553"></a>00553       <a class="code" href="vsurface_8cpp.html#10d0257b54c4d27b2d82ead2a46cd581">ColorFillVideoSurfaceArea</a>(FRAME_BUFFER, (179+4), (69+3), (179+4+240), (69+123), <a class="code" href="himage_8cpp.html#d29939ffcd39c7d1cc0a91222702d361">Get16BPPColor</a>(FROMRGB(24, 61, 81)) );
<a name="l00554"></a>00554       <a class="code" href="vsurface_8cpp.html#10d0257b54c4d27b2d82ead2a46cd581">ColorFillVideoSurfaceArea</a>(FRAME_BUFFER, (179+5), (69+4), (179+4+240), (69+123), <a class="code" href="himage_8cpp.html#d29939ffcd39c7d1cc0a91222702d361">Get16BPPColor</a>(FROMRGB(136, 138, 135)) );
<a name="l00555"></a>00555       <a class="code" href="vsurface_8cpp.html#10d0257b54c4d27b2d82ead2a46cd581">ColorFillVideoSurfaceArea</a>(FRAME_BUFFER, (179+5), (69+4), (179+3+240), (69+122), <a class="code" href="himage_8cpp.html#d29939ffcd39c7d1cc0a91222702d361">Get16BPPColor</a>(FROMRGB(250, 240, 188)) );
<a name="l00556"></a>00556 
<a name="l00557"></a>00557       <a class="code" href="Button_01System_8cpp.html#dd66106191abe97a8b80611179ff8996">MarkButtonsDirty</a>();
<a name="l00558"></a>00558       <a class="code" href="Button_01System_8cpp.html#d82e5028df813b9f64bea43abe59ea79">RenderButtons</a>();
<a name="l00559"></a>00559       <a class="code" href="Button_01System_8h.html#066d848d552923e144a162cf3e93a580">RenderButtonsFastHelp</a>();
<a name="l00560"></a>00560 
<a name="l00561"></a>00561       <a class="code" href="Font_8cpp.html#fa4871009f0473cca0380217753947dc">SetFont</a>( FONT10ARIAL );
<a name="l00562"></a>00562       <a class="code" href="Font_8cpp.html#388be5810478c3f3bdb861f144085d70">SetFontForeground</a>( FONT_LTKHAKI );
<a name="l00563"></a>00563       <a class="code" href="Font_8cpp.html#1513b9080348f45e52cc45e68cbeddee">SetFontShadow</a>( FONT_DKKHAKI );
<a name="l00564"></a>00564       <a class="code" href="Font_8cpp.html#a1fe8cc526be9e2c96b5dd66e348506f">SetFontBackground</a>( FONT_BLACK );
<a name="l00565"></a>00565       <a class="code" href="Font_8cpp.html#b3e12cf19a0ca58abf6689cc8eca3ead">mprintf</a>( 183, 217, L<span class="stringliteral">"Filename"</span> );
<a name="l00566"></a>00566       
<a name="l00567"></a>00567       <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#4913515e1b230a105860c7c319fd3a69">iFileDlgButtons</a>[6] != -1 ) 
<a name="l00568"></a>00568       {
<a name="l00569"></a>00569             <a class="code" href="Font_8cpp.html#b3e12cf19a0ca58abf6689cc8eca3ead">mprintf</a>( 200, 231, L<span class="stringliteral">"Update world info"</span> );
<a name="l00570"></a>00570       }
<a name="l00571"></a>00571 }
<a name="l00572"></a>00572 
<a name="l00573"></a>00573 <span class="comment">//The callback calls this function passing the relative y position of where</span>
<a name="l00574"></a>00574 <span class="comment">//the user clicked on the hot spot.</span>
<a name="l00575"></a><a class="code" href="LoadScreen_8h.html#692d63c1122ca9fe8d4d288e46a789ff">00575</a> <span class="keywordtype">void</span> <a class="code" href="LoadScreen_8cpp.html#692d63c1122ca9fe8d4d288e46a789ff">SelectFileDialogYPos</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usRelativeYPos )
<a name="l00576"></a>00576 {
<a name="l00577"></a>00577       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSelName;
<a name="l00578"></a>00578       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> <a class="code" href="Sound_01Control_8cpp.html#6150e0515f7202e2fb518f7206ed97dc">x</a>;
<a name="l00579"></a>00579       <a class="code" href="struct__FDLG__LIST__TAG.html">FDLG_LIST</a> *FListNode;
<a name="l00580"></a>00580 
<a name="l00581"></a>00581       sSelName = usRelativeYPos / 15;
<a name="l00582"></a>00582       
<a name="l00583"></a>00583       <span class="comment">//This is a field in the text editmode, but clicked via mouse.</span>
<a name="l00584"></a>00584       <a class="code" href="Text_01Input_8cpp.html#25a0544d008a0b0168be721750f9422b">SetActiveField</a>( 1 );
<a name="l00585"></a>00585 
<a name="l00586"></a>00586       <span class="comment">// Skip to first filename</span>
<a name="l00587"></a>00587       FListNode = <a class="code" href="LoadScreen_8cpp.html#29b63ea968cd6c6eed712af82bb78c6f">FileList</a>;
<a name="l00588"></a>00588       <span class="keywordflow">for</span>(x=0;x&lt;<a class="code" href="LoadScreen_8cpp.html#79220a8a0aa9753cc18ffd6b5fc41af8">iTopFileShown</a> &amp;&amp; x&lt;<a class="code" href="LoadScreen_8cpp.html#af40284bcf5db835ad81993f0f083b4f">iTotalFiles</a> &amp;&amp; FListNode != NULL;x++)
<a name="l00589"></a>00589       {
<a name="l00590"></a>00590             FListNode = FListNode-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#b7de2d598cdc28e20a02aff085c02a98">pNext</a>;
<a name="l00591"></a>00591       }
<a name="l00592"></a>00592       
<a name="l00593"></a>00593       <span class="keywordflow">for</span>(x=<a class="code" href="LoadScreen_8cpp.html#79220a8a0aa9753cc18ffd6b5fc41af8">iTopFileShown</a>;x&lt;(<a class="code" href="LoadScreen_8cpp.html#79220a8a0aa9753cc18ffd6b5fc41af8">iTopFileShown</a>+8) &amp;&amp; x&lt;<a class="code" href="LoadScreen_8cpp.html#af40284bcf5db835ad81993f0f083b4f">iTotalFiles</a> &amp;&amp; FListNode != NULL; x++)
<a name="l00594"></a>00594       {
<a name="l00595"></a>00595             <span class="keywordflow">if</span>( (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)sSelName == (x-<a class="code" href="LoadScreen_8cpp.html#79220a8a0aa9753cc18ffd6b5fc41af8">iTopFileShown</a>) )
<a name="l00596"></a>00596             {
<a name="l00597"></a>00597                   INT32 iCurrClickTime;
<a name="l00598"></a>00598                   <a class="code" href="LoadScreen_8cpp.html#8a920e48f1c1b7160ad1ad85725ac98a">iCurrFileShown</a> = x;
<a name="l00599"></a>00599                   FListNode-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#7de5ba8db78346865d64b61974a001a5">FileInfo</a>.<a class="code" href="struct__GETFILESTRUCT__TAG.html#1b5e35ca9109baa1edcecfcf46a54ef5">zFileName</a>[30] = 0;
<a name="l00600"></a>00600                   swprintf( <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a>, L<span class="stringliteral">"%S"</span>, FListNode-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#7de5ba8db78346865d64b61974a001a5">FileInfo</a>.<a class="code" href="struct__GETFILESTRUCT__TAG.html#1b5e35ca9109baa1edcecfcf46a54ef5">zFileName</a> );
<a name="l00601"></a>00601                   <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#959a90f653b5c2aca8adca4af875cf3d">ValidFilename</a>() )
<a name="l00602"></a>00602                   {
<a name="l00603"></a>00603                         <a class="code" href="Text_01Input_8cpp.html#885260f81e60cfffe73a8a6147c716f4">SetInputFieldStringWith16BitString</a>( 0, <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a> );
<a name="l00604"></a>00604                   }
<a name="l00605"></a>00605                   <span class="keywordflow">else</span>
<a name="l00606"></a>00606                   {
<a name="l00607"></a>00607                         <a class="code" href="Text_01Input_8cpp.html#885260f81e60cfffe73a8a6147c716f4">SetInputFieldStringWith16BitString</a>( 0, L<span class="stringliteral">""</span> );
<a name="l00608"></a>00608                         <a class="code" href="Sys_01Globals_8h.html#3d1e5716a3d04a53b8846319dd57da83">wcscpy</a>( <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a>, L<span class="stringliteral">""</span> );
<a name="l00609"></a>00609                   }
<a name="l00610"></a>00610 
<a name="l00611"></a>00611                   <a class="code" href="Text_01Input_8cpp.html#f4bcc0809bbb276a94f0a1bb64ac3276">RenderInactiveTextField</a>( 0 );
<a name="l00612"></a>00612 
<a name="l00613"></a>00613                   <span class="comment">//Calculate and process any double clicking...</span>
<a name="l00614"></a>00614                   iCurrClickTime = GetJA2Clock();
<a name="l00615"></a>00615                   <span class="keywordflow">if</span>( iCurrClickTime - <a class="code" href="LoadScreen_8cpp.html#5b44b96529e4b2986672c752f4339312">iLastClickTime</a> &lt; 400 &amp;&amp; x == <a class="code" href="LoadScreen_8cpp.html#6c2d4b83e871f3075db623297046cabf">iLastFileClicked</a> )
<a name="l00616"></a>00616                   { <span class="comment">//Considered a double click, so activate load/save this filename.</span>
<a name="l00617"></a>00617                         <a class="code" href="LoadScreen_8cpp.html#ea89943feac0e7c4b9061b57b1dca606">gfDestroyFDlg</a> = TRUE;
<a name="l00618"></a>00618                         <a class="code" href="LoadScreen_8cpp.html#a4f68159b63f4db51c1e9aa217085555">iFDlgState</a> = <a class="code" href="EditorDefines_8h.html#ea401eeecb648bbbe96d6caf33fa7aac">iCurrentAction</a> == <a class="code" href="EditorDefines_8h.html#b04a0655cd1e3bcac5e8f48c18df1a574eb3737a7354a8763f5b2a2ced0166f0">ACTION_SAVE_MAP</a> ? <a class="code" href="LoadScreen_8cpp.html#f9bdc3014f3d54c426b6d2df10de49601b312278c9afeabd86b3bb4ab178ecf8">DIALOG_SAVE</a> : <a class="code" href="LoadScreen_8cpp.html#f9bdc3014f3d54c426b6d2df10de496088a277ead75be15a416e01e349f3d2bd">DIALOG_LOAD</a>;
<a name="l00619"></a>00619                   }
<a name="l00620"></a>00620                   <a class="code" href="LoadScreen_8cpp.html#5b44b96529e4b2986672c752f4339312">iLastClickTime</a> = iCurrClickTime;
<a name="l00621"></a>00621                   <a class="code" href="LoadScreen_8cpp.html#6c2d4b83e871f3075db623297046cabf">iLastFileClicked</a> = x;
<a name="l00622"></a>00622             }
<a name="l00623"></a>00623             FListNode = FListNode-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#b7de2d598cdc28e20a02aff085c02a98">pNext</a>;
<a name="l00624"></a>00624       }
<a name="l00625"></a>00625 }
<a name="l00626"></a>00626 
<a name="l00627"></a><a class="code" href="LoadScreen_8h.html#f33ad971c655faf8b21b2150e9b58d91">00627</a> <a class="code" href="struct__FDLG__LIST__TAG.html">FDLG_LIST</a> *<a class="code" href="LoadScreen_8cpp.html#f33ad971c655faf8b21b2150e9b58d91">AddToFDlgList</a>(<a class="code" href="struct__FDLG__LIST__TAG.html">FDLG_LIST</a> *pList, <a class="code" href="struct__GETFILESTRUCT__TAG.html">GETFILESTRUCT</a> *pInfo)
<a name="l00628"></a>00628 {
<a name="l00629"></a>00629       <a class="code" href="struct__FDLG__LIST__TAG.html">FDLG_LIST</a> *pNode;
<a name="l00630"></a>00630 
<a name="l00631"></a>00631       <span class="comment">// Add to start of list</span>
<a name="l00632"></a>00632       <span class="keywordflow">if</span> ( pList == NULL )
<a name="l00633"></a>00633       {
<a name="l00634"></a>00634             pNode = (<a class="code" href="struct__FDLG__LIST__TAG.html">FDLG_LIST</a> *)MemAlloc( <span class="keyword">sizeof</span>(<a class="code" href="struct__FDLG__LIST__TAG.html">FDLG_LIST</a>) );
<a name="l00635"></a>00635             pNode-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#7de5ba8db78346865d64b61974a001a5">FileInfo</a> = *pInfo;
<a name="l00636"></a>00636             pNode-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#e33a2c2e790ffd701f2145fa87ec3889">pPrev</a> = pNode-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#b7de2d598cdc28e20a02aff085c02a98">pNext</a> = NULL;
<a name="l00637"></a>00637             <span class="keywordflow">return</span>(pNode);
<a name="l00638"></a>00638       }
<a name="l00639"></a>00639 
<a name="l00640"></a>00640       <span class="comment">// Add and sort alphabetically without regard to case -- function limited to 10 chars comparison</span>
<a name="l00641"></a>00641       <span class="keywordflow">if</span> ( <a class="code" href="Sys_01Globals_8h.html#85afc6a38783d0199967e919a072b97d">_stricmp</a>(pList-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#7de5ba8db78346865d64b61974a001a5">FileInfo</a>.<a class="code" href="struct__GETFILESTRUCT__TAG.html#1b5e35ca9109baa1edcecfcf46a54ef5">zFileName</a>, pInfo-&gt;<a class="code" href="struct__GETFILESTRUCT__TAG.html#1b5e35ca9109baa1edcecfcf46a54ef5">zFileName</a> ) &gt; 0 )
<a name="l00642"></a>00642       {
<a name="l00643"></a>00643             <span class="comment">// pInfo is smaller than pList (i.e. Insert before)</span>
<a name="l00644"></a>00644             pNode = (<a class="code" href="struct__FDLG__LIST__TAG.html">FDLG_LIST</a> *)MemAlloc( <span class="keyword">sizeof</span>(<a class="code" href="struct__FDLG__LIST__TAG.html">FDLG_LIST</a>) );
<a name="l00645"></a>00645             pNode-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#7de5ba8db78346865d64b61974a001a5">FileInfo</a> = *pInfo;
<a name="l00646"></a>00646             pNode-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#b7de2d598cdc28e20a02aff085c02a98">pNext</a> = pList;
<a name="l00647"></a>00647             pNode-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#e33a2c2e790ffd701f2145fa87ec3889">pPrev</a> = pList-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#e33a2c2e790ffd701f2145fa87ec3889">pPrev</a>;
<a name="l00648"></a>00648             pList-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#e33a2c2e790ffd701f2145fa87ec3889">pPrev</a> = pNode;
<a name="l00649"></a>00649             <span class="keywordflow">return</span>(pNode);
<a name="l00650"></a>00650       }
<a name="l00651"></a>00651       <span class="keywordflow">else</span>
<a name="l00652"></a>00652       {
<a name="l00653"></a>00653             pList-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#b7de2d598cdc28e20a02aff085c02a98">pNext</a> = <a class="code" href="LoadScreen_8cpp.html#f33ad971c655faf8b21b2150e9b58d91">AddToFDlgList</a>( pList-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#b7de2d598cdc28e20a02aff085c02a98">pNext</a>, pInfo );
<a name="l00654"></a>00654             pList-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#b7de2d598cdc28e20a02aff085c02a98">pNext</a>-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#e33a2c2e790ffd701f2145fa87ec3889">pPrev</a> = pList;
<a name="l00655"></a>00655       }
<a name="l00656"></a>00656       <span class="keywordflow">return</span>(pList);
<a name="l00657"></a>00657 }
<a name="l00658"></a>00658 
<a name="l00659"></a><a class="code" href="LoadScreen_8cpp.html#68fbaa4dd1c6fecdaf051a6310c9ac81">00659</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="LoadScreen_8cpp.html#68fbaa4dd1c6fecdaf051a6310c9ac81">RemoveFromFDlgList</a>( <a class="code" href="struct__FDLG__LIST__TAG.html">FDLG_LIST</a> **head, <a class="code" href="struct__FDLG__LIST__TAG.html">FDLG_LIST</a> *node )
<a name="l00660"></a>00660 {
<a name="l00661"></a>00661       <a class="code" href="struct__FDLG__LIST__TAG.html">FDLG_LIST</a> *curr;
<a name="l00662"></a>00662       curr = *head;
<a name="l00663"></a>00663       <span class="keywordflow">while</span>( curr )
<a name="l00664"></a>00664       {
<a name="l00665"></a>00665             <span class="keywordflow">if</span>( curr == node )
<a name="l00666"></a>00666             {
<a name="l00667"></a>00667                   <span class="keywordflow">if</span>( *head == node )
<a name="l00668"></a>00668                         *head = (*head)-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#b7de2d598cdc28e20a02aff085c02a98">pNext</a>;
<a name="l00669"></a>00669                   <span class="keywordflow">if</span>( curr-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#e33a2c2e790ffd701f2145fa87ec3889">pPrev</a> )
<a name="l00670"></a>00670                         curr-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#e33a2c2e790ffd701f2145fa87ec3889">pPrev</a>-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#b7de2d598cdc28e20a02aff085c02a98">pNext</a> = curr-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#b7de2d598cdc28e20a02aff085c02a98">pNext</a>;
<a name="l00671"></a>00671                   <span class="keywordflow">if</span>( curr-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#b7de2d598cdc28e20a02aff085c02a98">pNext</a> )
<a name="l00672"></a>00672                         curr-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#b7de2d598cdc28e20a02aff085c02a98">pNext</a>-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#e33a2c2e790ffd701f2145fa87ec3889">pPrev</a> = curr-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#e33a2c2e790ffd701f2145fa87ec3889">pPrev</a>;
<a name="l00673"></a>00673                   MemFree( node );
<a name="l00674"></a>00674                   node = NULL;
<a name="l00675"></a>00675                   <span class="keywordflow">return</span> TRUE;
<a name="l00676"></a>00676             }
<a name="l00677"></a>00677             curr = curr-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#b7de2d598cdc28e20a02aff085c02a98">pNext</a>;
<a name="l00678"></a>00678       }
<a name="l00679"></a>00679       <span class="keywordflow">return</span> FALSE; <span class="comment">//wasn't deleted </span>
<a name="l00680"></a>00680 }
<a name="l00681"></a>00681 
<a name="l00682"></a><a class="code" href="LoadScreen_8h.html#f660863d8c04aa3ff731cb1672d14b58">00682</a> <span class="keywordtype">void</span> <a class="code" href="LoadScreen_8cpp.html#f660863d8c04aa3ff731cb1672d14b58">TrashFDlgList</a>(<a class="code" href="struct__FDLG__LIST__TAG.html">FDLG_LIST</a> *pList)
<a name="l00683"></a>00683 {
<a name="l00684"></a>00684       <a class="code" href="struct__FDLG__LIST__TAG.html">FDLG_LIST</a> *pNode;
<a name="l00685"></a>00685 
<a name="l00686"></a>00686       <span class="keywordflow">while</span>(pList != NULL)
<a name="l00687"></a>00687       {
<a name="l00688"></a>00688             pNode = pList;
<a name="l00689"></a>00689             pList = pList-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#b7de2d598cdc28e20a02aff085c02a98">pNext</a>;
<a name="l00690"></a>00690             MemFree(pNode);
<a name="l00691"></a>00691       }
<a name="l00692"></a>00692 }
<a name="l00693"></a>00693 
<a name="l00694"></a><a class="code" href="LoadScreen_8cpp.html#41a70de77129cc4ec6f10533cb9bb753">00694</a> <span class="keywordtype">void</span> <a class="code" href="LoadScreen_8cpp.html#41a70de77129cc4ec6f10533cb9bb753">SetTopFileToLetter</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usLetter )
<a name="l00695"></a>00695 {
<a name="l00696"></a>00696       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="Sound_01Control_8cpp.html#6150e0515f7202e2fb518f7206ed97dc">x</a>;
<a name="l00697"></a>00697       <a class="code" href="struct__FDLG__LIST__TAG.html">FDLG_LIST</a> *curr;
<a name="l00698"></a>00698       <a class="code" href="struct__FDLG__LIST__TAG.html">FDLG_LIST</a> *prev;
<a name="l00699"></a>00699       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usNodeLetter;
<a name="l00700"></a>00700 
<a name="l00701"></a>00701       <span class="comment">// Skip to first filename</span>
<a name="l00702"></a>00702       x = 0;
<a name="l00703"></a>00703       curr = prev = <a class="code" href="LoadScreen_8cpp.html#29b63ea968cd6c6eed712af82bb78c6f">FileList</a>;
<a name="l00704"></a>00704       <span class="keywordflow">while</span>( curr )
<a name="l00705"></a>00705       {
<a name="l00706"></a>00706             usNodeLetter = curr-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#7de5ba8db78346865d64b61974a001a5">FileInfo</a>.<a class="code" href="struct__GETFILESTRUCT__TAG.html#1b5e35ca9109baa1edcecfcf46a54ef5">zFileName</a>[0]; <span class="comment">//first letter of filename.</span>
<a name="l00707"></a>00707             <span class="keywordflow">if</span>( usNodeLetter &lt; <span class="charliteral">'a'</span> )
<a name="l00708"></a>00708                   usNodeLetter += 32; <span class="comment">//convert uppercase to lower case A=65, a=97</span>
<a name="l00709"></a>00709             <span class="keywordflow">if</span>( usLetter &lt;= usNodeLetter )
<a name="l00710"></a>00710                   <span class="keywordflow">break</span>;
<a name="l00711"></a>00711             prev = curr;
<a name="l00712"></a>00712             curr = curr-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#b7de2d598cdc28e20a02aff085c02a98">pNext</a>;
<a name="l00713"></a>00713             x++;
<a name="l00714"></a>00714       }
<a name="l00715"></a>00715       <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#29b63ea968cd6c6eed712af82bb78c6f">FileList</a> )    
<a name="l00716"></a>00716       {
<a name="l00717"></a>00717             <a class="code" href="LoadScreen_8cpp.html#8a920e48f1c1b7160ad1ad85725ac98a">iCurrFileShown</a> = x;
<a name="l00718"></a>00718             <a class="code" href="LoadScreen_8cpp.html#79220a8a0aa9753cc18ffd6b5fc41af8">iTopFileShown</a> = x;
<a name="l00719"></a>00719             <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#79220a8a0aa9753cc18ffd6b5fc41af8">iTopFileShown</a> &gt; <a class="code" href="LoadScreen_8cpp.html#af40284bcf5db835ad81993f0f083b4f">iTotalFiles</a> - 7 )
<a name="l00720"></a>00720                   <a class="code" href="LoadScreen_8cpp.html#79220a8a0aa9753cc18ffd6b5fc41af8">iTopFileShown</a> = <a class="code" href="LoadScreen_8cpp.html#af40284bcf5db835ad81993f0f083b4f">iTotalFiles</a> - 7;
<a name="l00721"></a>00721             <a class="code" href="Text_01Input_8cpp.html#a76c38a5799b50166d17ac0607f1e8ad">SetInputFieldStringWith8BitString</a>( 0, (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)prev-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#7de5ba8db78346865d64b61974a001a5">FileInfo</a>.<a class="code" href="struct__GETFILESTRUCT__TAG.html#1b5e35ca9109baa1edcecfcf46a54ef5">zFileName</a> );
<a name="l00722"></a>00722       }
<a name="l00723"></a>00723 }
<a name="l00724"></a>00724 
<a name="l00725"></a><a class="code" href="LoadScreen_8cpp.html#2d60bde417f5c4932c03e3c697dc7761">00725</a> <span class="keywordtype">void</span> <a class="code" href="LoadScreen_8cpp.html#2d60bde417f5c4932c03e3c697dc7761">HandleMainKeyEvents</a>( <a class="code" href="structInputAtom.html">InputAtom</a> *pEvent )
<a name="l00726"></a>00726 {
<a name="l00727"></a>00727       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iPrevFileShown = <a class="code" href="LoadScreen_8cpp.html#8a920e48f1c1b7160ad1ad85725ac98a">iCurrFileShown</a>;
<a name="l00728"></a>00728       <span class="comment">//Replace Alt-x press with ESC.</span>
<a name="l00729"></a>00729       <span class="keywordflow">if</span>( pEvent-&gt;<a class="code" href="structInputAtom.html#4561a8befc251f5c2a03004f4378fdd0">usKeyState</a> &amp; ALT_DOWN &amp;&amp; pEvent-&gt;<a class="code" href="structInputAtom.html#c171abb99b6fe1f56f9bae755bdac911">usParam</a> == <span class="charliteral">'x'</span> )
<a name="l00730"></a>00730             pEvent-&gt;<a class="code" href="structInputAtom.html#c171abb99b6fe1f56f9bae755bdac911">usParam</a> = ESC;
<a name="l00731"></a>00731       <span class="keywordflow">switch</span>( pEvent-&gt;<a class="code" href="structInputAtom.html#c171abb99b6fe1f56f9bae755bdac911">usParam</a> )
<a name="l00732"></a>00732       {
<a name="l00733"></a>00733             <span class="keywordflow">case</span> ENTER:
<a name="l00734"></a>00734                   <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#5615f1416e14f1149b1c98cd2128c3dd">gfNoFiles</a> &amp;&amp; <a class="code" href="EditorDefines_8h.html#ea401eeecb648bbbe96d6caf33fa7aac">iCurrentAction</a> == <a class="code" href="EditorDefines_8h.html#b04a0655cd1e3bcac5e8f48c18df1a57760bd1a91db316cecf6d04b4ee45e0a9">ACTION_LOAD_MAP</a> )
<a name="l00735"></a>00735                         <span class="keywordflow">break</span>;
<a name="l00736"></a>00736                   <a class="code" href="LoadScreen_8cpp.html#ea89943feac0e7c4b9061b57b1dca606">gfDestroyFDlg</a> = TRUE;
<a name="l00737"></a>00737                   <a class="code" href="LoadScreen_8cpp.html#a4f68159b63f4db51c1e9aa217085555">iFDlgState</a> = <a class="code" href="EditorDefines_8h.html#ea401eeecb648bbbe96d6caf33fa7aac">iCurrentAction</a> == <a class="code" href="EditorDefines_8h.html#b04a0655cd1e3bcac5e8f48c18df1a574eb3737a7354a8763f5b2a2ced0166f0">ACTION_SAVE_MAP</a> ? <a class="code" href="LoadScreen_8cpp.html#f9bdc3014f3d54c426b6d2df10de49601b312278c9afeabd86b3bb4ab178ecf8">DIALOG_SAVE</a> : <a class="code" href="LoadScreen_8cpp.html#f9bdc3014f3d54c426b6d2df10de496088a277ead75be15a416e01e349f3d2bd">DIALOG_LOAD</a>;
<a name="l00738"></a>00738                   <span class="keywordflow">break</span>;
<a name="l00739"></a>00739             <span class="keywordflow">case</span> ESC:
<a name="l00740"></a>00740                   <a class="code" href="LoadScreen_8cpp.html#ea89943feac0e7c4b9061b57b1dca606">gfDestroyFDlg</a> = TRUE;
<a name="l00741"></a>00741                   <a class="code" href="LoadScreen_8cpp.html#a4f68159b63f4db51c1e9aa217085555">iFDlgState</a> = <a class="code" href="LoadScreen_8cpp.html#f9bdc3014f3d54c426b6d2df10de4960032ac5436ce32d651982f9a7a5809daf">DIALOG_CANCEL</a>;
<a name="l00742"></a>00742                   <span class="keywordflow">break</span>;
<a name="l00743"></a>00743             <span class="keywordflow">case</span> PGUP:
<a name="l00744"></a>00744                   <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#79220a8a0aa9753cc18ffd6b5fc41af8">iTopFileShown</a> &gt; 7 )
<a name="l00745"></a>00745                   {
<a name="l00746"></a>00746                         <a class="code" href="LoadScreen_8cpp.html#79220a8a0aa9753cc18ffd6b5fc41af8">iTopFileShown</a> -= 7;
<a name="l00747"></a>00747                         <a class="code" href="LoadScreen_8cpp.html#8a920e48f1c1b7160ad1ad85725ac98a">iCurrFileShown</a> -= 7;
<a name="l00748"></a>00748                   }
<a name="l00749"></a>00749                   <span class="keywordflow">else</span>
<a name="l00750"></a>00750                   {
<a name="l00751"></a>00751                         <a class="code" href="LoadScreen_8cpp.html#79220a8a0aa9753cc18ffd6b5fc41af8">iTopFileShown</a> = 0;
<a name="l00752"></a>00752                         <a class="code" href="LoadScreen_8cpp.html#8a920e48f1c1b7160ad1ad85725ac98a">iCurrFileShown</a> = 0;
<a name="l00753"></a>00753                   }
<a name="l00754"></a>00754                   <span class="keywordflow">break</span>;
<a name="l00755"></a>00755             <span class="keywordflow">case</span> PGDN:
<a name="l00756"></a>00756                   <a class="code" href="LoadScreen_8cpp.html#79220a8a0aa9753cc18ffd6b5fc41af8">iTopFileShown</a> += 7;
<a name="l00757"></a>00757                   <a class="code" href="LoadScreen_8cpp.html#8a920e48f1c1b7160ad1ad85725ac98a">iCurrFileShown</a> += 7;
<a name="l00758"></a>00758                   <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#79220a8a0aa9753cc18ffd6b5fc41af8">iTopFileShown</a> &gt; <a class="code" href="LoadScreen_8cpp.html#af40284bcf5db835ad81993f0f083b4f">iTotalFiles</a>-7 )
<a name="l00759"></a>00759                         <a class="code" href="LoadScreen_8cpp.html#79220a8a0aa9753cc18ffd6b5fc41af8">iTopFileShown</a> = <a class="code" href="LoadScreen_8cpp.html#af40284bcf5db835ad81993f0f083b4f">iTotalFiles</a> - 7;
<a name="l00760"></a>00760                   <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#8a920e48f1c1b7160ad1ad85725ac98a">iCurrFileShown</a> &gt;= <a class="code" href="LoadScreen_8cpp.html#af40284bcf5db835ad81993f0f083b4f">iTotalFiles</a> )
<a name="l00761"></a>00761                         <a class="code" href="LoadScreen_8cpp.html#8a920e48f1c1b7160ad1ad85725ac98a">iCurrFileShown</a> = <a class="code" href="LoadScreen_8cpp.html#af40284bcf5db835ad81993f0f083b4f">iTotalFiles</a> - 1;
<a name="l00762"></a>00762                   <span class="keywordflow">break</span>;
<a name="l00763"></a>00763             <span class="keywordflow">case</span> UPARROW:
<a name="l00764"></a>00764                   <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#8a920e48f1c1b7160ad1ad85725ac98a">iCurrFileShown</a> &gt; 0 )
<a name="l00765"></a>00765                         <a class="code" href="LoadScreen_8cpp.html#8a920e48f1c1b7160ad1ad85725ac98a">iCurrFileShown</a>--;
<a name="l00766"></a>00766                   <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#79220a8a0aa9753cc18ffd6b5fc41af8">iTopFileShown</a> &gt; <a class="code" href="LoadScreen_8cpp.html#8a920e48f1c1b7160ad1ad85725ac98a">iCurrFileShown</a> )
<a name="l00767"></a>00767                         <a class="code" href="LoadScreen_8cpp.html#79220a8a0aa9753cc18ffd6b5fc41af8">iTopFileShown</a> = <a class="code" href="LoadScreen_8cpp.html#8a920e48f1c1b7160ad1ad85725ac98a">iCurrFileShown</a>;
<a name="l00768"></a>00768                   <span class="keywordflow">break</span>;
<a name="l00769"></a>00769             <span class="keywordflow">case</span> DNARROW:
<a name="l00770"></a>00770                   <a class="code" href="LoadScreen_8cpp.html#8a920e48f1c1b7160ad1ad85725ac98a">iCurrFileShown</a>++;
<a name="l00771"></a>00771                   <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#8a920e48f1c1b7160ad1ad85725ac98a">iCurrFileShown</a> &gt;= <a class="code" href="LoadScreen_8cpp.html#af40284bcf5db835ad81993f0f083b4f">iTotalFiles</a> )
<a name="l00772"></a>00772                         <a class="code" href="LoadScreen_8cpp.html#8a920e48f1c1b7160ad1ad85725ac98a">iCurrFileShown</a> = <a class="code" href="LoadScreen_8cpp.html#af40284bcf5db835ad81993f0f083b4f">iTotalFiles</a> - 1;
<a name="l00773"></a>00773                   <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#79220a8a0aa9753cc18ffd6b5fc41af8">iTopFileShown</a> &lt; <a class="code" href="LoadScreen_8cpp.html#8a920e48f1c1b7160ad1ad85725ac98a">iCurrFileShown</a>-7 )
<a name="l00774"></a>00774                         <a class="code" href="LoadScreen_8cpp.html#79220a8a0aa9753cc18ffd6b5fc41af8">iTopFileShown</a>++;
<a name="l00775"></a>00775                   <span class="keywordflow">break</span>;
<a name="l00776"></a>00776             <span class="keywordflow">case</span> HOME:
<a name="l00777"></a>00777             <span class="keywordflow">case</span> CTRL_HOME:
<a name="l00778"></a>00778                   <a class="code" href="LoadScreen_8cpp.html#79220a8a0aa9753cc18ffd6b5fc41af8">iTopFileShown</a> = 0;
<a name="l00779"></a>00779                   <a class="code" href="LoadScreen_8cpp.html#8a920e48f1c1b7160ad1ad85725ac98a">iCurrFileShown</a> = 0;
<a name="l00780"></a>00780                   <span class="keywordflow">break</span>;
<a name="l00781"></a>00781             <span class="keywordflow">case</span> END:
<a name="l00782"></a>00782             <span class="keywordflow">case</span> CTRL_END:
<a name="l00783"></a>00783                   <a class="code" href="LoadScreen_8cpp.html#79220a8a0aa9753cc18ffd6b5fc41af8">iTopFileShown</a> = <a class="code" href="LoadScreen_8cpp.html#af40284bcf5db835ad81993f0f083b4f">iTotalFiles</a>-7;
<a name="l00784"></a>00784                   <a class="code" href="LoadScreen_8cpp.html#8a920e48f1c1b7160ad1ad85725ac98a">iCurrFileShown</a> = <a class="code" href="LoadScreen_8cpp.html#af40284bcf5db835ad81993f0f083b4f">iTotalFiles</a>-1;
<a name="l00785"></a>00785                   <span class="keywordflow">break</span>;
<a name="l00786"></a>00786             <span class="keywordflow">case</span> DEL:
<a name="l00787"></a>00787                   <a class="code" href="LoadScreen_8cpp.html#a4f68159b63f4db51c1e9aa217085555">iFDlgState</a> = <a class="code" href="LoadScreen_8cpp.html#f9bdc3014f3d54c426b6d2df10de496021427825a88c29315f0348666ddaaf97">DIALOG_DELETE</a>;
<a name="l00788"></a>00788                   <span class="keywordflow">break</span>;
<a name="l00789"></a>00789             <span class="keywordflow">default</span>:
<a name="l00790"></a>00790                   <span class="comment">//This case handles jumping the file list to display the file with the letter pressed.</span>
<a name="l00791"></a>00791                   <span class="keywordflow">if</span>( pEvent-&gt;<a class="code" href="structInputAtom.html#c171abb99b6fe1f56f9bae755bdac911">usParam</a> &gt;= <span class="charliteral">'a'</span> &amp;&amp; pEvent-&gt;<a class="code" href="structInputAtom.html#c171abb99b6fe1f56f9bae755bdac911">usParam</a> &lt;= <span class="charliteral">'z'</span> ||
<a name="l00792"></a>00792                               pEvent-&gt;<a class="code" href="structInputAtom.html#c171abb99b6fe1f56f9bae755bdac911">usParam</a> &gt;= <span class="charliteral">'A'</span> &amp;&amp; pEvent-&gt;<a class="code" href="structInputAtom.html#c171abb99b6fe1f56f9bae755bdac911">usParam</a> &lt;= <span class="charliteral">'Z'</span> )
<a name="l00793"></a>00793                   {
<a name="l00794"></a>00794                         <span class="keywordflow">if</span>( pEvent-&gt;<a class="code" href="structInputAtom.html#c171abb99b6fe1f56f9bae755bdac911">usParam</a> &gt;= <span class="charliteral">'A'</span> &amp;&amp; pEvent-&gt;<a class="code" href="structInputAtom.html#c171abb99b6fe1f56f9bae755bdac911">usParam</a> &lt;= <span class="charliteral">'Z'</span> ) <span class="comment">//convert upper case to lower case</span>
<a name="l00795"></a>00795                               pEvent-&gt;<a class="code" href="structInputAtom.html#c171abb99b6fe1f56f9bae755bdac911">usParam</a> += 32;  <span class="comment">// A = 65, a = 97 (difference of 32)</span>
<a name="l00796"></a>00796                         <a class="code" href="LoadScreen_8cpp.html#41a70de77129cc4ec6f10533cb9bb753">SetTopFileToLetter</a>( (<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>)pEvent-&gt;<a class="code" href="structInputAtom.html#c171abb99b6fe1f56f9bae755bdac911">usParam</a> );
<a name="l00797"></a>00797                   }
<a name="l00798"></a>00798                   <span class="keywordflow">break</span>;
<a name="l00799"></a>00799       }
<a name="l00800"></a>00800       <span class="comment">//Update the text field if the file value has changed.</span>
<a name="l00801"></a>00801       <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#8a920e48f1c1b7160ad1ad85725ac98a">iCurrFileShown</a> != iPrevFileShown )
<a name="l00802"></a>00802       {
<a name="l00803"></a>00803             <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> <a class="code" href="Sound_01Control_8cpp.html#6150e0515f7202e2fb518f7206ed97dc">x</a>;
<a name="l00804"></a>00804             <a class="code" href="struct__FDLG__LIST__TAG.html">FDLG_LIST</a> *curr;
<a name="l00805"></a>00805             x = 0;
<a name="l00806"></a>00806             curr = <a class="code" href="LoadScreen_8cpp.html#29b63ea968cd6c6eed712af82bb78c6f">FileList</a>;
<a name="l00807"></a>00807             <span class="keywordflow">while</span>( curr &amp;&amp; x != <a class="code" href="LoadScreen_8cpp.html#8a920e48f1c1b7160ad1ad85725ac98a">iCurrFileShown</a> )
<a name="l00808"></a>00808             {
<a name="l00809"></a>00809                   curr = curr-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#b7de2d598cdc28e20a02aff085c02a98">pNext</a>;
<a name="l00810"></a>00810                   x++;
<a name="l00811"></a>00811             }
<a name="l00812"></a>00812             <span class="keywordflow">if</span>( curr )  
<a name="l00813"></a>00813             {
<a name="l00814"></a>00814                   <a class="code" href="Text_01Input_8cpp.html#a76c38a5799b50166d17ac0607f1e8ad">SetInputFieldStringWith8BitString</a>( 0, (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)curr-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#7de5ba8db78346865d64b61974a001a5">FileInfo</a>.<a class="code" href="struct__GETFILESTRUCT__TAG.html#1b5e35ca9109baa1edcecfcf46a54ef5">zFileName</a> );
<a name="l00815"></a>00815                   swprintf( <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a>, L<span class="stringliteral">"%S"</span>, curr-&gt;<a class="code" href="struct__FDLG__LIST__TAG.html#7de5ba8db78346865d64b61974a001a5">FileInfo</a>.<a class="code" href="struct__GETFILESTRUCT__TAG.html#1b5e35ca9109baa1edcecfcf46a54ef5">zFileName</a> );
<a name="l00816"></a>00816             }
<a name="l00817"></a>00817       }
<a name="l00818"></a>00818 }
<a name="l00819"></a>00819 
<a name="l00820"></a>00820 <span class="comment">//editor doesn't care about the z value.  It uses it's own methods.</span>
<a name="l00821"></a><a class="code" href="LoadScreen_8cpp.html#761e7057e87ff63cf732309cc90f51ef">00821</a> <span class="keywordtype">void</span> <a class="code" href="LoadScreen_8cpp.html#761e7057e87ff63cf732309cc90f51ef">SetGlobalSectorValues</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *szFilename )
<a name="l00822"></a>00822 {
<a name="l00823"></a>00823       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pStr;
<a name="l00824"></a>00824       <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#82bacb4ff4aeafe62bac40e4ac44173d">ValidCoordinate</a>() )
<a name="l00825"></a>00825       {
<a name="l00826"></a>00826             <span class="comment">//convert the coordinate string into into the actual global sector coordinates.</span>
<a name="l00827"></a>00827             <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a>[0] &gt;= <span class="charliteral">'A'</span> &amp;&amp; <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a>[0] &lt;= <span class="charliteral">'P'</span> )
<a name="l00828"></a>00828                   <a class="code" href="strategicmap_8cpp.html#ea322310ced0e35ee18a2ee7b32aac5b">gWorldSectorY</a> = <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a>[0] - <span class="charliteral">'A'</span> + 1;
<a name="l00829"></a>00829             <span class="keywordflow">else</span> 
<a name="l00830"></a>00830                   <a class="code" href="strategicmap_8cpp.html#ea322310ced0e35ee18a2ee7b32aac5b">gWorldSectorY</a> = <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a>[0] - <span class="charliteral">'a'</span> + 1;
<a name="l00831"></a>00831             <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a>[1] == <span class="charliteral">'1'</span> &amp;&amp; <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a>[2] &gt;= <span class="charliteral">'0'</span> &amp;&amp; <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a>[2] &lt;= <span class="charliteral">'6'</span> )
<a name="l00832"></a>00832                   <a class="code" href="strategicmap_8cpp.html#49d9aed144a633fda4ba1990f002d703">gWorldSectorX</a> = ( <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a>[1] - 0x30 ) * 10 + ( <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a>[2] - 0x30 );
<a name="l00833"></a>00833             <span class="keywordflow">else</span> 
<a name="l00834"></a>00834                   <a class="code" href="strategicmap_8cpp.html#49d9aed144a633fda4ba1990f002d703">gWorldSectorX</a> = ( <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a>[1] - 0x30 );
<a name="l00835"></a>00835             pStr = wcsstr( <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a>, L<span class="stringliteral">"_b"</span> );
<a name="l00836"></a>00836             <span class="keywordflow">if</span>( pStr )
<a name="l00837"></a>00837             {
<a name="l00838"></a>00838                   <span class="keywordflow">if</span>( pStr[ 2 ] &gt;= <span class="charliteral">'1'</span> &amp;&amp; pStr[ 2 ] &lt;= <span class="charliteral">'3'</span> )
<a name="l00839"></a>00839                   {
<a name="l00840"></a>00840                         <a class="code" href="strategicmap_8cpp.html#da715721a8ceedd42acf6ddb33e63ce0">gbWorldSectorZ</a> = (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)(pStr[ 2 ] - 0x30);
<a name="l00841"></a>00841                   }
<a name="l00842"></a>00842             }
<a name="l00843"></a>00843       }
<a name="l00844"></a>00844       <span class="keywordflow">else</span>
<a name="l00845"></a>00845       {
<a name="l00846"></a>00846             <a class="code" href="strategicmap_8cpp.html#49d9aed144a633fda4ba1990f002d703">gWorldSectorX</a> = -1;
<a name="l00847"></a>00847             <a class="code" href="strategicmap_8cpp.html#ea322310ced0e35ee18a2ee7b32aac5b">gWorldSectorY</a> = -1;
<a name="l00848"></a>00848             <a class="code" href="strategicmap_8cpp.html#da715721a8ceedd42acf6ddb33e63ce0">gbWorldSectorZ</a> = 0;
<a name="l00849"></a>00849       }
<a name="l00850"></a>00850 }
<a name="l00851"></a>00851 
<a name="l00852"></a><a class="code" href="LoadScreen_8cpp.html#b88799098f58bc5ad50213d431909890">00852</a> <span class="keywordtype">void</span> <a class="code" href="LoadScreen_8cpp.html#b88799098f58bc5ad50213d431909890">InitErrorCatchDialog</a>()
<a name="l00853"></a>00853 {
<a name="l00854"></a>00854       <a class="code" href="structSGPRect.html">SGPRect</a> CenteringRect= {0, 0, 639, 479 };
<a name="l00855"></a>00855 
<a name="l00856"></a>00856       <span class="comment">// do message box and return</span>
<a name="l00857"></a>00857       <a class="code" href="LoadScreen_8cpp.html#20d1f6dc47370f558e0583c8c4e7c313">giErrorCatchMessageBox</a> = <a class="code" href="MessageBoxScreen_8cpp.html#ff890475da4a6f8d61959852ea396a03">DoMessageBox</a>( <a class="code" href="MessageBoxScreen_8h.html#2f1398dba5e4a5616b83437528bdb28edfaaee6cf60e9dcec27ec0650dbbc39f">MSG_BOX_BASIC_STYLE</a>, <a class="code" href="LoadScreen_8cpp.html#fc61e27e3d4a4dc4fdf6383ad547aecd">gzErrorCatchString</a>, 
<a name="l00858"></a>00858                                                                   <a class="code" href="screenids_8h.html#a4ee5dea8709d2b490486a62df77faf21d939a0a63d99da9d7fe3bb42922c6fe">EDIT_SCREEN</a>, MSG_BOX_FLAG_OK, NULL, &amp;CenteringRect );
<a name="l00859"></a>00859       <a class="code" href="LoadScreen_8cpp.html#cde876a04c710f16b877d2d0002a6c2d">gfErrorCatch</a> = FALSE;
<a name="l00860"></a>00860 }
<a name="l00861"></a>00861 
<a name="l00862"></a>00862 <span class="comment">//Because loading and saving the map takes a few seconds, we want to post a message</span>
<a name="l00863"></a>00863 <span class="comment">//on the screen and then update it which requires passing the screen back to the main loop.</span>
<a name="l00864"></a>00864 <span class="comment">//When we come back for the next frame, we then actually save or load the map.  So this</span>
<a name="l00865"></a>00865 <span class="comment">//process takes two full screen cycles.</span>
<a name="l00866"></a><a class="code" href="LoadScreen_8cpp.html#2967ee50affa57514d2003964c08cb52">00866</a> <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="LoadScreen_8cpp.html#2967ee50affa57514d2003964c08cb52">ProcessFileIO</a>()
<a name="l00867"></a>00867 {
<a name="l00868"></a>00868       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> usStartX, usStartY;
<a name="l00869"></a>00869       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubNewFilename[50];
<a name="l00870"></a>00870       <span class="keywordflow">switch</span>( <a class="code" href="LoadScreen_8cpp.html#d3c970f25d546d5a5f50c4707d4598ed">gbCurrentFileIOStatus</a> )
<a name="l00871"></a>00871       {
<a name="l00872"></a>00872             <span class="keywordflow">case</span> <a class="code" href="LoadScreen_8cpp.html#db49720dc49f7d4e4cf9adbf2948e4092a08c52c59022a7f53ca802e874d6b01">INITIATE_MAP_SAVE</a>: <span class="comment">//draw save message </span>
<a name="l00873"></a>00873                   <a class="code" href="video_8cpp.html#1ea7a707a9c4f1ce4e36edeb2b90711b">StartFrameBufferRender</a>( );
<a name="l00874"></a>00874                   <a class="code" href="Font_8cpp.html#f527669d3f5e4d08c32792e367c74f8b">SaveFontSettings</a>();
<a name="l00875"></a>00875                   <a class="code" href="Font_8cpp.html#fa4871009f0473cca0380217753947dc">SetFont</a>( HUGEFONT );
<a name="l00876"></a>00876                   <a class="code" href="Font_8cpp.html#388be5810478c3f3bdb861f144085d70">SetFontForeground</a>( FONT_LTKHAKI );
<a name="l00877"></a>00877                   <a class="code" href="Font_8cpp.html#1513b9080348f45e52cc45e68cbeddee">SetFontShadow</a>( FONT_DKKHAKI );
<a name="l00878"></a>00878                   <a class="code" href="Font_8cpp.html#a1fe8cc526be9e2c96b5dd66e348506f">SetFontBackground</a>( 0 );
<a name="l00879"></a>00879                   swprintf( <a class="code" href="LoadScreen_8cpp.html#60f9817576e6b78becea64bef06407bc">zOrigName</a>, L<span class="stringliteral">"Saving map:  %s"</span>, <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a> );
<a name="l00880"></a>00880                   usStartX = 320 - <a class="code" href="Font_8cpp.html#3bbbfeabebae07a03f719f35607c6e4f">StringPixLength</a>( <a class="code" href="LoadScreen_8cpp.html#60f9817576e6b78becea64bef06407bc">zOrigName</a>, LARGEFONT1 ) / 2;
<a name="l00881"></a>00881                   usStartY = 180 - <a class="code" href="Font_8cpp.html#35cddf34696d33489efb820caf968907">GetFontHeight</a>( LARGEFONT1 ) / 2;
<a name="l00882"></a>00882                   <a class="code" href="Font_8cpp.html#b3e12cf19a0ca58abf6689cc8eca3ead">mprintf</a>( usStartX, usStartY, <a class="code" href="LoadScreen_8cpp.html#60f9817576e6b78becea64bef06407bc">zOrigName</a> );
<a name="l00883"></a>00883 
<a name="l00884"></a>00884                   <a class="code" href="video_8cpp.html#02ed05b095e30f580eeba68eff78327c">InvalidateScreen</a>( );
<a name="l00885"></a>00885                   <a class="code" href="video_8cpp.html#cb214b937b77ff6e2f5f80a7fe45ea5a">EndFrameBufferRender</a>( );
<a name="l00886"></a>00886                   <a class="code" href="LoadScreen_8cpp.html#d3c970f25d546d5a5f50c4707d4598ed">gbCurrentFileIOStatus</a> = <a class="code" href="LoadScreen_8cpp.html#db49720dc49f7d4e4cf9adbf2948e40917e7f46a56e0fa9ae3b98f02a4809dae">SAVING_MAP</a>;
<a name="l00887"></a>00887                   <span class="keywordflow">return</span> <a class="code" href="screenids_8h.html#a4ee5dea8709d2b490486a62df77faf28c585abe4ae19e69bcb3032f5a4bc714">LOADSAVE_SCREEN</a>;
<a name="l00888"></a>00888             <span class="keywordflow">case</span> <a class="code" href="LoadScreen_8cpp.html#db49720dc49f7d4e4cf9adbf2948e40917e7f46a56e0fa9ae3b98f02a4809dae">SAVING_MAP</a>: <span class="comment">//save map</span>
<a name="l00889"></a>00889                   sprintf( (<span class="keywordtype">char</span> *)ubNewFilename, <span class="stringliteral">"%S"</span>, <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a> );
<a name="l00890"></a>00890                   <a class="code" href="edit__sys_8cpp.html#1c73688f8d7f8f047a699d545fd1aa87">RaiseWorldLand</a>();
<a name="l00891"></a>00891                   <span class="keywordflow">if</span>( <a class="code" href="pits_8cpp.html#b82215a2cf066ddf4e5c82ce43be39ca">gfShowPits</a> )
<a name="l00892"></a>00892                         <a class="code" href="pits_8cpp.html#5a5da8d803089583b8c56746549cf20d">RemoveAllPits</a>();
<a name="l00893"></a>00893                   <a class="code" href="Scheduling_8cpp.html#fbc98cbd496f67750c9e24211d18078e">OptimizeSchedules</a>();
<a name="l00894"></a>00894                   <span class="keywordflow">if</span> ( !<a class="code" href="worlddef_8cpp.html#743802b884013ae401a4f6eb18e65520">SaveWorld</a>( ubNewFilename ) )
<a name="l00895"></a>00895                   {
<a name="l00896"></a>00896                         <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#cde876a04c710f16b877d2d0002a6c2d">gfErrorCatch</a> )
<a name="l00897"></a>00897                         {
<a name="l00898"></a>00898                               <a class="code" href="LoadScreen_8cpp.html#b88799098f58bc5ad50213d431909890">InitErrorCatchDialog</a>();
<a name="l00899"></a>00899                               <span class="keywordflow">return</span> <a class="code" href="screenids_8h.html#a4ee5dea8709d2b490486a62df77faf21d939a0a63d99da9d7fe3bb42922c6fe">EDIT_SCREEN</a>;
<a name="l00900"></a>00900                         }
<a name="l00901"></a>00901                         <span class="keywordflow">return</span> <a class="code" href="screenids_8h.html#a4ee5dea8709d2b490486a62df77faf2c1db01a52dceac2c2480a5b9130fe400">ERROR_SCREEN</a>;
<a name="l00902"></a>00902                   }
<a name="l00903"></a>00903                   <span class="keywordflow">if</span>( <a class="code" href="pits_8cpp.html#b82215a2cf066ddf4e5c82ce43be39ca">gfShowPits</a> )
<a name="l00904"></a>00904                         <a class="code" href="pits_8cpp.html#ae7b916ed06a89a4e4837c9157df1187">AddAllPits</a>();
<a name="l00905"></a>00905 
<a name="l00906"></a>00906                   <a class="code" href="LoadScreen_8cpp.html#761e7057e87ff63cf732309cc90f51ef">SetGlobalSectorValues</a>( <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a> );
<a name="l00907"></a>00907 
<a name="l00908"></a>00908                   <span class="keywordflow">if</span>( <a class="code" href="Sector_01Summary_8cpp.html#24f5795f8453025250678243c9a28d88">gfGlobalSummaryExists</a> )
<a name="l00909"></a>00909                         <a class="code" href="Sector_01Summary_8cpp.html#2e1405f0477f51a4e19c79e0e26deabc">UpdateSectorSummary</a>( <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a>, <a class="code" href="Sector_01Summary_8cpp.html#a8db70ba693fe3891c7525a350d912ea">gfUpdateSummaryInfo</a> );
<a name="l00910"></a>00910                   
<a name="l00911"></a>00911                   <a class="code" href="EditorDefines_8h.html#ea401eeecb648bbbe96d6caf33fa7aac">iCurrentAction</a> = <a class="code" href="EditorDefines_8h.html#b04a0655cd1e3bcac5e8f48c18df1a57360cb818a3cfc2ef20b4d4fd53072739">ACTION_NULL</a>;
<a name="l00912"></a>00912                   <a class="code" href="LoadScreen_8cpp.html#d3c970f25d546d5a5f50c4707d4598ed">gbCurrentFileIOStatus</a> = <a class="code" href="LoadScreen_8cpp.html#db49720dc49f7d4e4cf9adbf2948e4094866d0bde1bc87a00642120e2e517b8c">IOSTATUS_NONE</a>;
<a name="l00913"></a>00913                   <a class="code" href="EditorDefines_8h.html#5a075eed02dac8017c99a606bc7124c3">gfRenderWorld</a> = TRUE;
<a name="l00914"></a>00914                   <a class="code" href="EditorDefines_8h.html#3a8478611d591d976e9e594885e1811a">gfRenderTaskbar</a> = TRUE;
<a name="l00915"></a>00915                   <a class="code" href="LoadScreen_8cpp.html#bd87611619e376f44f139d079b362200">fEnteringLoadSaveScreen</a> = TRUE;
<a name="l00916"></a>00916                   <a class="code" href="Font_8cpp.html#8aabac69e168886cbdc2ebfe7eca53f5">RestoreFontSettings</a>();
<a name="l00917"></a>00917                   <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#cde876a04c710f16b877d2d0002a6c2d">gfErrorCatch</a> )
<a name="l00918"></a>00918                   {
<a name="l00919"></a>00919                         <a class="code" href="LoadScreen_8cpp.html#b88799098f58bc5ad50213d431909890">InitErrorCatchDialog</a>();
<a name="l00920"></a>00920                         <span class="keywordflow">return</span> <a class="code" href="screenids_8h.html#a4ee5dea8709d2b490486a62df77faf21d939a0a63d99da9d7fe3bb42922c6fe">EDIT_SCREEN</a>;
<a name="l00921"></a>00921                   }
<a name="l00922"></a>00922                   <span class="keywordflow">if</span>( <a class="code" href="Map_01Information_8cpp.html#9092e81f9a27bc1c300962e835ee7f22">gMapInformation</a>.<a class="code" href="structMAPCREATE__STRUCT.html#72057400bffd7c95bb3312fe20c1fe23">ubMapVersion</a> != <a class="code" href="Map_01Information_8cpp.html#a3c2649aabc9d1d12e68267c85604b4e">gubMinorMapVersion</a> )
<a name="l00923"></a>00923                         <a class="code" href="message_8cpp.html#818e47bc59bd5a5755f06ec51cd74928">ScreenMsg</a>( FONT_MCOLOR_RED, MSG_ERROR, L<span class="stringliteral">"Map data has just been corrupted!!!  What did you just do?  KM : 0"</span> );
<a name="l00924"></a>00924                   <span class="keywordflow">return</span> <a class="code" href="screenids_8h.html#a4ee5dea8709d2b490486a62df77faf21d939a0a63d99da9d7fe3bb42922c6fe">EDIT_SCREEN</a>;
<a name="l00925"></a>00925             <span class="keywordflow">case</span> <a class="code" href="LoadScreen_8cpp.html#db49720dc49f7d4e4cf9adbf2948e40906307193c24b68a9d23c6b91982c6b5b">INITIATE_MAP_LOAD</a>: <span class="comment">//draw load message</span>
<a name="l00926"></a>00926                   <a class="code" href="Font_8cpp.html#f527669d3f5e4d08c32792e367c74f8b">SaveFontSettings</a>();
<a name="l00927"></a>00927                   <a class="code" href="LoadScreen_8cpp.html#d3c970f25d546d5a5f50c4707d4598ed">gbCurrentFileIOStatus</a> = <a class="code" href="LoadScreen_8cpp.html#db49720dc49f7d4e4cf9adbf2948e4090e240497198f4fc7d7f0d8f1565ca50a">LOADING_MAP</a>;
<a name="l00928"></a>00928                   <span class="keywordflow">if</span>( <a class="code" href="Sys_01Globals_8cpp.html#036664ef693d52ae3317ae8f916d3b29">gfEditMode</a> &amp;&amp; <a class="code" href="editscreen_8cpp.html#3fc60567b87142619dc6f9e166fdab32">iCurrentTaskbar</a> == <a class="code" href="EditorDefines_8h.html#bed82baf7f470b522273a3e37c24c60062ae0b61f029ea4e8bb64af13c661ec3">TASK_MERCS</a> )
<a name="l00929"></a>00929                         <a class="code" href="EditorMercs_8cpp.html#f298a8dfcc8c9b0580cc56c7cbd3b27d">IndicateSelectedMerc</a>( <a class="code" href="EditorMercs_8h.html#ac2e5fef5c3189d63a52aa8fdbcd136da386c8cf80ff330abc2b40bc89c45cd5">SELECT_NO_MERC</a> );
<a name="l00930"></a>00930                   <a class="code" href="Item_01Statistics_8cpp.html#a7cde20c34f6dd22d4a6741140e23bbe">SpecifyItemToEdit</a>( NULL, -1 );
<a name="l00931"></a>00931                   <span class="keywordflow">return</span> <a class="code" href="screenids_8h.html#a4ee5dea8709d2b490486a62df77faf28c585abe4ae19e69bcb3032f5a4bc714">LOADSAVE_SCREEN</a>;
<a name="l00932"></a>00932             <span class="keywordflow">case</span> <a class="code" href="LoadScreen_8cpp.html#db49720dc49f7d4e4cf9adbf2948e4090e240497198f4fc7d7f0d8f1565ca50a">LOADING_MAP</a>: <span class="comment">//load map</span>
<a name="l00933"></a>00933                   <a class="code" href="Editor_01Undo_8cpp.html#20ccd20c224e7ad3d9763413cfeadc2a">DisableUndo</a>();
<a name="l00934"></a>00934                   sprintf( (<span class="keywordtype">char</span> *)ubNewFilename, <span class="stringliteral">"%S"</span>, gzFilename );
<a name="l00935"></a>00935                   
<a name="l00936"></a>00936                   <a class="code" href="editscreen_8cpp.html#f695c4be5ee8d5be805ea475e2b168cd">RemoveMercsInSector</a>( );
<a name="l00937"></a>00937 
<a name="l00938"></a>00938                   <span class="keywordflow">if</span>( !<a class="code" href="worlddef_8cpp.html#3bc0dd034b9b6d26c269ec5603e5c794">LoadWorld</a>( ubNewFilename ) )
<a name="l00939"></a>00939                   { <span class="comment">//Want to override crash, so user can do something else.</span>
<a name="l00940"></a>00940                         <a class="code" href="Editor_01Undo_8cpp.html#55873e8767264384a305bb22b95e1be5">EnableUndo</a>();
<a name="l00941"></a>00941                         <a class="code" href="gameloop_8cpp.html#69c7cdd352939ea6ecfef5707ff969f1">SetPendingNewScreen</a>( <a class="code" href="screenids_8h.html#a4ee5dea8709d2b490486a62df77faf28c585abe4ae19e69bcb3032f5a4bc714">LOADSAVE_SCREEN</a> );
<a name="l00942"></a>00942                         <a class="code" href="LoadScreen_8cpp.html#d3c970f25d546d5a5f50c4707d4598ed">gbCurrentFileIOStatus</a> = <a class="code" href="LoadScreen_8cpp.html#db49720dc49f7d4e4cf9adbf2948e4094866d0bde1bc87a00642120e2e517b8c">IOSTATUS_NONE</a>;
<a name="l00943"></a>00943                         <a class="code" href="Sys_01Globals_8cpp.html#9c41c883595c93788351904be45a8904">gfGlobalError</a> = FALSE;
<a name="l00944"></a>00944                         <a class="code" href="LoadScreen_8cpp.html#84e2524827ba1f3efbb1f2ab02cb442d">gfLoadError</a> = TRUE;
<a name="l00945"></a>00945                         <span class="comment">//RemoveButton( iTempButton );</span>
<a name="l00946"></a>00946                         <a class="code" href="messagebox_8cpp.html#00e4123be5ce441eefddb453f73b7493">CreateMessageBox</a>( L<span class="stringliteral">" Error loading file.  Try another filename?"</span> );
<a name="l00947"></a>00947                         <span class="keywordflow">return</span> <a class="code" href="screenids_8h.html#a4ee5dea8709d2b490486a62df77faf28c585abe4ae19e69bcb3032f5a4bc714">LOADSAVE_SCREEN</a>;
<a name="l00948"></a>00948                   }
<a name="l00949"></a>00949                   <a class="code" href="LoadScreen_8cpp.html#761e7057e87ff63cf732309cc90f51ef">SetGlobalSectorValues</a>( gzFilename );
<a name="l00950"></a>00950 
<a name="l00951"></a>00951                   <a class="code" href="Font_8cpp.html#8aabac69e168886cbdc2ebfe7eca53f5">RestoreFontSettings</a>();
<a name="l00952"></a>00952 
<a name="l00953"></a>00953                   <span class="comment">//Load successful, update necessary information.</span>
<a name="l00954"></a>00954 
<a name="l00955"></a>00955                   <span class="comment">//ATE: Any current mercs are transfered here...</span>
<a name="l00956"></a>00956                   <span class="comment">//UpdateMercsInSector( gWorldSectorX, gWorldSectorY, gbWorldSectorZ );</span>
<a name="l00957"></a>00957 
<a name="l00958"></a>00958                   <a class="code" href="Soldier_01Init_01List_8cpp.html#95bf6a3805e187a5ecb0962ed2fdec04">AddSoldierInitListTeamToWorld</a>( ENEMY_TEAM,            255 );
<a name="l00959"></a>00959                   <a class="code" href="Soldier_01Init_01List_8cpp.html#95bf6a3805e187a5ecb0962ed2fdec04">AddSoldierInitListTeamToWorld</a>( CREATURE_TEAM, 255 );
<a name="l00960"></a>00960                   <a class="code" href="Soldier_01Init_01List_8cpp.html#95bf6a3805e187a5ecb0962ed2fdec04">AddSoldierInitListTeamToWorld</a>( MILITIA_TEAM,    255 );
<a name="l00961"></a>00961                   <a class="code" href="Soldier_01Init_01List_8cpp.html#95bf6a3805e187a5ecb0962ed2fdec04">AddSoldierInitListTeamToWorld</a>( CIV_TEAM,              255 );
<a name="l00962"></a>00962                   <a class="code" href="EditorDefines_8h.html#ea401eeecb648bbbe96d6caf33fa7aac">iCurrentAction</a> = <a class="code" href="EditorDefines_8h.html#b04a0655cd1e3bcac5e8f48c18df1a57360cb818a3cfc2ef20b4d4fd53072739">ACTION_NULL</a>;
<a name="l00963"></a>00963                   <a class="code" href="LoadScreen_8cpp.html#d3c970f25d546d5a5f50c4707d4598ed">gbCurrentFileIOStatus</a> = <a class="code" href="LoadScreen_8cpp.html#db49720dc49f7d4e4cf9adbf2948e4094866d0bde1bc87a00642120e2e517b8c">IOSTATUS_NONE</a>;
<a name="l00964"></a>00964                   <span class="keywordflow">if</span>( !<a class="code" href="environment_8cpp.html#ea0c22ba3efb5390ad177dff4fb0be71">gfCaves</a> &amp;&amp; !<a class="code" href="environment_8cpp.html#766b3fc59d0883a3dffe106a75d85de9">gfBasement</a> )
<a name="l00965"></a>00965                   {
<a name="l00966"></a>00966                         <a class="code" href="EditorDefines_8h.html#c9bd166a4c5d3459f355418b7e95ec93">gusLightLevel</a> = 12;
<a name="l00967"></a>00967                         <span class="keywordflow">if</span>( <a class="code" href="lighting_8cpp.html#547678867f597197e26ee36811f7fa94">ubAmbientLightLevel</a> != 4 )
<a name="l00968"></a>00968                         {
<a name="l00969"></a>00969                               <a class="code" href="lighting_8cpp.html#547678867f597197e26ee36811f7fa94">ubAmbientLightLevel</a> = 4;
<a name="l00970"></a>00970                               <a class="code" href="lighting_8cpp.html#e98874c0f28d76be0c89032206fbe4b8">LightSetBaseLevel</a>( <a class="code" href="lighting_8cpp.html#547678867f597197e26ee36811f7fa94">ubAmbientLightLevel</a> );
<a name="l00971"></a>00971                         }
<a name="l00972"></a>00972                   }
<a name="l00973"></a>00973                   <span class="keywordflow">else</span>
<a name="l00974"></a>00974                         <a class="code" href="EditorDefines_8h.html#c9bd166a4c5d3459f355418b7e95ec93">gusLightLevel</a> = (<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>)(EDITOR_LIGHT_MAX - <a class="code" href="lighting_8cpp.html#547678867f597197e26ee36811f7fa94">ubAmbientLightLevel</a> );
<a name="l00975"></a>00975                   <a class="code" href="EditorMapInfo_8cpp.html#59b86a4b9874122c238d26f6b7dd9711">gEditorLightColor</a> = <a class="code" href="Rotting_01Corpses_8cpp.html#b9d657c46479c5880d236c2ebcc74ea4">gpLightColors</a>[ 0 ];
<a name="l00976"></a>00976                   <a class="code" href="EditorDefines_8h.html#5a075eed02dac8017c99a606bc7124c3">gfRenderWorld</a> = TRUE;
<a name="l00977"></a>00977                   <a class="code" href="EditorDefines_8h.html#3a8478611d591d976e9e594885e1811a">gfRenderTaskbar</a> = TRUE;
<a name="l00978"></a>00978                   <a class="code" href="LoadScreen_8cpp.html#bd87611619e376f44f139d079b362200">fEnteringLoadSaveScreen</a> = TRUE;
<a name="l00979"></a>00979                   <a class="code" href="selectwin_8cpp.html#551062510eedc768983fcb4d87e8377f">InitJA2SelectionWindow</a>();
<a name="l00980"></a>00980                   <a class="code" href="editscreen_8cpp.html#491350ded7a595c0b664406f84b324c2">ShowEntryPoints</a>();
<a name="l00981"></a>00981                   <a class="code" href="Editor_01Undo_8cpp.html#55873e8767264384a305bb22b95e1be5">EnableUndo</a>();
<a name="l00982"></a>00982                   <a class="code" href="Editor_01Undo_8cpp.html#c4d429d27f131ce27ab3a9544b6cc6ea">RemoveAllFromUndoList</a>();
<a name="l00983"></a>00983                   <a class="code" href="Editor_01Modes_8cpp.html#c13e045f4309b74818ef79e097f72a06">SetEditorSmoothingMode</a>( <a class="code" href="Map_01Information_8cpp.html#9092e81f9a27bc1c300962e835ee7f22">gMapInformation</a>.<a class="code" href="structMAPCREATE__STRUCT.html#295eef9bfe482f9403eaaba35c9b297e">ubEditorSmoothingType</a> );
<a name="l00984"></a>00984                   <span class="keywordflow">if</span>( <a class="code" href="Map_01Information_8cpp.html#9092e81f9a27bc1c300962e835ee7f22">gMapInformation</a>.<a class="code" href="structMAPCREATE__STRUCT.html#295eef9bfe482f9403eaaba35c9b297e">ubEditorSmoothingType</a> == <a class="code" href="Map_01Information_8h.html#c371861a8e747f0329417e865f29c942cfb8bae1ec419b4776fe294fbcadb262">SMOOTHING_CAVES</a> )
<a name="l00985"></a>00985                         <a class="code" href="newsmooth_8cpp.html#8d8287a8635360e26e91ff7ef95f1984">AnalyseCaveMapForStructureInfo</a>();
<a name="l00986"></a>00986 
<a name="l00987"></a>00987                   <a class="code" href="EditorBuildings_8cpp.html#4ce79c7750ef7cb7d06e25a6bf49fc69">AddLockedDoorCursors</a>();
<a name="l00988"></a>00988                   <a class="code" href="EditorBuildings_8cpp.html#90269133db02ef6bd11760ec93b927c3">gubCurrRoomNumber</a> = <a class="code" href="EditorBuildings_8cpp.html#96bf92262d352831014ba68d0a655852">gubMaxRoomNumber</a>;
<a name="l00989"></a>00989                   <a class="code" href="EditorBuildings_8cpp.html#d7b0462649afbb994140cbb34412d29b">UpdateRoofsView</a>();
<a name="l00990"></a>00990                   <a class="code" href="EditorBuildings_8cpp.html#96b4861db39d4e92a2f00437ca1d7e9c">UpdateWallsView</a>();
<a name="l00991"></a>00991                   <a class="code" href="editscreen_8cpp.html#3bc99bf06637753d8b1d43b68c2504b4">ShowLightPositionHandles</a>();
<a name="l00992"></a>00992                   <a class="code" href="EditorMercs_8cpp.html#e191c7bd9ae37ba2774e757a8b97d7e7">SetMercTeamVisibility</a>( ENEMY_TEAM, <a class="code" href="EditorMercs_8cpp.html#b2d6a71d0180403ec1cce077e3881d59">gfShowEnemies</a> );
<a name="l00993"></a>00993                   <a class="code" href="EditorMercs_8cpp.html#e191c7bd9ae37ba2774e757a8b97d7e7">SetMercTeamVisibility</a>( CREATURE_TEAM, <a class="code" href="EditorMercs_8cpp.html#a29d6d9f9f9f3d726cf8cf0918a36f7d">gfShowCreatures</a> );
<a name="l00994"></a>00994                   <a class="code" href="EditorMercs_8cpp.html#e191c7bd9ae37ba2774e757a8b97d7e7">SetMercTeamVisibility</a>( MILITIA_TEAM, <a class="code" href="EditorMercs_8cpp.html#278168e603e283152d32c91d39fa8289">gfShowRebels</a> );
<a name="l00995"></a>00995                   <a class="code" href="EditorMercs_8cpp.html#e191c7bd9ae37ba2774e757a8b97d7e7">SetMercTeamVisibility</a>( CIV_TEAM, <a class="code" href="EditorMercs_8cpp.html#8fbc575bc97ecdc72849f9a45faa0910">gfShowCivilians</a> );
<a name="l00996"></a>00996                   <a class="code" href="EditorItems_8cpp.html#6f48e4ce08ed8a99c4eeead47374ac76">BuildItemPoolList</a>();
<a name="l00997"></a>00997                   <span class="keywordflow">if</span>( <a class="code" href="pits_8cpp.html#b82215a2cf066ddf4e5c82ce43be39ca">gfShowPits</a> )
<a name="l00998"></a>00998                         <a class="code" href="pits_8cpp.html#ae7b916ed06a89a4e4837c9157df1187">AddAllPits</a>();
<a name="l00999"></a>00999 
<a name="l01000"></a>01000                   <span class="keywordflow">if</span>( <a class="code" href="editscreen_8cpp.html#3fc60567b87142619dc6f9e166fdab32">iCurrentTaskbar</a> == <a class="code" href="EditorDefines_8h.html#bed82baf7f470b522273a3e37c24c60058a769d31321bfdf58b7d85fd2a4e3ad">TASK_MAPINFO</a> )
<a name="l01001"></a>01001                   { <span class="comment">//We have to temporarily remove the current textinput mode,</span>
<a name="l01002"></a>01002                         <span class="comment">//update the disabled text field values, then restore the current</span>
<a name="l01003"></a>01003                         <span class="comment">//text input fields.</span>
<a name="l01004"></a>01004                         <a class="code" href="Text_01Input_8cpp.html#358d2975fef1b0e137292da85d216479">SaveAndRemoveCurrentTextInputMode</a>();
<a name="l01005"></a>01005                         <a class="code" href="EditorMapInfo_8cpp.html#349367a3d1a0a04dc4ab893bee3662b4">UpdateMapInfoFields</a>();
<a name="l01006"></a>01006                         <a class="code" href="Text_01Input_8cpp.html#8fb32a8b19570d1a5660beb4bb45d2da">RestoreSavedTextInputMode</a>();
<a name="l01007"></a>01007                   }
<a name="l01008"></a>01008                   <span class="keywordflow">return</span> <a class="code" href="screenids_8h.html#a4ee5dea8709d2b490486a62df77faf21d939a0a63d99da9d7fe3bb42922c6fe">EDIT_SCREEN</a>;
<a name="l01009"></a>01009       }
<a name="l01010"></a>01010       <a class="code" href="LoadScreen_8cpp.html#d3c970f25d546d5a5f50c4707d4598ed">gbCurrentFileIOStatus</a> = <a class="code" href="LoadScreen_8cpp.html#db49720dc49f7d4e4cf9adbf2948e4094866d0bde1bc87a00642120e2e517b8c">IOSTATUS_NONE</a>;
<a name="l01011"></a>01011       <span class="keywordflow">return</span> <a class="code" href="screenids_8h.html#a4ee5dea8709d2b490486a62df77faf28c585abe4ae19e69bcb3032f5a4bc714">LOADSAVE_SCREEN</a>;
<a name="l01012"></a>01012 }
<a name="l01013"></a>01013 
<a name="l01014"></a>01014 <span class="comment">//LOADSCREEN</span>
<a name="l01015"></a><a class="code" href="LoadScreen_8cpp.html#4f5c38bdf483e6953e81a15d172aa213">01015</a> <span class="keywordtype">void</span> <a class="code" href="LoadScreen_8cpp.html#4f5c38bdf483e6953e81a15d172aa213">FDlgNamesCallback</a>( <a class="code" href="struct__GUI__BUTTON.html">GUI_BUTTON</a> *butn, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> reason )
<a name="l01016"></a>01016 {
<a name="l01017"></a>01017       <span class="keywordflow">if</span>( reason &amp; (MSYS_CALLBACK_REASON_LBUTTON_UP) )
<a name="l01018"></a>01018       {
<a name="l01019"></a>01019             <a class="code" href="LoadScreen_8cpp.html#692d63c1122ca9fe8d4d288e46a789ff">SelectFileDialogYPos</a>( butn-&gt;<a class="code" href="struct__GUI__BUTTON.html#4beb6551bc217db6f0979437cfdd1abb">Area</a>.<a class="code" href="struct__MOUSE__REGION.html#3710c78535d5fe051824976919b4cb37">RelativeYPos</a> );
<a name="l01020"></a>01020       }
<a name="l01021"></a>01021 }
<a name="l01022"></a>01022 
<a name="l01023"></a>01023 
<a name="l01024"></a><a class="code" href="LoadScreen_8cpp.html#f30ce5b6f85deceea09c7cf3293b831a">01024</a> <span class="keywordtype">void</span> <a class="code" href="LoadScreen_8cpp.html#f30ce5b6f85deceea09c7cf3293b831a">FDlgOkCallback</a>( <a class="code" href="struct__GUI__BUTTON.html">GUI_BUTTON</a> *butn, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> reason )
<a name="l01025"></a>01025 {
<a name="l01026"></a>01026       <span class="keywordflow">if</span>( reason &amp; (MSYS_CALLBACK_REASON_LBUTTON_UP) )
<a name="l01027"></a>01027       {
<a name="l01028"></a>01028             <a class="code" href="LoadScreen_8cpp.html#ea89943feac0e7c4b9061b57b1dca606">gfDestroyFDlg</a> = TRUE;
<a name="l01029"></a>01029             <a class="code" href="LoadScreen_8cpp.html#a4f68159b63f4db51c1e9aa217085555">iFDlgState</a> = <a class="code" href="EditorDefines_8h.html#ea401eeecb648bbbe96d6caf33fa7aac">iCurrentAction</a> == <a class="code" href="EditorDefines_8h.html#b04a0655cd1e3bcac5e8f48c18df1a574eb3737a7354a8763f5b2a2ced0166f0">ACTION_SAVE_MAP</a> ? <a class="code" href="LoadScreen_8cpp.html#f9bdc3014f3d54c426b6d2df10de49601b312278c9afeabd86b3bb4ab178ecf8">DIALOG_SAVE</a> : <a class="code" href="LoadScreen_8cpp.html#f9bdc3014f3d54c426b6d2df10de496088a277ead75be15a416e01e349f3d2bd">DIALOG_LOAD</a>;   
<a name="l01030"></a>01030       }
<a name="l01031"></a>01031 }
<a name="l01032"></a>01032 
<a name="l01033"></a><a class="code" href="LoadScreen_8cpp.html#290c1b35c25fae6611f19d55c9fcac35">01033</a> <span class="keywordtype">void</span> <a class="code" href="LoadScreen_8cpp.html#290c1b35c25fae6611f19d55c9fcac35">FDlgCancelCallback</a>( <a class="code" href="struct__GUI__BUTTON.html">GUI_BUTTON</a> *butn, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> reason )
<a name="l01034"></a>01034 {
<a name="l01035"></a>01035       <span class="keywordflow">if</span>( reason &amp; (MSYS_CALLBACK_REASON_LBUTTON_UP) )
<a name="l01036"></a>01036       {
<a name="l01037"></a>01037             <a class="code" href="LoadScreen_8cpp.html#ea89943feac0e7c4b9061b57b1dca606">gfDestroyFDlg</a> = TRUE;
<a name="l01038"></a>01038             <a class="code" href="LoadScreen_8cpp.html#a4f68159b63f4db51c1e9aa217085555">iFDlgState</a> = <a class="code" href="LoadScreen_8cpp.html#f9bdc3014f3d54c426b6d2df10de4960032ac5436ce32d651982f9a7a5809daf">DIALOG_CANCEL</a>;   
<a name="l01039"></a>01039       }
<a name="l01040"></a>01040 }
<a name="l01041"></a>01041 
<a name="l01042"></a><a class="code" href="LoadScreen_8cpp.html#674fe75c4617cdc24bc87c5b10771399">01042</a> <span class="keywordtype">void</span> <a class="code" href="LoadScreen_8cpp.html#674fe75c4617cdc24bc87c5b10771399">FDlgUpCallback</a>( <a class="code" href="struct__GUI__BUTTON.html">GUI_BUTTON</a> *butn, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> reason )
<a name="l01043"></a>01043 {
<a name="l01044"></a>01044       <span class="keywordflow">if</span>( reason &amp; (MSYS_CALLBACK_REASON_LBUTTON_UP) )
<a name="l01045"></a>01045       {
<a name="l01046"></a>01046             <span class="keywordflow">if</span>(<a class="code" href="LoadScreen_8cpp.html#79220a8a0aa9753cc18ffd6b5fc41af8">iTopFileShown</a> &gt; 0)
<a name="l01047"></a>01047                   <a class="code" href="LoadScreen_8cpp.html#79220a8a0aa9753cc18ffd6b5fc41af8">iTopFileShown</a>--;
<a name="l01048"></a>01048       }
<a name="l01049"></a>01049 }
<a name="l01050"></a>01050 
<a name="l01051"></a><a class="code" href="LoadScreen_8cpp.html#89d650e2b6c222efd8f93c6e98bdd3b1">01051</a> <span class="keywordtype">void</span> <a class="code" href="LoadScreen_8cpp.html#89d650e2b6c222efd8f93c6e98bdd3b1">FDlgDwnCallback</a>( <a class="code" href="struct__GUI__BUTTON.html">GUI_BUTTON</a> *butn, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> reason )
<a name="l01052"></a>01052 {
<a name="l01053"></a>01053       <span class="keywordflow">if</span>( reason &amp; (MSYS_CALLBACK_REASON_LBUTTON_UP) )
<a name="l01054"></a>01054       {
<a name="l01055"></a>01055             <span class="keywordflow">if</span>( (<a class="code" href="LoadScreen_8cpp.html#79220a8a0aa9753cc18ffd6b5fc41af8">iTopFileShown</a>+7) &lt; <a class="code" href="LoadScreen_8cpp.html#af40284bcf5db835ad81993f0f083b4f">iTotalFiles</a> )
<a name="l01056"></a>01056                   <a class="code" href="LoadScreen_8cpp.html#79220a8a0aa9753cc18ffd6b5fc41af8">iTopFileShown</a>++;
<a name="l01057"></a>01057       }
<a name="l01058"></a>01058 }
<a name="l01059"></a>01059 
<a name="l01060"></a><a class="code" href="LoadScreen_8h.html#65e9d12bc60feb6ee32a669a38397a0d">01060</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="LoadScreen_8cpp.html#65e9d12bc60feb6ee32a669a38397a0d">ExtractFilenameFromFields</a>()
<a name="l01061"></a>01061 {
<a name="l01062"></a>01062       <a class="code" href="Text_01Input_8cpp.html#10900f7fb19ec2a60346f3e8bcf81409">Get16BitStringFromField</a>( 0, <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a> );
<a name="l01063"></a>01063       <span class="keywordflow">return</span> <a class="code" href="LoadScreen_8cpp.html#959a90f653b5c2aca8adca4af875cf3d">ValidFilename</a>();
<a name="l01064"></a>01064 }
<a name="l01065"></a>01065 
<a name="l01066"></a><a class="code" href="LoadScreen_8h.html#82bacb4ff4aeafe62bac40e4ac44173d">01066</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="LoadScreen_8cpp.html#82bacb4ff4aeafe62bac40e4ac44173d">ValidCoordinate</a>()
<a name="l01067"></a>01067 {
<a name="l01068"></a>01068       <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a>[0] &gt;= <span class="charliteral">'A'</span> &amp;&amp; <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a>[0] &lt;= <span class="charliteral">'P'</span> ||
<a name="l01069"></a>01069             <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a>[0] &gt;= <span class="charliteral">'a'</span> &amp;&amp; <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a>[0] &lt;=<span class="charliteral">'p'</span> )
<a name="l01070"></a>01070       {
<a name="l01071"></a>01071             <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usTotal;
<a name="l01072"></a>01072             <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a>[1] == <span class="charliteral">'1'</span> &amp;&amp; <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a>[2] &gt;= <span class="charliteral">'0'</span> &amp;&amp; <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a>[2] &lt;= <span class="charliteral">'6'</span> )
<a name="l01073"></a>01073             {
<a name="l01074"></a>01074                   usTotal = ( <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a>[1] - 0x30 ) * 10 + ( <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a>[2] - 0x30 );
<a name="l01075"></a>01075             }
<a name="l01076"></a>01076             <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a>[1] &gt;= <span class="charliteral">'1'</span> &amp;&amp; <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a>[1] &lt;= <span class="charliteral">'9'</span>)
<a name="l01077"></a>01077             {
<a name="l01078"></a>01078                   <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a>[2] &lt; <span class="charliteral">'0'</span> || <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a>[2] &gt; <span class="charliteral">'9'</span> )
<a name="l01079"></a>01079                   {
<a name="l01080"></a>01080                         usTotal = ( <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a>[1] - 0x30 );
<a name="l01081"></a>01081                   }
<a name="l01082"></a>01082                   <span class="keywordflow">else</span>
<a name="l01083"></a>01083                   {
<a name="l01084"></a>01084                         <span class="keywordflow">return</span> FALSE;
<a name="l01085"></a>01085                   }
<a name="l01086"></a>01086             }
<a name="l01087"></a>01087             <span class="keywordflow">if</span>( usTotal &gt;= 1 &amp;&amp; usTotal &lt;= 16 )
<a name="l01088"></a>01088             {
<a name="l01089"></a>01089                   <span class="keywordflow">return</span> TRUE;
<a name="l01090"></a>01090             }
<a name="l01091"></a>01091       }
<a name="l01092"></a>01092       <span class="keywordflow">return</span> FALSE;
<a name="l01093"></a>01093 }
<a name="l01094"></a>01094 
<a name="l01095"></a><a class="code" href="LoadScreen_8h.html#959a90f653b5c2aca8adca4af875cf3d">01095</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="LoadScreen_8cpp.html#959a90f653b5c2aca8adca4af875cf3d">ValidFilename</a>()
<a name="l01096"></a>01096 {
<a name="l01097"></a>01097       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pDest;
<a name="l01098"></a>01098       <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a>[0] != <span class="charliteral">'\0'</span> )<span class="comment">// ; &lt;----- I really think they didn't mean this!! (jonathanl)</span>
<a name="l01099"></a>01099       {
<a name="l01100"></a>01100             pDest = wcsstr( <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a>, L<span class="stringliteral">".dat"</span> );
<a name="l01101"></a>01101             <span class="keywordflow">if</span>( !pDest )
<a name="l01102"></a>01102                   pDest = wcsstr( <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a>, L<span class="stringliteral">".DAT"</span> );
<a name="l01103"></a>01103             <span class="keywordflow">if</span>( pDest &amp;&amp; pDest != <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a> &amp;&amp; pDest[4] == <span class="charliteral">'\0'</span> )
<a name="l01104"></a>01104                   <span class="keywordflow">return</span> TRUE;
<a name="l01105"></a>01105       }
<a name="l01106"></a>01106       <span class="keywordflow">return</span> FALSE;
<a name="l01107"></a>01107 }
<a name="l01108"></a>01108 
<a name="l01109"></a><a class="code" href="LoadScreen_8h.html#0e0c0ee2f0e9516e8dac02b80ec3b3f3">01109</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="LoadScreen_8cpp.html#0e0c0ee2f0e9516e8dac02b80ec3b3f3">ExternalLoadMap</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *szFilename )
<a name="l01110"></a>01110 {
<a name="l01111"></a>01111       Assert( szFilename );
<a name="l01112"></a>01112       <span class="keywordflow">if</span>( !wcslen( szFilename ) )
<a name="l01113"></a>01113             <span class="keywordflow">return</span> FALSE;
<a name="l01114"></a>01114       <a class="code" href="Sys_01Globals_8h.html#3d1e5716a3d04a53b8846319dd57da83">wcscpy</a>( <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a>, szFilename );
<a name="l01115"></a>01115       <span class="keywordflow">if</span>( !<a class="code" href="LoadScreen_8cpp.html#959a90f653b5c2aca8adca4af875cf3d">ValidFilename</a>() )
<a name="l01116"></a>01116             <span class="keywordflow">return</span> FALSE;
<a name="l01117"></a>01117       <a class="code" href="LoadScreen_8cpp.html#d3c970f25d546d5a5f50c4707d4598ed">gbCurrentFileIOStatus</a> = <a class="code" href="LoadScreen_8cpp.html#db49720dc49f7d4e4cf9adbf2948e40906307193c24b68a9d23c6b91982c6b5b">INITIATE_MAP_LOAD</a>;
<a name="l01118"></a>01118       <a class="code" href="LoadScreen_8cpp.html#2967ee50affa57514d2003964c08cb52">ProcessFileIO</a>(); <span class="comment">//always returns loadsave_screen and changes iostatus to loading_map.</span>
<a name="l01119"></a>01119       <a class="code" href="Render_01Dirty_8cpp.html#8db36a227ea1a41076c6dc7de2a28084">ExecuteBaseDirtyRectQueue</a>();
<a name="l01120"></a>01120       <a class="code" href="video_8cpp.html#cb214b937b77ff6e2f5f80a7fe45ea5a">EndFrameBufferRender</a>();
<a name="l01121"></a>01121       <a class="code" href="video_8cpp.html#fbefe3edde80cc30c690c11d5c063789">RefreshScreen</a>( NULL );
<a name="l01122"></a>01122       <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#2967ee50affa57514d2003964c08cb52">ProcessFileIO</a>() == <a class="code" href="screenids_8h.html#a4ee5dea8709d2b490486a62df77faf21d939a0a63d99da9d7fe3bb42922c6fe">EDIT_SCREEN</a> )
<a name="l01123"></a>01123             <span class="keywordflow">return</span> TRUE;
<a name="l01124"></a>01124       <span class="keywordflow">return</span> FALSE;
<a name="l01125"></a>01125 }
<a name="l01126"></a>01126 
<a name="l01127"></a><a class="code" href="LoadScreen_8h.html#a818c7413ff00de2eb07c5ae76d9f508">01127</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="LoadScreen_8cpp.html#a818c7413ff00de2eb07c5ae76d9f508">ExternalSaveMap</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *szFilename )
<a name="l01128"></a>01128 {
<a name="l01129"></a>01129       Assert( szFilename );
<a name="l01130"></a>01130       <span class="keywordflow">if</span>( !wcslen( szFilename ) )
<a name="l01131"></a>01131             <span class="keywordflow">return</span> FALSE;
<a name="l01132"></a>01132       <a class="code" href="Sys_01Globals_8h.html#3d1e5716a3d04a53b8846319dd57da83">wcscpy</a>( <a class="code" href="LoadScreen_8cpp.html#296618876bf3405aef3c7b5a5e65f59d">gzFilename</a>, szFilename );
<a name="l01133"></a>01133       <span class="keywordflow">if</span>( !<a class="code" href="LoadScreen_8cpp.html#959a90f653b5c2aca8adca4af875cf3d">ValidFilename</a>() )
<a name="l01134"></a>01134             <span class="keywordflow">return</span> FALSE;
<a name="l01135"></a>01135       <a class="code" href="LoadScreen_8cpp.html#d3c970f25d546d5a5f50c4707d4598ed">gbCurrentFileIOStatus</a> = <a class="code" href="LoadScreen_8cpp.html#db49720dc49f7d4e4cf9adbf2948e4092a08c52c59022a7f53ca802e874d6b01">INITIATE_MAP_SAVE</a>;
<a name="l01136"></a>01136       <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#2967ee50affa57514d2003964c08cb52">ProcessFileIO</a>() == <a class="code" href="screenids_8h.html#a4ee5dea8709d2b490486a62df77faf2c1db01a52dceac2c2480a5b9130fe400">ERROR_SCREEN</a> )
<a name="l01137"></a>01137             <span class="keywordflow">return</span> FALSE;
<a name="l01138"></a>01138       <a class="code" href="Render_01Dirty_8cpp.html#8db36a227ea1a41076c6dc7de2a28084">ExecuteBaseDirtyRectQueue</a>();
<a name="l01139"></a>01139       <a class="code" href="video_8cpp.html#cb214b937b77ff6e2f5f80a7fe45ea5a">EndFrameBufferRender</a>();
<a name="l01140"></a>01140       <a class="code" href="video_8cpp.html#fbefe3edde80cc30c690c11d5c063789">RefreshScreen</a>( NULL );
<a name="l01141"></a>01141       <span class="keywordflow">if</span>( <a class="code" href="LoadScreen_8cpp.html#2967ee50affa57514d2003964c08cb52">ProcessFileIO</a>() == <a class="code" href="screenids_8h.html#a4ee5dea8709d2b490486a62df77faf21d939a0a63d99da9d7fe3bb42922c6fe">EDIT_SCREEN</a> )
<a name="l01142"></a>01142             <span class="keywordflow">return</span> TRUE;
<a name="l01143"></a>01143       <span class="keywordflow">return</span> FALSE;
<a name="l01144"></a>01144 }
<a name="l01145"></a>01145 
<a name="l01146"></a>01146 <span class="preprocessor">#else //non-editor version</span>
<a name="l01147"></a>01147 <span class="preprocessor"></span>
<a name="l01148"></a>01148 <span class="preprocessor">#include "types.h"</span>
<a name="l01149"></a>01149 <span class="preprocessor">#include "<a class="code" href="screenids_8h.html">screenids.h</a>"</span>
<a name="l01150"></a>01150 
<a name="l01151"></a>01151 <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="LoadScreen_8cpp.html#a69e9c1f15cc6152f5179a69c51d0402">LoadSaveScreenInit</a>()
<a name="l01152"></a>01152 {
<a name="l01153"></a>01153       <span class="keywordflow">return</span> TRUE ;
<a name="l01154"></a>01154 }
<a name="l01155"></a>01155 
<a name="l01156"></a>01156 <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>      <a class="code" href="LoadScreen_8cpp.html#16ad67dcc372a6e73a7a8aba15660eee">LoadSaveScreenHandle</a>( )
<a name="l01157"></a>01157 {
<a name="l01158"></a>01158       <span class="comment">//If this screen ever gets set, then this is a bad thing -- endless loop</span>
<a name="l01159"></a>01159       <span class="keywordflow">return</span> <a class="code" href="screenids_8h.html#a4ee5dea8709d2b490486a62df77faf2c1db01a52dceac2c2480a5b9130fe400">ERROR_SCREEN</a> ;
<a name="l01160"></a>01160 }
<a name="l01161"></a>01161 
<a name="l01162"></a>01162 <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="LoadScreen_8cpp.html#2893fdefa6d378cdacbe0064d1dcf14a">LoadSaveScreenShutdown</a>( )
<a name="l01163"></a>01163 {
<a name="l01164"></a>01164       <span class="keywordflow">return</span> TRUE ;
<a name="l01165"></a>01165 }
<a name="l01166"></a>01166 
<a name="l01167"></a>01167 <span class="preprocessor">#endif</span>
<a name="l01168"></a>01168 <span class="preprocessor"></span>
<a name="l01169"></a>01169 
<a name="l01170"></a>01170 
<a name="l01171"></a>01171 
<a name="l01172"></a>01172  
<a name="l01173"></a>01173 
<a name="l01174"></a>01174 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sat Sep 9 13:48:28 2006 for Build by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
