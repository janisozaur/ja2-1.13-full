<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Build: Map Screen Interface Map.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="classes.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir_3179ea33d55a76dc38212d9eab798728.html">export</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_e5664b4b56927c8728eb3192fa60e338.html">hdc2</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_1eb12a41a47efb9efcd82fa98f4f4dbd.html">FTP</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_80cc1f21a78ab7941088ea567f236150.html">ja2src</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_994ab287602efefceafe55287a3657d6.html">Build</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_5aba590d477d4824a9090ab3f8850834.html">Strategic</a></div>
<h1>Map Screen Interface Map.cpp</h1><a href="Map_01Screen_01Interface_01Map_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// WANNE 2 &lt;changed some lines&gt;</span>
<a name="l00002"></a>00002 <span class="preprocessor">#ifdef PRECOMPILEDHEADERS</span>
<a name="l00003"></a>00003 <span class="preprocessor"></span><span class="preprocessor">      #include "<a class="code" href="Strategic_01All_8h.html">Strategic All.h</a>"</span>
<a name="l00004"></a>00004 <span class="preprocessor">      #include "<a class="code" href="GameSettings_8h.html">GameSettings.h</a>"</span>
<a name="l00005"></a>00005 <span class="preprocessor">#else</span>
<a name="l00006"></a>00006 <span class="preprocessor"></span><span class="preprocessor">      #include "<a class="code" href="Font_8h.html">Font.h</a>"</span>
<a name="l00007"></a>00007 <span class="preprocessor">      #include "<a class="code" href="Font_01Control_8h.html">Font Control.h</a>"</span>
<a name="l00008"></a>00008 <span class="preprocessor">      #include "<a class="code" href="mapscreen_8h.html">mapscreen.h</a>"</span>
<a name="l00009"></a>00009 <span class="preprocessor">      #include "<a class="code" href="Map_01Screen_01Interface_8h.html">Map Screen Interface.h</a>"</span>
<a name="l00010"></a>00010 <span class="preprocessor">      #include "<a class="code" href="Map_01Screen_01Interface_01Map_8h.html">Map Screen Interface Map.h</a>"</span>
<a name="l00011"></a>00011 <span class="preprocessor">      #include "<a class="code" href="Map_01Screen_01Interface_01Border_8h.html">Map Screen Interface Border.h</a>"</span>
<a name="l00012"></a>00012 <span class="preprocessor">      #include "<a class="code" href="Overhead_8h.html">Overhead.h</a>"</span>
<a name="l00013"></a>00013 <span class="preprocessor">      #include "<a class="code" href="Render_01Dirty_8h.html">Render Dirty.h</a>"</span>
<a name="l00014"></a>00014 <span class="preprocessor">      #include "<a class="code" href="sysutil_8h.html">sysutil.h</a>"</span>
<a name="l00015"></a>00015 <span class="preprocessor">      #include "<a class="code" href="strategic_8h.html">strategic.h</a>"</span>
<a name="l00016"></a>00016 <span class="preprocessor">      #include "<a class="code" href="strategicmap_8h.html">strategicmap.h</a>"</span>
<a name="l00017"></a>00017 <span class="preprocessor">      #include "<a class="code" href="Strategic_01Pathing_8h.html">Strategic Pathing.h</a>"</span>
<a name="l00018"></a>00018 <span class="preprocessor">      #include "<a class="code" href="Text_8h.html">Text.h</a>"</span>
<a name="l00019"></a>00019 <span class="preprocessor">      #include "<a class="code" href="vsurface_8h.html">vsurface.h</a>"</span>
<a name="l00020"></a>00020 <span class="preprocessor">      #include "<a class="code" href="video_8h.html">video.h</a>"</span>
<a name="l00021"></a>00021 <span class="preprocessor">      #include "<a class="code" href="vobject__blitters_8h.html">vobject_blitters.h</a>"</span>
<a name="l00022"></a>00022 <span class="preprocessor">      #include "<a class="code" href="WCheck_8h.html">WCheck.h</a>"</span>
<a name="l00023"></a>00023 <span class="preprocessor">      #include "<a class="code" href="Assignments_8h.html">Assignments.h</a>"</span>
<a name="l00024"></a>00024 <span class="preprocessor">      #include "<a class="code" href="Squads_8h.html">Squads.h</a>"</span>
<a name="l00025"></a>00025 <span class="preprocessor">      #include "Message.h"</span>
<a name="l00026"></a>00026 <span class="preprocessor">      #include "<a class="code" href="Soldier_01Profile_8h.html">Soldier Profile.h</a>"</span>
<a name="l00027"></a>00027 <span class="preprocessor">      #include "<a class="code" href="Player_01Command_8h.html">Player Command.h</a>"</span>
<a name="l00028"></a>00028 <span class="preprocessor">      #include "<a class="code" href="Strategic_01Movement_8h.html">Strategic Movement.h</a>"</span>
<a name="l00029"></a>00029 <span class="preprocessor">      #include "<a class="code" href="Queen_01Command_8h.html">Queen Command.h</a>"</span>
<a name="l00030"></a>00030 <span class="preprocessor">      #include "<a class="code" href="Campaign_01Types_8h.html">Campaign Types.h</a>"</span>
<a name="l00031"></a>00031 <span class="preprocessor">      #include "<a class="code" href="Strategic_01Town_01Loyalty_8h.html">Strategic Town Loyalty.h</a>"</span>
<a name="l00032"></a>00032 <span class="preprocessor">      #include "<a class="code" href="Strategic_01Mines_8h.html">Strategic Mines.h</a>"</span>
<a name="l00033"></a>00033 <span class="preprocessor">      #include "<a class="code" href="Vehicles_8h.html">Vehicles.h</a>"</span>
<a name="l00034"></a>00034 <span class="preprocessor">      #include "<a class="code" href="Map_01Screen_01Helicopter_8h.html">Map Screen Helicopter.h</a>"</span>
<a name="l00035"></a>00035 <span class="preprocessor">      #include "<a class="code" href="Game_01Clock_8h.html">Game Clock.h</a>"</span>
<a name="l00036"></a>00036 <span class="preprocessor">      #include "<a class="code" href="finances_8h.html">finances.h</a>"</span>
<a name="l00037"></a>00037 <span class="preprocessor">      #include "<a class="code" href="line_8h.html">line.h</a>"</span>
<a name="l00038"></a>00038 <span class="preprocessor">      #include "<a class="code" href="english_8h.html">english.h</a>"</span>
<a name="l00039"></a>00039 <span class="preprocessor">      #include "<a class="code" href="PreBattle_01Interface_8h.html">PreBattle Interface.h</a>"</span>
<a name="l00040"></a>00040 <span class="preprocessor">      #include "<a class="code" href="Utilities_8h.html">Utilities.h</a>"</span>
<a name="l00041"></a>00041 <span class="preprocessor">      #include "<a class="code" href="Town_01Militia_8h.html">Town Militia.h</a>"</span>
<a name="l00042"></a>00042 <span class="preprocessor">      #include "<a class="code" href="Militia_01Control_8h.html">Militia Control.h</a>"</span>
<a name="l00043"></a>00043 <span class="preprocessor">      #include "<a class="code" href="GameSettings_8h.html">GameSettings.h</a>"</span>
<a name="l00044"></a>00044 <span class="preprocessor">#endif</span>
<a name="l00045"></a>00045 <span class="preprocessor"></span>
<a name="l00046"></a>00046 <span class="comment">// zoom x and y coords for map scrolling</span>
<a name="l00047"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#fa3ac40b83d55b2124d79820fa45974c">00047</a> <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#fa3ac40b83d55b2124d79820fa45974c">iZoomX</a> = 0;
<a name="l00048"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#bca9577b78c819bc3429fe62f836704b">00048</a> <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#bca9577b78c819bc3429fe62f836704b">iZoomY</a> = 0;
<a name="l00049"></a>00049 
<a name="l00050"></a>00050 <span class="comment">// Scroll region width</span>
<a name="l00051"></a>00051 <span class="preprocessor">#define SCROLL_REGION 4</span>
<a name="l00052"></a>00052 <span class="preprocessor"></span>
<a name="l00053"></a>00053 <span class="comment">// The Map/Mouse Scroll defines</span>
<a name="l00054"></a>00054 <span class="preprocessor">#define EAST_DIR  0</span>
<a name="l00055"></a>00055 <span class="preprocessor"></span><span class="preprocessor">#define WEST_DIR  1</span>
<a name="l00056"></a>00056 <span class="preprocessor"></span><span class="preprocessor">#define NORTH_DIR 2</span>
<a name="l00057"></a>00057 <span class="preprocessor"></span><span class="preprocessor">#define SOUTH_DIR 3</span>
<a name="l00058"></a>00058 <span class="preprocessor"></span><span class="preprocessor">#define TOP_NORTH  2</span>
<a name="l00059"></a>00059 <span class="preprocessor"></span><span class="preprocessor">#define TOP_SOUTH  13</span>
<a name="l00060"></a>00060 <span class="preprocessor"></span><span class="preprocessor">#define RIGHT_WEST 250</span>
<a name="l00061"></a>00061 <span class="preprocessor"></span><span class="preprocessor">#define RIGHT_EAST 260</span>
<a name="l00062"></a>00062 <span class="preprocessor"></span><span class="preprocessor">#define LEFT_EAST  640</span>
<a name="l00063"></a>00063 <span class="preprocessor"></span><span class="preprocessor">#define LEFT_WEST  630</span>
<a name="l00064"></a>00064 <span class="preprocessor"></span><span class="preprocessor">#define BOTTOM_NORTH 320</span>
<a name="l00065"></a>00065 <span class="preprocessor"></span><span class="preprocessor">#define BOTTOM_SOUTH 330</span>
<a name="l00066"></a>00066 <span class="preprocessor"></span>
<a name="l00067"></a>00067 <span class="comment">// Map Scroll Defines</span>
<a name="l00068"></a>00068 <span class="preprocessor">#define SCROLL_EAST  0</span>
<a name="l00069"></a>00069 <span class="preprocessor"></span><span class="preprocessor">#define SCROLL_WEST  1 </span>
<a name="l00070"></a>00070 <span class="preprocessor"></span><span class="preprocessor">#define SCROLL_NORTH 2</span>
<a name="l00071"></a>00071 <span class="preprocessor"></span><span class="preprocessor">#define SCROLL_SOUTH 3</span>
<a name="l00072"></a>00072 <span class="preprocessor"></span><span class="preprocessor">#define SCROLL_DELAY 50</span>
<a name="l00073"></a>00073 <span class="preprocessor"></span><span class="preprocessor">#define HORT_SCROLL 14</span>
<a name="l00074"></a>00074 <span class="preprocessor"></span><span class="preprocessor">#define VERT_SCROLL 10</span>
<a name="l00075"></a>00075 <span class="preprocessor"></span>
<a name="l00076"></a>00076 <span class="comment">// the pop up for helicopter stuff</span>
<a name="l00077"></a>00077 <span class="preprocessor">#define MAP_HELICOPTER_ETA_POPUP_X                    400</span>
<a name="l00078"></a>00078 <span class="preprocessor"></span><span class="preprocessor">#define MAP_HELICOPTER_ETA_POPUP_Y                    250</span>
<a name="l00079"></a>00079 <span class="preprocessor"></span><span class="preprocessor">#define MAP_HELICOPTER_UPPER_ETA_POPUP_Y        50</span>
<a name="l00080"></a>00080 <span class="preprocessor"></span><span class="preprocessor">#define MAP_HELICOPTER_ETA_POPUP_WIDTH                120</span>
<a name="l00081"></a>00081 <span class="preprocessor"></span><span class="preprocessor">#define MAP_HELICOPTER_ETA_POPUP_HEIGHT               68</span>
<a name="l00082"></a>00082 <span class="preprocessor"></span>
<a name="l00083"></a>00083 <span class="comment">// WANNE 2</span>
<a name="l00084"></a>00084 <span class="preprocessor">#define MAP_LEVEL_STRING_X                                  (SCREEN_WIDTH - 208)          //432</span>
<a name="l00085"></a>00085 <span class="preprocessor"></span><span class="preprocessor">#define MAP_LEVEL_STRING_Y                                  (SCREEN_HEIGHT - 175)         //305</span>
<a name="l00086"></a>00086 <span class="preprocessor"></span>
<a name="l00087"></a>00087 <span class="comment">// font </span>
<a name="l00088"></a>00088 <span class="preprocessor">#define MAP_FONT BLOCKFONT2</span>
<a name="l00089"></a>00089 <span class="preprocessor"></span>
<a name="l00090"></a>00090 <span class="comment">// index color</span>
<a name="l00091"></a>00091 <span class="preprocessor">#define MAP_INDEX_COLOR 32*4-9</span>
<a name="l00092"></a>00092 <span class="preprocessor"></span>
<a name="l00093"></a>00093 <span class="comment">// max number of sectors viewable</span>
<a name="l00094"></a>00094 <span class="preprocessor">#define MAX_VIEW_SECTORS      16 </span>
<a name="l00095"></a>00095 <span class="preprocessor"></span>
<a name="l00096"></a>00096 
<a name="l00097"></a>00097 <span class="comment">//Map Location index regions</span>
<a name="l00098"></a>00098 
<a name="l00099"></a>00099 <span class="comment">// WANNE 2 &lt;change THIS&gt;</span>
<a name="l00100"></a>00100 
<a name="l00101"></a>00101 <span class="comment">// WANNE 2 (The numbers above the map)</span>
<a name="l00102"></a>00102 <span class="comment">// x start of hort index</span>
<a name="l00103"></a>00103 <span class="preprocessor">#define MAP_HORT_INDEX_X                                    (MAP_BORDER_X + MAP_BORDER_X_OFFSET + 31)//(SCREEN_WIDTH - 348)   //292 </span>
<a name="l00104"></a>00104 <span class="preprocessor"></span><span class="comment">// y position of hort index</span>
<a name="l00105"></a>00105 <span class="preprocessor">#define MAP_HORT_INDEX_Y                                    (MAP_BORDER_Y + MAP_BORDER_Y_OFFSET + 8)</span>
<a name="l00106"></a>00106 <span class="preprocessor"></span><span class="comment">// height of hort index</span>
<a name="l00107"></a>00107 <span class="preprocessor">#define MAP_HORT_HEIGHT                                     GetFontHeight(MAP_FONT)</span>
<a name="l00108"></a>00108 <span class="preprocessor"></span>
<a name="l00109"></a>00109 
<a name="l00110"></a>00110 <span class="comment">// WANNE 2 (the letters on the left side of the map)</span>
<a name="l00111"></a>00111 <span class="comment">// vert index start x</span>
<a name="l00112"></a>00112 <span class="preprocessor">#define MAP_VERT_INDEX_X                                    (MAP_BORDER_X + MAP_BORDER_X_OFFSET + 13)       //(SCREEN_WIDTH - 367) // 273</span>
<a name="l00113"></a>00113 <span class="preprocessor"></span><span class="comment">// vert index start y</span>
<a name="l00114"></a>00114 <span class="preprocessor">#define MAP_VERT_INDEX_Y                                    (MAP_BORDER_Y + MAP_BORDER_Y_OFFSET + 29)</span>
<a name="l00115"></a>00115 <span class="preprocessor"></span><span class="comment">// vert width</span>
<a name="l00116"></a>00116 <span class="preprocessor">#define MAP_VERT_WIDTH                                      GetFontHeight(MAP_FONT)</span>
<a name="l00117"></a>00117 <span class="preprocessor"></span>
<a name="l00118"></a>00118 
<a name="l00119"></a>00119 <span class="comment">// "Boxes" Icons</span>
<a name="l00120"></a>00120 <span class="preprocessor">#define SMALL_YELLOW_BOX                  0</span>
<a name="l00121"></a>00121 <span class="preprocessor"></span><span class="preprocessor">#define BIG_YELLOW_BOX                    1</span>
<a name="l00122"></a>00122 <span class="preprocessor"></span><span class="preprocessor">#define SMALL_DULL_YELLOW_BOX 2</span>
<a name="l00123"></a>00123 <span class="preprocessor"></span><span class="preprocessor">#define BIG_DULL_YELLOW_BOX         3</span>
<a name="l00124"></a>00124 <span class="preprocessor"></span><span class="preprocessor">#define SMALL_WHITE_BOX                   4</span>
<a name="l00125"></a>00125 <span class="preprocessor"></span><span class="preprocessor">#define BIG_WHITE_BOX                           5</span>
<a name="l00126"></a>00126 <span class="preprocessor"></span><span class="preprocessor">#define SMALL_RED_BOX                           6</span>
<a name="l00127"></a>00127 <span class="preprocessor"></span><span class="preprocessor">#define BIG_RED_BOX                                   7</span>
<a name="l00128"></a>00128 <span class="preprocessor"></span><span class="preprocessor">#define SMALL_QUESTION_MARK         8</span>
<a name="l00129"></a>00129 <span class="preprocessor"></span><span class="preprocessor">#define BIG_QUESTION_MARK                 9</span>
<a name="l00130"></a>00130 <span class="preprocessor"></span>
<a name="l00131"></a>00131 
<a name="l00132"></a>00132 <span class="preprocessor">#define MERC_ICONS_PER_LINE 6</span>
<a name="l00133"></a>00133 <span class="preprocessor"></span><span class="preprocessor">#define ROWS_PER_SECTOR             5</span>
<a name="l00134"></a>00134 <span class="preprocessor"></span>
<a name="l00135"></a>00135 <span class="preprocessor">#define MAP_X_ICON_OFFSET   2</span>
<a name="l00136"></a>00136 <span class="preprocessor"></span><span class="preprocessor">#define MAP_Y_ICON_OFFSET   1</span>
<a name="l00137"></a>00137 <span class="preprocessor"></span>
<a name="l00138"></a>00138 <span class="comment">// Arrow Offsets</span>
<a name="l00139"></a>00139 <span class="preprocessor">#define UP_X                13 </span>
<a name="l00140"></a>00140 <span class="preprocessor"></span><span class="preprocessor">#define UP_Y                 7</span>
<a name="l00141"></a>00141 <span class="preprocessor"></span><span class="preprocessor">#define DOWN_X               0</span>
<a name="l00142"></a>00142 <span class="preprocessor"></span><span class="preprocessor">#define DOWN_Y              -2</span>
<a name="l00143"></a>00143 <span class="preprocessor"></span><span class="preprocessor">#define RIGHT_X             -2</span>
<a name="l00144"></a>00144 <span class="preprocessor"></span><span class="preprocessor">#define RIGHT_Y             11</span>
<a name="l00145"></a>00145 <span class="preprocessor"></span><span class="preprocessor">#define LEFT_X               2  </span>
<a name="l00146"></a>00146 <span class="preprocessor"></span><span class="preprocessor">#define LEFT_Y               5</span>
<a name="l00147"></a>00147 <span class="preprocessor"></span>
<a name="l00148"></a>00148 
<a name="l00149"></a>00149 <span class="comment">// The Path Lines</span>
<a name="l00150"></a>00150 <span class="preprocessor">#define NORTH_LINE           1</span>
<a name="l00151"></a>00151 <span class="preprocessor"></span><span class="preprocessor">#define SOUTH_LINE           0</span>
<a name="l00152"></a>00152 <span class="preprocessor"></span><span class="preprocessor">#define WEST_LINE            3</span>
<a name="l00153"></a>00153 <span class="preprocessor"></span><span class="preprocessor">#define EAST_LINE            2</span>
<a name="l00154"></a>00154 <span class="preprocessor"></span><span class="preprocessor">#define N_TO_E_LINE          4</span>
<a name="l00155"></a>00155 <span class="preprocessor"></span><span class="preprocessor">#define E_TO_S_LINE          5</span>
<a name="l00156"></a>00156 <span class="preprocessor"></span><span class="preprocessor">#define W_TO_N_LINE          6</span>
<a name="l00157"></a>00157 <span class="preprocessor"></span><span class="preprocessor">#define S_TO_W_LINE          7</span>
<a name="l00158"></a>00158 <span class="preprocessor"></span><span class="preprocessor">#define W_TO_S_LINE          8</span>
<a name="l00159"></a>00159 <span class="preprocessor"></span><span class="preprocessor">#define N_TO_W_LINE          9</span>
<a name="l00160"></a>00160 <span class="preprocessor"></span><span class="preprocessor">#define S_TO_E_LINE         10</span>
<a name="l00161"></a>00161 <span class="preprocessor"></span><span class="preprocessor">#define E_TO_N_LINE         11</span>
<a name="l00162"></a>00162 <span class="preprocessor"></span><span class="preprocessor">#define W_TO_E_LINE         12 </span>
<a name="l00163"></a>00163 <span class="preprocessor"></span><span class="preprocessor">#define N_TO_S_LINE         13 </span>
<a name="l00164"></a>00164 <span class="preprocessor"></span><span class="preprocessor">#define E_TO_W_LINE         14</span>
<a name="l00165"></a>00165 <span class="preprocessor"></span><span class="preprocessor">#define S_TO_N_LINE         15</span>
<a name="l00166"></a>00166 <span class="preprocessor"></span><span class="preprocessor">#define W_TO_E_PART1_LINE   16</span>
<a name="l00167"></a>00167 <span class="preprocessor"></span><span class="preprocessor">#define W_TO_E_PART2_LINE   17</span>
<a name="l00168"></a>00168 <span class="preprocessor"></span><span class="preprocessor">#define E_TO_W_PART1_LINE   18</span>
<a name="l00169"></a>00169 <span class="preprocessor"></span><span class="preprocessor">#define E_TO_W_PART2_LINE   19</span>
<a name="l00170"></a>00170 <span class="preprocessor"></span><span class="preprocessor">#define N_TO_S_PART1_LINE   20</span>
<a name="l00171"></a>00171 <span class="preprocessor"></span><span class="preprocessor">#define N_TO_S_PART2_LINE   21</span>
<a name="l00172"></a>00172 <span class="preprocessor"></span><span class="preprocessor">#define S_TO_N_PART1_LINE   22</span>
<a name="l00173"></a>00173 <span class="preprocessor"></span><span class="preprocessor">#define S_TO_N_PART2_LINE   23</span>
<a name="l00174"></a>00174 <span class="preprocessor"></span><span class="preprocessor">#define GREEN_X_WEST        36</span>
<a name="l00175"></a>00175 <span class="preprocessor"></span><span class="preprocessor">#define GREEN_X_EAST        37</span>
<a name="l00176"></a>00176 <span class="preprocessor"></span><span class="preprocessor">#define GREEN_X_NORTH       38  </span>
<a name="l00177"></a>00177 <span class="preprocessor"></span><span class="preprocessor">#define GREEN_X_SOUTH       39</span>
<a name="l00178"></a>00178 <span class="preprocessor"></span><span class="preprocessor">#define RED_X_WEST          40</span>
<a name="l00179"></a>00179 <span class="preprocessor"></span><span class="preprocessor">#define RED_X_EAST          41 </span>
<a name="l00180"></a>00180 <span class="preprocessor"></span><span class="preprocessor">#define RED_X_NORTH         42    </span>
<a name="l00181"></a>00181 <span class="preprocessor"></span><span class="preprocessor">#define RED_X_SOUTH         43</span>
<a name="l00182"></a>00182 <span class="preprocessor"></span>
<a name="l00183"></a>00183 <span class="comment">// The arrows</span>
<a name="l00184"></a>00184 <span class="preprocessor">#define Y_NORTH_ARROW       24</span>
<a name="l00185"></a>00185 <span class="preprocessor"></span><span class="preprocessor">#define Y_SOUTH_ARROW       25</span>
<a name="l00186"></a>00186 <span class="preprocessor"></span><span class="preprocessor">#define Y_EAST_ARROW        26</span>
<a name="l00187"></a>00187 <span class="preprocessor"></span><span class="preprocessor">#define Y_WEST_ARROW        27</span>
<a name="l00188"></a>00188 <span class="preprocessor"></span><span class="preprocessor">#define W_NORTH_ARROW       28</span>
<a name="l00189"></a>00189 <span class="preprocessor"></span><span class="preprocessor">#define W_SOUTH_ARROW       29</span>
<a name="l00190"></a>00190 <span class="preprocessor"></span><span class="preprocessor">#define W_EAST_ARROW        30</span>
<a name="l00191"></a>00191 <span class="preprocessor"></span><span class="preprocessor">#define W_WEST_ARROW        31</span>
<a name="l00192"></a>00192 <span class="preprocessor"></span><span class="preprocessor">#define NORTH_ARROW         32</span>
<a name="l00193"></a>00193 <span class="preprocessor"></span><span class="preprocessor">#define SOUTH_ARROW         33</span>
<a name="l00194"></a>00194 <span class="preprocessor"></span><span class="preprocessor">#define EAST_ARROW          34</span>
<a name="l00195"></a>00195 <span class="preprocessor"></span><span class="preprocessor">#define WEST_ARROW          35</span>
<a name="l00196"></a>00196 <span class="preprocessor"></span>
<a name="l00197"></a>00197 <span class="preprocessor">#define ZOOM_Y_NORTH_ARROW  68</span>
<a name="l00198"></a>00198 <span class="preprocessor"></span><span class="preprocessor">#define ZOOM_Y_SOUTH_ARROW  69</span>
<a name="l00199"></a>00199 <span class="preprocessor"></span><span class="preprocessor">#define ZOOM_Y_EAST_ARROW   70</span>
<a name="l00200"></a>00200 <span class="preprocessor"></span><span class="preprocessor">#define ZOOM_Y_WEST_ARROW   71</span>
<a name="l00201"></a>00201 <span class="preprocessor"></span><span class="preprocessor">#define ZOOM_W_NORTH_ARROW  72</span>
<a name="l00202"></a>00202 <span class="preprocessor"></span><span class="preprocessor">#define ZOOM_W_SOUTH_ARROW  73</span>
<a name="l00203"></a>00203 <span class="preprocessor"></span><span class="preprocessor">#define ZOOM_W_EAST_ARROW   74</span>
<a name="l00204"></a>00204 <span class="preprocessor"></span><span class="preprocessor">#define ZOOM_W_WEST_ARROW   75</span>
<a name="l00205"></a>00205 <span class="preprocessor"></span><span class="preprocessor">#define ZOOM_NORTH_ARROW    76</span>
<a name="l00206"></a>00206 <span class="preprocessor"></span><span class="preprocessor">#define ZOOM_SOUTH_ARROW    77</span>
<a name="l00207"></a>00207 <span class="preprocessor"></span><span class="preprocessor">#define ZOOM_EAST_ARROW     78</span>
<a name="l00208"></a>00208 <span class="preprocessor"></span><span class="preprocessor">#define ZOOM_WEST_ARROW     79</span>
<a name="l00209"></a>00209 <span class="preprocessor"></span><span class="preprocessor">#define ARROW_DELAY         20</span>
<a name="l00210"></a>00210 <span class="preprocessor"></span><span class="preprocessor">#define PAUSE_DELAY       1000 </span>
<a name="l00211"></a>00211 <span class="preprocessor"></span>
<a name="l00212"></a>00212 <span class="comment">// The zoomed in path lines</span>
<a name="l00213"></a>00213 <span class="preprocessor">#define SOUTH_ZOOM_LINE         44</span>
<a name="l00214"></a>00214 <span class="preprocessor"></span><span class="preprocessor">#define NORTH_ZOOM_LINE         45 </span>
<a name="l00215"></a>00215 <span class="preprocessor"></span><span class="preprocessor">#define EAST_ZOOM_LINE          46 </span>
<a name="l00216"></a>00216 <span class="preprocessor"></span><span class="preprocessor">#define WEST_ZOOM_LINE          47</span>
<a name="l00217"></a>00217 <span class="preprocessor"></span><span class="preprocessor">#define N_TO_E_ZOOM_LINE        48</span>
<a name="l00218"></a>00218 <span class="preprocessor"></span><span class="preprocessor">#define E_TO_S_ZOOM_LINE        49 </span>
<a name="l00219"></a>00219 <span class="preprocessor"></span><span class="preprocessor">#define W_TO_N_ZOOM_LINE        50 </span>
<a name="l00220"></a>00220 <span class="preprocessor"></span><span class="preprocessor">#define S_TO_W_ZOOM_LINE        51  </span>
<a name="l00221"></a>00221 <span class="preprocessor"></span><span class="preprocessor">#define W_TO_S_ZOOM_LINE        52</span>
<a name="l00222"></a>00222 <span class="preprocessor"></span><span class="preprocessor">#define N_TO_W_ZOOM_LINE        53</span>
<a name="l00223"></a>00223 <span class="preprocessor"></span><span class="preprocessor">#define S_TO_E_ZOOM_LINE        54</span>
<a name="l00224"></a>00224 <span class="preprocessor"></span><span class="preprocessor">#define E_TO_N_ZOOM_LINE        55</span>
<a name="l00225"></a>00225 <span class="preprocessor"></span><span class="preprocessor">#define W_TO_E_ZOOM_LINE        56 </span>
<a name="l00226"></a>00226 <span class="preprocessor"></span><span class="preprocessor">#define N_TO_S_ZOOM_LINE        57 </span>
<a name="l00227"></a>00227 <span class="preprocessor"></span><span class="preprocessor">#define E_TO_W_ZOOM_LINE        58</span>
<a name="l00228"></a>00228 <span class="preprocessor"></span><span class="preprocessor">#define S_TO_N_ZOOM_LINE        59</span>
<a name="l00229"></a>00229 <span class="preprocessor"></span><span class="preprocessor">#define ZOOM_GREEN_X_WEST       80</span>
<a name="l00230"></a>00230 <span class="preprocessor"></span><span class="preprocessor">#define ZOOM_GREEN_X_EAST       81 </span>
<a name="l00231"></a>00231 <span class="preprocessor"></span><span class="preprocessor">#define ZOOM_GREEN_X_NORTH      82 </span>
<a name="l00232"></a>00232 <span class="preprocessor"></span><span class="preprocessor">#define ZOOM_GREEN_X_SOUTH      83</span>
<a name="l00233"></a>00233 <span class="preprocessor"></span><span class="preprocessor">#define ZOOM_RED_X_WEST         84</span>
<a name="l00234"></a>00234 <span class="preprocessor"></span><span class="preprocessor">#define ZOOM_RED_X_EAST         85</span>
<a name="l00235"></a>00235 <span class="preprocessor"></span><span class="preprocessor">#define ZOOM_RED_X_NORTH        86 </span>
<a name="l00236"></a>00236 <span class="preprocessor"></span><span class="preprocessor">#define ZOOM_RED_X_SOUTH        87 </span>
<a name="l00237"></a>00237 <span class="preprocessor"></span>
<a name="l00238"></a>00238 <span class="preprocessor">#define CHAR_FONT_COLOR 32*4-9</span>
<a name="l00239"></a>00239 <span class="preprocessor"></span>
<a name="l00240"></a>00240 <span class="comment">// Arrow Offsets</span>
<a name="l00241"></a>00241 <span class="preprocessor">#define EAST_OFFSET_X  11</span>
<a name="l00242"></a>00242 <span class="preprocessor"></span><span class="preprocessor">#define EAST_OFFSET_Y  0</span>
<a name="l00243"></a>00243 <span class="preprocessor"></span><span class="preprocessor">#define NORTH_OFFSET_X 9</span>
<a name="l00244"></a>00244 <span class="preprocessor"></span><span class="preprocessor">#define NORTH_OFFSET_Y -9</span>
<a name="l00245"></a>00245 <span class="preprocessor"></span><span class="preprocessor">#define SOUTH_OFFSET_X -9</span>
<a name="l00246"></a>00246 <span class="preprocessor"></span><span class="preprocessor">#define SOUTH_OFFSET_Y 9</span>
<a name="l00247"></a>00247 <span class="preprocessor"></span><span class="preprocessor">#define WEST_OFFSET_X  -11</span>
<a name="l00248"></a>00248 <span class="preprocessor"></span><span class="preprocessor">#define WEST_OFFSET_Y  0</span>
<a name="l00249"></a>00249 <span class="preprocessor"></span><span class="preprocessor">#define WEST_TO_SOUTH_OFFSET_Y  0</span>
<a name="l00250"></a>00250 <span class="preprocessor"></span><span class="preprocessor">#define EAST_TO_NORTH_OFFSET_Y  0</span>
<a name="l00251"></a>00251 <span class="preprocessor"></span><span class="preprocessor">#define RED_WEST_OFF_X  -MAP_GRID_X </span>
<a name="l00252"></a>00252 <span class="preprocessor"></span><span class="preprocessor">#define RED_EAST_OFF_X  MAP_GRID_X</span>
<a name="l00253"></a>00253 <span class="preprocessor"></span><span class="preprocessor">#define RED_NORTH_OFF_Y -21  </span>
<a name="l00254"></a>00254 <span class="preprocessor"></span><span class="preprocessor">#define RED_SOUTH_OFF_Y 21</span>
<a name="l00255"></a>00255 <span class="preprocessor"></span>
<a name="l00256"></a>00256 <span class="comment">// the font use on the mvt icons for mapscreen</span>
<a name="l00257"></a>00257 <span class="preprocessor">#define MAP_MVT_ICON_FONT SMALLCOMPFONT</span>
<a name="l00258"></a>00258 <span class="preprocessor"></span>
<a name="l00259"></a>00259 
<a name="l00260"></a>00260 <span class="comment">// map shading colors</span>
<a name="l00261"></a>00261 
<a name="l00262"></a>00262 <span class="keyword">enum</span>{
<a name="l00263"></a>00263       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#fb9b21dcb0b6eb4e9e0c9cb090e774be0cc3c2e4f355e031d5e4c89638694188">MAP_SHADE_BLACK</a> =0,
<a name="l00264"></a>00264       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#fb9b21dcb0b6eb4e9e0c9cb090e774bedbe0ec1c7d93e5c0aff724c3da00fa33">MAP_SHADE_LT_GREEN</a>,
<a name="l00265"></a>00265       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#fb9b21dcb0b6eb4e9e0c9cb090e774beb1445a45b72eb4c89a753ad87a086710">MAP_SHADE_DK_GREEN</a>,
<a name="l00266"></a>00266       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#fb9b21dcb0b6eb4e9e0c9cb090e774be4ca82572c21c49c5764317b5f6726911">MAP_SHADE_LT_RED</a>,
<a name="l00267"></a>00267       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#fb9b21dcb0b6eb4e9e0c9cb090e774bed86b7b23cdbc96fef4d6d71d6298423e">MAP_SHADE_DK_RED</a>,
<a name="l00268"></a>00268 };
<a name="l00269"></a>00269 <span class="comment">// the big map .pcx</span>
<a name="l00270"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#ce38015bdf56dde3a7dda1e75e9f4be6">00270</a> <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ce38015bdf56dde3a7dda1e75e9f4be6">guiBIGMAP</a>;
<a name="l00271"></a>00271 
<a name="l00272"></a>00272 <span class="comment">// orta .sti icon</span>
<a name="l00273"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#69311101fb9e53baa97c0410e7159c2a">00273</a> <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#69311101fb9e53baa97c0410e7159c2a">guiORTAICON</a>;
<a name="l00274"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#3c0d169cfe47645fc0d4dcc9639068d8">00274</a> <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#3c0d169cfe47645fc0d4dcc9639068d8">guiTIXAICON</a>;
<a name="l00275"></a>00275 
<a name="l00276"></a>00276 <span class="comment">// boxes for characters on the map</span>
<a name="l00277"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#6aa6d54347b71646905ecbde972d0749">00277</a> <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#6aa6d54347b71646905ecbde972d0749">guiCHARICONS</a>;
<a name="l00278"></a>00278 
<a name="l00279"></a>00279 <span class="comment">// the merc arrival sector landing zone icon</span>
<a name="l00280"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#7b4aad02581a1bc4a1e7bb34e348e118">00280</a> <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7b4aad02581a1bc4a1e7bb34e348e118">guiBULLSEYE</a>;
<a name="l00281"></a>00281 
<a name="l00282"></a>00282 
<a name="l00283"></a>00283 <span class="comment">// the max allowable towns militia in a sector</span>
<a name="l00284"></a>00284 <span class="preprocessor">#define MAP_MILITIA_MAP_X 4</span>
<a name="l00285"></a>00285 <span class="preprocessor"></span><span class="preprocessor">#define MAP_MILITIA_MAP_Y 20</span>
<a name="l00286"></a>00286 <span class="preprocessor"></span><span class="preprocessor">#define MAP_MILITIA_LOWER_ROW_Y 142</span>
<a name="l00287"></a>00287 <span class="preprocessor"></span><span class="preprocessor">#define NUMBER_OF_MILITIA_ICONS_PER_LOWER_ROW 25</span>
<a name="l00288"></a>00288 <span class="preprocessor"></span><span class="preprocessor">#define MILITIA_BOX_ROWS 3</span>
<a name="l00289"></a>00289 <span class="preprocessor"></span><span class="preprocessor">#define MILITIA_BOX_BOX_HEIGHT 36 </span>
<a name="l00290"></a>00290 <span class="preprocessor"></span><span class="preprocessor">#define MILITIA_BOX_BOX_WIDTH 42</span>
<a name="l00291"></a>00291 <span class="preprocessor"></span><span class="preprocessor">#define MAP_MILITIA_BOX_POS_X 400</span>
<a name="l00292"></a>00292 <span class="preprocessor"></span><span class="preprocessor">#define MAP_MILITIA_BOX_POS_Y 125</span>
<a name="l00293"></a>00293 <span class="preprocessor"></span>
<a name="l00294"></a>00294 <span class="preprocessor">#define POPUP_MILITIA_ICONS_PER_ROW 5                       // max 6 rows gives the limit of 30 militia</span>
<a name="l00295"></a>00295 <span class="preprocessor"></span><span class="preprocessor">#define MEDIUM_MILITIA_ICON_SPACING 5</span>
<a name="l00296"></a>00296 <span class="preprocessor"></span><span class="preprocessor">#define LARGE_MILITIA_ICON_SPACING  6</span>
<a name="l00297"></a>00297 <span class="preprocessor"></span>
<a name="l00298"></a>00298 <span class="preprocessor">#define MILITIA_BTN_OFFSET_X 26</span>
<a name="l00299"></a>00299 <span class="preprocessor"></span><span class="preprocessor">#define MILITIA_BTN_HEIGHT 11</span>
<a name="l00300"></a>00300 <span class="preprocessor"></span><span class="preprocessor">#define MILITIA_BOX_WIDTH 133</span>
<a name="l00301"></a>00301 <span class="preprocessor"></span><span class="preprocessor">#define MILITIA_BOX_TEXT_OFFSET_Y 4</span>
<a name="l00302"></a>00302 <span class="preprocessor"></span><span class="preprocessor">#define MILITIA_BOX_UNASSIGNED_TEXT_OFFSET_Y 132</span>
<a name="l00303"></a>00303 <span class="preprocessor"></span><span class="preprocessor">#define MILITIA_BOX_TEXT_TITLE_HEIGHT 13 </span>
<a name="l00304"></a>00304 <span class="preprocessor"></span>
<a name="l00305"></a>00305 <span class="preprocessor">#define MAP_MILITIA_BOX_AUTO_BOX_X 4</span>
<a name="l00306"></a>00306 <span class="preprocessor"></span><span class="preprocessor">#define MAP_MILITIA_BOX_AUTO_BOX_Y 167</span>
<a name="l00307"></a>00307 <span class="preprocessor"></span><span class="preprocessor">#define MAP_MILITIA_BOX_DONE_BOX_X 67</span>
<a name="l00308"></a>00308 <span class="preprocessor"></span>
<a name="l00309"></a>00309 <span class="preprocessor">#define HELI_ICON                         0</span>
<a name="l00310"></a>00310 <span class="preprocessor"></span><span class="preprocessor">#define HELI_SHADOW_ICON      1</span>
<a name="l00311"></a>00311 <span class="preprocessor"></span>
<a name="l00312"></a>00312 <span class="preprocessor">#define HELI_ICON_WIDTH       20</span>
<a name="l00313"></a>00313 <span class="preprocessor"></span><span class="preprocessor">#define HELI_ICON_HEIGHT      10</span>
<a name="l00314"></a>00314 <span class="preprocessor"></span><span class="preprocessor">#define HELI_SHADOW_ICON_WIDTH      19</span>
<a name="l00315"></a>00315 <span class="preprocessor"></span><span class="preprocessor">#define HELI_SHADOW_ICON_HEIGHT     11</span>
<a name="l00316"></a>00316 <span class="preprocessor"></span>
<a name="l00317"></a>00317 
<a name="l00318"></a>00318 <span class="comment">// the militia box buttons and images</span>
<a name="l00319"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e747867f24c86066723ce3da34a65cd2">00319</a> <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e747867f24c86066723ce3da34a65cd2">giMapMilitiaButtonImage</a>[ 5 ];
<a name="l00320"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0f4a0d61ac6bc0b9edfe8f3df3505031">00320</a> <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0f4a0d61ac6bc0b9edfe8f3df3505031">giMapMilitiaButton</a>[ 5 ] = { -1, -1, -1, -1, -1 };
<a name="l00321"></a>00321 
<a name="l00322"></a>00322 
<a name="l00323"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b85e63a0c588a1aaeba5695f01282062">00323</a> <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b85e63a0c588a1aaeba5695f01282062">gsMilitiaSectorButtonColors</a>[]={
<a name="l00324"></a>00324       FONT_LTGREEN,
<a name="l00325"></a>00325       FONT_LTBLUE,
<a name="l00326"></a>00326       16,
<a name="l00327"></a>00327 };
<a name="l00328"></a>00328 
<a name="l00329"></a>00329 <span class="comment">// track number of townspeople picked up</span>
<a name="l00330"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#713d7ee279b00a3921e5d1d053a28e64">00330</a> <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#713d7ee279b00a3921e5d1d053a28e64">sGreensOnCursor</a> = 0;
<a name="l00331"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#7fa9e1a37309ac744098ba38183ee51d">00331</a> <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7fa9e1a37309ac744098ba38183ee51d">sRegularsOnCursor</a> = 0;
<a name="l00332"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#799f848c53a7307d2ac4d5e5a22eed20">00332</a> <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#799f848c53a7307d2ac4d5e5a22eed20">sElitesOnCursor</a> = 0;
<a name="l00333"></a>00333 
<a name="l00334"></a>00334 <span class="comment">// the current militia town id</span>
<a name="l00335"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#51cc0335bcdf1be08103f8d3ab7cf85c">00335</a> <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#51cc0335bcdf1be08103f8d3ab7cf85c">sSelectedMilitiaTown</a> = 0;
<a name="l00336"></a>00336 
<a name="l00337"></a>00337 
<a name="l00338"></a>00338 <span class="keyword">extern</span> <a class="code" href="structMINE__LOCATION__TYPE.html">MINE_LOCATION_TYPE</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#2889e0746115b88002494be407bc5de4">gMineLocation</a>[];
<a name="l00339"></a>00339 <span class="keyword">extern</span> <a class="code" href="structMINE__STATUS__TYPE.html">MINE_STATUS_TYPE</a> <a class="code" href="Creature_01Spreading_8cpp.html#9380f2e39f34095d76ba1abab44dab29">gMineStatus</a>[];
<a name="l00340"></a>00340 
<a name="l00341"></a>00341 <span class="comment">// sublevel graphics</span>
<a name="l00342"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#8b1f8e6eda2eaa198c3aad9ef31dbabc">00342</a> <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#911fd69fea89aff3ff9e9bc22521fe25">guiSubLevel1</a>, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#8fdd5fee87dd95e3cecf02117495022a">guiSubLevel2</a>, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#8b1f8e6eda2eaa198c3aad9ef31dbabc">guiSubLevel3</a>;
<a name="l00343"></a>00343 
<a name="l00344"></a>00344 <span class="comment">// the between sector icons</span>
<a name="l00345"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#9ac8b2013c7c0bfa2e89cb558b4f3771">00345</a> <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>    <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#9ac8b2013c7c0bfa2e89cb558b4f3771">guiCHARBETWEENSECTORICONS</a>;
<a name="l00346"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#ecaa61ada89c8e8b47514187fbfa2d1b">00346</a> <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>            <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ecaa61ada89c8e8b47514187fbfa2d1b">guiCHARBETWEENSECTORICONSCLOSE</a>;
<a name="l00347"></a>00347 
<a name="l00348"></a>00348 <span class="keyword">extern</span> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="HelpScreen_8cpp.html#76b028059427f50dbfcd71e9a289d81a">fMapScreenBottomDirty</a>;
<a name="l00349"></a>00349 
<a name="l00350"></a>00350 <span class="comment">// tixa found</span>
<a name="l00351"></a><a class="code" href="Interface_01Dialogue_8cpp.html#e5d32ba931394430e60f65852d4e36e6">00351</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e5d32ba931394430e60f65852d4e36e6">fFoundTixa</a> = FALSE;
<a name="l00352"></a>00352 
<a name="l00353"></a>00353 <span class="comment">// selected sector</span>
<a name="l00354"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#db5e700c27f1673be3250fa875d4af87">00354</a> <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>            <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#db5e700c27f1673be3250fa875d4af87">sSelMapX</a> = 9;
<a name="l00355"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#b4658c32a43a079f3804a635a62b2067">00355</a> <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>            <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b4658c32a43a079f3804a635a62b2067">sSelMapY</a> = 1;
<a name="l00356"></a>00356 
<a name="l00357"></a>00357 <span class="comment">// highlighted sector</span>
<a name="l00358"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#e4bfe351f810c0cb88ffc06f6eed4848">00358</a> <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e4bfe351f810c0cb88ffc06f6eed4848">gsHighlightSectorX</a>=-1;
<a name="l00359"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#0bc4633a93cb4ce8b1bdb6b077fc60b1">00359</a> <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0bc4633a93cb4ce8b1bdb6b077fc60b1">gsHighlightSectorY</a>=-1;
<a name="l00360"></a>00360 
<a name="l00361"></a>00361 <span class="comment">// the current sector Z value of the map being displayed</span>
<a name="l00362"></a><a class="code" href="Radar_01Screen_8cpp.html#b52d71b8f7dc10a22568eb52e0c51a3e">00362</a> <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b52d71b8f7dc10a22568eb52e0c51a3e">iCurrentMapSectorZ</a> = 0;
<a name="l00363"></a>00363 
<a name="l00364"></a>00364 <span class="comment">// the palettes</span>
<a name="l00365"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#6a51f002959a15168a0973f21a1073c7">00365</a> <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#6a51f002959a15168a0973f21a1073c7">pMapLTRedPalette</a>;
<a name="l00366"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#4212c0c3f42c8766dbe87334333caf62">00366</a> <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#4212c0c3f42c8766dbe87334333caf62">pMapDKRedPalette</a>;
<a name="l00367"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#221813e71fc4c68dadf0853dd8cddf42">00367</a> <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#221813e71fc4c68dadf0853dd8cddf42">pMapLTGreenPalette</a>;
<a name="l00368"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#f1e78aa29d01da7e5ad63d8ca428b7a8">00368</a> <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#f1e78aa29d01da7e5ad63d8ca428b7a8">pMapDKGreenPalette</a>;
<a name="l00369"></a>00369 
<a name="l00370"></a>00370 
<a name="l00371"></a>00371 <span class="comment">// the map border eta pop up </span>
<a name="l00372"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#2606ed0f359c96bf8f01e4768e1bd937">00372</a> <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#2606ed0f359c96bf8f01e4768e1bd937">guiMapBorderEtaPopUp</a>;
<a name="l00373"></a>00373 
<a name="l00374"></a>00374 <span class="comment">// heli pop up </span>
<a name="l00375"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#6aa1436583b2da40e1480ff08ddd1df1">00375</a> <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#6aa1436583b2da40e1480ff08ddd1df1">guiMapBorderHeliSectors</a>;
<a name="l00376"></a>00376 
<a name="l00377"></a>00377 <span class="comment">// list of map sectors that player isn't allowed to even highlight</span>
<a name="l00378"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#220f372324611c3dfa35c7ff5eca6958">00378</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#220f372324611c3dfa35c7ff5eca6958">sBadSectorsList</a>[ WORLD_MAP_X ][ WORLD_MAP_X ];
<a name="l00379"></a>00379 
<a name="l00380"></a>00380 
<a name="l00381"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#0e13acff97778b5e62d21d90dca2f3dc">00381</a> <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0e13acff97778b5e62d21d90dca2f3dc">sBaseSectorList</a>[12];<span class="comment">/*={</span>
<a name="l00382"></a>00382 <span class="comment">      // NOTE: These co-ordinates must match the top left corner of the 3x3 town tiles cutouts in Interface/MilitiaMaps.sti!</span>
<a name="l00383"></a>00383 <span class="comment">      SECTOR(  9, 1 ), // Omerta</span>
<a name="l00384"></a>00384 <span class="comment">      SECTOR( 13, 2 ), // Drassen</span>
<a name="l00385"></a>00385 <span class="comment">      SECTOR( 13, 8 ), // Alma</span>
<a name="l00386"></a>00386 <span class="comment">      SECTOR(  1, 7 ), // Grumm</span>
<a name="l00387"></a>00387 <span class="comment">      SECTOR(  8, 9 ), // Tixa</span>
<a name="l00388"></a>00388 <span class="comment">      SECTOR(  8, 6 ), // Cambria</span>
<a name="l00389"></a>00389 <span class="comment">      SECTOR(  4, 2 ), // San Mona</span>
<a name="l00390"></a>00390 <span class="comment">      SECTOR(  5, 8 ), // Estoni</span>
<a name="l00391"></a>00391 <span class="comment">      SECTOR(  3,10 ), // Orta</span>
<a name="l00392"></a>00392 <span class="comment">      SECTOR( 11,11 ), // Balime</span>
<a name="l00393"></a>00393 <span class="comment">      SECTOR(  3,14 ), // Meduna</span>
<a name="l00394"></a>00394 <span class="comment">      SECTOR(  2, 1 ), // Chitzena</span>
<a name="l00395"></a>00395 <span class="comment">};*/</span>
<a name="l00396"></a>00396 
<a name="l00397"></a>00397 <span class="comment">// position of town names on the map</span>
<a name="l00398"></a>00398 <span class="comment">// these are no longer PIXELS, but 10 * the X,Y position in SECTORS (fractions possible) to the X-CENTER of the town</span>
<a name="l00399"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#93a894b1554eecf3cf0f0ce8fbbf56a1">00399</a> POINT <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#93a894b1554eecf3cf0f0ce8fbbf56a1">pTownPoints</a>[13];<span class="comment">/*={</span>
<a name="l00400"></a>00400 <span class="comment">      { 0 ,  0 },</span>
<a name="l00401"></a>00401 <span class="comment">      { 90, 10}, // Omerta</span>
<a name="l00402"></a>00402 <span class="comment">      {125, 40}, // Drassen</span>
<a name="l00403"></a>00403 <span class="comment">      {130, 90}, // Alma</span>
<a name="l00404"></a>00404 <span class="comment">      { 15, 80}, // Grumm</span>
<a name="l00405"></a>00405 <span class="comment">      { 85,100}, // Tixa</span>
<a name="l00406"></a>00406 <span class="comment">      { 95, 70}, // Cambria</span>
<a name="l00407"></a>00407 <span class="comment">      { 45, 40}, // San Mona</span>
<a name="l00408"></a>00408 <span class="comment">      { 55, 90}, // Estoni</span>
<a name="l00409"></a>00409 <span class="comment">      { 35,110}, // Orta</span>
<a name="l00410"></a>00410 <span class="comment">      {110,120}, // Balime</span>
<a name="l00411"></a>00411 <span class="comment">      { 45,150}, // Meduna</span>
<a name="l00412"></a>00412 <span class="comment">      { 15, 20}, // Chitzena</span>
<a name="l00413"></a>00413 <span class="comment">};</span>
<a name="l00414"></a>00414 <span class="comment">*/</span>
<a name="l00415"></a>00415 
<a name="l00416"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#a20225c9d218e76d1bc7f9047353c5a4">00416</a> <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#a20225c9d218e76d1bc7f9047353c5a4">gpSamSectorX</a>[] = { SAM_1_X, SAM_2_X, SAM_3_X, SAM_4_X };
<a name="l00417"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#d306da49d3e48410b554619c8ab0e1bf">00417</a> <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#d306da49d3e48410b554619c8ab0e1bf">gpSamSectorY</a>[] = { SAM_1_Y, SAM_2_Y, SAM_3_Y, SAM_4_Y };
<a name="l00418"></a>00418 
<a name="l00419"></a>00419 
<a name="l00420"></a>00420 <span class="comment">// WANNE 2 (reinitialization in "DrawMap()")</span>
<a name="l00421"></a>00421 <span class="comment">// map region</span>
<a name="l00422"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#7a5ec290dc3b07a397fd9ddb6ead8fec">00422</a> <a class="code" href="structSGPRect.html">SGPRect</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7a5ec290dc3b07a397fd9ddb6ead8fec">MapScreenRect</a>={ (MAP_VIEW_START_X+MAP_GRID_X - 2),  ( MAP_VIEW_START_Y+MAP_GRID_Y - 1), MAP_VIEW_START_X + MAP_VIEW_WIDTH - 1 + MAP_GRID_X , MAP_VIEW_START_Y+MAP_VIEW_HEIGHT-10+MAP_GRID_Y};
<a name="l00423"></a>00423 
<a name="l00424"></a>00424 <span class="keyword">extern</span> <a class="code" href="structSGPRect.html">SGPRect</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#8918d6ef1961cb144a003e025edaa088">gOldClipRect</a>; <span class="comment">// symbol already declared globally in renderworld.cpp (jonathanl)</span>
<a name="l00425"></a>00425 
<a name="l00426"></a>00426 <span class="comment">// screen region</span>
<a name="l00427"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#abadb4e34b064bd8cf0cfe60f03839c4">00427</a> <a class="code" href="structSGPRect.html">SGPRect</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#abadb4e34b064bd8cf0cfe60f03839c4">FullScreenRect</a>;<span class="comment">//={ 0, 0, 1024, 768 };</span>
<a name="l00428"></a>00428 
<a name="l00429"></a>00429 <span class="comment">// temp helicopter path</span>
<a name="l00430"></a><a class="code" href="mapscreen_8cpp.html#1bf007b81a4981f019caede54e60371c">00430</a> <a class="code" href="structpath.html">PathStPtr</a> <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#1bf007b81a4981f019caede54e60371c">pTempHelicopterPath</a> = NULL;
<a name="l00431"></a>00431 
<a name="l00432"></a>00432 <span class="comment">// character temp path</span>
<a name="l00433"></a><a class="code" href="mapscreen_8cpp.html#3bebb27fa8f12a6c894c0d4db60ae52f">00433</a> <a class="code" href="structpath.html">PathStPtr</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#3bebb27fa8f12a6c894c0d4db60ae52f">pTempCharacterPath</a> = NULL;
<a name="l00434"></a>00434 
<a name="l00435"></a>00435 <span class="comment">// draw temp path?</span>
<a name="l00436"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#f961d76541dbc0eb36d42c770bb1dd2f">00436</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#f961d76541dbc0eb36d42c770bb1dd2f">fDrawTempHeliPath</a> = FALSE;
<a name="l00437"></a>00437 
<a name="l00438"></a>00438 <span class="comment">// the map arrows graphics</span>
<a name="l00439"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#13645a6fb711d57c89346f6c66c4c577">00439</a> <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#13645a6fb711d57c89346f6c66c4c577">guiMAPCURSORS</a>;
<a name="l00440"></a>00440 
<a name="l00441"></a>00441 <span class="comment">// destination plotting character</span>
<a name="l00442"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#7b23b61dd5c051243baedf1bb9df7774">00442</a> <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7b23b61dd5c051243baedf1bb9df7774">bSelectedDestChar</a> = -1;
<a name="l00443"></a>00443 
<a name="l00444"></a>00444 <span class="comment">// assignment selection character</span>
<a name="l00445"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#6b0a1907e6c3fd22875ac11e966e7803">00445</a> <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#6b0a1907e6c3fd22875ac11e966e7803">bSelectedAssignChar</a>=-1;
<a name="l00446"></a>00446 
<a name="l00447"></a>00447 <span class="comment">// current contract char</span>
<a name="l00448"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#100f9ed327d6a95fe616a2f0308822b7">00448</a> <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#100f9ed327d6a95fe616a2f0308822b7">bSelectedContractChar</a> = -1;
<a name="l00449"></a>00449 
<a name="l00450"></a>00450 
<a name="l00451"></a>00451 <span class="comment">// has the temp path for character or helicopter been already drawn?</span>
<a name="l00452"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#5e2086b4616df4222511a7c45e8ffc42">00452</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a>   <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#5e2086b4616df4222511a7c45e8ffc42">fTempPathAlreadyDrawn</a> = FALSE;
<a name="l00453"></a>00453 
<a name="l00454"></a>00454 <span class="comment">// the regions for the mapscreen militia box</span>
<a name="l00455"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#3450c03633f52ecf89373f66563ec030">00455</a> <a class="code" href="struct__MOUSE__REGION.html">MOUSE_REGION</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#3450c03633f52ecf89373f66563ec030">gMapScreenMilitiaBoxRegions</a>[ 9 ];
<a name="l00456"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#f11ea52e0361d20d23c534f242b91155">00456</a> <a class="code" href="struct__MOUSE__REGION.html">MOUSE_REGION</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#f11ea52e0361d20d23c534f242b91155">gMapScreenMilitiaRegion</a>;
<a name="l00457"></a>00457 
<a name="l00458"></a>00458 <span class="comment">// the mine icon</span>
<a name="l00459"></a><a class="code" href="mapscreen_8cpp.html#f616e826d2f40cbe86680cfa14f9e82a">00459</a> <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#f616e826d2f40cbe86680cfa14f9e82a">guiMINEICON</a>;
<a name="l00460"></a>00460 
<a name="l00461"></a>00461 <span class="comment">// militia graphics</span>
<a name="l00462"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#dfe6a9ceaeceac0ea98a35881f42ad74">00462</a> <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#dfe6a9ceaeceac0ea98a35881f42ad74">guiMilitia</a>;
<a name="l00463"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#19267431b45f7347462c3b71490bf9ff">00463</a> <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#19267431b45f7347462c3b71490bf9ff">guiMilitiaMaps</a>;
<a name="l00464"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#be7e16fc73d9eae466a9ea48d96f0f77">00464</a> <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#be7e16fc73d9eae466a9ea48d96f0f77">guiMilitiaSectorHighLight</a>;
<a name="l00465"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#a1a2213403db401110d96d3d7900cc81">00465</a> <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#a1a2213403db401110d96d3d7900cc81">guiMilitiaSectorOutline</a>;
<a name="l00466"></a>00466 
<a name="l00467"></a>00467 <span class="comment">// the sector that is highlighted on the militia map</span>
<a name="l00468"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#9841424d54c5cba5a386f14dfd352b0e">00468</a> <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#9841424d54c5cba5a386f14dfd352b0e">sSectorMilitiaMapSector</a> = -1;
<a name="l00469"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b0091657e8418875491ae952d35663da">00469</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b0091657e8418875491ae952d35663da">fMilitiaMapButtonsCreated</a> = FALSE;
<a name="l00470"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e7bf8d79ef06ab596dc6b91ec970b2c1">00470</a> <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e7bf8d79ef06ab596dc6b91ec970b2c1">sSectorMilitiaMapSectorOutline</a> = -1;
<a name="l00471"></a>00471 
<a name="l00472"></a>00472 
<a name="l00473"></a>00473 <span class="comment">// have any nodes in the current path list been deleted?</span>
<a name="l00474"></a><a class="code" href="mapscreen_8cpp.html#f36110531c69293b183bd79d4fce0256">00474</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#f36110531c69293b183bd79d4fce0256">fDeletedNode</a> = FALSE;
<a name="l00475"></a>00475 
<a name="l00476"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#587db110241828c62da9ebbb33677d87">00476</a> <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#587db110241828c62da9ebbb33677d87">gusUndergroundNearBlack</a>;
<a name="l00477"></a>00477 
<a name="l00478"></a><a class="code" href="mapscreen_8cpp.html#109d718f50d6f84597cf9901b9e20242">00478</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#109d718f50d6f84597cf9901b9e20242">gfMilitiaPopupCreated</a> = FALSE;
<a name="l00479"></a>00479 
<a name="l00480"></a><a class="code" href="Timer_01Control_8cpp.html#e33da796490f5f2f772746c82c8a2176">00480</a> <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e33da796490f5f2f772746c82c8a2176">giAnimateRouteBaseTime</a> = 0;
<a name="l00481"></a><a class="code" href="Timer_01Control_8cpp.html#0963b9b8705cba0f9e56c996cf52a44b">00481</a> <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0963b9b8705cba0f9e56c996cf52a44b">giPotHeliPathBaseTime</a> = 0; 
<a name="l00482"></a><a class="code" href="Timer_01Control_8cpp.html#f0cd9f0595ce35bd8945ae8bb75a31d8">00482</a> <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#f0cd9f0595ce35bd8945ae8bb75a31d8">giClickHeliIconBaseTime</a> = 0;
<a name="l00483"></a>00483 
<a name="l00484"></a>00484 
<a name="l00485"></a>00485 <span class="comment">// display the level string on the strategic map</span>
<a name="l00486"></a>00486 <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#a2b814c619f3ece524ede8e4345c28a7">DisplayLevelString</a>( <span class="keywordtype">void</span> );
<a name="l00487"></a>00487 
<a name="l00488"></a>00488 <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#8316990a046445c67bbdc7d351ae33a9">ShowTownText</a>( <span class="keywordtype">void</span> );
<a name="l00489"></a>00489 <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#4e74128db10ca7b3e0cf9af622e446f6">DrawTownLabels</a>(<a class="code" href="Types_8h.html#94ebfccc6e846c28751f8d616371f1e5">STR16</a> pString, <a class="code" href="Types_8h.html#94ebfccc6e846c28751f8d616371f1e5">STR16</a> pStringA,<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usFirstX, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usFirstY);
<a name="l00490"></a>00490 <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#886bd9d4526e6eba9d06e2c6687a82a1">ShowTeamAndVehicles</a>(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> fShowFlags);
<a name="l00491"></a>00491 <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#dbe48d8d055a04e48e665b6bf75983ee">ShadeMapElem</a>( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapY, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iColor );
<a name="l00492"></a>00492 <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b6a70e847be4beefcc5b45646e0911c3">ShadeMapElemZoomIn</a>(<a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapY, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iColor );
<a name="l00493"></a>00493 <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7c675c4fd94f6b7b96fe25a2276415a7">AdjustXForLeftMapEdge</a>(<a class="code" href="Types_8h.html#94ebfccc6e846c28751f8d616371f1e5">STR16</a> wString, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> *psX);
<a name="l00494"></a>00494 <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#00b19b99ce614121bc7cfb2a004f9d55">BlitTownGridMarkers</a>( <span class="keywordtype">void</span> );
<a name="l00495"></a>00495 <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#f7a625019aa4617d9ce68647572f53e6">BlitMineGridMarkers</a>( <span class="keywordtype">void</span> );
<a name="l00496"></a>00496 <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0a4d9652b49354b91657e17b0426f111">BlitSAMGridMarkers</a>( <span class="keywordtype">void</span> );
<a name="l00497"></a>00497 <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#d3e9620d0e3ad12fb6b4db0a75b1206e">BlitMineIcon</a>( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapY );
<a name="l00498"></a>00498 <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e7e7077d1c9c2ff0bc8435d9301ca8c7">BlitMineText</a>( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapY );
<a name="l00499"></a>00499 <span class="keyword">extern</span> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#971769935bf4d1457725681025c131be">GetMouseMapXY</a>( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> *psMapWorldX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> *psMapWorldY );
<a name="l00500"></a>00500 <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#a7689a7ef7f9d17f36e83a8fc26b85c2">GetBaseSectorForCurrentTown</a>( <span class="keywordtype">void</span> );
<a name="l00501"></a>00501 <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ccf4a7b0095e340410e688a9805c5fd9">RenderIconsPerSectorForSelectedTown</a>( <span class="keywordtype">void</span> );
<a name="l00502"></a>00502 <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#d936244f7cd28e5959c3e1f82dfe8a6c">MilitiaRegionClickCallback</a>( <a class="code" href="struct__MOUSE__REGION.html">MOUSE_REGION</a> *pRegion, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iReason );
<a name="l00503"></a>00503 <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#9fc95eafdd53f3b67ba7cb789156f39f">MilitiaRegionMoveCallback</a>( <a class="code" href="struct__MOUSE__REGION.html">MOUSE_REGION</a> *pRegion, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iReason );
<a name="l00504"></a>00504 <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#2c4a43b594c211ffa08286cd50306fb2">CreateDestroyMilitiaSectorButtons</a>( <span class="keywordtype">void</span> );
<a name="l00505"></a>00505 <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#2daeb6639903fdcb896ee82f5df50473">ShowHighLightedSectorOnMilitiaMap</a>( <span class="keywordtype">void</span> );
<a name="l00506"></a>00506 <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#187439bdf35f1202e2c721e7240ab819">SetMilitiaMapButtonsText</a>( <span class="keywordtype">void</span> );
<a name="l00507"></a>00507 <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#be1dab9adfc72e6438fef0cd0d1d68f5">MilitiaButtonCallback</a>(<a class="code" href="struct__GUI__BUTTON.html">GUI_BUTTON</a> *btn,<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> reason);
<a name="l00508"></a>00508 <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#cf54f85153bfbb83365f08465484a702">DisplayUnallocatedMilitia</a>( <span class="keywordtype">void</span> );
<a name="l00509"></a>00509 <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#a6ff6435079dbd77d403864af9a069bc">IsThisMilitiaTownSectorAllowable</a>( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorIndexValue );
<a name="l00510"></a>00510 <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e947c35884afc3a01fb737dc7291e41b">DrawTownMilitiaName</a>( <span class="keywordtype">void</span> );
<a name="l00511"></a>00511 <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#c5b8184ec37de9c65012853728622cb7">HandleShutDownOfMilitiaPanelIfPeopleOnTheCursor</a>( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sTownValue );
<a name="l00512"></a>00512 <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#10885d60a1b859f702b95ee85dc2b441">HandleEveningOutOfTroopsAmongstSectors</a>( <span class="keywordtype">void</span> );
<a name="l00513"></a>00513 <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#f720e46467f59ba82cd575765ad81055">CreateMilitiaPanelBottomButton</a>( <span class="keywordtype">void</span> );
<a name="l00514"></a>00514 <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#4b30437270bc543b63a323145dd2b39c">DeleteMilitiaPanelBottomButton</a>( <span class="keywordtype">void</span> );
<a name="l00515"></a>00515 <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#58fdab56ecd9c6576936d0cf82f97a07">MilitiaDoneButtonCallback</a>(<a class="code" href="struct__GUI__BUTTON.html">GUI_BUTTON</a> *btn,<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> reason);
<a name="l00516"></a>00516 <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#bc393ba4bb6b98212e5c9c92cbe4f443">MilitiaAutoButtonCallback</a>(<a class="code" href="struct__GUI__BUTTON.html">GUI_BUTTON</a> *btn,<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> reason);
<a name="l00517"></a>00517 <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e13c65bca2c5d267ac0f557b5b8df1fe">RenderShadingForUnControlledSectors</a>( <span class="keywordtype">void</span> );
<a name="l00518"></a>00518 <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#d4aecba4696481aa3afebddd71da8db0">DrawTownMilitiaForcesOnMap</a>( <span class="keywordtype">void</span> );
<a name="l00519"></a>00519 <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#78743cd898c9f4452998f8dde7e19777">CheckAndUpdateStatesOfSelectedMilitiaSectorButtons</a>( <span class="keywordtype">void</span> );
<a name="l00520"></a>00520 <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#c6bca49e1a9be3a6ea99446e1b26fb9e">HandleLowerLevelMapBlit</a>( <span class="keywordtype">void</span> );
<a name="l00521"></a>00521 <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0df6cbd01ba47dadf43d4a78f6895666">ShowSAMSitesOnStrategicMap</a>( <span class="keywordtype">void</span> );
<a name="l00522"></a>00522 
<a name="l00523"></a>00523 <span class="comment">//UINT8 NumActiveCharactersInSector( INT16 sSectorX, INT16 sSectorY, INT16 bSectorZ );</span>
<a name="l00524"></a>00524 <span class="comment">//UINT8 NumFriendlyInSector( INT16 sX, INT16 sY, INT8 bZ );</span>
<a name="l00525"></a>00525 
<a name="l00526"></a>00526 <span class="comment">// callbacks</span>
<a name="l00527"></a>00527 <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#5abdab4c1c0db77e2ad4b702561480a6">MilitiaBoxMaskBtnCallback</a>(<a class="code" href="struct__MOUSE__REGION.html">MOUSE_REGION</a> * pRegion, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iReason );
<a name="l00528"></a>00528 
<a name="l00529"></a>00529 <span class="comment">// display potential path, yes or no?</span>
<a name="l00530"></a>00530 <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e3291997697659d40693911e10c1f573">DisplayThePotentialPathForHelicopter</a>(<a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapY );
<a name="l00531"></a>00531 <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#9b56312b0b61092011c732d22a4c1e3f">ShowEnemiesInSector</a>( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorY, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sNumberOfEnemies, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubIconPosition );
<a name="l00532"></a>00532 <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#8678bb495f91e6f5eda20160f6b046da">ShowUncertainNumberEnemiesInSector</a>( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorY );
<a name="l00533"></a>00533 <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#498fe80d6c2f11f8c084a096628f93f0">HandleShowingOfEnemyForcesInSector</a>( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorY, <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bSectorZ, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubIconPosition );
<a name="l00534"></a>00534 
<a name="l00535"></a>00535 <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#6d3ca0774ff9c5425be15af74db4e805">CanMilitiaAutoDistribute</a>( <span class="keywordtype">void</span> );
<a name="l00536"></a>00536 
<a name="l00537"></a>00537 <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#8d3280f0d547793d50fc051c2787e7de">ShowItemsOnMap</a>( <span class="keywordtype">void</span> );
<a name="l00538"></a>00538 <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b7bcc7ea4b4fc2491bcda5e7eb7e0bc9">DrawMapBoxIcon</a>( <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hIconHandle, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usVOIndex, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapY, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubIconPosition );
<a name="l00539"></a>00539 <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#a42eaa645063f0f2c61352f20ae8f77d">DisplayDestinationOfHelicopter</a>( <span class="keywordtype">void</span> );
<a name="l00540"></a>00540 <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#66d7180eb8fe0dc7fd912491a8f199e5">DrawOrta</a>();
<a name="l00541"></a>00541 <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e50442e5f151eddeb3e8d754d3c8fdb1">DrawTixa</a>();
<a name="l00542"></a>00542 <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b6ed1a16108070185eaf479ab634e5e6">DrawBullseye</a>();
<a name="l00543"></a>00543 <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0aec610d7bdd806285e04c5cf47bae19">HideExistenceOfUndergroundMapSector</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubSectorX, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubSectorY );
<a name="l00544"></a>00544 
<a name="l00545"></a>00545 <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#5927e6105f3b94cf1573f7a72bd9cde1">CanMercsScoutThisSector</a>( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorY, <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bSectorZ );
<a name="l00546"></a>00546 
<a name="l00547"></a>00547 <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#d1179fa3da325027bc0abc6339952331">TraceCharAnimatedRoute</a>( <a class="code" href="structpath.html">PathStPtr</a> pPath, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fCheckFlag, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fForceUpDate );
<a name="l00548"></a>00548 <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#4eb532f1b75cafca5770083d34a84690">AnimateRoute</a>( <a class="code" href="structpath.html">PathStPtr</a> pPath );
<a name="l00549"></a>00549 
<a name="l00550"></a>00550 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#55439cd851632864056aa80626de1855">EndConfirmMapMoveMode</a>( <span class="keywordtype">void</span> );
<a name="l00551"></a>00551 <span class="keyword">extern</span> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7b8656f83a80fcb6ad0d88c3260a6089">CanDrawSectorCursor</a>( <span class="keywordtype">void</span> );
<a name="l00552"></a>00552 
<a name="l00553"></a>00553 
<a name="l00554"></a>00554 
<a name="l00555"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#2456aff2aa893b4d9047861e0b0fefdf">00555</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#2456aff2aa893b4d9047861e0b0fefdf">DrawMapIndexBigMap</a>( <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fSelectedCursorIsYellow )
<a name="l00556"></a>00556 {
<a name="l00557"></a>00557       <span class="comment">// this procedure will draw the coord indexes on the zoomed out map</span>
<a name="l00558"></a>00558       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> usX, usY;
<a name="l00559"></a>00559       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iCount=0;
<a name="l00560"></a>00560       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fDrawCursors;
<a name="l00561"></a>00561 
<a name="l00562"></a>00562 
<a name="l00563"></a>00563       <a class="code" href="Font_8cpp.html#a038a1dc2edfc9f9c0766a0cbde2f440">SetFontDestBuffer</a>( FRAME_BUFFER, 0, 0, <a class="code" href="local_8h.html#599adbe412c60e0cc5abb86be7ee4507">SCREEN_WIDTH</a>, <a class="code" href="local_8h.html#f1c710caf1e3a9e81829078054e83799">SCREEN_HEIGHT</a>, FALSE );
<a name="l00564"></a>00564   <span class="comment">//SetFontColors(FONT_FCOLOR_GREEN) </span>
<a name="l00565"></a>00565   <a class="code" href="Font_8cpp.html#fa4871009f0473cca0380217753947dc">SetFont</a>(MAP_FONT);
<a name="l00566"></a>00566   <a class="code" href="Font_8cpp.html#388be5810478c3f3bdb861f144085d70">SetFontForeground</a>(MAP_INDEX_COLOR);
<a name="l00567"></a>00567       <span class="comment">// Dk Red is 163</span>
<a name="l00568"></a>00568   <a class="code" href="Font_8cpp.html#a1fe8cc526be9e2c96b5dd66e348506f">SetFontBackground</a>(FONT_MCOLOR_BLACK);
<a name="l00569"></a>00569 
<a name="l00570"></a>00570       fDrawCursors = <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7b8656f83a80fcb6ad0d88c3260a6089">CanDrawSectorCursor</a>( );
<a name="l00571"></a>00571   
<a name="l00572"></a>00572       <span class="keywordflow">for</span>(iCount=1; iCount &lt;= MAX_VIEW_SECTORS; iCount++)
<a name="l00573"></a>00573       {
<a name="l00574"></a>00574        <span class="keywordflow">if</span>( fDrawCursors &amp;&amp; ( iCount == <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#db5e700c27f1673be3250fa875d4af87">sSelMapX</a> ) &amp;&amp; ( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7b23b61dd5c051243baedf1bb9df7774">bSelectedDestChar</a> == -1 ) &amp;&amp; ( <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#e98f4ed560608bb89adb4143e28a8e32">fPlotForHelicopter</a> == FALSE ) )
<a name="l00575"></a>00575             <a class="code" href="Font_8cpp.html#388be5810478c3f3bdb861f144085d70">SetFontForeground</a>( ( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ) ( fSelectedCursorIsYellow ? FONT_YELLOW : FONT_WHITE ) );
<a name="l00576"></a>00576    <span class="keywordflow">else</span> <span class="keywordflow">if</span>( fDrawCursors &amp;&amp; ( iCount == <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e4bfe351f810c0cb88ffc06f6eed4848">gsHighlightSectorX</a> ) )
<a name="l00577"></a>00577     <a class="code" href="Font_8cpp.html#388be5810478c3f3bdb861f144085d70">SetFontForeground</a>(FONT_WHITE);
<a name="l00578"></a>00578    <span class="keywordflow">else</span>
<a name="l00579"></a>00579     <a class="code" href="Font_8cpp.html#388be5810478c3f3bdb861f144085d70">SetFontForeground</a>(MAP_INDEX_COLOR);
<a name="l00580"></a>00580 
<a name="l00581"></a>00581        <a class="code" href="Font_8cpp.html#d08dcd11daa6a1189cb123dff18cd7c8">FindFontCenterCoordinates</a>(((<a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a>)(MAP_HORT_INDEX_X+( iCount - 1) *MAP_GRID_X)), MAP_HORT_INDEX_Y, MAP_GRID_X, MAP_HORT_HEIGHT, <a class="code" href="__DutchText_8cpp.html#d86869e013208f6bd21a695e07a8e2e7">pMapHortIndex</a>[iCount], MAP_FONT, &amp;usX, &amp;usY);
<a name="l00582"></a>00582        <a class="code" href="Font_8cpp.html#b3e12cf19a0ca58abf6689cc8eca3ead">mprintf</a>(usX,usY,<a class="code" href="__DutchText_8cpp.html#d86869e013208f6bd21a695e07a8e2e7">pMapHortIndex</a>[iCount]);
<a name="l00583"></a>00583    
<a name="l00584"></a>00584        <span class="keywordflow">if</span>( fDrawCursors &amp;&amp; ( iCount == <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b4658c32a43a079f3804a635a62b2067">sSelMapY</a>) &amp;&amp; ( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7b23b61dd5c051243baedf1bb9df7774">bSelectedDestChar</a> == -1 ) &amp;&amp; ( <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#e98f4ed560608bb89adb4143e28a8e32">fPlotForHelicopter</a> == FALSE ) )
<a name="l00585"></a>00585             <a class="code" href="Font_8cpp.html#388be5810478c3f3bdb861f144085d70">SetFontForeground</a>( ( UINT8 ) ( fSelectedCursorIsYellow ? FONT_YELLOW : FONT_WHITE ) );
<a name="l00586"></a>00586    <span class="keywordflow">else</span> <span class="keywordflow">if</span>( fDrawCursors &amp;&amp; ( iCount == <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0bc4633a93cb4ce8b1bdb6b077fc60b1">gsHighlightSectorY</a> ) )
<a name="l00587"></a>00587     <a class="code" href="Font_8cpp.html#388be5810478c3f3bdb861f144085d70">SetFontForeground</a>(FONT_WHITE);
<a name="l00588"></a>00588    <span class="keywordflow">else</span>
<a name="l00589"></a>00589     <a class="code" href="Font_8cpp.html#388be5810478c3f3bdb861f144085d70">SetFontForeground</a>(MAP_INDEX_COLOR);
<a name="l00590"></a>00590 
<a name="l00591"></a>00591        <a class="code" href="Font_8cpp.html#d08dcd11daa6a1189cb123dff18cd7c8">FindFontCenterCoordinates</a>(MAP_VERT_INDEX_X, ((<a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a>)(MAP_VERT_INDEX_Y+ ( iCount - 1) *MAP_GRID_Y)), MAP_HORT_HEIGHT, MAP_GRID_Y, <a class="code" href="__DutchText_8cpp.html#79cd66e54092ecaa0b4198c57ff0cc18">pMapVertIndex</a>[iCount], MAP_FONT, &amp;usX, &amp;usY);
<a name="l00592"></a>00592        <a class="code" href="Font_8cpp.html#b3e12cf19a0ca58abf6689cc8eca3ead">mprintf</a>(usX,usY,<a class="code" href="__DutchText_8cpp.html#79cd66e54092ecaa0b4198c57ff0cc18">pMapVertIndex</a>[iCount]);
<a name="l00593"></a>00593       }
<a name="l00594"></a>00594 
<a name="l00595"></a>00595   <a class="code" href="video_8cpp.html#4ed7790da612ff97bf9c05cf186823bc">InvalidateRegion</a>(MAP_VERT_INDEX_X, MAP_VERT_INDEX_Y,MAP_VERT_INDEX_X+MAP_HORT_HEIGHT,  MAP_VERT_INDEX_Y+( iCount - 1 ) * MAP_GRID_Y );
<a name="l00596"></a>00596   <a class="code" href="video_8cpp.html#4ed7790da612ff97bf9c05cf186823bc">InvalidateRegion</a>(MAP_HORT_INDEX_X, MAP_HORT_INDEX_Y,MAP_HORT_INDEX_X + ( iCount - 1) * MAP_GRID_X,  MAP_HORT_INDEX_Y+ MAP_HORT_HEIGHT);
<a name="l00597"></a>00597 
<a name="l00598"></a>00598       <a class="code" href="Font_8cpp.html#a038a1dc2edfc9f9c0766a0cbde2f440">SetFontDestBuffer</a>( FRAME_BUFFER, 0, 0, <a class="code" href="local_8h.html#599adbe412c60e0cc5abb86be7ee4507">SCREEN_WIDTH</a>, <a class="code" href="local_8h.html#f1c710caf1e3a9e81829078054e83799">SCREEN_HEIGHT</a>, FALSE );
<a name="l00599"></a>00599 }
<a name="l00600"></a>00600 
<a name="l00601"></a>00601 
<a name="l00602"></a>00602 <span class="comment">/*</span>
<a name="l00603"></a>00603 <span class="comment">void DrawMapIndexSmallMap( BOOLEAN fSelectedCursorIsYellow )</span>
<a name="l00604"></a>00604 <span class="comment">{</span>
<a name="l00605"></a>00605 <span class="comment">      // this procedure will draw the coord indexes on the zoomed in map</span>
<a name="l00606"></a>00606 <span class="comment">      INT16 usX, usY;</span>
<a name="l00607"></a>00607 <span class="comment">      INT32 iCount=0;</span>
<a name="l00608"></a>00608 <span class="comment">      BOOLEAN fDrawCursors;</span>
<a name="l00609"></a>00609 <span class="comment"></span>
<a name="l00610"></a>00610 <span class="comment"></span>
<a name="l00611"></a>00611 <span class="comment">      SetFont(MAP_FONT);</span>
<a name="l00612"></a>00612 <span class="comment">      SetFontDestBuffer( FRAME_BUFFER, MAP_HORT_INDEX_X, MAP_HORT_INDEX_Y, MAP_HORT_INDEX_X+(MAX_VIEW_SECTORS)*MAP_GRID_X, MAP_HORT_INDEX_Y+MAP_GRID_Y, FALSE );</span>
<a name="l00613"></a>00613 <span class="comment">  //SetFontColors(FONT_FCOLOR_GREEN) </span>
<a name="l00614"></a>00614 <span class="comment">  SetFont(MAP_FONT);</span>
<a name="l00615"></a>00615 <span class="comment">  SetFontForeground(MAP_INDEX_COLOR);</span>
<a name="l00616"></a>00616 <span class="comment">  SetFontBackground(FONT_MCOLOR_BLACK);</span>
<a name="l00617"></a>00617 <span class="comment"></span>
<a name="l00618"></a>00618 <span class="comment">      fDrawCursors = CanDrawSectorCursor( );</span>
<a name="l00619"></a>00619 <span class="comment">  </span>
<a name="l00620"></a>00620 <span class="comment">      for(iCount=1; iCount &lt;= MAX_VIEW_SECTORS; iCount++)</span>
<a name="l00621"></a>00621 <span class="comment">      {</span>
<a name="l00622"></a>00622 <span class="comment">       if( fDrawCursors &amp;&amp; ( iCount == sSelMapX ) &amp;&amp; ( bSelectedDestChar == -1 ) &amp;&amp; ( fPlotForHelicopter == FALSE ) )</span>
<a name="l00623"></a>00623 <span class="comment">            SetFontForeground( ( UINT8 ) ( fSelectedCursorIsYellow ? FONT_YELLOW : FONT_WHITE ) );</span>
<a name="l00624"></a>00624 <span class="comment">   else if( fDrawCursors &amp;&amp; ( iCount == gsHighlightSectorX ) )</span>
<a name="l00625"></a>00625 <span class="comment">    SetFontForeground(FONT_WHITE);</span>
<a name="l00626"></a>00626 <span class="comment">   else</span>
<a name="l00627"></a>00627 <span class="comment">    SetFontForeground(MAP_INDEX_COLOR);</span>
<a name="l00628"></a>00628 <span class="comment"></span>
<a name="l00629"></a>00629 <span class="comment">   FindFontCenterCoordinates(((INT16)(MAP_HORT_INDEX_X+((iCount)*MAP_GRID_X)*2-iZoomX)), MAP_HORT_INDEX_Y, MAP_GRID_X*2, MAP_HORT_HEIGHT, pMapHortIndex[iCount], MAP_FONT, &amp;usX, &amp;usY);</span>
<a name="l00630"></a>00630 <span class="comment">       mprintf(usX,usY,pMapHortIndex[iCount]);</span>
<a name="l00631"></a>00631 <span class="comment">  }</span>
<a name="l00632"></a>00632 <span class="comment">      SetFontDestBuffer( FRAME_BUFFER, MAP_VERT_INDEX_X, MAP_VERT_INDEX_Y, MAP_VERT_INDEX_X+MAP_GRID_X, MAP_VERT_INDEX_Y+(MAX_VIEW_SECTORS)*MAP_GRID_Y, FALSE );</span>
<a name="l00633"></a>00633 <span class="comment">      </span>
<a name="l00634"></a>00634 <span class="comment">      for(iCount=1; iCount &lt;= MAX_VIEW_SECTORS; iCount++)</span>
<a name="l00635"></a>00635 <span class="comment">      {</span>
<a name="l00636"></a>00636 <span class="comment">       if( fDrawCursors &amp;&amp; ( iCount == sSelMapY) &amp;&amp; ( bSelectedDestChar == -1 ) &amp;&amp; ( fPlotForHelicopter == FALSE ) )</span>
<a name="l00637"></a>00637 <span class="comment">            SetFontForeground( ( UINT8 ) ( fSelectedCursorIsYellow ? FONT_YELLOW : FONT_WHITE ) );</span>
<a name="l00638"></a>00638 <span class="comment">   else if( fDrawCursors &amp;&amp; ( iCount == gsHighlightSectorY ) )</span>
<a name="l00639"></a>00639 <span class="comment">    SetFontForeground(FONT_WHITE);</span>
<a name="l00640"></a>00640 <span class="comment">   else</span>
<a name="l00641"></a>00641 <span class="comment">    SetFontForeground(MAP_INDEX_COLOR);</span>
<a name="l00642"></a>00642 <span class="comment"></span>
<a name="l00643"></a>00643 <span class="comment">       FindFontCenterCoordinates(MAP_VERT_INDEX_X, ((INT16)(MAP_VERT_INDEX_Y+(iCount*MAP_GRID_Y)*2-iZoomY)), MAP_HORT_HEIGHT, MAP_GRID_Y*2, pMapVertIndex[iCount], MAP_FONT, &amp;usX, &amp;usY);</span>
<a name="l00644"></a>00644 <span class="comment">       mprintf(usX,usY,pMapVertIndex[iCount]);</span>
<a name="l00645"></a>00645 <span class="comment">      }</span>
<a name="l00646"></a>00646 <span class="comment"></span>
<a name="l00647"></a>00647 <span class="comment">  InvalidateRegion(MAP_VERT_INDEX_X, MAP_VERT_INDEX_Y,MAP_VERT_INDEX_X+MAP_HORT_HEIGHT,  MAP_VERT_INDEX_Y+iCount*MAP_GRID_Y );</span>
<a name="l00648"></a>00648 <span class="comment">  InvalidateRegion(MAP_HORT_INDEX_X, MAP_HORT_INDEX_Y,MAP_HORT_INDEX_X+iCount*MAP_GRID_X,  MAP_HORT_INDEX_Y+ MAP_HORT_HEIGHT);</span>
<a name="l00649"></a>00649 <span class="comment">  SetFontDestBuffer( FRAME_BUFFER, 0, 0, 640, 480, FALSE );</span>
<a name="l00650"></a>00650 <span class="comment">}</span>
<a name="l00651"></a>00651 <span class="comment">*/</span>
<a name="l00652"></a>00652 
<a name="l00653"></a>00653 
<a name="l00654"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#f5f6b0479cac3eb958505c43b5da6774">00654</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#f5f6b0479cac3eb958505c43b5da6774">HandleShowingOfEnemiesWithMilitiaOn</a>( <span class="keywordtype">void</span> )
<a name="l00655"></a>00655 {
<a name="l00656"></a>00656       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sX = 0, sY = 0;
<a name="l00657"></a>00657 
<a name="l00658"></a>00658       <span class="comment">// if show militia flag is false, leave</span>
<a name="l00659"></a>00659       <span class="keywordflow">if</span>( !<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#046cad083db131ea9be5f91417b1f13e">fShowMilitia</a> )
<a name="l00660"></a>00660       {
<a name="l00661"></a>00661             <span class="keywordflow">return</span>;
<a name="l00662"></a>00662       }
<a name="l00663"></a>00663 
<a name="l00664"></a>00664       <span class="keywordflow">for</span>( sX = 1; sX &lt; ( MAP_WORLD_X - 1 ); sX++ )
<a name="l00665"></a>00665       {
<a name="l00666"></a>00666             <span class="keywordflow">for</span>( sY = 1; sY &lt; ( MAP_WORLD_Y - 1); sY++ )
<a name="l00667"></a>00667             {
<a name="l00668"></a>00668                   <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#498fe80d6c2f11f8c084a096628f93f0">HandleShowingOfEnemyForcesInSector</a>( sX, sY, ( <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> )<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b52d71b8f7dc10a22568eb52e0c51a3e">iCurrentMapSectorZ</a>, <a class="code" href="Town_01Militia_8cpp.html#d5f4d1a7e2d1489b786239270acbdda1">CountAllMilitiaInSector</a>( sX, sY ) );
<a name="l00669"></a>00669             }
<a name="l00670"></a>00670       }
<a name="l00671"></a>00671 
<a name="l00672"></a>00672       <span class="keywordflow">return</span>;
<a name="l00673"></a>00673 }
<a name="l00674"></a>00674 
<a name="l00675"></a>00675 
<a name="l00676"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#67033f3b52bc82d7f30da47d3e8a5cd0">00676</a> <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#67033f3b52bc82d7f30da47d3e8a5cd0">DrawMap</a>( <span class="keywordtype">void</span> )
<a name="l00677"></a>00677 {
<a name="l00678"></a>00678   <a class="code" href="structSGPVSurface.html">HVSURFACE</a> hSrcVSurface;
<a name="l00679"></a>00679   <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES;
<a name="l00680"></a>00680       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiSrcPitchBYTES;
<a name="l00681"></a>00681   <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>  *pDestBuf;
<a name="l00682"></a>00682       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *pSrcBuf;
<a name="l00683"></a>00683       <a class="code" href="structSGPRect.html">SGPRect</a> clip;
<a name="l00684"></a>00684   <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> cnt, cnt2;
<a name="l00685"></a>00685       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iCounter = 0;
<a name="l00686"></a>00686 
<a name="l00687"></a>00687       <span class="comment">// WANNE 2 &lt;initialization&gt;</span>
<a name="l00688"></a>00688       <span class="comment">//MAP_VIEW_START_X = (SCREEN_WIDTH - 370);</span>
<a name="l00689"></a>00689       <span class="comment">//MAP_VIEW_START_Y = 10;</span>
<a name="l00690"></a>00690 
<a name="l00691"></a>00691       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7a5ec290dc3b07a397fd9ddb6ead8fec">MapScreenRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a> = MAP_VIEW_START_X+MAP_GRID_X - 2;
<a name="l00692"></a>00692       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7a5ec290dc3b07a397fd9ddb6ead8fec">MapScreenRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a> = MAP_VIEW_START_Y+MAP_GRID_Y - 1;
<a name="l00693"></a>00693       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7a5ec290dc3b07a397fd9ddb6ead8fec">MapScreenRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a> = MAP_VIEW_START_X + MAP_VIEW_WIDTH - 1 + MAP_GRID_X;
<a name="l00694"></a>00694       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7a5ec290dc3b07a397fd9ddb6ead8fec">MapScreenRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a> = MAP_VIEW_START_Y+MAP_VIEW_HEIGHT-10+MAP_GRID_Y;
<a name="l00695"></a>00695 
<a name="l00696"></a>00696       <span class="comment">//MapScreenRect={ (MAP_VIEW_START_X+MAP_GRID_X - 2),  ( MAP_VIEW_START_Y+MAP_GRID_Y - 1), MAP_VIEW_START_X + MAP_VIEW_WIDTH - 1 + MAP_GRID_X , MAP_VIEW_START_Y+MAP_VIEW_HEIGHT-10+MAP_GRID_Y};</span>
<a name="l00697"></a>00697 
<a name="l00698"></a>00698       <span class="keywordflow">if</span>( !<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b52d71b8f7dc10a22568eb52e0c51a3e">iCurrentMapSectorZ</a> )
<a name="l00699"></a>00699       {
<a name="l00700"></a>00700             pDestBuf = (<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>*)<a class="code" href="vsurface_8cpp.html#592b2aeda6075fcbf9d7c67dc44fbd47">LockVideoSurface</a>( <a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a>, &amp;uiDestPitchBYTES);
<a name="l00701"></a>00701 
<a name="l00702"></a>00702             CHECKF( <a class="code" href="vsurface_8cpp.html#9195038a1c569f87837c90c52cd81124">GetVideoSurface</a>( &amp;hSrcVSurface, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ce38015bdf56dde3a7dda1e75e9f4be6">guiBIGMAP</a>) );
<a name="l00703"></a>00703             pSrcBuf = <a class="code" href="vsurface_8cpp.html#592b2aeda6075fcbf9d7c67dc44fbd47">LockVideoSurface</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ce38015bdf56dde3a7dda1e75e9f4be6">guiBIGMAP</a>, &amp;uiSrcPitchBYTES);
<a name="l00704"></a>00704 
<a name="l00705"></a>00705             <span class="comment">// clip blits to mapscreen region</span>
<a name="l00706"></a>00706             <span class="comment">//ClipBlitsToMapViewRegion( );</span>
<a name="l00707"></a>00707             
<a name="l00708"></a>00708             <span class="keywordflow">if</span> (<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l00709"></a>00709             {
<a name="l00710"></a>00710                   <span class="comment">// set up bounds</span>
<a name="l00711"></a>00711                   <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#fa3ac40b83d55b2124d79820fa45974c">iZoomX</a> &lt; WEST_ZOOM_BOUND)
<a name="l00712"></a>00712                         <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#fa3ac40b83d55b2124d79820fa45974c">iZoomX</a>=WEST_ZOOM_BOUND;
<a name="l00713"></a>00713                   <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#fa3ac40b83d55b2124d79820fa45974c">iZoomX</a> &gt; EAST_ZOOM_BOUND)
<a name="l00714"></a>00714                         <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#fa3ac40b83d55b2124d79820fa45974c">iZoomX</a>=EAST_ZOOM_BOUND;
<a name="l00715"></a>00715                   <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#bca9577b78c819bc3429fe62f836704b">iZoomY</a> &lt; NORTH_ZOOM_BOUND+1)
<a name="l00716"></a>00716                         <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#bca9577b78c819bc3429fe62f836704b">iZoomY</a>=NORTH_ZOOM_BOUND;
<a name="l00717"></a>00717                   <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#bca9577b78c819bc3429fe62f836704b">iZoomY</a> &gt; SOUTH_ZOOM_BOUND)
<a name="l00718"></a>00718                         <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#bca9577b78c819bc3429fe62f836704b">iZoomY</a>=SOUTH_ZOOM_BOUND;
<a name="l00719"></a>00719 
<a name="l00720"></a>00720                   clip.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>=<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#fa3ac40b83d55b2124d79820fa45974c">iZoomX</a> - 2;
<a name="l00721"></a>00721                   clip.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>=clip.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a> + MAP_VIEW_WIDTH + 2;
<a name="l00722"></a>00722                   clip.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>=<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#bca9577b78c819bc3429fe62f836704b">iZoomY</a> - 3;
<a name="l00723"></a>00723                   clip.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>=clip.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a> + MAP_VIEW_HEIGHT - 1;
<a name="l00724"></a>00724                   
<a name="l00725"></a>00725                   <span class="comment">/*</span>
<a name="l00726"></a>00726 <span class="comment">                  clip.iLeft=clip.iLeft - 1;</span>
<a name="l00727"></a>00727 <span class="comment">                  clip.iRight=clip.iLeft + MapScreenRect.iRight - MapScreenRect.iLeft;</span>
<a name="l00728"></a>00728 <span class="comment">                  clip.iTop=iZoomY - 1;</span>
<a name="l00729"></a>00729 <span class="comment">                  clip.iBottom=clip.iTop + MapScreenRect.iBottom - MapScreenRect.iTop;</span>
<a name="l00730"></a>00730 <span class="comment">                  */</span>
<a name="l00731"></a>00731 
<a name="l00732"></a>00732                   <span class="keywordflow">if</span>( clip.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a> &gt; hSrcVSurface-&gt;<a class="code" href="structSGPVSurface.html#fc10a1ce49a8cefdb4e510d8b910eb0c">usHeight</a> )
<a name="l00733"></a>00733                   {
<a name="l00734"></a>00734                         clip.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a> = hSrcVSurface-&gt;<a class="code" href="structSGPVSurface.html#fc10a1ce49a8cefdb4e510d8b910eb0c">usHeight</a>;
<a name="l00735"></a>00735                   }
<a name="l00736"></a>00736 
<a name="l00737"></a>00737                   <span class="keywordflow">if</span>( clip.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a> &gt; hSrcVSurface-&gt;<a class="code" href="structSGPVSurface.html#95c7973670e82832e7047103d8b3d32a">usWidth</a> )
<a name="l00738"></a>00738                   {
<a name="l00739"></a>00739                         clip.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a> = hSrcVSurface-&gt;<a class="code" href="structSGPVSurface.html#95c7973670e82832e7047103d8b3d32a">usWidth</a>;
<a name="l00740"></a>00740                   }
<a name="l00741"></a>00741 
<a name="l00742"></a>00742                   <a class="code" href="vobject__blitters_8cpp.html#14adcdad104549501be4facd5b469438">Blt8BPPDataSubTo16BPPBuffer</a>( pDestBuf, uiDestPitchBYTES, hSrcVSurface, pSrcBuf,uiSrcPitchBYTES, MAP_VIEW_START_X+MAP_GRID_X, MAP_VIEW_START_Y+MAP_GRID_Y - 2, &amp;clip);
<a name="l00743"></a>00743             }
<a name="l00744"></a>00744             <span class="keywordflow">else</span>
<a name="l00745"></a>00745             {
<a name="l00746"></a>00746                   <a class="code" href="vobject__blitters_8cpp.html#238dbc533f272e61fe01fa327cb52d02">Blt8BPPDataTo16BPPBufferHalf</a>( pDestBuf, uiDestPitchBYTES, hSrcVSurface, pSrcBuf, uiSrcPitchBYTES, MAP_VIEW_START_X + 1, MAP_VIEW_START_Y );
<a name="l00747"></a>00747             }
<a name="l00748"></a>00748 
<a name="l00749"></a>00749             <a class="code" href="vsurface_8cpp.html#abe4e4124597b70b046a3b3567002cb2">UnLockVideoSurface</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ce38015bdf56dde3a7dda1e75e9f4be6">guiBIGMAP</a> );
<a name="l00750"></a>00750             <a class="code" href="vsurface_8cpp.html#abe4e4124597b70b046a3b3567002cb2">UnLockVideoSurface</a>( <a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a> );
<a name="l00751"></a>00751 
<a name="l00752"></a>00752 
<a name="l00753"></a>00753             <span class="comment">// shade map sectors (must be done after Tixa/Orta/Mine icons have been blitted, but before icons!)         </span>
<a name="l00754"></a>00754             <span class="keywordflow">for</span> ( cnt = 1; cnt &lt; MAP_WORLD_X - 1; cnt++ )
<a name="l00755"></a>00755             {
<a name="l00756"></a>00756                   <span class="keywordflow">for</span> ( cnt2 = 1; cnt2 &lt; MAP_WORLD_Y - 1; cnt2++ )
<a name="l00757"></a>00757                   {
<a name="l00758"></a>00758                         <span class="comment">// LATE DESIGN CHANGE: darken sectors not yet visited, instead of those under known enemy control</span>
<a name="l00759"></a>00759                         <span class="keywordflow">if</span>( <a class="code" href="Tactical_01Save_8cpp.html#3d497a7fd2468f74aec26360cb9018ea">GetSectorFlagStatus</a>( cnt, cnt2, ( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ) <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b52d71b8f7dc10a22568eb52e0c51a3e">iCurrentMapSectorZ</a>, SF_ALREADY_VISITED ) == FALSE )
<a name="l00760"></a>00760 <span class="comment">//                      if ( IsTheSectorPerceivedToBeUnderEnemyControl( cnt, cnt2, ( INT8 )( iCurrentMapSectorZ ) ) )</span>
<a name="l00761"></a>00761                         {
<a name="l00762"></a>00762                               <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3eb1c4052a5a9718b9b73c9851737930">fShowAircraftFlag</a> &amp;&amp; !iCurrentMapSectorZ )
<a name="l00763"></a>00763                               {
<a name="l00764"></a>00764                                     <span class="keywordflow">if</span>( !<a class="code" href="strategic_8cpp.html#6f48fb0ea28e3d4889423290f1a6ede8">StrategicMap</a>[ cnt + cnt2 * WORLD_MAP_X ].fEnemyAirControlled )
<a name="l00765"></a>00765                                     {
<a name="l00766"></a>00766                                           <span class="comment">// sector not visited, not air controlled</span>
<a name="l00767"></a>00767                                           <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#dbe48d8d055a04e48e665b6bf75983ee">ShadeMapElem</a>( cnt, cnt2, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#fb9b21dcb0b6eb4e9e0c9cb090e774beb1445a45b72eb4c89a753ad87a086710">MAP_SHADE_DK_GREEN</a> );
<a name="l00768"></a>00768                                     }
<a name="l00769"></a>00769                                     <span class="keywordflow">else</span>
<a name="l00770"></a>00770                                     {
<a name="l00771"></a>00771                                           <span class="comment">// sector not visited, controlled and air not</span>
<a name="l00772"></a>00772                                           <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#dbe48d8d055a04e48e665b6bf75983ee">ShadeMapElem</a>( cnt, cnt2, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#fb9b21dcb0b6eb4e9e0c9cb090e774bed86b7b23cdbc96fef4d6d71d6298423e">MAP_SHADE_DK_RED</a> );
<a name="l00773"></a>00773                                     }
<a name="l00774"></a>00774                               }
<a name="l00775"></a>00775                               <span class="keywordflow">else</span>
<a name="l00776"></a>00776                               {
<a name="l00777"></a>00777                                     <span class="comment">// not visited</span>
<a name="l00778"></a>00778                                     <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#dbe48d8d055a04e48e665b6bf75983ee">ShadeMapElem</a>( cnt, cnt2, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#fb9b21dcb0b6eb4e9e0c9cb090e774be0cc3c2e4f355e031d5e4c89638694188">MAP_SHADE_BLACK</a> );
<a name="l00779"></a>00779                               }
<a name="l00780"></a>00780                         }
<a name="l00781"></a>00781                         <span class="keywordflow">else</span>
<a name="l00782"></a>00782                         {
<a name="l00783"></a>00783                               <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3eb1c4052a5a9718b9b73c9851737930">fShowAircraftFlag</a> &amp;&amp; !iCurrentMapSectorZ )
<a name="l00784"></a>00784                               {
<a name="l00785"></a>00785                                     <span class="keywordflow">if</span>( !<a class="code" href="strategic_8cpp.html#6f48fb0ea28e3d4889423290f1a6ede8">StrategicMap</a>[ cnt + cnt2 * WORLD_MAP_X ].fEnemyAirControlled )
<a name="l00786"></a>00786                                     {
<a name="l00787"></a>00787                                           <span class="comment">// sector visited and air controlled</span>
<a name="l00788"></a>00788                                           <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#dbe48d8d055a04e48e665b6bf75983ee">ShadeMapElem</a>( cnt, cnt2, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#fb9b21dcb0b6eb4e9e0c9cb090e774bedbe0ec1c7d93e5c0aff724c3da00fa33">MAP_SHADE_LT_GREEN</a>);
<a name="l00789"></a>00789                                     }
<a name="l00790"></a>00790                                     <span class="keywordflow">else</span>
<a name="l00791"></a>00791                                     {
<a name="l00792"></a>00792                                           <span class="comment">// sector visited but not air controlled</span>
<a name="l00793"></a>00793                                           <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#dbe48d8d055a04e48e665b6bf75983ee">ShadeMapElem</a>( cnt, cnt2, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#fb9b21dcb0b6eb4e9e0c9cb090e774be4ca82572c21c49c5764317b5f6726911">MAP_SHADE_LT_RED</a> );
<a name="l00794"></a>00794                                     }
<a name="l00795"></a>00795                               }
<a name="l00796"></a>00796                         }
<a name="l00797"></a>00797                   }
<a name="l00798"></a>00798             }
<a name="l00799"></a>00799 
<a name="l00800"></a>00800 
<a name="l00801"></a>00801             <span class="comment">// UNFORTUNATELY, WE CAN'T SHADE THESE ICONS AS PART OF SHADING THE MAP, BECAUSE FOR AIRSPACE, THE SHADE FUNCTION</span>
<a name="l00802"></a>00802             <span class="comment">// DOESN'T MERELY SHADE THE EXISTING MAP SURFACE, BUT INSTEAD GRABS THE ORIGINAL GRAPHICS FROM BIGMAP, AND CHANGES</span>
<a name="l00803"></a>00803             <span class="comment">// THEIR PALETTE.  BLITTING ICONS PRIOR TO SHADING WOULD MEAN THEY DON'T SHOW UP IN AIRSPACE VIEW AT ALL.</span>
<a name="l00804"></a>00804 
<a name="l00805"></a>00805             <span class="comment">// if Orta found</span>
<a name="l00806"></a>00806             <span class="keywordflow">if</span>( <a class="code" href="strategicmap_8cpp.html#20549a2f36fdcba9495803c110584b47">fFoundOrta</a> )
<a name="l00807"></a>00807             {
<a name="l00808"></a>00808                   <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#66d7180eb8fe0dc7fd912491a8f199e5">DrawOrta</a>();
<a name="l00809"></a>00809             }
<a name="l00810"></a>00810 
<a name="l00811"></a>00811             <span class="comment">// if Tixa found</span>
<a name="l00812"></a>00812             <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e5d32ba931394430e60f65852d4e36e6">fFoundTixa</a> )
<a name="l00813"></a>00813             {
<a name="l00814"></a>00814                   <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e50442e5f151eddeb3e8d754d3c8fdb1">DrawTixa</a>();
<a name="l00815"></a>00815             }
<a name="l00816"></a>00816 
<a name="l00817"></a>00817             <span class="comment">// draw SAM sites</span>
<a name="l00818"></a>00818             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0df6cbd01ba47dadf43d4a78f6895666">ShowSAMSitesOnStrategicMap</a>( );
<a name="l00819"></a>00819 
<a name="l00820"></a>00820             <span class="comment">// draw mine icons</span>
<a name="l00821"></a>00821             <span class="keywordflow">for</span>( iCounter = 0; iCounter &lt; <a class="code" href="Strategic_01Mines_8h.html#a3dfb65ce3006aaab287357097352604c1e5d8fe484e44dd37bde096e12f2cf4">MAX_NUMBER_OF_MINES</a>; iCounter++ )
<a name="l00822"></a>00822             {
<a name="l00823"></a>00823                   <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#d3e9620d0e3ad12fb6b4db0a75b1206e">BlitMineIcon</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#2889e0746115b88002494be407bc5de4">gMineLocation</a>[ iCounter ].sSectorX, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#2889e0746115b88002494be407bc5de4">gMineLocation</a>[ iCounter ].sSectorY );
<a name="l00824"></a>00824             }
<a name="l00825"></a>00825 
<a name="l00826"></a>00826 
<a name="l00827"></a>00827             <span class="comment">// if mine details filter is set</span>
<a name="l00828"></a>00828             <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#6d825d0bf482e73daae1d7cc2c5670e2">fShowMineFlag</a> )
<a name="l00829"></a>00829             {
<a name="l00830"></a>00830                   <span class="comment">// show mine name/production text</span>
<a name="l00831"></a>00831                   <span class="keywordflow">for</span>( iCounter = 0; iCounter &lt; MAX_NUMBER_OF_MINES; iCounter++ )
<a name="l00832"></a>00832                   {
<a name="l00833"></a>00833                         <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e7e7077d1c9c2ff0bc8435d9301ca8c7">BlitMineText</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#2889e0746115b88002494be407bc5de4">gMineLocation</a>[ iCounter ].sSectorX, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#2889e0746115b88002494be407bc5de4">gMineLocation</a>[ iCounter ].sSectorY );
<a name="l00834"></a>00834                   }
<a name="l00835"></a>00835             }
<a name="l00836"></a>00836 
<a name="l00837"></a>00837             <span class="comment">// draw towns names &amp; loyalty ratings, and grey town limit borders</span>
<a name="l00838"></a>00838             <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#e585d0c72f01a22635de59e4c860e4e2">fShowTownFlag</a> )
<a name="l00839"></a>00839             {
<a name="l00840"></a>00840                   <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#00b19b99ce614121bc7cfb2a004f9d55">BlitTownGridMarkers</a>( );
<a name="l00841"></a>00841               <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#8316990a046445c67bbdc7d351ae33a9">ShowTownText</a>( );
<a name="l00842"></a>00842             }
<a name="l00843"></a>00843 
<a name="l00844"></a>00844             <span class="comment">// draw militia icons</span>
<a name="l00845"></a>00845             <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#046cad083db131ea9be5f91417b1f13e">fShowMilitia</a> )
<a name="l00846"></a>00846             {
<a name="l00847"></a>00847                   <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#d4aecba4696481aa3afebddd71da8db0">DrawTownMilitiaForcesOnMap</a>( );
<a name="l00848"></a>00848             }
<a name="l00849"></a>00849 
<a name="l00850"></a>00850             <span class="keywordflow">if</span> ( <a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3eb1c4052a5a9718b9b73c9851737930">fShowAircraftFlag</a> &amp;&amp; !<a class="code" href="mapscreen_8cpp.html#f24a6c84e7c6f57fe0808f76c0da11dd">gfInChangeArrivalSectorMode</a> )
<a name="l00851"></a>00851             {
<a name="l00852"></a>00852                   <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b6ed1a16108070185eaf479ab634e5e6">DrawBullseye</a>();
<a name="l00853"></a>00853             }
<a name="l00854"></a>00854       }
<a name="l00855"></a>00855       <span class="keywordflow">else</span>
<a name="l00856"></a>00856       {
<a name="l00857"></a>00857             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#c6bca49e1a9be3a6ea99446e1b26fb9e">HandleLowerLevelMapBlit</a>( );
<a name="l00858"></a>00858       }
<a name="l00859"></a>00859 
<a name="l00860"></a>00860 
<a name="l00861"></a>00861       <span class="comment">// show mine outlines even when viewing underground sublevels - they indicate where the mine entrances are</span>
<a name="l00862"></a>00862       <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#6d825d0bf482e73daae1d7cc2c5670e2">fShowMineFlag</a> )
<a name="l00863"></a>00863             <span class="comment">// draw grey mine sector borders</span>
<a name="l00864"></a>00864             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#f7a625019aa4617d9ce68647572f53e6">BlitMineGridMarkers</a>( );
<a name="l00865"></a>00865 
<a name="l00866"></a>00866 
<a name="l00867"></a>00867       <span class="comment">// do not show mercs/vehicles when airspace is ON</span>
<a name="l00868"></a>00868 <span class="comment">// commented out on a trial basis!</span>
<a name="l00869"></a>00869 <span class="comment">//    if( !fShowAircraftFlag )</span>
<a name="l00870"></a>00870       {
<a name="l00871"></a>00871             <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#0dee62e5b59baf54be405ab9e6eea568">fShowTeamFlag</a> )
<a name="l00872"></a>00872                   <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#886bd9d4526e6eba9d06e2c6687a82a1">ShowTeamAndVehicles</a>( SHOW_TEAMMATES | SHOW_VEHICLES );
<a name="l00873"></a>00873             <span class="keywordflow">else</span>
<a name="l00874"></a>00874                   <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#f5f6b0479cac3eb958505c43b5da6774">HandleShowingOfEnemiesWithMilitiaOn</a>( );
<a name="l00875"></a>00875 
<a name="l00876"></a>00876 <span class="comment">/*</span>
<a name="l00877"></a>00877 <span class="comment">            if((fShowTeamFlag)&amp;&amp;(fShowVehicleFlag))</span>
<a name="l00878"></a>00878 <span class="comment">             ShowTeamAndVehicles(SHOW_TEAMMATES | SHOW_VEHICLES);</span>
<a name="l00879"></a>00879 <span class="comment">            else if(fShowTeamFlag)</span>
<a name="l00880"></a>00880 <span class="comment">                  ShowTeamAndVehicles(SHOW_TEAMMATES);</span>
<a name="l00881"></a>00881 <span class="comment">            else if(fShowVehicleFlag)</span>
<a name="l00882"></a>00882 <span class="comment">                  ShowTeamAndVehicles(SHOW_VEHICLES);</span>
<a name="l00883"></a>00883 <span class="comment">            else</span>
<a name="l00884"></a>00884 <span class="comment">            {</span>
<a name="l00885"></a>00885 <span class="comment">                  HandleShowingOfEnemiesWithMilitiaOn( );</span>
<a name="l00886"></a>00886 <span class="comment">            }</span>
<a name="l00887"></a>00887 <span class="comment">*/</span>
<a name="l00888"></a>00888       }
<a name="l00889"></a>00889 
<a name="l00890"></a>00890       <span class="keywordflow">if</span> ( <a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#a155964241dde7969bbbba6b46b61316">fShowItemsFlag</a> )
<a name="l00891"></a>00891       {
<a name="l00892"></a>00892             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#8d3280f0d547793d50fc051c2787e7de">ShowItemsOnMap</a>();
<a name="l00893"></a>00893       }
<a name="l00894"></a>00894 
<a name="l00895"></a>00895       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#a2b814c619f3ece524ede8e4345c28a7">DisplayLevelString</a>( );
<a name="l00896"></a>00896 
<a name="l00897"></a>00897       <span class="comment">// WANNE 2 &lt;incommented&gt;</span>
<a name="l00898"></a>00898       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#1b9a9fa9699aebedd0c8b2cbd547a614">RestoreClipRegionToFullScreen</a>( );
<a name="l00899"></a>00899 
<a name="l00900"></a>00900       <span class="keywordflow">return</span>( TRUE );
<a name="l00901"></a>00901 }
<a name="l00902"></a>00902 
<a name="l00903"></a>00903 
<a name="l00904"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#917041ee85b8bfbe1a319c050e137073">00904</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#917041ee85b8bfbe1a319c050e137073">GetScreenXYFromMapXY</a>( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapY, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> *psX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> *psY )
<a name="l00905"></a>00905 {
<a name="l00906"></a>00906       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sXTempOff=1;
<a name="l00907"></a>00907       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sYTempOff=1;
<a name="l00908"></a>00908       <span class="keywordflow">if</span> (<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l00909"></a>00909       {
<a name="l00910"></a>00910             *psX = ( (sMapX/2+sXTempOff) * MAP_GRID_ZOOM_X ) + MAP_VIEW_START_X;
<a name="l00911"></a>00911             *psY = ( (sMapY/2+sYTempOff) * MAP_GRID_ZOOM_Y ) + MAP_VIEW_START_Y;
<a name="l00912"></a>00912   }
<a name="l00913"></a>00913       <span class="keywordflow">else</span>
<a name="l00914"></a>00914       {
<a name="l00915"></a>00915             *psX = ( sMapX * MAP_GRID_X ) + MAP_VIEW_START_X;
<a name="l00916"></a>00916             *psY = ( sMapY * MAP_GRID_Y ) + MAP_VIEW_START_Y;
<a name="l00917"></a>00917       } 
<a name="l00918"></a>00918 }
<a name="l00919"></a>00919 
<a name="l00920"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#61b609e8ae7546838d7b9b106d25ff3a">00920</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#61b609e8ae7546838d7b9b106d25ff3a">GetScreenXYFromMapXYStationary</a>( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapY, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> *psX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> *psY )
<a name="l00921"></a>00921 {
<a name="l00922"></a>00922       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sXTempOff=1;
<a name="l00923"></a>00923       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sYTempOff=1;
<a name="l00924"></a>00924    <span class="comment">//(MAP_VIEW_START_X+((iCount+1)*MAP_GRID_X)*2-iZoomX));</span>
<a name="l00925"></a>00925    *psX = ( (sMapX+sXTempOff) * MAP_GRID_X )*2-((<a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a>)<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#fa3ac40b83d55b2124d79820fa45974c">iZoomX</a>)+MAP_VIEW_START_X;
<a name="l00926"></a>00926    *psY = ( (sMapY+sYTempOff) * MAP_GRID_Y )*2-((<a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a>)<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#bca9577b78c819bc3429fe62f836704b">iZoomY</a>)+MAP_VIEW_START_Y;
<a name="l00927"></a>00927 
<a name="l00928"></a>00928 }
<a name="l00929"></a>00929 
<a name="l00930"></a>00930 
<a name="l00931"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#8316990a046445c67bbdc7d351ae33a9">00931</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#8316990a046445c67bbdc7d351ae33a9">ShowTownText</a>( <span class="keywordtype">void</span> )
<a name="l00932"></a>00932 {
<a name="l00933"></a>00933       <a class="code" href="Types_8h.html#fcdf88c1d4179fcd6d8a1fa9bbcb8a80">CHAR16</a> sString[ 32 ];
<a name="l00934"></a>00934       <a class="code" href="Types_8h.html#fcdf88c1d4179fcd6d8a1fa9bbcb8a80">CHAR16</a> sStringA[ 32 ];
<a name="l00935"></a>00935       <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bTown = 0;
<a name="l00936"></a>00936       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usX,usY;
<a name="l00937"></a>00937       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fLoyaltyTooLowToTrainMilitia;
<a name="l00938"></a>00938 
<a name="l00939"></a>00939       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iMinLoyaltyToTrain = <a class="code" href="GameSettings_8cpp.html#5c32f930e2fef384505c4b91803a92c2">gGameExternalOptions</a>.<a class="code" href="structGAME__EXTERNAL__OPTIONS.html#a08f813ff6015242621fc2cfbdcc59d4">iMinLoyaltyToTrain</a>;
<a name="l00940"></a>00940 DebugMsg (<a class="code" href="DEBUG_8cpp.html#a7985c2fd033797fc67a03b2c26e07c6">TOPIC_JA2</a>,DBG_LEVEL_3,<span class="stringliteral">"Map Screen1"</span>);
<a name="l00941"></a>00941 
<a name="l00942"></a>00942       <span class="comment">// this procedure will display the town names on the screen</span>
<a name="l00943"></a>00943 
<a name="l00944"></a>00944       <a class="code" href="Font_8cpp.html#fa4871009f0473cca0380217753947dc">SetFont</a>(MAP_FONT);
<a name="l00945"></a>00945   <a class="code" href="Font_8cpp.html#a1fe8cc526be9e2c96b5dd66e348506f">SetFontBackground</a>(FONT_MCOLOR_BLACK);
<a name="l00946"></a>00946 
<a name="l00947"></a>00947       <span class="keywordflow">for</span>( bTown = FIRST_TOWN; bTown &lt; <a class="code" href="mapscreen_8h.html#4d1dc70bee62b945929c96dfafebe1051ba4a34e4cff74188ff8c80499572a88">NUM_TOWNS</a>; bTown++)
<a name="l00948"></a>00948       {
<a name="l00949"></a>00949             <span class="comment">// skip Orta/Tixa until found</span>
<a name="l00950"></a>00950             <span class="keywordflow">if</span>( ( ( <a class="code" href="strategicmap_8cpp.html#20549a2f36fdcba9495803c110584b47">fFoundOrta</a> != FALSE ) || ( bTown != <a class="code" href="mapscreen_8h.html#4d1dc70bee62b945929c96dfafebe1051ae6da30d1617c09899e280a04bde521">ORTA</a> ) ) &amp;&amp; ( ( bTown != <a class="code" href="mapscreen_8h.html#4d1dc70bee62b945929c96dfafebe10560f8283526f5d52c03edfd9bff8b218a">TIXA</a> ) || ( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e5d32ba931394430e60f65852d4e36e6">fFoundTixa</a> != FALSE) ) )
<a name="l00951"></a>00951             {
<a name="l00952"></a>00952                   swprintf( sString, L<span class="stringliteral">"%s"</span>, <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#68933d9bb7d357af6609236e47fca927">pTownNames</a>[ bTown ] );
<a name="l00953"></a>00953 
<a name="l00954"></a>00954                   fLoyaltyTooLowToTrainMilitia = FALSE;
<a name="l00955"></a>00955 
<a name="l00956"></a>00956                   <span class="comment">// don't show loyalty string until loyalty tracking for that town has been started</span>
<a name="l00957"></a>00957                   <span class="keywordflow">if</span>( <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#53aef3e8e8681f01397608fbb9dcf56e">gTownLoyalty</a>[ bTown ].fStarted &amp;&amp; <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#9b06c65f6833d5d0ed217d0c959d80dd">gfTownUsesLoyalty</a>[ bTown ])
<a name="l00958"></a>00958                   {
<a name="l00959"></a>00959                         swprintf( sStringA, L<span class="stringliteral">"%d%%%% %s"</span>, <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#53aef3e8e8681f01397608fbb9dcf56e">gTownLoyalty</a>[ bTown ].ubRating, <a class="code" href="__DutchText_8cpp.html#d066464deda53c8e5996d19dfd1d9b5f">gsLoyalString</a>[ 0 ]);
<a name="l00960"></a>00960 
<a name="l00961"></a>00961                         <span class="comment">// if loyalty is too low to train militia, and militia training is allowed here</span>
<a name="l00962"></a>00962                         <span class="keywordflow">if</span> ( ( <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#53aef3e8e8681f01397608fbb9dcf56e">gTownLoyalty</a>[ bTown ].ubRating &lt; iMinLoyaltyToTrain ) &amp;&amp; <a class="code" href="Town_01Militia_8cpp.html#b641dcc19fcd9bf831e6fd678c8e10b2">MilitiaTrainingAllowedInTown</a>( bTown ) )
<a name="l00963"></a>00963                         {
<a name="l00964"></a>00964                               fLoyaltyTooLowToTrainMilitia = TRUE;
<a name="l00965"></a>00965                         }
<a name="l00966"></a>00966                   }
<a name="l00967"></a>00967                   <span class="keywordflow">else</span>
<a name="l00968"></a>00968                   {
<a name="l00969"></a>00969                         <a class="code" href="Sys_01Globals_8h.html#3d1e5716a3d04a53b8846319dd57da83">wcscpy</a>( sStringA, L<span class="stringliteral">""</span>);
<a name="l00970"></a>00970                   }
<a name="l00971"></a>00971 
<a name="l00972"></a>00972                   <span class="keywordflow">if</span>(!<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l00973"></a>00973                   {
<a name="l00974"></a>00974                         usX = (<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>) (MAP_VIEW_START_X + MAP_GRID_X +  (<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#93a894b1554eecf3cf0f0ce8fbbf56a1">pTownPoints</a>[ bTown ].<a class="code" href="Sound_01Control_8cpp.html#6150e0515f7202e2fb518f7206ed97dc">x</a> * MAP_GRID_X) / 10);
<a name="l00975"></a>00975                         usY = (<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>) (MAP_VIEW_START_Y + MAP_GRID_Y + ((<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#93a894b1554eecf3cf0f0ce8fbbf56a1">pTownPoints</a>[ bTown ].y * MAP_GRID_Y) / 10) + 1);
<a name="l00976"></a>00976                   }
<a name="l00977"></a>00977                   <span class="keywordflow">else</span>
<a name="l00978"></a>00978                   {
<a name="l00979"></a>00979                         usX = (<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>) (MAP_VIEW_START_X + MAP_GRID_X + MAP_GRID_ZOOM_X - <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#fa3ac40b83d55b2124d79820fa45974c">iZoomX</a> +  (<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#93a894b1554eecf3cf0f0ce8fbbf56a1">pTownPoints</a>[ bTown ].<a class="code" href="Sound_01Control_8cpp.html#6150e0515f7202e2fb518f7206ed97dc">x</a> * MAP_GRID_ZOOM_X) / 10);
<a name="l00980"></a>00980                         usY = (<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>) (MAP_VIEW_START_Y + MAP_GRID_Y + MAP_GRID_ZOOM_Y - <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#bca9577b78c819bc3429fe62f836704b">iZoomY</a> + ((<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#93a894b1554eecf3cf0f0ce8fbbf56a1">pTownPoints</a>[ bTown ].y * MAP_GRID_ZOOM_Y) / 10) + 1);
<a name="l00981"></a>00981 <span class="comment">//                usX = 2 * pTownPoints[ bTown  ].x - iZoomX - MAP_VIEW_START_X + MAP_GRID_X;</span>
<a name="l00982"></a>00982 <span class="comment">//                usY = 2 * pTownPoints[ bTown  ].y - iZoomY - MAP_VIEW_START_Y + MAP_GRID_Y;</span>
<a name="l00983"></a>00983                   }
<a name="l00984"></a>00984 
<a name="l00985"></a>00985                   <span class="comment">// red for low loyalty, green otherwise</span>
<a name="l00986"></a>00986               <a class="code" href="Font_8cpp.html#388be5810478c3f3bdb861f144085d70">SetFontForeground</a>( ( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ) ( fLoyaltyTooLowToTrainMilitia ? FONT_MCOLOR_RED : FONT_MCOLOR_LTGREEN ) );
<a name="l00987"></a>00987 
<a name="l00988"></a>00988       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#4e74128db10ca7b3e0cf9af622e446f6">DrawTownLabels</a>(sString, sStringA, usX, usY);
<a name="l00989"></a>00989             }
<a name="l00990"></a>00990       }
<a name="l00991"></a>00991 }
<a name="l00992"></a>00992 
<a name="l00993"></a>00993 
<a name="l00994"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#4e74128db10ca7b3e0cf9af622e446f6">00994</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#4e74128db10ca7b3e0cf9af622e446f6">DrawTownLabels</a>(<a class="code" href="Types_8h.html#94ebfccc6e846c28751f8d616371f1e5">STR16</a> pString, <a class="code" href="Types_8h.html#94ebfccc6e846c28751f8d616371f1e5">STR16</a> pStringA, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usFirstX, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usFirstY)
<a name="l00995"></a>00995 {
<a name="l00996"></a>00996       <span class="comment">// this procedure will draw the given strings on the screen centered around the given x and at the given y</span>
<a name="l00997"></a>00997 
<a name="l00998"></a>00998       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSecondX, sSecondY;
<a name="l00999"></a>00999       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sPastEdge;
<a name="l01000"></a>01000 
<a name="l01001"></a>01001 
<a name="l01002"></a>01002       <span class="comment">// if within view region...render, else don't</span>
<a name="l01003"></a>01003       <span class="keywordflow">if</span>( ( usFirstX &gt; MAP_VIEW_START_X + MAP_VIEW_WIDTH )||( usFirstX &lt; MAP_VIEW_START_X )|| (usFirstY &lt; MAP_VIEW_START_Y ) || ( usFirstY &gt; MAP_VIEW_START_Y + MAP_VIEW_HEIGHT ) )
<a name="l01004"></a>01004       {
<a name="l01005"></a>01005             <span class="keywordflow">return</span>;
<a name="l01006"></a>01006       }
<a name="l01007"></a>01007 
<a name="l01008"></a>01008 
<a name="l01009"></a>01009       <a class="code" href="Font_8cpp.html#a038a1dc2edfc9f9c0766a0cbde2f440">SetFontDestBuffer</a>( <a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a>, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7a5ec290dc3b07a397fd9ddb6ead8fec">MapScreenRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a> + 2, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7a5ec290dc3b07a397fd9ddb6ead8fec">MapScreenRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7a5ec290dc3b07a397fd9ddb6ead8fec">MapScreenRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7a5ec290dc3b07a397fd9ddb6ead8fec">MapScreenRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a> , FALSE );
<a name="l01010"></a>01010   
<a name="l01011"></a>01011       <span class="comment">// clip blits to mapscreen region</span>
<a name="l01012"></a>01012       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#1a814c4ade19f909f1082ca012e72ea8">ClipBlitsToMapViewRegion</a>( );
<a name="l01013"></a>01013 
<a name="l01014"></a>01014       <span class="comment">// we're CENTERING the first string AROUND usFirstX, so calculate the starting X</span>
<a name="l01015"></a>01015       usFirstX -= <a class="code" href="Font_8cpp.html#3bbbfeabebae07a03f719f35607c6e4f">StringPixLength</a>( pString, MAP_FONT) / 2;
<a name="l01016"></a>01016 
<a name="l01017"></a>01017       <span class="comment">// print first string</span>
<a name="l01018"></a>01018       <a class="code" href="Render_01Dirty_8cpp.html#ae5c011dc4af8d9a67af870a92f56e1f">gprintfdirty</a>( usFirstX, usFirstY, pString);
<a name="l01019"></a>01019   <a class="code" href="Font_8cpp.html#b3e12cf19a0ca58abf6689cc8eca3ead">mprintf</a>(usFirstX, usFirstY, pString);
<a name="l01020"></a>01020 
<a name="l01021"></a>01021 
<a name="l01022"></a>01022       <span class="comment">// calculate starting coordinates for the second string</span>
<a name="l01023"></a>01023       <a class="code" href="Font_8cpp.html#6e4e5666db9f5ede835aba7e158f0e8f">VarFindFontCenterCoordinates</a>(( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> )( usFirstX ), ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> )usFirstY, <a class="code" href="Font_8cpp.html#3bbbfeabebae07a03f719f35607c6e4f">StringPixLength</a>( pString, MAP_FONT), 0, MAP_FONT, &amp;sSecondX, &amp;sSecondY, pStringA);
<a name="l01024"></a>01024 
<a name="l01025"></a>01025       <span class="comment">// make sure we don't go past left edge (Grumm)</span>
<a name="l01026"></a>01026       <span class="keywordflow">if</span>( !<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a> )
<a name="l01027"></a>01027       {
<a name="l01028"></a>01028             sPastEdge = (MAP_VIEW_START_X + 23) - sSecondX;
<a name="l01029"></a>01029 
<a name="l01030"></a>01030             <span class="keywordflow">if</span> (sPastEdge &gt; 0)
<a name="l01031"></a>01031                   sSecondX += sPastEdge;
<a name="l01032"></a>01032       }
<a name="l01033"></a>01033 
<a name="l01034"></a>01034       <span class="comment">// print second string beneath first</span>
<a name="l01035"></a>01035       sSecondY = ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> )( usFirstY + <a class="code" href="Font_8cpp.html#35cddf34696d33489efb820caf968907">GetFontHeight</a>( MAP_FONT ) );
<a name="l01036"></a>01036       <a class="code" href="Render_01Dirty_8cpp.html#ae5c011dc4af8d9a67af870a92f56e1f">gprintfdirty</a>( sSecondX, sSecondY, pStringA );
<a name="l01037"></a>01037       <a class="code" href="Font_8cpp.html#b3e12cf19a0ca58abf6689cc8eca3ead">mprintf</a>( sSecondX, sSecondY, pStringA );
<a name="l01038"></a>01038 
<a name="l01039"></a>01039       <span class="comment">// restore clip blits</span>
<a name="l01040"></a>01040       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#1b9a9fa9699aebedd0c8b2cbd547a614">RestoreClipRegionToFullScreen</a>( );
<a name="l01041"></a>01041 }
<a name="l01042"></a>01042 
<a name="l01043"></a>01043 
<a name="l01044"></a>01044 
<a name="l01045"></a>01045 <span class="comment">// "on duty" includes mercs inside vehicles</span>
<a name="l01046"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#2cf2bb36174e970abd4352d574d18b70">01046</a> <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#2cf2bb36174e970abd4352d574d18b70">ShowOnDutyTeam</a>( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapY )
<a name="l01047"></a>01047 {
<a name="l01048"></a>01048   <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubCounter = 0, ubIconPosition = 0;
<a name="l01049"></a>01049   <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hIconHandle;
<a name="l01050"></a>01050       <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> = NULL;
<a name="l01051"></a>01051 
<a name="l01052"></a>01052 
<a name="l01053"></a>01053   <a class="code" href="vobject_8cpp.html#bda2b0eae4cb40e612dffd307ad5c692">GetVideoObject</a>(&amp;hIconHandle, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#6aa6d54347b71646905ecbde972d0749">guiCHARICONS</a>);
<a name="l01054"></a>01054 
<a name="l01055"></a>01055   <span class="comment">// run through list</span>
<a name="l01056"></a>01056       <span class="keywordflow">while</span>(<a class="code" href="Map_01Screen_01Interface_8cpp.html#a800323f5af9722f82bfbd00b388bbd9">gCharactersList</a>[ubCounter].fValid)
<a name="l01057"></a>01057       {
<a name="l01058"></a>01058             <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> = <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ <a class="code" href="Map_01Screen_01Interface_8cpp.html#a800323f5af9722f82bfbd00b388bbd9">gCharactersList</a>[ ubCounter ].<a class="code" href="structMapScreenCharacterSt.html#6ef6247ab890bd960c34602d36c8c7af">usSolID</a> ];
<a name="l01059"></a>01059 
<a name="l01060"></a>01060             <span class="keywordflow">if</span>( !( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#eb633099940bc20ff5a969bce84eab42">uiStatusFlags</a> &amp; SOLDIER_VEHICLE ) &amp;&amp;
<a name="l01061"></a>01061                          ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#6784346500db10daed06c2db02b855c0">sSectorX</a> == sMapX) &amp;&amp;
<a name="l01062"></a>01062                          ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#6dd68e70c3000beb79e4ac45d28a0cbf">sSectorY</a> == sMapY) &amp;&amp;
<a name="l01063"></a>01063                          ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#b70b761f0405cc179c1ffba84484df28">bSectorZ</a> == <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b52d71b8f7dc10a22568eb52e0c51a3e">iCurrentMapSectorZ</a> ) &amp;&amp;
<a name="l01064"></a>01064                          ( ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#4269b53195147b458cd1e6874429734b">bAssignment</a> &lt; <a class="code" href="Assignments_8h.html#16db4876b192da08f3ad0cb41afe516fd7123deb063a379062f08a16a7bfa242">ON_DUTY</a> ) || ( ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#4269b53195147b458cd1e6874429734b">bAssignment</a> == <a class="code" href="Assignments_8h.html#16db4876b192da08f3ad0cb41afe516fda30f0dfe7c99ccb74e83ba77c5c118d">VEHICLE</a> ) &amp;&amp; ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#401564d4b34b3239805a3ba930e0cb74">iVehicleId</a> != <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#83461889711d71f15a4546aee8f6c062">iHelicopterVehicleId</a> ) ) ) &amp;&amp;
<a name="l01065"></a>01065                          ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#e308dea18533bf5ab2bcee5bbe27391c">bLife</a> &gt; 0) &amp;&amp;
<a name="l01066"></a>01066                          ( !<a class="code" href="Strategic_01Movement_8cpp.html#8559af34270dfc1b6b17bc1720f8d90d">PlayerIDGroupInMotion</a>( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#7f3c88742fc830ce555bb016e9e68fcd">ubGroupID</a> ) ) )
<a name="l01067"></a>01067             {
<a name="l01068"></a>01068                   <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b7bcc7ea4b4fc2491bcda5e7eb7e0bc9">DrawMapBoxIcon</a>( hIconHandle, SMALL_YELLOW_BOX, sMapX, sMapY, ubIconPosition );
<a name="l01069"></a>01069                   ubIconPosition++;
<a name="l01070"></a>01070             }
<a name="l01071"></a>01071 
<a name="l01072"></a>01072             ubCounter++;
<a name="l01073"></a>01073       }
<a name="l01074"></a>01074       <span class="keywordflow">return</span> ubIconPosition;
<a name="l01075"></a>01075 }
<a name="l01076"></a>01076 
<a name="l01077"></a>01077 
<a name="l01078"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0460093c2393eef2898c96bd87a47caf">01078</a> <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0460093c2393eef2898c96bd87a47caf">ShowAssignedTeam</a>(<a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapY, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iCount)
<a name="l01079"></a>01079 {
<a name="l01080"></a>01080       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubCounter, ubIconPosition;
<a name="l01081"></a>01081   <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hIconHandle;
<a name="l01082"></a>01082       <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> = NULL;
<a name="l01083"></a>01083 
<a name="l01084"></a>01084 
<a name="l01085"></a>01085   <a class="code" href="vobject_8cpp.html#bda2b0eae4cb40e612dffd307ad5c692">GetVideoObject</a>(&amp;hIconHandle, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#6aa6d54347b71646905ecbde972d0749">guiCHARICONS</a>);
<a name="l01086"></a>01086       ubCounter=0;
<a name="l01087"></a>01087 
<a name="l01088"></a>01088   <span class="comment">// run through list  </span>
<a name="l01089"></a>01089       ubIconPosition = ( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ) iCount;
<a name="l01090"></a>01090 
<a name="l01091"></a>01091       <span class="keywordflow">while</span>(<a class="code" href="Map_01Screen_01Interface_8cpp.html#a800323f5af9722f82bfbd00b388bbd9">gCharactersList</a>[ubCounter].fValid)
<a name="l01092"></a>01092       {
<a name="l01093"></a>01093             <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> = <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ <a class="code" href="Map_01Screen_01Interface_8cpp.html#a800323f5af9722f82bfbd00b388bbd9">gCharactersList</a>[ ubCounter ].<a class="code" href="structMapScreenCharacterSt.html#6ef6247ab890bd960c34602d36c8c7af">usSolID</a> ];
<a name="l01094"></a>01094 
<a name="l01095"></a>01095     <span class="comment">// given number of on duty members, find number of assigned chars</span>
<a name="l01096"></a>01096             <span class="comment">// start at beginning of list, look for people who are in sector and assigned</span>
<a name="l01097"></a>01097             <span class="keywordflow">if</span>( !( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#eb633099940bc20ff5a969bce84eab42">uiStatusFlags</a> &amp; SOLDIER_VEHICLE ) &amp;&amp;
<a name="l01098"></a>01098                          ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#6784346500db10daed06c2db02b855c0">sSectorX</a> == sMapX) &amp;&amp;
<a name="l01099"></a>01099                          ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#6dd68e70c3000beb79e4ac45d28a0cbf">sSectorY</a> == sMapY) &amp;&amp;
<a name="l01100"></a>01100                          ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#b70b761f0405cc179c1ffba84484df28">bSectorZ</a> == <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b52d71b8f7dc10a22568eb52e0c51a3e">iCurrentMapSectorZ</a> ) &amp;&amp;
<a name="l01101"></a>01101                          ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#4269b53195147b458cd1e6874429734b">bAssignment</a> &gt;= <a class="code" href="Assignments_8h.html#16db4876b192da08f3ad0cb41afe516fd7123deb063a379062f08a16a7bfa242">ON_DUTY</a> ) &amp;&amp; ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#4269b53195147b458cd1e6874429734b">bAssignment</a> != <a class="code" href="Assignments_8h.html#16db4876b192da08f3ad0cb41afe516fda30f0dfe7c99ccb74e83ba77c5c118d">VEHICLE</a> ) &amp;&amp;
<a name="l01102"></a>01102                          ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#4269b53195147b458cd1e6874429734b">bAssignment</a> != <a class="code" href="Assignments_8h.html#16db4876b192da08f3ad0cb41afe516fb61244da1eb29e186f8bef98fdfe215a">IN_TRANSIT</a> ) &amp;&amp;
<a name="l01103"></a>01103                          ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#4269b53195147b458cd1e6874429734b">bAssignment</a> != <a class="code" href="Assignments_8h.html#16db4876b192da08f3ad0cb41afe516fe351501d216ef5176da170f600a62026">ASSIGNMENT_POW</a> ) &amp;&amp;
<a name="l01104"></a>01104                          ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#e308dea18533bf5ab2bcee5bbe27391c">bLife</a> &gt; 0 ) &amp;&amp;
<a name="l01105"></a>01105                          ( !<a class="code" href="Strategic_01Movement_8cpp.html#8559af34270dfc1b6b17bc1720f8d90d">PlayerIDGroupInMotion</a>( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#7f3c88742fc830ce555bb016e9e68fcd">ubGroupID</a> ) ) )
<a name="l01106"></a>01106             {
<a name="l01107"></a>01107                   <span class="comment">// skip mercs inside the helicopter if we're showing airspace level - they show up inside chopper icon instead</span>
<a name="l01108"></a>01108                   <span class="keywordflow">if</span> ( !<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3eb1c4052a5a9718b9b73c9851737930">fShowAircraftFlag</a> || ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#4269b53195147b458cd1e6874429734b">bAssignment</a> != <a class="code" href="Assignments_8h.html#16db4876b192da08f3ad0cb41afe516fda30f0dfe7c99ccb74e83ba77c5c118d">VEHICLE</a> ) || ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#401564d4b34b3239805a3ba930e0cb74">iVehicleId</a> != <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#83461889711d71f15a4546aee8f6c062">iHelicopterVehicleId</a> ) )
<a name="l01109"></a>01109                   {
<a name="l01110"></a>01110                         <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b7bcc7ea4b4fc2491bcda5e7eb7e0bc9">DrawMapBoxIcon</a>( hIconHandle, SMALL_DULL_YELLOW_BOX, sMapX, sMapY, ubIconPosition );
<a name="l01111"></a>01111                         ubIconPosition++;
<a name="l01112"></a>01112                   }
<a name="l01113"></a>01113             }
<a name="l01114"></a>01114 
<a name="l01115"></a>01115             ubCounter++;
<a name="l01116"></a>01116       }
<a name="l01117"></a>01117       <span class="keywordflow">return</span> ubIconPosition;
<a name="l01118"></a>01118 }
<a name="l01119"></a>01119 
<a name="l01120"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#15aa7a9a87c47a69f91e1874dd393ca6">01120</a> <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#15aa7a9a87c47a69f91e1874dd393ca6">ShowVehicles</a>(<a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapY, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iCount)
<a name="l01121"></a>01121 {
<a name="l01122"></a>01122   <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubCounter, ubIconPosition;
<a name="l01123"></a>01123   <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hIconHandle;
<a name="l01124"></a>01124       <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *pVehicleSoldier;
<a name="l01125"></a>01125 
<a name="l01126"></a>01126 
<a name="l01127"></a>01127   <a class="code" href="vobject_8cpp.html#bda2b0eae4cb40e612dffd307ad5c692">GetVideoObject</a>(&amp;hIconHandle, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#6aa6d54347b71646905ecbde972d0749">guiCHARICONS</a>);
<a name="l01128"></a>01128       ubCounter=0;
<a name="l01129"></a>01129 
<a name="l01130"></a>01130       ubIconPosition = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>) iCount;
<a name="l01131"></a>01131 
<a name="l01132"></a>01132   <span class="comment">// run through list of vehicles</span>
<a name="l01133"></a>01133       <span class="keywordflow">while</span>( ubCounter &lt; <a class="code" href="Vehicles_8cpp.html#90e967216829a1e69d832dfdc2e5dbc2">ubNumberOfVehicles</a> )
<a name="l01134"></a>01134       {
<a name="l01135"></a>01135             <span class="comment">// skip the chopper, it has its own icon and displays in airspace mode</span>
<a name="l01136"></a>01136             <span class="keywordflow">if</span> ( ubCounter != <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#83461889711d71f15a4546aee8f6c062">iHelicopterVehicleId</a> )
<a name="l01137"></a>01137             {
<a name="l01138"></a>01138                   <span class="keywordflow">if</span> ( (<a class="code" href="Vehicles_8cpp.html#f2797a2fc8430fa3072bca3e40d70e24">pVehicleList</a>[ ubCounter ].sSectorX == sMapX) &amp;&amp; ( <a class="code" href="Vehicles_8cpp.html#f2797a2fc8430fa3072bca3e40d70e24">pVehicleList</a>[ ubCounter ].sSectorY == sMapY ) )
<a name="l01139"></a>01139                   {
<a name="l01140"></a>01140                         <span class="comment">// don't show vehicles between sectors (in motion - they're counted as "people in motion"</span>
<a name="l01141"></a>01141                         <span class="keywordflow">if</span>( ( <a class="code" href="Vehicles_8cpp.html#f2797a2fc8430fa3072bca3e40d70e24">pVehicleList</a>[ ubCounter ].sSectorZ == <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b52d71b8f7dc10a22568eb52e0c51a3e">iCurrentMapSectorZ</a> ) &amp;&amp; 
<a name="l01142"></a>01142                                     !<a class="code" href="Strategic_01Movement_8cpp.html#8559af34270dfc1b6b17bc1720f8d90d">PlayerIDGroupInMotion</a>( <a class="code" href="Vehicles_8cpp.html#f2797a2fc8430fa3072bca3e40d70e24">pVehicleList</a>[ ubCounter ].ubMovementGroup ) )
<a name="l01143"></a>01143                         {
<a name="l01144"></a>01144                               <span class="comment">// ATE: Check if this vehicle has a soldier and it's on our team.....</span>
<a name="l01145"></a>01145                               pVehicleSoldier = <a class="code" href="Vehicles_8cpp.html#1e16c5ce734af9644699aa8e29e73fc1">GetSoldierStructureForVehicle</a>( ubCounter );
<a name="l01146"></a>01146 
<a name="l01147"></a>01147                               <span class="comment">// this skips the chopper, which has no soldier</span>
<a name="l01148"></a>01148                               <span class="keywordflow">if</span> ( pVehicleSoldier )
<a name="l01149"></a>01149                               {
<a name="l01150"></a>01150                                     <span class="keywordflow">if</span> ( pVehicleSoldier-&gt;<a class="code" href="structSOLDIERTYPE.html#74a40a8aaf3efe840cdaf6be62556d82">bTeam</a> == <a class="code" href="Campaign_8cpp.html#47b2067ff75193e24776eda5297400ff">gbPlayerNum</a> )
<a name="l01151"></a>01151                                     {
<a name="l01152"></a>01152                                           <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b7bcc7ea4b4fc2491bcda5e7eb7e0bc9">DrawMapBoxIcon</a>( hIconHandle, SMALL_WHITE_BOX, sMapX, sMapY, ubIconPosition );
<a name="l01153"></a>01153                                           ubIconPosition++;
<a name="l01154"></a>01154                                     }
<a name="l01155"></a>01155                               }
<a name="l01156"></a>01156                         }
<a name="l01157"></a>01157                   }
<a name="l01158"></a>01158             }
<a name="l01159"></a>01159 
<a name="l01160"></a>01160     ubCounter++;
<a name="l01161"></a>01161       }
<a name="l01162"></a>01162 
<a name="l01163"></a>01163       <span class="keywordflow">return</span> ubIconPosition;
<a name="l01164"></a>01164 }
<a name="l01165"></a>01165 
<a name="l01166"></a>01166 
<a name="l01167"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#9b56312b0b61092011c732d22a4c1e3f">01167</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#9b56312b0b61092011c732d22a4c1e3f">ShowEnemiesInSector</a>( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorY, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sNumberOfEnemies, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubIconPosition )
<a name="l01168"></a>01168 {
<a name="l01169"></a>01169       <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hIconHandle;
<a name="l01170"></a>01170       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubEnemy = 0;
<a name="l01171"></a>01171 
<a name="l01172"></a>01172       <span class="comment">// get the video object</span>
<a name="l01173"></a>01173       <a class="code" href="vobject_8cpp.html#bda2b0eae4cb40e612dffd307ad5c692">GetVideoObject</a>(&amp;hIconHandle, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#6aa6d54347b71646905ecbde972d0749">guiCHARICONS</a>);
<a name="l01174"></a>01174 
<a name="l01175"></a>01175       <span class="keywordflow">for</span>( ubEnemy = 0; ubEnemy &lt; sNumberOfEnemies; ubEnemy++ )
<a name="l01176"></a>01176       {
<a name="l01177"></a>01177             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b7bcc7ea4b4fc2491bcda5e7eb7e0bc9">DrawMapBoxIcon</a>( hIconHandle, SMALL_RED_BOX, sSectorX, sSectorY, ubIconPosition );
<a name="l01178"></a>01178             ubIconPosition++;
<a name="l01179"></a>01179       }
<a name="l01180"></a>01180 }
<a name="l01181"></a>01181 
<a name="l01182"></a>01182 
<a name="l01183"></a>01183 
<a name="l01184"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#8678bb495f91e6f5eda20160f6b046da">01184</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#8678bb495f91e6f5eda20160f6b046da">ShowUncertainNumberEnemiesInSector</a>( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorY )
<a name="l01185"></a>01185 {
<a name="l01186"></a>01186       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sXPosition = 0, sYPosition = 0;
<a name="l01187"></a>01187       <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hIconHandle;
<a name="l01188"></a>01188 
<a name="l01189"></a>01189 
<a name="l01190"></a>01190       <span class="comment">// grab the x and y postions</span>
<a name="l01191"></a>01191       sXPosition = sSectorX;
<a name="l01192"></a>01192       sYPosition = sSectorY;
<a name="l01193"></a>01193 
<a name="l01194"></a>01194       <span class="comment">// get the video object</span>
<a name="l01195"></a>01195       <a class="code" href="vobject_8cpp.html#bda2b0eae4cb40e612dffd307ad5c692">GetVideoObject</a>(&amp;hIconHandle, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#6aa6d54347b71646905ecbde972d0749">guiCHARICONS</a>);
<a name="l01196"></a>01196 
<a name="l01197"></a>01197       <span class="comment">// check if we are zoomed in...need to offset in case for scrolling purposes</span>
<a name="l01198"></a>01198       <span class="keywordflow">if</span>(!<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l01199"></a>01199       {
<a name="l01200"></a>01200             sXPosition = ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> )( MAP_X_ICON_OFFSET + ( MAP_VIEW_START_X + ( sSectorX * MAP_GRID_X + 1 )  ) - 1 );
<a name="l01201"></a>01201             sYPosition = ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> )( ( ( MAP_VIEW_START_Y + ( sSectorY * MAP_GRID_Y ) + 1 )  ) );
<a name="l01202"></a>01202             sYPosition -= 2;
<a name="l01203"></a>01203 
<a name="l01204"></a>01204             <span class="comment">// small question mark</span>
<a name="l01205"></a>01205             <a class="code" href="vobject_8cpp.html#8a5b07441769401593743b9f52a9e353">BltVideoObject</a>(<a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a>, hIconHandle, SMALL_QUESTION_MARK, sXPosition, sYPosition, VO_BLT_SRCTRANSPARENCY, NULL ); 
<a name="l01206"></a>01206             <a class="code" href="video_8cpp.html#4ed7790da612ff97bf9c05cf186823bc">InvalidateRegion</a>( sXPosition ,sYPosition, sXPosition + DMAP_GRID_X, sYPosition + DMAP_GRID_Y ); 
<a name="l01207"></a>01207       }
<a name="l01208"></a>01208 <span class="comment">/*</span>
<a name="l01209"></a>01209 <span class="comment">      else</span>
<a name="l01210"></a>01210 <span class="comment">      {</span>
<a name="l01211"></a>01211 <span class="comment">            INT16 sX = 0, sY = 0;</span>
<a name="l01212"></a>01212 <span class="comment"></span>
<a name="l01213"></a>01213 <span class="comment">            GetScreenXYFromMapXYStationary( sSectorX, sSectorY, &amp;sX, &amp;sY ); </span>
<a name="l01214"></a>01214 <span class="comment">            sYPosition = sY-MAP_GRID_Y;</span>
<a name="l01215"></a>01215 <span class="comment">            sXPosition = sX-MAP_GRID_X;</span>
<a name="l01216"></a>01216 <span class="comment"></span>
<a name="l01217"></a>01217 <span class="comment">            // get the x and y position</span>
<a name="l01218"></a>01218 <span class="comment">            sXPosition = MAP_X_ICON_OFFSET + sXPosition ;</span>
<a name="l01219"></a>01219 <span class="comment">            sYPosition = sYPosition - 1;</span>
<a name="l01220"></a>01220 <span class="comment"></span>
<a name="l01221"></a>01221 <span class="comment">            // clip blits to mapscreen region</span>
<a name="l01222"></a>01222 <span class="comment">            ClipBlitsToMapViewRegion( );</span>
<a name="l01223"></a>01223 <span class="comment"></span>
<a name="l01224"></a>01224 <span class="comment">            // large question mark</span>
<a name="l01225"></a>01225 <span class="comment">            BltVideoObject(guiSAVEBUFFER, hIconHandle, BIG_QUESTION_MARK, sXPosition, sYPosition, VO_BLT_SRCTRANSPARENCY, NULL );</span>
<a name="l01226"></a>01226 <span class="comment"></span>
<a name="l01227"></a>01227 <span class="comment">            // restore clip blits</span>
<a name="l01228"></a>01228 <span class="comment">            RestoreClipRegionToFullScreen( );</span>
<a name="l01229"></a>01229 <span class="comment">                   </span>
<a name="l01230"></a>01230 <span class="comment">            InvalidateRegion( sXPosition, sYPosition, sXPosition + DMAP_GRID_ZOOM_X, sYPosition + DMAP_GRID_ZOOM_Y );   </span>
<a name="l01231"></a>01231 <span class="comment">      }</span>
<a name="l01232"></a>01232 <span class="comment">*/</span>
<a name="l01233"></a>01233 }
<a name="l01234"></a>01234 
<a name="l01235"></a>01235 
<a name="l01236"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#886bd9d4526e6eba9d06e2c6687a82a1">01236</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#886bd9d4526e6eba9d06e2c6687a82a1">ShowTeamAndVehicles</a>(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> fShowFlags)
<a name="l01237"></a>01237 {
<a name="l01238"></a>01238       <span class="comment">// go through each sector, display the on duty, assigned, and vehicles</span>
<a name="l01239"></a>01239   <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapX = 0;
<a name="l01240"></a>01240       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapY = 0;
<a name="l01241"></a>01241       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iIconOffset = 0;
<a name="l01242"></a>01242       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fContemplatingRetreating = FALSE;
<a name="l01243"></a>01243 
<a name="l01244"></a>01244 
<a name="l01245"></a>01245       <span class="keywordflow">if</span>( <a class="code" href="PreBattle_01Interface_8cpp.html#3312d7a22fdfc2cc2975dd1b84e7defd">gfDisplayPotentialRetreatPaths</a> &amp;&amp; <a class="code" href="Map_01Screen_01Interface_8cpp.html#69ec0f4d350a2668a941c8cac252a428">gpBattleGroup</a> )
<a name="l01246"></a>01246       {
<a name="l01247"></a>01247             fContemplatingRetreating = TRUE;
<a name="l01248"></a>01248       }
<a name="l01249"></a>01249 
<a name="l01250"></a>01250       <span class="keywordflow">for</span>(sMapX=1; sMapX &lt;MAP_WORLD_X-1; sMapX++)
<a name="l01251"></a>01251       {
<a name="l01252"></a>01252             <span class="keywordflow">for</span>(sMapY=1; sMapY &lt;MAP_WORLD_Y-1; sMapY++)
<a name="l01253"></a>01253             {
<a name="l01254"></a>01254                   <span class="comment">// don't show mercs/vehicles currently in this sector if player is contemplating retreating from THIS sector</span>
<a name="l01255"></a>01255                   <span class="keywordflow">if</span> ( !fContemplatingRetreating || ( sMapX != <a class="code" href="Map_01Screen_01Interface_8cpp.html#69ec0f4d350a2668a941c8cac252a428">gpBattleGroup</a>-&gt;<a class="code" href="structGROUP.html#eee29372e834112984eab1dc714466c0">ubSectorX</a> ) || ( sMapY != <a class="code" href="Map_01Screen_01Interface_8cpp.html#69ec0f4d350a2668a941c8cac252a428">gpBattleGroup</a>-&gt;<a class="code" href="structGROUP.html#11cd63715d9daf1488cca330690db007">ubSectorY</a> ) )
<a name="l01256"></a>01256                   {
<a name="l01257"></a>01257                         <span class="keywordflow">if</span>(fShowFlags &amp; SHOW_TEAMMATES)
<a name="l01258"></a>01258                         {
<a name="l01259"></a>01259                               iIconOffset = <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#2cf2bb36174e970abd4352d574d18b70">ShowOnDutyTeam</a>( sMapX, sMapY );
<a name="l01260"></a>01260                               iIconOffset = <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0460093c2393eef2898c96bd87a47caf">ShowAssignedTeam</a>( sMapX, sMapY, iIconOffset );
<a name="l01261"></a>01261                         }
<a name="l01262"></a>01262 
<a name="l01263"></a>01263                         <span class="keywordflow">if</span>(fShowFlags &amp; SHOW_VEHICLES)
<a name="l01264"></a>01264                               iIconOffset = <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#15aa7a9a87c47a69f91e1874dd393ca6">ShowVehicles</a>( sMapX, sMapY, iIconOffset );
<a name="l01265"></a>01265                   }
<a name="l01266"></a>01266 
<a name="l01267"></a>01267                   <span class="keywordflow">if</span>(fShowFlags &amp; SHOW_TEAMMATES)
<a name="l01268"></a>01268                   {
<a name="l01269"></a>01269                         <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#498fe80d6c2f11f8c084a096628f93f0">HandleShowingOfEnemyForcesInSector</a>( sMapX, sMapY, ( <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> )<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b52d71b8f7dc10a22568eb52e0c51a3e">iCurrentMapSectorZ</a>, ( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ) iIconOffset );
<a name="l01270"></a>01270                         <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#acc0589f1da25c6b304f634bd0373dc7">ShowPeopleInMotion</a>( sMapX, sMapY );
<a name="l01271"></a>01271                   }
<a name="l01272"></a>01272             }
<a name="l01273"></a>01273       }
<a name="l01274"></a>01274 }
<a name="l01275"></a>01275 
<a name="l01276"></a>01276 
<a name="l01277"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#dbe48d8d055a04e48e665b6bf75983ee">01277</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#dbe48d8d055a04e48e665b6bf75983ee">ShadeMapElem</a>( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapY, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iColor )
<a name="l01278"></a>01278 {
<a name="l01279"></a>01279       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sScreenX, sScreenY;
<a name="l01280"></a>01280       <a class="code" href="structSGPVSurface.html">HVSURFACE</a> hSrcVSurface;
<a name="l01281"></a>01281       <span class="comment">//HVSURFACE hSAMSurface;</span>
<a name="l01282"></a>01282       <span class="comment">//HVSURFACE hMineSurface;</span>
<a name="l01283"></a>01283   <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES;
<a name="l01284"></a>01284       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiSrcPitchBYTES;
<a name="l01285"></a>01285   <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>  *pDestBuf;
<a name="l01286"></a>01286       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *pSrcBuf; 
<a name="l01287"></a>01287       <a class="code" href="structSGPRect.html">SGPRect</a> clip; 
<a name="l01288"></a>01288   <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pOriginalPallette;
<a name="l01289"></a>01289 
<a name="l01290"></a>01290 
<a name="l01291"></a>01291       <span class="comment">// get original video surface palette</span>
<a name="l01292"></a>01292       CHECKF( <a class="code" href="vsurface_8cpp.html#9195038a1c569f87837c90c52cd81124">GetVideoSurface</a>( &amp;hSrcVSurface, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ce38015bdf56dde3a7dda1e75e9f4be6">guiBIGMAP</a> ) );
<a name="l01293"></a>01293       <span class="comment">// get original video surface palette</span>
<a name="l01294"></a>01294       <span class="comment">//CHECKF( GetVideoSurface( &amp;hSAMSurface, guiSAMICON ) );</span>
<a name="l01295"></a>01295       <span class="comment">// get original video surface palette</span>
<a name="l01296"></a>01296       <span class="comment">//CHECKF( GetVideoSurface( &amp;hMineSurface, guiMINEICON ) );</span>
<a name="l01297"></a>01297       <span class="comment">// get original video surface palette</span>
<a name="l01298"></a>01298 
<a name="l01299"></a>01299       pOriginalPallette = hSrcVSurface-&gt;<a class="code" href="structSGPVSurface.html#040b0e74b7c77c352bc7274c20c27cd2">p16BPPPalette</a>;
<a name="l01300"></a>01300 
<a name="l01301"></a>01301 
<a name="l01302"></a>01302       <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l01303"></a>01303             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b6a70e847be4beefcc5b45646e0911c3">ShadeMapElemZoomIn</a>( sMapX, sMapY, iColor );
<a name="l01304"></a>01304       <span class="keywordflow">else</span>
<a name="l01305"></a>01305       {
<a name="l01306"></a>01306             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#917041ee85b8bfbe1a319c050e137073">GetScreenXYFromMapXY</a>( sMapX, sMapY, &amp;sScreenX, &amp;sScreenY );
<a name="l01307"></a>01307 
<a name="l01308"></a>01308             <span class="comment">// compensate for original BIG_MAP blit being done at MAP_VIEW_START_X + 1</span>
<a name="l01309"></a>01309             sScreenX += 1;
<a name="l01310"></a>01310 
<a name="l01311"></a>01311             <span class="comment">// compensate for original BIG_MAP blit being done at MAP_VIEW_START_X + 1</span>
<a name="l01312"></a>01312         clip.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a> = 2 * ( sScreenX - ( MAP_VIEW_START_X + 1 ) );
<a name="l01313"></a>01313             clip.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>  = 2 * ( sScreenY - MAP_VIEW_START_Y );
<a name="l01314"></a>01314             clip.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>  = clip.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a> + ( 2 * MAP_GRID_X );
<a name="l01315"></a>01315             clip.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a> = clip.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>  + ( 2 * MAP_GRID_Y );
<a name="l01316"></a>01316 
<a name="l01317"></a>01317             <span class="keywordflow">if</span>( iColor != <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#fb9b21dcb0b6eb4e9e0c9cb090e774be0cc3c2e4f355e031d5e4c89638694188">MAP_SHADE_BLACK</a> )
<a name="l01318"></a>01318             {
<a name="l01319"></a>01319                   <span class="comment">// airspace</span>
<a name="l01320"></a>01320 <span class="comment">/*</span>
<a name="l01321"></a>01321 <span class="comment">                  if( sMapX == 1 )</span>
<a name="l01322"></a>01322 <span class="comment">                  {</span>
<a name="l01323"></a>01323 <span class="comment">                        clip.iLeft -= 4;</span>
<a name="l01324"></a>01324 <span class="comment">                        clip.iRight += 4;</span>
<a name="l01325"></a>01325 <span class="comment">                        sScreenX -= 2;</span>
<a name="l01326"></a>01326 <span class="comment">                  }</span>
<a name="l01327"></a>01327 <span class="comment">                  else</span>
<a name="l01328"></a>01328 <span class="comment">                  {</span>
<a name="l01329"></a>01329 <span class="comment">                        sScreenX += 1;</span>
<a name="l01330"></a>01330 <span class="comment">                  }</span>
<a name="l01331"></a>01331 <span class="comment">*/</span>
<a name="l01332"></a>01332             }
<a name="l01333"></a>01333             <span class="keywordflow">else</span>
<a name="l01334"></a>01334             {
<a name="l01335"></a>01335                   <span class="comment">// non-airspace</span>
<a name="l01336"></a>01336                   sScreenY -= 1;
<a name="l01337"></a>01337             }
<a name="l01338"></a>01338 
<a name="l01339"></a>01339             <span class="keywordflow">switch</span>( iColor )
<a name="l01340"></a>01340             {
<a name="l01341"></a>01341               <span class="keywordflow">case</span>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#fb9b21dcb0b6eb4e9e0c9cb090e774be0cc3c2e4f355e031d5e4c89638694188">MAP_SHADE_BLACK</a> ):
<a name="l01342"></a>01342                         <span class="comment">// simply shade darker</span>
<a name="l01343"></a>01343                         <a class="code" href="vsurface_8cpp.html#194dec4ecd9260057059d3bb0dc303a4">ShadowVideoSurfaceRect</a>( <a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a>, sScreenX, sScreenY, sScreenX + MAP_GRID_X - 1, sScreenY + MAP_GRID_Y - 1 );
<a name="l01344"></a>01344                   <span class="keywordflow">break</span>;
<a name="l01345"></a>01345 
<a name="l01346"></a>01346 
<a name="l01347"></a>01347                   <span class="keywordflow">case</span>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#fb9b21dcb0b6eb4e9e0c9cb090e774bedbe0ec1c7d93e5c0aff724c3da00fa33">MAP_SHADE_LT_GREEN</a> ):
<a name="l01348"></a>01348                         <span class="comment">// grab video surface and set palette</span>
<a name="l01349"></a>01349                         CHECKF( <a class="code" href="vsurface_8cpp.html#9195038a1c569f87837c90c52cd81124">GetVideoSurface</a>( &amp;hSrcVSurface, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ce38015bdf56dde3a7dda1e75e9f4be6">guiBIGMAP</a>) );
<a name="l01350"></a>01350 
<a name="l01351"></a>01351                         hSrcVSurface-&gt;p16BPPPalette = <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#221813e71fc4c68dadf0853dd8cddf42">pMapLTGreenPalette</a>;
<a name="l01352"></a>01352                         <span class="comment">//hMineSurface-&gt;p16BPPPalette = pMapLTGreenPalette;</span>
<a name="l01353"></a>01353                         <span class="comment">//hSAMSurface-&gt;p16BPPPalette = pMapLTGreenPalette;</span>
<a name="l01354"></a>01354 
<a name="l01355"></a>01355                         <span class="comment">// lock source and dest buffers</span>
<a name="l01356"></a>01356                         pDestBuf = (<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>*)<a class="code" href="vsurface_8cpp.html#592b2aeda6075fcbf9d7c67dc44fbd47">LockVideoSurface</a>( guiSAVEBUFFER, &amp;uiDestPitchBYTES);
<a name="l01357"></a>01357                         CHECKF( <a class="code" href="vsurface_8cpp.html#9195038a1c569f87837c90c52cd81124">GetVideoSurface</a>( &amp;hSrcVSurface, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ce38015bdf56dde3a7dda1e75e9f4be6">guiBIGMAP</a>) );
<a name="l01358"></a>01358                         pSrcBuf = <a class="code" href="vsurface_8cpp.html#592b2aeda6075fcbf9d7c67dc44fbd47">LockVideoSurface</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ce38015bdf56dde3a7dda1e75e9f4be6">guiBIGMAP</a>, &amp;uiSrcPitchBYTES);
<a name="l01359"></a>01359 
<a name="l01360"></a>01360                         <a class="code" href="vobject__blitters_8cpp.html#917e965bc57e33f04c2b52e8a391b1b9">Blt8BPPDataTo16BPPBufferHalfRect</a>( pDestBuf, uiDestPitchBYTES, hSrcVSurface, pSrcBuf,uiSrcPitchBYTES, sScreenX, sScreenY, &amp;clip );
<a name="l01361"></a>01361 
<a name="l01362"></a>01362                         <span class="comment">// now blit</span>
<a name="l01363"></a>01363                         <span class="comment">//Blt8BPPDataSubTo16BPPBuffer( pDestBuf, uiDestPitchBYTES, hSrcVSurface, pSrcBuf,uiSrcPitchBYTES, sScreenX, sScreenY, &amp;clip);</span>
<a name="l01364"></a>01364 
<a name="l01365"></a>01365                         <span class="comment">// unlock source and dest buffers</span>
<a name="l01366"></a>01366                         <a class="code" href="vsurface_8cpp.html#abe4e4124597b70b046a3b3567002cb2">UnLockVideoSurface</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ce38015bdf56dde3a7dda1e75e9f4be6">guiBIGMAP</a> );
<a name="l01367"></a>01367         <a class="code" href="vsurface_8cpp.html#abe4e4124597b70b046a3b3567002cb2">UnLockVideoSurface</a>( guiSAVEBUFFER );
<a name="l01368"></a>01368                   <span class="keywordflow">break</span>;
<a name="l01369"></a>01369 
<a name="l01370"></a>01370 
<a name="l01371"></a>01371                   <span class="keywordflow">case</span>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#fb9b21dcb0b6eb4e9e0c9cb090e774beb1445a45b72eb4c89a753ad87a086710">MAP_SHADE_DK_GREEN</a> ):
<a name="l01372"></a>01372                         <span class="comment">// grab video surface and set palette</span>
<a name="l01373"></a>01373                         CHECKF( <a class="code" href="vsurface_8cpp.html#9195038a1c569f87837c90c52cd81124">GetVideoSurface</a>( &amp;hSrcVSurface, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ce38015bdf56dde3a7dda1e75e9f4be6">guiBIGMAP</a>) );
<a name="l01374"></a>01374                         hSrcVSurface-&gt;p16BPPPalette = <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#f1e78aa29d01da7e5ad63d8ca428b7a8">pMapDKGreenPalette</a>;
<a name="l01375"></a>01375                         <span class="comment">//hMineSurface-&gt;p16BPPPalette = pMapDKGreenPalette;</span>
<a name="l01376"></a>01376                         <span class="comment">//hSAMSurface-&gt;p16BPPPalette = pMapDKGreenPalette;</span>
<a name="l01377"></a>01377 <span class="comment"></span>
<a name="l01378"></a>01378 <span class="comment">                        /// lock source and dest buffers</span>
<a name="l01379"></a>01379 <span class="comment"></span>                        pDestBuf = (<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>*)<a class="code" href="vsurface_8cpp.html#592b2aeda6075fcbf9d7c67dc44fbd47">LockVideoSurface</a>( guiSAVEBUFFER, &amp;uiDestPitchBYTES);
<a name="l01380"></a>01380                         CHECKF( <a class="code" href="vsurface_8cpp.html#9195038a1c569f87837c90c52cd81124">GetVideoSurface</a>( &amp;hSrcVSurface, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ce38015bdf56dde3a7dda1e75e9f4be6">guiBIGMAP</a>) );
<a name="l01381"></a>01381                         pSrcBuf = <a class="code" href="vsurface_8cpp.html#592b2aeda6075fcbf9d7c67dc44fbd47">LockVideoSurface</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ce38015bdf56dde3a7dda1e75e9f4be6">guiBIGMAP</a>, &amp;uiSrcPitchBYTES);
<a name="l01382"></a>01382 
<a name="l01383"></a>01383                         <a class="code" href="vobject__blitters_8cpp.html#917e965bc57e33f04c2b52e8a391b1b9">Blt8BPPDataTo16BPPBufferHalfRect</a>( pDestBuf, uiDestPitchBYTES, hSrcVSurface, pSrcBuf,uiSrcPitchBYTES, sScreenX , sScreenY, &amp;clip );
<a name="l01384"></a>01384 
<a name="l01385"></a>01385                         <span class="comment">// now blit</span>
<a name="l01386"></a>01386                         <span class="comment">//Blt8BPPDataSubTo16BPPBuffer( pDestBuf, uiDestPitchBYTES, hSrcVSurface, pSrcBuf,uiSrcPitchBYTES, sScreenX , sScreenY , &amp;clip);</span>
<a name="l01387"></a>01387 
<a name="l01388"></a>01388                         <span class="comment">// unlock source and dest buffers</span>
<a name="l01389"></a>01389                         <a class="code" href="vsurface_8cpp.html#abe4e4124597b70b046a3b3567002cb2">UnLockVideoSurface</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ce38015bdf56dde3a7dda1e75e9f4be6">guiBIGMAP</a> );
<a name="l01390"></a>01390         <a class="code" href="vsurface_8cpp.html#abe4e4124597b70b046a3b3567002cb2">UnLockVideoSurface</a>( guiSAVEBUFFER );
<a name="l01391"></a>01391                   <span class="keywordflow">break</span>;
<a name="l01392"></a>01392 
<a name="l01393"></a>01393 
<a name="l01394"></a>01394                   <span class="keywordflow">case</span>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#fb9b21dcb0b6eb4e9e0c9cb090e774be4ca82572c21c49c5764317b5f6726911">MAP_SHADE_LT_RED</a> ):
<a name="l01395"></a>01395                         <span class="comment">// grab video surface and set palette</span>
<a name="l01396"></a>01396                         CHECKF( <a class="code" href="vsurface_8cpp.html#9195038a1c569f87837c90c52cd81124">GetVideoSurface</a>( &amp;hSrcVSurface, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ce38015bdf56dde3a7dda1e75e9f4be6">guiBIGMAP</a>) );
<a name="l01397"></a>01397                         hSrcVSurface-&gt;p16BPPPalette = <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#6a51f002959a15168a0973f21a1073c7">pMapLTRedPalette</a>;
<a name="l01398"></a>01398                         <span class="comment">//hMineSurface-&gt;p16BPPPalette = pMapLTRedPalette;</span>
<a name="l01399"></a>01399                         <span class="comment">//hSAMSurface-&gt;p16BPPPalette = pMapLTRedPalette;</span>
<a name="l01400"></a>01400 
<a name="l01401"></a>01401                         <span class="comment">// lock source and dest buffers</span>
<a name="l01402"></a>01402                         pDestBuf = (<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>*)<a class="code" href="vsurface_8cpp.html#592b2aeda6075fcbf9d7c67dc44fbd47">LockVideoSurface</a>( guiSAVEBUFFER, &amp;uiDestPitchBYTES);
<a name="l01403"></a>01403                         CHECKF( <a class="code" href="vsurface_8cpp.html#9195038a1c569f87837c90c52cd81124">GetVideoSurface</a>( &amp;hSrcVSurface, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ce38015bdf56dde3a7dda1e75e9f4be6">guiBIGMAP</a>) );
<a name="l01404"></a>01404                         pSrcBuf = <a class="code" href="vsurface_8cpp.html#592b2aeda6075fcbf9d7c67dc44fbd47">LockVideoSurface</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ce38015bdf56dde3a7dda1e75e9f4be6">guiBIGMAP</a>, &amp;uiSrcPitchBYTES);
<a name="l01405"></a>01405 
<a name="l01406"></a>01406                         <a class="code" href="vobject__blitters_8cpp.html#917e965bc57e33f04c2b52e8a391b1b9">Blt8BPPDataTo16BPPBufferHalfRect</a>( pDestBuf, uiDestPitchBYTES, hSrcVSurface, pSrcBuf,uiSrcPitchBYTES, sScreenX , sScreenY, &amp;clip );
<a name="l01407"></a>01407 
<a name="l01408"></a>01408                         <span class="comment">// now blit</span>
<a name="l01409"></a>01409                         <span class="comment">//Blt8BPPDataSubTo16BPPBuffer( pDestBuf, uiDestPitchBYTES, hSrcVSurface, pSrcBuf,uiSrcPitchBYTES, sScreenX , sScreenY , &amp;clip);</span>
<a name="l01410"></a>01410 
<a name="l01411"></a>01411                         <span class="comment">// unlock source and dest buffers</span>
<a name="l01412"></a>01412                         <a class="code" href="vsurface_8cpp.html#abe4e4124597b70b046a3b3567002cb2">UnLockVideoSurface</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ce38015bdf56dde3a7dda1e75e9f4be6">guiBIGMAP</a> );
<a name="l01413"></a>01413         <a class="code" href="vsurface_8cpp.html#abe4e4124597b70b046a3b3567002cb2">UnLockVideoSurface</a>( guiSAVEBUFFER );
<a name="l01414"></a>01414                   <span class="keywordflow">break</span>;
<a name="l01415"></a>01415 
<a name="l01416"></a>01416 
<a name="l01417"></a>01417                   <span class="keywordflow">case</span>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#fb9b21dcb0b6eb4e9e0c9cb090e774bed86b7b23cdbc96fef4d6d71d6298423e">MAP_SHADE_DK_RED</a> ):
<a name="l01418"></a>01418                         <span class="comment">// grab video surface and set palette</span>
<a name="l01419"></a>01419                         CHECKF( <a class="code" href="vsurface_8cpp.html#9195038a1c569f87837c90c52cd81124">GetVideoSurface</a>( &amp;hSrcVSurface, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ce38015bdf56dde3a7dda1e75e9f4be6">guiBIGMAP</a>) );
<a name="l01420"></a>01420                         hSrcVSurface-&gt;p16BPPPalette = <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#4212c0c3f42c8766dbe87334333caf62">pMapDKRedPalette</a>;
<a name="l01421"></a>01421                         <span class="comment">//hMineSurface-&gt;p16BPPPalette = pMapDKRedPalette;</span>
<a name="l01422"></a>01422                         <span class="comment">//hSAMSurface-&gt;p16BPPPalette = pMapDKRedPalette;</span>
<a name="l01423"></a>01423 
<a name="l01424"></a>01424                         <span class="comment">// lock source and dest buffers</span>
<a name="l01425"></a>01425                         pDestBuf = (<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>*)<a class="code" href="vsurface_8cpp.html#592b2aeda6075fcbf9d7c67dc44fbd47">LockVideoSurface</a>( guiSAVEBUFFER, &amp;uiDestPitchBYTES);
<a name="l01426"></a>01426                         CHECKF( <a class="code" href="vsurface_8cpp.html#9195038a1c569f87837c90c52cd81124">GetVideoSurface</a>( &amp;hSrcVSurface, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ce38015bdf56dde3a7dda1e75e9f4be6">guiBIGMAP</a>) );
<a name="l01427"></a>01427                         pSrcBuf = <a class="code" href="vsurface_8cpp.html#592b2aeda6075fcbf9d7c67dc44fbd47">LockVideoSurface</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ce38015bdf56dde3a7dda1e75e9f4be6">guiBIGMAP</a>, &amp;uiSrcPitchBYTES);
<a name="l01428"></a>01428 
<a name="l01429"></a>01429                         <a class="code" href="vobject__blitters_8cpp.html#917e965bc57e33f04c2b52e8a391b1b9">Blt8BPPDataTo16BPPBufferHalfRect</a>( pDestBuf, uiDestPitchBYTES, hSrcVSurface, pSrcBuf,uiSrcPitchBYTES, sScreenX, sScreenY, &amp;clip );
<a name="l01430"></a>01430 
<a name="l01431"></a>01431                         <span class="comment">// now blit</span>
<a name="l01432"></a>01432                         <span class="comment">//Blt8BPPDataSubTo16BPPBuffer( pDestBuf, uiDestPitchBYTES, hSrcVSurface, pSrcBuf,uiSrcPitchBYTES, sScreenX , sScreenY , &amp;clip);</span>
<a name="l01433"></a>01433 
<a name="l01434"></a>01434                         <span class="comment">// unlock source and dest buffers</span>
<a name="l01435"></a>01435                         <a class="code" href="vsurface_8cpp.html#abe4e4124597b70b046a3b3567002cb2">UnLockVideoSurface</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ce38015bdf56dde3a7dda1e75e9f4be6">guiBIGMAP</a> );
<a name="l01436"></a>01436         <a class="code" href="vsurface_8cpp.html#abe4e4124597b70b046a3b3567002cb2">UnLockVideoSurface</a>( guiSAVEBUFFER );
<a name="l01437"></a>01437                   <span class="keywordflow">break</span>;
<a name="l01438"></a>01438             }
<a name="l01439"></a>01439 
<a name="l01440"></a>01440             <span class="comment">// restore original palette</span>
<a name="l01441"></a>01441             CHECKF( <a class="code" href="vsurface_8cpp.html#9195038a1c569f87837c90c52cd81124">GetVideoSurface</a>( &amp;hSrcVSurface, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ce38015bdf56dde3a7dda1e75e9f4be6">guiBIGMAP</a>) );
<a name="l01442"></a>01442             hSrcVSurface-&gt;<a class="code" href="structSGPVSurface.html#040b0e74b7c77c352bc7274c20c27cd2">p16BPPPalette</a> = pOriginalPallette;
<a name="l01443"></a>01443             <span class="comment">//hMineSurface-&gt;p16BPPPalette = pOriginalPallette;</span>
<a name="l01444"></a>01444             <span class="comment">//hSAMSurface-&gt;p16BPPPalette = pOriginalPallette;</span>
<a name="l01445"></a>01445       }
<a name="l01446"></a>01446 
<a name="l01447"></a>01447 
<a name="l01448"></a>01448       <span class="keywordflow">return</span> ( TRUE );
<a name="l01449"></a>01449 }
<a name="l01450"></a>01450 
<a name="l01451"></a>01451 
<a name="l01452"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b6a70e847be4beefcc5b45646e0911c3">01452</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b6a70e847be4beefcc5b45646e0911c3">ShadeMapElemZoomIn</a>(<a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapY, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iColor )
<a name="l01453"></a>01453 {
<a name="l01454"></a>01454       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sScreenX, sScreenY;
<a name="l01455"></a>01455   <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, iY;
<a name="l01456"></a>01456       <a class="code" href="structSGPVSurface.html">HVSURFACE</a> hSrcVSurface;
<a name="l01457"></a>01457   <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES;
<a name="l01458"></a>01458       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiSrcPitchBYTES;
<a name="l01459"></a>01459   <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>  *pDestBuf;
<a name="l01460"></a>01460       <span class="comment">//UINT8 *pDestBuf2;</span>
<a name="l01461"></a>01461       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *pSrcBuf;
<a name="l01462"></a>01462       <a class="code" href="structSGPRect.html">SGPRect</a> clip;
<a name="l01463"></a>01463       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pOriginalPallette;
<a name="l01464"></a>01464       
<a name="l01465"></a>01465       <span class="comment">// get sX and sY</span>
<a name="l01466"></a>01466       iX=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)sMapX;
<a name="l01467"></a>01467       iY=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)sMapY;
<a name="l01468"></a>01468   
<a name="l01469"></a>01469       <span class="comment">// trabslate to screen co-ords for zoomed</span>
<a name="l01470"></a>01470       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#61b609e8ae7546838d7b9b106d25ff3a">GetScreenXYFromMapXYStationary</a>( ((<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>)(iX)),((UINT16)(iY)) , &amp;sScreenX, &amp;sScreenY ); 
<a name="l01471"></a>01471   
<a name="l01472"></a>01472       <span class="comment">// shift left by one sector</span>
<a name="l01473"></a>01473       iY=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)sScreenY-MAP_GRID_Y;
<a name="l01474"></a>01474       iX=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)sScreenX-MAP_GRID_X;      
<a name="l01475"></a>01475       
<a name="l01476"></a>01476       <span class="comment">// get original video surface palette</span>
<a name="l01477"></a>01477       CHECKF( <a class="code" href="vsurface_8cpp.html#9195038a1c569f87837c90c52cd81124">GetVideoSurface</a>( &amp;hSrcVSurface, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ce38015bdf56dde3a7dda1e75e9f4be6">guiBIGMAP</a>) );
<a name="l01478"></a>01478       pOriginalPallette = hSrcVSurface-&gt;p16BPPPalette;
<a name="l01479"></a>01479 
<a name="l01480"></a>01480       <span class="keywordflow">if</span>((iX &gt;<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7a5ec290dc3b07a397fd9ddb6ead8fec">MapScreenRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>-MAP_GRID_X*2)&amp;&amp;(iX &lt;<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7a5ec290dc3b07a397fd9ddb6ead8fec">MapScreenRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>)&amp;&amp;(iY&gt;<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7a5ec290dc3b07a397fd9ddb6ead8fec">MapScreenRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>-MAP_GRID_Y*2)&amp;&amp;(iY &lt; <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7a5ec290dc3b07a397fd9ddb6ead8fec">MapScreenRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>))
<a name="l01481"></a>01481   {
<a name="l01482"></a>01482    sScreenX=(<a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a>)iX;
<a name="l01483"></a>01483        sScreenY=(<a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a>)iY;
<a name="l01484"></a>01484 
<a name="l01485"></a>01485        <span class="keywordflow">if</span>( iColor == <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#fb9b21dcb0b6eb4e9e0c9cb090e774be0cc3c2e4f355e031d5e4c89638694188">MAP_SHADE_BLACK</a> )
<a name="l01486"></a>01486        {
<a name="l01487"></a>01487              clip.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a> = sScreenX + 1;
<a name="l01488"></a>01488              clip.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a> = sScreenX + MAP_GRID_X*2 - 1;
<a name="l01489"></a>01489              clip.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a> = sScreenY;
<a name="l01490"></a>01490              clip.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a> = sScreenY + MAP_GRID_Y*2 - 1;
<a name="l01491"></a>01491        }
<a name="l01492"></a>01492        <span class="keywordflow">else</span>
<a name="l01493"></a>01493        {
<a name="l01494"></a>01494               clip.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>=<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#fa3ac40b83d55b2124d79820fa45974c">iZoomX</a> + sScreenX - MAP_VIEW_START_X - MAP_GRID_X ;
<a name="l01495"></a>01495               clip.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>=clip.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a> + MAP_GRID_X*2;
<a name="l01496"></a>01496               clip.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>=<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#bca9577b78c819bc3429fe62f836704b">iZoomY</a> + sScreenY - MAP_VIEW_START_Y - MAP_GRID_Y;
<a name="l01497"></a>01497               clip.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>=clip.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a> + MAP_GRID_Y*2;
<a name="l01498"></a>01498                   
<a name="l01499"></a>01499                   <span class="keywordflow">if</span>( sScreenY &lt;= <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7a5ec290dc3b07a397fd9ddb6ead8fec">MapScreenRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a> + 10 )
<a name="l01500"></a>01500                   {
<a name="l01501"></a>01501                         clip.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a> -= 5;
<a name="l01502"></a>01502                         sScreenY -= 5;
<a name="l01503"></a>01503                   }
<a name="l01504"></a>01504                         
<a name="l01505"></a>01505 
<a name="l01506"></a>01506                   <span class="keywordflow">if</span>( sMapX == 1 )
<a name="l01507"></a>01507                   {
<a name="l01508"></a>01508                         clip.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a> -= 5;
<a name="l01509"></a>01509                         sScreenX -= 4;
<a name="l01510"></a>01510                   }
<a name="l01511"></a>01511                   <span class="keywordflow">else</span>
<a name="l01512"></a>01512                   {
<a name="l01513"></a>01513                         sScreenX +=1;
<a name="l01514"></a>01514                   }     
<a name="l01515"></a>01515        }
<a name="l01516"></a>01516              
<a name="l01517"></a>01517        <span class="keywordflow">if</span>( sScreenX &gt;= <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7a5ec290dc3b07a397fd9ddb6ead8fec">MapScreenRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a> - 2 * MAP_GRID_X )
<a name="l01518"></a>01518        {
<a name="l01519"></a>01519              clip.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>++;
<a name="l01520"></a>01520        }
<a name="l01521"></a>01521 
<a name="l01522"></a>01522        <span class="keywordflow">if</span>( sScreenY &gt;= <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7a5ec290dc3b07a397fd9ddb6ead8fec">MapScreenRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a> - 2 * MAP_GRID_X )
<a name="l01523"></a>01523        {
<a name="l01524"></a>01524              clip.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>++;
<a name="l01525"></a>01525        }
<a name="l01526"></a>01526 
<a name="l01527"></a>01527        sScreenX += 1;
<a name="l01528"></a>01528        sScreenY += 1;
<a name="l01529"></a>01529 
<a name="l01530"></a>01530        <span class="keywordflow">if</span>( ( sScreenX &gt; <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7a5ec290dc3b07a397fd9ddb6ead8fec">MapScreenRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a> ) || ( sScreenY &gt; <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7a5ec290dc3b07a397fd9ddb6ead8fec">MapScreenRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a> ) )
<a name="l01531"></a>01531        {
<a name="l01532"></a>01532              <span class="keywordflow">return</span>( FALSE );
<a name="l01533"></a>01533        }
<a name="l01534"></a>01534 
<a name="l01535"></a>01535        <span class="keywordflow">switch</span>( iColor )
<a name="l01536"></a>01536        {
<a name="l01537"></a>01537               <span class="keywordflow">case</span>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#fb9b21dcb0b6eb4e9e0c9cb090e774be0cc3c2e4f355e031d5e4c89638694188">MAP_SHADE_BLACK</a> ):
<a name="l01538"></a>01538                         <span class="comment">// simply shade darker</span>
<a name="l01539"></a>01539                         <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b52d71b8f7dc10a22568eb52e0c51a3e">iCurrentMapSectorZ</a> &gt; 0 )
<a name="l01540"></a>01540                         {
<a name="l01541"></a>01541                               <a class="code" href="vsurface_8cpp.html#194dec4ecd9260057059d3bb0dc303a4">ShadowVideoSurfaceRect</a>( <a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a>, clip.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>, clip.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>,  clip.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>, clip.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>  );
<a name="l01542"></a>01542                         }
<a name="l01543"></a>01543                         <a class="code" href="vsurface_8cpp.html#194dec4ecd9260057059d3bb0dc303a4">ShadowVideoSurfaceRect</a>( <a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a>, clip.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>, clip.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>,  clip.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>, clip.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>  );
<a name="l01544"></a>01544                   <span class="keywordflow">break</span>;
<a name="l01545"></a>01545 
<a name="l01546"></a>01546                   <span class="keywordflow">case</span>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#fb9b21dcb0b6eb4e9e0c9cb090e774bedbe0ec1c7d93e5c0aff724c3da00fa33">MAP_SHADE_LT_GREEN</a> ):
<a name="l01547"></a>01547                         <span class="comment">// grab video surface and set palette</span>
<a name="l01548"></a>01548                         CHECKF( <a class="code" href="vsurface_8cpp.html#9195038a1c569f87837c90c52cd81124">GetVideoSurface</a>( &amp;hSrcVSurface, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ce38015bdf56dde3a7dda1e75e9f4be6">guiBIGMAP</a>) );
<a name="l01549"></a>01549                         hSrcVSurface-&gt;p16BPPPalette = <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#221813e71fc4c68dadf0853dd8cddf42">pMapLTGreenPalette</a>;
<a name="l01550"></a>01550                         
<a name="l01551"></a>01551                         <span class="comment">// lock source and dest buffers</span>
<a name="l01552"></a>01552                         pDestBuf = (UINT16*)<a class="code" href="vsurface_8cpp.html#592b2aeda6075fcbf9d7c67dc44fbd47">LockVideoSurface</a>( <a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a>, &amp;uiDestPitchBYTES);
<a name="l01553"></a>01553                         CHECKF( <a class="code" href="vsurface_8cpp.html#9195038a1c569f87837c90c52cd81124">GetVideoSurface</a>( &amp;hSrcVSurface, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ce38015bdf56dde3a7dda1e75e9f4be6">guiBIGMAP</a>) );
<a name="l01554"></a>01554                         pSrcBuf = <a class="code" href="vsurface_8cpp.html#592b2aeda6075fcbf9d7c67dc44fbd47">LockVideoSurface</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ce38015bdf56dde3a7dda1e75e9f4be6">guiBIGMAP</a>, &amp;uiSrcPitchBYTES);
<a name="l01555"></a>01555 
<a name="l01556"></a>01556                         <span class="comment">// now blit</span>
<a name="l01557"></a>01557                         <a class="code" href="vobject__blitters_8cpp.html#14adcdad104549501be4facd5b469438">Blt8BPPDataSubTo16BPPBuffer</a>( pDestBuf, uiDestPitchBYTES, hSrcVSurface, pSrcBuf,uiSrcPitchBYTES, sScreenX, sScreenY, &amp;clip);
<a name="l01558"></a>01558 
<a name="l01559"></a>01559                         <span class="comment">// unlock source and dest buffers</span>
<a name="l01560"></a>01560                         <a class="code" href="vsurface_8cpp.html#abe4e4124597b70b046a3b3567002cb2">UnLockVideoSurface</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ce38015bdf56dde3a7dda1e75e9f4be6">guiBIGMAP</a> );
<a name="l01561"></a>01561         <a class="code" href="vsurface_8cpp.html#abe4e4124597b70b046a3b3567002cb2">UnLockVideoSurface</a>( <a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a> );
<a name="l01562"></a>01562 
<a name="l01563"></a>01563 
<a name="l01564"></a>01564                   <span class="keywordflow">break</span>;
<a name="l01565"></a>01565 
<a name="l01566"></a>01566                   <span class="keywordflow">case</span>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#fb9b21dcb0b6eb4e9e0c9cb090e774beb1445a45b72eb4c89a753ad87a086710">MAP_SHADE_DK_GREEN</a> ):
<a name="l01567"></a>01567                         <span class="comment">// grab video surface and set palette</span>
<a name="l01568"></a>01568                         CHECKF( <a class="code" href="vsurface_8cpp.html#9195038a1c569f87837c90c52cd81124">GetVideoSurface</a>( &amp;hSrcVSurface, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ce38015bdf56dde3a7dda1e75e9f4be6">guiBIGMAP</a>) );
<a name="l01569"></a>01569                         hSrcVSurface-&gt;p16BPPPalette = <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#f1e78aa29d01da7e5ad63d8ca428b7a8">pMapDKGreenPalette</a>;
<a name="l01570"></a>01570 <span class="comment"></span>
<a name="l01571"></a>01571 <span class="comment">                        /// lock source and dest buffers</span>
<a name="l01572"></a>01572 <span class="comment"></span>                        pDestBuf = (UINT16*)<a class="code" href="vsurface_8cpp.html#592b2aeda6075fcbf9d7c67dc44fbd47">LockVideoSurface</a>( <a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a>, &amp;uiDestPitchBYTES);
<a name="l01573"></a>01573                         CHECKF( <a class="code" href="vsurface_8cpp.html#9195038a1c569f87837c90c52cd81124">GetVideoSurface</a>( &amp;hSrcVSurface, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ce38015bdf56dde3a7dda1e75e9f4be6">guiBIGMAP</a>) );
<a name="l01574"></a>01574                         pSrcBuf = <a class="code" href="vsurface_8cpp.html#592b2aeda6075fcbf9d7c67dc44fbd47">LockVideoSurface</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ce38015bdf56dde3a7dda1e75e9f4be6">guiBIGMAP</a>, &amp;uiSrcPitchBYTES);
<a name="l01575"></a>01575 
<a name="l01576"></a>01576                         <span class="comment">// now blit</span>
<a name="l01577"></a>01577                         <a class="code" href="vobject__blitters_8cpp.html#14adcdad104549501be4facd5b469438">Blt8BPPDataSubTo16BPPBuffer</a>( pDestBuf, uiDestPitchBYTES, hSrcVSurface, pSrcBuf,uiSrcPitchBYTES, sScreenX, sScreenY , &amp;clip);
<a name="l01578"></a>01578 
<a name="l01579"></a>01579                         <span class="comment">// unlock source and dest buffers</span>
<a name="l01580"></a>01580                         <a class="code" href="vsurface_8cpp.html#abe4e4124597b70b046a3b3567002cb2">UnLockVideoSurface</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ce38015bdf56dde3a7dda1e75e9f4be6">guiBIGMAP</a> );
<a name="l01581"></a>01581         <a class="code" href="vsurface_8cpp.html#abe4e4124597b70b046a3b3567002cb2">UnLockVideoSurface</a>( <a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a> );
<a name="l01582"></a>01582 
<a name="l01583"></a>01583 
<a name="l01584"></a>01584                   <span class="keywordflow">break</span>;
<a name="l01585"></a>01585 
<a name="l01586"></a>01586                   <span class="keywordflow">case</span>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#fb9b21dcb0b6eb4e9e0c9cb090e774be4ca82572c21c49c5764317b5f6726911">MAP_SHADE_LT_RED</a> ):
<a name="l01587"></a>01587                         <span class="comment">// grab video surface and set palette</span>
<a name="l01588"></a>01588                         CHECKF( <a class="code" href="vsurface_8cpp.html#9195038a1c569f87837c90c52cd81124">GetVideoSurface</a>( &amp;hSrcVSurface, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ce38015bdf56dde3a7dda1e75e9f4be6">guiBIGMAP</a>) );
<a name="l01589"></a>01589                         hSrcVSurface-&gt;p16BPPPalette = <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#6a51f002959a15168a0973f21a1073c7">pMapLTRedPalette</a>;
<a name="l01590"></a>01590 
<a name="l01591"></a>01591                         <span class="comment">// lock source and dest buffers</span>
<a name="l01592"></a>01592                         pDestBuf = (UINT16*)<a class="code" href="vsurface_8cpp.html#592b2aeda6075fcbf9d7c67dc44fbd47">LockVideoSurface</a>( <a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a>, &amp;uiDestPitchBYTES);
<a name="l01593"></a>01593                         CHECKF( <a class="code" href="vsurface_8cpp.html#9195038a1c569f87837c90c52cd81124">GetVideoSurface</a>( &amp;hSrcVSurface, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ce38015bdf56dde3a7dda1e75e9f4be6">guiBIGMAP</a>) );
<a name="l01594"></a>01594                         pSrcBuf = <a class="code" href="vsurface_8cpp.html#592b2aeda6075fcbf9d7c67dc44fbd47">LockVideoSurface</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ce38015bdf56dde3a7dda1e75e9f4be6">guiBIGMAP</a>, &amp;uiSrcPitchBYTES);
<a name="l01595"></a>01595 
<a name="l01596"></a>01596                         <span class="comment">// now blit</span>
<a name="l01597"></a>01597                         <a class="code" href="vobject__blitters_8cpp.html#14adcdad104549501be4facd5b469438">Blt8BPPDataSubTo16BPPBuffer</a>( pDestBuf, uiDestPitchBYTES, hSrcVSurface, pSrcBuf,uiSrcPitchBYTES, sScreenX, sScreenY , &amp;clip);
<a name="l01598"></a>01598 
<a name="l01599"></a>01599                         <span class="comment">// unlock source and dest buffers</span>
<a name="l01600"></a>01600                         <a class="code" href="vsurface_8cpp.html#abe4e4124597b70b046a3b3567002cb2">UnLockVideoSurface</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ce38015bdf56dde3a7dda1e75e9f4be6">guiBIGMAP</a> );
<a name="l01601"></a>01601         <a class="code" href="vsurface_8cpp.html#abe4e4124597b70b046a3b3567002cb2">UnLockVideoSurface</a>( <a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a> );
<a name="l01602"></a>01602 
<a name="l01603"></a>01603 
<a name="l01604"></a>01604                   <span class="keywordflow">break</span>;
<a name="l01605"></a>01605 
<a name="l01606"></a>01606                   <span class="keywordflow">case</span>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#fb9b21dcb0b6eb4e9e0c9cb090e774bed86b7b23cdbc96fef4d6d71d6298423e">MAP_SHADE_DK_RED</a> ):
<a name="l01607"></a>01607                         <span class="comment">// grab video surface and set palette</span>
<a name="l01608"></a>01608                         CHECKF( <a class="code" href="vsurface_8cpp.html#9195038a1c569f87837c90c52cd81124">GetVideoSurface</a>( &amp;hSrcVSurface, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ce38015bdf56dde3a7dda1e75e9f4be6">guiBIGMAP</a>) );
<a name="l01609"></a>01609                         hSrcVSurface-&gt;p16BPPPalette = <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#4212c0c3f42c8766dbe87334333caf62">pMapDKRedPalette</a>;
<a name="l01610"></a>01610 
<a name="l01611"></a>01611                         <span class="comment">// lock source and dest buffers</span>
<a name="l01612"></a>01612                         pDestBuf = (UINT16*)<a class="code" href="vsurface_8cpp.html#592b2aeda6075fcbf9d7c67dc44fbd47">LockVideoSurface</a>( <a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a>, &amp;uiDestPitchBYTES);
<a name="l01613"></a>01613                         CHECKF( <a class="code" href="vsurface_8cpp.html#9195038a1c569f87837c90c52cd81124">GetVideoSurface</a>( &amp;hSrcVSurface, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ce38015bdf56dde3a7dda1e75e9f4be6">guiBIGMAP</a>) );
<a name="l01614"></a>01614                         pSrcBuf = <a class="code" href="vsurface_8cpp.html#592b2aeda6075fcbf9d7c67dc44fbd47">LockVideoSurface</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ce38015bdf56dde3a7dda1e75e9f4be6">guiBIGMAP</a>, &amp;uiSrcPitchBYTES);
<a name="l01615"></a>01615 
<a name="l01616"></a>01616                         <span class="comment">// now blit</span>
<a name="l01617"></a>01617                         <a class="code" href="vobject__blitters_8cpp.html#14adcdad104549501be4facd5b469438">Blt8BPPDataSubTo16BPPBuffer</a>( pDestBuf, uiDestPitchBYTES, hSrcVSurface, pSrcBuf,uiSrcPitchBYTES, sScreenX, sScreenY , &amp;clip);
<a name="l01618"></a>01618 
<a name="l01619"></a>01619                         <span class="comment">// unlock source and dest buffers</span>
<a name="l01620"></a>01620                         <a class="code" href="vsurface_8cpp.html#abe4e4124597b70b046a3b3567002cb2">UnLockVideoSurface</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ce38015bdf56dde3a7dda1e75e9f4be6">guiBIGMAP</a> );
<a name="l01621"></a>01621         <a class="code" href="vsurface_8cpp.html#abe4e4124597b70b046a3b3567002cb2">UnLockVideoSurface</a>( <a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a> );
<a name="l01622"></a>01622 
<a name="l01623"></a>01623 
<a name="l01624"></a>01624                   <span class="keywordflow">break</span>;
<a name="l01625"></a>01625             }
<a name="l01626"></a>01626       }
<a name="l01627"></a>01627 
<a name="l01628"></a>01628       <span class="comment">// restore original palette</span>
<a name="l01629"></a>01629       CHECKF( <a class="code" href="vsurface_8cpp.html#9195038a1c569f87837c90c52cd81124">GetVideoSurface</a>( &amp;hSrcVSurface, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ce38015bdf56dde3a7dda1e75e9f4be6">guiBIGMAP</a>) );
<a name="l01630"></a>01630       hSrcVSurface-&gt;p16BPPPalette = pOriginalPallette;
<a name="l01631"></a>01631 
<a name="l01632"></a>01632       <span class="keywordflow">return</span> ( TRUE );
<a name="l01633"></a>01633 }
<a name="l01634"></a>01634 
<a name="l01635"></a>01635 
<a name="l01636"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#06300ca591f892d1fee5c8c8a1e09848">01636</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#06300ca591f892d1fee5c8c8a1e09848">InitializePalettesForMap</a>( <span class="keywordtype">void</span> )
<a name="l01637"></a>01637 {
<a name="l01638"></a>01638       <span class="comment">// init palettes</span>
<a name="l01639"></a>01639       <a class="code" href="structSGPVSurface.html">HVSURFACE</a> hSrcVSurface;
<a name="l01640"></a>01640       <a class="code" href="structtagSGPPaletteEntry.html">SGPPaletteEntry</a> pPalette[ 256 ];
<a name="l01641"></a>01641       <a class="code" href="structVSURFACE__DESC.html">VSURFACE_DESC</a>           vs_desc;
<a name="l01642"></a>01642       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiTempMap;
<a name="l01643"></a>01643 
<a name="l01644"></a>01644       <span class="comment">// load image</span>
<a name="l01645"></a>01645       vs_desc.<a class="code" href="structVSURFACE__DESC.html#6f5ea5573c06b47d45a3c305058ad276">fCreateFlags</a> = VSURFACE_CREATE_FROMFILE | VSURFACE_SYSTEM_MEM_USAGE;
<a name="l01646"></a>01646       <a class="code" href="Sys_01Globals_8h.html#9e96e1edff6728e41ac635536c3d8304">strcpy</a>(vs_desc.<a class="code" href="structVSURFACE__DESC.html#ad10015269cb8abe31fdab798f357dc6">ImageFile</a>, <span class="stringliteral">"INTERFACE\\b_map.pcx"</span>);
<a name="l01647"></a>01647   CHECKF(AddVideoSurface(&amp;vs_desc, &amp;uiTempMap));
<a name="l01648"></a>01648 
<a name="l01649"></a>01649       <span class="comment">// get video surface</span>
<a name="l01650"></a>01650       CHECKF( <a class="code" href="vsurface_8cpp.html#9195038a1c569f87837c90c52cd81124">GetVideoSurface</a>( &amp;hSrcVSurface, uiTempMap) );
<a name="l01651"></a>01651       <a class="code" href="vsurface_8cpp.html#286b124beb74347c41a4d25bae80521a">GetVSurfacePaletteEntries</a>( hSrcVSurface, pPalette );
<a name="l01652"></a>01652 
<a name="l01653"></a>01653       <span class="comment">// set up various palettes</span>
<a name="l01654"></a>01654       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#6a51f002959a15168a0973f21a1073c7">pMapLTRedPalette</a> = <a class="code" href="himage_8cpp.html#66700c571d4cfefc0d46d09b1133e819">Create16BPPPaletteShaded</a>( pPalette, 400, 0, 0, TRUE );
<a name="l01655"></a>01655       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#4212c0c3f42c8766dbe87334333caf62">pMapDKRedPalette</a> = <a class="code" href="himage_8cpp.html#66700c571d4cfefc0d46d09b1133e819">Create16BPPPaletteShaded</a>( pPalette, 200, 0, 0, TRUE );
<a name="l01656"></a>01656       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#221813e71fc4c68dadf0853dd8cddf42">pMapLTGreenPalette</a> = <a class="code" href="himage_8cpp.html#66700c571d4cfefc0d46d09b1133e819">Create16BPPPaletteShaded</a>( pPalette, 0, 400, 0, TRUE );
<a name="l01657"></a>01657       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#f1e78aa29d01da7e5ad63d8ca428b7a8">pMapDKGreenPalette</a> = <a class="code" href="himage_8cpp.html#66700c571d4cfefc0d46d09b1133e819">Create16BPPPaletteShaded</a>( pPalette, 0, 200, 0, TRUE );
<a name="l01658"></a>01658 
<a name="l01659"></a>01659       <span class="comment">// delete image</span>
<a name="l01660"></a>01660   <a class="code" href="vsurface_8cpp.html#2319f9b709076781433489f132b4259f">DeleteVideoSurfaceFromIndex</a>(uiTempMap);
<a name="l01661"></a>01661 
<a name="l01662"></a>01662 
<a name="l01663"></a>01663       <span class="keywordflow">return</span> ( TRUE );
<a name="l01664"></a>01664 }
<a name="l01665"></a>01665 
<a name="l01666"></a>01666 
<a name="l01667"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#dac5ac1bb596fde1190eee422aad5e7f">01667</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#dac5ac1bb596fde1190eee422aad5e7f">ShutDownPalettesForMap</a>( <span class="keywordtype">void</span> )
<a name="l01668"></a>01668 {
<a name="l01669"></a>01669 
<a name="l01670"></a>01670       MemFree( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#6a51f002959a15168a0973f21a1073c7">pMapLTRedPalette</a> );
<a name="l01671"></a>01671       MemFree( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#4212c0c3f42c8766dbe87334333caf62">pMapDKRedPalette</a> );
<a name="l01672"></a>01672       MemFree( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#221813e71fc4c68dadf0853dd8cddf42">pMapLTGreenPalette</a> );
<a name="l01673"></a>01673       MemFree( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#f1e78aa29d01da7e5ad63d8ca428b7a8">pMapDKGreenPalette</a> );
<a name="l01674"></a>01674 
<a name="l01675"></a>01675       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#6a51f002959a15168a0973f21a1073c7">pMapLTRedPalette</a> = NULL;
<a name="l01676"></a>01676       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#4212c0c3f42c8766dbe87334333caf62">pMapDKRedPalette</a> = NULL;
<a name="l01677"></a>01677       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#221813e71fc4c68dadf0853dd8cddf42">pMapLTGreenPalette</a> = NULL;
<a name="l01678"></a>01678       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#f1e78aa29d01da7e5ad63d8ca428b7a8">pMapDKGreenPalette</a> = NULL;
<a name="l01679"></a>01679 
<a name="l01680"></a>01680 
<a name="l01681"></a>01681 
<a name="l01682"></a>01682 
<a name="l01683"></a>01683       <span class="keywordflow">return</span>;
<a name="l01684"></a>01684 }
<a name="l01685"></a>01685 
<a name="l01686"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#27d809d81a42b49602db1e74e14e17cf">01686</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#27d809d81a42b49602db1e74e14e17cf">PlotPathForCharacter</a>( <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *pCharacter, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sY, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fTacticalTraversal )
<a name="l01687"></a>01687 {
<a name="l01688"></a>01688       <span class="comment">// will plot a path for this character</span>
<a name="l01689"></a>01689 
<a name="l01690"></a>01690       <span class="comment">// is cursor allowed here?..if not..don't build path</span>
<a name="l01691"></a>01691       <span class="keywordflow">if</span>( !<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#3c7416b480dd2f68e51127e192589889">IsTheCursorAllowedToHighLightThisSector</a>( sX, sY ) )
<a name="l01692"></a>01692       {
<a name="l01693"></a>01693             <span class="keywordflow">return</span>;
<a name="l01694"></a>01694       }
<a name="l01695"></a>01695 
<a name="l01696"></a>01696       <span class="comment">// is the character in transit?..then leave</span>
<a name="l01697"></a>01697       <span class="keywordflow">if</span>( pCharacter-&gt;<a class="code" href="structSOLDIERTYPE.html#4269b53195147b458cd1e6874429734b">bAssignment</a> == <a class="code" href="Assignments_8h.html#16db4876b192da08f3ad0cb41afe516fb61244da1eb29e186f8bef98fdfe215a">IN_TRANSIT</a> )
<a name="l01698"></a>01698       {
<a name="l01699"></a>01699             <span class="comment">// leave</span>
<a name="l01700"></a>01700             <span class="keywordflow">return</span>;
<a name="l01701"></a>01701       }
<a name="l01702"></a>01702 
<a name="l01703"></a>01703 
<a name="l01704"></a>01704       <span class="keywordflow">if</span>( pCharacter-&gt;<a class="code" href="structSOLDIERTYPE.html#b70b761f0405cc179c1ffba84484df28">bSectorZ</a> != 0 )
<a name="l01705"></a>01705       {
<a name="l01706"></a>01706             <span class="keywordflow">if</span>( pCharacter-&gt;<a class="code" href="structSOLDIERTYPE.html#4269b53195147b458cd1e6874429734b">bAssignment</a> &gt;= <a class="code" href="Assignments_8h.html#16db4876b192da08f3ad0cb41afe516fd7123deb063a379062f08a16a7bfa242">ON_DUTY</a> )
<a name="l01707"></a>01707             {
<a name="l01708"></a>01708                   <span class="comment">// not on the surface, character won't move until they reach surface..info player of this fact</span>
<a name="l01709"></a>01709                   <a class="code" href="message_8cpp.html#61480a4176cd65baf8abf767e5a228e4">MapScreenMessage</a>( FONT_MCOLOR_DKRED, MSG_INTERFACE, L<span class="stringliteral">"%s %s"</span>, pCharacter-&gt;<a class="code" href="structSOLDIERTYPE.html#7bf7231f416aa66f38010b7a7e8f2341">name</a>, <a class="code" href="__DutchText_8cpp.html#4824a9d3ce04d32d9150cc6358132250">gsUndergroundString</a>[0] );
<a name="l01710"></a>01710             }
<a name="l01711"></a>01711             <span class="keywordflow">else</span>  <span class="comment">// squad</span>
<a name="l01712"></a>01712             {
<a name="l01713"></a>01713                   <a class="code" href="message_8cpp.html#61480a4176cd65baf8abf767e5a228e4">MapScreenMessage</a>( FONT_MCOLOR_DKRED, MSG_INTERFACE, L<span class="stringliteral">"%s %s"</span>, <a class="code" href="__DutchText_8cpp.html#1f1f4d2afbfec4ca5f29754be106ac7d">pLongAssignmentStrings</a>[ pCharacter-&gt;<a class="code" href="structSOLDIERTYPE.html#4269b53195147b458cd1e6874429734b">bAssignment</a> ], <a class="code" href="__DutchText_8cpp.html#4824a9d3ce04d32d9150cc6358132250">gsUndergroundString</a>[0] );
<a name="l01714"></a>01714             }
<a name="l01715"></a>01715             <span class="keywordflow">return</span>;
<a name="l01716"></a>01716       }
<a name="l01717"></a>01717 
<a name="l01718"></a>01718       <span class="keywordflow">if</span>( ( pCharacter-&gt;<a class="code" href="structSOLDIERTYPE.html#4269b53195147b458cd1e6874429734b">bAssignment</a> == <a class="code" href="Assignments_8h.html#16db4876b192da08f3ad0cb41afe516fda30f0dfe7c99ccb74e83ba77c5c118d">VEHICLE</a> ) || ( pCharacter-&gt;<a class="code" href="structSOLDIERTYPE.html#eb633099940bc20ff5a969bce84eab42">uiStatusFlags</a> &amp; SOLDIER_VEHICLE ) )
<a name="l01719"></a>01719       {
<a name="l01720"></a>01720             <a class="code" href="Vehicles_8cpp.html#9af558c699d7ed3986350b11538cea36">SetUpMvtGroupForVehicle</a>( pCharacter );
<a name="l01721"></a>01721       }
<a name="l01722"></a>01722 
<a name="l01723"></a>01723       <span class="comment">// make sure we are at the beginning</span>
<a name="l01724"></a>01724       pCharacter-&gt;<a class="code" href="structSOLDIERTYPE.html#539de98255e52b331b62cd090ded8df9">pMercPath</a> = <a class="code" href="Strategic_01Pathing_8cpp.html#c004ce76b77db2cb2b4a56e1c08099ba">MoveToBeginningOfPathList</a>( pCharacter-&gt;<a class="code" href="structSOLDIERTYPE.html#539de98255e52b331b62cd090ded8df9">pMercPath</a> );
<a name="l01725"></a>01725 
<a name="l01726"></a>01726       <span class="comment">// will plot a path from current position to sX, sY</span>
<a name="l01727"></a>01727       <span class="comment">// get last sector in characters list, build new path, remove tail section, move to beginning of list, and append onto old list</span>
<a name="l01728"></a>01728       pCharacter-&gt;<a class="code" href="structSOLDIERTYPE.html#539de98255e52b331b62cd090ded8df9">pMercPath</a> = <a class="code" href="Strategic_01Pathing_8cpp.html#a7e55902afc456be5bc9046a5b624a70">AppendStrategicPath</a>( <a class="code" href="Strategic_01Pathing_8cpp.html#c004ce76b77db2cb2b4a56e1c08099ba">MoveToBeginningOfPathList</a> ( <a class="code" href="Strategic_01Pathing_8cpp.html#fdeccb39503fd81c6c785800c4fe3394">BuildAStrategicPath</a>( NULL, <a class="code" href="Strategic_01Pathing_8cpp.html#c3fe1790ea706f9d83380fc27888f3cb">GetLastSectorIdInCharactersPath</a>( pCharacter ), ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> )( sX + sY*( MAP_WORLD_X ) ), <a class="code" href="Strategic_01Pathing_8cpp.html#1d097d2e18ed1b332c001f98e01048f4">GetSoldierGroupId</a>( pCharacter ), fTacticalTraversal <span class="comment">/*, FALSE */</span> ) ), pCharacter-&gt;<a class="code" href="structSOLDIERTYPE.html#539de98255e52b331b62cd090ded8df9">pMercPath</a> );
<a name="l01729"></a>01729 
<a name="l01730"></a>01730       <span class="comment">// move to beginning of list</span>
<a name="l01731"></a>01731       pCharacter-&gt;<a class="code" href="structSOLDIERTYPE.html#539de98255e52b331b62cd090ded8df9">pMercPath</a> = <a class="code" href="Strategic_01Pathing_8cpp.html#c004ce76b77db2cb2b4a56e1c08099ba">MoveToBeginningOfPathList</a>( pCharacter-&gt;<a class="code" href="structSOLDIERTYPE.html#539de98255e52b331b62cd090ded8df9">pMercPath</a> );
<a name="l01732"></a>01732 
<a name="l01733"></a>01733       <span class="comment">// check if in vehicle, if so, copy path to vehicle</span>
<a name="l01734"></a>01734       <span class="keywordflow">if</span>( ( pCharacter-&gt;<a class="code" href="structSOLDIERTYPE.html#4269b53195147b458cd1e6874429734b">bAssignment</a> == <a class="code" href="Assignments_8h.html#16db4876b192da08f3ad0cb41afe516fda30f0dfe7c99ccb74e83ba77c5c118d">VEHICLE</a> ) || ( pCharacter-&gt;<a class="code" href="structSOLDIERTYPE.html#eb633099940bc20ff5a969bce84eab42">uiStatusFlags</a> &amp; SOLDIER_VEHICLE ) )
<a name="l01735"></a>01735       {
<a name="l01736"></a>01736             <a class="code" href="Vehicles_8cpp.html#d75801723c42bc3c259d063e7e44bcdd">MoveCharactersPathToVehicle</a>( pCharacter );      
<a name="l01737"></a>01737       }
<a name="l01738"></a>01738       <span class="keywordflow">else</span>
<a name="l01739"></a>01739       {
<a name="l01740"></a>01740             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#189114dec14f0960ac45c32dc75d4acb">CopyPathToCharactersSquadIfInOne</a>( pCharacter );
<a name="l01741"></a>01741       }
<a name="l01742"></a>01742 }
<a name="l01743"></a>01743 
<a name="l01744"></a>01744 
<a name="l01745"></a>01745 
<a name="l01746"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#2110d9cbdfe7f5386c9d0f90a9508a64">01746</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#2110d9cbdfe7f5386c9d0f90a9508a64">PlotATemporaryPathForCharacter</a>( <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *pCharacter, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sY )
<a name="l01747"></a>01747 {
<a name="l01748"></a>01748       <span class="comment">// make sure we're at the beginning</span>
<a name="l01749"></a>01749       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#3bebb27fa8f12a6c894c0d4db60ae52f">pTempCharacterPath</a> = <a class="code" href="Strategic_01Pathing_8cpp.html#c004ce76b77db2cb2b4a56e1c08099ba">MoveToBeginningOfPathList</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#3bebb27fa8f12a6c894c0d4db60ae52f">pTempCharacterPath</a> );
<a name="l01750"></a>01750 
<a name="l01751"></a>01751       <span class="comment">// clear old temp path</span>
<a name="l01752"></a>01752       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#3bebb27fa8f12a6c894c0d4db60ae52f">pTempCharacterPath</a> = <a class="code" href="Strategic_01Pathing_8cpp.html#56eefd8948d2b390d76b46f3157dede1">ClearStrategicPathList</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#3bebb27fa8f12a6c894c0d4db60ae52f">pTempCharacterPath</a>, -1 );
<a name="l01753"></a>01753 
<a name="l01754"></a>01754       <span class="comment">// is cursor allowed here?..if not..don't build temp path</span>
<a name="l01755"></a>01755       <span class="keywordflow">if</span>( !<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#3c7416b480dd2f68e51127e192589889">IsTheCursorAllowedToHighLightThisSector</a>( sX, sY ) )
<a name="l01756"></a>01756       {
<a name="l01757"></a>01757             <span class="keywordflow">return</span>;
<a name="l01758"></a>01758       }
<a name="l01759"></a>01759 
<a name="l01760"></a>01760       <span class="comment">// build path</span>
<a name="l01761"></a>01761       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#3bebb27fa8f12a6c894c0d4db60ae52f">pTempCharacterPath</a> = <a class="code" href="Strategic_01Pathing_8cpp.html#fdeccb39503fd81c6c785800c4fe3394">BuildAStrategicPath</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#3bebb27fa8f12a6c894c0d4db60ae52f">pTempCharacterPath</a>, <a class="code" href="Strategic_01Pathing_8cpp.html#c3fe1790ea706f9d83380fc27888f3cb">GetLastSectorIdInCharactersPath</a>( pCharacter ) , ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> )( sX + sY*( MAP_WORLD_X ) ), <a class="code" href="Strategic_01Pathing_8cpp.html#1d097d2e18ed1b332c001f98e01048f4">GetSoldierGroupId</a>( pCharacter ), FALSE <span class="comment">/*, TRUE */</span> );
<a name="l01762"></a>01762 
<a name="l01763"></a>01763       <span class="keywordflow">return</span>;
<a name="l01764"></a>01764 }
<a name="l01765"></a>01765 
<a name="l01766"></a>01766 
<a name="l01767"></a>01767 
<a name="l01768"></a>01768 <span class="comment">// clear out character path list, after and including this sector</span>
<a name="l01769"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#9c902e1b7f1bcd61f15b25191c04c969">01769</a> <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#9c902e1b7f1bcd61f15b25191c04c969">ClearPathAfterThisSectorForCharacter</a>( <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *pCharacter, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sY )
<a name="l01770"></a>01770 {
<a name="l01771"></a>01771       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iOrigLength = 0;
<a name="l01772"></a>01772       <a class="code" href="structVEHICLETYPE.html">VEHICLETYPE</a> *pVehicle = NULL;
<a name="l01773"></a>01773 
<a name="l01774"></a>01774 
<a name="l01775"></a>01775       iOrigLength = <a class="code" href="Strategic_01Pathing_8cpp.html#87045eea0f5d5c803a0fd718f53cead9">GetLengthOfMercPath</a>( pCharacter );
<a name="l01776"></a>01776 
<a name="l01777"></a>01777       <span class="keywordflow">if</span>( !iOrigLength )
<a name="l01778"></a>01778       {
<a name="l01779"></a>01779             <span class="comment">// no previous path, nothing to do</span>
<a name="l01780"></a>01780             <span class="keywordflow">return</span>( <a class="code" href="Map_01Screen_01Interface_01Map_8h.html#f26f449e73437e60d22c20b4f2cb2ace8c1cd723ea7c92d0b65127d9dd30ae29">ABORT_PLOTTING</a> );
<a name="l01781"></a>01781       }
<a name="l01782"></a>01782 
<a name="l01783"></a>01783 
<a name="l01784"></a>01784       <span class="comment">// if we're clearing everything beyond the current sector, that's quite different.  Since we're basically cancelling</span>
<a name="l01785"></a>01785       <span class="comment">// his movement completely, we must also make sure his next X,Y are changed and he officially "returns" to his sector</span>
<a name="l01786"></a>01786       <span class="keywordflow">if</span> ( ( sX == pCharacter-&gt;<a class="code" href="structSOLDIERTYPE.html#6784346500db10daed06c2db02b855c0">sSectorX</a> ) &amp;&amp; ( sY == pCharacter-&gt;<a class="code" href="structSOLDIERTYPE.html#6dd68e70c3000beb79e4ac45d28a0cbf">sSectorY</a> ) )
<a name="l01787"></a>01787       {
<a name="l01788"></a>01788             <span class="comment">// if we're in confirm map move mode, cancel that (before new UI messages are issued)</span>
<a name="l01789"></a>01789             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#55439cd851632864056aa80626de1855">EndConfirmMapMoveMode</a>( );
<a name="l01790"></a>01790 
<a name="l01791"></a>01791             <a class="code" href="mapscreen_8cpp.html#4bba3e8e51e28117f2b7a955d5cbbc18">CancelPathsOfAllSelectedCharacters</a>();
<a name="l01792"></a>01792             <span class="keywordflow">return</span>( <a class="code" href="Map_01Screen_01Interface_01Map_8h.html#f26f449e73437e60d22c20b4f2cb2ace2abb998a5bbf061715a2045292efa045">PATH_CLEARED</a> );
<a name="l01793"></a>01793       }
<a name="l01794"></a>01794       <span class="keywordflow">else</span>  <span class="comment">// click not in the current sector</span>
<a name="l01795"></a>01795       {
<a name="l01796"></a>01796             <span class="comment">// if the clicked sector is along current route, this will repath only as far as it.  If not, the entire path will</span>
<a name="l01797"></a>01797             <span class="comment">// be canceled.</span>
<a name="l01798"></a>01798 
<a name="l01799"></a>01799             <span class="comment">// if a vehicle</span>
<a name="l01800"></a>01800             <span class="keywordflow">if</span>( pCharacter-&gt;<a class="code" href="structSOLDIERTYPE.html#eb633099940bc20ff5a969bce84eab42">uiStatusFlags</a> &amp; SOLDIER_VEHICLE )
<a name="l01801"></a>01801             {
<a name="l01802"></a>01802                   pVehicle = &amp;( <a class="code" href="Vehicles_8cpp.html#f2797a2fc8430fa3072bca3e40d70e24">pVehicleList</a>[ pCharacter-&gt;<a class="code" href="structSOLDIERTYPE.html#6b49c64abec6b8363ffa83c9cc308dd6">bVehicleID</a> ] );
<a name="l01803"></a>01803             }
<a name="l01804"></a>01804             <span class="comment">// or in a vehicle</span>
<a name="l01805"></a>01805             <span class="keywordflow">else</span> <span class="keywordflow">if</span>( pCharacter-&gt;<a class="code" href="structSOLDIERTYPE.html#4269b53195147b458cd1e6874429734b">bAssignment</a> == <a class="code" href="Assignments_8h.html#16db4876b192da08f3ad0cb41afe516fda30f0dfe7c99ccb74e83ba77c5c118d">VEHICLE</a> )
<a name="l01806"></a>01806             {
<a name="l01807"></a>01807                   pVehicle = &amp;( <a class="code" href="Vehicles_8cpp.html#f2797a2fc8430fa3072bca3e40d70e24">pVehicleList</a>[ pCharacter-&gt;<a class="code" href="structSOLDIERTYPE.html#401564d4b34b3239805a3ba930e0cb74">iVehicleId</a> ] );
<a name="l01808"></a>01808             }
<a name="l01809"></a>01809             <span class="keywordflow">else</span>
<a name="l01810"></a>01810             {
<a name="l01811"></a>01811                   <span class="comment">// foot soldier</span>
<a name="l01812"></a>01812                   pCharacter-&gt;<a class="code" href="structSOLDIERTYPE.html#539de98255e52b331b62cd090ded8df9">pMercPath</a> = <a class="code" href="Strategic_01Pathing_8cpp.html#969dbd8bd0ea41107da6205d34ea8411">ClearStrategicPathListAfterThisSector</a>( pCharacter-&gt;<a class="code" href="structSOLDIERTYPE.html#539de98255e52b331b62cd090ded8df9">pMercPath</a>, sX, sY, pCharacter-&gt;<a class="code" href="structSOLDIERTYPE.html#7f3c88742fc830ce555bb016e9e68fcd">ubGroupID</a> );
<a name="l01813"></a>01813             }
<a name="l01814"></a>01814 
<a name="l01815"></a>01815             <span class="comment">// if there's an associated vehicle structure</span>
<a name="l01816"></a>01816             <span class="keywordflow">if</span> ( pVehicle != NULL )
<a name="l01817"></a>01817             {
<a name="l01818"></a>01818                   <span class="comment">// do it for the vehicle, too</span>
<a name="l01819"></a>01819                   pVehicle-&gt;<a class="code" href="structVEHICLETYPE.html#3a7c232b99765513fb6d8b61cc65b74f">pMercPath</a> = <a class="code" href="Strategic_01Pathing_8cpp.html#969dbd8bd0ea41107da6205d34ea8411">ClearStrategicPathListAfterThisSector</a>( pVehicle-&gt;<a class="code" href="structVEHICLETYPE.html#3a7c232b99765513fb6d8b61cc65b74f">pMercPath</a>, sX, sY, pVehicle-&gt;<a class="code" href="structVEHICLETYPE.html#331f52ad0cd0408b4051bd420cf44c04">ubMovementGroup</a> );
<a name="l01820"></a>01820             }
<a name="l01821"></a>01821 
<a name="l01822"></a>01822             <span class="keywordflow">if</span>( <a class="code" href="Strategic_01Pathing_8cpp.html#87045eea0f5d5c803a0fd718f53cead9">GetLengthOfMercPath</a>( pCharacter ) &lt; iOrigLength )
<a name="l01823"></a>01823             {
<a name="l01824"></a>01824                   <a class="code" href="mapscreen_8cpp.html#4379ab2651a5d460efddee5d11d3bfd0">CopyPathToAllSelectedCharacters</a>( pCharacter-&gt;<a class="code" href="structSOLDIERTYPE.html#539de98255e52b331b62cd090ded8df9">pMercPath</a> );
<a name="l01825"></a>01825                   <span class="comment">// path WAS actually shortened</span>
<a name="l01826"></a>01826                   <span class="keywordflow">return</span>( <a class="code" href="Map_01Screen_01Interface_01Map_8h.html#f26f449e73437e60d22c20b4f2cb2ace29cc8f3f59d974d3276255e562c7657f">PATH_SHORTENED</a> );
<a name="l01827"></a>01827             }
<a name="l01828"></a>01828             <span class="keywordflow">else</span>
<a name="l01829"></a>01829             {
<a name="l01830"></a>01830                   <span class="comment">// same path as before - it's not any shorter</span>
<a name="l01831"></a>01831                   <span class="keywordflow">return</span> ( <a class="code" href="Map_01Screen_01Interface_01Map_8h.html#f26f449e73437e60d22c20b4f2cb2ace8c1cd723ea7c92d0b65127d9dd30ae29">ABORT_PLOTTING</a> );
<a name="l01832"></a>01832             }
<a name="l01833"></a>01833       }
<a name="l01834"></a>01834 }
<a name="l01835"></a>01835 
<a name="l01836"></a>01836 
<a name="l01837"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#753a64cf1152cd25cdb7a0b380e75d7e">01837</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#753a64cf1152cd25cdb7a0b380e75d7e">CancelPathForCharacter</a>( <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *pCharacter )
<a name="l01838"></a>01838 {
<a name="l01839"></a>01839       <span class="comment">// clear out character's entire path list, he and his squad will stay/return to his current sector.</span>
<a name="l01840"></a>01840       pCharacter-&gt;<a class="code" href="structSOLDIERTYPE.html#539de98255e52b331b62cd090ded8df9">pMercPath</a> = <a class="code" href="Strategic_01Pathing_8cpp.html#56eefd8948d2b390d76b46f3157dede1">ClearStrategicPathList</a>( pCharacter-&gt;<a class="code" href="structSOLDIERTYPE.html#539de98255e52b331b62cd090ded8df9">pMercPath</a>, pCharacter-&gt;<a class="code" href="structSOLDIERTYPE.html#7f3c88742fc830ce555bb016e9e68fcd">ubGroupID</a> );
<a name="l01841"></a>01841       <span class="comment">// NOTE: This automatically calls RemoveGroupWaypoints() internally for valid movement groups</span>
<a name="l01842"></a>01842 
<a name="l01843"></a>01843       <span class="comment">// This causes the group to effectively reverse directions (even if they've never actually left), so handle that.</span>
<a name="l01844"></a>01844       <span class="comment">// They are going to return to their current X,Y sector.</span>
<a name="l01845"></a>01845       <a class="code" href="Strategic_01Pathing_8cpp.html#61ab2c65084de80d126f4629a2ffe18f">RebuildWayPointsForGroupPath</a>( pCharacter-&gt;<a class="code" href="structSOLDIERTYPE.html#539de98255e52b331b62cd090ded8df9">pMercPath</a>, pCharacter-&gt;<a class="code" href="structSOLDIERTYPE.html#7f3c88742fc830ce555bb016e9e68fcd">ubGroupID</a> );
<a name="l01846"></a>01846 <span class="comment">//    GroupReversingDirectionsBetweenSectors( GetGroup( pCharacter-&gt;ubGroupID ), ( UINT8 )( pCharacter-&gt;sSectorX ), ( UINT8 )( pCharacter-&gt;sSectorY ), FALSE );</span>
<a name="l01847"></a>01847 
<a name="l01848"></a>01848 
<a name="l01849"></a>01849       <span class="comment">// if he's in a vehicle, clear out the vehicle, too</span>
<a name="l01850"></a>01850       <span class="keywordflow">if</span>( pCharacter-&gt;<a class="code" href="structSOLDIERTYPE.html#4269b53195147b458cd1e6874429734b">bAssignment</a> == <a class="code" href="Assignments_8h.html#16db4876b192da08f3ad0cb41afe516fda30f0dfe7c99ccb74e83ba77c5c118d">VEHICLE</a> )
<a name="l01851"></a>01851       {
<a name="l01852"></a>01852             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#a00a7e995f139179f66e88a85d1323c0">CancelPathForVehicle</a>( &amp;( <a class="code" href="Vehicles_8cpp.html#f2797a2fc8430fa3072bca3e40d70e24">pVehicleList</a>[ pCharacter-&gt;<a class="code" href="structSOLDIERTYPE.html#401564d4b34b3239805a3ba930e0cb74">iVehicleId</a> ] ), TRUE );
<a name="l01853"></a>01853       }
<a name="l01854"></a>01854       <span class="keywordflow">else</span>
<a name="l01855"></a>01855       {
<a name="l01856"></a>01856             <span class="comment">// display "travel route canceled" message</span>
<a name="l01857"></a>01857             <a class="code" href="message_8cpp.html#61480a4176cd65baf8abf767e5a228e4">MapScreenMessage</a>( FONT_MCOLOR_LTYELLOW, MSG_MAP_UI_POSITION_MIDDLE, <a class="code" href="__DutchText_8cpp.html#4b825dacffc311c5609bdf3a6929a603">pMapPlotStrings</a>[ 3 ] );
<a name="l01858"></a>01858       }
<a name="l01859"></a>01859 
<a name="l01860"></a>01860 
<a name="l01861"></a>01861       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#189114dec14f0960ac45c32dc75d4acb">CopyPathToCharactersSquadIfInOne</a>( pCharacter );
<a name="l01862"></a>01862 
<a name="l01863"></a>01863       <a class="code" href="HelpScreen_8cpp.html#be83f0093f2fba05817df5b4592ab0f0">fMapPanelDirty</a> = TRUE;
<a name="l01864"></a>01864       <a class="code" href="HelpScreen_8cpp.html#621ff3a58992a3be899f9eb1071ce8e0">fTeamPanelDirty</a> = TRUE;
<a name="l01865"></a>01865       <a class="code" href="HelpScreen_8cpp.html#0fb29a138f30725f0d1befd2966a0027">fCharacterInfoPanelDirty</a> = TRUE;          <span class="comment">// to update ETA</span>
<a name="l01866"></a>01866 }
<a name="l01867"></a>01867 
<a name="l01868"></a>01868 
<a name="l01869"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#a00a7e995f139179f66e88a85d1323c0">01869</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#a00a7e995f139179f66e88a85d1323c0">CancelPathForVehicle</a>( <a class="code" href="structVEHICLETYPE.html">VEHICLETYPE</a> *pVehicle, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fAlreadyReversed )
<a name="l01870"></a>01870 {
<a name="l01871"></a>01871       <span class="comment">// we're clearing everything beyond the *current* sector, that's quite different.  Since we're basically cancelling</span>
<a name="l01872"></a>01872       <span class="comment">// his movement completely, we must also make sure his next X,Y are changed and he officially "returns" to his sector</span>
<a name="l01873"></a>01873       pVehicle-&gt;<a class="code" href="structVEHICLETYPE.html#3a7c232b99765513fb6d8b61cc65b74f">pMercPath</a> = <a class="code" href="Strategic_01Pathing_8cpp.html#56eefd8948d2b390d76b46f3157dede1">ClearStrategicPathList</a>( pVehicle-&gt;<a class="code" href="structVEHICLETYPE.html#3a7c232b99765513fb6d8b61cc65b74f">pMercPath</a>, pVehicle-&gt;<a class="code" href="structVEHICLETYPE.html#331f52ad0cd0408b4051bd420cf44c04">ubMovementGroup</a> );
<a name="l01874"></a>01874       <span class="comment">// NOTE: This automatically calls RemoveGroupWaypoints() internally for valid movement groups</span>
<a name="l01875"></a>01875 
<a name="l01876"></a>01876       <span class="comment">// if we already reversed one of the passengers, flag will be TRUE,</span>
<a name="l01877"></a>01877       <span class="comment">// don't do it again or we're headed back where we came from!</span>
<a name="l01878"></a>01878       <span class="keywordflow">if</span> ( !fAlreadyReversed )
<a name="l01879"></a>01879       {
<a name="l01880"></a>01880             <span class="comment">// This causes the group to effectively reverse directions (even if they've never actually left), so handle that.</span>
<a name="l01881"></a>01881             <span class="comment">// They are going to return to their current X,Y sector.</span>
<a name="l01882"></a>01882             <a class="code" href="Strategic_01Pathing_8cpp.html#61ab2c65084de80d126f4629a2ffe18f">RebuildWayPointsForGroupPath</a>( pVehicle-&gt;<a class="code" href="structVEHICLETYPE.html#3a7c232b99765513fb6d8b61cc65b74f">pMercPath</a>, pVehicle-&gt;<a class="code" href="structVEHICLETYPE.html#331f52ad0cd0408b4051bd420cf44c04">ubMovementGroup</a> );
<a name="l01883"></a>01883 <span class="comment">//          GroupReversingDirectionsBetweenSectors( GetGroup( pVehicle-&gt;ubMovementGroup ), ( UINT8 ) ( pVehicle-&gt;sSectorX ), ( UINT8 ) ( pVehicle-&gt;sSectorY ), FALSE );</span>
<a name="l01884"></a>01884       }
<a name="l01885"></a>01885 
<a name="l01886"></a>01886       <span class="comment">// display "travel route canceled" message</span>
<a name="l01887"></a>01887       <a class="code" href="message_8cpp.html#61480a4176cd65baf8abf767e5a228e4">MapScreenMessage</a>( FONT_MCOLOR_LTYELLOW, MSG_MAP_UI_POSITION_MIDDLE, <a class="code" href="__DutchText_8cpp.html#4b825dacffc311c5609bdf3a6929a603">pMapPlotStrings</a>[ 3 ] );
<a name="l01888"></a>01888 
<a name="l01889"></a>01889       <span class="comment">// turn the helicopter flag off here, this prevents the "route aborted" msg from coming up</span>
<a name="l01890"></a>01890       <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#e98f4ed560608bb89adb4143e28a8e32">fPlotForHelicopter</a> = FALSE;
<a name="l01891"></a>01891 
<a name="l01892"></a>01892       <a class="code" href="HelpScreen_8cpp.html#621ff3a58992a3be899f9eb1071ce8e0">fTeamPanelDirty</a> = TRUE;
<a name="l01893"></a>01893       <a class="code" href="HelpScreen_8cpp.html#be83f0093f2fba05817df5b4592ab0f0">fMapPanelDirty</a> = TRUE;
<a name="l01894"></a>01894       <a class="code" href="HelpScreen_8cpp.html#0fb29a138f30725f0d1befd2966a0027">fCharacterInfoPanelDirty</a> = TRUE;          <span class="comment">// to update ETA</span>
<a name="l01895"></a>01895 }
<a name="l01896"></a>01896 
<a name="l01897"></a>01897 
<a name="l01898"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#b71c59541af4f904cb6992a6ce39cb07">01898</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b71c59541af4f904cb6992a6ce39cb07">CancelPathForGroup</a>( <a class="code" href="structGROUP.html">GROUP</a> *pGroup )
<a name="l01899"></a>01899 {
<a name="l01900"></a>01900       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iVehicleId;
<a name="l01901"></a>01901 
<a name="l01902"></a>01902       <span class="comment">// if it's the chopper, but player can't redirect it</span>
<a name="l01903"></a>01903       <span class="keywordflow">if</span> ( pGroup-&gt;<a class="code" href="structGROUP.html#1420d1afb0a1876a85b6b93308fbaf68">fPlayer</a> &amp;&amp; <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#6785f12afd6249f9d159559fc3b408fc">IsGroupTheHelicopterGroup</a>( pGroup ) &amp;&amp; ( <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#b281a47b43b858922b387ab3b95f9039">CanHelicopterFly</a>( ) == FALSE ) )
<a name="l01904"></a>01904       {
<a name="l01905"></a>01905             <span class="comment">// explain &amp; ignore</span>
<a name="l01906"></a>01906             <a class="code" href="mapscreen_8cpp.html#925a13b06dbe6b27badec95049f4a0de">ExplainWhySkyriderCantFly</a>();
<a name="l01907"></a>01907             <span class="keywordflow">return</span>;
<a name="l01908"></a>01908       }
<a name="l01909"></a>01909 
<a name="l01910"></a>01910       <span class="comment">// is it a non-vehicle group?</span>
<a name="l01911"></a>01911       <span class="keywordflow">if</span>( ( pGroup-&gt;<a class="code" href="structGROUP.html#1420d1afb0a1876a85b6b93308fbaf68">fPlayer</a> ) &amp;&amp; ( pGroup-&gt;<a class="code" href="structGROUP.html#11020a07151cc89bb95bb6995e13c9bc">fVehicle</a> == FALSE ) )
<a name="l01912"></a>01912       {
<a name="l01913"></a>01913             <span class="keywordflow">if</span>( pGroup-&gt;<a class="code" href="structGROUP.html#32b15cb224aa76e12ae34a04cb29aa7d">pPlayerList</a> )
<a name="l01914"></a>01914             {
<a name="l01915"></a>01915                   <span class="keywordflow">if</span>( pGroup-&gt;<a class="code" href="structGROUP.html#32b15cb224aa76e12ae34a04cb29aa7d">pPlayerList</a>-&gt;<a class="code" href="structPLAYERGROUP.html#28c4e90a1214ef76a13dccf2280e12e3">pSoldier</a> )
<a name="l01916"></a>01916                   { 
<a name="l01917"></a>01917                         <span class="comment">// clearing one merc should be enough, it copies changes to his squad on its own</span>
<a name="l01918"></a>01918                         <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#753a64cf1152cd25cdb7a0b380e75d7e">CancelPathForCharacter</a>( pGroup-&gt;<a class="code" href="structGROUP.html#32b15cb224aa76e12ae34a04cb29aa7d">pPlayerList</a>-&gt;<a class="code" href="structPLAYERGROUP.html#28c4e90a1214ef76a13dccf2280e12e3">pSoldier</a> );
<a name="l01919"></a>01919                   }
<a name="l01920"></a>01920             }
<a name="l01921"></a>01921       }
<a name="l01922"></a>01922       <span class="comment">// is it a vehicle group?</span>
<a name="l01923"></a>01923       <span class="keywordflow">else</span> <span class="keywordflow">if</span>( pGroup-&gt;<a class="code" href="structGROUP.html#11020a07151cc89bb95bb6995e13c9bc">fVehicle</a> )
<a name="l01924"></a>01924       {
<a name="l01925"></a>01925             iVehicleId = <a class="code" href="Vehicles_8cpp.html#00f6ca0078bd862dd3bb1362679d74f1">GivenMvtGroupIdFindVehicleId</a>( pGroup-&gt;<a class="code" href="structGROUP.html#9149379b9355afda87a382af5a88d728">ubGroupID</a> );
<a name="l01926"></a>01926 
<a name="l01927"></a>01927             <span class="comment">// must be valid!</span>
<a name="l01928"></a>01928             Assert( iVehicleId != -1 );
<a name="l01929"></a>01929             <span class="keywordflow">if</span> ( iVehicleId == -1 )
<a name="l01930"></a>01930                   <span class="keywordflow">return</span>;
<a name="l01931"></a>01931 
<a name="l01932"></a>01932             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#a00a7e995f139179f66e88a85d1323c0">CancelPathForVehicle</a>( &amp;( <a class="code" href="Vehicles_8cpp.html#f2797a2fc8430fa3072bca3e40d70e24">pVehicleList</a>[ iVehicleId ] ), FALSE );
<a name="l01933"></a>01933       }
<a name="l01934"></a>01934 }
<a name="l01935"></a>01935 
<a name="l01936"></a>01936 
<a name="l01937"></a>01937 
<a name="l01938"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#189114dec14f0960ac45c32dc75d4acb">01938</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#189114dec14f0960ac45c32dc75d4acb">CopyPathToCharactersSquadIfInOne</a>( <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *pCharacter )
<a name="l01939"></a>01939 {
<a name="l01940"></a>01940       <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bSquad = 0;
<a name="l01941"></a>01941 
<a name="l01942"></a>01942       <span class="comment">// check if on a squad, if so, do same thing for all characters</span>
<a name="l01943"></a>01943 
<a name="l01944"></a>01944       <span class="comment">// what squad is character in?</span>
<a name="l01945"></a>01945       bSquad = <a class="code" href="Squads_8cpp.html#3034bb2793a0dcd7e80a14d1d35b9dc5">SquadCharacterIsIn</a>( pCharacter );
<a name="l01946"></a>01946 
<a name="l01947"></a>01947       <span class="comment">// check to see if character is on a squad, if so, copy path to squad</span>
<a name="l01948"></a>01948       <span class="keywordflow">if</span>( bSquad != -1)
<a name="l01949"></a>01949       {
<a name="l01950"></a>01950             <span class="comment">// copy path over</span>
<a name="l01951"></a>01951             <a class="code" href="Squads_8cpp.html#7cc9c5f44b20442ef7c5b7c0af9e9e40">CopyPathOfCharacterToSquad</a>( pCharacter, bSquad );
<a name="l01952"></a>01952       }
<a name="l01953"></a>01953 }
<a name="l01954"></a>01954 
<a name="l01955"></a>01955 
<a name="l01956"></a>01956 
<a name="l01957"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#131a5cfe5e2ba83c3787c529768cf33d">01957</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#131a5cfe5e2ba83c3787c529768cf33d">DisplaySoldierPath</a>( <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *pCharacter )
<a name="l01958"></a>01958 {
<a name="l01959"></a>01959       <a class="code" href="structpath.html">PathStPtr</a> pPath = NULL;
<a name="l01960"></a>01960 
<a name="l01961"></a>01961 <span class="comment">/* ARM: Hopefully no longer required once using GetSoldierMercPathPtr() ???</span>
<a name="l01962"></a>01962 <span class="comment">      // check if in vehicle, if so, copy path to vehicle</span>
<a name="l01963"></a>01963 <span class="comment">      if( ( pCharacter-&gt;bAssignment == VEHICLE )||( pCharacter-&gt;uiStatusFlags &amp; SOLDIER_VEHICLE ) )</span>
<a name="l01964"></a>01964 <span class="comment">      {</span>
<a name="l01965"></a>01965 <span class="comment">            // get the real path from vehicle's structure and copy it into this soldier's</span>
<a name="l01966"></a>01966 <span class="comment">            CopyVehiclePathToSoldier( pCharacter );</span>
<a name="l01967"></a>01967 <span class="comment">      }</span>
<a name="l01968"></a>01968 <span class="comment">*/</span>
<a name="l01969"></a>01969 
<a name="l01970"></a>01970       pPath = <a class="code" href="Strategic_01Pathing_8cpp.html#38ef9a2313c8bce9a67334841a4f8e03">GetSoldierMercPathPtr</a>( pCharacter );
<a name="l01971"></a>01971 
<a name="l01972"></a>01972   <span class="comment">// trace real route</span>
<a name="l01973"></a>01973       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#bbcdaf34677e2947a1c2f8284dbe232d">TracePathRoute</a>( FALSE, TRUE, pPath );
<a name="l01974"></a>01974       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#4eb532f1b75cafca5770083d34a84690">AnimateRoute</a>( pPath );
<a name="l01975"></a>01975 
<a name="l01976"></a>01976       <span class="keywordflow">return</span>;
<a name="l01977"></a>01977 }
<a name="l01978"></a>01978 
<a name="l01979"></a>01979 
<a name="l01980"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#463153d6758349b2809cd085aac406b7">01980</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#463153d6758349b2809cd085aac406b7">DisplaySoldierTempPath</a>( <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *pCharacter )
<a name="l01981"></a>01981 {
<a name="l01982"></a>01982       <span class="comment">// now render temp route</span>
<a name="l01983"></a>01983       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#bbcdaf34677e2947a1c2f8284dbe232d">TracePathRoute</a>( FALSE, TRUE,  <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#3bebb27fa8f12a6c894c0d4db60ae52f">pTempCharacterPath</a> );
<a name="l01984"></a>01984 
<a name="l01985"></a>01985       <span class="keywordflow">return</span>;
<a name="l01986"></a>01986 }
<a name="l01987"></a>01987 
<a name="l01988"></a>01988 
<a name="l01989"></a>01989 
<a name="l01990"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#6fd2660a5aa4302274e114f678165896">01990</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#6fd2660a5aa4302274e114f678165896">DisplayHelicopterPath</a>( <span class="keywordtype">void</span> )
<a name="l01991"></a>01991 {
<a name="l01992"></a>01992       <span class="comment">// move to beginning of path list</span>
<a name="l01993"></a>01993       <a class="code" href="Vehicles_8cpp.html#f2797a2fc8430fa3072bca3e40d70e24">pVehicleList</a>[ <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#83461889711d71f15a4546aee8f6c062">iHelicopterVehicleId</a> ].<a class="code" href="structVEHICLETYPE.html#3a7c232b99765513fb6d8b61cc65b74f">pMercPath</a> = <a class="code" href="Strategic_01Pathing_8cpp.html#c004ce76b77db2cb2b4a56e1c08099ba">MoveToBeginningOfPathList</a>( <a class="code" href="Vehicles_8cpp.html#f2797a2fc8430fa3072bca3e40d70e24">pVehicleList</a>[ <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#83461889711d71f15a4546aee8f6c062">iHelicopterVehicleId</a> ].pMercPath );
<a name="l01994"></a>01994 
<a name="l01995"></a>01995       <span class="comment">// clip to map</span>
<a name="l01996"></a>01996   <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#1a814c4ade19f909f1082ca012e72ea8">ClipBlitsToMapViewRegion</a>( );
<a name="l01997"></a>01997 
<a name="l01998"></a>01998       <span class="comment">// trace both lists..temp is conditional if cursor has sat in same sector grid long enough</span>
<a name="l01999"></a>01999   <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#bbcdaf34677e2947a1c2f8284dbe232d">TracePathRoute</a>( TRUE, TRUE, <a class="code" href="Vehicles_8cpp.html#f2797a2fc8430fa3072bca3e40d70e24">pVehicleList</a>[ <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#83461889711d71f15a4546aee8f6c062">iHelicopterVehicleId</a> ].pMercPath );
<a name="l02000"></a>02000       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#4eb532f1b75cafca5770083d34a84690">AnimateRoute</a>( <a class="code" href="Vehicles_8cpp.html#f2797a2fc8430fa3072bca3e40d70e24">pVehicleList</a>[ <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#83461889711d71f15a4546aee8f6c062">iHelicopterVehicleId</a> ].pMercPath );
<a name="l02001"></a>02001 
<a name="l02002"></a>02002       <span class="comment">// restore</span>
<a name="l02003"></a>02003       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#1b9a9fa9699aebedd0c8b2cbd547a614">RestoreClipRegionToFullScreen</a>( );
<a name="l02004"></a>02004 
<a name="l02005"></a>02005       <span class="keywordflow">return</span>;
<a name="l02006"></a>02006 }
<a name="l02007"></a>02007 
<a name="l02008"></a>02008 
<a name="l02009"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#5c3aabda85ff26a3fed7841d6a856311">02009</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#5c3aabda85ff26a3fed7841d6a856311">DisplayHelicopterTempPath</a>( <span class="keywordtype">void</span> )
<a name="l02010"></a>02010 {
<a name="l02011"></a>02011       <span class="comment">//should we draw temp path?</span>
<a name="l02012"></a>02012       <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#f961d76541dbc0eb36d42c770bb1dd2f">fDrawTempHeliPath</a> )
<a name="l02013"></a>02013       {
<a name="l02014"></a>02014         <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#bbcdaf34677e2947a1c2f8284dbe232d">TracePathRoute</a>( TRUE, TRUE, <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#1bf007b81a4981f019caede54e60371c">pTempHelicopterPath</a> );
<a name="l02015"></a>02015       }
<a name="l02016"></a>02016 
<a name="l02017"></a>02017       <span class="keywordflow">return</span>;
<a name="l02018"></a>02018 }
<a name="l02019"></a>02019 
<a name="l02020"></a>02020 
<a name="l02021"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#ea41b5f45ae215ea3ee28ecace4b0b8e">02021</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ea41b5f45ae215ea3ee28ecace4b0b8e">PlotPathForHelicopter</a>( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sY )
<a name="l02022"></a>02022 {
<a name="l02023"></a>02023       <span class="comment">// will plot the path for the helicopter </span>
<a name="l02024"></a>02024 
<a name="l02025"></a>02025       <span class="comment">// no heli...go back</span>
<a name="l02026"></a>02026       <span class="keywordflow">if</span>( !<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3eb1c4052a5a9718b9b73c9851737930">fShowAircraftFlag</a> || !<a class="code" href="Map_01Screen_01Helicopter_8cpp.html#82c4b6ccb9f1f04a3c36d8b971cfbf52">fHelicopterAvailable</a> )
<a name="l02027"></a>02027       {
<a name="l02028"></a>02028             <span class="keywordflow">return</span>;
<a name="l02029"></a>02029       }
<a name="l02030"></a>02030       
<a name="l02031"></a>02031       <span class="comment">// is cursor allowed here?..if not..don't build path</span>
<a name="l02032"></a>02032       <span class="keywordflow">if</span>( !<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#3c7416b480dd2f68e51127e192589889">IsTheCursorAllowedToHighLightThisSector</a>( sX, sY ) )
<a name="l02033"></a>02033       {
<a name="l02034"></a>02034             <span class="keywordflow">return</span>;
<a name="l02035"></a>02035       }
<a name="l02036"></a>02036 
<a name="l02037"></a>02037       <span class="comment">// set up mvt group for helicopter</span>
<a name="l02038"></a>02038       <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#75cf930f17770504c4706739aa98b09e">SetUpHelicopterForMovement</a>( );
<a name="l02039"></a>02039 
<a name="l02040"></a>02040       <span class="comment">// move to beginning of list</span>
<a name="l02041"></a>02041       <span class="comment">//pHelicopterPath = MoveToBeginningOfPathList( pVehicleList[ iHelicopterVehicleId ].pMercPath );</span>
<a name="l02042"></a>02042       <a class="code" href="Strategic_01Pathing_8cpp.html#c004ce76b77db2cb2b4a56e1c08099ba">MoveToBeginningOfPathList</a>( <a class="code" href="Vehicles_8cpp.html#f2797a2fc8430fa3072bca3e40d70e24">pVehicleList</a>[ <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#83461889711d71f15a4546aee8f6c062">iHelicopterVehicleId</a> ].pMercPath );
<a name="l02043"></a>02043 
<a name="l02044"></a>02044       <span class="comment">// will plot a path from current position to sX, sY</span>
<a name="l02045"></a>02045       <span class="comment">// get last sector in helicopters list, build new path, remove tail section, move to beginning of list, and append onto old list</span>
<a name="l02046"></a>02046       <a class="code" href="Vehicles_8cpp.html#f2797a2fc8430fa3072bca3e40d70e24">pVehicleList</a>[ <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#83461889711d71f15a4546aee8f6c062">iHelicopterVehicleId</a> ].<a class="code" href="structVEHICLETYPE.html#3a7c232b99765513fb6d8b61cc65b74f">pMercPath</a> = <a class="code" href="Strategic_01Pathing_8cpp.html#a7e55902afc456be5bc9046a5b624a70">AppendStrategicPath</a>( <a class="code" href="Strategic_01Pathing_8cpp.html#c004ce76b77db2cb2b4a56e1c08099ba">MoveToBeginningOfPathList</a>( <a class="code" href="Strategic_01Pathing_8cpp.html#fdeccb39503fd81c6c785800c4fe3394">BuildAStrategicPath</a>( NULL, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#c2b28ef2ffdced61f5a81875f0efde67">GetLastSectorOfHelicoptersPath</a>( ), ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> )( sX + sY*( MAP_WORLD_X ) ), <a class="code" href="Vehicles_8cpp.html#f2797a2fc8430fa3072bca3e40d70e24">pVehicleList</a>[ <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#83461889711d71f15a4546aee8f6c062">iHelicopterVehicleId</a> ].ubMovementGroup, FALSE <span class="comment">/*, FALSE */</span> ) ), <a class="code" href="Vehicles_8cpp.html#f2797a2fc8430fa3072bca3e40d70e24">pVehicleList</a>[ <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#83461889711d71f15a4546aee8f6c062">iHelicopterVehicleId</a> ].pMercPath );
<a name="l02047"></a>02047 
<a name="l02048"></a>02048       <span class="comment">// move to beginning of list</span>
<a name="l02049"></a>02049       <a class="code" href="Vehicles_8cpp.html#f2797a2fc8430fa3072bca3e40d70e24">pVehicleList</a>[ <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#83461889711d71f15a4546aee8f6c062">iHelicopterVehicleId</a> ].<a class="code" href="structVEHICLETYPE.html#3a7c232b99765513fb6d8b61cc65b74f">pMercPath</a> = <a class="code" href="Strategic_01Pathing_8cpp.html#c004ce76b77db2cb2b4a56e1c08099ba">MoveToBeginningOfPathList</a>( <a class="code" href="Vehicles_8cpp.html#f2797a2fc8430fa3072bca3e40d70e24">pVehicleList</a>[ <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#83461889711d71f15a4546aee8f6c062">iHelicopterVehicleId</a> ].pMercPath );
<a name="l02050"></a>02050 
<a name="l02051"></a>02051       <a class="code" href="HelpScreen_8cpp.html#be83f0093f2fba05817df5b4592ab0f0">fMapPanelDirty</a> = TRUE;
<a name="l02052"></a>02052 
<a name="l02053"></a>02053       <span class="keywordflow">return</span>;
<a name="l02054"></a>02054 }
<a name="l02055"></a>02055 
<a name="l02056"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#6e0ef8b400d75024beadc6a712e3c274">02056</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#6e0ef8b400d75024beadc6a712e3c274">PlotATemporaryPathForHelicopter</a>( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sY )
<a name="l02057"></a>02057 {
<a name="l02058"></a>02058       <span class="comment">// clear old temp path</span>
<a name="l02059"></a>02059       <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#1bf007b81a4981f019caede54e60371c">pTempHelicopterPath</a> = <a class="code" href="Strategic_01Pathing_8cpp.html#56eefd8948d2b390d76b46f3157dede1">ClearStrategicPathList</a>( <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#1bf007b81a4981f019caede54e60371c">pTempHelicopterPath</a>, 0 );
<a name="l02060"></a>02060 
<a name="l02061"></a>02061       <span class="comment">// is cursor allowed here?..if not..don't build temp path</span>
<a name="l02062"></a>02062       <span class="keywordflow">if</span>( !<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#3c7416b480dd2f68e51127e192589889">IsTheCursorAllowedToHighLightThisSector</a>( sX, sY ) )
<a name="l02063"></a>02063       {
<a name="l02064"></a>02064             <span class="keywordflow">return</span>;
<a name="l02065"></a>02065       }
<a name="l02066"></a>02066 
<a name="l02067"></a>02067       <span class="comment">// build path</span>
<a name="l02068"></a>02068       <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#1bf007b81a4981f019caede54e60371c">pTempHelicopterPath</a> = <a class="code" href="Strategic_01Pathing_8cpp.html#fdeccb39503fd81c6c785800c4fe3394">BuildAStrategicPath</a>( NULL, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#c2b28ef2ffdced61f5a81875f0efde67">GetLastSectorOfHelicoptersPath</a>( ), ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> )( sX + sY*( MAP_WORLD_X ) ), <a class="code" href="Vehicles_8cpp.html#f2797a2fc8430fa3072bca3e40d70e24">pVehicleList</a>[ <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#83461889711d71f15a4546aee8f6c062">iHelicopterVehicleId</a> ].ubMovementGroup, FALSE <span class="comment">/*, TRUE */</span> );
<a name="l02069"></a>02069 
<a name="l02070"></a>02070       <span class="keywordflow">return</span>;
<a name="l02071"></a>02071 }
<a name="l02072"></a>02072 
<a name="l02073"></a>02073 
<a name="l02074"></a>02074 <span class="comment">// clear out helicopter path list, after and including this sector</span>
<a name="l02075"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#0c54016945fde203704d64d776547b24">02075</a> <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0c54016945fde203704d64d776547b24">ClearPathAfterThisSectorForHelicopter</a>( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sY )
<a name="l02076"></a>02076 {
<a name="l02077"></a>02077       <a class="code" href="structVEHICLETYPE.html">VEHICLETYPE</a> *pVehicle = NULL;
<a name="l02078"></a>02078       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iOrigLength = 0;
<a name="l02079"></a>02079 
<a name="l02080"></a>02080 
<a name="l02081"></a>02081       <span class="comment">// clear out helicopter path list, after and including this sector</span>
<a name="l02082"></a>02082       <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#83461889711d71f15a4546aee8f6c062">iHelicopterVehicleId</a> == -1 ||  !<a class="code" href="Map_01Screen_01Helicopter_8cpp.html#b281a47b43b858922b387ab3b95f9039">CanHelicopterFly</a>() )
<a name="l02083"></a>02083       {
<a name="l02084"></a>02084             <span class="comment">// abort plotting, shouldn't even be here</span>
<a name="l02085"></a>02085             <span class="keywordflow">return</span>( <a class="code" href="Map_01Screen_01Interface_01Map_8h.html#f26f449e73437e60d22c20b4f2cb2ace8c1cd723ea7c92d0b65127d9dd30ae29">ABORT_PLOTTING</a> );
<a name="l02086"></a>02086       }
<a name="l02087"></a>02087 
<a name="l02088"></a>02088 
<a name="l02089"></a>02089       pVehicle = &amp;( <a class="code" href="Vehicles_8cpp.html#f2797a2fc8430fa3072bca3e40d70e24">pVehicleList</a>[ <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#83461889711d71f15a4546aee8f6c062">iHelicopterVehicleId</a> ] );
<a name="l02090"></a>02090 
<a name="l02091"></a>02091 
<a name="l02092"></a>02092       iOrigLength = <a class="code" href="Strategic_01Pathing_8cpp.html#1ac6358b29a1610d12a3e6ebbb0ead5e">GetLengthOfPath</a>( pVehicle-&gt;<a class="code" href="structVEHICLETYPE.html#3a7c232b99765513fb6d8b61cc65b74f">pMercPath</a> );
<a name="l02093"></a>02093       <span class="keywordflow">if</span>( !iOrigLength )
<a name="l02094"></a>02094       {
<a name="l02095"></a>02095             <span class="comment">// no previous path, nothing to do, and we didn't shorten it</span>
<a name="l02096"></a>02096             <span class="keywordflow">return</span>( <a class="code" href="Map_01Screen_01Interface_01Map_8h.html#f26f449e73437e60d22c20b4f2cb2ace8c1cd723ea7c92d0b65127d9dd30ae29">ABORT_PLOTTING</a> );
<a name="l02097"></a>02097       }
<a name="l02098"></a>02098 
<a name="l02099"></a>02099 
<a name="l02100"></a>02100       <span class="comment">// are we clearing everything beyond the helicopter's CURRENT sector?</span>
<a name="l02101"></a>02101       <span class="keywordflow">if</span> ( ( sX == pVehicle-&gt;<a class="code" href="structVEHICLETYPE.html#563484836223d228a81a81d4cf823360">sSectorX</a> ) &amp;&amp; ( sY == pVehicle-&gt;<a class="code" href="structVEHICLETYPE.html#27c03977c142f72a74c14a1b9d1a668b">sSectorY</a> ) )
<a name="l02102"></a>02102       {
<a name="l02103"></a>02103             <span class="comment">// if we're in confirm map move mode, cancel that (before new UI messages are issued)</span>
<a name="l02104"></a>02104             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#55439cd851632864056aa80626de1855">EndConfirmMapMoveMode</a>( );
<a name="l02105"></a>02105 
<a name="l02106"></a>02106             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#a00a7e995f139179f66e88a85d1323c0">CancelPathForVehicle</a>( pVehicle, FALSE );
<a name="l02107"></a>02107             <span class="keywordflow">return</span>( <a class="code" href="Map_01Screen_01Interface_01Map_8h.html#f26f449e73437e60d22c20b4f2cb2ace2abb998a5bbf061715a2045292efa045">PATH_CLEARED</a> );
<a name="l02108"></a>02108       }
<a name="l02109"></a>02109       <span class="keywordflow">else</span>  <span class="comment">// click not in the current sector</span>
<a name="l02110"></a>02110       {
<a name="l02111"></a>02111             <span class="comment">// if the clicked sector is along current route, this will repath only as far as it.  If not, the entire path will</span>
<a name="l02112"></a>02112             <span class="comment">// be canceled.</span>
<a name="l02113"></a>02113             pVehicle-&gt;<a class="code" href="structVEHICLETYPE.html#3a7c232b99765513fb6d8b61cc65b74f">pMercPath</a> = <a class="code" href="Strategic_01Pathing_8cpp.html#969dbd8bd0ea41107da6205d34ea8411">ClearStrategicPathListAfterThisSector</a>( pVehicle-&gt;<a class="code" href="structVEHICLETYPE.html#3a7c232b99765513fb6d8b61cc65b74f">pMercPath</a>, sX, sY, pVehicle-&gt;<a class="code" href="structVEHICLETYPE.html#331f52ad0cd0408b4051bd420cf44c04">ubMovementGroup</a> );
<a name="l02114"></a>02114 
<a name="l02115"></a>02115             <span class="keywordflow">if</span>( <a class="code" href="Strategic_01Pathing_8cpp.html#1ac6358b29a1610d12a3e6ebbb0ead5e">GetLengthOfPath</a>( pVehicle-&gt;<a class="code" href="structVEHICLETYPE.html#3a7c232b99765513fb6d8b61cc65b74f">pMercPath</a> ) &lt; iOrigLength )
<a name="l02116"></a>02116             {
<a name="l02117"></a>02117                   <span class="comment">// really shortened!</span>
<a name="l02118"></a>02118                   <span class="keywordflow">return</span>( <a class="code" href="Map_01Screen_01Interface_01Map_8h.html#f26f449e73437e60d22c20b4f2cb2ace29cc8f3f59d974d3276255e562c7657f">PATH_SHORTENED</a> );
<a name="l02119"></a>02119             }
<a name="l02120"></a>02120             <span class="keywordflow">else</span>
<a name="l02121"></a>02121             {
<a name="l02122"></a>02122                   <span class="comment">// same path as before - it's not any shorter</span>
<a name="l02123"></a>02123                   <span class="keywordflow">return</span> ( <a class="code" href="Map_01Screen_01Interface_01Map_8h.html#f26f449e73437e60d22c20b4f2cb2ace8c1cd723ea7c92d0b65127d9dd30ae29">ABORT_PLOTTING</a> );
<a name="l02124"></a>02124             }
<a name="l02125"></a>02125       }
<a name="l02126"></a>02126 }
<a name="l02127"></a>02127 
<a name="l02128"></a>02128 
<a name="l02129"></a>02129 
<a name="l02130"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#c2b28ef2ffdced61f5a81875f0efde67">02130</a> <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#c2b28ef2ffdced61f5a81875f0efde67">GetLastSectorOfHelicoptersPath</a>( <span class="keywordtype">void</span> )
<a name="l02131"></a>02131 {
<a name="l02132"></a>02132       <span class="comment">// will return the last sector of the helicopter's current path</span>
<a name="l02133"></a>02133       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sLastSector = <a class="code" href="Vehicles_8cpp.html#f2797a2fc8430fa3072bca3e40d70e24">pVehicleList</a>[ <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#83461889711d71f15a4546aee8f6c062">iHelicopterVehicleId</a> ].<a class="code" href="structVEHICLETYPE.html#563484836223d228a81a81d4cf823360">sSectorX</a> + <a class="code" href="Vehicles_8cpp.html#f2797a2fc8430fa3072bca3e40d70e24">pVehicleList</a>[ <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#83461889711d71f15a4546aee8f6c062">iHelicopterVehicleId</a> ].<a class="code" href="structVEHICLETYPE.html#27c03977c142f72a74c14a1b9d1a668b">sSectorY</a> * MAP_WORLD_X ;
<a name="l02134"></a>02134       <a class="code" href="structpath.html">PathStPtr</a> pNode = NULL;
<a name="l02135"></a>02135 
<a name="l02136"></a>02136       pNode = <a class="code" href="Vehicles_8cpp.html#f2797a2fc8430fa3072bca3e40d70e24">pVehicleList</a>[ <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#83461889711d71f15a4546aee8f6c062">iHelicopterVehicleId</a> ].<a class="code" href="structVEHICLETYPE.html#3a7c232b99765513fb6d8b61cc65b74f">pMercPath</a>;
<a name="l02137"></a>02137 
<a name="l02138"></a>02138       <span class="keywordflow">while</span>( pNode )
<a name="l02139"></a>02139       {
<a name="l02140"></a>02140             sLastSector = ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> ) ( pNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a> );
<a name="l02141"></a>02141             pNode = pNode-&gt;<a class="code" href="structpath.html#3aece431545f290e21842d7ddd3d78af">pNext</a>;
<a name="l02142"></a>02142       }
<a name="l02143"></a>02143 
<a name="l02144"></a>02144       <span class="keywordflow">return</span> sLastSector;
<a name="l02145"></a>02145 }
<a name="l02146"></a>02146 
<a name="l02147"></a>02147 
<a name="l02148"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#bbcdaf34677e2947a1c2f8284dbe232d">02148</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#bbcdaf34677e2947a1c2f8284dbe232d">TracePathRoute</a>(<a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fCheckFlag, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fForceUpDate, <a class="code" href="structpath.html">PathStPtr</a> pPath )
<a name="l02149"></a>02149 {
<a name="l02150"></a>02150  <a class="code" href="structpath.html">PathStPtr</a> pCurrentNode=NULL;
<a name="l02151"></a>02151  <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fSpeedFlag=FALSE;
<a name="l02152"></a>02152  <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fUpDate=FALSE;
<a name="l02153"></a>02153  <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iDifference=0;
<a name="l02154"></a>02154  <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iArrow=-1;
<a name="l02155"></a>02155  <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, iY;
<a name="l02156"></a>02156  <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sX, sY;
<a name="l02157"></a>02157  <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iArrowX, iArrowY;
<a name="l02158"></a>02158  <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iDeltaA, iDeltaB, iDeltaB1;
<a name="l02159"></a>02159  <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iDirection = 0;
<a name="l02160"></a>02160  <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fUTurnFlag=FALSE;
<a name="l02161"></a>02161  <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fNextNode=FALSE;
<a name="l02162"></a>02162  <a class="code" href="structpath.html">PathStPtr</a> pTempNode=NULL;
<a name="l02163"></a>02163  <a class="code" href="structpath.html">PathStPtr</a> pNode=NULL;
<a name="l02164"></a>02164  <a class="code" href="structpath.html">PathStPtr</a> pPastNode=NULL;
<a name="l02165"></a>02165  <a class="code" href="structpath.html">PathStPtr</a> pNextNode=NULL;
<a name="l02166"></a>02166  UINT ubCounter = 1;
<a name="l02167"></a>02167  <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hMapHandle;
<a name="l02168"></a>02168 
<a name="l02169"></a>02169 
<a name="l02170"></a>02170  <span class="keywordflow">if</span> ( pPath==NULL )
<a name="l02171"></a>02171  {
<a name="l02172"></a>02172        <span class="keywordflow">return</span> FALSE;
<a name="l02173"></a>02173  }
<a name="l02174"></a>02174  
<a name="l02175"></a>02175 
<a name="l02176"></a>02176  <span class="keywordflow">while</span>( pPath-&gt;<a class="code" href="structpath.html#ecc4d365e64a642f64983a12f7dfc313">pPrev</a> )
<a name="l02177"></a>02177  {
<a name="l02178"></a>02178        pPath = pPath-&gt;<a class="code" href="structpath.html#ecc4d365e64a642f64983a12f7dfc313">pPrev</a>;
<a name="l02179"></a>02179  }
<a name="l02180"></a>02180 
<a name="l02181"></a>02181  pNode = pPath;
<a name="l02182"></a>02182 
<a name="l02183"></a>02183   iDirection=-1;
<a name="l02184"></a>02184       <span class="keywordflow">if</span> (pNode-&gt;<a class="code" href="structpath.html#3aece431545f290e21842d7ddd3d78af">pNext</a>)
<a name="l02185"></a>02185        pNextNode=pNode-&gt;<a class="code" href="structpath.html#3aece431545f290e21842d7ddd3d78af">pNext</a>;
<a name="l02186"></a>02186       <span class="keywordflow">else</span>
<a name="l02187"></a>02187             pNextNode=NULL;
<a name="l02188"></a>02188       <span class="keywordflow">if</span> (pNode-&gt;<a class="code" href="structpath.html#ecc4d365e64a642f64983a12f7dfc313">pPrev</a>)
<a name="l02189"></a>02189        pPastNode=pNode-&gt;<a class="code" href="structpath.html#ecc4d365e64a642f64983a12f7dfc313">pPrev</a>;
<a name="l02190"></a>02190       <span class="keywordflow">else</span>
<a name="l02191"></a>02191             pPastNode=NULL;
<a name="l02192"></a>02192 
<a name="l02193"></a>02193   <a class="code" href="vobject_8cpp.html#bda2b0eae4cb40e612dffd307ad5c692">GetVideoObject</a>(&amp;hMapHandle, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#13645a6fb711d57c89346f6c66c4c577">guiMAPCURSORS</a>); 
<a name="l02194"></a>02194             <span class="comment">// go through characters list and display arrows for path</span>
<a name="l02195"></a>02195  <span class="keywordflow">while</span>(pNode)
<a name="l02196"></a>02196             {
<a name="l02197"></a>02197              fUTurnFlag=FALSE;
<a name="l02198"></a>02198      <span class="keywordflow">if</span> ((pPastNode)&amp;&amp;(pNextNode))
<a name="l02199"></a>02199              {
<a name="l02200"></a>02200       iDeltaA=(<a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a>)pNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>-(<a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a>)pPastNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>;
<a name="l02201"></a>02201               iDeltaB=(<a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a>)pNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>-(<a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a>)pNextNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>;
<a name="l02202"></a>02202                   <span class="keywordflow">if</span> (iDeltaA ==0)
<a name="l02203"></a>02203                <span class="keywordflow">return</span>( FALSE );
<a name="l02204"></a>02204      <span class="keywordflow">if</span>(pNode-&gt;<a class="code" href="structpath.html#546cbaeb8d8e229fd5beb09ce1b8d9c9">fSpeed</a>)
<a name="l02205"></a>02205                    fSpeedFlag=FALSE;
<a name="l02206"></a>02206              <span class="keywordflow">else</span>
<a name="l02207"></a>02207                    fSpeedFlag=TRUE;
<a name="l02208"></a>02208                   <span class="keywordflow">if</span>(!<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l02209"></a>02209                   {
<a name="l02210"></a>02210        iX=(pNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>%MAP_WORLD_X);
<a name="l02211"></a>02211                iY=(pNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>/MAP_WORLD_X);
<a name="l02212"></a>02212                iX=(iX*MAP_GRID_X)+MAP_VIEW_START_X;
<a name="l02213"></a>02213                iY=(iY*MAP_GRID_Y)+MAP_VIEW_START_Y;
<a name="l02214"></a>02214        
<a name="l02215"></a>02215                   }
<a name="l02216"></a>02216                   <span class="keywordflow">else</span>
<a name="l02217"></a>02217                   {
<a name="l02218"></a>02218        <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#61b609e8ae7546838d7b9b106d25ff3a">GetScreenXYFromMapXYStationary</a>( ((<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>)(pNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>%MAP_WORLD_X)),((UINT16)(pNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>/MAP_WORLD_X)) , &amp;sX, &amp;sY ); 
<a name="l02219"></a>02219                    iY=sY-MAP_GRID_Y;
<a name="l02220"></a>02220                    iX=sX-MAP_GRID_X;       
<a name="l02221"></a>02221                   }
<a name="l02222"></a>02222                   iArrowX=iX;
<a name="l02223"></a>02223                   iArrowY=iY; 
<a name="l02224"></a>02224               <span class="keywordflow">if</span> ((pPastNode-&gt;<a class="code" href="structpath.html#ecc4d365e64a642f64983a12f7dfc313">pPrev</a>)&amp;&amp;(pNextNode-&gt;<a class="code" href="structpath.html#3aece431545f290e21842d7ddd3d78af">pNext</a>)) 
<a name="l02225"></a>02225       {
<a name="l02226"></a>02226        fUTurnFlag=FALSE;
<a name="l02227"></a>02227                         <span class="comment">// check to see if out-of sector U-turn</span>
<a name="l02228"></a>02228         <span class="comment">// for placement of arrows</span>
<a name="l02229"></a>02229                    iDeltaB1=pNextNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>-pNextNode-&gt;<a class="code" href="structpath.html#3aece431545f290e21842d7ddd3d78af">pNext</a>-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>;
<a name="l02230"></a>02230                    <span class="keywordflow">if</span> ((iDeltaB1==-WORLD_MAP_X)&amp;&amp;(iDeltaA==-WORLD_MAP_X)&amp;&amp;(iDeltaB==-1))
<a name="l02231"></a>02231                    {
<a name="l02232"></a>02232                          fUTurnFlag=TRUE;
<a name="l02233"></a>02233                    }
<a name="l02234"></a>02234                    <span class="keywordflow">else</span> <span class="keywordflow">if</span>((iDeltaB1==-WORLD_MAP_X)&amp;&amp;(iDeltaA==-WORLD_MAP_X)&amp;&amp;(iDeltaB==1))
<a name="l02235"></a>02235                    {
<a name="l02236"></a>02236                          fUTurnFlag=TRUE;
<a name="l02237"></a>02237                    }
<a name="l02238"></a>02238                    <span class="keywordflow">else</span> <span class="keywordflow">if</span>((iDeltaB1==WORLD_MAP_X)&amp;&amp;(iDeltaA==WORLD_MAP_X)&amp;&amp;(iDeltaB==1))
<a name="l02239"></a>02239                    {
<a name="l02240"></a>02240                          fUTurnFlag=TRUE;
<a name="l02241"></a>02241                    }
<a name="l02242"></a>02242                    <span class="keywordflow">else</span> <span class="keywordflow">if</span>((iDeltaB1==-WORLD_MAP_X)&amp;&amp;(iDeltaA==-WORLD_MAP_X)&amp;&amp;(iDeltaB==1))
<a name="l02243"></a>02243                    {
<a name="l02244"></a>02244                          fUTurnFlag=TRUE;
<a name="l02245"></a>02245                    }
<a name="l02246"></a>02246                    <span class="keywordflow">else</span> <span class="keywordflow">if</span>((iDeltaB1==-1)&amp;&amp;(iDeltaA==-1)&amp;&amp;(iDeltaB==-WORLD_MAP_X))
<a name="l02247"></a>02247                    {
<a name="l02248"></a>02248                          fUTurnFlag=TRUE;
<a name="l02249"></a>02249                    }
<a name="l02250"></a>02250                    <span class="keywordflow">else</span> <span class="keywordflow">if</span>((iDeltaB1==-1)&amp;&amp;(iDeltaA==-1)&amp;&amp;(iDeltaB==WORLD_MAP_X))
<a name="l02251"></a>02251                    {
<a name="l02252"></a>02252                          fUTurnFlag=TRUE;
<a name="l02253"></a>02253                    }
<a name="l02254"></a>02254        <span class="keywordflow">else</span> <span class="keywordflow">if</span>((iDeltaB1==1)&amp;&amp;(iDeltaA==1)&amp;&amp;(iDeltaB==-WORLD_MAP_X))
<a name="l02255"></a>02255                    {
<a name="l02256"></a>02256                          fUTurnFlag=TRUE;
<a name="l02257"></a>02257                    }
<a name="l02258"></a>02258         <span class="keywordflow">else</span> <span class="keywordflow">if</span>((iDeltaB1==1)&amp;&amp;(iDeltaA==1)&amp;&amp;(iDeltaB==WORLD_MAP_X))
<a name="l02259"></a>02259                    {
<a name="l02260"></a>02260                          fUTurnFlag=TRUE;
<a name="l02261"></a>02261                    }
<a name="l02262"></a>02262        <span class="keywordflow">else</span>
<a name="l02263"></a>02263                          fUTurnFlag=FALSE;
<a name="l02264"></a>02264                    }
<a name="l02265"></a>02265                   
<a name="l02266"></a>02266                   
<a name="l02267"></a>02267       
<a name="l02268"></a>02268        <span class="keywordflow">if</span> ((pPastNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>==pNextNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>))
<a name="l02269"></a>02269                         {
<a name="l02270"></a>02270                          <span class="keywordflow">if</span> (pPastNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>+WORLD_MAP_X==pNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>)
<a name="l02271"></a>02271                          {
<a name="l02272"></a>02272            <span class="keywordflow">if</span>(!(pNode-&gt;<a class="code" href="structpath.html#546cbaeb8d8e229fd5beb09ce1b8d9c9">fSpeed</a>))
<a name="l02273"></a>02273                                      fSpeedFlag=TRUE;
<a name="l02274"></a>02274                                <span class="keywordflow">else</span>
<a name="l02275"></a>02275                                      fSpeedFlag=FALSE;
<a name="l02276"></a>02276                               
<a name="l02277"></a>02277                                <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l02278"></a>02278                               {
<a name="l02279"></a>02279                                iDirection=S_TO_N_ZOOM_LINE;
<a name="l02280"></a>02280            <span class="keywordflow">if</span>(fSpeedFlag)
<a name="l02281"></a>02281                                 iArrow=ZOOM_Y_NORTH_ARROW;
<a name="l02282"></a>02282                                <span class="keywordflow">else</span>
<a name="l02283"></a>02283                                 iArrow=ZOOM_NORTH_ARROW;
<a name="l02284"></a>02284                                iArrowX+=NORTH_OFFSET_X*2;
<a name="l02285"></a>02285                                iArrowY+=NORTH_OFFSET_Y*2;
<a name="l02286"></a>02286                               }
<a name="l02287"></a>02287           <span class="keywordflow">else</span>
<a name="l02288"></a>02288           {
<a name="l02289"></a>02289                                iDirection=S_TO_N_LINE;
<a name="l02290"></a>02290                                <span class="keywordflow">if</span>(fSpeedFlag)
<a name="l02291"></a>02291                                 iArrow=Y_NORTH_ARROW;
<a name="l02292"></a>02292                                <span class="keywordflow">else</span>
<a name="l02293"></a>02293                                iArrow=NORTH_ARROW;
<a name="l02294"></a>02294                                iArrowX+=NORTH_OFFSET_X;
<a name="l02295"></a>02295                                iArrowY+=NORTH_OFFSET_Y;
<a name="l02296"></a>02296                               }
<a name="l02297"></a>02297                          }
<a name="l02298"></a>02298                          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(pPastNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>-WORLD_MAP_X==pNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>)
<a name="l02299"></a>02299                          {
<a name="l02300"></a>02300           <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l02301"></a>02301                               {
<a name="l02302"></a>02302                                iDirection=N_TO_S_ZOOM_LINE;
<a name="l02303"></a>02303            <span class="keywordflow">if</span>(fSpeedFlag)
<a name="l02304"></a>02304                                 iArrow=ZOOM_Y_SOUTH_ARROW;
<a name="l02305"></a>02305                                <span class="keywordflow">else</span>
<a name="l02306"></a>02306                                 iArrow=ZOOM_SOUTH_ARROW;
<a name="l02307"></a>02307                                iArrowX+=SOUTH_OFFSET_X*2;
<a name="l02308"></a>02308                                iArrowY+=SOUTH_OFFSET_Y*2;
<a name="l02309"></a>02309                               }
<a name="l02310"></a>02310           <span class="keywordflow">else</span>
<a name="l02311"></a>02311                               {
<a name="l02312"></a>02312            iDirection=N_TO_S_LINE;
<a name="l02313"></a>02313            <span class="keywordflow">if</span>(fSpeedFlag)
<a name="l02314"></a>02314                                 iArrow=Y_SOUTH_ARROW;
<a name="l02315"></a>02315                                <span class="keywordflow">else</span>
<a name="l02316"></a>02316                                iArrow=SOUTH_ARROW;
<a name="l02317"></a>02317                                iArrowX+=SOUTH_OFFSET_X;
<a name="l02318"></a>02318                                iArrowY+=SOUTH_OFFSET_Y;
<a name="l02319"></a>02319                               }
<a name="l02320"></a>02320                          }
<a name="l02321"></a>02321                          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pPastNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>+1==pNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>)
<a name="l02322"></a>02322                          {
<a name="l02323"></a>02323           <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l02324"></a>02324                               {
<a name="l02325"></a>02325                                iDirection=E_TO_W_ZOOM_LINE;
<a name="l02326"></a>02326            <span class="keywordflow">if</span>(fSpeedFlag)
<a name="l02327"></a>02327                                 iArrow=ZOOM_Y_WEST_ARROW;
<a name="l02328"></a>02328                                <span class="keywordflow">else</span>
<a name="l02329"></a>02329                                iArrow=ZOOM_WEST_ARROW;
<a name="l02330"></a>02330                                iArrowX+=WEST_OFFSET_X*2;
<a name="l02331"></a>02331                                iArrowY+=WEST_OFFSET_Y*2;
<a name="l02332"></a>02332                               }
<a name="l02333"></a>02333           <span class="keywordflow">else</span>
<a name="l02334"></a>02334                               {
<a name="l02335"></a>02335                                iDirection=E_TO_W_LINE;
<a name="l02336"></a>02336            <span class="keywordflow">if</span>(fSpeedFlag)
<a name="l02337"></a>02337                                 iArrow=Y_WEST_ARROW;
<a name="l02338"></a>02338                                <span class="keywordflow">else</span>
<a name="l02339"></a>02339                                 iArrow=WEST_ARROW;
<a name="l02340"></a>02340                                iArrowX+=WEST_OFFSET_X;
<a name="l02341"></a>02341                                iArrowY+=WEST_OFFSET_Y;
<a name="l02342"></a>02342                               }
<a name="l02343"></a>02343                          }
<a name="l02344"></a>02344                          <span class="keywordflow">else</span>
<a name="l02345"></a>02345                          {
<a name="l02346"></a>02346           <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l02347"></a>02347                               {
<a name="l02348"></a>02348                                iDirection=W_TO_E_ZOOM_LINE;
<a name="l02349"></a>02349            <span class="keywordflow">if</span>(fSpeedFlag)
<a name="l02350"></a>02350                                 iArrow=ZOOM_Y_EAST_ARROW;
<a name="l02351"></a>02351                                <span class="keywordflow">else</span>
<a name="l02352"></a>02352                                 iArrow=ZOOM_EAST_ARROW;
<a name="l02353"></a>02353                                iArrowX+=EAST_OFFSET_X*2;
<a name="l02354"></a>02354                                iArrowY+=EAST_OFFSET_Y*2;
<a name="l02355"></a>02355                               }
<a name="l02356"></a>02356           <span class="keywordflow">else</span>
<a name="l02357"></a>02357                               {
<a name="l02358"></a>02358            iDirection=W_TO_E_LINE;
<a name="l02359"></a>02359                                <span class="keywordflow">if</span>(fSpeedFlag)
<a name="l02360"></a>02360                                 iArrow=Y_EAST_ARROW;
<a name="l02361"></a>02361                                <span class="keywordflow">else</span>
<a name="l02362"></a>02362                                 iArrow=EAST_ARROW;
<a name="l02363"></a>02363                                iArrowX+=EAST_OFFSET_X;
<a name="l02364"></a>02364                                iArrowY+=EAST_OFFSET_Y;
<a name="l02365"></a>02365                               }
<a name="l02366"></a>02366                          }
<a name="l02367"></a>02367                         }
<a name="l02368"></a>02368                    <span class="keywordflow">else</span>
<a name="l02369"></a>02369                    {
<a name="l02370"></a>02370         <span class="keywordflow">if</span> ((iDeltaA==-1)&amp;&amp;(iDeltaB==1))
<a name="l02371"></a>02371                         {
<a name="l02372"></a>02372 <span class="comment">/*</span>
<a name="l02373"></a>02373 <span class="comment">                              if( pPastNode == NULL )</span>
<a name="l02374"></a>02374 <span class="comment">                              {</span>
<a name="l02375"></a>02375 <span class="comment">                                    fSpeedFlag = !fSpeedFlag;</span>
<a name="l02376"></a>02376 <span class="comment">                              }</span>
<a name="l02377"></a>02377 <span class="comment"></span>
<a name="l02378"></a>02378 <span class="comment">*/</span>
<a name="l02379"></a>02379           <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l02380"></a>02380                               {
<a name="l02381"></a>02381                                iDirection=WEST_ZOOM_LINE;
<a name="l02382"></a>02382            <span class="keywordflow">if</span>(fSpeedFlag)
<a name="l02383"></a>02383                                 iArrow=ZOOM_Y_WEST_ARROW;
<a name="l02384"></a>02384                                <span class="keywordflow">else</span>
<a name="l02385"></a>02385                                 iArrow=ZOOM_WEST_ARROW;
<a name="l02386"></a>02386                iArrowX+=WEST_OFFSET_X*2;
<a name="l02387"></a>02387                                iArrowY+=WEST_OFFSET_Y*2;
<a name="l02388"></a>02388                               }
<a name="l02389"></a>02389           <span class="keywordflow">else</span>
<a name="l02390"></a>02390                               {
<a name="l02391"></a>02391                                iDirection=WEST_LINE;
<a name="l02392"></a>02392                                <span class="keywordflow">if</span>(fSpeedFlag)
<a name="l02393"></a>02393                                 iArrow=Y_WEST_ARROW;
<a name="l02394"></a>02394                                <span class="keywordflow">else</span>
<a name="l02395"></a>02395                                 iArrow=WEST_ARROW;
<a name="l02396"></a>02396                iArrowX+=WEST_OFFSET_X;
<a name="l02397"></a>02397                                iArrowY+=WEST_OFFSET_Y;
<a name="l02398"></a>02398                               }
<a name="l02399"></a>02399                         }
<a name="l02400"></a>02400                         <span class="keywordflow">else</span> <span class="keywordflow">if</span>((iDeltaA==1)&amp;&amp;(iDeltaB==-1))
<a name="l02401"></a>02401                         {
<a name="l02402"></a>02402           <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l02403"></a>02403                               {
<a name="l02404"></a>02404                                iDirection=EAST_ZOOM_LINE;
<a name="l02405"></a>02405            <span class="keywordflow">if</span>(fSpeedFlag)
<a name="l02406"></a>02406                                 iArrow=ZOOM_Y_EAST_ARROW;
<a name="l02407"></a>02407                                <span class="keywordflow">else</span>
<a name="l02408"></a>02408                                 iArrow=ZOOM_EAST_ARROW;
<a name="l02409"></a>02409                                iArrowX+=EAST_OFFSET_X*2;
<a name="l02410"></a>02410                                iArrowY+=EAST_OFFSET_Y*2;
<a name="l02411"></a>02411                               }
<a name="l02412"></a>02412           <span class="keywordflow">else</span>
<a name="l02413"></a>02413                               {
<a name="l02414"></a>02414                                iDirection=EAST_LINE;
<a name="l02415"></a>02415                                <span class="keywordflow">if</span>(fSpeedFlag)
<a name="l02416"></a>02416                                 iArrow=Y_EAST_ARROW;
<a name="l02417"></a>02417                                <span class="keywordflow">else</span>
<a name="l02418"></a>02418                                 iArrow=EAST_ARROW;
<a name="l02419"></a>02419                                iArrowX+=EAST_OFFSET_X;
<a name="l02420"></a>02420                                iArrowY+=EAST_OFFSET_Y;
<a name="l02421"></a>02421                               }
<a name="l02422"></a>02422                         }
<a name="l02423"></a>02423                         <span class="keywordflow">else</span> <span class="keywordflow">if</span>((iDeltaA==-WORLD_MAP_X)&amp;&amp;(iDeltaB==WORLD_MAP_X))
<a name="l02424"></a>02424                         {
<a name="l02425"></a>02425           <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l02426"></a>02426                               {
<a name="l02427"></a>02427                                iDirection=NORTH_ZOOM_LINE;
<a name="l02428"></a>02428            <span class="keywordflow">if</span>(fSpeedFlag)
<a name="l02429"></a>02429                                 iArrow=ZOOM_Y_NORTH_ARROW;
<a name="l02430"></a>02430                                <span class="keywordflow">else</span>
<a name="l02431"></a>02431                                iArrow=ZOOM_NORTH_ARROW;
<a name="l02432"></a>02432                                iArrowX+=NORTH_OFFSET_X*2;
<a name="l02433"></a>02433                                iArrowY+=NORTH_OFFSET_Y*2;
<a name="l02434"></a>02434                               }
<a name="l02435"></a>02435           <span class="keywordflow">else</span>
<a name="l02436"></a>02436                               {
<a name="l02437"></a>02437                                iDirection=NORTH_LINE;
<a name="l02438"></a>02438                                <span class="keywordflow">if</span>(fSpeedFlag)
<a name="l02439"></a>02439                                 iArrow=Y_NORTH_ARROW;
<a name="l02440"></a>02440                                <span class="keywordflow">else</span>
<a name="l02441"></a>02441                                 iArrow=NORTH_ARROW;
<a name="l02442"></a>02442            iArrowX+=NORTH_OFFSET_X;
<a name="l02443"></a>02443                                iArrowY+=NORTH_OFFSET_Y;
<a name="l02444"></a>02444                               }
<a name="l02445"></a>02445                         }
<a name="l02446"></a>02446                         <span class="keywordflow">else</span> <span class="keywordflow">if</span>((iDeltaA==WORLD_MAP_X)&amp;&amp;(iDeltaB==-WORLD_MAP_X))
<a name="l02447"></a>02447                         {
<a name="l02448"></a>02448          <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l02449"></a>02449                          {
<a name="l02450"></a>02450                               iDirection=SOUTH_ZOOM_LINE;
<a name="l02451"></a>02451            <span class="keywordflow">if</span>(fSpeedFlag)
<a name="l02452"></a>02452                                 iArrow=ZOOM_Y_SOUTH_ARROW;
<a name="l02453"></a>02453                                <span class="keywordflow">else</span>
<a name="l02454"></a>02454                               iArrow=ZOOM_SOUTH_ARROW;
<a name="l02455"></a>02455           iArrowX+=SOUTH_OFFSET_X*2;
<a name="l02456"></a>02456                           iArrowY+=SOUTH_OFFSET_Y*2;
<a name="l02457"></a>02457                          }
<a name="l02458"></a>02458          <span class="keywordflow">else</span>
<a name="l02459"></a>02459                          {
<a name="l02460"></a>02460                               iDirection=SOUTH_LINE;
<a name="l02461"></a>02461                           <span class="keywordflow">if</span>(fSpeedFlag)
<a name="l02462"></a>02462                                iArrow=Y_SOUTH_ARROW;
<a name="l02463"></a>02463                               <span class="keywordflow">else</span>
<a name="l02464"></a>02464                               iArrow=SOUTH_ARROW;
<a name="l02465"></a>02465           iArrowX+=SOUTH_OFFSET_X;
<a name="l02466"></a>02466                           iArrowY+=SOUTH_OFFSET_Y;
<a name="l02467"></a>02467                          }
<a name="l02468"></a>02468                         }
<a name="l02469"></a>02469                         <span class="keywordflow">else</span> <span class="keywordflow">if</span>((iDeltaA==-WORLD_MAP_X)&amp;&amp;(iDeltaB==-1))
<a name="l02470"></a>02470                         {
<a name="l02471"></a>02471           <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l02472"></a>02472                               {
<a name="l02473"></a>02473                                iDirection=N_TO_E_ZOOM_LINE;
<a name="l02474"></a>02474            <span class="keywordflow">if</span>(fSpeedFlag)
<a name="l02475"></a>02475                                 iArrow=ZOOM_Y_EAST_ARROW;
<a name="l02476"></a>02476                                <span class="keywordflow">else</span>
<a name="l02477"></a>02477                                 iArrow=ZOOM_EAST_ARROW;
<a name="l02478"></a>02478            iArrowX+=EAST_OFFSET_X*2;
<a name="l02479"></a>02479                                iArrowY+=EAST_OFFSET_Y*2;
<a name="l02480"></a>02480                               }
<a name="l02481"></a>02481           <span class="keywordflow">else</span>
<a name="l02482"></a>02482                               {
<a name="l02483"></a>02483                                iDirection=N_TO_E_LINE;
<a name="l02484"></a>02484                                <span class="keywordflow">if</span>(fSpeedFlag)
<a name="l02485"></a>02485                                 iArrow=Y_EAST_ARROW;
<a name="l02486"></a>02486                                <span class="keywordflow">else</span>
<a name="l02487"></a>02487                                iArrow=EAST_ARROW;
<a name="l02488"></a>02488            iArrowX+=EAST_OFFSET_X;
<a name="l02489"></a>02489                                iArrowY+=EAST_OFFSET_Y;
<a name="l02490"></a>02490                               }
<a name="l02491"></a>02491                         }
<a name="l02492"></a>02492                         <span class="keywordflow">else</span> <span class="keywordflow">if</span>((iDeltaA==WORLD_MAP_X)&amp;&amp;(iDeltaB==1))
<a name="l02493"></a>02493                         {
<a name="l02494"></a>02494           <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l02495"></a>02495                               {
<a name="l02496"></a>02496                                iDirection=S_TO_W_ZOOM_LINE;
<a name="l02497"></a>02497            <span class="keywordflow">if</span>(fSpeedFlag)
<a name="l02498"></a>02498                                iArrow=ZOOM_Y_WEST_ARROW;
<a name="l02499"></a>02499                               <span class="keywordflow">else</span>
<a name="l02500"></a>02500                                iArrow=ZOOM_WEST_ARROW;
<a name="l02501"></a>02501              iArrowX+=WEST_OFFSET_X*2;
<a name="l02502"></a>02502                                iArrowY+=WEST_OFFSET_Y*2;
<a name="l02503"></a>02503                               }
<a name="l02504"></a>02504           <span class="keywordflow">else</span>
<a name="l02505"></a>02505                               {
<a name="l02506"></a>02506                                iDirection=S_TO_W_LINE;
<a name="l02507"></a>02507                                <span class="keywordflow">if</span>(fSpeedFlag)
<a name="l02508"></a>02508                                iArrow=Y_WEST_ARROW;
<a name="l02509"></a>02509                               <span class="keywordflow">else</span>
<a name="l02510"></a>02510                                iArrow=WEST_ARROW;
<a name="l02511"></a>02511              iArrowX+=WEST_OFFSET_X;
<a name="l02512"></a>02512                                iArrowY+=WEST_OFFSET_Y;
<a name="l02513"></a>02513                               }
<a name="l02514"></a>02514                         }
<a name="l02515"></a>02515                         <span class="keywordflow">else</span> <span class="keywordflow">if</span>((iDeltaA==1)&amp;&amp;(iDeltaB==-WORLD_MAP_X))
<a name="l02516"></a>02516                         {
<a name="l02517"></a>02517           <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l02518"></a>02518                               {
<a name="l02519"></a>02519                                iDirection=E_TO_S_ZOOM_LINE;
<a name="l02520"></a>02520            <span class="keywordflow">if</span>(fSpeedFlag)
<a name="l02521"></a>02521                                 iArrow=ZOOM_Y_SOUTH_ARROW;
<a name="l02522"></a>02522                                <span class="keywordflow">else</span>
<a name="l02523"></a>02523                                 iArrow=ZOOM_SOUTH_ARROW;
<a name="l02524"></a>02524            iArrowX+=SOUTH_OFFSET_X*2;
<a name="l02525"></a>02525                                iArrowY+=SOUTH_OFFSET_Y*2;
<a name="l02526"></a>02526                               }
<a name="l02527"></a>02527           <span class="keywordflow">else</span>
<a name="l02528"></a>02528                               {
<a name="l02529"></a>02529                                iDirection=E_TO_S_LINE;
<a name="l02530"></a>02530                                <span class="keywordflow">if</span>(fSpeedFlag)
<a name="l02531"></a>02531                                 iArrow=Y_SOUTH_ARROW;
<a name="l02532"></a>02532                                <span class="keywordflow">else</span>
<a name="l02533"></a>02533                                 iArrow=SOUTH_ARROW;
<a name="l02534"></a>02534            iArrowX+=SOUTH_OFFSET_X;
<a name="l02535"></a>02535                                iArrowY+=SOUTH_OFFSET_Y;
<a name="l02536"></a>02536                               }
<a name="l02537"></a>02537                         }
<a name="l02538"></a>02538                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((iDeltaA==-1)&amp;&amp;(iDeltaB==WORLD_MAP_X))
<a name="l02539"></a>02539                         {
<a name="l02540"></a>02540           <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l02541"></a>02541                               {
<a name="l02542"></a>02542                                iDirection=W_TO_N_ZOOM_LINE;
<a name="l02543"></a>02543            <span class="keywordflow">if</span>(fSpeedFlag)
<a name="l02544"></a>02544                                 iArrow=ZOOM_Y_NORTH_ARROW;
<a name="l02545"></a>02545                                <span class="keywordflow">else</span>
<a name="l02546"></a>02546                                 iArrow=ZOOM_NORTH_ARROW;
<a name="l02547"></a>02547            iArrowX+=NORTH_OFFSET_X*2;
<a name="l02548"></a>02548                                iArrowY+=NORTH_OFFSET_Y*2;
<a name="l02549"></a>02549                               }
<a name="l02550"></a>02550           <span class="keywordflow">else</span>
<a name="l02551"></a>02551                               {
<a name="l02552"></a>02552                                iDirection=W_TO_N_LINE;
<a name="l02553"></a>02553                                <span class="keywordflow">if</span>(fSpeedFlag)
<a name="l02554"></a>02554                                 iArrow=Y_NORTH_ARROW;
<a name="l02555"></a>02555                                <span class="keywordflow">else</span>
<a name="l02556"></a>02556                                 iArrow=NORTH_ARROW;
<a name="l02557"></a>02557            iArrowX+=NORTH_OFFSET_X;
<a name="l02558"></a>02558                                iArrowY+=NORTH_OFFSET_Y;
<a name="l02559"></a>02559                               }
<a name="l02560"></a>02560                         }
<a name="l02561"></a>02561                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((iDeltaA==-1)&amp;&amp;(iDeltaB==-WORLD_MAP_X))
<a name="l02562"></a>02562                         {
<a name="l02563"></a>02563           <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l02564"></a>02564                               {
<a name="l02565"></a>02565                                iDirection=W_TO_S_ZOOM_LINE;
<a name="l02566"></a>02566            <span class="keywordflow">if</span>(fSpeedFlag)
<a name="l02567"></a>02567                                 iArrow=ZOOM_Y_SOUTH_ARROW;
<a name="l02568"></a>02568                                <span class="keywordflow">else</span>
<a name="l02569"></a>02569                                 iArrow=ZOOM_SOUTH_ARROW;
<a name="l02570"></a>02570            iArrowX+=SOUTH_OFFSET_X*2;
<a name="l02571"></a>02571                                iArrowY+=(SOUTH_OFFSET_Y+WEST_TO_SOUTH_OFFSET_Y)*2;
<a name="l02572"></a>02572                               }
<a name="l02573"></a>02573           <span class="keywordflow">else</span>
<a name="l02574"></a>02574                               {
<a name="l02575"></a>02575                                iDirection=W_TO_S_LINE;
<a name="l02576"></a>02576                                <span class="keywordflow">if</span>(fSpeedFlag)
<a name="l02577"></a>02577                                 iArrow=Y_SOUTH_ARROW;
<a name="l02578"></a>02578                                <span class="keywordflow">else</span>
<a name="l02579"></a>02579                                 iArrow=SOUTH_ARROW;
<a name="l02580"></a>02580            iArrowX+=SOUTH_OFFSET_X;
<a name="l02581"></a>02581                                iArrowY+=(SOUTH_OFFSET_Y+WEST_TO_SOUTH_OFFSET_Y);
<a name="l02582"></a>02582                               }
<a name="l02583"></a>02583                         }
<a name="l02584"></a>02584                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((iDeltaA==-WORLD_MAP_X)&amp;&amp;(iDeltaB==1))
<a name="l02585"></a>02585                         {
<a name="l02586"></a>02586           <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l02587"></a>02587                               {
<a name="l02588"></a>02588                                iDirection=N_TO_W_ZOOM_LINE;
<a name="l02589"></a>02589            <span class="keywordflow">if</span>(fSpeedFlag)
<a name="l02590"></a>02590                                 iArrow=ZOOM_Y_WEST_ARROW;
<a name="l02591"></a>02591                                <span class="keywordflow">else</span>
<a name="l02592"></a>02592                                 iArrow=ZOOM_WEST_ARROW;
<a name="l02593"></a>02593            iArrowX+=WEST_OFFSET_X*2;
<a name="l02594"></a>02594                                iArrowY+=WEST_OFFSET_Y*2;
<a name="l02595"></a>02595                               }
<a name="l02596"></a>02596           <span class="keywordflow">else</span>
<a name="l02597"></a>02597                               {
<a name="l02598"></a>02598                                iDirection=N_TO_W_LINE;
<a name="l02599"></a>02599                                <span class="keywordflow">if</span>(fSpeedFlag)
<a name="l02600"></a>02600                                 iArrow=Y_WEST_ARROW;
<a name="l02601"></a>02601                                <span class="keywordflow">else</span>
<a name="l02602"></a>02602                                 iArrow=WEST_ARROW;
<a name="l02603"></a>02603            iArrowX+=WEST_OFFSET_X;
<a name="l02604"></a>02604                                iArrowY+=WEST_OFFSET_Y;
<a name="l02605"></a>02605                               }
<a name="l02606"></a>02606                         }
<a name="l02607"></a>02607                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((iDeltaA==WORLD_MAP_X)&amp;&amp;(iDeltaB==-1))
<a name="l02608"></a>02608                         {
<a name="l02609"></a>02609           <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l02610"></a>02610                               {
<a name="l02611"></a>02611                                iDirection=S_TO_E_ZOOM_LINE;
<a name="l02612"></a>02612            <span class="keywordflow">if</span>(fSpeedFlag)
<a name="l02613"></a>02613                                 iArrow=ZOOM_Y_EAST_ARROW;
<a name="l02614"></a>02614                                <span class="keywordflow">else</span>
<a name="l02615"></a>02615                                 iArrow=ZOOM_EAST_ARROW;
<a name="l02616"></a>02616                iArrowX+=EAST_OFFSET_X*2;
<a name="l02617"></a>02617                                iArrowY+=EAST_OFFSET_Y*2;
<a name="l02618"></a>02618                               }
<a name="l02619"></a>02619           <span class="keywordflow">else</span>
<a name="l02620"></a>02620                               {
<a name="l02621"></a>02621                                iDirection=S_TO_E_LINE;
<a name="l02622"></a>02622                                <span class="keywordflow">if</span>(fSpeedFlag)
<a name="l02623"></a>02623                                 iArrow=Y_EAST_ARROW;
<a name="l02624"></a>02624                                <span class="keywordflow">else</span>
<a name="l02625"></a>02625                                 iArrow=EAST_ARROW;
<a name="l02626"></a>02626                iArrowX+=EAST_OFFSET_X;
<a name="l02627"></a>02627                                iArrowY+=EAST_OFFSET_Y;
<a name="l02628"></a>02628                               }
<a name="l02629"></a>02629                         }
<a name="l02630"></a>02630                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((iDeltaA==1)&amp;&amp;(iDeltaB==WORLD_MAP_X))
<a name="l02631"></a>02631                         {
<a name="l02632"></a>02632           <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l02633"></a>02633                               {
<a name="l02634"></a>02634                                iDirection=E_TO_N_ZOOM_LINE;
<a name="l02635"></a>02635            <span class="keywordflow">if</span>(fSpeedFlag)
<a name="l02636"></a>02636                                 iArrow=ZOOM_Y_NORTH_ARROW;
<a name="l02637"></a>02637                                <span class="keywordflow">else</span>
<a name="l02638"></a>02638                                 iArrow=ZOOM_NORTH_ARROW;
<a name="l02639"></a>02639            iArrowX+=(NORTH_OFFSET_X*2);
<a name="l02640"></a>02640                                iArrowY+=(NORTH_OFFSET_Y+EAST_TO_NORTH_OFFSET_Y)*2;
<a name="l02641"></a>02641                               }
<a name="l02642"></a>02642           <span class="keywordflow">else</span>
<a name="l02643"></a>02643                               {
<a name="l02644"></a>02644                                iDirection=E_TO_N_LINE;
<a name="l02645"></a>02645                                <span class="keywordflow">if</span>(fSpeedFlag)
<a name="l02646"></a>02646                                 iArrow=Y_NORTH_ARROW;
<a name="l02647"></a>02647                                <span class="keywordflow">else</span>
<a name="l02648"></a>02648                                 iArrow=NORTH_ARROW;
<a name="l02649"></a>02649            iArrowX+=NORTH_OFFSET_X;
<a name="l02650"></a>02650                                iArrowY+=NORTH_OFFSET_Y+EAST_TO_NORTH_OFFSET_Y;
<a name="l02651"></a>02651                               }
<a name="l02652"></a>02652                         }
<a name="l02653"></a>02653                    }          
<a name="l02654"></a>02654              }
<a name="l02655"></a>02655      <span class="keywordflow">else</span>
<a name="l02656"></a>02656              {
<a name="l02657"></a>02657                   <span class="keywordflow">if</span>(!<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l02658"></a>02658                   {
<a name="l02659"></a>02659        iX=(pNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>%MAP_WORLD_X);
<a name="l02660"></a>02660                iY=(pNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>/MAP_WORLD_X);
<a name="l02661"></a>02661                iX=(iX*MAP_GRID_X)+MAP_VIEW_START_X;
<a name="l02662"></a>02662                iY=(iY*MAP_GRID_Y)+MAP_VIEW_START_Y;
<a name="l02663"></a>02663        
<a name="l02664"></a>02664                   }
<a name="l02665"></a>02665                   <span class="keywordflow">else</span>
<a name="l02666"></a>02666                   {
<a name="l02667"></a>02667        <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#61b609e8ae7546838d7b9b106d25ff3a">GetScreenXYFromMapXYStationary</a>( ((<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>)(pNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>%MAP_WORLD_X)),((UINT16)(pNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>/MAP_WORLD_X)) , &amp;sX, &amp;sY ); 
<a name="l02668"></a>02668                    iY=sY-MAP_GRID_Y;
<a name="l02669"></a>02669                    iX=sX-MAP_GRID_X;       
<a name="l02670"></a>02670                   }
<a name="l02671"></a>02671                   iArrowX=iX;
<a name="l02672"></a>02672                   iArrowY=iY;
<a name="l02673"></a>02673       <span class="keywordflow">if</span>((pNode-&gt;<a class="code" href="structpath.html#546cbaeb8d8e229fd5beb09ce1b8d9c9">fSpeed</a>))
<a name="l02674"></a>02674                         fSpeedFlag=FALSE;
<a name="l02675"></a>02675                   <span class="keywordflow">else</span>
<a name="l02676"></a>02676                    fSpeedFlag=TRUE;
<a name="l02677"></a>02677                   <span class="comment">// display enter and exit 'X's</span>
<a name="l02678"></a>02678       <span class="keywordflow">if</span> (pPastNode)
<a name="l02679"></a>02679                   {
<a name="l02680"></a>02680              fUTurnFlag=TRUE;
<a name="l02681"></a>02681        iDeltaA=(<a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a>)pNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>-(<a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a>)pPastNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>;
<a name="l02682"></a>02682                    <span class="keywordflow">if</span> (iDeltaA==-1)
<a name="l02683"></a>02683                    {
<a name="l02684"></a>02684                         <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l02685"></a>02685                         {
<a name="l02686"></a>02686                          iDirection=ZOOM_RED_X_WEST;
<a name="l02687"></a>02687                          <span class="comment">//iX-=MAP_GRID_X;</span>
<a name="l02688"></a>02688                          <span class="comment">//iY-=MAP_GRID_Y;</span>
<a name="l02689"></a>02689                         }
<a name="l02690"></a>02690                         <span class="keywordflow">else</span>
<a name="l02691"></a>02691                          iDirection=RED_X_WEST;
<a name="l02692"></a>02692                  <span class="comment">//iX+=RED_WEST_OFF_X;</span>
<a name="l02693"></a>02693                    }
<a name="l02694"></a>02694                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iDeltaA==1)
<a name="l02695"></a>02695                    {
<a name="l02696"></a>02696         <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l02697"></a>02697                         {
<a name="l02698"></a>02698                          iDirection=ZOOM_RED_X_EAST;
<a name="l02699"></a>02699                         }
<a name="l02700"></a>02700                         <span class="keywordflow">else</span>
<a name="l02701"></a>02701                         iDirection=RED_X_EAST;
<a name="l02702"></a>02702                         <span class="comment">//iX+=RED_EAST_OFF_X;</span>
<a name="l02703"></a>02703                    }
<a name="l02704"></a>02704                    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(iDeltaA==-WORLD_MAP_X)
<a name="l02705"></a>02705                    {
<a name="l02706"></a>02706         <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l02707"></a>02707                         {
<a name="l02708"></a>02708                          iDirection=ZOOM_RED_X_NORTH;
<a name="l02709"></a>02709                         }
<a name="l02710"></a>02710                         <span class="keywordflow">else</span>
<a name="l02711"></a>02711                          iDirection=RED_X_NORTH;
<a name="l02712"></a>02712                          <span class="comment">//iY+=RED_NORTH_OFF_Y;</span>
<a name="l02713"></a>02713                    }
<a name="l02714"></a>02714                    <span class="keywordflow">else</span> 
<a name="l02715"></a>02715                    {
<a name="l02716"></a>02716         <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l02717"></a>02717                         {
<a name="l02718"></a>02718                          iDirection=ZOOM_RED_X_SOUTH;
<a name="l02719"></a>02719                         }
<a name="l02720"></a>02720                         <span class="keywordflow">else</span>
<a name="l02721"></a>02721                          iDirection=RED_X_SOUTH;
<a name="l02722"></a>02722                     <span class="comment">//  iY+=RED_SOUTH_OFF_Y;</span>
<a name="l02723"></a>02723                    }
<a name="l02724"></a>02724                   }
<a name="l02725"></a>02725                   <span class="keywordflow">if</span> (pNextNode)
<a name="l02726"></a>02726                   {
<a name="l02727"></a>02727        fUTurnFlag=FALSE;
<a name="l02728"></a>02728        iDeltaB=(<a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a>)pNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>-(<a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a>)pNextNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>;
<a name="l02729"></a>02729        <span class="keywordflow">if</span>((pNode-&gt;<a class="code" href="structpath.html#546cbaeb8d8e229fd5beb09ce1b8d9c9">fSpeed</a>))
<a name="l02730"></a>02730                         fSpeedFlag=FALSE;
<a name="l02731"></a>02731                    <span class="keywordflow">else</span>
<a name="l02732"></a>02732                     fSpeedFlag=TRUE;
<a name="l02733"></a>02733 
<a name="l02734"></a>02734                    <span class="keywordflow">if</span> (iDeltaB==-1)
<a name="l02735"></a>02735                         {
<a name="l02736"></a>02736          <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l02737"></a>02737                          {
<a name="l02738"></a>02738                           iDirection=ZOOM_GREEN_X_EAST;
<a name="l02739"></a>02739           <span class="keywordflow">if</span>(fSpeedFlag)
<a name="l02740"></a>02740                                 iArrow=ZOOM_Y_EAST_ARROW;
<a name="l02741"></a>02741                                <span class="keywordflow">else</span>
<a name="l02742"></a>02742                                iArrow=ZOOM_EAST_ARROW;
<a name="l02743"></a>02743                               iX-=0;MAP_GRID_X;
<a name="l02744"></a>02744                               iY-=0;MAP_GRID_Y;
<a name="l02745"></a>02745           iArrowX+=EAST_OFFSET_X*2;
<a name="l02746"></a>02746                               iArrowY+=EAST_OFFSET_Y*2;
<a name="l02747"></a>02747                          }
<a name="l02748"></a>02748                          <span class="keywordflow">else</span>
<a name="l02749"></a>02749                          {
<a name="l02750"></a>02750                               iDirection=GREEN_X_EAST;
<a name="l02751"></a>02751           <span class="keywordflow">if</span>(fSpeedFlag)
<a name="l02752"></a>02752                                 iArrow=Y_EAST_ARROW;
<a name="l02753"></a>02753                                <span class="keywordflow">else</span>
<a name="l02754"></a>02754                                iArrow=EAST_ARROW;
<a name="l02755"></a>02755           iArrowX+=EAST_OFFSET_X;
<a name="l02756"></a>02756                               iArrowY+=EAST_OFFSET_Y;
<a name="l02757"></a>02757                          }
<a name="l02758"></a>02758                               <span class="comment">//iX+=RED_EAST_OFF_X;</span>
<a name="l02759"></a>02759                         }
<a name="l02760"></a>02760                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iDeltaB==1)
<a name="l02761"></a>02761                         { 
<a name="l02762"></a>02762                          <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l02763"></a>02763                          {
<a name="l02764"></a>02764                           iDirection=ZOOM_GREEN_X_WEST;
<a name="l02765"></a>02765           <span class="keywordflow">if</span>(fSpeedFlag)
<a name="l02766"></a>02766                                 iArrow=ZOOM_Y_WEST_ARROW;
<a name="l02767"></a>02767                               <span class="keywordflow">else</span>
<a name="l02768"></a>02768                                iArrow=ZOOM_WEST_ARROW;
<a name="l02769"></a>02769           iArrowX+=WEST_OFFSET_X*2;
<a name="l02770"></a>02770                               iArrowY+=WEST_OFFSET_Y*2;
<a name="l02771"></a>02771                          }
<a name="l02772"></a>02772                          <span class="keywordflow">else</span>
<a name="l02773"></a>02773                          {
<a name="l02774"></a>02774                               iDirection=GREEN_X_WEST;
<a name="l02775"></a>02775           <span class="keywordflow">if</span>(fSpeedFlag)
<a name="l02776"></a>02776                                 iArrow=Y_WEST_ARROW;
<a name="l02777"></a>02777                               <span class="keywordflow">else</span>
<a name="l02778"></a>02778                                iArrow=WEST_ARROW;
<a name="l02779"></a>02779           iArrowX+=WEST_OFFSET_X;
<a name="l02780"></a>02780                               iArrowY+=WEST_OFFSET_Y;
<a name="l02781"></a>02781                          }
<a name="l02782"></a>02782                               <span class="comment">//iX+=RED_WEST_OFF_X;</span>
<a name="l02783"></a>02783                         }
<a name="l02784"></a>02784                         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(iDeltaB==WORLD_MAP_X)
<a name="l02785"></a>02785                         {
<a name="l02786"></a>02786          <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l02787"></a>02787                          {
<a name="l02788"></a>02788                           iDirection=ZOOM_GREEN_X_NORTH;
<a name="l02789"></a>02789           <span class="keywordflow">if</span>(fSpeedFlag)
<a name="l02790"></a>02790                                 iArrow=ZOOM_Y_NORTH_ARROW;
<a name="l02791"></a>02791                               <span class="keywordflow">else</span>
<a name="l02792"></a>02792                                iArrow=ZOOM_NORTH_ARROW;
<a name="l02793"></a>02793           iArrowX+=NORTH_OFFSET_X*2;
<a name="l02794"></a>02794                               iArrowY+=NORTH_OFFSET_Y*2;
<a name="l02795"></a>02795                          }
<a name="l02796"></a>02796                          <span class="keywordflow">else</span>
<a name="l02797"></a>02797                          {
<a name="l02798"></a>02798                               iDirection=GREEN_X_NORTH;
<a name="l02799"></a>02799           <span class="keywordflow">if</span>(fSpeedFlag)
<a name="l02800"></a>02800                                 iArrow=Y_NORTH_ARROW;
<a name="l02801"></a>02801                               <span class="keywordflow">else</span>
<a name="l02802"></a>02802                                iArrow=NORTH_ARROW;
<a name="l02803"></a>02803             iArrowX+=NORTH_OFFSET_X;
<a name="l02804"></a>02804                               iArrowY+=NORTH_OFFSET_Y;
<a name="l02805"></a>02805                               <span class="comment">//iY+=RED_NORTH_OFF_Y;</span>
<a name="l02806"></a>02806                          }
<a name="l02807"></a>02807                         }
<a name="l02808"></a>02808                         <span class="keywordflow">else</span> 
<a name="l02809"></a>02809                         {
<a name="l02810"></a>02810          <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l02811"></a>02811                          {
<a name="l02812"></a>02812                           iDirection=ZOOM_GREEN_X_SOUTH;
<a name="l02813"></a>02813           <span class="keywordflow">if</span>(fSpeedFlag)
<a name="l02814"></a>02814                                 iArrow=ZOOM_Y_SOUTH_ARROW;
<a name="l02815"></a>02815                               <span class="keywordflow">else</span> 
<a name="l02816"></a>02816                                     iArrow=ZOOM_SOUTH_ARROW;
<a name="l02817"></a>02817           iArrowX+=SOUTH_OFFSET_X*2;
<a name="l02818"></a>02818                               iArrowY+=SOUTH_OFFSET_Y*2;
<a name="l02819"></a>02819                          }
<a name="l02820"></a>02820                          <span class="keywordflow">else</span>
<a name="l02821"></a>02821                          {
<a name="l02822"></a>02822                               iDirection=GREEN_X_SOUTH;
<a name="l02823"></a>02823           <span class="keywordflow">if</span>(fSpeedFlag)
<a name="l02824"></a>02824                                 iArrow=Y_SOUTH_ARROW;
<a name="l02825"></a>02825                                <span class="keywordflow">else</span>
<a name="l02826"></a>02826                               iArrow=SOUTH_ARROW;
<a name="l02827"></a>02827           iArrowX+=SOUTH_OFFSET_X;
<a name="l02828"></a>02828                               iArrowY+=SOUTH_OFFSET_Y;
<a name="l02829"></a>02829                               <span class="comment">//iY+=RED_SOUTH_OFF_Y;</span>
<a name="l02830"></a>02830                          }
<a name="l02831"></a>02831                         }
<a name="l02832"></a>02832                   }
<a name="l02833"></a>02833                   
<a name="l02834"></a>02834              }
<a name="l02835"></a>02835              <span class="keywordflow">if</span> ((iDirection !=-1))
<a name="l02836"></a>02836              {
<a name="l02837"></a>02837                <span class="keywordflow">if</span>((!<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)||((<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)&amp;&amp;(iX &gt;MAP_VIEW_START_X)&amp;&amp;(iY &gt;MAP_VIEW_START_Y)&amp;&amp;(iX &lt; 640-MAP_GRID_X*2)&amp;&amp;(iY &lt; MAP_VIEW_START_Y+MAP_VIEW_HEIGHT)))
<a name="l02838"></a>02838                    {
<a name="l02839"></a>02839                          
<a name="l02840"></a>02840 
<a name="l02841"></a>02841                          <a class="code" href="vobject_8cpp.html#8a5b07441769401593743b9f52a9e353">BltVideoObject</a>(FRAME_BUFFER, hMapHandle, (<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>)iDirection, iX,iY, VO_BLT_SRCTRANSPARENCY, NULL );  
<a name="l02842"></a>02842 
<a name="l02843"></a>02843                          <span class="keywordflow">if</span>(!fUTurnFlag)
<a name="l02844"></a>02844                          { 
<a name="l02845"></a>02845            <a class="code" href="vobject_8cpp.html#8a5b07441769401593743b9f52a9e353">BltVideoObject</a>(FRAME_BUFFER, hMapHandle, (<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>)iArrow, iArrowX, iArrowY, VO_BLT_SRCTRANSPARENCY, NULL );
<a name="l02846"></a>02846                                <a class="code" href="video_8cpp.html#4ed7790da612ff97bf9c05cf186823bc">InvalidateRegion</a>( iArrowX, iArrowY, iArrowX + 2 * MAP_GRID_X, iArrowY + 2 * MAP_GRID_Y );
<a name="l02847"></a>02847 
<a name="l02848"></a>02848                          }
<a name="l02849"></a>02849 
<a name="l02850"></a>02850                          <a class="code" href="video_8cpp.html#4ed7790da612ff97bf9c05cf186823bc">InvalidateRegion</a>( iX, iY, iX + 2 * MAP_GRID_X, iY + 2 * MAP_GRID_Y );
<a name="l02851"></a>02851                          
<a name="l02852"></a>02852 
<a name="l02853"></a>02853                         
<a name="l02854"></a>02854                         fUTurnFlag=FALSE;
<a name="l02855"></a>02855                         
<a name="l02856"></a>02856                    }
<a name="l02857"></a>02857              }
<a name="l02858"></a>02858              <span class="comment">// check to see if there is a turn</span>
<a name="l02859"></a>02859              
<a name="l02860"></a>02860          
<a name="l02861"></a>02861              pPastNode=pNode;
<a name="l02862"></a>02862              pNode=pNode-&gt;<a class="code" href="structpath.html#3aece431545f290e21842d7ddd3d78af">pNext</a>;
<a name="l02863"></a>02863              <span class="keywordflow">if</span>(!pNode)
<a name="l02864"></a>02864                    <span class="keywordflow">return</span>( FALSE );
<a name="l02865"></a>02865              <span class="keywordflow">if</span> (pNode-&gt;<a class="code" href="structpath.html#3aece431545f290e21842d7ddd3d78af">pNext</a>)
<a name="l02866"></a>02866               pNextNode=pNode-&gt;<a class="code" href="structpath.html#3aece431545f290e21842d7ddd3d78af">pNext</a>;
<a name="l02867"></a>02867              <span class="keywordflow">else</span>
<a name="l02868"></a>02868       pNextNode=NULL;
<a name="l02869"></a>02869             }
<a name="l02870"></a>02870 
<a name="l02871"></a>02871             <span class="keywordflow">return</span> ( TRUE );
<a name="l02872"></a>02872 
<a name="l02873"></a>02873 }
<a name="l02874"></a>02874 
<a name="l02875"></a>02875 
<a name="l02876"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#4eb532f1b75cafca5770083d34a84690">02876</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#4eb532f1b75cafca5770083d34a84690">AnimateRoute</a>( <a class="code" href="structpath.html">PathStPtr</a> pPath )
<a name="l02877"></a>02877 {
<a name="l02878"></a>02878       <span class="comment">// set buffer</span>
<a name="l02879"></a>02879       <a class="code" href="Font_8cpp.html#a038a1dc2edfc9f9c0766a0cbde2f440">SetFontDestBuffer</a>( FRAME_BUFFER, 0,0,<a class="code" href="local_8h.html#599adbe412c60e0cc5abb86be7ee4507">SCREEN_WIDTH</a>, <a class="code" href="local_8h.html#f1c710caf1e3a9e81829078054e83799">SCREEN_HEIGHT</a>, FALSE );
<a name="l02880"></a>02880 
<a name="l02881"></a>02881       <span class="comment">// the animated path</span>
<a name="l02882"></a>02882   <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#d1179fa3da325027bc0abc6339952331">TraceCharAnimatedRoute</a>( pPath, FALSE, FALSE ))
<a name="l02883"></a>02883   {
<a name="l02884"></a>02884 <span class="comment">// ARM? Huh?  Why the same thing twice more?</span>
<a name="l02885"></a>02885     <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#d1179fa3da325027bc0abc6339952331">TraceCharAnimatedRoute</a>( pPath, FALSE, TRUE );
<a name="l02886"></a>02886     <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#d1179fa3da325027bc0abc6339952331">TraceCharAnimatedRoute</a>( pPath, FALSE, TRUE );
<a name="l02887"></a>02887       }
<a name="l02888"></a>02888 }
<a name="l02889"></a>02889 
<a name="l02890"></a>02890 
<a name="l02891"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#43b879b6c963c66e3889321e7842916f">02891</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#43b879b6c963c66e3889321e7842916f">RestoreArrowBackgroundsForTrace</a>(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iArrow, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iArrowX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iArrowY, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fZoom)
<a name="l02892"></a>02892 {
<a name="l02893"></a>02893       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sArrow=0;
<a name="l02894"></a>02894   <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX = -1, iY = -1;
<a name="l02895"></a>02895       <span class="comment">// find location of arrow and restore appropriate background</span>
<a name="l02896"></a>02896  
<a name="l02897"></a>02897  <span class="keywordflow">if</span>((iArrow==SOUTH_ARROW)||(iArrow==W_SOUTH_ARROW)||(iArrow==ZOOM_W_SOUTH_ARROW)||(ZOOM_SOUTH_ARROW==iArrow))
<a name="l02898"></a>02898  {
<a name="l02899"></a>02899        sArrow=SOUTH_ARROW;
<a name="l02900"></a>02900  }
<a name="l02901"></a>02901  <span class="keywordflow">else</span> <span class="keywordflow">if</span>((iArrow==NORTH_ARROW)||(iArrow==W_NORTH_ARROW)||(iArrow==ZOOM_W_NORTH_ARROW)||(ZOOM_NORTH_ARROW==iArrow))
<a name="l02902"></a>02902  {
<a name="l02903"></a>02903    sArrow=NORTH_ARROW;
<a name="l02904"></a>02904  }
<a name="l02905"></a>02905  <span class="keywordflow">else</span> <span class="keywordflow">if</span>((iArrow==WEST_ARROW)||(iArrow==W_WEST_ARROW)||(iArrow==ZOOM_W_WEST_ARROW)||(ZOOM_WEST_ARROW==iArrow))
<a name="l02906"></a>02906  {
<a name="l02907"></a>02907    sArrow=WEST_ARROW;
<a name="l02908"></a>02908  }
<a name="l02909"></a>02909  <span class="keywordflow">else</span> <span class="keywordflow">if</span>((iArrow==EAST_ARROW)||(iArrow==W_EAST_ARROW)||(iArrow==ZOOM_W_EAST_ARROW)||(ZOOM_EAST_ARROW==iArrow))
<a name="l02910"></a>02910  {
<a name="l02911"></a>02911    sArrow=EAST_ARROW;
<a name="l02912"></a>02912  }
<a name="l02913"></a>02913 
<a name="l02914"></a>02914  <span class="keywordflow">switch</span>(sArrow)
<a name="l02915"></a>02915  {
<a name="l02916"></a>02916       <span class="keywordflow">case</span>(SOUTH_ARROW):
<a name="l02917"></a>02917         iX=iArrowX;
<a name="l02918"></a>02918             iY=iArrowY;
<a name="l02919"></a>02919       <span class="keywordflow">break</span>;
<a name="l02920"></a>02920       <span class="keywordflow">case</span>(NORTH_ARROW):
<a name="l02921"></a>02921     iX=iArrowX;
<a name="l02922"></a>02922             iY=iArrowY;
<a name="l02923"></a>02923       <span class="keywordflow">break</span>;
<a name="l02924"></a>02924       <span class="keywordflow">case</span>(WEST_ARROW):
<a name="l02925"></a>02925         iX=iArrowX;
<a name="l02926"></a>02926             iY=iArrowY;
<a name="l02927"></a>02927       <span class="keywordflow">break</span>;
<a name="l02928"></a>02928       <span class="keywordflow">case</span>(EAST_ARROW):
<a name="l02929"></a>02929         iX=iArrowX;
<a name="l02930"></a>02930             iY=iArrowY;
<a name="l02931"></a>02931       <span class="keywordflow">break</span>;
<a name="l02932"></a>02932  }
<a name="l02933"></a>02933 
<a name="l02934"></a>02934  <span class="comment">// error check</span>
<a name="l02935"></a>02935  <span class="keywordflow">if</span>( iX == -1 )
<a name="l02936"></a>02936  {
<a name="l02937"></a>02937        <span class="keywordflow">return</span>;
<a name="l02938"></a>02938  }
<a name="l02939"></a>02939 
<a name="l02940"></a>02940  <span class="keywordflow">if</span>(!fZoom)
<a name="l02941"></a>02941   <a class="code" href="Render_01Dirty_8cpp.html#ce65fac8b540eee1a5bf4902d2dcb0c5">RestoreExternBackgroundRect</a>(((<a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a>)iX),((INT16)iY),DMAP_GRID_X/2 ,DMAP_GRID_Y/2 );                 
<a name="l02942"></a>02942  <span class="keywordflow">else</span>
<a name="l02943"></a>02943   <a class="code" href="Render_01Dirty_8cpp.html#ce65fac8b540eee1a5bf4902d2dcb0c5">RestoreExternBackgroundRect</a>(((INT16)iX), ((INT16)iY),DMAP_GRID_ZOOM_X, DMAP_GRID_ZOOM_Y);                 
<a name="l02944"></a>02944                          
<a name="l02945"></a>02945  
<a name="l02946"></a>02946       <span class="keywordflow">return</span>;
<a name="l02947"></a>02947 }
<a name="l02948"></a>02948 
<a name="l02949"></a>02949 
<a name="l02950"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#d1179fa3da325027bc0abc6339952331">02950</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#d1179fa3da325027bc0abc6339952331">TraceCharAnimatedRoute</a>( <a class="code" href="structpath.html">PathStPtr</a> pPath, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fCheckFlag, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fForceUpDate )
<a name="l02951"></a>02951 {
<a name="l02952"></a>02952  <span class="keyword">static</span> <a class="code" href="structpath.html">PathStPtr</a> pCurrentNode=NULL;
<a name="l02953"></a>02953  <span class="keyword">static</span> <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bCurrentChar=-1;
<a name="l02954"></a>02954  <span class="keyword">static</span> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fUpDateFlag=FALSE;
<a name="l02955"></a>02955  <span class="keyword">static</span> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fPauseFlag=TRUE;
<a name="l02956"></a>02956  <span class="keyword">static</span> <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubCounter=1;
<a name="l02957"></a>02957 
<a name="l02958"></a>02958  <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hMapHandle;
<a name="l02959"></a>02959  <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fSpeedFlag=FALSE;
<a name="l02960"></a>02960  <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fUpDate=FALSE;
<a name="l02961"></a>02961  <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iDifference=0;
<a name="l02962"></a>02962  <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iArrow=-1;
<a name="l02963"></a>02963  <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX = 0, iY = 0;
<a name="l02964"></a>02964  <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iPastX, iPastY;
<a name="l02965"></a>02965  <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sX = 0, sY = 0;
<a name="l02966"></a>02966  <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iArrowX, iArrowY;
<a name="l02967"></a>02967  <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iDeltaA, iDeltaB, iDeltaB1;
<a name="l02968"></a>02968  <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iDirection = -1;
<a name="l02969"></a>02969  <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fUTurnFlag=FALSE;
<a name="l02970"></a>02970  <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fNextNode=FALSE;
<a name="l02971"></a>02971  <a class="code" href="structpath.html">PathStPtr</a> pTempNode=NULL;
<a name="l02972"></a>02972  <a class="code" href="structpath.html">PathStPtr</a> pNode=NULL;
<a name="l02973"></a>02973  <a class="code" href="structpath.html">PathStPtr</a> pPastNode=NULL;
<a name="l02974"></a>02974  <a class="code" href="structpath.html">PathStPtr</a> pNextNode=NULL;
<a name="l02975"></a>02975 
<a name="l02976"></a>02976 
<a name="l02977"></a>02977       <span class="comment">// must be plotting movement</span>
<a name="l02978"></a>02978  <span class="keywordflow">if</span> ( ( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7b23b61dd5c051243baedf1bb9df7774">bSelectedDestChar</a> == -1 ) &amp;&amp; ( <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#e98f4ed560608bb89adb4143e28a8e32">fPlotForHelicopter</a> == FALSE ) )
<a name="l02979"></a>02979  {
<a name="l02980"></a>02980        <span class="keywordflow">return</span> FALSE;
<a name="l02981"></a>02981  }
<a name="l02982"></a>02982 
<a name="l02983"></a>02983  <span class="comment">// if any nodes have been deleted, reset current node to beginning of the list</span>
<a name="l02984"></a>02984  <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#f36110531c69293b183bd79d4fce0256">fDeletedNode</a> )
<a name="l02985"></a>02985  {
<a name="l02986"></a>02986        <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#f36110531c69293b183bd79d4fce0256">fDeletedNode</a> = FALSE;
<a name="l02987"></a>02987        pCurrentNode = NULL;
<a name="l02988"></a>02988  }
<a name="l02989"></a>02989 
<a name="l02990"></a>02990 
<a name="l02991"></a>02991  <span class="comment">// Valid path?</span>
<a name="l02992"></a>02992  <span class="keywordflow">if</span> ( pPath == NULL )
<a name="l02993"></a>02993  {
<a name="l02994"></a>02994        <span class="keywordflow">return</span> FALSE;
<a name="l02995"></a>02995  }
<a name="l02996"></a>02996  <span class="keywordflow">else</span>
<a name="l02997"></a>02997  {
<a name="l02998"></a>02998        <span class="keywordflow">if</span>(pCurrentNode==NULL)
<a name="l02999"></a>02999        {
<a name="l03000"></a>03000              pCurrentNode = pPath;
<a name="l03001"></a>03001        }
<a name="l03002"></a>03002  }
<a name="l03003"></a>03003 
<a name="l03004"></a>03004  <span class="comment">// Check Timer</span>
<a name="l03005"></a>03005  <span class="keywordflow">if</span> (<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e33da796490f5f2f772746c82c8a2176">giAnimateRouteBaseTime</a>==0)
<a name="l03006"></a>03006  {
<a name="l03007"></a>03007        <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e33da796490f5f2f772746c82c8a2176">giAnimateRouteBaseTime</a>=GetJA2Clock();
<a name="l03008"></a>03008        <span class="keywordflow">return</span> FALSE;
<a name="l03009"></a>03009  }
<a name="l03010"></a>03010 
<a name="l03011"></a>03011  <span class="comment">// check difference in time</span>
<a name="l03012"></a>03012  iDifference=GetJA2Clock()-<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e33da796490f5f2f772746c82c8a2176">giAnimateRouteBaseTime</a>;
<a name="l03013"></a>03013 
<a name="l03014"></a>03014  <span class="comment">// if pause flag, check time, if time passed, reset, continue on, else return</span>
<a name="l03015"></a>03015  <span class="keywordflow">if</span>(fPauseFlag)
<a name="l03016"></a>03016  {
<a name="l03017"></a>03017        <span class="keywordflow">if</span>(iDifference &lt; PAUSE_DELAY)
<a name="l03018"></a>03018        {
<a name="l03019"></a>03019               <span class="keywordflow">return</span> FALSE;
<a name="l03020"></a>03020        }
<a name="l03021"></a>03021        <span class="keywordflow">else</span>
<a name="l03022"></a>03022        {
<a name="l03023"></a>03023               fPauseFlag=FALSE;
<a name="l03024"></a>03024           <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e33da796490f5f2f772746c82c8a2176">giAnimateRouteBaseTime</a>=GetJA2Clock();
<a name="l03025"></a>03025        }
<a name="l03026"></a>03026  }
<a name="l03027"></a>03027 
<a name="l03028"></a>03028 
<a name="l03029"></a>03029  <span class="comment">// if is checkflag and change in status, return TRUE;</span>
<a name="l03030"></a>03030  <span class="keywordflow">if</span>(!fForceUpDate)
<a name="l03031"></a>03031  {
<a name="l03032"></a>03032   <span class="keywordflow">if</span>(iDifference &lt; ARROW_DELAY)
<a name="l03033"></a>03033   {
<a name="l03034"></a>03034       <span class="keywordflow">if</span> (!fUpDateFlag)
<a name="l03035"></a>03035             <span class="keywordflow">return</span> FALSE;
<a name="l03036"></a>03036   }
<a name="l03037"></a>03037   <span class="keywordflow">else</span>
<a name="l03038"></a>03038   {
<a name="l03039"></a>03039       <span class="comment">// sufficient time, update base time</span>
<a name="l03040"></a>03040     <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e33da796490f5f2f772746c82c8a2176">giAnimateRouteBaseTime</a>=GetJA2Clock();
<a name="l03041"></a>03041     fUpDateFlag=!fUpDateFlag;
<a name="l03042"></a>03042 
<a name="l03043"></a>03043       <span class="keywordflow">if</span>(fCheckFlag)
<a name="l03044"></a>03044               <span class="keywordflow">return</span> TRUE;
<a name="l03045"></a>03045 
<a name="l03046"></a>03046             fNextNode=TRUE;
<a name="l03047"></a>03047   }
<a name="l03048"></a>03048  }
<a name="l03049"></a>03049  
<a name="l03050"></a>03050       <span class="comment">// check to see if Current node has not been deleted</span>
<a name="l03051"></a>03051       pTempNode = pPath;
<a name="l03052"></a>03052   
<a name="l03053"></a>03053   <span class="keywordflow">while</span>(pTempNode)
<a name="l03054"></a>03054   {
<a name="l03055"></a>03055         <span class="keywordflow">if</span>(pTempNode==pCurrentNode)
<a name="l03056"></a>03056             {
<a name="l03057"></a>03057               <span class="comment">//not deleted</span>
<a name="l03058"></a>03058              <span class="comment">//reset pause flag</span>
<a name="l03059"></a>03059              <span class="keywordflow">break</span>;
<a name="l03060"></a>03060              }
<a name="l03061"></a>03061        <span class="keywordflow">else</span>
<a name="l03062"></a>03062              pTempNode=pTempNode-&gt;<a class="code" href="structpath.html#3aece431545f290e21842d7ddd3d78af">pNext</a>;
<a name="l03063"></a>03063       }
<a name="l03064"></a>03064 
<a name="l03065"></a>03065  <span class="comment">// if deleted, restart at beginnning</span>
<a name="l03066"></a>03066  <span class="keywordflow">if</span>(pTempNode==NULL)
<a name="l03067"></a>03067  {
<a name="l03068"></a>03068        pCurrentNode = pPath;
<a name="l03069"></a>03069 
<a name="l03070"></a>03070        <span class="comment">// set pause flag</span>
<a name="l03071"></a>03071        <span class="keywordflow">if</span>(!pCurrentNode)
<a name="l03072"></a>03072              <span class="keywordflow">return</span> FALSE;
<a name="l03073"></a>03073        
<a name="l03074"></a>03074  }
<a name="l03075"></a>03075  
<a name="l03076"></a>03076  <span class="comment">// Grab Video Objects</span>
<a name="l03077"></a>03077  <a class="code" href="vobject_8cpp.html#bda2b0eae4cb40e612dffd307ad5c692">GetVideoObject</a>(&amp;hMapHandle, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#13645a6fb711d57c89346f6c66c4c577">guiMAPCURSORS</a>); 
<a name="l03078"></a>03078  
<a name="l03079"></a>03079  <span class="comment">// Handle drawing of arrow</span>
<a name="l03080"></a>03080  pNode=pCurrentNode;
<a name="l03081"></a>03081  <span class="keywordflow">if</span>((!pNode-&gt;<a class="code" href="structpath.html#ecc4d365e64a642f64983a12f7dfc313">pPrev</a>)&amp;&amp;(ubCounter==1)&amp;&amp;(fForceUpDate))
<a name="l03082"></a>03082  {
<a name="l03083"></a>03083        ubCounter=0;
<a name="l03084"></a>03084        <span class="keywordflow">return</span> FALSE;
<a name="l03085"></a>03085  }
<a name="l03086"></a>03086  <span class="keywordflow">else</span> <span class="keywordflow">if</span>((ubCounter==1)&amp;&amp;(fForceUpDate))
<a name="l03087"></a>03087  {
<a name="l03088"></a>03088        pNode=pCurrentNode-&gt;<a class="code" href="structpath.html#ecc4d365e64a642f64983a12f7dfc313">pPrev</a>;
<a name="l03089"></a>03089  }
<a name="l03090"></a>03090  <span class="keywordflow">if</span> (pNode-&gt;<a class="code" href="structpath.html#3aece431545f290e21842d7ddd3d78af">pNext</a>)
<a name="l03091"></a>03091        pNextNode=pNode-&gt;<a class="code" href="structpath.html#3aece431545f290e21842d7ddd3d78af">pNext</a>;
<a name="l03092"></a>03092  <span class="keywordflow">else</span>
<a name="l03093"></a>03093        pNextNode=NULL;
<a name="l03094"></a>03094 
<a name="l03095"></a>03095  <span class="keywordflow">if</span> (pNode-&gt;<a class="code" href="structpath.html#ecc4d365e64a642f64983a12f7dfc313">pPrev</a>)
<a name="l03096"></a>03096    pPastNode=pNode-&gt;<a class="code" href="structpath.html#ecc4d365e64a642f64983a12f7dfc313">pPrev</a>;
<a name="l03097"></a>03097  <span class="keywordflow">else</span>
<a name="l03098"></a>03098        pPastNode=NULL;
<a name="l03099"></a>03099  
<a name="l03100"></a>03100  <span class="comment">// go through characters list and display arrows for path</span>
<a name="l03101"></a>03101  fUTurnFlag=FALSE;
<a name="l03102"></a>03102  <span class="keywordflow">if</span> ((pPastNode)&amp;&amp;(pNextNode))
<a name="l03103"></a>03103              {
<a name="l03104"></a>03104       iDeltaA=(<a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a>)pNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>-(<a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a>)pPastNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>;
<a name="l03105"></a>03105               iDeltaB=(<a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a>)pNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>-(<a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a>)pNextNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>;
<a name="l03106"></a>03106                   <span class="keywordflow">if</span>(!pNode-&gt;<a class="code" href="structpath.html#546cbaeb8d8e229fd5beb09ce1b8d9c9">fSpeed</a>)
<a name="l03107"></a>03107                         fSpeedFlag=TRUE;
<a name="l03108"></a>03108                   <span class="keywordflow">else</span>
<a name="l03109"></a>03109                         fSpeedFlag=FALSE;
<a name="l03110"></a>03110                   <span class="keywordflow">if</span> (iDeltaA ==0)
<a name="l03111"></a>03111                <span class="keywordflow">return</span> FALSE;
<a name="l03112"></a>03112       <span class="keywordflow">if</span>(!<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l03113"></a>03113                   {
<a name="l03114"></a>03114        iX=(pNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>%MAP_WORLD_X);
<a name="l03115"></a>03115                iY=(pNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>/MAP_WORLD_X);
<a name="l03116"></a>03116                iX=(iX*MAP_GRID_X)+MAP_VIEW_START_X;
<a name="l03117"></a>03117                iY=(iY*MAP_GRID_Y)+MAP_VIEW_START_Y;
<a name="l03118"></a>03118                   }
<a name="l03119"></a>03119                   <span class="keywordflow">else</span>
<a name="l03120"></a>03120                   {
<a name="l03121"></a>03121        <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#61b609e8ae7546838d7b9b106d25ff3a">GetScreenXYFromMapXYStationary</a>( ((<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>)(pNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>%MAP_WORLD_X)),((UINT16)(pNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>/MAP_WORLD_X)) , &amp;sX, &amp;sY ); 
<a name="l03122"></a>03122                    iY=sY-MAP_GRID_Y;
<a name="l03123"></a>03123                    iX=sX-MAP_GRID_X;      
<a name="l03124"></a>03124                   }
<a name="l03125"></a>03125                   iArrowX=iX;
<a name="l03126"></a>03126                   iArrowY=iY;
<a name="l03127"></a>03127               <span class="keywordflow">if</span> ((pPastNode-&gt;<a class="code" href="structpath.html#ecc4d365e64a642f64983a12f7dfc313">pPrev</a>)&amp;&amp;(pNextNode-&gt;<a class="code" href="structpath.html#3aece431545f290e21842d7ddd3d78af">pNext</a>)) 
<a name="l03128"></a>03128       {
<a name="l03129"></a>03129        fUTurnFlag=FALSE;
<a name="l03130"></a>03130                         <span class="comment">// check to see if out-of sector U-turn</span>
<a name="l03131"></a>03131         <span class="comment">// for placement of arrows</span>
<a name="l03132"></a>03132                    iDeltaB1=pNextNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>-pNextNode-&gt;<a class="code" href="structpath.html#3aece431545f290e21842d7ddd3d78af">pNext</a>-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>;
<a name="l03133"></a>03133                    <span class="keywordflow">if</span> ((iDeltaB1==-WORLD_MAP_X)&amp;&amp;(iDeltaA==-WORLD_MAP_X)&amp;&amp;(iDeltaB==-1))
<a name="l03134"></a>03134                    {
<a name="l03135"></a>03135                          fUTurnFlag=TRUE;
<a name="l03136"></a>03136                    }
<a name="l03137"></a>03137                    <span class="keywordflow">else</span> <span class="keywordflow">if</span>((iDeltaB1==-WORLD_MAP_X)&amp;&amp;(iDeltaA==-WORLD_MAP_X)&amp;&amp;(iDeltaB==1))
<a name="l03138"></a>03138                    {
<a name="l03139"></a>03139                          fUTurnFlag=TRUE;
<a name="l03140"></a>03140                    }
<a name="l03141"></a>03141                    <span class="keywordflow">else</span> <span class="keywordflow">if</span>((iDeltaB1==WORLD_MAP_X)&amp;&amp;(iDeltaA==WORLD_MAP_X)&amp;&amp;(iDeltaB==1))
<a name="l03142"></a>03142                    {
<a name="l03143"></a>03143                          fUTurnFlag=TRUE;
<a name="l03144"></a>03144                    }
<a name="l03145"></a>03145                    <span class="keywordflow">else</span> <span class="keywordflow">if</span>((iDeltaB1==-WORLD_MAP_X)&amp;&amp;(iDeltaA==-WORLD_MAP_X)&amp;&amp;(iDeltaB==1))
<a name="l03146"></a>03146                    {
<a name="l03147"></a>03147                          fUTurnFlag=TRUE;
<a name="l03148"></a>03148                    }
<a name="l03149"></a>03149                    <span class="keywordflow">else</span> <span class="keywordflow">if</span>((iDeltaB1==-1)&amp;&amp;(iDeltaA==-1)&amp;&amp;(iDeltaB==-WORLD_MAP_X))
<a name="l03150"></a>03150                    {
<a name="l03151"></a>03151                          fUTurnFlag=TRUE;
<a name="l03152"></a>03152                    }
<a name="l03153"></a>03153                    <span class="keywordflow">else</span> <span class="keywordflow">if</span>((iDeltaB1==-1)&amp;&amp;(iDeltaA==-1)&amp;&amp;(iDeltaB==WORLD_MAP_X))
<a name="l03154"></a>03154                    {
<a name="l03155"></a>03155                          fUTurnFlag=TRUE;
<a name="l03156"></a>03156                    }
<a name="l03157"></a>03157        <span class="keywordflow">else</span> <span class="keywordflow">if</span>((iDeltaB1==1)&amp;&amp;(iDeltaA==1)&amp;&amp;(iDeltaB==-WORLD_MAP_X))
<a name="l03158"></a>03158                    {
<a name="l03159"></a>03159                          fUTurnFlag=TRUE;
<a name="l03160"></a>03160                    }
<a name="l03161"></a>03161         <span class="keywordflow">else</span> <span class="keywordflow">if</span>((iDeltaB1==1)&amp;&amp;(iDeltaA==1)&amp;&amp;(iDeltaB==WORLD_MAP_X))
<a name="l03162"></a>03162                    {
<a name="l03163"></a>03163                          fUTurnFlag=TRUE;
<a name="l03164"></a>03164                    }
<a name="l03165"></a>03165        <span class="keywordflow">else</span>
<a name="l03166"></a>03166                          fUTurnFlag=FALSE;
<a name="l03167"></a>03167                    }
<a name="l03168"></a>03168                   
<a name="l03169"></a>03169                   
<a name="l03170"></a>03170       <span class="keywordflow">if</span> ((pPastNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>==pNextNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>))
<a name="l03171"></a>03171                         {
<a name="l03172"></a>03172                          <span class="keywordflow">if</span> (pPastNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>+WORLD_MAP_X==pNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>)
<a name="l03173"></a>03173                          {
<a name="l03174"></a>03174           <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l03175"></a>03175                               {
<a name="l03176"></a>03176                                iDirection=S_TO_N_ZOOM_LINE;
<a name="l03177"></a>03177                                <span class="keywordflow">if</span>(!ubCounter)
<a name="l03178"></a>03178             iArrow=ZOOM_W_NORTH_ARROW;
<a name="l03179"></a>03179                                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(fSpeedFlag)
<a name="l03180"></a>03180             iArrow=ZOOM_Y_NORTH_ARROW;
<a name="l03181"></a>03181            <span class="keywordflow">else</span>
<a name="l03182"></a>03182                                     iArrow=ZOOM_NORTH_ARROW;
<a name="l03183"></a>03183                                iArrowX+=NORTH_OFFSET_X*2;
<a name="l03184"></a>03184                                iArrowY+=NORTH_OFFSET_Y*2;
<a name="l03185"></a>03185                               }
<a name="l03186"></a>03186           <span class="keywordflow">else</span>
<a name="l03187"></a>03187           {
<a name="l03188"></a>03188                                iDirection=S_TO_N_LINE;
<a name="l03189"></a>03189            <span class="keywordflow">if</span>(!ubCounter)
<a name="l03190"></a>03190             iArrow=W_NORTH_ARROW;
<a name="l03191"></a>03191                                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(fSpeedFlag)
<a name="l03192"></a>03192             iArrow=Y_NORTH_ARROW;
<a name="l03193"></a>03193                                <span class="keywordflow">else</span>
<a name="l03194"></a>03194                                     iArrow=NORTH_ARROW;
<a name="l03195"></a>03195                                
<a name="l03196"></a>03196                                iArrowX+=NORTH_OFFSET_X;
<a name="l03197"></a>03197                                iArrowY+=NORTH_OFFSET_Y;
<a name="l03198"></a>03198                               }
<a name="l03199"></a>03199                          }
<a name="l03200"></a>03200                          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(pPastNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>-WORLD_MAP_X==pNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>)
<a name="l03201"></a>03201                          {
<a name="l03202"></a>03202           <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l03203"></a>03203                               {
<a name="l03204"></a>03204                                iDirection=N_TO_S_ZOOM_LINE;
<a name="l03205"></a>03205            <span class="keywordflow">if</span>(!ubCounter)
<a name="l03206"></a>03206             iArrow=ZOOM_W_SOUTH_ARROW;
<a name="l03207"></a>03207                                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(fSpeedFlag)
<a name="l03208"></a>03208             iArrow=ZOOM_Y_SOUTH_ARROW;
<a name="l03209"></a>03209                                <span class="keywordflow">else</span>
<a name="l03210"></a>03210                                     iArrow=ZOOM_SOUTH_ARROW;
<a name="l03211"></a>03211                                iArrowX+=SOUTH_OFFSET_X*2;
<a name="l03212"></a>03212                                iArrowY+=SOUTH_OFFSET_Y*2;
<a name="l03213"></a>03213                               }
<a name="l03214"></a>03214           <span class="keywordflow">else</span>
<a name="l03215"></a>03215                               {
<a name="l03216"></a>03216            iDirection=N_TO_S_LINE;
<a name="l03217"></a>03217            <span class="keywordflow">if</span>(!ubCounter)
<a name="l03218"></a>03218              iArrow=W_SOUTH_ARROW;
<a name="l03219"></a>03219                                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(fSpeedFlag)
<a name="l03220"></a>03220               iArrow=Y_SOUTH_ARROW;
<a name="l03221"></a>03221                                <span class="keywordflow">else</span>
<a name="l03222"></a>03222                                      iArrow=SOUTH_ARROW;
<a name="l03223"></a>03223                                iArrowX+=SOUTH_OFFSET_X;
<a name="l03224"></a>03224                                iArrowY+=SOUTH_OFFSET_Y;
<a name="l03225"></a>03225                               }
<a name="l03226"></a>03226                          }
<a name="l03227"></a>03227                          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pPastNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>+1==pNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>)
<a name="l03228"></a>03228                          {
<a name="l03229"></a>03229           <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l03230"></a>03230                               {
<a name="l03231"></a>03231                                iDirection=E_TO_W_ZOOM_LINE;
<a name="l03232"></a>03232            <span class="keywordflow">if</span>(!ubCounter)
<a name="l03233"></a>03233              iArrow=ZOOM_W_WEST_ARROW;
<a name="l03234"></a>03234                                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fSpeedFlag)
<a name="l03235"></a>03235               iArrow=ZOOM_Y_WEST_ARROW;
<a name="l03236"></a>03236                                <span class="keywordflow">else</span>
<a name="l03237"></a>03237                                      iArrow=ZOOM_WEST_ARROW;       
<a name="l03238"></a>03238                                iArrowX+=WEST_OFFSET_X*2;
<a name="l03239"></a>03239                                iArrowY+=WEST_OFFSET_Y*2;
<a name="l03240"></a>03240                               }
<a name="l03241"></a>03241           <span class="keywordflow">else</span>
<a name="l03242"></a>03242                               {
<a name="l03243"></a>03243                                iDirection=E_TO_W_LINE;
<a name="l03244"></a>03244            <span class="keywordflow">if</span>(!ubCounter)
<a name="l03245"></a>03245              iArrow=W_WEST_ARROW;
<a name="l03246"></a>03246                                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fSpeedFlag)
<a name="l03247"></a>03247              iArrow=Y_WEST_ARROW;
<a name="l03248"></a>03248                                <span class="keywordflow">else</span>
<a name="l03249"></a>03249                                      iArrow=WEST_ARROW; 
<a name="l03250"></a>03250                                iArrowX+=WEST_OFFSET_X;
<a name="l03251"></a>03251                                iArrowY+=WEST_OFFSET_Y;
<a name="l03252"></a>03252                               }
<a name="l03253"></a>03253                          }
<a name="l03254"></a>03254                          <span class="keywordflow">else</span>
<a name="l03255"></a>03255                          {
<a name="l03256"></a>03256           <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l03257"></a>03257                               {
<a name="l03258"></a>03258                                iDirection=W_TO_E_ZOOM_LINE;
<a name="l03259"></a>03259            <span class="keywordflow">if</span>(!ubCounter)
<a name="l03260"></a>03260              iArrow=ZOOM_W_EAST_ARROW;
<a name="l03261"></a>03261                                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fSpeedFlag)
<a name="l03262"></a>03262               iArrow=ZOOM_Y_EAST_ARROW;
<a name="l03263"></a>03263                                <span class="keywordflow">else</span>
<a name="l03264"></a>03264                                      iArrow=ZOOM_EAST_ARROW;
<a name="l03265"></a>03265                                iArrowX+=EAST_OFFSET_X*2;
<a name="l03266"></a>03266                                iArrowY+=EAST_OFFSET_Y*2;
<a name="l03267"></a>03267                               }
<a name="l03268"></a>03268           <span class="keywordflow">else</span>
<a name="l03269"></a>03269                               {
<a name="l03270"></a>03270            iDirection=W_TO_E_LINE;
<a name="l03271"></a>03271            <span class="keywordflow">if</span>(!ubCounter)
<a name="l03272"></a>03272             iArrow=W_EAST_ARROW;
<a name="l03273"></a>03273                                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fSpeedFlag)
<a name="l03274"></a>03274             iArrow=Y_EAST_ARROW;
<a name="l03275"></a>03275                                <span class="keywordflow">else</span>
<a name="l03276"></a>03276                                     iArrow=EAST_ARROW;
<a name="l03277"></a>03277                                iArrowX+=EAST_OFFSET_X;
<a name="l03278"></a>03278                                iArrowY+=EAST_OFFSET_Y;
<a name="l03279"></a>03279                               }
<a name="l03280"></a>03280                          }
<a name="l03281"></a>03281                         }
<a name="l03282"></a>03282                    <span class="keywordflow">else</span>
<a name="l03283"></a>03283                    {
<a name="l03284"></a>03284         <span class="keywordflow">if</span> ((iDeltaA==-1)&amp;&amp;(iDeltaB==1))
<a name="l03285"></a>03285                         {
<a name="l03286"></a>03286           <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l03287"></a>03287                               {
<a name="l03288"></a>03288                                iDirection=WEST_ZOOM_LINE;
<a name="l03289"></a>03289            <span class="keywordflow">if</span>(!ubCounter)
<a name="l03290"></a>03290             iArrow=ZOOM_W_WEST_ARROW;
<a name="l03291"></a>03291                                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fSpeedFlag)
<a name="l03292"></a>03292             iArrow=ZOOM_Y_WEST_ARROW;
<a name="l03293"></a>03293                                <span class="keywordflow">else</span>
<a name="l03294"></a>03294                                     iArrow=ZOOM_WEST_ARROW;
<a name="l03295"></a>03295            
<a name="l03296"></a>03296                iArrowX+=WEST_OFFSET_X*2;
<a name="l03297"></a>03297                                iArrowY+=WEST_OFFSET_Y*2;
<a name="l03298"></a>03298                               }
<a name="l03299"></a>03299           <span class="keywordflow">else</span>
<a name="l03300"></a>03300                               {
<a name="l03301"></a>03301                                iDirection=WEST_LINE;
<a name="l03302"></a>03302            <span class="keywordflow">if</span>(!ubCounter)
<a name="l03303"></a>03303             iArrow=W_WEST_ARROW;
<a name="l03304"></a>03304                                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fSpeedFlag)
<a name="l03305"></a>03305             iArrow=Y_WEST_ARROW;
<a name="l03306"></a>03306                                <span class="keywordflow">else</span>
<a name="l03307"></a>03307                                     iArrow=WEST_ARROW;
<a name="l03308"></a>03308            
<a name="l03309"></a>03309                                
<a name="l03310"></a>03310                iArrowX+=WEST_OFFSET_X;
<a name="l03311"></a>03311                                iArrowY+=WEST_OFFSET_Y;
<a name="l03312"></a>03312                               }
<a name="l03313"></a>03313                         }
<a name="l03314"></a>03314                         <span class="keywordflow">else</span> <span class="keywordflow">if</span>((iDeltaA==1)&amp;&amp;(iDeltaB==-1))
<a name="l03315"></a>03315                         {
<a name="l03316"></a>03316           <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l03317"></a>03317                               {
<a name="l03318"></a>03318                                iDirection=EAST_ZOOM_LINE;
<a name="l03319"></a>03319            <span class="keywordflow">if</span>(!ubCounter)
<a name="l03320"></a>03320             iArrow=ZOOM_W_EAST_ARROW;
<a name="l03321"></a>03321                                <span class="keywordflow">else</span>
<a name="l03322"></a>03322                                     iArrow=ZOOM_EAST_ARROW;
<a name="l03323"></a>03323           
<a name="l03324"></a>03324                                iArrowX+=EAST_OFFSET_X*2;
<a name="l03325"></a>03325                                iArrowY+=EAST_OFFSET_Y*2;
<a name="l03326"></a>03326                               }
<a name="l03327"></a>03327           <span class="keywordflow">else</span>
<a name="l03328"></a>03328                               {
<a name="l03329"></a>03329                                iDirection=EAST_LINE;
<a name="l03330"></a>03330            <span class="keywordflow">if</span>(!ubCounter)
<a name="l03331"></a>03331             iArrow=W_EAST_ARROW;
<a name="l03332"></a>03332                                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fSpeedFlag)
<a name="l03333"></a>03333             iArrow=Y_EAST_ARROW;
<a name="l03334"></a>03334                                <span class="keywordflow">else</span>
<a name="l03335"></a>03335                                     iArrow=EAST_ARROW;
<a name="l03336"></a>03336                                
<a name="l03337"></a>03337                                iArrowX+=EAST_OFFSET_X;
<a name="l03338"></a>03338                                iArrowY+=EAST_OFFSET_Y;
<a name="l03339"></a>03339                               }
<a name="l03340"></a>03340                         }
<a name="l03341"></a>03341                         <span class="keywordflow">else</span> <span class="keywordflow">if</span>((iDeltaA==-WORLD_MAP_X)&amp;&amp;(iDeltaB==WORLD_MAP_X))
<a name="l03342"></a>03342                         {
<a name="l03343"></a>03343           <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l03344"></a>03344                               {
<a name="l03345"></a>03345                                iDirection=NORTH_ZOOM_LINE;
<a name="l03346"></a>03346            <span class="keywordflow">if</span>(!ubCounter)
<a name="l03347"></a>03347             iArrow=ZOOM_W_NORTH_ARROW;
<a name="l03348"></a>03348                                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fSpeedFlag)
<a name="l03349"></a>03349             iArrow=ZOOM_Y_NORTH_ARROW;
<a name="l03350"></a>03350                                <span class="keywordflow">else</span>
<a name="l03351"></a>03351                                 iArrow=ZOOM_NORTH_ARROW;
<a name="l03352"></a>03352            
<a name="l03353"></a>03353                                iArrowX+=NORTH_OFFSET_X*2;
<a name="l03354"></a>03354                                iArrowY+=NORTH_OFFSET_Y*2;
<a name="l03355"></a>03355                               }
<a name="l03356"></a>03356           <span class="keywordflow">else</span>
<a name="l03357"></a>03357                               {
<a name="l03358"></a>03358                                iDirection=NORTH_LINE;
<a name="l03359"></a>03359            <span class="keywordflow">if</span>(!ubCounter)
<a name="l03360"></a>03360             iArrow=W_NORTH_ARROW;
<a name="l03361"></a>03361                                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fSpeedFlag)
<a name="l03362"></a>03362             iArrow=Y_NORTH_ARROW;
<a name="l03363"></a>03363                                <span class="keywordflow">else</span>
<a name="l03364"></a>03364                                 iArrow=NORTH_ARROW;
<a name="l03365"></a>03365                                
<a name="l03366"></a>03366            iArrowX+=NORTH_OFFSET_X;
<a name="l03367"></a>03367                                iArrowY+=NORTH_OFFSET_Y;
<a name="l03368"></a>03368                               }
<a name="l03369"></a>03369                         }
<a name="l03370"></a>03370                         <span class="keywordflow">else</span> <span class="keywordflow">if</span>((iDeltaA==WORLD_MAP_X)&amp;&amp;(iDeltaB==-WORLD_MAP_X))
<a name="l03371"></a>03371                         {
<a name="l03372"></a>03372          <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l03373"></a>03373                          {
<a name="l03374"></a>03374                               iDirection=SOUTH_ZOOM_LINE;
<a name="l03375"></a>03375           <span class="keywordflow">if</span>(!ubCounter)
<a name="l03376"></a>03376            iArrow=ZOOM_W_SOUTH_ARROW;
<a name="l03377"></a>03377           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fSpeedFlag)
<a name="l03378"></a>03378             iArrow=ZOOM_Y_SOUTH_ARROW;
<a name="l03379"></a>03379                               <span class="keywordflow">else</span>
<a name="l03380"></a>03380                                iArrow=ZOOM_SOUTH_ARROW;
<a name="l03381"></a>03381           
<a name="l03382"></a>03382           iArrowX+=SOUTH_OFFSET_X*2;
<a name="l03383"></a>03383                           iArrowY+=SOUTH_OFFSET_Y*2;
<a name="l03384"></a>03384                          }
<a name="l03385"></a>03385          <span class="keywordflow">else</span>
<a name="l03386"></a>03386                          {
<a name="l03387"></a>03387                               iDirection=SOUTH_LINE;
<a name="l03388"></a>03388           <span class="keywordflow">if</span>(!ubCounter)
<a name="l03389"></a>03389            iArrow=W_SOUTH_ARROW;
<a name="l03390"></a>03390                               <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fSpeedFlag)
<a name="l03391"></a>03391            iArrow=Y_SOUTH_ARROW;
<a name="l03392"></a>03392                               <span class="keywordflow">else</span>
<a name="l03393"></a>03393                                iArrow=SOUTH_ARROW;
<a name="l03394"></a>03394                          
<a name="l03395"></a>03395           iArrowX+=SOUTH_OFFSET_X;
<a name="l03396"></a>03396                           iArrowY+=SOUTH_OFFSET_Y;
<a name="l03397"></a>03397                          }
<a name="l03398"></a>03398                         }
<a name="l03399"></a>03399                         <span class="keywordflow">else</span> <span class="keywordflow">if</span>((iDeltaA==-WORLD_MAP_X)&amp;&amp;(iDeltaB==-1))
<a name="l03400"></a>03400                         {
<a name="l03401"></a>03401           <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l03402"></a>03402                               {
<a name="l03403"></a>03403                                iDirection=N_TO_E_ZOOM_LINE;
<a name="l03404"></a>03404            <span class="keywordflow">if</span>(!ubCounter)
<a name="l03405"></a>03405             iArrow=ZOOM_W_EAST_ARROW;
<a name="l03406"></a>03406                                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fSpeedFlag)
<a name="l03407"></a>03407            iArrow=ZOOM_Y_EAST_ARROW;
<a name="l03408"></a>03408                                <span class="keywordflow">else</span>
<a name="l03409"></a>03409                                 iArrow=ZOOM_EAST_ARROW;
<a name="l03410"></a>03410            
<a name="l03411"></a>03411            iArrowX+=EAST_OFFSET_X*2;
<a name="l03412"></a>03412                                iArrowY+=EAST_OFFSET_Y*2;
<a name="l03413"></a>03413                               }
<a name="l03414"></a>03414           <span class="keywordflow">else</span>
<a name="l03415"></a>03415                               {
<a name="l03416"></a>03416                                iDirection=N_TO_E_LINE;
<a name="l03417"></a>03417            <span class="keywordflow">if</span>(!ubCounter)
<a name="l03418"></a>03418             iArrow=W_EAST_ARROW;
<a name="l03419"></a>03419                                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fSpeedFlag)
<a name="l03420"></a>03420             iArrow=Y_EAST_ARROW;
<a name="l03421"></a>03421                                <span class="keywordflow">else</span>
<a name="l03422"></a>03422                                 iArrow=EAST_ARROW;
<a name="l03423"></a>03423                                
<a name="l03424"></a>03424            iArrowX+=EAST_OFFSET_X;
<a name="l03425"></a>03425                                iArrowY+=EAST_OFFSET_Y;
<a name="l03426"></a>03426                               }
<a name="l03427"></a>03427                         }
<a name="l03428"></a>03428                         <span class="keywordflow">else</span> <span class="keywordflow">if</span>((iDeltaA==WORLD_MAP_X)&amp;&amp;(iDeltaB==1))
<a name="l03429"></a>03429                         {
<a name="l03430"></a>03430           <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l03431"></a>03431                               {
<a name="l03432"></a>03432                                iDirection=S_TO_W_ZOOM_LINE;
<a name="l03433"></a>03433            <span class="keywordflow">if</span>(!ubCounter)
<a name="l03434"></a>03434              iArrow=ZOOM_W_WEST_ARROW;
<a name="l03435"></a>03435                                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fSpeedFlag)
<a name="l03436"></a>03436              iArrow=ZOOM_Y_WEST_ARROW;
<a name="l03437"></a>03437                                <span class="keywordflow">else</span>
<a name="l03438"></a>03438                                  iArrow=ZOOM_WEST_ARROW;
<a name="l03439"></a>03439           
<a name="l03440"></a>03440              iArrowX+=WEST_OFFSET_X*2;
<a name="l03441"></a>03441                                iArrowY+=WEST_OFFSET_Y*2;
<a name="l03442"></a>03442                               }
<a name="l03443"></a>03443           <span class="keywordflow">else</span>
<a name="l03444"></a>03444                               {
<a name="l03445"></a>03445                                iDirection=S_TO_W_LINE;
<a name="l03446"></a>03446            <span class="keywordflow">if</span>(!ubCounter)
<a name="l03447"></a>03447              iArrow=W_WEST_ARROW;
<a name="l03448"></a>03448                                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fSpeedFlag)
<a name="l03449"></a>03449               iArrow=Y_WEST_ARROW;
<a name="l03450"></a>03450                                <span class="keywordflow">else</span>
<a name="l03451"></a>03451                                  iArrow=WEST_ARROW;
<a name="l03452"></a>03452           
<a name="l03453"></a>03453                                
<a name="l03454"></a>03454              iArrowX+=WEST_OFFSET_X;
<a name="l03455"></a>03455                                iArrowY+=WEST_OFFSET_Y;
<a name="l03456"></a>03456                               }
<a name="l03457"></a>03457                         }
<a name="l03458"></a>03458                         <span class="keywordflow">else</span> <span class="keywordflow">if</span>((iDeltaA==1)&amp;&amp;(iDeltaB==-WORLD_MAP_X))
<a name="l03459"></a>03459                         {
<a name="l03460"></a>03460           <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l03461"></a>03461                               {
<a name="l03462"></a>03462                                iDirection=E_TO_S_ZOOM_LINE;
<a name="l03463"></a>03463            <span class="keywordflow">if</span>(!ubCounter)
<a name="l03464"></a>03464             iArrow=ZOOM_W_SOUTH_ARROW;
<a name="l03465"></a>03465                                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fSpeedFlag)
<a name="l03466"></a>03466              iArrow=ZOOM_Y_SOUTH_ARROW;
<a name="l03467"></a>03467                                <span class="keywordflow">else</span>
<a name="l03468"></a>03468                                 iArrow=ZOOM_SOUTH_ARROW;
<a name="l03469"></a>03469            
<a name="l03470"></a>03470            iArrowX+=SOUTH_OFFSET_X*2;
<a name="l03471"></a>03471                                iArrowY+=SOUTH_OFFSET_Y*2;
<a name="l03472"></a>03472                               }
<a name="l03473"></a>03473           <span class="keywordflow">else</span>
<a name="l03474"></a>03474                               {
<a name="l03475"></a>03475                                iDirection=E_TO_S_LINE;
<a name="l03476"></a>03476            <span class="keywordflow">if</span>(!ubCounter)
<a name="l03477"></a>03477             iArrow=W_SOUTH_ARROW;
<a name="l03478"></a>03478                                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fSpeedFlag)
<a name="l03479"></a>03479              iArrow=Y_SOUTH_ARROW;
<a name="l03480"></a>03480                                <span class="keywordflow">else</span>
<a name="l03481"></a>03481                                 iArrow=SOUTH_ARROW;
<a name="l03482"></a>03482                               
<a name="l03483"></a>03483            iArrowX+=SOUTH_OFFSET_X;
<a name="l03484"></a>03484                                iArrowY+=SOUTH_OFFSET_Y;
<a name="l03485"></a>03485                               }
<a name="l03486"></a>03486                         }
<a name="l03487"></a>03487                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((iDeltaA==-1)&amp;&amp;(iDeltaB==WORLD_MAP_X))
<a name="l03488"></a>03488                         {
<a name="l03489"></a>03489           <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l03490"></a>03490                               {
<a name="l03491"></a>03491                                iDirection=W_TO_N_ZOOM_LINE;
<a name="l03492"></a>03492            <span class="keywordflow">if</span>(!ubCounter)
<a name="l03493"></a>03493             iArrow=ZOOM_W_NORTH_ARROW;
<a name="l03494"></a>03494                                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fSpeedFlag)
<a name="l03495"></a>03495               iArrow=ZOOM_Y_NORTH_ARROW;
<a name="l03496"></a>03496                                <span class="keywordflow">else</span>
<a name="l03497"></a>03497                                 iArrow=ZOOM_NORTH_ARROW;
<a name="l03498"></a>03498            
<a name="l03499"></a>03499            iArrowX+=NORTH_OFFSET_X*2;
<a name="l03500"></a>03500                                iArrowY+=NORTH_OFFSET_Y*2;
<a name="l03501"></a>03501                               }
<a name="l03502"></a>03502           <span class="keywordflow">else</span>
<a name="l03503"></a>03503                               {
<a name="l03504"></a>03504                                iDirection=W_TO_N_LINE;
<a name="l03505"></a>03505            <span class="keywordflow">if</span>(!ubCounter)
<a name="l03506"></a>03506             iArrow=W_NORTH_ARROW;
<a name="l03507"></a>03507                                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fSpeedFlag)
<a name="l03508"></a>03508               iArrow=Y_NORTH_ARROW;
<a name="l03509"></a>03509                                <span class="keywordflow">else</span>
<a name="l03510"></a>03510                                 iArrow=NORTH_ARROW;
<a name="l03511"></a>03511                                
<a name="l03512"></a>03512            iArrowX+=NORTH_OFFSET_X;
<a name="l03513"></a>03513                                iArrowY+=NORTH_OFFSET_Y;
<a name="l03514"></a>03514                               }
<a name="l03515"></a>03515                         }
<a name="l03516"></a>03516                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((iDeltaA==-1)&amp;&amp;(iDeltaB==-WORLD_MAP_X))
<a name="l03517"></a>03517                         {
<a name="l03518"></a>03518           <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l03519"></a>03519                               {
<a name="l03520"></a>03520                                iDirection=W_TO_S_ZOOM_LINE;
<a name="l03521"></a>03521            <span class="keywordflow">if</span>(!ubCounter)
<a name="l03522"></a>03522             iArrow=ZOOM_W_SOUTH_ARROW;
<a name="l03523"></a>03523                                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fSpeedFlag)
<a name="l03524"></a>03524               iArrow=ZOOM_Y_SOUTH_ARROW;
<a name="l03525"></a>03525                                <span class="keywordflow">else</span>
<a name="l03526"></a>03526                                 iArrow=ZOOM_SOUTH_ARROW;
<a name="l03527"></a>03527            
<a name="l03528"></a>03528            iArrowX+=SOUTH_OFFSET_X*2;
<a name="l03529"></a>03529                                iArrowY+=(SOUTH_OFFSET_Y+WEST_TO_SOUTH_OFFSET_Y)*2;
<a name="l03530"></a>03530                               }
<a name="l03531"></a>03531           <span class="keywordflow">else</span>
<a name="l03532"></a>03532                               {
<a name="l03533"></a>03533                                iDirection=W_TO_S_LINE;
<a name="l03534"></a>03534            <span class="keywordflow">if</span>(!ubCounter)
<a name="l03535"></a>03535             iArrow=W_SOUTH_ARROW;
<a name="l03536"></a>03536                                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fSpeedFlag)
<a name="l03537"></a>03537             iArrow=Y_SOUTH_ARROW;
<a name="l03538"></a>03538                                <span class="keywordflow">else</span>
<a name="l03539"></a>03539                                 iArrow=SOUTH_ARROW;
<a name="l03540"></a>03540            iArrowX+=SOUTH_OFFSET_X;
<a name="l03541"></a>03541                                iArrowY+=(SOUTH_OFFSET_Y+WEST_TO_SOUTH_OFFSET_Y);
<a name="l03542"></a>03542                               }
<a name="l03543"></a>03543                         }
<a name="l03544"></a>03544                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((iDeltaA==-WORLD_MAP_X)&amp;&amp;(iDeltaB==1))
<a name="l03545"></a>03545                         {
<a name="l03546"></a>03546           <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l03547"></a>03547                               {
<a name="l03548"></a>03548                                iDirection=N_TO_W_ZOOM_LINE;
<a name="l03549"></a>03549            <span class="keywordflow">if</span>(!ubCounter)
<a name="l03550"></a>03550             iArrow=ZOOM_W_WEST_ARROW;
<a name="l03551"></a>03551                                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fSpeedFlag)
<a name="l03552"></a>03552             iArrow=ZOOM_Y_WEST_ARROW;
<a name="l03553"></a>03553                                <span class="keywordflow">else</span>
<a name="l03554"></a>03554                                 iArrow=ZOOM_WEST_ARROW;
<a name="l03555"></a>03555           
<a name="l03556"></a>03556            iArrowX+=WEST_OFFSET_X*2;
<a name="l03557"></a>03557                                iArrowY+=WEST_OFFSET_Y*2;
<a name="l03558"></a>03558                               }
<a name="l03559"></a>03559           <span class="keywordflow">else</span>
<a name="l03560"></a>03560                               {
<a name="l03561"></a>03561                                iDirection=N_TO_W_LINE;
<a name="l03562"></a>03562            <span class="keywordflow">if</span>(!ubCounter)
<a name="l03563"></a>03563             iArrow=W_WEST_ARROW;
<a name="l03564"></a>03564                                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fSpeedFlag)
<a name="l03565"></a>03565             iArrow=Y_WEST_ARROW;
<a name="l03566"></a>03566                                <span class="keywordflow">else</span>
<a name="l03567"></a>03567                                 iArrow=WEST_ARROW;
<a name="l03568"></a>03568                                
<a name="l03569"></a>03569            iArrowX+=WEST_OFFSET_X;
<a name="l03570"></a>03570                                iArrowY+=WEST_OFFSET_Y;
<a name="l03571"></a>03571                               }
<a name="l03572"></a>03572                         }
<a name="l03573"></a>03573                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((iDeltaA==WORLD_MAP_X)&amp;&amp;(iDeltaB==-1))
<a name="l03574"></a>03574                         {
<a name="l03575"></a>03575           <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l03576"></a>03576                               {
<a name="l03577"></a>03577                                iDirection=S_TO_E_ZOOM_LINE;
<a name="l03578"></a>03578            <span class="keywordflow">if</span>(!ubCounter)
<a name="l03579"></a>03579             iArrow=ZOOM_W_EAST_ARROW;
<a name="l03580"></a>03580                                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fSpeedFlag)
<a name="l03581"></a>03581             iArrow=ZOOM_Y_EAST_ARROW;
<a name="l03582"></a>03582                                <span class="keywordflow">else</span>
<a name="l03583"></a>03583                                 iArrow=ZOOM_EAST_ARROW;
<a name="l03584"></a>03584                iArrowX+=EAST_OFFSET_X*2;
<a name="l03585"></a>03585                                iArrowY+=EAST_OFFSET_Y*2;
<a name="l03586"></a>03586                               }
<a name="l03587"></a>03587           <span class="keywordflow">else</span>
<a name="l03588"></a>03588                               {
<a name="l03589"></a>03589                                iDirection=S_TO_E_LINE;
<a name="l03590"></a>03590            <span class="keywordflow">if</span>(!ubCounter)
<a name="l03591"></a>03591             iArrow=W_EAST_ARROW;
<a name="l03592"></a>03592            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fSpeedFlag)
<a name="l03593"></a>03593             iArrow=Y_EAST_ARROW;
<a name="l03594"></a>03594                                <span class="keywordflow">else</span>
<a name="l03595"></a>03595                                 iArrow=EAST_ARROW;
<a name="l03596"></a>03596                                iArrowX+=EAST_OFFSET_X;
<a name="l03597"></a>03597                                iArrowY+=EAST_OFFSET_Y;
<a name="l03598"></a>03598                               }
<a name="l03599"></a>03599                         }
<a name="l03600"></a>03600                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((iDeltaA==1)&amp;&amp;(iDeltaB==WORLD_MAP_X))
<a name="l03601"></a>03601                         {
<a name="l03602"></a>03602           <span class="keywordflow">if</span>(<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l03603"></a>03603                               {
<a name="l03604"></a>03604                                iDirection=E_TO_N_ZOOM_LINE;
<a name="l03605"></a>03605            <span class="keywordflow">if</span>(!ubCounter)
<a name="l03606"></a>03606             iArrow=ZOOM_W_NORTH_ARROW;
<a name="l03607"></a>03607                                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fSpeedFlag)
<a name="l03608"></a>03608              iArrow=ZOOM_Y_NORTH_ARROW;
<a name="l03609"></a>03609                                <span class="keywordflow">else</span>
<a name="l03610"></a>03610                                 iArrow=ZOOM_NORTH_ARROW;
<a name="l03611"></a>03611            iArrowX+=(NORTH_OFFSET_X*2);
<a name="l03612"></a>03612                                iArrowY+=(NORTH_OFFSET_Y+EAST_TO_NORTH_OFFSET_Y)*2;
<a name="l03613"></a>03613                               }
<a name="l03614"></a>03614           <span class="keywordflow">else</span>
<a name="l03615"></a>03615                               {
<a name="l03616"></a>03616                                iDirection=E_TO_N_LINE;
<a name="l03617"></a>03617            <span class="keywordflow">if</span>(!ubCounter)
<a name="l03618"></a>03618             iArrow=W_NORTH_ARROW;
<a name="l03619"></a>03619                                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fSpeedFlag)
<a name="l03620"></a>03620              iArrow=Y_NORTH_ARROW;
<a name="l03621"></a>03621                                <span class="keywordflow">else</span>
<a name="l03622"></a>03622                                  iArrow=NORTH_ARROW;
<a name="l03623"></a>03623                               
<a name="l03624"></a>03624            iArrowX+=NORTH_OFFSET_X;
<a name="l03625"></a>03625                                iArrowY+=NORTH_OFFSET_Y+EAST_TO_NORTH_OFFSET_Y;
<a name="l03626"></a>03626                               }
<a name="l03627"></a>03627                         }
<a name="l03628"></a>03628                    }
<a name="l03629"></a>03629                   
<a name="l03630"></a>03630              }
<a name="l03631"></a>03631        
<a name="l03632"></a>03632      <span class="keywordflow">else</span>
<a name="l03633"></a>03633              {
<a name="l03634"></a>03634               iX=(pNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>%MAP_WORLD_X);
<a name="l03635"></a>03635               iY=(pNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>/MAP_WORLD_X);
<a name="l03636"></a>03636               iX=(iX*MAP_GRID_X)+MAP_VIEW_START_X;
<a name="l03637"></a>03637               iY=(iY*MAP_GRID_Y)+MAP_VIEW_START_Y;
<a name="l03638"></a>03638                   <span class="keywordflow">if</span>(pPastNode)
<a name="l03639"></a>03639                   {
<a name="l03640"></a>03640                iPastX=(pPastNode-&gt;uiSectorId%MAP_WORLD_X);
<a name="l03641"></a>03641        iPastY=(pPastNode-&gt;uiSectorId/MAP_WORLD_X);
<a name="l03642"></a>03642        iPastX=(iPastX*MAP_GRID_X)+MAP_VIEW_START_X;
<a name="l03643"></a>03643                iPastY=(iPastY*MAP_GRID_Y)+MAP_VIEW_START_Y;
<a name="l03644"></a>03644                   }
<a name="l03645"></a>03645       <span class="keywordflow">if</span>(pNode-&gt;<a class="code" href="structpath.html#546cbaeb8d8e229fd5beb09ce1b8d9c9">fSpeed</a>)
<a name="l03646"></a>03646                         fSpeedFlag=TRUE;
<a name="l03647"></a>03647                   <span class="keywordflow">else</span>
<a name="l03648"></a>03648                         fSpeedFlag=FALSE;
<a name="l03649"></a>03649                   iArrowX=iX;
<a name="l03650"></a>03650                   iArrowY=iY;
<a name="l03651"></a>03651                   <span class="comment">// display enter and exit 'X's</span>
<a name="l03652"></a>03652       <span class="keywordflow">if</span> (pPastNode)
<a name="l03653"></a>03653                   {
<a name="l03654"></a>03654                         <span class="comment">// red 'X'</span>
<a name="l03655"></a>03655                         fUTurnFlag=TRUE;
<a name="l03656"></a>03656         iDeltaA=(<a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a>)pNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>-(<a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a>)pPastNode-&gt;uiSectorId;
<a name="l03657"></a>03657                         <span class="keywordflow">if</span> (iDeltaA==-1)
<a name="l03658"></a>03658                         {
<a name="l03659"></a>03659                               iDirection=RED_X_WEST;
<a name="l03660"></a>03660                   <span class="comment">//iX+=RED_WEST_OFF_X;</span>
<a name="l03661"></a>03661                         }
<a name="l03662"></a>03662                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iDeltaA==1)
<a name="l03663"></a>03663                         {
<a name="l03664"></a>03664                               iDirection=RED_X_EAST;
<a name="l03665"></a>03665                               <span class="comment">//iX+=RED_EAST_OFF_X;</span>
<a name="l03666"></a>03666                         }
<a name="l03667"></a>03667                         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(iDeltaA==-WORLD_MAP_X)
<a name="l03668"></a>03668                         {
<a name="l03669"></a>03669                               iDirection=RED_X_NORTH;
<a name="l03670"></a>03670                               <span class="comment">//iY+=RED_NORTH_OFF_Y;</span>
<a name="l03671"></a>03671                         }
<a name="l03672"></a>03672                         <span class="keywordflow">else</span> 
<a name="l03673"></a>03673                         {
<a name="l03674"></a>03674                               iDirection=RED_X_SOUTH;
<a name="l03675"></a>03675                         <span class="comment">//    iY+=RED_SOUTH_OFF_Y;</span>
<a name="l03676"></a>03676                         }
<a name="l03677"></a>03677                   }
<a name="l03678"></a>03678                   <span class="keywordflow">if</span> (pNextNode)
<a name="l03679"></a>03679                   {
<a name="l03680"></a>03680        fUTurnFlag=FALSE;
<a name="l03681"></a>03681        iDeltaB=(<a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a>)pNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>-(<a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a>)pNextNode-&gt;<a class="code" href="structpath.html#aff8c504eb03153365292533ee7318ea">uiSectorId</a>;
<a name="l03682"></a>03682             <span class="keywordflow">if</span> (iDeltaB==-1)
<a name="l03683"></a>03683                         {
<a name="l03684"></a>03684                               iDirection=GREEN_X_EAST;
<a name="l03685"></a>03685           <span class="keywordflow">if</span>(!ubCounter)
<a name="l03686"></a>03686             iArrow=W_EAST_ARROW;
<a name="l03687"></a>03687                               <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fSpeedFlag)
<a name="l03688"></a>03688             iArrow=Y_EAST_ARROW;
<a name="l03689"></a>03689                               <span class="keywordflow">else</span>
<a name="l03690"></a>03690                                 iArrow=EAST_ARROW;
<a name="l03691"></a>03691           
<a name="l03692"></a>03692           iArrowX+=EAST_OFFSET_X;
<a name="l03693"></a>03693                               iArrowY+=EAST_OFFSET_Y;
<a name="l03694"></a>03694                               <span class="comment">//iX+=RED_EAST_OFF_X;</span>
<a name="l03695"></a>03695                         }
<a name="l03696"></a>03696                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iDeltaB==1)
<a name="l03697"></a>03697                         {
<a name="l03698"></a>03698                               iDirection=GREEN_X_WEST;
<a name="l03699"></a>03699            <span class="keywordflow">if</span>(!ubCounter)
<a name="l03700"></a>03700             iArrow=W_WEST_ARROW;
<a name="l03701"></a>03701                                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fSpeedFlag)
<a name="l03702"></a>03702             iArrow=Y_WEST_ARROW;
<a name="l03703"></a>03703                                <span class="keywordflow">else</span>
<a name="l03704"></a>03704                                 iArrow=WEST_ARROW;                              
<a name="l03705"></a>03705           
<a name="l03706"></a>03706           iArrowX+=WEST_OFFSET_X;
<a name="l03707"></a>03707                               iArrowY+=WEST_OFFSET_Y;
<a name="l03708"></a>03708                               <span class="comment">//iX+=RED_WEST_OFF_X;</span>
<a name="l03709"></a>03709                         }
<a name="l03710"></a>03710                         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(iDeltaB==WORLD_MAP_X)
<a name="l03711"></a>03711                         {
<a name="l03712"></a>03712                               iDirection=GREEN_X_NORTH;
<a name="l03713"></a>03713           <span class="keywordflow">if</span>(!ubCounter)
<a name="l03714"></a>03714            iArrow=W_NORTH_ARROW;
<a name="l03715"></a>03715                               <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fSpeedFlag)
<a name="l03716"></a>03716             iArrow=Y_NORTH_ARROW;
<a name="l03717"></a>03717                               <span class="keywordflow">else</span>
<a name="l03718"></a>03718                                iArrow=NORTH_ARROW;
<a name="l03719"></a>03719          
<a name="l03720"></a>03720             iArrowX+=NORTH_OFFSET_X;
<a name="l03721"></a>03721                               iArrowY+=NORTH_OFFSET_Y;
<a name="l03722"></a>03722                               <span class="comment">//iY+=RED_NORTH_OFF_Y;</span>
<a name="l03723"></a>03723                         }
<a name="l03724"></a>03724                         <span class="keywordflow">else</span> 
<a name="l03725"></a>03725                         {
<a name="l03726"></a>03726                               iDirection=GREEN_X_SOUTH;
<a name="l03727"></a>03727           <span class="keywordflow">if</span>(!ubCounter)
<a name="l03728"></a>03728             iArrow=W_SOUTH_ARROW;
<a name="l03729"></a>03729                               <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fSpeedFlag)
<a name="l03730"></a>03730            iArrow=Y_SOUTH_ARROW;
<a name="l03731"></a>03731                               <span class="keywordflow">else</span>
<a name="l03732"></a>03732                                iArrow=SOUTH_ARROW;
<a name="l03733"></a>03733           iArrowX+=SOUTH_OFFSET_X;
<a name="l03734"></a>03734                               iArrowY+=SOUTH_OFFSET_Y;
<a name="l03735"></a>03735                               <span class="comment">//iY+=RED_SOUTH_OFF_Y;</span>
<a name="l03736"></a>03736                         }
<a name="l03737"></a>03737                   
<a name="l03738"></a>03738                   
<a name="l03739"></a>03739              }
<a name="l03740"></a>03740              }
<a name="l03741"></a>03741           <span class="keywordflow">if</span>(fNextNode)
<a name="l03742"></a>03742                   {
<a name="l03743"></a>03743                         <span class="keywordflow">if</span>(!ubCounter)
<a name="l03744"></a>03744                         {
<a name="l03745"></a>03745             pCurrentNode=pCurrentNode-&gt;<a class="code" href="structpath.html#3aece431545f290e21842d7ddd3d78af">pNext</a>;
<a name="l03746"></a>03746                 <span class="keywordflow">if</span>(!pCurrentNode)
<a name="l03747"></a>03747                      fPauseFlag=TRUE;
<a name="l03748"></a>03748                         }
<a name="l03749"></a>03749                   }
<a name="l03750"></a>03750             <span class="keywordflow">if</span> ((iDirection !=-1)&amp;&amp;(iArrow!=-1))
<a name="l03751"></a>03751             {
<a name="l03752"></a>03752        
<a name="l03753"></a>03753       <span class="keywordflow">if</span>(!fUTurnFlag)
<a name="l03754"></a>03754                   {
<a name="l03755"></a>03755        <span class="keywordflow">if</span>((!<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)||((<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)&amp;&amp;(iX &gt;MAP_VIEW_START_X)&amp;&amp;(iY &gt;MAP_VIEW_START_Y)&amp;&amp;(iX &lt; 640-MAP_GRID_X*2)&amp;&amp;(iY &lt; MAP_VIEW_START_Y+MAP_VIEW_HEIGHT)))
<a name="l03756"></a>03756                    {
<a name="l03757"></a>03757         
<a name="l03758"></a>03758          <span class="comment">//if(!fZoomFlag)</span>
<a name="l03759"></a>03759           <span class="comment">//RestoreExternBackgroundRect(((INT16)iArrowX),((INT16)iArrowY),DMAP_GRID_X, DMAP_GRID_Y);              </span>
<a name="l03760"></a>03760                          <span class="comment">//else</span>
<a name="l03761"></a>03761           <span class="comment">//RestoreExternBackgroundRect(((INT16)iArrowX), ((INT16)iArrowY),DMAP_GRID_ZOOM_X, DMAP_GRID_ZOOM_Y);               </span>
<a name="l03762"></a>03762                          <span class="keywordflow">if</span>( pNode != pPath )
<a name="l03763"></a>03763                          {
<a name="l03764"></a>03764                                <a class="code" href="vobject_8cpp.html#8a5b07441769401593743b9f52a9e353">BltVideoObject</a>(FRAME_BUFFER, hMapHandle, (<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>)iArrow, iArrowX, iArrowY, VO_BLT_SRCTRANSPARENCY, NULL );
<a name="l03765"></a>03765                                <a class="code" href="video_8cpp.html#4ed7790da612ff97bf9c05cf186823bc">InvalidateRegion</a>( iArrowX, iArrowY, iArrowX + 2 * MAP_GRID_X, iArrowY + 2 * MAP_GRID_Y );
<a name="l03766"></a>03766                          }
<a name="l03767"></a>03767                    }
<a name="l03768"></a>03768        <span class="keywordflow">if</span>(ubCounter==1)
<a name="l03769"></a>03769             ubCounter=0;
<a name="l03770"></a>03770            <span class="keywordflow">else</span>
<a name="l03771"></a>03771         ubCounter=1; 
<a name="l03772"></a>03772                <span class="keywordflow">return</span> TRUE;
<a name="l03773"></a>03773                   }
<a name="l03774"></a>03774       <span class="keywordflow">if</span>(ubCounter==1)
<a name="l03775"></a>03775            ubCounter=0;
<a name="l03776"></a>03776           <span class="keywordflow">else</span>
<a name="l03777"></a>03777        ubCounter=1; 
<a name="l03778"></a>03778 
<a name="l03779"></a>03779                   
<a name="l03780"></a>03780             }
<a name="l03781"></a>03781             <span class="comment">// move to next arrow</span>
<a name="l03782"></a>03782       
<a name="l03783"></a>03783 
<a name="l03784"></a>03784 <span class="comment">//ARM who knows what it should return here?</span>
<a name="l03785"></a>03785       <span class="keywordflow">return</span> FALSE;
<a name="l03786"></a>03786 }
<a name="l03787"></a>03787 
<a name="l03788"></a>03788 
<a name="l03789"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e3291997697659d40693911e10c1f573">03789</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e3291997697659d40693911e10c1f573">DisplayThePotentialPathForHelicopter</a>(<a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapY )
<a name="l03790"></a>03790 {
<a name="l03791"></a>03791       <span class="comment">// simply check if we want to refresh the screen to display path</span>
<a name="l03792"></a>03792       <span class="keyword">static</span> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fOldShowAirCraft = FALSE;
<a name="l03793"></a>03793   <span class="keyword">static</span> <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a>  sOldMapX, sOldMapY;
<a name="l03794"></a>03794       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iDifference = 0;
<a name="l03795"></a>03795 
<a name="l03796"></a>03796 
<a name="l03797"></a>03797       <span class="keywordflow">if</span>( fOldShowAirCraft != <a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3eb1c4052a5a9718b9b73c9851737930">fShowAircraftFlag</a> )
<a name="l03798"></a>03798       {
<a name="l03799"></a>03799             fOldShowAirCraft = <a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3eb1c4052a5a9718b9b73c9851737930">fShowAircraftFlag</a>;
<a name="l03800"></a>03800         <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0963b9b8705cba0f9e56c996cf52a44b">giPotHeliPathBaseTime</a> = GetJA2Clock( );
<a name="l03801"></a>03801             
<a name="l03802"></a>03802             sOldMapX = sMapX;
<a name="l03803"></a>03803             sOldMapY = sMapY;
<a name="l03804"></a>03804             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#5e2086b4616df4222511a7c45e8ffc42">fTempPathAlreadyDrawn</a> = FALSE;
<a name="l03805"></a>03805             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#f961d76541dbc0eb36d42c770bb1dd2f">fDrawTempHeliPath</a> = FALSE;
<a name="l03806"></a>03806 
<a name="l03807"></a>03807       }
<a name="l03808"></a>03808 
<a name="l03809"></a>03809       <span class="keywordflow">if</span>( ( sMapX != sOldMapX) || ( sMapY != sOldMapY ) )
<a name="l03810"></a>03810       {
<a name="l03811"></a>03811             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0963b9b8705cba0f9e56c996cf52a44b">giPotHeliPathBaseTime</a> = GetJA2Clock( );
<a name="l03812"></a>03812             
<a name="l03813"></a>03813             sOldMapX = sMapX;
<a name="l03814"></a>03814             sOldMapY = sMapY;
<a name="l03815"></a>03815 
<a name="l03816"></a>03816             <span class="comment">// path was plotted and we moved, re draw map..to clean up mess</span>
<a name="l03817"></a>03817             <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#5e2086b4616df4222511a7c45e8ffc42">fTempPathAlreadyDrawn</a> )
<a name="l03818"></a>03818             {
<a name="l03819"></a>03819                   <a class="code" href="HelpScreen_8cpp.html#be83f0093f2fba05817df5b4592ab0f0">fMapPanelDirty</a> = TRUE;
<a name="l03820"></a>03820             }
<a name="l03821"></a>03821 
<a name="l03822"></a>03822             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#5e2086b4616df4222511a7c45e8ffc42">fTempPathAlreadyDrawn</a> = FALSE;
<a name="l03823"></a>03823             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#f961d76541dbc0eb36d42c770bb1dd2f">fDrawTempHeliPath</a> = FALSE;
<a name="l03824"></a>03824       }
<a name="l03825"></a>03825 
<a name="l03826"></a>03826       iDifference = GetJA2Clock( ) - <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0963b9b8705cba0f9e56c996cf52a44b">giPotHeliPathBaseTime</a> ;
<a name="l03827"></a>03827       
<a name="l03828"></a>03828       <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#5e2086b4616df4222511a7c45e8ffc42">fTempPathAlreadyDrawn</a> )
<a name="l03829"></a>03829       {
<a name="l03830"></a>03830             <span class="keywordflow">return</span>;
<a name="l03831"></a>03831       }
<a name="l03832"></a>03832 
<a name="l03833"></a>03833       <span class="keywordflow">if</span>( iDifference &gt; MIN_WAIT_TIME_FOR_TEMP_PATH )
<a name="l03834"></a>03834       {
<a name="l03835"></a>03835             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#f961d76541dbc0eb36d42c770bb1dd2f">fDrawTempHeliPath</a> = TRUE;
<a name="l03836"></a>03836             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0963b9b8705cba0f9e56c996cf52a44b">giPotHeliPathBaseTime</a> = GetJA2Clock( );   
<a name="l03837"></a>03837             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#5e2086b4616df4222511a7c45e8ffc42">fTempPathAlreadyDrawn</a> = TRUE;
<a name="l03838"></a>03838       }
<a name="l03839"></a>03839 
<a name="l03840"></a>03840       <span class="keywordflow">return</span>;
<a name="l03841"></a>03841 }
<a name="l03842"></a>03842 
<a name="l03843"></a>03843 
<a name="l03844"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#3c7416b480dd2f68e51127e192589889">03844</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#3c7416b480dd2f68e51127e192589889">IsTheCursorAllowedToHighLightThisSector</a>( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorY )
<a name="l03845"></a>03845 {
<a name="l03846"></a>03846       <span class="comment">// check to see if this sector is a blocked out sector?</span>
<a name="l03847"></a>03847 
<a name="l03848"></a>03848       <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#220f372324611c3dfa35c7ff5eca6958">sBadSectorsList</a>[ sSectorX ][ sSectorY ] )
<a name="l03849"></a>03849       {
<a name="l03850"></a>03850             <span class="keywordflow">return</span>  ( FALSE );
<a name="l03851"></a>03851       }
<a name="l03852"></a>03852       <span class="keywordflow">else</span>
<a name="l03853"></a>03853       {
<a name="l03854"></a>03854             <span class="comment">// return cursor is allowed to highlight this sector</span>
<a name="l03855"></a>03855             <span class="keywordflow">return</span> ( TRUE );
<a name="l03856"></a>03856       }
<a name="l03857"></a>03857 }
<a name="l03858"></a>03858 
<a name="l03859"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#dadf38937cb0ab0352f685a66170f083">03859</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#dadf38937cb0ab0352f685a66170f083">SetUpBadSectorsList</a>( <span class="keywordtype">void</span> )
<a name="l03860"></a>03860 {
<a name="l03861"></a>03861       <span class="comment">// initalizes all sectors to highlighable and then the ones non highlightable are marked as such</span>
<a name="l03862"></a>03862       <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bY;
<a name="l03863"></a>03863 
<a name="l03864"></a>03864       memset( &amp;<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#220f372324611c3dfa35c7ff5eca6958">sBadSectorsList</a>, 0, <span class="keyword">sizeof</span>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#220f372324611c3dfa35c7ff5eca6958">sBadSectorsList</a> ) );
<a name="l03865"></a>03865 
<a name="l03866"></a>03866       <span class="comment">// the border regions</span>
<a name="l03867"></a>03867       <span class="keywordflow">for</span>( bY = 0; bY &lt; WORLD_MAP_X; bY++ )
<a name="l03868"></a>03868       {
<a name="l03869"></a>03869         sBadSectorsList[ 0 ][ bY ] = sBadSectorsList[ WORLD_MAP_X - 1 ][ bY ] = sBadSectorsList[ bY ][ 0 ] = sBadSectorsList[ bY ][ WORLD_MAP_X - 1 ] = TRUE;
<a name="l03870"></a>03870       }
<a name="l03871"></a>03871       
<a name="l03872"></a>03872 
<a name="l03873"></a>03873       sBadSectorsList[ 4 ][ 1 ] = TRUE;
<a name="l03874"></a>03874       sBadSectorsList[ 5 ][ 1 ] = TRUE;
<a name="l03875"></a>03875       sBadSectorsList[ 16 ][ 1 ] = TRUE;
<a name="l03876"></a>03876       sBadSectorsList[ 16 ][ 5 ] = TRUE;
<a name="l03877"></a>03877       sBadSectorsList[ 16 ][ 6 ] = TRUE;
<a name="l03878"></a>03878   
<a name="l03879"></a>03879 
<a name="l03880"></a>03880       sBadSectorsList[ 16 ][ 10 ] = TRUE;
<a name="l03881"></a>03881       sBadSectorsList[ 16 ][ 11 ] = TRUE;
<a name="l03882"></a>03882       sBadSectorsList[ 16 ][ 12 ] = TRUE;
<a name="l03883"></a>03883       sBadSectorsList[ 16 ][ 13 ] = TRUE;
<a name="l03884"></a>03884       sBadSectorsList[ 16 ][ 14 ] = TRUE;
<a name="l03885"></a>03885       sBadSectorsList[ 16 ][ 15 ] = TRUE;
<a name="l03886"></a>03886       sBadSectorsList[ 16 ][ 16 ] = TRUE;
<a name="l03887"></a>03887 
<a name="l03888"></a>03888       sBadSectorsList[ 15 ][ 13 ] = TRUE;
<a name="l03889"></a>03889       sBadSectorsList[ 15 ][ 14 ] = TRUE;
<a name="l03890"></a>03890       sBadSectorsList[ 15 ][ 15 ] = TRUE;
<a name="l03891"></a>03891       sBadSectorsList[ 15 ][ 16 ] = TRUE;
<a name="l03892"></a>03892 
<a name="l03893"></a>03893       sBadSectorsList[ 14 ][ 14 ] = TRUE;
<a name="l03894"></a>03894       sBadSectorsList[ 14 ][ 15 ] = TRUE;
<a name="l03895"></a>03895       sBadSectorsList[ 14 ][ 16 ] = TRUE;
<a name="l03896"></a>03896 
<a name="l03897"></a>03897       sBadSectorsList[ 13 ][ 14 ] = TRUE;
<a name="l03898"></a>03898       <span class="keywordflow">return</span>;
<a name="l03899"></a>03899 }
<a name="l03900"></a>03900 
<a name="l03901"></a>03901 
<a name="l03902"></a>03902 
<a name="l03903"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#ab757f9af61b6f2524d31095b66ee671">03903</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ab757f9af61b6f2524d31095b66ee671">RestoreBackgroundForMapGrid</a>( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapY )
<a name="l03904"></a>03904 {
<a name="l03905"></a>03905       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sX, sY;
<a name="l03906"></a>03906 
<a name="l03907"></a>03907       <span class="keywordflow">if</span>(!<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l03908"></a>03908       {
<a name="l03909"></a>03909             <span class="comment">// screen values</span>
<a name="l03910"></a>03910             sX=(sMapX * MAP_GRID_X ) + MAP_VIEW_START_X;
<a name="l03911"></a>03911             sY=(sMapY * MAP_GRID_Y ) + MAP_VIEW_START_Y;    
<a name="l03912"></a>03912             
<a name="l03913"></a>03913             <span class="comment">// restore background</span>
<a name="l03914"></a>03914             <a class="code" href="Render_01Dirty_8cpp.html#ce65fac8b540eee1a5bf4902d2dcb0c5">RestoreExternBackgroundRect</a>( sX, sY ,DMAP_GRID_X ,DMAP_GRID_Y );
<a name="l03915"></a>03915       }
<a name="l03916"></a>03916       <span class="keywordflow">else</span>
<a name="l03917"></a>03917       {
<a name="l03918"></a>03918 
<a name="l03919"></a>03919             <span class="comment">// get screen coords from map values</span>
<a name="l03920"></a>03920     <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#61b609e8ae7546838d7b9b106d25ff3a">GetScreenXYFromMapXYStationary</a>( sMapX, sMapY, &amp;sX, &amp;sY ); 
<a name="l03921"></a>03921             
<a name="l03922"></a>03922             <span class="comment">// is this on the screen?</span>
<a name="l03923"></a>03923             <span class="keywordflow">if</span>( ( sX &gt; <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7a5ec290dc3b07a397fd9ddb6ead8fec">MapScreenRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a> ) &amp;&amp; ( sX &lt; <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7a5ec290dc3b07a397fd9ddb6ead8fec">MapScreenRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a> ) &amp;&amp; ( sY &gt; <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7a5ec290dc3b07a397fd9ddb6ead8fec">MapScreenRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a> ) &amp;&amp; ( sY &lt; <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7a5ec290dc3b07a397fd9ddb6ead8fec">MapScreenRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a> ) )
<a name="l03924"></a>03924             {
<a name="l03925"></a>03925                   <span class="comment">// offset</span>
<a name="l03926"></a>03926                   sY=sY-MAP_GRID_Y;
<a name="l03927"></a>03927               sX=sX-MAP_GRID_X;
<a name="l03928"></a>03928                   
<a name="l03929"></a>03929                   <span class="comment">// restore</span>
<a name="l03930"></a>03930               <a class="code" href="Render_01Dirty_8cpp.html#ce65fac8b540eee1a5bf4902d2dcb0c5">RestoreExternBackgroundRect</a>( sX, sY ,DMAP_GRID_ZOOM_X ,DMAP_GRID_ZOOM_Y );
<a name="l03931"></a>03931             }
<a name="l03932"></a>03932       }
<a name="l03933"></a>03933 
<a name="l03934"></a>03934 }
<a name="l03935"></a>03935 
<a name="l03936"></a>03936 
<a name="l03937"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#1a814c4ade19f909f1082ca012e72ea8">03937</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#1a814c4ade19f909f1082ca012e72ea8">ClipBlitsToMapViewRegion</a>( <span class="keywordtype">void</span> )
<a name="l03938"></a>03938 {
<a name="l03939"></a>03939       <span class="comment">// the standard mapscreen rectangle doesn't work for clipping while zoomed...</span>
<a name="l03940"></a>03940       <a class="code" href="structSGPRect.html">SGPRect</a> ZoomedMapScreenClipRect={   MAP_VIEW_START_X + MAP_GRID_X, MAP_VIEW_START_Y + MAP_GRID_Y - 1, MAP_VIEW_START_X + MAP_VIEW_WIDTH + MAP_GRID_X, MAP_VIEW_START_Y + MAP_VIEW_HEIGHT + MAP_GRID_Y - 10 };
<a name="l03941"></a>03941       <a class="code" href="structSGPRect.html">SGPRect</a> *pRectToUse;
<a name="l03942"></a>03942 
<a name="l03943"></a>03943       <span class="keywordflow">if</span> (<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l03944"></a>03944             pRectToUse = &amp;ZoomedMapScreenClipRect;
<a name="l03945"></a>03945       <span class="keywordflow">else</span>
<a name="l03946"></a>03946             pRectToUse = &amp;<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7a5ec290dc3b07a397fd9ddb6ead8fec">MapScreenRect</a>;
<a name="l03947"></a>03947 
<a name="l03948"></a>03948       <a class="code" href="selectwin_8cpp.html#b681c32def934fca6df29dabc0d47947">SetClippingRect</a>( pRectToUse );
<a name="l03949"></a>03949       memcpy( &amp;<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#8918d6ef1961cb144a003e025edaa088">gOldClipRect</a>, &amp;<a class="code" href="Render_01Dirty_8cpp.html#f38e68d0c1fbb605ebe2e9c6693b64ea">gDirtyClipRect</a>, <span class="keyword">sizeof</span>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#8918d6ef1961cb144a003e025edaa088">gOldClipRect</a> ) );
<a name="l03950"></a>03950       memcpy( &amp;<a class="code" href="Render_01Dirty_8cpp.html#f38e68d0c1fbb605ebe2e9c6693b64ea">gDirtyClipRect</a>, pRectToUse, <span class="keyword">sizeof</span>( <a class="code" href="Render_01Dirty_8cpp.html#f38e68d0c1fbb605ebe2e9c6693b64ea">gDirtyClipRect</a> ) );
<a name="l03951"></a>03951 }
<a name="l03952"></a>03952 
<a name="l03953"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#1b9a9fa9699aebedd0c8b2cbd547a614">03953</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#1b9a9fa9699aebedd0c8b2cbd547a614">RestoreClipRegionToFullScreen</a>( <span class="keywordtype">void</span> )
<a name="l03954"></a>03954 {
<a name="l03955"></a>03955       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#abadb4e34b064bd8cf0cfe60f03839c4">FullScreenRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>    = 0;
<a name="l03956"></a>03956       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#abadb4e34b064bd8cf0cfe60f03839c4">FullScreenRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>           = 0;
<a name="l03957"></a>03957       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#abadb4e34b064bd8cf0cfe60f03839c4">FullScreenRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>   = <a class="code" href="local_8h.html#599adbe412c60e0cc5abb86be7ee4507">SCREEN_WIDTH</a>;
<a name="l03958"></a>03958       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#abadb4e34b064bd8cf0cfe60f03839c4">FullScreenRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>  = <a class="code" href="local_8h.html#f1c710caf1e3a9e81829078054e83799">SCREEN_HEIGHT</a>;
<a name="l03959"></a>03959 
<a name="l03960"></a>03960       <a class="code" href="selectwin_8cpp.html#b681c32def934fca6df29dabc0d47947">SetClippingRect</a>( &amp;<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#abadb4e34b064bd8cf0cfe60f03839c4">FullScreenRect</a> );
<a name="l03961"></a>03961       memcpy( &amp;<a class="code" href="Render_01Dirty_8cpp.html#f38e68d0c1fbb605ebe2e9c6693b64ea">gDirtyClipRect</a>, &amp;<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#8918d6ef1961cb144a003e025edaa088">gOldClipRect</a>, <span class="keyword">sizeof</span>( <a class="code" href="Render_01Dirty_8cpp.html#f38e68d0c1fbb605ebe2e9c6693b64ea">gDirtyClipRect</a> ) );
<a name="l03962"></a>03962 }
<a name="l03963"></a>03963 
<a name="l03964"></a>03964 
<a name="l03965"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#0219bd63e8ae634ee810a9186579675c">03965</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0219bd63e8ae634ee810a9186579675c">ClipBlitsToMapViewRegionForRectangleAndABit</a>( <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES )
<a name="l03966"></a>03966 {
<a name="l03967"></a>03967       <span class="comment">// clip blits to map view region</span>
<a name="l03968"></a>03968       <span class="comment">// because MC's map coordinates system is so screwy, these had to be hand-tuned to work right...  ARM</span>
<a name="l03969"></a>03969       <span class="keywordflow">if</span> (<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l03970"></a>03970             <a class="code" href="line_8cpp.html#03cb6a8fa3b4bbdfcdab02c903bc7b7e">SetClippingRegionAndImageWidth</a>( uiDestPitchBYTES, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7a5ec290dc3b07a397fd9ddb6ead8fec">MapScreenRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a> + 2, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7a5ec290dc3b07a397fd9ddb6ead8fec">MapScreenRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7a5ec290dc3b07a397fd9ddb6ead8fec">MapScreenRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a> - <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7a5ec290dc3b07a397fd9ddb6ead8fec">MapScreenRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7a5ec290dc3b07a397fd9ddb6ead8fec">MapScreenRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a> - <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7a5ec290dc3b07a397fd9ddb6ead8fec">MapScreenRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a> );
<a name="l03971"></a>03971       <span class="keywordflow">else</span>
<a name="l03972"></a>03972             <a class="code" href="line_8cpp.html#03cb6a8fa3b4bbdfcdab02c903bc7b7e">SetClippingRegionAndImageWidth</a>( uiDestPitchBYTES, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7a5ec290dc3b07a397fd9ddb6ead8fec">MapScreenRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a> - 1, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7a5ec290dc3b07a397fd9ddb6ead8fec">MapScreenRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a> - 1, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7a5ec290dc3b07a397fd9ddb6ead8fec">MapScreenRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a> - <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7a5ec290dc3b07a397fd9ddb6ead8fec">MapScreenRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a> + 3, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7a5ec290dc3b07a397fd9ddb6ead8fec">MapScreenRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a> - <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7a5ec290dc3b07a397fd9ddb6ead8fec">MapScreenRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a> + 2 );
<a name="l03973"></a>03973 
<a name="l03974"></a>03974       <span class="keywordflow">return</span>;
<a name="l03975"></a>03975 }
<a name="l03976"></a>03976 
<a name="l03977"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#110ca869cf08f45cb41c294c0814ac6f">03977</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#110ca869cf08f45cb41c294c0814ac6f">RestoreClipRegionToFullScreenForRectangle</a>( <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES )
<a name="l03978"></a>03978 {
<a name="l03979"></a>03979       <span class="comment">// clip blits to map view region</span>
<a name="l03980"></a>03980       <span class="comment">//SetClippingRegionAndImageWidth( uiDestPitchBYTES, 0, 0, 640, 480 );</span>
<a name="l03981"></a>03981 
<a name="l03982"></a>03982       <span class="comment">// WANNE 2</span>
<a name="l03983"></a>03983       <a class="code" href="line_8cpp.html#03cb6a8fa3b4bbdfcdab02c903bc7b7e">SetClippingRegionAndImageWidth</a>( uiDestPitchBYTES, 0, 0, <a class="code" href="local_8h.html#599adbe412c60e0cc5abb86be7ee4507">SCREEN_WIDTH</a>, <a class="code" href="local_8h.html#f1c710caf1e3a9e81829078054e83799">SCREEN_HEIGHT</a> );
<a name="l03984"></a>03984 
<a name="l03985"></a>03985       <span class="keywordflow">return</span>;
<a name="l03986"></a>03986 }
<a name="l03987"></a>03987 
<a name="l03988"></a>03988 
<a name="l03989"></a>03989 <span class="comment">// mvt icon offset defines</span>
<a name="l03990"></a>03990 <span class="preprocessor">#define SOUTH_Y_MVT_OFFSET +10</span>
<a name="l03991"></a>03991 <span class="preprocessor"></span><span class="preprocessor">#define SOUTH_X_MVT_OFFSET 0</span>
<a name="l03992"></a>03992 <span class="preprocessor"></span><span class="preprocessor">#define NORTH_Y_MVT_OFFSET -10</span>
<a name="l03993"></a>03993 <span class="preprocessor"></span><span class="preprocessor">#define NORTH_X_MVT_OFFSET  +10</span>
<a name="l03994"></a>03994 <span class="preprocessor"></span><span class="preprocessor">#define NORTH_SOUTH_CENTER_OFFSET +5</span>
<a name="l03995"></a>03995 <span class="preprocessor"></span>
<a name="l03996"></a>03996 
<a name="l03997"></a>03997 <span class="preprocessor">#define SOUTH_Y_MVT_OFFSET_ZOOM +30</span>
<a name="l03998"></a>03998 <span class="preprocessor"></span><span class="preprocessor">#define SOUTH_X_MVT_OFFSET_ZOOM +5</span>
<a name="l03999"></a>03999 <span class="preprocessor"></span><span class="preprocessor">#define NORTH_Y_MVT_OFFSET_ZOOM -8</span>
<a name="l04000"></a>04000 <span class="preprocessor"></span><span class="preprocessor">#define NORTH_X_MVT_OFFSET_ZOOM +25</span>
<a name="l04001"></a>04001 <span class="preprocessor"></span><span class="preprocessor">#define NORTH_SOUTH_CENTER_OFFSET_ZOOM +15</span>
<a name="l04002"></a>04002 <span class="preprocessor"></span>
<a name="l04003"></a>04003 <span class="preprocessor">#define EAST_Y_MVT_OFFSET + 8</span>
<a name="l04004"></a>04004 <span class="preprocessor"></span><span class="preprocessor">#define EAST_X_MVT_OFFSET 15</span>
<a name="l04005"></a>04005 <span class="preprocessor"></span><span class="preprocessor">#define WEST_Y_MVT_OFFSET -2</span>
<a name="l04006"></a>04006 <span class="preprocessor"></span><span class="preprocessor">#define WEST_X_MVT_OFFSET -8</span>
<a name="l04007"></a>04007 <span class="preprocessor"></span><span class="preprocessor">#define EAST_WEST_CENTER_OFFSET +2</span>
<a name="l04008"></a>04008 <span class="preprocessor"></span>
<a name="l04009"></a>04009 <span class="preprocessor">#define EAST_Y_MVT_OFFSET_ZOOM +24</span>
<a name="l04010"></a>04010 <span class="preprocessor"></span><span class="preprocessor">#define EAST_X_MVT_OFFSET_ZOOM +36</span>
<a name="l04011"></a>04011 <span class="preprocessor"></span><span class="preprocessor">#define WEST_Y_MVT_OFFSET_ZOOM  +5</span>
<a name="l04012"></a>04012 <span class="preprocessor"></span><span class="preprocessor">#define WEST_X_MVT_OFFSET_ZOOM -10</span>
<a name="l04013"></a>04013 <span class="preprocessor"></span><span class="preprocessor">#define EAST_WEST_CENTER_OFFSET_ZOOM +12</span>
<a name="l04014"></a>04014 <span class="preprocessor"></span>
<a name="l04015"></a>04015 <span class="preprocessor">#define NORTH_TEXT_X_OFFSET +1</span>
<a name="l04016"></a>04016 <span class="preprocessor"></span><span class="preprocessor">#define NORTH_TEXT_Y_OFFSET +4</span>
<a name="l04017"></a>04017 <span class="preprocessor"></span><span class="preprocessor">#define SOUTH_TEXT_X_OFFSET +1</span>
<a name="l04018"></a>04018 <span class="preprocessor"></span><span class="preprocessor">#define SOUTH_TEXT_Y_OFFSET +2</span>
<a name="l04019"></a>04019 <span class="preprocessor"></span>
<a name="l04020"></a>04020 <span class="preprocessor">#define EAST_TEXT_X_OFFSET + 2</span>
<a name="l04021"></a>04021 <span class="preprocessor"></span><span class="preprocessor">#define EAST_TEXT_Y_OFFSET 0</span>
<a name="l04022"></a>04022 <span class="preprocessor"></span><span class="preprocessor">#define WEST_TEXT_X_OFFSET + 4</span>
<a name="l04023"></a>04023 <span class="preprocessor"></span><span class="preprocessor">#define WEST_TEXT_Y_OFFSET 0</span>
<a name="l04024"></a>04024 <span class="preprocessor"></span>
<a name="l04025"></a>04025 
<a name="l04026"></a>04026 <span class="preprocessor">#define ICON_WIDTH 8</span>
<a name="l04027"></a>04027 <span class="preprocessor"></span>
<a name="l04028"></a>04028 
<a name="l04029"></a>04029 
<a name="l04030"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#acc0589f1da25c6b304f634bd0373dc7">04030</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#acc0589f1da25c6b304f634bd0373dc7">ShowPeopleInMotion</a>( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sY )
<a name="l04031"></a>04031 {
<a name="l04032"></a>04032       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> sExiting = 0;
<a name="l04033"></a>04033       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> sEntering = 0;
<a name="l04034"></a>04034       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sDest = 0;
<a name="l04035"></a>04035       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSource = 0;
<a name="l04036"></a>04036       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sOffsetX = 0, sOffsetY = 0;
<a name="l04037"></a>04037       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> iX = sX, iY = sY;
<a name="l04038"></a>04038       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sXPosition = 0, sYPosition = 0;
<a name="l04039"></a>04039       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iCounter = 0;
<a name="l04040"></a>04040       <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hIconHandle;
<a name="l04041"></a>04041       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fAboutToEnter = FALSE;
<a name="l04042"></a>04042       <a class="code" href="Types_8h.html#fcdf88c1d4179fcd6d8a1fa9bbcb8a80">CHAR16</a> sString[ 32 ];
<a name="l04043"></a>04043       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sTextXOffset = 0;
<a name="l04044"></a>04044       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sTextYOffset = 0;
<a name="l04045"></a>04045       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> usX, usY;
<a name="l04046"></a>04046       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iWidth = 0, iHeight = 0;
<a name="l04047"></a>04047       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iDeltaXForError = 0, iDeltaYForError = 0;
<a name="l04048"></a>04048 
<a name="l04049"></a>04049 
<a name="l04050"></a>04050       <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b52d71b8f7dc10a22568eb52e0c51a3e">iCurrentMapSectorZ</a> != 0 )
<a name="l04051"></a>04051       {
<a name="l04052"></a>04052             <span class="keywordflow">return</span>;
<a name="l04053"></a>04053       }
<a name="l04054"></a>04054 
<a name="l04055"></a>04055 
<a name="l04056"></a>04056       <span class="comment">// show the icons for people in motion from this sector to the next guy over</span>
<a name="l04057"></a>04057       <span class="keywordflow">for</span>( iCounter = 0; iCounter &lt; 4; iCounter++ )
<a name="l04058"></a>04058       {
<a name="l04059"></a>04059             <span class="comment">// find how many people are coming and going in this sector</span>
<a name="l04060"></a>04060             sExiting = 0;
<a name="l04061"></a>04061             sEntering = 0;
<a name="l04062"></a>04062             sSource = CALCULATE_STRATEGIC_INDEX( sX, sY );
<a name="l04063"></a>04063             sOffsetX = 0;
<a name="l04064"></a>04064             sOffsetY = 0;
<a name="l04065"></a>04065             iX = sX;
<a name="l04066"></a>04066             iY = sY;
<a name="l04067"></a>04067 
<a name="l04068"></a>04068             <span class="comment">// reset fact about to enter</span>
<a name="l04069"></a>04069             fAboutToEnter = FALSE;
<a name="l04070"></a>04070 
<a name="l04071"></a>04071             sDest = sSource;
<a name="l04072"></a>04072 
<a name="l04073"></a>04073             <span class="keywordflow">if</span>( ( iCounter == 0 ) &amp;&amp; sY &gt; 1 )
<a name="l04074"></a>04074             {
<a name="l04075"></a>04075                   sDest += NORTH_MOVE;
<a name="l04076"></a>04076             }
<a name="l04077"></a>04077             <span class="keywordflow">else</span> <span class="keywordflow">if</span>( ( iCounter == 1 ) &amp;&amp; ( sX &lt; MAP_WORLD_X - 1 ) )
<a name="l04078"></a>04078             {
<a name="l04079"></a>04079                   sDest += EAST_MOVE;
<a name="l04080"></a>04080             }
<a name="l04081"></a>04081             <span class="keywordflow">else</span> <span class="keywordflow">if</span>( ( iCounter == 2 ) &amp;&amp; ( sY &lt; MAP_WORLD_Y - 1 ) )
<a name="l04082"></a>04082             {
<a name="l04083"></a>04083                   sDest += SOUTH_MOVE;
<a name="l04084"></a>04084             }
<a name="l04085"></a>04085             <span class="keywordflow">else</span> <span class="keywordflow">if</span>( ( iCounter == 3 ) &amp;&amp; ( sX &gt; 1 ) )
<a name="l04086"></a>04086             {
<a name="l04087"></a>04087                   sDest += WEST_MOVE;
<a name="l04088"></a>04088             }
<a name="l04089"></a>04089 
<a name="l04090"></a>04090             <span class="comment">// if not at edge of map</span>
<a name="l04091"></a>04091             <span class="keywordflow">if</span> ( sDest != sSource )
<a name="l04092"></a>04092             {
<a name="l04093"></a>04093                   <span class="keywordflow">if</span>( <a class="code" href="Strategic_01Movement_8cpp.html#e05a975eeaac0a7e25ea9a25dbc0d91a">PlayersBetweenTheseSectors</a>( ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> ) SECTOR( sSource % MAP_WORLD_X, sSource / MAP_WORLD_X ) , ( INT16 ) SECTOR( sDest % MAP_WORLD_X, sDest / MAP_WORLD_X ), &amp;sExiting, &amp;sEntering, &amp;fAboutToEnter ) )
<a name="l04094"></a>04094                   {
<a name="l04095"></a>04095                         <span class="comment">// someone is leaving</span>
<a name="l04096"></a>04096 
<a name="l04097"></a>04097                         <span class="comment">// now find position</span>
<a name="l04098"></a>04098                         <span class="keywordflow">if</span>( !( iCounter % 2 ) )
<a name="l04099"></a>04099                         {
<a name="l04100"></a>04100                               <span class="comment">// guys going north or south</span>
<a name="l04101"></a>04101                               <span class="keywordflow">if</span>( sEntering &gt; 0 )
<a name="l04102"></a>04102                               {
<a name="l04103"></a>04103                                     <span class="comment">// more than one coming in, offset from middle</span>
<a name="l04104"></a>04104                                     sOffsetX = ( !iCounter ? ( !<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a> ? NORTH_X_MVT_OFFSET: NORTH_X_MVT_OFFSET_ZOOM ) : ( !<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a> ? SOUTH_X_MVT_OFFSET: SOUTH_X_MVT_OFFSET_ZOOM )  );
<a name="l04105"></a>04105                               }
<a name="l04106"></a>04106                               <span class="keywordflow">else</span>
<a name="l04107"></a>04107                               {
<a name="l04108"></a>04108                                     sOffsetX = ( !<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a> ?  NORTH_SOUTH_CENTER_OFFSET : NORTH_SOUTH_CENTER_OFFSET_ZOOM );
<a name="l04109"></a>04109                               }
<a name="l04110"></a>04110                   
<a name="l04111"></a>04111                               <span class="keywordflow">if</span>( !iCounter )
<a name="l04112"></a>04112                               {
<a name="l04113"></a>04113                                     <span class="comment">// going north</span>
<a name="l04114"></a>04114                                     sOffsetY = ( !<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a> ? NORTH_Y_MVT_OFFSET : NORTH_Y_MVT_OFFSET_ZOOM );
<a name="l04115"></a>04115                               }
<a name="l04116"></a>04116                               <span class="keywordflow">else</span>
<a name="l04117"></a>04117                               {
<a name="l04118"></a>04118                                     <span class="comment">// going south</span>
<a name="l04119"></a>04119                                     sOffsetY = ( !<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a> ? SOUTH_Y_MVT_OFFSET : SOUTH_Y_MVT_OFFSET_ZOOM );
<a name="l04120"></a>04120                               }
<a name="l04121"></a>04121                         }
<a name="l04122"></a>04122                         <span class="keywordflow">else</span>
<a name="l04123"></a>04123                         {
<a name="l04124"></a>04124                               <span class="comment">// going east/west</span>
<a name="l04125"></a>04125                   
<a name="l04126"></a>04126                               <span class="keywordflow">if</span>( sEntering &gt; 0 )
<a name="l04127"></a>04127                               {
<a name="l04128"></a>04128                                     <span class="comment">// people also entering, offset from middle </span>
<a name="l04129"></a>04129                                     sOffsetY = ( iCounter == 1? ( !<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a> ? EAST_Y_MVT_OFFSET: EAST_Y_MVT_OFFSET_ZOOM ) : ( !<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a> ? WEST_Y_MVT_OFFSET: WEST_Y_MVT_OFFSET_ZOOM )  );
<a name="l04130"></a>04130                               }
<a name="l04131"></a>04131                               <span class="keywordflow">else</span>
<a name="l04132"></a>04132                               {
<a name="l04133"></a>04133                                     sOffsetY = ( !<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a> ?  EAST_WEST_CENTER_OFFSET : EAST_WEST_CENTER_OFFSET_ZOOM );
<a name="l04134"></a>04134                               }
<a name="l04135"></a>04135 
<a name="l04136"></a>04136                               <span class="keywordflow">if</span>( iCounter == 1 )
<a name="l04137"></a>04137                               {
<a name="l04138"></a>04138                                     <span class="comment">// going east</span>
<a name="l04139"></a>04139                                     sOffsetX = ( !<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a> ? EAST_X_MVT_OFFSET : EAST_X_MVT_OFFSET_ZOOM );
<a name="l04140"></a>04140                               }
<a name="l04141"></a>04141                               <span class="keywordflow">else</span>
<a name="l04142"></a>04142                               {
<a name="l04143"></a>04143                                     <span class="comment">// going west</span>
<a name="l04144"></a>04144                                     sOffsetX = ( !<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a> ? WEST_X_MVT_OFFSET : WEST_X_MVT_OFFSET_ZOOM );
<a name="l04145"></a>04145                               }
<a name="l04146"></a>04146                         }
<a name="l04147"></a>04147 
<a name="l04148"></a>04148                         <span class="keywordflow">switch</span>( iCounter )
<a name="l04149"></a>04149                         {
<a name="l04150"></a>04150                               <span class="keywordflow">case</span> 0:
<a name="l04151"></a>04151                                     sTextXOffset = NORTH_TEXT_X_OFFSET;
<a name="l04152"></a>04152                                     sTextYOffset = NORTH_TEXT_Y_OFFSET;
<a name="l04153"></a>04153                                     <span class="keywordflow">break</span>;
<a name="l04154"></a>04154                               <span class="keywordflow">case</span> 1:
<a name="l04155"></a>04155                                     sTextXOffset = EAST_TEXT_X_OFFSET;
<a name="l04156"></a>04156                                     sTextYOffset = EAST_TEXT_Y_OFFSET;
<a name="l04157"></a>04157                                     <span class="keywordflow">break</span>;
<a name="l04158"></a>04158                               <span class="keywordflow">case</span> 2:
<a name="l04159"></a>04159                                     sTextXOffset = SOUTH_TEXT_X_OFFSET;
<a name="l04160"></a>04160                                     sTextYOffset = SOUTH_TEXT_Y_OFFSET;
<a name="l04161"></a>04161                                     <span class="keywordflow">break</span>;
<a name="l04162"></a>04162                               <span class="keywordflow">case</span> 3:
<a name="l04163"></a>04163                                     sTextXOffset = WEST_TEXT_X_OFFSET;
<a name="l04164"></a>04164                                     sTextYOffset = WEST_TEXT_Y_OFFSET;
<a name="l04165"></a>04165                                     <span class="keywordflow">break</span>;
<a name="l04166"></a>04166                         }
<a name="l04167"></a>04167 
<a name="l04168"></a>04168 
<a name="l04169"></a>04169                         <span class="comment">// blit the text</span>
<a name="l04170"></a>04170 
<a name="l04171"></a>04171                         <a class="code" href="Font_8cpp.html#fa4871009f0473cca0380217753947dc">SetFont</a>( MAP_MVT_ICON_FONT );
<a name="l04172"></a>04172 
<a name="l04173"></a>04173                         <span class="keywordflow">if</span>( !fAboutToEnter )
<a name="l04174"></a>04174                         {
<a name="l04175"></a>04175                               <a class="code" href="Font_8cpp.html#388be5810478c3f3bdb861f144085d70">SetFontForeground</a>( FONT_WHITE );
<a name="l04176"></a>04176                         }
<a name="l04177"></a>04177                         <span class="keywordflow">else</span>
<a name="l04178"></a>04178                         {
<a name="l04179"></a>04179                               <a class="code" href="Font_8cpp.html#388be5810478c3f3bdb861f144085d70">SetFontForeground</a>( FONT_BLACK );
<a name="l04180"></a>04180                         }
<a name="l04181"></a>04181 
<a name="l04182"></a>04182                         <a class="code" href="Font_8cpp.html#a1fe8cc526be9e2c96b5dd66e348506f">SetFontBackground</a>( FONT_BLACK );
<a name="l04183"></a>04183 
<a name="l04184"></a>04184                         swprintf( sString, L<span class="stringliteral">"%d"</span>, sExiting );
<a name="l04185"></a>04185 
<a name="l04186"></a>04186                         <span class="comment">// about to enter</span>
<a name="l04187"></a>04187                         <span class="keywordflow">if</span>( !fAboutToEnter )
<a name="l04188"></a>04188                         {
<a name="l04189"></a>04189                               <span class="comment">// draw blue arrows</span>
<a name="l04190"></a>04190                               <a class="code" href="vobject_8cpp.html#bda2b0eae4cb40e612dffd307ad5c692">GetVideoObject</a>(&amp;hIconHandle, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#9ac8b2013c7c0bfa2e89cb558b4f3771">guiCHARBETWEENSECTORICONS</a> );
<a name="l04191"></a>04191                         }
<a name="l04192"></a>04192                         <span class="keywordflow">else</span>
<a name="l04193"></a>04193                         {
<a name="l04194"></a>04194                               <span class="comment">// draw yellow arrows</span>
<a name="l04195"></a>04195                               <a class="code" href="vobject_8cpp.html#bda2b0eae4cb40e612dffd307ad5c692">GetVideoObject</a>(&amp;hIconHandle, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ecaa61ada89c8e8b47514187fbfa2d1b">guiCHARBETWEENSECTORICONSCLOSE</a> );
<a name="l04196"></a>04196                         }
<a name="l04197"></a>04197 
<a name="l04198"></a>04198                         <span class="comment">// zoomed in or not?</span>
<a name="l04199"></a>04199                         <span class="keywordflow">if</span>(!<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a>)
<a name="l04200"></a>04200                         {
<a name="l04201"></a>04201                               iX = MAP_VIEW_START_X+( iX * MAP_GRID_X ) + sOffsetX;       
<a name="l04202"></a>04202                               iY = MAP_Y_ICON_OFFSET + MAP_VIEW_START_Y + ( iY * MAP_GRID_Y ) + sOffsetY;
<a name="l04203"></a>04203                               
<a name="l04204"></a>04204                               <a class="code" href="vobject_8cpp.html#8a5b07441769401593743b9f52a9e353">BltVideoObject</a>(<a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a>, hIconHandle, ( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> )iCounter , ( INT16 ) iX, ( INT16 ) iY , VO_BLT_SRCTRANSPARENCY, NULL );
<a name="l04205"></a>04205                         }
<a name="l04206"></a>04206                         <span class="keywordflow">else</span>
<a name="l04207"></a>04207                         {
<a name="l04208"></a>04208                               <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#61b609e8ae7546838d7b9b106d25ff3a">GetScreenXYFromMapXYStationary</a>( ((<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>)(iX)),((<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>)(iY)) , &amp;sXPosition, &amp;sYPosition );
<a name="l04209"></a>04209                               
<a name="l04210"></a>04210                               iY=sYPosition-MAP_GRID_Y + sOffsetY;
<a name="l04211"></a>04211                               iX=sXPosition-MAP_GRID_X + sOffsetX;
<a name="l04212"></a>04212                               
<a name="l04213"></a>04213                               <span class="comment">// clip blits to mapscreen region</span>
<a name="l04214"></a>04214                               <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#1a814c4ade19f909f1082ca012e72ea8">ClipBlitsToMapViewRegion</a>( );
<a name="l04215"></a>04215 
<a name="l04216"></a>04216                               <a class="code" href="vobject_8cpp.html#8a5b07441769401593743b9f52a9e353">BltVideoObject</a>(<a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a>, hIconHandle,( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> )iCounter , iX   , iY  , VO_BLT_SRCTRANSPARENCY, NULL );
<a name="l04217"></a>04217 
<a name="l04218"></a>04218                               <span class="comment">// restore clip blits</span>
<a name="l04219"></a>04219                               <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#1b9a9fa9699aebedd0c8b2cbd547a614">RestoreClipRegionToFullScreen</a>( );
<a name="l04220"></a>04220                         }
<a name="l04221"></a>04221 
<a name="l04222"></a>04222                         <a class="code" href="Font_8cpp.html#d08dcd11daa6a1189cb123dff18cd7c8">FindFontCenterCoordinates</a>(( INT16 )( iX + sTextXOffset ), 0, ICON_WIDTH, 0, sString, MAP_FONT, &amp;usX, &amp;usY);
<a name="l04223"></a>04223                         <a class="code" href="Font_8cpp.html#a038a1dc2edfc9f9c0766a0cbde2f440">SetFontDestBuffer</a>( <a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a>, 0, 0, <a class="code" href="local_8h.html#599adbe412c60e0cc5abb86be7ee4507">SCREEN_WIDTH</a>, <a class="code" href="local_8h.html#f1c710caf1e3a9e81829078054e83799">SCREEN_HEIGHT</a>, FALSE );
<a name="l04224"></a>04224                         <a class="code" href="Font_8cpp.html#b3e12cf19a0ca58abf6689cc8eca3ead">mprintf</a>( usX, iY + sTextYOffset, sString);
<a name="l04225"></a>04225 
<a name="l04226"></a>04226                         <span class="keywordflow">switch</span>( iCounter % 2 )
<a name="l04227"></a>04227                         {
<a name="l04228"></a>04228                               <span class="keywordflow">case</span> 0 :
<a name="l04229"></a>04229                                     <span class="comment">// north south</span>
<a name="l04230"></a>04230                                     iWidth = 10;
<a name="l04231"></a>04231                                     iHeight = 12;
<a name="l04232"></a>04232                               <span class="keywordflow">break</span>;
<a name="l04233"></a>04233                               <span class="keywordflow">case</span> 1 :
<a name="l04234"></a>04234                                     <span class="comment">// east west</span>
<a name="l04235"></a>04235                                     iWidth = 12;
<a name="l04236"></a>04236                                     iHeight = 7;
<a name="l04237"></a>04237                               <span class="keywordflow">break</span>;
<a name="l04238"></a>04238                         
<a name="l04239"></a>04239                         }
<a name="l04240"></a>04240 
<a name="l04241"></a>04241                         <span class="comment">// error correction for scrolling with people on the move</span>
<a name="l04242"></a>04242                         <span class="keywordflow">if</span>( iX &lt; 0 )
<a name="l04243"></a>04243                         {
<a name="l04244"></a>04244                               iDeltaXForError = 0 - iX;
<a name="l04245"></a>04245                               iWidth -= iDeltaXForError;
<a name="l04246"></a>04246                               iX = 0;
<a name="l04247"></a>04247                         }
<a name="l04248"></a>04248 
<a name="l04249"></a>04249                         <span class="keywordflow">if</span>( iY &lt; 0 )
<a name="l04250"></a>04250                         {
<a name="l04251"></a>04251                               iDeltaYForError = 0 - iY;
<a name="l04252"></a>04252                               iHeight -= iDeltaYForError;
<a name="l04253"></a>04253                               iY = 0;
<a name="l04254"></a>04254                         }
<a name="l04255"></a>04255 
<a name="l04256"></a>04256                         <span class="keywordflow">if</span>( ( iWidth &gt; 0 )&amp;&amp;( iHeight &gt; 0 ) )
<a name="l04257"></a>04257                         {
<a name="l04258"></a>04258                               <a class="code" href="Render_01Dirty_8cpp.html#ce65fac8b540eee1a5bf4902d2dcb0c5">RestoreExternBackgroundRect</a>( iX, iY, ( INT16 )iWidth, ( INT16 )iHeight );
<a name="l04259"></a>04259                         }
<a name="l04260"></a>04260                   }
<a name="l04261"></a>04261             }
<a name="l04262"></a>04262       }
<a name="l04263"></a>04263 
<a name="l04264"></a>04264       <span class="comment">// restore buffer</span>
<a name="l04265"></a>04265       <a class="code" href="Font_8cpp.html#a038a1dc2edfc9f9c0766a0cbde2f440">SetFontDestBuffer</a>( FRAME_BUFFER, 0, 0, <a class="code" href="local_8h.html#599adbe412c60e0cc5abb86be7ee4507">SCREEN_WIDTH</a>, <a class="code" href="local_8h.html#f1c710caf1e3a9e81829078054e83799">SCREEN_HEIGHT</a>, FALSE );
<a name="l04266"></a>04266 
<a name="l04267"></a>04267 }
<a name="l04268"></a>04268 
<a name="l04269"></a>04269 
<a name="l04270"></a>04270 
<a name="l04271"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#26e0235bc7e60d5c62f96bb8c4289923">04271</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#26e0235bc7e60d5c62f96bb8c4289923">DisplayDistancesForHelicopter</a>( <span class="keywordtype">void</span> )
<a name="l04272"></a>04272 {
<a name="l04273"></a>04273       <span class="comment">// calculate the distance travelled, the proposed distance, and total distance one can go</span>
<a name="l04274"></a>04274       <span class="comment">// display these on screen</span>
<a name="l04275"></a>04275       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sDistanceToGo = 0;<span class="comment">//, sDistanceSoFar = 0, sTotalCanTravel = 0;</span>
<a name="l04276"></a>04276       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sX = 0, sY = 0;
<a name="l04277"></a>04277       <a class="code" href="Types_8h.html#fcdf88c1d4179fcd6d8a1fa9bbcb8a80">CHAR16</a> sString[ 32 ];
<a name="l04278"></a>04278       <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hHandle;
<a name="l04279"></a>04279       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sTotalOfTrip = 0;
<a name="l04280"></a>04280       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iTime = 0;
<a name="l04281"></a>04281       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapX, sMapY;
<a name="l04282"></a>04282       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sYPosition = 0;
<a name="l04283"></a>04283       <span class="keyword">static</span> <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sOldYPosition = 0;
<a name="l04284"></a>04284   <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sNumSafeSectors;
<a name="l04285"></a>04285   <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sNumUnSafeSectors;
<a name="l04286"></a>04286       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiTripCost;
<a name="l04287"></a>04287 
<a name="l04288"></a>04288 
<a name="l04289"></a>04289       <span class="keywordflow">if</span> ( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#971769935bf4d1457725681025c131be">GetMouseMapXY</a>( &amp;sMapX, &amp;sMapY ) &amp;&amp; !<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a> &amp;&amp; ( sMapY &gt;= 13 ) )
<a name="l04290"></a>04290       {
<a name="l04291"></a>04291             sYPosition = MAP_HELICOPTER_UPPER_ETA_POPUP_Y;
<a name="l04292"></a>04292       }
<a name="l04293"></a>04293       <span class="keywordflow">else</span>
<a name="l04294"></a>04294       {
<a name="l04295"></a>04295             sYPosition = MAP_HELICOPTER_ETA_POPUP_Y;
<a name="l04296"></a>04296       }
<a name="l04297"></a>04297 
<a name="l04298"></a>04298       <span class="keywordflow">if</span>( ( sOldYPosition != 0 ) &amp;&amp; ( sOldYPosition != sYPosition ) )
<a name="l04299"></a>04299       {
<a name="l04300"></a>04300             <a class="code" href="Render_01Dirty_8cpp.html#ce65fac8b540eee1a5bf4902d2dcb0c5">RestoreExternBackgroundRect</a>( MAP_HELICOPTER_ETA_POPUP_X, sOldYPosition, MAP_HELICOPTER_ETA_POPUP_WIDTH + 20, MAP_HELICOPTER_ETA_POPUP_HEIGHT );
<a name="l04301"></a>04301       }
<a name="l04302"></a>04302 
<a name="l04303"></a>04303       sOldYPosition = sYPosition;
<a name="l04304"></a>04304 
<a name="l04305"></a>04305       <span class="comment">// blit in background</span>
<a name="l04306"></a>04306       <a class="code" href="vobject_8cpp.html#bda2b0eae4cb40e612dffd307ad5c692">GetVideoObject</a>( &amp;hHandle, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#6aa1436583b2da40e1480ff08ddd1df1">guiMapBorderHeliSectors</a> );
<a name="l04307"></a>04307       <a class="code" href="vobject_8cpp.html#8a5b07441769401593743b9f52a9e353">BltVideoObject</a>( FRAME_BUFFER, hHandle, 0, MAP_HELICOPTER_ETA_POPUP_X, sYPosition, VO_BLT_SRCTRANSPARENCY, NULL ); 
<a name="l04308"></a>04308 
<a name="l04309"></a>04309 
<a name="l04310"></a>04310 <span class="comment">//    sTotalCanTravel = ( INT16 )GetTotalDistanceHelicopterCanTravel( );</span>
<a name="l04311"></a>04311       sDistanceToGo = ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> )<a class="code" href="Map_01Screen_01Helicopter_8cpp.html#4cb618ef9f013e4137706b9b7f000399">DistanceOfIntendedHelicopterPath</a>( );
<a name="l04312"></a>04312       sTotalOfTrip = sDistanceToGo;       <span class="comment">// + ( INT16 ) ( DistanceToNearestRefuelPoint( ( INT16 )( LastSectorInHelicoptersPath() % MAP_WORLD_X ), ( INT16 ) ( LastSectorInHelicoptersPath() / MAP_WORLD_X ) ) );</span>
<a name="l04313"></a>04313 
<a name="l04314"></a>04314   sNumSafeSectors = <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#ad12f971252026ee6c8c6c9850ecf4f1">GetNumSafeSectorsInPath</a>( );
<a name="l04315"></a>04315   sNumUnSafeSectors = <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#6991398a2c2b0340aab91febfed84312">GetNumUnSafeSectorsInPath</a>( );
<a name="l04316"></a>04316 
<a name="l04317"></a>04317 <span class="comment">//    sDistanceSoFar = ( INT16 )HowFarHelicopterhasTravelledSinceRefueling( );</span>
<a name="l04318"></a>04318 <span class="comment">//     sTotalDistanceOfTrip = ( INT16 )DistanceToNearestRefuelPoint( )</span>
<a name="l04319"></a>04319       
<a name="l04320"></a>04320       <span class="keywordflow">if</span>( sDistanceToGo == 9999)
<a name="l04321"></a>04321       {
<a name="l04322"></a>04322             sDistanceToGo = 0;
<a name="l04323"></a>04323       }
<a name="l04324"></a>04324 
<a name="l04325"></a>04325       <span class="comment">// set the font stuff</span>
<a name="l04326"></a>04326       <a class="code" href="Font_8cpp.html#fa4871009f0473cca0380217753947dc">SetFont</a>( MAP_FONT );
<a name="l04327"></a>04327       <a class="code" href="Font_8cpp.html#388be5810478c3f3bdb861f144085d70">SetFontForeground</a>( FONT_LTGREEN );
<a name="l04328"></a>04328       <a class="code" href="Font_8cpp.html#a1fe8cc526be9e2c96b5dd66e348506f">SetFontBackground</a>( FONT_BLACK );
<a name="l04329"></a>04329 
<a name="l04330"></a>04330       swprintf( sString, L<span class="stringliteral">"%s"</span>, <a class="code" href="__DutchText_8cpp.html#36a4a2c7056012b5d162c0f6f091ecaa">pHelicopterEtaStrings</a>[ 0 ] );
<a name="l04331"></a>04331       <a class="code" href="Font_8cpp.html#b3e12cf19a0ca58abf6689cc8eca3ead">mprintf</a>( MAP_HELICOPTER_ETA_POPUP_X + 5, sYPosition + 5, sString );
<a name="l04332"></a>04332 
<a name="l04333"></a>04333 <span class="comment">/*    </span>
<a name="l04334"></a>04334 <span class="comment">  if ( IsSectorOutOfTheWay( sMapX, sMapY ) )</span>
<a name="l04335"></a>04335 <span class="comment">  {</span>
<a name="l04336"></a>04336 <span class="comment">            SetFontForeground( FONT_RED );</span>
<a name="l04337"></a>04337 <span class="comment">      }</span>
<a name="l04338"></a>04338 <span class="comment">      else</span>
<a name="l04339"></a>04339 <span class="comment">*/</span>
<a name="l04340"></a>04340       {
<a name="l04341"></a>04341             <a class="code" href="Font_8cpp.html#388be5810478c3f3bdb861f144085d70">SetFontForeground</a>( FONT_LTGREEN );
<a name="l04342"></a>04342       }
<a name="l04343"></a>04343       
<a name="l04344"></a>04344       swprintf( sString, L<span class="stringliteral">"%d"</span>, sTotalOfTrip );
<a name="l04345"></a>04345       <a class="code" href="Font_8cpp.html#e07e1d7f30bacf6b7ad052536c569b05">FindFontRightCoordinates</a>( MAP_HELICOPTER_ETA_POPUP_X + 5, MAP_HELICOPTER_ETA_POPUP_Y + 5, MAP_HELICOPTER_ETA_POPUP_WIDTH, 0,  sString, MAP_FONT,  &amp;sX, &amp;sY );
<a name="l04346"></a>04346       <a class="code" href="Font_8cpp.html#b3e12cf19a0ca58abf6689cc8eca3ead">mprintf</a>( sX, sYPosition + 5, sString );
<a name="l04347"></a>04347 
<a name="l04348"></a>04348       <a class="code" href="Font_8cpp.html#388be5810478c3f3bdb861f144085d70">SetFontForeground</a>( FONT_LTGREEN );
<a name="l04349"></a>04349 
<a name="l04350"></a>04350       swprintf( sString, L<span class="stringliteral">"%s"</span>, <a class="code" href="__DutchText_8cpp.html#36a4a2c7056012b5d162c0f6f091ecaa">pHelicopterEtaStrings</a>[ 1 ] );
<a name="l04351"></a>04351       <a class="code" href="Font_8cpp.html#b3e12cf19a0ca58abf6689cc8eca3ead">mprintf</a>( MAP_HELICOPTER_ETA_POPUP_X + 5, sYPosition + 5 + <a class="code" href="Font_8cpp.html#35cddf34696d33489efb820caf968907">GetFontHeight</a>( MAP_FONT ), sString );
<a name="l04352"></a>04352 
<a name="l04353"></a>04353       swprintf( sString, L<span class="stringliteral">"%d"</span>, sNumSafeSectors );
<a name="l04354"></a>04354       <a class="code" href="Font_8cpp.html#e07e1d7f30bacf6b7ad052536c569b05">FindFontRightCoordinates</a>( MAP_HELICOPTER_ETA_POPUP_X + 5, ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> ) ( MAP_HELICOPTER_ETA_POPUP_Y + 5 + 2 * <a class="code" href="Font_8cpp.html#35cddf34696d33489efb820caf968907">GetFontHeight</a>( MAP_FONT ) ), MAP_HELICOPTER_ETA_POPUP_WIDTH, 0,  sString, MAP_FONT,  &amp;sX, &amp;sY );
<a name="l04355"></a>04355       <a class="code" href="Font_8cpp.html#b3e12cf19a0ca58abf6689cc8eca3ead">mprintf</a>( sX, ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> ) ( sYPosition + 5 + <a class="code" href="Font_8cpp.html#35cddf34696d33489efb820caf968907">GetFontHeight</a>( MAP_FONT ) ), sString );
<a name="l04356"></a>04356 
<a name="l04357"></a>04357       swprintf( sString, L<span class="stringliteral">"%s"</span>, <a class="code" href="__DutchText_8cpp.html#36a4a2c7056012b5d162c0f6f091ecaa">pHelicopterEtaStrings</a>[ 2 ] );
<a name="l04358"></a>04358       <a class="code" href="Font_8cpp.html#b3e12cf19a0ca58abf6689cc8eca3ead">mprintf</a>( MAP_HELICOPTER_ETA_POPUP_X + 5, sYPosition + 5 + 2 * <a class="code" href="Font_8cpp.html#35cddf34696d33489efb820caf968907">GetFontHeight</a>( MAP_FONT ), sString );
<a name="l04359"></a>04359 
<a name="l04360"></a>04360       swprintf( sString, L<span class="stringliteral">"%d"</span>, sNumUnSafeSectors );
<a name="l04361"></a>04361       <a class="code" href="Font_8cpp.html#e07e1d7f30bacf6b7ad052536c569b05">FindFontRightCoordinates</a>( MAP_HELICOPTER_ETA_POPUP_X + 5, ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> ) ( MAP_HELICOPTER_ETA_POPUP_Y + 5 + 2 * <a class="code" href="Font_8cpp.html#35cddf34696d33489efb820caf968907">GetFontHeight</a>( MAP_FONT ) ), MAP_HELICOPTER_ETA_POPUP_WIDTH, 0,  sString, MAP_FONT,  &amp;sX, &amp;sY );
<a name="l04362"></a>04362       <a class="code" href="Font_8cpp.html#b3e12cf19a0ca58abf6689cc8eca3ead">mprintf</a>( sX, ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> ) ( sYPosition + 5 + 2 * <a class="code" href="Font_8cpp.html#35cddf34696d33489efb820caf968907">GetFontHeight</a>( MAP_FONT ) ), sString );
<a name="l04363"></a>04363 
<a name="l04364"></a>04364       swprintf( sString, L<span class="stringliteral">"%s"</span>, <a class="code" href="__DutchText_8cpp.html#36a4a2c7056012b5d162c0f6f091ecaa">pHelicopterEtaStrings</a>[ 3 ] );
<a name="l04365"></a>04365       <a class="code" href="Font_8cpp.html#b3e12cf19a0ca58abf6689cc8eca3ead">mprintf</a>( MAP_HELICOPTER_ETA_POPUP_X + 5, sYPosition + 5 + 3 * <a class="code" href="Font_8cpp.html#35cddf34696d33489efb820caf968907">GetFontHeight</a>( MAP_FONT ), sString );
<a name="l04366"></a>04366 
<a name="l04367"></a>04367 
<a name="l04368"></a>04368       <span class="comment">// calculate the cost of the trip based on the number of safe and unsafe sectors it will pass through</span>
<a name="l04369"></a>04369       uiTripCost = ( sNumSafeSectors * COST_AIRSPACE_SAFE ) + ( sNumUnSafeSectors * COST_AIRSPACE_UNSAFE );
<a name="l04370"></a>04370 
<a name="l04371"></a>04371       swprintf( sString, L<span class="stringliteral">"%d"</span>, uiTripCost );
<a name="l04372"></a>04372       <a class="code" href="finances_8cpp.html#b739f2f0c39ec08da8b1455e51cfc28a">InsertCommasForDollarFigure</a>( sString );
<a name="l04373"></a>04373       <a class="code" href="finances_8cpp.html#64669392045ef4ca942162caf2ee4464">InsertDollarSignInToString</a>( sString );
<a name="l04374"></a>04374       <a class="code" href="Font_8cpp.html#e07e1d7f30bacf6b7ad052536c569b05">FindFontRightCoordinates</a>( MAP_HELICOPTER_ETA_POPUP_X + 5, ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> ) ( MAP_HELICOPTER_ETA_POPUP_Y + 5 + 3 * <a class="code" href="Font_8cpp.html#35cddf34696d33489efb820caf968907">GetFontHeight</a>( MAP_FONT ) ), MAP_HELICOPTER_ETA_POPUP_WIDTH, 0,  sString, MAP_FONT,  &amp;sX, &amp;sY );
<a name="l04375"></a>04375       <a class="code" href="Font_8cpp.html#b3e12cf19a0ca58abf6689cc8eca3ead">mprintf</a>( sX, ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> ) ( sYPosition + 5 + 3 * <a class="code" href="Font_8cpp.html#35cddf34696d33489efb820caf968907">GetFontHeight</a>( MAP_FONT ) ), sString );
<a name="l04376"></a>04376 
<a name="l04377"></a>04377       swprintf( sString, L<span class="stringliteral">"%s"</span>, <a class="code" href="__DutchText_8cpp.html#36a4a2c7056012b5d162c0f6f091ecaa">pHelicopterEtaStrings</a>[ 4 ] );
<a name="l04378"></a>04378       <a class="code" href="Font_8cpp.html#b3e12cf19a0ca58abf6689cc8eca3ead">mprintf</a>( MAP_HELICOPTER_ETA_POPUP_X + 5, sYPosition + 5 + 4 * <a class="code" href="Font_8cpp.html#35cddf34696d33489efb820caf968907">GetFontHeight</a>( MAP_FONT ), sString );
<a name="l04379"></a>04379 
<a name="l04380"></a>04380 
<a name="l04381"></a>04381       <span class="comment">// get travel time for the last path segment</span>
<a name="l04382"></a>04382       iTime = <a class="code" href="mapscreen_8cpp.html#6f87c30ca49aded01409426854f83c10">GetPathTravelTimeDuringPlotting</a>( <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#1bf007b81a4981f019caede54e60371c">pTempHelicopterPath</a> );
<a name="l04383"></a>04383 
<a name="l04384"></a>04384       <span class="comment">// add travel time for any prior path segments (stored in the helicopter's mercpath, but waypoints aren't built)</span>
<a name="l04385"></a>04385       iTime += <a class="code" href="mapscreen_8cpp.html#6f87c30ca49aded01409426854f83c10">GetPathTravelTimeDuringPlotting</a>( <a class="code" href="Vehicles_8cpp.html#f2797a2fc8430fa3072bca3e40d70e24">pVehicleList</a>[ <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#83461889711d71f15a4546aee8f6c062">iHelicopterVehicleId</a> ].pMercPath );
<a name="l04386"></a>04386 
<a name="l04387"></a>04387       swprintf( sString, L<span class="stringliteral">"%d%s %d%s"</span>, iTime / 60, <a class="code" href="__DutchText_8cpp.html#b3e77fbf5cae68944e1f90e95f844e58">gsTimeStrings</a>[0], iTime % 60, <a class="code" href="__DutchText_8cpp.html#b3e77fbf5cae68944e1f90e95f844e58">gsTimeStrings</a>[1] );
<a name="l04388"></a>04388       <a class="code" href="Font_8cpp.html#e07e1d7f30bacf6b7ad052536c569b05">FindFontRightCoordinates</a>( MAP_HELICOPTER_ETA_POPUP_X + 5, ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> ) ( sYPosition + 5 + 4 * <a class="code" href="Font_8cpp.html#35cddf34696d33489efb820caf968907">GetFontHeight</a>( MAP_FONT ) ), MAP_HELICOPTER_ETA_POPUP_WIDTH, 0,  sString, MAP_FONT,  &amp;sX, &amp;sY );
<a name="l04389"></a>04389       <a class="code" href="Font_8cpp.html#b3e12cf19a0ca58abf6689cc8eca3ead">mprintf</a>( sX, ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> ) ( sYPosition + 5 + 4 * <a class="code" href="Font_8cpp.html#35cddf34696d33489efb820caf968907">GetFontHeight</a>( MAP_FONT ) ), sString );
<a name="l04390"></a>04390 
<a name="l04391"></a>04391 
<a name="l04392"></a>04392       <span class="comment">// show # of passengers aboard the chopper</span>
<a name="l04393"></a>04393       <a class="code" href="Font_8cpp.html#b3e12cf19a0ca58abf6689cc8eca3ead">mprintf</a>( MAP_HELICOPTER_ETA_POPUP_X + 5, sYPosition + 5 + 5 * <a class="code" href="Font_8cpp.html#35cddf34696d33489efb820caf968907">GetFontHeight</a>( MAP_FONT ), <a class="code" href="__DutchText_8cpp.html#36a4a2c7056012b5d162c0f6f091ecaa">pHelicopterEtaStrings</a>[ 6 ] );
<a name="l04394"></a>04394       swprintf( sString, L<span class="stringliteral">"%d"</span>, <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#7802f6acd0476f1ba56e045515af5c00">GetNumberOfPassengersInHelicopter</a>() );
<a name="l04395"></a>04395       <a class="code" href="Font_8cpp.html#e07e1d7f30bacf6b7ad052536c569b05">FindFontRightCoordinates</a>( MAP_HELICOPTER_ETA_POPUP_X + 5, ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> ) ( MAP_HELICOPTER_ETA_POPUP_Y + 5 + 5 * <a class="code" href="Font_8cpp.html#35cddf34696d33489efb820caf968907">GetFontHeight</a>( MAP_FONT ) ), MAP_HELICOPTER_ETA_POPUP_WIDTH, 0,  sString, MAP_FONT,  &amp;sX, &amp;sY );
<a name="l04396"></a>04396       <a class="code" href="Font_8cpp.html#b3e12cf19a0ca58abf6689cc8eca3ead">mprintf</a>( sX, ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> ) ( sYPosition + 5 + 5 * <a class="code" href="Font_8cpp.html#35cddf34696d33489efb820caf968907">GetFontHeight</a>( MAP_FONT ) ), sString );
<a name="l04397"></a>04397 
<a name="l04398"></a>04398 
<a name="l04399"></a>04399       <a class="code" href="video_8cpp.html#4ed7790da612ff97bf9c05cf186823bc">InvalidateRegion</a>( MAP_HELICOPTER_ETA_POPUP_X, sOldYPosition,  MAP_HELICOPTER_ETA_POPUP_X + MAP_HELICOPTER_ETA_POPUP_WIDTH + 20, sOldYPosition + MAP_HELICOPTER_ETA_POPUP_HEIGHT );
<a name="l04400"></a>04400       <span class="keywordflow">return</span>;
<a name="l04401"></a>04401 }
<a name="l04402"></a>04402 
<a name="l04403"></a>04403 
<a name="l04404"></a>04404 <span class="comment">// grab position of helicopter and blt to screen</span>
<a name="l04405"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#17324ed32a3dc7ad602b655684a4f5a3">04405</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#17324ed32a3dc7ad602b655684a4f5a3">DisplayPositionOfHelicopter</a>( <span class="keywordtype">void</span> )
<a name="l04406"></a>04406 {
<a name="l04407"></a>04407       <span class="keyword">static</span> <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sOldMapX = 0, sOldMapY = 0;
<a name="l04408"></a>04408 <span class="comment">//    INT16 sX =0, sY = 0;</span>
<a name="l04409"></a>04409       <a class="code" href="Types_8h.html#8d06b04c04132c6f7c0fcb08c6167455">FLOAT</a> flRatio = 0.0;
<a name="l04410"></a>04410       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="Sound_01Control_8cpp.html#6150e0515f7202e2fb518f7206ed97dc">x</a>,y;
<a name="l04411"></a>04411       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> minX, minY, maxX, maxY;
<a name="l04412"></a>04412       <a class="code" href="structGROUP.html">GROUP</a> *pGroup;
<a name="l04413"></a>04413       <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hHandle;
<a name="l04414"></a>04414       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iNumberOfPeopleInHelicopter = 0;
<a name="l04415"></a>04415       <a class="code" href="Types_8h.html#fcdf88c1d4179fcd6d8a1fa9bbcb8a80">CHAR16</a> sString[ 4 ];
<a name="l04416"></a>04416 
<a name="l04417"></a>04417 
<a name="l04418"></a>04418       AssertMsg( ( sOldMapX &gt;= 0 ) &amp;&amp; ( sOldMapX &lt; <a class="code" href="local_8h.html#599adbe412c60e0cc5abb86be7ee4507">SCREEN_WIDTH</a> ), <a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>( <span class="stringliteral">"DisplayPositionOfHelicopter: Invalid sOldMapX = %d"</span>, sOldMapX ) );
<a name="l04419"></a>04419       AssertMsg( ( sOldMapY &gt;= 0 ) &amp;&amp; ( sOldMapY &lt; <a class="code" href="local_8h.html#f1c710caf1e3a9e81829078054e83799">SCREEN_HEIGHT</a> ), <a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>( <span class="stringliteral">"DisplayPositionOfHelicopter: Invalid sOldMapY = %d"</span>, sOldMapY ) );
<a name="l04420"></a>04420 
<a name="l04421"></a>04421       <span class="comment">// restore background on map where it is</span>
<a name="l04422"></a>04422       <span class="keywordflow">if</span>( sOldMapX != 0 )
<a name="l04423"></a>04423       {
<a name="l04424"></a>04424             <a class="code" href="Render_01Dirty_8cpp.html#ce65fac8b540eee1a5bf4902d2dcb0c5">RestoreExternBackgroundRect</a>( sOldMapX, sOldMapY, HELI_ICON_WIDTH, HELI_ICON_HEIGHT );
<a name="l04425"></a>04425             sOldMapX = 0;
<a name="l04426"></a>04426       }
<a name="l04427"></a>04427 
<a name="l04428"></a>04428 
<a name="l04429"></a>04429       <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#83461889711d71f15a4546aee8f6c062">iHelicopterVehicleId</a> != -1 )
<a name="l04430"></a>04430       {
<a name="l04431"></a>04431             <span class="comment">// draw the destination icon first, so when they overlap, the real one is on top!</span>
<a name="l04432"></a>04432             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#a42eaa645063f0f2c61352f20ae8f77d">DisplayDestinationOfHelicopter</a>( );
<a name="l04433"></a>04433 
<a name="l04434"></a>04434             <span class="comment">// check if mvt group</span>
<a name="l04435"></a>04435             <span class="keywordflow">if</span>( <a class="code" href="Vehicles_8cpp.html#f2797a2fc8430fa3072bca3e40d70e24">pVehicleList</a>[ <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#83461889711d71f15a4546aee8f6c062">iHelicopterVehicleId</a> ].ubMovementGroup != 0 )
<a name="l04436"></a>04436             {
<a name="l04437"></a>04437 
<a name="l04438"></a>04438                   pGroup = <a class="code" href="Strategic_01Movement_8cpp.html#33138746a238bdc5c684e9aa2c86691c">GetGroup</a>( <a class="code" href="Vehicles_8cpp.html#f2797a2fc8430fa3072bca3e40d70e24">pVehicleList</a>[ <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#83461889711d71f15a4546aee8f6c062">iHelicopterVehicleId</a> ].ubMovementGroup );
<a name="l04439"></a>04439 
<a name="l04440"></a>04440                   <span class="comment">// this came up in one bug report!</span>
<a name="l04441"></a>04441                   Assert( pGroup-&gt;<a class="code" href="structGROUP.html#c2aa3584cac4c329a6394a835c893ba3">uiTraverseTime</a> != -1 );
<a name="l04442"></a>04442 
<a name="l04443"></a>04443                   <span class="keywordflow">if</span>( ( pGroup-&gt;<a class="code" href="structGROUP.html#c2aa3584cac4c329a6394a835c893ba3">uiTraverseTime</a> &gt; 0 ) &amp;&amp; ( pGroup-&gt;<a class="code" href="structGROUP.html#c2aa3584cac4c329a6394a835c893ba3">uiTraverseTime</a> != 0xffffffff ) )
<a name="l04444"></a>04444                   {
<a name="l04445"></a>04445                         flRatio = ( ( pGroup-&gt;<a class="code" href="structGROUP.html#c2aa3584cac4c329a6394a835c893ba3">uiTraverseTime</a> + <a class="code" href="Game_01Clock_8cpp.html#4d255e800fba4d64144a7639d5f3421d">GetWorldTotalMin</a>() ) - pGroup-&gt;<a class="code" href="structGROUP.html#1c15d91590b473a0b6b041e51dc327a3">uiArrivalTime</a> ) / ( float ) pGroup-&gt;<a class="code" href="structGROUP.html#c2aa3584cac4c329a6394a835c893ba3">uiTraverseTime</a>;
<a name="l04446"></a>04446                   }
<a name="l04447"></a>04447 
<a name="l04448"></a>04448 <span class="comment">/*</span>
<a name="l04449"></a>04449 <span class="comment">                  AssertMsg( ( flRatio &gt;= 0 ) &amp;&amp; ( flRatio &lt;= 100 ), String( "DisplayPositionOfHelicopter: Invalid flRatio = %6.2f, trav %d, arr %d, time %d",</span>
<a name="l04450"></a>04450 <span class="comment">                                                                                                                        flRatio, pGroup-&gt;uiTraverseTime, pGroup-&gt;uiArrivalTime, GetWorldTotalMin() ) );</span>
<a name="l04451"></a>04451 <span class="comment">*/</span>
<a name="l04452"></a>04452 
<a name="l04453"></a>04453                   <span class="keywordflow">if</span> ( flRatio &lt; 0 )
<a name="l04454"></a>04454                   {
<a name="l04455"></a>04455                         flRatio = 0;
<a name="l04456"></a>04456                   }
<a name="l04457"></a>04457                   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( flRatio &gt; 100 )
<a name="l04458"></a>04458                   {
<a name="l04459"></a>04459                         flRatio = 100;
<a name="l04460"></a>04460                   }
<a name="l04461"></a>04461 
<a name="l04462"></a>04462 <span class="comment">//                if( !fZoomFlag )</span>
<a name="l04463"></a>04463                   {
<a name="l04464"></a>04464                         <span class="comment">// grab min and max locations to interpolate sub sector position</span>
<a name="l04465"></a>04465                         minX = MAP_VIEW_START_X + MAP_GRID_X * ( pGroup-&gt;<a class="code" href="structGROUP.html#eee29372e834112984eab1dc714466c0">ubSectorX</a> );
<a name="l04466"></a>04466                         maxX = MAP_VIEW_START_X + MAP_GRID_X * ( pGroup-&gt;<a class="code" href="structGROUP.html#22d4cef8a4b5c35af9a8259b763c26f0">ubNextX</a> );
<a name="l04467"></a>04467                         minY = MAP_VIEW_START_Y + MAP_GRID_Y * ( pGroup-&gt;<a class="code" href="structGROUP.html#11cd63715d9daf1488cca330690db007">ubSectorY</a> );
<a name="l04468"></a>04468                         maxY = MAP_VIEW_START_Y + MAP_GRID_Y * ( pGroup-&gt;<a class="code" href="structGROUP.html#14c006998c5f9c324b609d459e02d342">ubNextY</a> );
<a name="l04469"></a>04469                   }
<a name="l04470"></a>04470 <span class="comment">/*</span>
<a name="l04471"></a>04471 <span class="comment">                  else</span>
<a name="l04472"></a>04472 <span class="comment">                  {</span>
<a name="l04473"></a>04473 <span class="comment"></span>
<a name="l04474"></a>04474 <span class="comment">                        // grab coords for nextx,y and current x,y</span>
<a name="l04475"></a>04475 <span class="comment"></span>
<a name="l04476"></a>04476 <span class="comment">                        // zoomed in, takes a little more work</span>
<a name="l04477"></a>04477 <span class="comment">                        GetScreenXYFromMapXYStationary( ((UINT16)(pGroup-&gt;ubSectorX)),((UINT16)(pGroup-&gt;ubSectorY)) , &amp;sX, &amp;sY ); </span>
<a name="l04478"></a>04478 <span class="comment">                        sY=sY-MAP_GRID_Y;</span>
<a name="l04479"></a>04479 <span class="comment">                        sX=sX-MAP_GRID_X;</span>
<a name="l04480"></a>04480 <span class="comment"></span>
<a name="l04481"></a>04481 <span class="comment">                        minX = ( sX );</span>
<a name="l04482"></a>04482 <span class="comment">                        minY = ( sY );</span>
<a name="l04483"></a>04483 <span class="comment"></span>
<a name="l04484"></a>04484 <span class="comment">                        GetScreenXYFromMapXYStationary( ((UINT16)(pGroup-&gt;ubNextX)),((UINT16)(pGroup-&gt;ubNextY)) , &amp;sX, &amp;sY ); </span>
<a name="l04485"></a>04485 <span class="comment">                        sY=sY-MAP_GRID_Y;</span>
<a name="l04486"></a>04486 <span class="comment">                        sX=sX-MAP_GRID_X;</span>
<a name="l04487"></a>04487 <span class="comment">                        </span>
<a name="l04488"></a>04488 <span class="comment">                        maxX = ( sX );</span>
<a name="l04489"></a>04489 <span class="comment">                        maxY = ( sY );</span>
<a name="l04490"></a>04490 <span class="comment">                  }</span>
<a name="l04491"></a>04491 <span class="comment">*/</span>
<a name="l04492"></a>04492 
<a name="l04493"></a>04493                   <span class="comment">// WANNE 2</span>
<a name="l04494"></a>04494                   AssertMsg( ( minX &gt;= 0 ) &amp;&amp; ( minX &lt; <a class="code" href="local_8h.html#599adbe412c60e0cc5abb86be7ee4507">SCREEN_WIDTH</a> ), <a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>( <span class="stringliteral">"DisplayPositionOfHelicopter: Invalid minX = %d"</span>, minX ) );
<a name="l04495"></a>04495                   AssertMsg( ( maxX &gt;= 0 ) &amp;&amp; ( maxX &lt; <a class="code" href="local_8h.html#599adbe412c60e0cc5abb86be7ee4507">SCREEN_WIDTH</a> ), <a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>( <span class="stringliteral">"DisplayPositionOfHelicopter: Invalid maxX = %d"</span>, maxX ) );
<a name="l04496"></a>04496                   AssertMsg( ( minY &gt;= 0 ) &amp;&amp; ( minY &lt; <a class="code" href="local_8h.html#599adbe412c60e0cc5abb86be7ee4507">SCREEN_WIDTH</a> ), <a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>( <span class="stringliteral">"DisplayPositionOfHelicopter: Invalid minY = %d"</span>, minY ) );
<a name="l04497"></a>04497                   AssertMsg( ( maxY &gt;= 0 ) &amp;&amp; ( maxY &lt; <a class="code" href="local_8h.html#599adbe412c60e0cc5abb86be7ee4507">SCREEN_WIDTH</a> ), <a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>( <span class="stringliteral">"DisplayPositionOfHelicopter: Invalid maxY = %d"</span>, maxY ) );
<a name="l04498"></a>04498 
<a name="l04499"></a>04499                   <span class="comment">// IMPORTANT: Since min can easily be larger than max, we gotta cast to as signed value</span>
<a name="l04500"></a>04500                   x = ( <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> )( minX + flRatio * ( ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> ) maxX - ( INT16 ) minX ) );
<a name="l04501"></a>04501                   y = ( <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> )( minY + flRatio * ( ( INT16 ) maxY - ( INT16 ) minY ) );
<a name="l04502"></a>04502 
<a name="l04503"></a>04503 <span class="comment">/*</span>
<a name="l04504"></a>04504 <span class="comment">                  if( fZoomFlag )</span>
<a name="l04505"></a>04505 <span class="comment">                  {</span>
<a name="l04506"></a>04506 <span class="comment">                        x += 13;</span>
<a name="l04507"></a>04507 <span class="comment">                        y += 8;</span>
<a name="l04508"></a>04508 <span class="comment">                  }</span>
<a name="l04509"></a>04509 <span class="comment">                  else</span>
<a name="l04510"></a>04510 <span class="comment">*/</span>
<a name="l04511"></a>04511                   {
<a name="l04512"></a>04512                         x += 1;
<a name="l04513"></a>04513                         y += 3;
<a name="l04514"></a>04514                   }
<a name="l04515"></a>04515 
<a name="l04516"></a>04516 
<a name="l04517"></a>04517                   <span class="comment">// WANNE 2</span>
<a name="l04518"></a>04518                   AssertMsg( ( x &gt;= 0 ) &amp;&amp; ( x &lt; (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)<a class="code" href="local_8h.html#599adbe412c60e0cc5abb86be7ee4507">SCREEN_WIDTH</a> ), <a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>( <span class="stringliteral">"DisplayPositionOfHelicopter: Invalid x = %d.  At %d,%d.  Next %d,%d.  Min/Max X = %d/%d"</span>,
<a name="l04519"></a>04519                                           x, pGroup-&gt;<a class="code" href="structGROUP.html#eee29372e834112984eab1dc714466c0">ubSectorX</a>, pGroup-&gt;<a class="code" href="structGROUP.html#11cd63715d9daf1488cca330690db007">ubSectorY</a>, pGroup-&gt;<a class="code" href="structGROUP.html#22d4cef8a4b5c35af9a8259b763c26f0">ubNextX</a>, pGroup-&gt;<a class="code" href="structGROUP.html#14c006998c5f9c324b609d459e02d342">ubNextY</a>, minX, maxX ) );
<a name="l04520"></a>04520 
<a name="l04521"></a>04521                   AssertMsg( ( y &gt;= 0 ) &amp;&amp; ( y &lt; (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)<a class="code" href="local_8h.html#f1c710caf1e3a9e81829078054e83799">SCREEN_HEIGHT</a> ), <a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>( <span class="stringliteral">"DisplayPositionOfHelicopter: Invalid y = %d.  At %d,%d.  Next %d,%d.  Min/Max Y = %d/%d"</span>,
<a name="l04522"></a>04522                                           y, pGroup-&gt;<a class="code" href="structGROUP.html#eee29372e834112984eab1dc714466c0">ubSectorX</a>, pGroup-&gt;<a class="code" href="structGROUP.html#11cd63715d9daf1488cca330690db007">ubSectorY</a>, pGroup-&gt;<a class="code" href="structGROUP.html#22d4cef8a4b5c35af9a8259b763c26f0">ubNextX</a>, pGroup-&gt;<a class="code" href="structGROUP.html#14c006998c5f9c324b609d459e02d342">ubNextY</a>, minY, maxY ) );
<a name="l04523"></a>04523 
<a name="l04524"></a>04524 
<a name="l04525"></a>04525                   <span class="comment">// clip blits to mapscreen region</span>
<a name="l04526"></a>04526                   <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#1a814c4ade19f909f1082ca012e72ea8">ClipBlitsToMapViewRegion</a>( );
<a name="l04527"></a>04527 
<a name="l04528"></a>04528                   <a class="code" href="vobject_8cpp.html#bda2b0eae4cb40e612dffd307ad5c692">GetVideoObject</a>( &amp;hHandle, <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#c43bba843d221f8d5e10a3da02b6d00f">guiHelicopterIcon</a> );
<a name="l04529"></a>04529                   <a class="code" href="vobject_8cpp.html#8a5b07441769401593743b9f52a9e353">BltVideoObject</a>( FRAME_BUFFER, hHandle, HELI_ICON, x, y, VO_BLT_SRCTRANSPARENCY, NULL );
<a name="l04530"></a>04530 
<a name="l04531"></a>04531                   <span class="comment">// now get number of people and blit that too</span>
<a name="l04532"></a>04532                   iNumberOfPeopleInHelicopter =  <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#7802f6acd0476f1ba56e045515af5c00">GetNumberOfPassengersInHelicopter</a>( );
<a name="l04533"></a>04533                   swprintf( sString, L<span class="stringliteral">"%d"</span>, iNumberOfPeopleInHelicopter );
<a name="l04534"></a>04534 
<a name="l04535"></a>04535                   <a class="code" href="Font_8cpp.html#fa4871009f0473cca0380217753947dc">SetFont</a>( MAP_MVT_ICON_FONT );
<a name="l04536"></a>04536                   <a class="code" href="Font_8cpp.html#388be5810478c3f3bdb861f144085d70">SetFontForeground</a>( FONT_WHITE );
<a name="l04537"></a>04537                   <a class="code" href="Font_8cpp.html#a1fe8cc526be9e2c96b5dd66e348506f">SetFontBackground</a>( FONT_BLACK );
<a name="l04538"></a>04538 
<a name="l04539"></a>04539                   <a class="code" href="Font_8cpp.html#b3e12cf19a0ca58abf6689cc8eca3ead">mprintf</a>( x + 5, y + 1 , sString );
<a name="l04540"></a>04540                   
<a name="l04541"></a>04541                   <a class="code" href="video_8cpp.html#4ed7790da612ff97bf9c05cf186823bc">InvalidateRegion</a>( x, y, x + HELI_ICON_WIDTH, y + HELI_ICON_HEIGHT );
<a name="l04542"></a>04542 
<a name="l04543"></a>04543                   <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#1b9a9fa9699aebedd0c8b2cbd547a614">RestoreClipRegionToFullScreen</a>( );
<a name="l04544"></a>04544 
<a name="l04545"></a>04545                   <span class="comment">// now store the old stuff</span>
<a name="l04546"></a>04546                   sOldMapX = ( INT16 ) x;
<a name="l04547"></a>04547                   sOldMapY = ( INT16 ) y;
<a name="l04548"></a>04548             }
<a name="l04549"></a>04549       }
<a name="l04550"></a>04550 
<a name="l04551"></a>04551       <span class="keywordflow">return</span>;
<a name="l04552"></a>04552 }
<a name="l04553"></a>04553 
<a name="l04554"></a>04554 
<a name="l04555"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#a42eaa645063f0f2c61352f20ae8f77d">04555</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#a42eaa645063f0f2c61352f20ae8f77d">DisplayDestinationOfHelicopter</a>( <span class="keywordtype">void</span> )
<a name="l04556"></a>04556 {
<a name="l04557"></a>04557       <span class="keyword">static</span> <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sOldMapX = 0, sOldMapY = 0;
<a name="l04558"></a>04558       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSector;
<a name="l04559"></a>04559       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapX, sMapY;
<a name="l04560"></a>04560       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="Sound_01Control_8cpp.html#6150e0515f7202e2fb518f7206ed97dc">x</a>,y;
<a name="l04561"></a>04561       <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hHandle;
<a name="l04562"></a>04562 
<a name="l04563"></a>04563 
<a name="l04564"></a>04564       <span class="comment">// WANNE 2</span>
<a name="l04565"></a>04565       AssertMsg( ( sOldMapX &gt;= 0 ) &amp;&amp; ( sOldMapX &lt; <a class="code" href="local_8h.html#599adbe412c60e0cc5abb86be7ee4507">SCREEN_WIDTH</a> ), <a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>( <span class="stringliteral">"DisplayDestinationOfHelicopter: Invalid sOldMapX = %d"</span>, sOldMapX ) );
<a name="l04566"></a>04566       AssertMsg( ( sOldMapY &gt;= 0 ) &amp;&amp; ( sOldMapY &lt; <a class="code" href="local_8h.html#f1c710caf1e3a9e81829078054e83799">SCREEN_HEIGHT</a> ), <a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>( <span class="stringliteral">"DisplayDestinationOfHelicopter: Invalid sOldMapY = %d"</span>, sOldMapY ) );
<a name="l04567"></a>04567 
<a name="l04568"></a>04568       <span class="comment">// restore background on map where it is</span>
<a name="l04569"></a>04569       <span class="keywordflow">if</span>( sOldMapX != 0 )
<a name="l04570"></a>04570       {
<a name="l04571"></a>04571             <a class="code" href="Render_01Dirty_8cpp.html#ce65fac8b540eee1a5bf4902d2dcb0c5">RestoreExternBackgroundRect</a>( sOldMapX, sOldMapY, HELI_SHADOW_ICON_WIDTH, HELI_SHADOW_ICON_HEIGHT );
<a name="l04572"></a>04572             sOldMapX = 0;
<a name="l04573"></a>04573       }
<a name="l04574"></a>04574 
<a name="l04575"></a>04575       <span class="comment">// if helicopter is going somewhere</span>
<a name="l04576"></a>04576       <span class="keywordflow">if</span> ( <a class="code" href="Strategic_01Pathing_8cpp.html#1ac6358b29a1610d12a3e6ebbb0ead5e">GetLengthOfPath</a>( <a class="code" href="Vehicles_8cpp.html#f2797a2fc8430fa3072bca3e40d70e24">pVehicleList</a>[ <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#83461889711d71f15a4546aee8f6c062">iHelicopterVehicleId</a> ].pMercPath ) &gt; 1 )
<a name="l04577"></a>04577       {
<a name="l04578"></a>04578             <span class="comment">// get destination</span>
<a name="l04579"></a>04579             sSector = <a class="code" href="Strategic_01Pathing_8cpp.html#f7f0fdb77047c3ffc80076f0727dae1c">GetLastSectorIdInVehiclePath</a>( <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#83461889711d71f15a4546aee8f6c062">iHelicopterVehicleId</a> );
<a name="l04580"></a>04580             sMapX = sSector % MAP_WORLD_X;
<a name="l04581"></a>04581             sMapY = sSector / MAP_WORLD_X;
<a name="l04582"></a>04582 
<a name="l04583"></a>04583             x = MAP_VIEW_START_X + ( MAP_GRID_X * sMapX ) + 1;
<a name="l04584"></a>04584             y = MAP_VIEW_START_Y + ( MAP_GRID_Y * sMapY ) + 3;
<a name="l04585"></a>04585 
<a name="l04586"></a>04586             <span class="comment">// WANNE 2</span>
<a name="l04587"></a>04587             AssertMsg( ( x &gt;= 0 ) &amp;&amp; ( x &lt; (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)<a class="code" href="local_8h.html#599adbe412c60e0cc5abb86be7ee4507">SCREEN_WIDTH</a> ), <a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>( <span class="stringliteral">"DisplayDestinationOfHelicopter: Invalid x = %d.  Dest %d,%d"</span>, x, sMapX, sMapY ) );
<a name="l04588"></a>04588             AssertMsg( ( y &gt;= 0 ) &amp;&amp; ( y &lt; (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)<a class="code" href="local_8h.html#f1c710caf1e3a9e81829078054e83799">SCREEN_HEIGHT</a> ), <a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>( <span class="stringliteral">"DisplayDestinationOfHelicopter: Invalid y = %d.  Dest %d,%d"</span>, y, sMapX, sMapY ) );
<a name="l04589"></a>04589 
<a name="l04590"></a>04590             <span class="comment">// clip blits to mapscreen region</span>
<a name="l04591"></a>04591             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#1a814c4ade19f909f1082ca012e72ea8">ClipBlitsToMapViewRegion</a>( );
<a name="l04592"></a>04592 
<a name="l04593"></a>04593             <a class="code" href="vobject_8cpp.html#bda2b0eae4cb40e612dffd307ad5c692">GetVideoObject</a>( &amp;hHandle, <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#c43bba843d221f8d5e10a3da02b6d00f">guiHelicopterIcon</a> );
<a name="l04594"></a>04594             <a class="code" href="vobject_8cpp.html#8a5b07441769401593743b9f52a9e353">BltVideoObject</a>( FRAME_BUFFER, hHandle, HELI_SHADOW_ICON, x, y, VO_BLT_SRCTRANSPARENCY, NULL );
<a name="l04595"></a>04595             <a class="code" href="video_8cpp.html#4ed7790da612ff97bf9c05cf186823bc">InvalidateRegion</a>( x, y, x + HELI_SHADOW_ICON_WIDTH, y + HELI_SHADOW_ICON_HEIGHT );
<a name="l04596"></a>04596 
<a name="l04597"></a>04597             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#1b9a9fa9699aebedd0c8b2cbd547a614">RestoreClipRegionToFullScreen</a>( );
<a name="l04598"></a>04598 
<a name="l04599"></a>04599             <span class="comment">// now store the old stuff</span>
<a name="l04600"></a>04600             sOldMapX = ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> ) x;
<a name="l04601"></a>04601             sOldMapY = ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> ) y;
<a name="l04602"></a>04602       }
<a name="l04603"></a>04603 }
<a name="l04604"></a>04604 
<a name="l04605"></a>04605 
<a name="l04606"></a>04606 
<a name="l04607"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#446f56b6355bcada135c6bd8aee79e45">04607</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b4d1d5fa7425ad7b8206ad8925ee351f">CheckForClickOverHelicopterIcon</a>( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sClickedSectorX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sClickedSectorY )
<a name="l04608"></a>04608 {
<a name="l04609"></a>04609       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iDeltaTime = 0;
<a name="l04610"></a>04610       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fIgnoreClick = FALSE;
<a name="l04611"></a>04611       <a class="code" href="structGROUP.html">GROUP</a> *pGroup = NULL;
<a name="l04612"></a>04612       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fHelicopterOverNextSector = FALSE;
<a name="l04613"></a>04613       <a class="code" href="Types_8h.html#8d06b04c04132c6f7c0fcb08c6167455">FLOAT</a> flRatio = 0.0;
<a name="l04614"></a>04614       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorX;
<a name="l04615"></a>04615       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorY;
<a name="l04616"></a>04616 
<a name="l04617"></a>04617 
<a name="l04618"></a>04618       iDeltaTime = GetJA2Clock() - <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#f0cd9f0595ce35bd8945ae8bb75a31d8">giClickHeliIconBaseTime</a>;
<a name="l04619"></a>04619       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#f0cd9f0595ce35bd8945ae8bb75a31d8">giClickHeliIconBaseTime</a> = GetJA2Clock();
<a name="l04620"></a>04620 
<a name="l04621"></a>04621       <span class="keywordflow">if</span>( iDeltaTime &lt; 400 )
<a name="l04622"></a>04622       {
<a name="l04623"></a>04623             fIgnoreClick = TRUE;
<a name="l04624"></a>04624       }
<a name="l04625"></a>04625 
<a name="l04626"></a>04626       <span class="keywordflow">if</span>( !<a class="code" href="Map_01Screen_01Helicopter_8cpp.html#82c4b6ccb9f1f04a3c36d8b971cfbf52">fHelicopterAvailable</a> || !<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3eb1c4052a5a9718b9b73c9851737930">fShowAircraftFlag</a> )
<a name="l04627"></a>04627       { 
<a name="l04628"></a>04628             <span class="keywordflow">return</span>( FALSE );
<a name="l04629"></a>04629       }
<a name="l04630"></a>04630 
<a name="l04631"></a>04631       <span class="keywordflow">if</span> ( <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#83461889711d71f15a4546aee8f6c062">iHelicopterVehicleId</a> == -1 )
<a name="l04632"></a>04632       { 
<a name="l04633"></a>04633             <span class="keywordflow">return</span>( FALSE );
<a name="l04634"></a>04634       }
<a name="l04635"></a>04635 
<a name="l04636"></a>04636 
<a name="l04637"></a>04637       <span class="comment">// figure out over which sector the helicopter APPEARS to be to the player (because we slide it smoothly across the</span>
<a name="l04638"></a>04638       <span class="comment">// map, unlike groups travelling on the ground, it can appear over its next sector while it's not there yet.</span>
<a name="l04639"></a>04639 
<a name="l04640"></a>04640       pGroup = <a class="code" href="Strategic_01Movement_8cpp.html#33138746a238bdc5c684e9aa2c86691c">GetGroup</a>( <a class="code" href="Vehicles_8cpp.html#f2797a2fc8430fa3072bca3e40d70e24">pVehicleList</a>[ <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#83461889711d71f15a4546aee8f6c062">iHelicopterVehicleId</a> ].ubMovementGroup );
<a name="l04641"></a>04641       Assert( pGroup );
<a name="l04642"></a>04642 
<a name="l04643"></a>04643       <span class="keywordflow">if</span> ( pGroup-&gt;<a class="code" href="structGROUP.html#d5a9757bf698e6fa26c36eb03205d60b">fBetweenSectors</a> )
<a name="l04644"></a>04644       {
<a name="l04645"></a>04645             <span class="comment">// this came up in one bug report!</span>
<a name="l04646"></a>04646             Assert( pGroup-&gt;<a class="code" href="structGROUP.html#c2aa3584cac4c329a6394a835c893ba3">uiTraverseTime</a> != -1 );
<a name="l04647"></a>04647 
<a name="l04648"></a>04648             <span class="keywordflow">if</span>( ( pGroup-&gt;<a class="code" href="structGROUP.html#c2aa3584cac4c329a6394a835c893ba3">uiTraverseTime</a> &gt; 0 ) &amp;&amp; ( pGroup-&gt;<a class="code" href="structGROUP.html#c2aa3584cac4c329a6394a835c893ba3">uiTraverseTime</a> != 0xffffffff ) )
<a name="l04649"></a>04649             {
<a name="l04650"></a>04650                   flRatio = ( pGroup-&gt;<a class="code" href="structGROUP.html#c2aa3584cac4c329a6394a835c893ba3">uiTraverseTime</a> - pGroup-&gt;<a class="code" href="structGROUP.html#1c15d91590b473a0b6b041e51dc327a3">uiArrivalTime</a> + <a class="code" href="Game_01Clock_8cpp.html#4d255e800fba4d64144a7639d5f3421d">GetWorldTotalMin</a>() ) / ( <span class="keywordtype">float</span> ) pGroup-&gt;<a class="code" href="structGROUP.html#c2aa3584cac4c329a6394a835c893ba3">uiTraverseTime</a>;
<a name="l04651"></a>04651             }
<a name="l04652"></a>04652 
<a name="l04653"></a>04653             <span class="comment">// if more than halfway there, the chopper appears more over the next sector, not over its current one(!)</span>
<a name="l04654"></a>04654             <span class="keywordflow">if</span> ( flRatio &gt; 0.5 )
<a name="l04655"></a>04655             {
<a name="l04656"></a>04656                   fHelicopterOverNextSector = TRUE;
<a name="l04657"></a>04657             }
<a name="l04658"></a>04658       }
<a name="l04659"></a>04659 
<a name="l04660"></a>04660 
<a name="l04661"></a>04661       <span class="keywordflow">if</span> ( fHelicopterOverNextSector )
<a name="l04662"></a>04662       {
<a name="l04663"></a>04663             <span class="comment">// use the next sector's coordinates</span>
<a name="l04664"></a>04664             sSectorX = pGroup-&gt;<a class="code" href="structGROUP.html#22d4cef8a4b5c35af9a8259b763c26f0">ubNextX</a>;
<a name="l04665"></a>04665             sSectorY = pGroup-&gt;<a class="code" href="structGROUP.html#14c006998c5f9c324b609d459e02d342">ubNextY</a>;
<a name="l04666"></a>04666       }
<a name="l04667"></a>04667       <span class="keywordflow">else</span>
<a name="l04668"></a>04668       {
<a name="l04669"></a>04669             <span class="comment">// use current sector's coordinates</span>
<a name="l04670"></a>04670             sSectorX = <a class="code" href="Vehicles_8cpp.html#f2797a2fc8430fa3072bca3e40d70e24">pVehicleList</a>[ <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#83461889711d71f15a4546aee8f6c062">iHelicopterVehicleId</a> ].<a class="code" href="structVEHICLETYPE.html#563484836223d228a81a81d4cf823360">sSectorX</a>;
<a name="l04671"></a>04671             sSectorY = <a class="code" href="Vehicles_8cpp.html#f2797a2fc8430fa3072bca3e40d70e24">pVehicleList</a>[ <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#83461889711d71f15a4546aee8f6c062">iHelicopterVehicleId</a> ].<a class="code" href="structVEHICLETYPE.html#27c03977c142f72a74c14a1b9d1a668b">sSectorY</a>;
<a name="l04672"></a>04672       }
<a name="l04673"></a>04673 
<a name="l04674"></a>04674       <span class="comment">// check if helicopter appears where he clicked</span>
<a name="l04675"></a>04675       <span class="keywordflow">if</span>( ( sSectorX != sClickedSectorX ) || ( sSectorY != sClickedSectorY ) )
<a name="l04676"></a>04676       {
<a name="l04677"></a>04677             <span class="keywordflow">return</span>( FALSE );
<a name="l04678"></a>04678       }
<a name="l04679"></a>04679 
<a name="l04680"></a>04680       <span class="keywordflow">return</span>( TRUE );
<a name="l04681"></a>04681 }
<a name="l04682"></a>04682 
<a name="l04683"></a>04683 
<a name="l04684"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#d3e9620d0e3ad12fb6b4db0a75b1206e">04684</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#d3e9620d0e3ad12fb6b4db0a75b1206e">BlitMineIcon</a>( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapY )
<a name="l04685"></a>04685 {
<a name="l04686"></a>04686       <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hHandle;
<a name="l04687"></a>04687       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES;
<a name="l04688"></a>04688       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *pDestBuf2;
<a name="l04689"></a>04689       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sScreenX, sScreenY;
<a name="l04690"></a>04690 
<a name="l04691"></a>04691 
<a name="l04692"></a>04692       <a class="code" href="vobject_8cpp.html#bda2b0eae4cb40e612dffd307ad5c692">GetVideoObject</a>( &amp;hHandle, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#f616e826d2f40cbe86680cfa14f9e82a">guiMINEICON</a> );
<a name="l04693"></a>04693 
<a name="l04694"></a>04694       pDestBuf2 = <a class="code" href="vsurface_8cpp.html#592b2aeda6075fcbf9d7c67dc44fbd47">LockVideoSurface</a>( <a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a>, &amp;uiDestPitchBYTES );
<a name="l04695"></a>04695       <a class="code" href="line_8cpp.html#03cb6a8fa3b4bbdfcdab02c903bc7b7e">SetClippingRegionAndImageWidth</a>( uiDestPitchBYTES, MAP_VIEW_START_X+MAP_GRID_X - 1, MAP_VIEW_START_Y+MAP_GRID_Y - 1, MAP_VIEW_WIDTH+1,MAP_VIEW_HEIGHT-9 );
<a name="l04696"></a>04696       <a class="code" href="vsurface_8cpp.html#abe4e4124597b70b046a3b3567002cb2">UnLockVideoSurface</a>(<a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a>);
<a name="l04697"></a>04697       
<a name="l04698"></a>04698       <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a> )
<a name="l04699"></a>04699       {
<a name="l04700"></a>04700             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#61b609e8ae7546838d7b9b106d25ff3a">GetScreenXYFromMapXYStationary</a>( ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> )( sMapX ), ( INT16 )( sMapY ) , &amp;sScreenX, &amp;sScreenY );
<a name="l04701"></a>04701             <span class="comment">// when zoomed, the x,y returned is the CENTER of the map square in question</span>
<a name="l04702"></a>04702             <a class="code" href="vobject_8cpp.html#8a5b07441769401593743b9f52a9e353">BltVideoObject</a>( <a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a>, hHandle, 0, sScreenX - MAP_GRID_ZOOM_X / 4, sScreenY - MAP_GRID_ZOOM_Y / 4, VO_BLT_SRCTRANSPARENCY, NULL );
<a name="l04703"></a>04703       }
<a name="l04704"></a>04704       <span class="keywordflow">else</span>
<a name="l04705"></a>04705       {
<a name="l04706"></a>04706             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#917041ee85b8bfbe1a319c050e137073">GetScreenXYFromMapXY</a>( ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> )( sMapX ), ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> )( sMapY ), &amp;sScreenX, &amp;sScreenY );
<a name="l04707"></a>04707             <span class="comment">// when not zoomed, the x,y returned is the top left CORNER of the map square in question</span>
<a name="l04708"></a>04708             <a class="code" href="vobject_8cpp.html#8a5b07441769401593743b9f52a9e353">BltVideoObject</a>( <a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a>, hHandle, 1, sScreenX + MAP_GRID_X / 4, sScreenY + MAP_GRID_Y / 4, VO_BLT_SRCTRANSPARENCY, NULL );
<a name="l04709"></a>04709       }
<a name="l04710"></a>04710 }
<a name="l04711"></a>04711 
<a name="l04712"></a>04712 
<a name="l04713"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e7e7077d1c9c2ff0bc8435d9301ca8c7">04713</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e7e7077d1c9c2ff0bc8435d9301ca8c7">BlitMineText</a>( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapY )
<a name="l04714"></a>04714 {
<a name="l04715"></a>04715       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sScreenX, sScreenY;
<a name="l04716"></a>04716       <a class="code" href="Types_8h.html#fcdf88c1d4179fcd6d8a1fa9bbcb8a80">CHAR16</a> wString[ 32 ], wSubString[ 32 ];
<a name="l04717"></a>04717       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubMineIndex;
<a name="l04718"></a>04718       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubLineCnt = 0;
<a name="l04719"></a>04719 
<a name="l04720"></a>04720 
<a name="l04721"></a>04721       <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a> )
<a name="l04722"></a>04722       {
<a name="l04723"></a>04723             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#61b609e8ae7546838d7b9b106d25ff3a">GetScreenXYFromMapXYStationary</a>( ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> )( sMapX ), ( INT16 )( sMapY ) , &amp;sScreenX, &amp;sScreenY );
<a name="l04724"></a>04724 
<a name="l04725"></a>04725             <span class="comment">// set coordinates for start of mine text </span>
<a name="l04726"></a>04726             sScreenY += MAP_GRID_ZOOM_Y / 2 + 1;                  <span class="comment">// slightly below</span>
<a name="l04727"></a>04727       }
<a name="l04728"></a>04728       <span class="keywordflow">else</span>
<a name="l04729"></a>04729       {
<a name="l04730"></a>04730             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#917041ee85b8bfbe1a319c050e137073">GetScreenXYFromMapXY</a>( ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> )( sMapX ), ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> )( sMapY ), &amp;sScreenX, &amp;sScreenY );
<a name="l04731"></a>04731 
<a name="l04732"></a>04732             <span class="comment">// set coordinates for start of mine text </span>
<a name="l04733"></a>04733             sScreenX += MAP_GRID_X / 2;               <span class="comment">// centered around middle of mine square</span>
<a name="l04734"></a>04734             sScreenY += MAP_GRID_Y + 1;               <span class="comment">// slightly below</span>
<a name="l04735"></a>04735       }
<a name="l04736"></a>04736 
<a name="l04737"></a>04737 
<a name="l04738"></a>04738       <span class="comment">// show detailed mine info (name, production rate, daily production)</span>
<a name="l04739"></a>04739 
<a name="l04740"></a>04740       <a class="code" href="Font_8cpp.html#a038a1dc2edfc9f9c0766a0cbde2f440">SetFontDestBuffer</a>( <a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a>, MAP_VIEW_START_X, MAP_VIEW_START_Y, MAP_VIEW_START_X+MAP_VIEW_WIDTH+MAP_GRID_X, MAP_VIEW_START_Y+MAP_VIEW_HEIGHT+7, FALSE );
<a name="l04741"></a>04741 
<a name="l04742"></a>04742       <a class="code" href="Font_8cpp.html#fa4871009f0473cca0380217753947dc">SetFont</a>(MAP_FONT);
<a name="l04743"></a>04743       <a class="code" href="Font_8cpp.html#388be5810478c3f3bdb861f144085d70">SetFontForeground</a>( FONT_LTGREEN );
<a name="l04744"></a>04744       <a class="code" href="Font_8cpp.html#a1fe8cc526be9e2c96b5dd66e348506f">SetFontBackground</a>( FONT_BLACK );
<a name="l04745"></a>04745 
<a name="l04746"></a>04746 
<a name="l04747"></a>04747       ubMineIndex = <a class="code" href="Strategic_01Mines_8cpp.html#651c7549289f1e8757d06f344c2af6bd">GetMineIndexForSector</a>( sMapX, sMapY );
<a name="l04748"></a>04748 
<a name="l04749"></a>04749       <span class="comment">// display associated town name, followed by "mine"</span>
<a name="l04750"></a>04750       swprintf( wString, L<span class="stringliteral">"%s %s"</span>, <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#68933d9bb7d357af6609236e47fca927">pTownNames</a>[ <a class="code" href="Strategic_01Mines_8cpp.html#bd0d7d907c1c3b9f152a455c92e7ebfe">GetTownAssociatedWithMine</a>( <a class="code" href="Strategic_01Mines_8cpp.html#651c7549289f1e8757d06f344c2af6bd">GetMineIndexForSector</a>( sMapX, sMapY ) ) ],  <a class="code" href="__DutchText_8cpp.html#2d6fa826eeb4286552d59ccb751eaa15">pwMineStrings</a>[ 0 ] );
<a name="l04751"></a>04751       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7c675c4fd94f6b7b96fe25a2276415a7">AdjustXForLeftMapEdge</a>(wString, &amp;sScreenX);
<a name="l04752"></a>04752       <a class="code" href="Font_8cpp.html#b3e12cf19a0ca58abf6689cc8eca3ead">mprintf</a>( ( sScreenX - <a class="code" href="Font_8cpp.html#3bbbfeabebae07a03f719f35607c6e4f">StringPixLength</a>( wString, MAP_FONT ) / 2 ) , sScreenY + ubLineCnt * <a class="code" href="Font_8cpp.html#35cddf34696d33489efb820caf968907">GetFontHeight</a>( MAP_FONT ) , wString );
<a name="l04753"></a>04753       ubLineCnt++;
<a name="l04754"></a>04754 
<a name="l04755"></a>04755 
<a name="l04756"></a>04756       <span class="comment">// check if mine is empty (abandoned) or running out</span>
<a name="l04757"></a>04757       <span class="keywordflow">if</span> (<a class="code" href="Creature_01Spreading_8cpp.html#9380f2e39f34095d76ba1abab44dab29">gMineStatus</a>[ ubMineIndex ].fEmpty)
<a name="l04758"></a>04758       {
<a name="l04759"></a>04759             swprintf( wString, L<span class="stringliteral">"%s"</span>, <a class="code" href="__DutchText_8cpp.html#2d6fa826eeb4286552d59ccb751eaa15">pwMineStrings</a>[ 5 ] );
<a name="l04760"></a>04760             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7c675c4fd94f6b7b96fe25a2276415a7">AdjustXForLeftMapEdge</a>(wString, &amp;sScreenX);
<a name="l04761"></a>04761             <a class="code" href="Font_8cpp.html#b3e12cf19a0ca58abf6689cc8eca3ead">mprintf</a>( ( sScreenX - <a class="code" href="Font_8cpp.html#3bbbfeabebae07a03f719f35607c6e4f">StringPixLength</a>( wString, MAP_FONT ) / 2 ) , sScreenY + ubLineCnt * <a class="code" href="Font_8cpp.html#35cddf34696d33489efb820caf968907">GetFontHeight</a>( MAP_FONT ) , wString );
<a name="l04762"></a>04762             ubLineCnt++;
<a name="l04763"></a>04763       }
<a name="l04764"></a>04764       <span class="keywordflow">else</span>
<a name="l04765"></a>04765       <span class="keywordflow">if</span> (<a class="code" href="Creature_01Spreading_8cpp.html#9380f2e39f34095d76ba1abab44dab29">gMineStatus</a>[ ubMineIndex ].fShutDown)
<a name="l04766"></a>04766       {
<a name="l04767"></a>04767             swprintf( wString, L<span class="stringliteral">"%s"</span>, <a class="code" href="__DutchText_8cpp.html#2d6fa826eeb4286552d59ccb751eaa15">pwMineStrings</a>[ 6 ] );
<a name="l04768"></a>04768             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7c675c4fd94f6b7b96fe25a2276415a7">AdjustXForLeftMapEdge</a>(wString, &amp;sScreenX);
<a name="l04769"></a>04769             <a class="code" href="Font_8cpp.html#b3e12cf19a0ca58abf6689cc8eca3ead">mprintf</a>( ( sScreenX - <a class="code" href="Font_8cpp.html#3bbbfeabebae07a03f719f35607c6e4f">StringPixLength</a>( wString, MAP_FONT ) / 2 ) , sScreenY + ubLineCnt * <a class="code" href="Font_8cpp.html#35cddf34696d33489efb820caf968907">GetFontHeight</a>( MAP_FONT ) , wString );
<a name="l04770"></a>04770             ubLineCnt++;
<a name="l04771"></a>04771       }
<a name="l04772"></a>04772       <span class="keywordflow">else</span>
<a name="l04773"></a>04773       <span class="keywordflow">if</span> (<a class="code" href="Creature_01Spreading_8cpp.html#9380f2e39f34095d76ba1abab44dab29">gMineStatus</a>[ ubMineIndex ].fRunningOut)
<a name="l04774"></a>04774       {
<a name="l04775"></a>04775             swprintf( wString, L<span class="stringliteral">"%s"</span>, <a class="code" href="__DutchText_8cpp.html#2d6fa826eeb4286552d59ccb751eaa15">pwMineStrings</a>[ 7 ] );
<a name="l04776"></a>04776             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7c675c4fd94f6b7b96fe25a2276415a7">AdjustXForLeftMapEdge</a>(wString, &amp;sScreenX);
<a name="l04777"></a>04777             <a class="code" href="Font_8cpp.html#b3e12cf19a0ca58abf6689cc8eca3ead">mprintf</a>( ( sScreenX - <a class="code" href="Font_8cpp.html#3bbbfeabebae07a03f719f35607c6e4f">StringPixLength</a>( wString, MAP_FONT ) / 2 ) , sScreenY + ubLineCnt * <a class="code" href="Font_8cpp.html#35cddf34696d33489efb820caf968907">GetFontHeight</a>( MAP_FONT ) , wString );
<a name="l04778"></a>04778             ubLineCnt++;
<a name="l04779"></a>04779       }
<a name="l04780"></a>04780 
<a name="l04781"></a>04781 
<a name="l04782"></a>04782       <span class="comment">// only show production if player controls it and it's actually producing</span>
<a name="l04783"></a>04783       <span class="keywordflow">if</span> (<a class="code" href="Strategic_01Mines_8cpp.html#12722b782db4ec45d9dee0f97c871f6f">PlayerControlsMine</a>(ubMineIndex) &amp;&amp; !<a class="code" href="Creature_01Spreading_8cpp.html#9380f2e39f34095d76ba1abab44dab29">gMineStatus</a>[ ubMineIndex ].fEmpty)
<a name="l04784"></a>04784       {
<a name="l04785"></a>04785             <span class="comment">// show current production</span>
<a name="l04786"></a>04786             swprintf( wSubString, L<span class="stringliteral">"%d"</span>, <a class="code" href="Strategic_01Mines_8cpp.html#eb39d37d61196260412fdb48b91159d3">PredictDailyIncomeFromAMine</a>(ubMineIndex) );
<a name="l04787"></a>04787             <a class="code" href="finances_8cpp.html#b739f2f0c39ec08da8b1455e51cfc28a">InsertCommasForDollarFigure</a>( wSubString );
<a name="l04788"></a>04788             <a class="code" href="finances_8cpp.html#64669392045ef4ca942162caf2ee4464">InsertDollarSignInToString</a>( wSubString );
<a name="l04789"></a>04789             <a class="code" href="Sys_01Globals_8h.html#3d1e5716a3d04a53b8846319dd57da83">wcscpy</a>( wString, wSubString );
<a name="l04790"></a>04790 
<a name="l04791"></a>04791 <span class="comment">/*</span>
<a name="l04792"></a>04792 <span class="comment">            // show maximum potential production</span>
<a name="l04793"></a>04793 <span class="comment">            swprintf( wSubString, L"%d", GetMaxDailyRemovalFromMine(ubMineIndex) );</span>
<a name="l04794"></a>04794 <span class="comment">            InsertCommasForDollarFigure( wSubString );</span>
<a name="l04795"></a>04795 <span class="comment">            InsertDollarSignInToString( wSubString );</span>
<a name="l04796"></a>04796 <span class="comment">            wcscat( wString, L" / ");</span>
<a name="l04797"></a>04797 <span class="comment">            wcscat( wString, wSubString );</span>
<a name="l04798"></a>04798 <span class="comment">*/</span>
<a name="l04799"></a>04799 
<a name="l04800"></a>04800             <span class="comment">// if potential is not nil, show percentage of the two</span>
<a name="l04801"></a>04801             <span class="keywordflow">if</span> (<a class="code" href="Strategic_01Mines_8cpp.html#2c926993f981184d32a724ae512c6716">GetMaxPeriodicRemovalFromMine</a>(ubMineIndex) &gt; 0)
<a name="l04802"></a>04802             {
<a name="l04803"></a>04803                   swprintf( wSubString, L<span class="stringliteral">" (%d%%%%)"</span>, (<a class="code" href="Strategic_01Mines_8cpp.html#eb39d37d61196260412fdb48b91159d3">PredictDailyIncomeFromAMine</a>(ubMineIndex) * 100 ) / <a class="code" href="Strategic_01Mines_8cpp.html#ecd262ba34aaae61562c412037da6637">GetMaxDailyRemovalFromMine</a>(ubMineIndex) );
<a name="l04804"></a>04804                   <a class="code" href="Sys_01Globals_8h.html#92a23b0a8bea9679b6f78aa26b1715e7">wcscat</a>( wString, wSubString );
<a name="l04805"></a>04805             }
<a name="l04806"></a>04806       
<a name="l04807"></a>04807             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7c675c4fd94f6b7b96fe25a2276415a7">AdjustXForLeftMapEdge</a>(wString, &amp;sScreenX);
<a name="l04808"></a>04808             <a class="code" href="Font_8cpp.html#b3e12cf19a0ca58abf6689cc8eca3ead">mprintf</a>( ( sScreenX - <a class="code" href="Font_8cpp.html#d20ce813e4c5a09fbc15e38819514e22">StringPixLengthArg</a>( MAP_FONT, wcslen(wString), wString ) / 2 ) , sScreenY + ubLineCnt * <a class="code" href="Font_8cpp.html#35cddf34696d33489efb820caf968907">GetFontHeight</a>( MAP_FONT ), wString );
<a name="l04809"></a>04809             ubLineCnt++;
<a name="l04810"></a>04810       }
<a name="l04811"></a>04811 
<a name="l04812"></a>04812 
<a name="l04813"></a>04813       <a class="code" href="Font_8cpp.html#a038a1dc2edfc9f9c0766a0cbde2f440">SetFontDestBuffer</a>( FRAME_BUFFER, MAP_VIEW_START_X, MAP_VIEW_START_Y, MAP_VIEW_START_X+MAP_VIEW_WIDTH+MAP_GRID_X, MAP_VIEW_START_Y+MAP_VIEW_HEIGHT+7, FALSE );
<a name="l04814"></a>04814 }
<a name="l04815"></a>04815 
<a name="l04816"></a>04816 
<a name="l04817"></a>04817 
<a name="l04818"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7c675c4fd94f6b7b96fe25a2276415a7">04818</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7c675c4fd94f6b7b96fe25a2276415a7">AdjustXForLeftMapEdge</a>(<a class="code" href="Types_8h.html#94ebfccc6e846c28751f8d616371f1e5">STR16</a> wString, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> *psX)
<a name="l04819"></a>04819 {
<a name="l04820"></a>04820       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sStartingX, sPastEdge;
<a name="l04821"></a>04821 
<a name="l04822"></a>04822       <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a> )
<a name="l04823"></a>04823             <span class="comment">// it's ok to cut strings off in zoomed mode</span>
<a name="l04824"></a>04824             <span class="keywordflow">return</span>;
<a name="l04825"></a>04825 
<a name="l04826"></a>04826       sStartingX = *psX - (<a class="code" href="Font_8cpp.html#d20ce813e4c5a09fbc15e38819514e22">StringPixLengthArg</a>( MAP_FONT, wcslen(wString), wString ) / 2);
<a name="l04827"></a>04827       sPastEdge = (MAP_VIEW_START_X + 23) - sStartingX;
<a name="l04828"></a>04828 
<a name="l04829"></a>04829       <span class="keywordflow">if</span> (sPastEdge &gt; 0)
<a name="l04830"></a>04830             *psX += sPastEdge;
<a name="l04831"></a>04831 }
<a name="l04832"></a>04832 
<a name="l04833"></a>04833 
<a name="l04834"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#00b19b99ce614121bc7cfb2a004f9d55">04834</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#00b19b99ce614121bc7cfb2a004f9d55">BlitTownGridMarkers</a>( <span class="keywordtype">void</span> )
<a name="l04835"></a>04835 {
<a name="l04836"></a>04836       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sScreenX = 0, sScreenY = 0;
<a name="l04837"></a>04837       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>                                                             uiDestPitchBYTES;
<a name="l04838"></a>04838       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>                                                              *pDestBuf;
<a name="l04839"></a>04839       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usColor = 0;
<a name="l04840"></a>04840       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iCounter = 0;
<a name="l04841"></a>04841       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sWidth = 0, sHeight = 0;
<a name="l04842"></a>04842 
<a name="l04843"></a>04843       <span class="comment">// get 16 bpp color</span>
<a name="l04844"></a>04844       usColor = <a class="code" href="himage_8cpp.html#d29939ffcd39c7d1cc0a91222702d361">Get16BPPColor</a>( FROMRGB( 100, 100, 100) );
<a name="l04845"></a>04845 
<a name="l04846"></a>04846 
<a name="l04847"></a>04847       <span class="comment">// blit in the highlighted sector</span>
<a name="l04848"></a>04848       pDestBuf = <a class="code" href="vsurface_8cpp.html#592b2aeda6075fcbf9d7c67dc44fbd47">LockVideoSurface</a>( <a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a>, &amp;uiDestPitchBYTES );              
<a name="l04849"></a>04849 
<a name="l04850"></a>04850       <span class="comment">// clip to view region</span>
<a name="l04851"></a>04851       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0219bd63e8ae634ee810a9186579675c">ClipBlitsToMapViewRegionForRectangleAndABit</a>( uiDestPitchBYTES );
<a name="l04852"></a>04852 
<a name="l04853"></a>04853       
<a name="l04854"></a>04854       <span class="comment">// go through list of towns and place on screen</span>
<a name="l04855"></a>04855       <span class="keywordflow">while</span>( <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#1001d8cb48db71e9db760efbf4353e6a">pTownNamesList</a>[ iCounter ] != 0 )
<a name="l04856"></a>04856       {
<a name="l04857"></a>04857             <span class="comment">// skip Orta/Tixa until found</span>
<a name="l04858"></a>04858             <span class="keywordflow">if</span>( ( ( <a class="code" href="strategicmap_8cpp.html#20549a2f36fdcba9495803c110584b47">fFoundOrta</a> != FALSE ) || ( <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#1001d8cb48db71e9db760efbf4353e6a">pTownNamesList</a>[ iCounter ] != <a class="code" href="mapscreen_8h.html#4d1dc70bee62b945929c96dfafebe1051ae6da30d1617c09899e280a04bde521">ORTA</a> ) ) &amp;&amp; ( ( <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#1001d8cb48db71e9db760efbf4353e6a">pTownNamesList</a>[ iCounter ] != <a class="code" href="mapscreen_8h.html#4d1dc70bee62b945929c96dfafebe10560f8283526f5d52c03edfd9bff8b218a">TIXA</a> ) || ( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e5d32ba931394430e60f65852d4e36e6">fFoundTixa</a> != FALSE) ) )
<a name="l04859"></a>04859             {
<a name="l04860"></a>04860                   <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a> )
<a name="l04861"></a>04861                   {
<a name="l04862"></a>04862                         <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#61b609e8ae7546838d7b9b106d25ff3a">GetScreenXYFromMapXYStationary</a>( ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> )( <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#c994e67a1f8511a80e6418dc483b0861">pTownLocationsList</a>[ iCounter ] % MAP_WORLD_X ), ( INT16 )( <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#c994e67a1f8511a80e6418dc483b0861">pTownLocationsList</a>[ iCounter ] / MAP_WORLD_X ) , &amp;sScreenX, &amp;sScreenY );
<a name="l04863"></a>04863                         sScreenX -= MAP_GRID_X - 1;
<a name="l04864"></a>04864                         sScreenY -= MAP_GRID_Y;
<a name="l04865"></a>04865 
<a name="l04866"></a>04866                         sWidth = 2 * MAP_GRID_X;
<a name="l04867"></a>04867                         sHeight= 2 * MAP_GRID_Y;
<a name="l04868"></a>04868                   }
<a name="l04869"></a>04869                   <span class="keywordflow">else</span>
<a name="l04870"></a>04870                   {
<a name="l04871"></a>04871                         <span class="comment">// get location on screen</span>
<a name="l04872"></a>04872                         <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#917041ee85b8bfbe1a319c050e137073">GetScreenXYFromMapXY</a>( ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> )( <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#c994e67a1f8511a80e6418dc483b0861">pTownLocationsList</a>[ iCounter ] % MAP_WORLD_X ), ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> )( <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#c994e67a1f8511a80e6418dc483b0861">pTownLocationsList</a>[ iCounter ] / MAP_WORLD_X ), &amp;sScreenX, &amp;sScreenY );
<a name="l04873"></a>04873                         sWidth = MAP_GRID_X - 1;
<a name="l04874"></a>04874                         sHeight= MAP_GRID_Y;
<a name="l04875"></a>04875 
<a name="l04876"></a>04876                         sScreenX += 2;
<a name="l04877"></a>04877                   }
<a name="l04878"></a>04878 
<a name="l04879"></a>04879                   <span class="keywordflow">if</span>( <a class="code" href="strategic_8cpp.html#6f48fb0ea28e3d4889423290f1a6ede8">StrategicMap</a>[ <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#c994e67a1f8511a80e6418dc483b0861">pTownLocationsList</a>[ iCounter ] - MAP_WORLD_X ].bNameId == <a class="code" href="mapscreen_8h.html#4d1dc70bee62b945929c96dfafebe105d008cfe091b982e6d052565ed0b5acd8">BLANK_SECTOR</a> )
<a name="l04880"></a>04880                   {
<a name="l04881"></a>04881                         <a class="code" href="line_8cpp.html#aa92e189d27648ae67b8b8f5de610f42">LineDraw</a>( TRUE,  sScreenX - 1, sScreenY - 1, sScreenX + sWidth - 1, sScreenY - 1, usColor, pDestBuf );
<a name="l04882"></a>04882                   }
<a name="l04883"></a>04883 
<a name="l04884"></a>04884                   <span class="keywordflow">if</span>( ( <a class="code" href="strategic_8cpp.html#6f48fb0ea28e3d4889423290f1a6ede8">StrategicMap</a>[ <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#c994e67a1f8511a80e6418dc483b0861">pTownLocationsList</a>[ iCounter ] + MAP_WORLD_X ].bNameId == <a class="code" href="mapscreen_8h.html#4d1dc70bee62b945929c96dfafebe105d008cfe091b982e6d052565ed0b5acd8">BLANK_SECTOR</a> ) <span class="comment">/* || ( StrategicMap[ pTownLocationsList[ iCounter ] + MAP_WORLD_X ].bNameId == PALACE ) */</span> )
<a name="l04885"></a>04885                   {
<a name="l04886"></a>04886                         <a class="code" href="line_8cpp.html#aa92e189d27648ae67b8b8f5de610f42">LineDraw</a>( TRUE,  sScreenX - 1, sScreenY + sHeight - 1, sScreenX + sWidth - 1, sScreenY + sHeight - 1, usColor, pDestBuf );
<a name="l04887"></a>04887                   }
<a name="l04888"></a>04888 
<a name="l04889"></a>04889                   <span class="keywordflow">if</span>( <a class="code" href="strategic_8cpp.html#6f48fb0ea28e3d4889423290f1a6ede8">StrategicMap</a>[ <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#c994e67a1f8511a80e6418dc483b0861">pTownLocationsList</a>[ iCounter ] - 1 ].bNameId == <a class="code" href="mapscreen_8h.html#4d1dc70bee62b945929c96dfafebe105d008cfe091b982e6d052565ed0b5acd8">BLANK_SECTOR</a> )
<a name="l04890"></a>04890                   {
<a name="l04891"></a>04891                         <a class="code" href="line_8cpp.html#aa92e189d27648ae67b8b8f5de610f42">LineDraw</a>( TRUE,  sScreenX - 2, sScreenY - 1, sScreenX - 2, sScreenY + sHeight - 1, usColor, pDestBuf );
<a name="l04892"></a>04892                   }
<a name="l04893"></a>04893 
<a name="l04894"></a>04894                   <span class="keywordflow">if</span>( <a class="code" href="strategic_8cpp.html#6f48fb0ea28e3d4889423290f1a6ede8">StrategicMap</a>[ <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#c994e67a1f8511a80e6418dc483b0861">pTownLocationsList</a>[ iCounter ] + 1 ].bNameId == <a class="code" href="mapscreen_8h.html#4d1dc70bee62b945929c96dfafebe105d008cfe091b982e6d052565ed0b5acd8">BLANK_SECTOR</a> )
<a name="l04895"></a>04895                   {
<a name="l04896"></a>04896                         <a class="code" href="line_8cpp.html#aa92e189d27648ae67b8b8f5de610f42">LineDraw</a>( TRUE,  sScreenX + sWidth - 1, sScreenY - 1, sScreenX + sWidth - 1, sScreenY + sHeight - 1, usColor, pDestBuf );
<a name="l04897"></a>04897                   }
<a name="l04898"></a>04898             }
<a name="l04899"></a>04899 
<a name="l04900"></a>04900             iCounter++;
<a name="l04901"></a>04901       }
<a name="l04902"></a>04902 
<a name="l04903"></a>04903       <span class="comment">// restore clips</span>
<a name="l04904"></a>04904       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#110ca869cf08f45cb41c294c0814ac6f">RestoreClipRegionToFullScreenForRectangle</a>( uiDestPitchBYTES );
<a name="l04905"></a>04905       
<a name="l04906"></a>04906       <span class="comment">// unlock surface</span>
<a name="l04907"></a>04907       <a class="code" href="vsurface_8cpp.html#abe4e4124597b70b046a3b3567002cb2">UnLockVideoSurface</a>( <a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a> );
<a name="l04908"></a>04908 
<a name="l04909"></a>04909 
<a name="l04910"></a>04910       <span class="keywordflow">return</span>;
<a name="l04911"></a>04911 }
<a name="l04912"></a>04912 
<a name="l04913"></a>04913 
<a name="l04914"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#f7a625019aa4617d9ce68647572f53e6">04914</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#f7a625019aa4617d9ce68647572f53e6">BlitMineGridMarkers</a>( <span class="keywordtype">void</span> )
<a name="l04915"></a>04915 {
<a name="l04916"></a>04916       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sScreenX = 0, sScreenY = 0;
<a name="l04917"></a>04917       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>                                                             uiDestPitchBYTES;
<a name="l04918"></a>04918       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>                                                              *pDestBuf;
<a name="l04919"></a>04919       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usColor = 0;
<a name="l04920"></a>04920       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iCounter = 0;
<a name="l04921"></a>04921       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sWidth = 0, sHeight = 0;
<a name="l04922"></a>04922 
<a name="l04923"></a>04923       <span class="comment">// get 16 bpp color</span>
<a name="l04924"></a>04924       usColor = <a class="code" href="himage_8cpp.html#d29939ffcd39c7d1cc0a91222702d361">Get16BPPColor</a>( FROMRGB( 100, 100, 100) );
<a name="l04925"></a>04925 
<a name="l04926"></a>04926 
<a name="l04927"></a>04927       <span class="comment">// blit in the highlighted sector</span>
<a name="l04928"></a>04928       pDestBuf = <a class="code" href="vsurface_8cpp.html#592b2aeda6075fcbf9d7c67dc44fbd47">LockVideoSurface</a>( <a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a>, &amp;uiDestPitchBYTES );              
<a name="l04929"></a>04929 
<a name="l04930"></a>04930       <span class="comment">// clip to view region</span>
<a name="l04931"></a>04931       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0219bd63e8ae634ee810a9186579675c">ClipBlitsToMapViewRegionForRectangleAndABit</a>( uiDestPitchBYTES );
<a name="l04932"></a>04932 
<a name="l04933"></a>04933       <span class="keywordflow">for</span>( iCounter = 0; iCounter &lt; <a class="code" href="Strategic_01Mines_8h.html#a3dfb65ce3006aaab287357097352604c1e5d8fe484e44dd37bde096e12f2cf4">MAX_NUMBER_OF_MINES</a>; iCounter++ )
<a name="l04934"></a>04934       {     
<a name="l04935"></a>04935             <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a> )
<a name="l04936"></a>04936             {
<a name="l04937"></a>04937                   <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#61b609e8ae7546838d7b9b106d25ff3a">GetScreenXYFromMapXYStationary</a>( ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> )( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#2889e0746115b88002494be407bc5de4">gMineLocation</a>[ iCounter ].sSectorX), ( INT16 )( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#2889e0746115b88002494be407bc5de4">gMineLocation</a>[ iCounter ].sSectorY ) , &amp;sScreenX, &amp;sScreenY );
<a name="l04938"></a>04938                   sScreenX -= MAP_GRID_X;
<a name="l04939"></a>04939                   sScreenY -= MAP_GRID_Y;
<a name="l04940"></a>04940 
<a name="l04941"></a>04941                   sWidth = 2 * MAP_GRID_X;
<a name="l04942"></a>04942                   sHeight= 2 * MAP_GRID_Y;
<a name="l04943"></a>04943             }
<a name="l04944"></a>04944             <span class="keywordflow">else</span>
<a name="l04945"></a>04945             {
<a name="l04946"></a>04946                   <span class="comment">// get location on screen</span>
<a name="l04947"></a>04947                   <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#917041ee85b8bfbe1a319c050e137073">GetScreenXYFromMapXY</a>( ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> )(  <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#2889e0746115b88002494be407bc5de4">gMineLocation</a>[ iCounter ].sSectorX ), ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> )(  <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#2889e0746115b88002494be407bc5de4">gMineLocation</a>[ iCounter ].sSectorY ), &amp;sScreenX, &amp;sScreenY );
<a name="l04948"></a>04948                   sWidth = MAP_GRID_X;
<a name="l04949"></a>04949                   sHeight= MAP_GRID_Y;
<a name="l04950"></a>04950             
<a name="l04951"></a>04951             }
<a name="l04952"></a>04952 
<a name="l04953"></a>04953             <span class="comment">// draw rectangle</span>
<a name="l04954"></a>04954             <a class="code" href="line_8cpp.html#2806e958344a513567053e98757e64b3">RectangleDraw</a>( TRUE, sScreenX, sScreenY - 1, sScreenX + sWidth, sScreenY + sHeight - 1, usColor, pDestBuf );      
<a name="l04955"></a>04955       }
<a name="l04956"></a>04956 
<a name="l04957"></a>04957       <span class="comment">// restore clips</span>
<a name="l04958"></a>04958       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#110ca869cf08f45cb41c294c0814ac6f">RestoreClipRegionToFullScreenForRectangle</a>( uiDestPitchBYTES );
<a name="l04959"></a>04959       
<a name="l04960"></a>04960       <span class="comment">// unlock surface</span>
<a name="l04961"></a>04961       <a class="code" href="vsurface_8cpp.html#abe4e4124597b70b046a3b3567002cb2">UnLockVideoSurface</a>( <a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a> );
<a name="l04962"></a>04962 
<a name="l04963"></a>04963 
<a name="l04964"></a>04964       <span class="keywordflow">return</span>;
<a name="l04965"></a>04965 }
<a name="l04966"></a>04966 
<a name="l04967"></a>04967 
<a name="l04968"></a>04968 <span class="comment">/*</span>
<a name="l04969"></a>04969 <span class="comment">void CheckIfAnyoneLeftInSector( INT16 sX, INT16 sY, INT16 sNewX, INT16 sNewY, INT8 bZ )</span>
<a name="l04970"></a>04970 <span class="comment">{</span>
<a name="l04971"></a>04971 <span class="comment">      // if this map sector is currently selected</span>
<a name="l04972"></a>04972 <span class="comment">      if( ( sX == sSelMapX ) &amp;&amp; ( sY == sSelMapY ) &amp;&amp; ( bZ == iCurrentMapSectorZ ) )</span>
<a name="l04973"></a>04973 <span class="comment">      {</span>
<a name="l04974"></a>04974 <span class="comment">            // check if anyone left in the old sector</span>
<a name="l04975"></a>04975 <span class="comment">            if( NumFriendlyInSector( (INT8)sX, (INT8)sY, bZ ) == 0)</span>
<a name="l04976"></a>04976 <span class="comment">            {</span>
<a name="l04977"></a>04977 <span class="comment">                  ChangeSelectedMapSector( sNewX, sNewY, bZ );</span>
<a name="l04978"></a>04978 <span class="comment">                  fMapScreenBottomDirty = TRUE;</span>
<a name="l04979"></a>04979 <span class="comment">            }</span>
<a name="l04980"></a>04980 <span class="comment">      }</span>
<a name="l04981"></a>04981 <span class="comment"></span>
<a name="l04982"></a>04982 <span class="comment">      return;</span>
<a name="l04983"></a>04983 <span class="comment">}</span>
<a name="l04984"></a>04984 <span class="comment"></span>
<a name="l04985"></a>04985 <span class="comment"></span>
<a name="l04986"></a>04986 <span class="comment">UINT8 NumFriendlyInSector( INT16 sX, INT16 sY, INT8 bZ )</span>
<a name="l04987"></a>04987 <span class="comment">{</span>
<a name="l04988"></a>04988 <span class="comment">      SOLDIERTYPE *pTeamSoldier;</span>
<a name="l04989"></a>04989 <span class="comment">      INT32                   cnt = 0;</span>
<a name="l04990"></a>04990 <span class="comment">      UINT8                   ubNumFriendlies = 0;</span>
<a name="l04991"></a>04991 <span class="comment"></span>
<a name="l04992"></a>04992 <span class="comment">      // Check if the battle is won!</span>
<a name="l04993"></a>04993 <span class="comment">      // Loop through all mercs and make go</span>
<a name="l04994"></a>04994 <span class="comment">      for ( pTeamSoldier = Menptr, cnt = 0; cnt &lt; TOTAL_SOLDIERS; pTeamSoldier++, cnt++ )</span>
<a name="l04995"></a>04995 <span class="comment">      {</span>
<a name="l04996"></a>04996 <span class="comment">            if ( pTeamSoldier-&gt;bActive &amp;&amp; pTeamSoldier-&gt;bLife &gt; 0 )</span>
<a name="l04997"></a>04997 <span class="comment">            {</span>
<a name="l04998"></a>04998 <span class="comment">                  if ( (pTeamSoldier-&gt;bSide == gbPlayerNum ) &amp;&amp; ( pTeamSoldier-&gt;sSectorX == sX ) &amp;&amp; ( pTeamSoldier-&gt;sSectorY == sY ) &amp;&amp; ( pTeamSoldier-&gt;bSectorZ == bZ ) )</span>
<a name="l04999"></a>04999 <span class="comment">                  {</span>
<a name="l05000"></a>05000 <span class="comment">                        ubNumFriendlies++;</span>
<a name="l05001"></a>05001 <span class="comment">                  }</span>
<a name="l05002"></a>05002 <span class="comment">            }</span>
<a name="l05003"></a>05003 <span class="comment">      }</span>
<a name="l05004"></a>05004 <span class="comment"></span>
<a name="l05005"></a>05005 <span class="comment">      return( ubNumFriendlies );</span>
<a name="l05006"></a>05006 <span class="comment"></span>
<a name="l05007"></a>05007 <span class="comment">}</span>
<a name="l05008"></a>05008 <span class="comment">*/</span>
<a name="l05009"></a>05009 
<a name="l05010"></a>05010 
<a name="l05011"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#a2b814c619f3ece524ede8e4345c28a7">05011</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#a2b814c619f3ece524ede8e4345c28a7">DisplayLevelString</a>( <span class="keywordtype">void</span> )
<a name="l05012"></a>05012 {
<a name="l05013"></a>05013       <a class="code" href="Types_8h.html#fcdf88c1d4179fcd6d8a1fa9bbcb8a80">CHAR16</a> sString[ 32 ];
<a name="l05014"></a>05014 
<a name="l05015"></a>05015       <span class="comment">// given the current level being displayed on the map, show a sub level message</span>
<a name="l05016"></a>05016 
<a name="l05017"></a>05017       <span class="comment">// at the surface</span>
<a name="l05018"></a>05018       <span class="keywordflow">if</span>( !<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b52d71b8f7dc10a22568eb52e0c51a3e">iCurrentMapSectorZ</a> )
<a name="l05019"></a>05019       {
<a name="l05020"></a>05020             <span class="keywordflow">return</span>;
<a name="l05021"></a>05021       }
<a name="l05022"></a>05022 
<a name="l05023"></a>05023       <span class="comment">// otherwise we will have to display the string with the level number</span>
<a name="l05024"></a>05024 
<a name="l05025"></a>05025       <a class="code" href="Font_8cpp.html#a038a1dc2edfc9f9c0766a0cbde2f440">SetFontDestBuffer</a>( <a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a>, MAP_VIEW_START_X, MAP_VIEW_START_Y, MAP_VIEW_START_X+MAP_VIEW_WIDTH+MAP_GRID_X, MAP_VIEW_START_Y+MAP_VIEW_HEIGHT+7, FALSE );
<a name="l05026"></a>05026 
<a name="l05027"></a>05027       <a class="code" href="Font_8cpp.html#fa4871009f0473cca0380217753947dc">SetFont</a>( MAP_FONT );
<a name="l05028"></a>05028       <a class="code" href="Font_8cpp.html#388be5810478c3f3bdb861f144085d70">SetFontForeground</a>( MAP_INDEX_COLOR );
<a name="l05029"></a>05029       <a class="code" href="Font_8cpp.html#a1fe8cc526be9e2c96b5dd66e348506f">SetFontBackground</a>( FONT_BLACK );
<a name="l05030"></a>05030       swprintf( sString, L<span class="stringliteral">"%s %d"</span>, <a class="code" href="__DutchText_8cpp.html#95e34df732ac18054c082e3c349f6762">sMapLevelString</a>[ 0 ], <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b52d71b8f7dc10a22568eb52e0c51a3e">iCurrentMapSectorZ</a> );
<a name="l05031"></a>05031       
<a name="l05032"></a>05032       <span class="comment">// WANNE 2</span>
<a name="l05033"></a>05033       <a class="code" href="Font_8cpp.html#b3e12cf19a0ca58abf6689cc8eca3ead">mprintf</a>(  MAP_LEVEL_STRING_X, MAP_LEVEL_STRING_Y, sString  );
<a name="l05034"></a>05034 
<a name="l05035"></a>05035       <a class="code" href="Font_8cpp.html#a038a1dc2edfc9f9c0766a0cbde2f440">SetFontDestBuffer</a>( FRAME_BUFFER, 0, 0, <a class="code" href="local_8h.html#599adbe412c60e0cc5abb86be7ee4507">SCREEN_WIDTH</a>, <a class="code" href="local_8h.html#f1c710caf1e3a9e81829078054e83799">SCREEN_HEIGHT</a>, FALSE );
<a name="l05036"></a>05036 
<a name="l05037"></a>05037       <span class="keywordflow">return</span>;
<a name="l05038"></a>05038 }
<a name="l05039"></a>05039 
<a name="l05040"></a>05040 
<a name="l05041"></a>05041 <span class="comment">// function to manipulate the number of towns people on the cursor</span>
<a name="l05042"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#23e01260f43200d3c0e8b371128b6573">05042</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#23e01260f43200d3c0e8b371128b6573">PickUpATownPersonFromSector</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubType, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sY )
<a name="l05043"></a>05043 {
<a name="l05044"></a>05044 
<a name="l05045"></a>05045       
<a name="l05046"></a>05046 
<a name="l05047"></a>05047       <span class="comment">// see if there are any militia of this type in this sector</span>
<a name="l05048"></a>05048       <span class="keywordflow">if</span>( !<a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ SECTOR( sX, sY ) ].ubNumberOfCivsAtLevel[ ubType ] )
<a name="l05049"></a>05049       {
<a name="l05050"></a>05050             <span class="comment">// failed, no one here</span>
<a name="l05051"></a>05051             <span class="keywordflow">return</span>( FALSE );
<a name="l05052"></a>05052       }
<a name="l05053"></a>05053 
<a name="l05054"></a>05054       <span class="comment">// are they in the same town as they were pickedup from</span>
<a name="l05055"></a>05055       <span class="keywordflow">if</span>( <a class="code" href="strategicmap_8cpp.html#99dffd29ea4571bc0c833d45636f1403">GetTownIdForSector</a>( sX, sY ) != <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#51cc0335bcdf1be08103f8d3ab7cf85c">sSelectedMilitiaTown</a> )
<a name="l05056"></a>05056       {
<a name="l05057"></a>05057             <span class="keywordflow">return</span>( FALSE );
<a name="l05058"></a>05058       }
<a name="l05059"></a>05059 
<a name="l05060"></a>05060       <span class="keywordflow">if</span>( !<a class="code" href="Town_01Militia_8cpp.html#01dd2be30e6898d4dcce7f876a11bee6">SectorOursAndPeaceful</a>( sX, sY, 0 ) )
<a name="l05061"></a>05061       {
<a name="l05062"></a>05062             <span class="keywordflow">return</span>( FALSE );
<a name="l05063"></a>05063       }
<a name="l05064"></a>05064 
<a name="l05065"></a>05065       <span class="keywordflow">if</span>( SECTOR( sX, sY ) == SECTOR( <a class="code" href="strategicmap_8cpp.html#49d9aed144a633fda4ba1990f002d703">gWorldSectorX</a>, <a class="code" href="strategicmap_8cpp.html#ea322310ced0e35ee18a2ee7b32aac5b">gWorldSectorY</a> ) )
<a name="l05066"></a>05066       {
<a name="l05067"></a>05067             <a class="code" href="Militia_01Control_8cpp.html#8aeca7bf7233528d93298fc3b2202f0c">gfStrategicMilitiaChangesMade</a> = TRUE;
<a name="l05068"></a>05068       }
<a name="l05069"></a>05069 
<a name="l05070"></a>05070       <span class="comment">// otherwise pick this guy up</span>
<a name="l05071"></a>05071       <span class="keywordflow">switch</span>( ubType )
<a name="l05072"></a>05072       {
<a name="l05073"></a>05073             <span class="keywordflow">case</span>( <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840b225c8d872b15875355f348d6e3335b">GREEN_MILITIA</a> ):
<a name="l05074"></a>05074                   <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#713d7ee279b00a3921e5d1d053a28e64">sGreensOnCursor</a>++;
<a name="l05075"></a>05075             <span class="keywordflow">break</span>;
<a name="l05076"></a>05076             <span class="keywordflow">case</span>( <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a845612214b681e2988ea93890806802cc9">REGULAR_MILITIA</a> ):
<a name="l05077"></a>05077                   <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7fa9e1a37309ac744098ba38183ee51d">sRegularsOnCursor</a>++;
<a name="l05078"></a>05078             <span class="keywordflow">break</span>;
<a name="l05079"></a>05079             <span class="keywordflow">case</span>( <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840fcf7fc556b8af2f6d3ec39652d3a927">ELITE_MILITIA</a> ):
<a name="l05080"></a>05080                   <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#799f848c53a7307d2ac4d5e5a22eed20">sElitesOnCursor</a>++;
<a name="l05081"></a>05081             <span class="keywordflow">break</span>;
<a name="l05082"></a>05082       }
<a name="l05083"></a>05083 
<a name="l05084"></a>05084       <span class="comment">// reduce number in this sector</span>
<a name="l05085"></a>05085       <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ SECTOR( sX, sY )].<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ ubType ]--;
<a name="l05086"></a>05086 
<a name="l05087"></a>05087       <a class="code" href="HelpScreen_8cpp.html#be83f0093f2fba05817df5b4592ab0f0">fMapPanelDirty</a> = TRUE;
<a name="l05088"></a>05088 
<a name="l05089"></a>05089       <span class="keywordflow">return</span>( TRUE );
<a name="l05090"></a>05090 }
<a name="l05091"></a>05091 
<a name="l05092"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#a8f7b955862d4588f681d888ec3cbc33">05092</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#a8f7b955862d4588f681d888ec3cbc33">DropAPersonInASector</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubType, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sY )
<a name="l05093"></a>05093 {
<a name="l05094"></a>05094       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iMaxMilitiaPerSector = <a class="code" href="GameSettings_8cpp.html#5c32f930e2fef384505c4b91803a92c2">gGameExternalOptions</a>.<a class="code" href="structGAME__EXTERNAL__OPTIONS.html#9db98fdba0ff76f98649cc6c3ded3392">iMaxMilitiaPerSector</a>;
<a name="l05095"></a>05095 DebugMsg (<a class="code" href="DEBUG_8cpp.html#a7985c2fd033797fc67a03b2c26e07c6">TOPIC_JA2</a>,DBG_LEVEL_3,<span class="stringliteral">"Map Screen2"</span>);
<a name="l05096"></a>05096       <span class="comment">// are they in the same town as they were pickedup from</span>
<a name="l05097"></a>05097       <span class="keywordflow">if</span>( <a class="code" href="strategicmap_8cpp.html#99dffd29ea4571bc0c833d45636f1403">GetTownIdForSector</a>( sX, sY ) != <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#51cc0335bcdf1be08103f8d3ab7cf85c">sSelectedMilitiaTown</a> )
<a name="l05098"></a>05098       {
<a name="l05099"></a>05099             <span class="keywordflow">return</span>( FALSE );
<a name="l05100"></a>05100       }
<a name="l05101"></a>05101 
<a name="l05102"></a>05102       <span class="keywordflow">if</span>( <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ SECTOR( sX, sY )].ubNumberOfCivsAtLevel[ <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840b225c8d872b15875355f348d6e3335b">GREEN_MILITIA</a> ] +  <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ SECTOR( sX, sY )].ubNumberOfCivsAtLevel[ <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a845612214b681e2988ea93890806802cc9">REGULAR_MILITIA</a> ] 
<a name="l05103"></a>05103             +  <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ SECTOR( sX, sY )].ubNumberOfCivsAtLevel[ <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840fcf7fc556b8af2f6d3ec39652d3a927">ELITE_MILITIA</a> ] &gt;= iMaxMilitiaPerSector )
<a name="l05104"></a>05104       {
<a name="l05105"></a>05105             <span class="keywordflow">return</span>( FALSE );
<a name="l05106"></a>05106       }
<a name="l05107"></a>05107 
<a name="l05108"></a>05108       <span class="keywordflow">if</span>( !<a class="code" href="Town_01Militia_8cpp.html#01dd2be30e6898d4dcce7f876a11bee6">SectorOursAndPeaceful</a>(sX, sY, 0 ) )
<a name="l05109"></a>05109       {
<a name="l05110"></a>05110             <span class="keywordflow">return</span>( FALSE );
<a name="l05111"></a>05111       }
<a name="l05112"></a>05112 
<a name="l05113"></a>05113       <span class="keywordflow">if</span>( SECTOR( sX, sY ) == SECTOR( <a class="code" href="strategicmap_8cpp.html#49d9aed144a633fda4ba1990f002d703">gWorldSectorX</a>, <a class="code" href="strategicmap_8cpp.html#ea322310ced0e35ee18a2ee7b32aac5b">gWorldSectorY</a> ) )
<a name="l05114"></a>05114       {
<a name="l05115"></a>05115             <a class="code" href="Militia_01Control_8cpp.html#8aeca7bf7233528d93298fc3b2202f0c">gfStrategicMilitiaChangesMade</a> = TRUE;
<a name="l05116"></a>05116       }
<a name="l05117"></a>05117 
<a name="l05118"></a>05118       <span class="comment">// drop the guy into this sector</span>
<a name="l05119"></a>05119       <span class="keywordflow">switch</span>( ubType )
<a name="l05120"></a>05120       {
<a name="l05121"></a>05121             <span class="keywordflow">case</span>( <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840b225c8d872b15875355f348d6e3335b">GREEN_MILITIA</a> ):
<a name="l05122"></a>05122                   
<a name="l05123"></a>05123                   <span class="keywordflow">if</span>( !<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#713d7ee279b00a3921e5d1d053a28e64">sGreensOnCursor</a> )
<a name="l05124"></a>05124                   {
<a name="l05125"></a>05125                         <span class="keywordflow">return</span>( FALSE );
<a name="l05126"></a>05126                   }
<a name="l05127"></a>05127 
<a name="l05128"></a>05128                   <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#713d7ee279b00a3921e5d1d053a28e64">sGreensOnCursor</a>--;
<a name="l05129"></a>05129             <span class="keywordflow">break</span>;
<a name="l05130"></a>05130             <span class="keywordflow">case</span>( <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a845612214b681e2988ea93890806802cc9">REGULAR_MILITIA</a> ):
<a name="l05131"></a>05131                   <span class="keywordflow">if</span>( !<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7fa9e1a37309ac744098ba38183ee51d">sRegularsOnCursor</a> )
<a name="l05132"></a>05132                   {
<a name="l05133"></a>05133                         <span class="keywordflow">return</span>( FALSE );
<a name="l05134"></a>05134                   }
<a name="l05135"></a>05135                   <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7fa9e1a37309ac744098ba38183ee51d">sRegularsOnCursor</a>--;
<a name="l05136"></a>05136             <span class="keywordflow">break</span>;
<a name="l05137"></a>05137             <span class="keywordflow">case</span>( <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840fcf7fc556b8af2f6d3ec39652d3a927">ELITE_MILITIA</a> ):
<a name="l05138"></a>05138                   <span class="keywordflow">if</span>( !<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#799f848c53a7307d2ac4d5e5a22eed20">sElitesOnCursor</a> )
<a name="l05139"></a>05139                   {
<a name="l05140"></a>05140                         <span class="keywordflow">return</span>( FALSE );
<a name="l05141"></a>05141                   }
<a name="l05142"></a>05142 
<a name="l05143"></a>05143                   <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#799f848c53a7307d2ac4d5e5a22eed20">sElitesOnCursor</a>--;
<a name="l05144"></a>05144             <span class="keywordflow">break</span>;
<a name="l05145"></a>05145       }
<a name="l05146"></a>05146 
<a name="l05147"></a>05147       <span class="comment">// up the number in this sector of this type of militia</span>
<a name="l05148"></a>05148       <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ SECTOR( sX, sY )].<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ ubType ]++;
<a name="l05149"></a>05149 
<a name="l05150"></a>05150       <a class="code" href="HelpScreen_8cpp.html#be83f0093f2fba05817df5b4592ab0f0">fMapPanelDirty</a> = TRUE;
<a name="l05151"></a>05151 
<a name="l05152"></a>05152       <span class="keywordflow">return</span>( TRUE );
<a name="l05153"></a>05153 }
<a name="l05154"></a>05154 
<a name="l05155"></a>05155 
<a name="l05156"></a>05156 
<a name="l05157"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#b2d5078cced1d6461725be874868fbc1">05157</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b2d5078cced1d6461725be874868fbc1">LoadMilitiaPopUpBox</a>( <span class="keywordtype">void</span> )
<a name="l05158"></a>05158 {
<a name="l05159"></a>05159       <a class="code" href="structVOBJECT__DESC.html">VOBJECT_DESC</a>     VObjectDesc; 
<a name="l05160"></a>05160 
<a name="l05161"></a>05161       <span class="comment">// load the militia pop up box </span>
<a name="l05162"></a>05162       VObjectDesc.<a class="code" href="structVOBJECT__DESC.html#2df21c3aa88a0442d5d81b021fa15bf4">fCreateFlags</a>=VOBJECT_CREATE_FROMFILE;
<a name="l05163"></a>05163       <a class="code" href="Utilities_8cpp.html#a5e70f75b6f0518668a489ce02e007b7">FilenameForBPP</a>(<span class="stringliteral">"INTERFACE\\Militia.sti"</span>, VObjectDesc.<a class="code" href="structVOBJECT__DESC.html#6dbe3d70c19525e407a05e537cfb22f3">ImageFile</a>);
<a name="l05164"></a>05164       CHECKF(AddVideoObject(&amp;VObjectDesc, &amp;<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#dfe6a9ceaeceac0ea98a35881f42ad74">guiMilitia</a>));
<a name="l05165"></a>05165       
<a name="l05166"></a>05166       VObjectDesc.<a class="code" href="structVOBJECT__DESC.html#2df21c3aa88a0442d5d81b021fa15bf4">fCreateFlags</a>=VOBJECT_CREATE_FROMFILE;
<a name="l05167"></a>05167       <a class="code" href="Utilities_8cpp.html#a5e70f75b6f0518668a489ce02e007b7">FilenameForBPP</a>(<span class="stringliteral">"INTERFACE\\Militiamaps.sti"</span>, VObjectDesc.<a class="code" href="structVOBJECT__DESC.html#6dbe3d70c19525e407a05e537cfb22f3">ImageFile</a>);
<a name="l05168"></a>05168       CHECKF(AddVideoObject(&amp;VObjectDesc, &amp;<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#19267431b45f7347462c3b71490bf9ff">guiMilitiaMaps</a>));
<a name="l05169"></a>05169             
<a name="l05170"></a>05170       VObjectDesc.<a class="code" href="structVOBJECT__DESC.html#2df21c3aa88a0442d5d81b021fa15bf4">fCreateFlags</a>=VOBJECT_CREATE_FROMFILE;
<a name="l05171"></a>05171       <a class="code" href="Utilities_8cpp.html#a5e70f75b6f0518668a489ce02e007b7">FilenameForBPP</a>(<span class="stringliteral">"INTERFACE\\MilitiamapsectorOutline2.sti"</span>, VObjectDesc.<a class="code" href="structVOBJECT__DESC.html#6dbe3d70c19525e407a05e537cfb22f3">ImageFile</a>);
<a name="l05172"></a>05172       CHECKF(AddVideoObject(&amp;VObjectDesc, &amp;<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#be7e16fc73d9eae466a9ea48d96f0f77">guiMilitiaSectorHighLight</a>));
<a name="l05173"></a>05173       
<a name="l05174"></a>05174       VObjectDesc.<a class="code" href="structVOBJECT__DESC.html#2df21c3aa88a0442d5d81b021fa15bf4">fCreateFlags</a>=VOBJECT_CREATE_FROMFILE;
<a name="l05175"></a>05175       <a class="code" href="Utilities_8cpp.html#a5e70f75b6f0518668a489ce02e007b7">FilenameForBPP</a>(<span class="stringliteral">"INTERFACE\\MilitiamapsectorOutline.sti"</span>, VObjectDesc.<a class="code" href="structVOBJECT__DESC.html#6dbe3d70c19525e407a05e537cfb22f3">ImageFile</a>);
<a name="l05176"></a>05176       CHECKF(AddVideoObject(&amp;VObjectDesc, &amp;<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#a1a2213403db401110d96d3d7900cc81">guiMilitiaSectorOutline</a> ));
<a name="l05177"></a>05177 
<a name="l05178"></a>05178       <span class="keywordflow">return</span>( TRUE );
<a name="l05179"></a>05179 }
<a name="l05180"></a>05180 
<a name="l05181"></a>05181 
<a name="l05182"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#fb88d2402750ad22908d3c0230ea0460">05182</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#fb88d2402750ad22908d3c0230ea0460">RemoveMilitiaPopUpBox</a>( <span class="keywordtype">void</span> )
<a name="l05183"></a>05183 {
<a name="l05184"></a>05184       <span class="comment">// delete the militia pop up box graphic </span>
<a name="l05185"></a>05185       <a class="code" href="vobject_8cpp.html#94715e750fad7cebd3d9d388cdff59e2">DeleteVideoObjectFromIndex</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#dfe6a9ceaeceac0ea98a35881f42ad74">guiMilitia</a> );
<a name="l05186"></a>05186       <a class="code" href="vobject_8cpp.html#94715e750fad7cebd3d9d388cdff59e2">DeleteVideoObjectFromIndex</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#19267431b45f7347462c3b71490bf9ff">guiMilitiaMaps</a> );
<a name="l05187"></a>05187       <a class="code" href="vobject_8cpp.html#94715e750fad7cebd3d9d388cdff59e2">DeleteVideoObjectFromIndex</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#be7e16fc73d9eae466a9ea48d96f0f77">guiMilitiaSectorHighLight</a> );
<a name="l05188"></a>05188       <a class="code" href="vobject_8cpp.html#94715e750fad7cebd3d9d388cdff59e2">DeleteVideoObjectFromIndex</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#a1a2213403db401110d96d3d7900cc81">guiMilitiaSectorOutline</a> );
<a name="l05189"></a>05189 
<a name="l05190"></a>05190       <span class="keywordflow">return</span>;
<a name="l05191"></a>05191 }
<a name="l05192"></a>05192 
<a name="l05193"></a>05193 
<a name="l05194"></a>05194 
<a name="l05195"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#09cea19b5338caf9d0b954756ac83db3">05195</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#09cea19b5338caf9d0b954756ac83db3">DrawMilitiaPopUpBox</a>( <span class="keywordtype">void</span> )
<a name="l05196"></a>05196 {
<a name="l05197"></a>05197       <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a>                                  hVObject; 
<a name="l05198"></a>05198       <a class="code" href="structtagETRLEObject.html">ETRLEObject</a>                               *pTrav;
<a name="l05199"></a>05199 
<a name="l05200"></a>05200 
<a name="l05201"></a>05201       <span class="keywordflow">if</span>( !<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#046cad083db131ea9be5f91417b1f13e">fShowMilitia</a> )
<a name="l05202"></a>05202       {
<a name="l05203"></a>05203             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#51cc0335bcdf1be08103f8d3ab7cf85c">sSelectedMilitiaTown</a> = 0;
<a name="l05204"></a>05204       }
<a name="l05205"></a>05205 
<a name="l05206"></a>05206       <span class="comment">// create buttons</span>
<a name="l05207"></a>05207       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#2c4a43b594c211ffa08286cd50306fb2">CreateDestroyMilitiaSectorButtons</a>( );
<a name="l05208"></a>05208 
<a name="l05209"></a>05209       <span class="comment">// create mouse regions if we need to</span>
<a name="l05210"></a>05210       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7363066baf10743d530e2555d3da5ab9">CreateDestroyMilitiaPopUPRegions</a>( );
<a name="l05211"></a>05211 
<a name="l05212"></a>05212       <span class="keywordflow">if</span>( !<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#51cc0335bcdf1be08103f8d3ab7cf85c">sSelectedMilitiaTown</a> )
<a name="l05213"></a>05213       {
<a name="l05214"></a>05214             <span class="keywordflow">return</span>( FALSE );
<a name="l05215"></a>05215       }
<a name="l05216"></a>05216 
<a name="l05217"></a>05217       <span class="comment">// update states of militia selected sector buttons</span>
<a name="l05218"></a>05218       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#78743cd898c9f4452998f8dde7e19777">CheckAndUpdateStatesOfSelectedMilitiaSectorButtons</a>( );
<a name="l05219"></a>05219 
<a name="l05220"></a>05220       <span class="comment">// get the properties of the militia object</span>
<a name="l05221"></a>05221       <a class="code" href="vobject_8cpp.html#bda2b0eae4cb40e612dffd307ad5c692">GetVideoObject</a>( &amp;hVObject, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#dfe6a9ceaeceac0ea98a35881f42ad74">guiMilitia</a> );
<a name="l05222"></a>05222 
<a name="l05223"></a>05223       <a class="code" href="vobject_8cpp.html#8a5b07441769401593743b9f52a9e353">BltVideoObject</a>( FRAME_BUFFER, hVObject, 0, MAP_MILITIA_BOX_POS_X, MAP_MILITIA_BOX_POS_Y, VO_BLT_SRCTRANSPARENCY, NULL );
<a name="l05224"></a>05224 
<a name="l05225"></a>05225       <a class="code" href="vobject_8cpp.html#bda2b0eae4cb40e612dffd307ad5c692">GetVideoObject</a>( &amp;hVObject, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#19267431b45f7347462c3b71490bf9ff">guiMilitiaMaps</a> );
<a name="l05226"></a>05226       <a class="code" href="vobject_8cpp.html#8a5b07441769401593743b9f52a9e353">BltVideoObject</a>( FRAME_BUFFER, hVObject, ( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> )( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#51cc0335bcdf1be08103f8d3ab7cf85c">sSelectedMilitiaTown</a> - 1 ), MAP_MILITIA_BOX_POS_X + MAP_MILITIA_MAP_X, MAP_MILITIA_BOX_POS_Y + MAP_MILITIA_MAP_Y, VO_BLT_SRCTRANSPARENCY, NULL );
<a name="l05227"></a>05227 
<a name="l05228"></a>05228       <span class="comment">// set font color for labels and "total militia" counts</span>
<a name="l05229"></a>05229       <a class="code" href="Font_8cpp.html#388be5810478c3f3bdb861f144085d70">SetFontForeground</a>(FONT_WHITE);
<a name="l05230"></a>05230 
<a name="l05231"></a>05231       <span class="comment">// draw name of town, and the "unassigned" label</span>
<a name="l05232"></a>05232       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e947c35884afc3a01fb737dc7291e41b">DrawTownMilitiaName</a>( );
<a name="l05233"></a>05233 
<a name="l05234"></a>05234       <span class="comment">// render the icons for each sector in the town</span>
<a name="l05235"></a>05235       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ccf4a7b0095e340410e688a9805c5fd9">RenderIconsPerSectorForSelectedTown</a>( );
<a name="l05236"></a>05236 
<a name="l05237"></a>05237       <span class="comment">// shade any sectors not under our control</span>
<a name="l05238"></a>05238       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e13c65bca2c5d267ac0f557b5b8df1fe">RenderShadingForUnControlledSectors</a>( );
<a name="l05239"></a>05239 
<a name="l05240"></a>05240       <span class="comment">// display anyone picked up</span>
<a name="l05241"></a>05241       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#cf54f85153bfbb83365f08465484a702">DisplayUnallocatedMilitia</a>( );
<a name="l05242"></a>05242 
<a name="l05243"></a>05243       <span class="comment">// draw the highlight last</span>
<a name="l05244"></a>05244       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#2daeb6639903fdcb896ee82f5df50473">ShowHighLightedSectorOnMilitiaMap</a>( );
<a name="l05245"></a>05245 
<a name="l05246"></a>05246       <a class="code" href="vobject_8cpp.html#bda2b0eae4cb40e612dffd307ad5c692">GetVideoObject</a>( &amp;hVObject, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#dfe6a9ceaeceac0ea98a35881f42ad74">guiMilitia</a> );
<a name="l05247"></a>05247       pTrav = &amp;(hVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ 0 ] );
<a name="l05248"></a>05248 
<a name="l05249"></a>05249       <a class="code" href="video_8cpp.html#4ed7790da612ff97bf9c05cf186823bc">InvalidateRegion</a>( MAP_MILITIA_BOX_POS_X, MAP_MILITIA_BOX_POS_Y, MAP_MILITIA_BOX_POS_X + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>, MAP_MILITIA_BOX_POS_Y + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a> );
<a name="l05250"></a>05250       
<a name="l05251"></a>05251       <span class="comment">// set the text for the militia map sector info buttons</span>
<a name="l05252"></a>05252       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#187439bdf35f1202e2c721e7240ab819">SetMilitiaMapButtonsText</a>( );
<a name="l05253"></a>05253 
<a name="l05254"></a>05254       <span class="comment">// render buttons</span>
<a name="l05255"></a>05255       <a class="code" href="Button_01System_8cpp.html#dd66106191abe97a8b80611179ff8996">MarkButtonsDirty</a>( );
<a name="l05256"></a>05256       
<a name="l05257"></a>05257       <span class="keywordflow">return</span>( TRUE );
<a name="l05258"></a>05258 }
<a name="l05259"></a>05259 
<a name="l05260"></a>05260 
<a name="l05261"></a>05261 
<a name="l05262"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#7363066baf10743d530e2555d3da5ab9">05262</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7363066baf10743d530e2555d3da5ab9">CreateDestroyMilitiaPopUPRegions</a>( <span class="keywordtype">void</span> )
<a name="l05263"></a>05263 {
<a name="l05264"></a>05264       <span class="keyword">static</span> <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sOldTown = 0;
<a name="l05265"></a>05265       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iCounter = 0;
<a name="l05266"></a>05266 
<a name="l05267"></a>05267       <span class="comment">// create destroy militia pop up regions for mapscreen militia pop up box</span>
<a name="l05268"></a>05268       <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#51cc0335bcdf1be08103f8d3ab7cf85c">sSelectedMilitiaTown</a> != 0 )
<a name="l05269"></a>05269       {
<a name="l05270"></a>05270             sOldTown = <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#51cc0335bcdf1be08103f8d3ab7cf85c">sSelectedMilitiaTown</a>;
<a name="l05271"></a>05271       }
<a name="l05272"></a>05272 
<a name="l05273"></a>05273       <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#046cad083db131ea9be5f91417b1f13e">fShowMilitia</a> &amp;&amp; <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#51cc0335bcdf1be08103f8d3ab7cf85c">sSelectedMilitiaTown</a> &amp;&amp; !<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#109d718f50d6f84597cf9901b9e20242">gfMilitiaPopupCreated</a> )
<a name="l05274"></a>05274       {
<a name="l05275"></a>05275 
<a name="l05276"></a>05276             <span class="keywordflow">for</span>( iCounter = 0; iCounter &lt; 9; iCounter++ )
<a name="l05277"></a>05277             {
<a name="l05278"></a>05278                   <a class="code" href="mousesystem_8cpp.html#dce08766ef4cbacb9372efe12d26a1e0">MSYS_DefineRegion</a>( &amp;<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#3450c03633f52ecf89373f66563ec030">gMapScreenMilitiaBoxRegions</a>[ iCounter ], ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> ) ( MAP_MILITIA_BOX_POS_X + MAP_MILITIA_MAP_X + ( iCounter % MILITIA_BOX_ROWS ) * MILITIA_BOX_BOX_WIDTH ), ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> )( MAP_MILITIA_BOX_POS_Y + MAP_MILITIA_MAP_Y + ( iCounter / MILITIA_BOX_ROWS ) * MILITIA_BOX_BOX_HEIGHT ), ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> )( MAP_MILITIA_BOX_POS_X + MAP_MILITIA_MAP_X + ( ( ( iCounter  ) % MILITIA_BOX_ROWS ) + 1 ) * MILITIA_BOX_BOX_WIDTH ), ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> )( MAP_MILITIA_BOX_POS_Y + MAP_MILITIA_MAP_Y + ( ( ( iCounter ) / MILITIA_BOX_ROWS ) + 1 ) * MILITIA_BOX_BOX_HEIGHT ), MSYS_PRIORITY_HIGHEST - 3,
<a name="l05279"></a>05279                                            MSYS_NO_CURSOR, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#9fc95eafdd53f3b67ba7cb789156f39f">MilitiaRegionMoveCallback</a>, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#d936244f7cd28e5959c3e1f82dfe8a6c">MilitiaRegionClickCallback</a> ); 
<a name="l05280"></a>05280 
<a name="l05281"></a>05281                   <a class="code" href="mousesystem_8cpp.html#df7126cc1e28adba535e334e406d5c5e">MSYS_SetRegionUserData</a>( &amp;<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#3450c03633f52ecf89373f66563ec030">gMapScreenMilitiaBoxRegions</a>[ iCounter ], 0, iCounter );
<a name="l05282"></a>05282             
<a name="l05283"></a>05283             }
<a name="l05284"></a>05284 
<a name="l05285"></a>05285             <span class="comment">// create militia panel buttons</span>
<a name="l05286"></a>05286             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#f720e46467f59ba82cd575765ad81055">CreateMilitiaPanelBottomButton</a>( );
<a name="l05287"></a>05287 
<a name="l05288"></a>05288 
<a name="l05289"></a>05289             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#109d718f50d6f84597cf9901b9e20242">gfMilitiaPopupCreated</a> = TRUE;
<a name="l05290"></a>05290       }
<a name="l05291"></a>05291       <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#109d718f50d6f84597cf9901b9e20242">gfMilitiaPopupCreated</a>  &amp;&amp; ( !<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#046cad083db131ea9be5f91417b1f13e">fShowMilitia</a> || !<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#51cc0335bcdf1be08103f8d3ab7cf85c">sSelectedMilitiaTown</a> ) )
<a name="l05292"></a>05292       {
<a name="l05293"></a>05293 
<a name="l05294"></a>05294             <span class="keywordflow">for</span>( iCounter = 0; iCounter &lt; 9; iCounter++ )
<a name="l05295"></a>05295             {
<a name="l05296"></a>05296                   <span class="comment">// remove region</span>
<a name="l05297"></a>05297                   <a class="code" href="mousesystem_8cpp.html#f2581a6cadb531c87ebd6b3f5b70f258">MSYS_RemoveRegion</a>( &amp;<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#3450c03633f52ecf89373f66563ec030">gMapScreenMilitiaBoxRegions</a>[ iCounter ] );
<a name="l05298"></a>05298             }
<a name="l05299"></a>05299 
<a name="l05300"></a>05300             <span class="comment">// handle the shutdown of the panel...there maybe people on the cursor, distribute them evenly over all the sectors</span>
<a name="l05301"></a>05301             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#c5b8184ec37de9c65012853728622cb7">HandleShutDownOfMilitiaPanelIfPeopleOnTheCursor</a>( sOldTown );
<a name="l05302"></a>05302 
<a name="l05303"></a>05303             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#4b30437270bc543b63a323145dd2b39c">DeleteMilitiaPanelBottomButton</a>( );
<a name="l05304"></a>05304             
<a name="l05305"></a>05305             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#109d718f50d6f84597cf9901b9e20242">gfMilitiaPopupCreated</a> = FALSE;
<a name="l05306"></a>05306       }
<a name="l05307"></a>05307 
<a name="l05308"></a>05308       <span class="keywordflow">return</span>;
<a name="l05309"></a>05309 }
<a name="l05310"></a>05310 
<a name="l05311"></a>05311 
<a name="l05312"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ccf4a7b0095e340410e688a9805c5fd9">05312</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#ccf4a7b0095e340410e688a9805c5fd9">RenderIconsPerSectorForSelectedTown</a>( <span class="keywordtype">void</span> )
<a name="l05313"></a>05313 {
<a name="l05314"></a>05314       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sBaseSectorValue = 0;
<a name="l05315"></a>05315       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sCurrentSectorValue = 0;
<a name="l05316"></a>05316       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iCounter = 0;
<a name="l05317"></a>05317       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iNumberOfGreens = 0;
<a name="l05318"></a>05318       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iNumberOfRegulars = 0;
<a name="l05319"></a>05319       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iNumberOfElites = 0;
<a name="l05320"></a>05320       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iTotalNumberOfTroops = 0;
<a name="l05321"></a>05321       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iCurrentTroopIcon = 0;
<a name="l05322"></a>05322       <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hVObject; 
<a name="l05323"></a>05323       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iCurrentIcon = 0;
<a name="l05324"></a>05324       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sX, sY;
<a name="l05325"></a>05325       <a class="code" href="Types_8h.html#fcdf88c1d4179fcd6d8a1fa9bbcb8a80">CHAR16</a> sString[ 32 ];
<a name="l05326"></a>05326       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorX = 0, sSectorY = 0;
<a name="l05327"></a>05327 
<a name="l05328"></a>05328 
<a name="l05329"></a>05329       <span class="comment">// get the sector value for the upper left corner</span>
<a name="l05330"></a>05330       sBaseSectorValue = <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#a7689a7ef7f9d17f36e83a8fc26b85c2">GetBaseSectorForCurrentTown</a>( );
<a name="l05331"></a>05331 
<a name="l05332"></a>05332       <span class="comment">// get militia video object</span>
<a name="l05333"></a>05333       <a class="code" href="vobject_8cpp.html#bda2b0eae4cb40e612dffd307ad5c692">GetVideoObject</a>( &amp;hVObject, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#dfe6a9ceaeceac0ea98a35881f42ad74">guiMilitia</a> );
<a name="l05334"></a>05334 
<a name="l05335"></a>05335       <span class="comment">// render icons for map</span>
<a name="l05336"></a>05336       <span class="keywordflow">for</span>( iCounter = 0; iCounter &lt; 9; iCounter++ )
<a name="l05337"></a>05337       {
<a name="l05338"></a>05338             <span class="comment">// grab current sector value</span>
<a name="l05339"></a>05339             sCurrentSectorValue = sBaseSectorValue + ( ( iCounter % MILITIA_BOX_ROWS ) + ( iCounter / MILITIA_BOX_ROWS ) * ( 16 ) );
<a name="l05340"></a>05340 
<a name="l05341"></a>05341             sSectorX = SECTORX( sCurrentSectorValue );
<a name="l05342"></a>05342             sSectorY = SECTORY( sCurrentSectorValue );
<a name="l05343"></a>05343 
<a name="l05344"></a>05344             <span class="comment">// skip sectors not in the selected town (nearby other towns or wilderness SAM Sites)</span>
<a name="l05345"></a>05345             <span class="keywordflow">if</span>( <a class="code" href="strategicmap_8cpp.html#99dffd29ea4571bc0c833d45636f1403">GetTownIdForSector</a>( sSectorX, sSectorY ) != <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#51cc0335bcdf1be08103f8d3ab7cf85c">sSelectedMilitiaTown</a> )
<a name="l05346"></a>05346             {
<a name="l05347"></a>05347                   <span class="keywordflow">continue</span>;
<a name="l05348"></a>05348             }
<a name="l05349"></a>05349 
<a name="l05350"></a>05350             <span class="comment">// get number of each</span>
<a name="l05351"></a>05351             iNumberOfGreens = <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ sCurrentSectorValue ].<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840b225c8d872b15875355f348d6e3335b">GREEN_MILITIA</a> ];
<a name="l05352"></a>05352             iNumberOfRegulars = <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ sCurrentSectorValue ].<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a845612214b681e2988ea93890806802cc9">REGULAR_MILITIA</a> ];
<a name="l05353"></a>05353             iNumberOfElites = <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ sCurrentSectorValue ].<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840fcf7fc556b8af2f6d3ec39652d3a927">ELITE_MILITIA</a> ];
<a name="l05354"></a>05354 
<a name="l05355"></a>05355             <span class="comment">// get total </span>
<a name="l05356"></a>05356             iTotalNumberOfTroops = iNumberOfGreens + iNumberOfRegulars + iNumberOfElites;
<a name="l05357"></a>05357 
<a name="l05358"></a>05358             <span class="comment">// printf number of troops</span>
<a name="l05359"></a>05359             <a class="code" href="Font_8cpp.html#fa4871009f0473cca0380217753947dc">SetFont</a>( FONT10ARIAL );
<a name="l05360"></a>05360             swprintf( sString, L<span class="stringliteral">"%d"</span>, iTotalNumberOfTroops );
<a name="l05361"></a>05361             <a class="code" href="Font_8cpp.html#e07e1d7f30bacf6b7ad052536c569b05">FindFontRightCoordinates</a>( ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> )( MAP_MILITIA_BOX_POS_X + MAP_MILITIA_MAP_X + ( ( iCounter % MILITIA_BOX_ROWS ) * MILITIA_BOX_BOX_WIDTH ) ), ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> ) ( MAP_MILITIA_BOX_POS_Y + MAP_MILITIA_MAP_Y + ( ( iCounter / MILITIA_BOX_ROWS ) * MILITIA_BOX_BOX_HEIGHT ) ),  MILITIA_BOX_BOX_WIDTH, 0, sString, FONT10ARIAL, &amp;sX, &amp;sY ); 
<a name="l05362"></a>05362             
<a name="l05363"></a>05363             <span class="keywordflow">if</span>( <a class="code" href="strategic_8cpp.html#6f48fb0ea28e3d4889423290f1a6ede8">StrategicMap</a>[ SECTOR_INFO_TO_STRATEGIC_INDEX( sCurrentSectorValue ) ].bNameId != <a class="code" href="mapscreen_8h.html#4d1dc70bee62b945929c96dfafebe105d008cfe091b982e6d052565ed0b5acd8">BLANK_SECTOR</a> &amp;&amp;
<a name="l05364"></a>05364                         !<a class="code" href="strategic_8cpp.html#6f48fb0ea28e3d4889423290f1a6ede8">StrategicMap</a>[ SECTOR_INFO_TO_STRATEGIC_INDEX( sCurrentSectorValue ) ].fEnemyControlled )
<a name="l05365"></a>05365             {
<a name="l05366"></a>05366                   <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#9841424d54c5cba5a386f14dfd352b0e">sSectorMilitiaMapSector</a> != iCounter )
<a name="l05367"></a>05367                   {
<a name="l05368"></a>05368                         <a class="code" href="Font_8cpp.html#b3e12cf19a0ca58abf6689cc8eca3ead">mprintf</a>( sX, ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> )( sY + MILITIA_BOX_BOX_HEIGHT - 5), sString );
<a name="l05369"></a>05369                   }
<a name="l05370"></a>05370                   <span class="keywordflow">else</span>
<a name="l05371"></a>05371                   {
<a name="l05372"></a>05372                         <a class="code" href="Font_8cpp.html#b3e12cf19a0ca58abf6689cc8eca3ead">mprintf</a>( sX - 15, ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> )( sY + MILITIA_BOX_BOX_HEIGHT - 5), sString );
<a name="l05373"></a>05373                   }
<a name="l05374"></a>05374             }
<a name="l05375"></a>05375 
<a name="l05376"></a>05376             <span class="comment">// now display</span>
<a name="l05377"></a>05377             <span class="keywordflow">for</span>( iCurrentTroopIcon = 0; iCurrentTroopIcon &lt; iTotalNumberOfTroops; iCurrentTroopIcon++ )
<a name="l05378"></a>05378             {
<a name="l05379"></a>05379                   <span class="comment">// get screen x and y coords</span>
<a name="l05380"></a>05380                   <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#9841424d54c5cba5a386f14dfd352b0e">sSectorMilitiaMapSector</a> == iCounter )
<a name="l05381"></a>05381                   {
<a name="l05382"></a>05382                         sX =  ( iCurrentTroopIcon % POPUP_MILITIA_ICONS_PER_ROW ) * MEDIUM_MILITIA_ICON_SPACING + MAP_MILITIA_BOX_POS_X + MAP_MILITIA_MAP_X + ( ( iCounter % MILITIA_BOX_ROWS ) * MILITIA_BOX_BOX_WIDTH ) + 2;
<a name="l05383"></a>05383                         sY =  ( iCurrentTroopIcon / POPUP_MILITIA_ICONS_PER_ROW ) * ( MEDIUM_MILITIA_ICON_SPACING - 1 ) + MAP_MILITIA_BOX_POS_Y + MAP_MILITIA_MAP_Y + ( ( iCounter / MILITIA_BOX_ROWS ) * MILITIA_BOX_BOX_HEIGHT ) + 3;
<a name="l05384"></a>05384 
<a name="l05385"></a>05385                         <span class="keywordflow">if</span>( iCurrentTroopIcon &lt; iNumberOfGreens )
<a name="l05386"></a>05386                         {
<a name="l05387"></a>05387                               iCurrentIcon = 5;
<a name="l05388"></a>05388                         }
<a name="l05389"></a>05389                         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( iCurrentTroopIcon &lt; iNumberOfGreens + iNumberOfRegulars )
<a name="l05390"></a>05390                         {
<a name="l05391"></a>05391                               iCurrentIcon = 6;
<a name="l05392"></a>05392                         }
<a name="l05393"></a>05393                         <span class="keywordflow">else</span>
<a name="l05394"></a>05394                         {
<a name="l05395"></a>05395                               iCurrentIcon = 7;
<a name="l05396"></a>05396                         }
<a name="l05397"></a>05397                   }
<a name="l05398"></a>05398                   <span class="keywordflow">else</span>
<a name="l05399"></a>05399                   {
<a name="l05400"></a>05400                         sX =  ( iCurrentTroopIcon % POPUP_MILITIA_ICONS_PER_ROW ) * MEDIUM_MILITIA_ICON_SPACING + MAP_MILITIA_BOX_POS_X + MAP_MILITIA_MAP_X + ( ( iCounter % MILITIA_BOX_ROWS ) * MILITIA_BOX_BOX_WIDTH ) + 3;
<a name="l05401"></a>05401                         sY =  ( iCurrentTroopIcon / POPUP_MILITIA_ICONS_PER_ROW ) * ( MEDIUM_MILITIA_ICON_SPACING ) + MAP_MILITIA_BOX_POS_Y + MAP_MILITIA_MAP_Y + ( ( iCounter / MILITIA_BOX_ROWS ) * MILITIA_BOX_BOX_HEIGHT ) + 3;
<a name="l05402"></a>05402 
<a name="l05403"></a>05403                         <span class="keywordflow">if</span>( iCurrentTroopIcon &lt; iNumberOfGreens )
<a name="l05404"></a>05404                         {
<a name="l05405"></a>05405                               iCurrentIcon = 8;
<a name="l05406"></a>05406                         }
<a name="l05407"></a>05407                         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( iCurrentTroopIcon &lt; iNumberOfGreens + iNumberOfRegulars )
<a name="l05408"></a>05408                         {
<a name="l05409"></a>05409                               iCurrentIcon = 9;
<a name="l05410"></a>05410                         }
<a name="l05411"></a>05411                         <span class="keywordflow">else</span>
<a name="l05412"></a>05412                         {
<a name="l05413"></a>05413                               iCurrentIcon = 10;
<a name="l05414"></a>05414                         }
<a name="l05415"></a>05415                   }
<a name="l05416"></a>05416 
<a name="l05417"></a>05417                   <a class="code" href="vobject_8cpp.html#8a5b07441769401593743b9f52a9e353">BltVideoObject</a>( FRAME_BUFFER, hVObject, ( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> )( iCurrentIcon ), sX, sY, VO_BLT_SRCTRANSPARENCY, NULL );
<a name="l05418"></a>05418             }
<a name="l05419"></a>05419 
<a name="l05420"></a>05420       }
<a name="l05421"></a>05421 
<a name="l05422"></a>05422       <span class="keywordflow">return</span>;
<a name="l05423"></a>05423 }
<a name="l05424"></a>05424 
<a name="l05425"></a>05425 
<a name="l05426"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#a7689a7ef7f9d17f36e83a8fc26b85c2">05426</a> <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#a7689a7ef7f9d17f36e83a8fc26b85c2">GetBaseSectorForCurrentTown</a>( <span class="keywordtype">void</span> )
<a name="l05427"></a>05427 {
<a name="l05428"></a>05428       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sBaseSector = 0;
<a name="l05429"></a>05429 
<a name="l05430"></a>05430       <span class="comment">// is the current town</span>
<a name="l05431"></a>05431       <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#51cc0335bcdf1be08103f8d3ab7cf85c">sSelectedMilitiaTown</a> != 0 )
<a name="l05432"></a>05432       {
<a name="l05433"></a>05433             sBaseSector = <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0e13acff97778b5e62d21d90dca2f3dc">sBaseSectorList</a>[ ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> )( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#51cc0335bcdf1be08103f8d3ab7cf85c">sSelectedMilitiaTown</a> - 1 ) ];
<a name="l05434"></a>05434       }
<a name="l05435"></a>05435 
<a name="l05436"></a>05436       <span class="comment">// return the current sector value</span>
<a name="l05437"></a>05437       <span class="keywordflow">return</span>( sBaseSector );
<a name="l05438"></a>05438 }
<a name="l05439"></a>05439 
<a name="l05440"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#2daeb6639903fdcb896ee82f5df50473">05440</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#2daeb6639903fdcb896ee82f5df50473">ShowHighLightedSectorOnMilitiaMap</a>( <span class="keywordtype">void</span> )
<a name="l05441"></a>05441 {
<a name="l05442"></a>05442       <span class="comment">// show the highlighted sector on the militia map</span>
<a name="l05443"></a>05443       <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hVObject; 
<a name="l05444"></a>05444       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sX = 0, sY = 0;
<a name="l05445"></a>05445 
<a name="l05446"></a>05446 
<a name="l05447"></a>05447 
<a name="l05448"></a>05448       <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#9841424d54c5cba5a386f14dfd352b0e">sSectorMilitiaMapSector</a> != -1 )
<a name="l05449"></a>05449       {
<a name="l05450"></a>05450             sX = MAP_MILITIA_BOX_POS_X + MAP_MILITIA_MAP_X + ( ( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#9841424d54c5cba5a386f14dfd352b0e">sSectorMilitiaMapSector</a> % MILITIA_BOX_ROWS ) * MILITIA_BOX_BOX_WIDTH );
<a name="l05451"></a>05451             sY = MAP_MILITIA_BOX_POS_Y + MAP_MILITIA_MAP_Y + ( ( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#9841424d54c5cba5a386f14dfd352b0e">sSectorMilitiaMapSector</a> / MILITIA_BOX_ROWS ) * MILITIA_BOX_BOX_HEIGHT );
<a name="l05452"></a>05452             
<a name="l05453"></a>05453             <span class="comment">// get the object</span>
<a name="l05454"></a>05454             <a class="code" href="vobject_8cpp.html#bda2b0eae4cb40e612dffd307ad5c692">GetVideoObject</a>( &amp;hVObject, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#be7e16fc73d9eae466a9ea48d96f0f77">guiMilitiaSectorHighLight</a> );
<a name="l05455"></a>05455             
<a name="l05456"></a>05456             <span class="comment">// blt the object</span>
<a name="l05457"></a>05457             <a class="code" href="vobject_8cpp.html#8a5b07441769401593743b9f52a9e353">BltVideoObject</a>( FRAME_BUFFER, hVObject, 0, sX, sY, VO_BLT_SRCTRANSPARENCY, NULL );
<a name="l05458"></a>05458       }
<a name="l05459"></a>05459 
<a name="l05460"></a>05460       <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e7bf8d79ef06ab596dc6b91ec970b2c1">sSectorMilitiaMapSectorOutline</a> != -1 )
<a name="l05461"></a>05461       {
<a name="l05462"></a>05462             sX = MAP_MILITIA_BOX_POS_X + MAP_MILITIA_MAP_X + ( ( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e7bf8d79ef06ab596dc6b91ec970b2c1">sSectorMilitiaMapSectorOutline</a> % MILITIA_BOX_ROWS ) * MILITIA_BOX_BOX_WIDTH );
<a name="l05463"></a>05463             sY = MAP_MILITIA_BOX_POS_Y + MAP_MILITIA_MAP_Y + ( ( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e7bf8d79ef06ab596dc6b91ec970b2c1">sSectorMilitiaMapSectorOutline</a> / MILITIA_BOX_ROWS ) * MILITIA_BOX_BOX_HEIGHT );
<a name="l05464"></a>05464             
<a name="l05465"></a>05465             <span class="comment">// get the object</span>
<a name="l05466"></a>05466             <a class="code" href="vobject_8cpp.html#bda2b0eae4cb40e612dffd307ad5c692">GetVideoObject</a>( &amp;hVObject, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#a1a2213403db401110d96d3d7900cc81">guiMilitiaSectorOutline</a> );
<a name="l05467"></a>05467             
<a name="l05468"></a>05468             <span class="comment">// blt the object</span>
<a name="l05469"></a>05469             <a class="code" href="vobject_8cpp.html#8a5b07441769401593743b9f52a9e353">BltVideoObject</a>( FRAME_BUFFER, hVObject, 0, sX, sY, VO_BLT_SRCTRANSPARENCY, NULL );
<a name="l05470"></a>05470       }
<a name="l05471"></a>05471 
<a name="l05472"></a>05472       <span class="keywordflow">return</span>;
<a name="l05473"></a>05473 }
<a name="l05474"></a>05474 
<a name="l05475"></a>05475 
<a name="l05476"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#d936244f7cd28e5959c3e1f82dfe8a6c">05476</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#d936244f7cd28e5959c3e1f82dfe8a6c">MilitiaRegionClickCallback</a>( <a class="code" href="struct__MOUSE__REGION.html">MOUSE_REGION</a> *pRegion, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iReason )
<a name="l05477"></a>05477 {
<a name="l05478"></a>05478       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iValue = 0;
<a name="l05479"></a>05479 
<a name="l05480"></a>05480       iValue = <a class="code" href="mousesystem_8cpp.html#8b64ac2435c69cf4c67ab56af8f5badc">MSYS_GetRegionUserData</a>( pRegion, 0 );
<a name="l05481"></a>05481 
<a name="l05482"></a>05482       <span class="keywordflow">if</span>( ( iReason &amp; MSYS_CALLBACK_REASON_LBUTTON_UP ) )
<a name="l05483"></a>05483       {
<a name="l05484"></a>05484             <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#a6ff6435079dbd77d403864af9a069bc">IsThisMilitiaTownSectorAllowable</a>( (<a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a>)iValue ) )
<a name="l05485"></a>05485             {
<a name="l05486"></a>05486                   <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#9841424d54c5cba5a386f14dfd352b0e">sSectorMilitiaMapSector</a> == (INT16)iValue )
<a name="l05487"></a>05487                   {
<a name="l05488"></a>05488                         <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#9841424d54c5cba5a386f14dfd352b0e">sSectorMilitiaMapSector</a> = -1;
<a name="l05489"></a>05489                   }
<a name="l05490"></a>05490                   <span class="keywordflow">else</span>
<a name="l05491"></a>05491                   {
<a name="l05492"></a>05492                         <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#9841424d54c5cba5a386f14dfd352b0e">sSectorMilitiaMapSector</a> = ( INT16 )iValue;
<a name="l05493"></a>05493                   }
<a name="l05494"></a>05494             }
<a name="l05495"></a>05495             <span class="keywordflow">else</span>
<a name="l05496"></a>05496             {
<a name="l05497"></a>05497                   <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#9841424d54c5cba5a386f14dfd352b0e">sSectorMilitiaMapSector</a> = -1;
<a name="l05498"></a>05498             }
<a name="l05499"></a>05499       }
<a name="l05500"></a>05500 
<a name="l05501"></a>05501       <span class="keywordflow">if</span>( ( iReason &amp; MSYS_CALLBACK_REASON_RBUTTON_UP ) )
<a name="l05502"></a>05502       {
<a name="l05503"></a>05503             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#9841424d54c5cba5a386f14dfd352b0e">sSectorMilitiaMapSector</a> = -1;
<a name="l05504"></a>05504       }
<a name="l05505"></a>05505 }
<a name="l05506"></a>05506 
<a name="l05507"></a>05507 
<a name="l05508"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#9fc95eafdd53f3b67ba7cb789156f39f">05508</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#9fc95eafdd53f3b67ba7cb789156f39f">MilitiaRegionMoveCallback</a>( <a class="code" href="struct__MOUSE__REGION.html">MOUSE_REGION</a> *pRegion, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iReason )
<a name="l05509"></a>05509 {
<a name="l05510"></a>05510       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iValue = 0;
<a name="l05511"></a>05511 
<a name="l05512"></a>05512       iValue = <a class="code" href="mousesystem_8cpp.html#8b64ac2435c69cf4c67ab56af8f5badc">MSYS_GetRegionUserData</a>( pRegion, 0 );
<a name="l05513"></a>05513 
<a name="l05514"></a>05514       <span class="keywordflow">if</span>( ( iReason &amp; MSYS_CALLBACK_REASON_GAIN_MOUSE ) )
<a name="l05515"></a>05515       {
<a name="l05516"></a>05516             <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#a6ff6435079dbd77d403864af9a069bc">IsThisMilitiaTownSectorAllowable</a>( ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> )iValue ) )
<a name="l05517"></a>05517             {
<a name="l05518"></a>05518                   <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e7bf8d79ef06ab596dc6b91ec970b2c1">sSectorMilitiaMapSectorOutline</a> = ( INT16 )iValue; 
<a name="l05519"></a>05519             }
<a name="l05520"></a>05520             <span class="keywordflow">else</span>
<a name="l05521"></a>05521             {
<a name="l05522"></a>05522                   <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e7bf8d79ef06ab596dc6b91ec970b2c1">sSectorMilitiaMapSectorOutline</a> = -1;
<a name="l05523"></a>05523             }
<a name="l05524"></a>05524       }
<a name="l05525"></a>05525       <span class="keywordflow">else</span> <span class="keywordflow">if</span>( iReason &amp; MSYS_CALLBACK_REASON_LOST_MOUSE )
<a name="l05526"></a>05526       {
<a name="l05527"></a>05527             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e7bf8d79ef06ab596dc6b91ec970b2c1">sSectorMilitiaMapSectorOutline</a> = -1;      
<a name="l05528"></a>05528       }
<a name="l05529"></a>05529 }
<a name="l05530"></a>05530 
<a name="l05531"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#2c4a43b594c211ffa08286cd50306fb2">05531</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#2c4a43b594c211ffa08286cd50306fb2">CreateDestroyMilitiaSectorButtons</a>( <span class="keywordtype">void</span> )
<a name="l05532"></a>05532 {
<a name="l05533"></a>05533       <span class="keyword">static</span> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fCreated = FALSE;
<a name="l05534"></a>05534       <span class="keyword">static</span> <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sOldSectorValue = -1;
<a name="l05535"></a>05535       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sX = 0, sY = 0;
<a name="l05536"></a>05536       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iCounter = 0;
<a name="l05537"></a>05537       <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a>                                  hVObject; 
<a name="l05538"></a>05538       <a class="code" href="structtagETRLEObject.html">ETRLEObject</a>                               *pTrav;
<a name="l05539"></a>05539 
<a name="l05540"></a>05540 
<a name="l05541"></a>05541       <span class="keywordflow">if</span>( sOldSectorValue == <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#9841424d54c5cba5a386f14dfd352b0e">sSectorMilitiaMapSector</a> &amp;&amp; <a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#046cad083db131ea9be5f91417b1f13e">fShowMilitia</a> &amp;&amp; <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#51cc0335bcdf1be08103f8d3ab7cf85c">sSelectedMilitiaTown</a> &amp;&amp; !fCreated &amp;&amp; <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#9841424d54c5cba5a386f14dfd352b0e">sSectorMilitiaMapSector</a> != -1 )
<a name="l05542"></a>05542       {
<a name="l05543"></a>05543             fCreated = TRUE;
<a name="l05544"></a>05544 
<a name="l05545"></a>05545             <span class="comment">// given sector..place down the 3 buttons</span>
<a name="l05546"></a>05546 
<a name="l05547"></a>05547             <span class="keywordflow">for</span>( iCounter = 0; iCounter &lt; 3; iCounter++ )
<a name="l05548"></a>05548             {
<a name="l05549"></a>05549 
<a name="l05550"></a>05550                   <span class="comment">// set screen x and y positions</span>
<a name="l05551"></a>05551                   sX = MAP_MILITIA_BOX_POS_X + MAP_MILITIA_MAP_X + ( ( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#9841424d54c5cba5a386f14dfd352b0e">sSectorMilitiaMapSector</a> % MILITIA_BOX_ROWS ) * MILITIA_BOX_BOX_WIDTH );
<a name="l05552"></a>05552                   sY = MAP_MILITIA_BOX_POS_Y + MAP_MILITIA_MAP_Y + ( ( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#9841424d54c5cba5a386f14dfd352b0e">sSectorMilitiaMapSector</a> / MILITIA_BOX_ROWS ) * MILITIA_BOX_BOX_HEIGHT );
<a name="l05553"></a>05553       
<a name="l05554"></a>05554                   <span class="comment">// adjust offsets</span>
<a name="l05555"></a>05555                   sX += MILITIA_BTN_OFFSET_X;
<a name="l05556"></a>05556                   sY += ( iCounter * ( MILITIA_BTN_HEIGHT ) + 2 );
<a name="l05557"></a>05557 
<a name="l05558"></a>05558                   <span class="comment">// set the button image</span>
<a name="l05559"></a>05559                   <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e747867f24c86066723ce3da34a65cd2">giMapMilitiaButtonImage</a>[ iCounter ]=  <a class="code" href="Button_01System_8cpp.html#b0e9fca124dbbab5ea6581af91600feb">LoadButtonImage</a>( <span class="stringliteral">"INTERFACE\\militia.sti"</span> ,-1,3,-1,4,-1 );
<a name="l05560"></a>05560 
<a name="l05561"></a>05561                   <span class="comment">// set the button value</span>
<a name="l05562"></a>05562                   <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0f4a0d61ac6bc0b9edfe8f3df3505031">giMapMilitiaButton</a>[ iCounter ] = <a class="code" href="Button_01System_8cpp.html#0e1355197c21c65bb815d1570751e549">QuickCreateButton</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e747867f24c86066723ce3da34a65cd2">giMapMilitiaButtonImage</a>[ iCounter ], sX, sY,
<a name="l05563"></a>05563                                                             BUTTON_TOGGLE, MSYS_PRIORITY_HIGHEST - 1,
<a name="l05564"></a>05564                                                             <a class="code" href="Button_01System_8cpp.html#333b1eca007f1fd3aa03503181ab8ac6">BtnGenericMouseMoveButtonCallback</a>, (<a class="code" href="Button_01System_8h.html#bd566aec25d6e1a33f91530f21194cf3">GUI_CALLBACK</a>)<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#be1dab9adfc72e6438fef0cd0d1d68f5">MilitiaButtonCallback</a>);
<a name="l05565"></a>05565 
<a name="l05566"></a>05566                   <span class="comment">// set button user data</span>
<a name="l05567"></a>05567                   <a class="code" href="Button_01System_8cpp.html#d3a0665e113d4bd29bf6523c0bad54bb">MSYS_SetBtnUserData</a>(    <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0f4a0d61ac6bc0b9edfe8f3df3505031">giMapMilitiaButton</a>[ iCounter ], 0, iCounter );
<a name="l05568"></a>05568                   <a class="code" href="Button_01System_8cpp.html#46bfaf6f8490cd717f9641deed553d07">SpecifyButtonFont</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0f4a0d61ac6bc0b9edfe8f3df3505031">giMapMilitiaButton</a>[ iCounter ], FONT10ARIAL );
<a name="l05569"></a>05569                   <a class="code" href="Button_01System_8cpp.html#a24be039c1d41a9d9ff4c39d83542195">SpecifyButtonUpTextColors</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0f4a0d61ac6bc0b9edfe8f3df3505031">giMapMilitiaButton</a>[ iCounter ], <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b85e63a0c588a1aaeba5695f01282062">gsMilitiaSectorButtonColors</a>[ iCounter ], FONT_BLACK );
<a name="l05570"></a>05570                   <a class="code" href="Button_01System_8cpp.html#43ca9ffecb20ab2c8b142adfdedf61b6">SpecifyButtonDownTextColors</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0f4a0d61ac6bc0b9edfe8f3df3505031">giMapMilitiaButton</a>[ iCounter ], <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b85e63a0c588a1aaeba5695f01282062">gsMilitiaSectorButtonColors</a>[ iCounter ], FONT_BLACK );
<a name="l05571"></a>05571             
<a name="l05572"></a>05572                   <a class="code" href="vobject_8cpp.html#bda2b0eae4cb40e612dffd307ad5c692">GetVideoObject</a>( &amp;hVObject, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#dfe6a9ceaeceac0ea98a35881f42ad74">guiMilitia</a> );
<a name="l05573"></a>05573                   pTrav = &amp;(hVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ 0 ] );
<a name="l05574"></a>05574       
<a name="l05575"></a>05575                   <a class="code" href="Button_01System_8cpp.html#b0d81634ea4def6619339dd21375ecbe">SetButtonFastHelpText</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0f4a0d61ac6bc0b9edfe8f3df3505031">giMapMilitiaButton</a>[ iCounter ], <a class="code" href="__DutchText_8cpp.html#dbac7abba2644ed81ff0d67c0aee603d">pMilitiaButtonsHelpText</a>[ iCounter ] );
<a name="l05576"></a>05576             
<a name="l05577"></a>05577             
<a name="l05578"></a>05578             } 
<a name="l05579"></a>05579 
<a name="l05580"></a>05580             <span class="comment">// mark here the militia box left click region</span>
<a name="l05581"></a>05581             <span class="comment">//MSYS_DefineRegion( &amp;gMapScreenMilitiaRegion, ( INT16 ) ( MAP_MILITIA_BOX_POS_X ), ( INT16 )( MAP_MILITIA_BOX_POS_Y  ), ( INT16 )( MAP_MILITIA_BOX_POS_X + pTrav-&gt;usWidth ), ( INT16 )( MAP_MILITIA_BOX_POS_Y + pTrav-&gt;usHeight ), MSYS_PRIORITY_HIGHEST - 2,</span>
<a name="l05582"></a>05582                   <span class="comment">//                       MSYS_NO_CURSOR, MilitiaRegionMoveCallback, MilitiaBoxMaskBtnCallback ); </span>
<a name="l05583"></a>05583 
<a name="l05584"></a>05584             <a class="code" href="Map_01Screen_01Interface_8cpp.html#144f18cef1195ff159331ec9f1eba4d4">CreateScreenMaskForMoveBox</a>( );
<a name="l05585"></a>05585 
<a name="l05586"></a>05586             <span class="comment">// ste the fact that the buttons were in fact created</span>
<a name="l05587"></a>05587             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b0091657e8418875491ae952d35663da">fMilitiaMapButtonsCreated</a> = TRUE; 
<a name="l05588"></a>05588       }
<a name="l05589"></a>05589       <span class="keywordflow">else</span> <span class="keywordflow">if</span>( fCreated &amp;&amp; ( sOldSectorValue != <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#9841424d54c5cba5a386f14dfd352b0e">sSectorMilitiaMapSector</a> || !<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#046cad083db131ea9be5f91417b1f13e">fShowMilitia</a> || !<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#51cc0335bcdf1be08103f8d3ab7cf85c">sSelectedMilitiaTown</a> || <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#9841424d54c5cba5a386f14dfd352b0e">sSectorMilitiaMapSector</a> == -1 ) )
<a name="l05590"></a>05590       {
<a name="l05591"></a>05591             sOldSectorValue = <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#9841424d54c5cba5a386f14dfd352b0e">sSectorMilitiaMapSector</a>;
<a name="l05592"></a>05592             fCreated = FALSE;
<a name="l05593"></a>05593 
<a name="l05594"></a>05594             <span class="comment">// the militia box left click region</span>
<a name="l05595"></a>05595       <span class="comment">//    MSYS_RemoveRegion( &amp;gMapScreenMilitiaRegion );</span>
<a name="l05596"></a>05596 
<a name="l05597"></a>05597             <span class="comment">// get rid of the buttons</span>
<a name="l05598"></a>05598             <span class="keywordflow">for</span>( iCounter = 0 ; iCounter &lt; 3; iCounter++ )
<a name="l05599"></a>05599             {
<a name="l05600"></a>05600                   <a class="code" href="Button_01System_8cpp.html#daa181fdf3d05f2242b5d9cbeb91e9bf">RemoveButton</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0f4a0d61ac6bc0b9edfe8f3df3505031">giMapMilitiaButton</a>[ iCounter ] );
<a name="l05601"></a>05601                   <a class="code" href="Button_01System_8cpp.html#97a9df228f6eb3a96d06196263d6dc3a">UnloadButtonImage</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e747867f24c86066723ce3da34a65cd2">giMapMilitiaButtonImage</a>[ iCounter ] );
<a name="l05602"></a>05602             }
<a name="l05603"></a>05603 
<a name="l05604"></a>05604             <span class="keywordflow">if</span>( !<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#046cad083db131ea9be5f91417b1f13e">fShowMilitia</a> || !<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#51cc0335bcdf1be08103f8d3ab7cf85c">sSelectedMilitiaTown</a> )
<a name="l05605"></a>05605             {
<a name="l05606"></a>05606                   <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#9841424d54c5cba5a386f14dfd352b0e">sSectorMilitiaMapSector</a> = -1;
<a name="l05607"></a>05607                   <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#51cc0335bcdf1be08103f8d3ab7cf85c">sSelectedMilitiaTown</a> = 0;
<a name="l05608"></a>05608             }
<a name="l05609"></a>05609 
<a name="l05610"></a>05610             <a class="code" href="Map_01Screen_01Interface_8cpp.html#e86cd148bc4763f0c6b43fb5314cd2b2">RemoveScreenMaskForMoveBox</a>( );
<a name="l05611"></a>05611 
<a name="l05612"></a>05612             <span class="comment">// set the fact that the buttons were destroyed</span>
<a name="l05613"></a>05613             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b0091657e8418875491ae952d35663da">fMilitiaMapButtonsCreated</a> = FALSE;
<a name="l05614"></a>05614       }
<a name="l05615"></a>05615 
<a name="l05616"></a>05616       sOldSectorValue = <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#9841424d54c5cba5a386f14dfd352b0e">sSectorMilitiaMapSector</a>;
<a name="l05617"></a>05617 }
<a name="l05618"></a>05618 
<a name="l05619"></a>05619 
<a name="l05620"></a>05620 
<a name="l05621"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#187439bdf35f1202e2c721e7240ab819">05621</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#187439bdf35f1202e2c721e7240ab819">SetMilitiaMapButtonsText</a>( <span class="keywordtype">void</span> )
<a name="l05622"></a>05622 {
<a name="l05623"></a>05623       <span class="comment">// now set the militia map button text</span>
<a name="l05624"></a>05624       <a class="code" href="Types_8h.html#fcdf88c1d4179fcd6d8a1fa9bbcb8a80">CHAR16</a> sString[ 64 ];
<a name="l05625"></a>05625       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iNumberOfGreens = 0, iNumberOfRegulars = 0, iNumberOfElites = 0;
<a name="l05626"></a>05626       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sBaseSectorValue = 0, sGlobalMapSector = 0;
<a name="l05627"></a>05627 
<a name="l05628"></a>05628       
<a name="l05629"></a>05629       <span class="keywordflow">if</span>( !<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b0091657e8418875491ae952d35663da">fMilitiaMapButtonsCreated</a> )
<a name="l05630"></a>05630       {
<a name="l05631"></a>05631             <span class="keywordflow">return</span>;
<a name="l05632"></a>05632       }
<a name="l05633"></a>05633 
<a name="l05634"></a>05634       <span class="comment">// grab the appropriate global sector value in the world</span>
<a name="l05635"></a>05635       sBaseSectorValue = <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#a7689a7ef7f9d17f36e83a8fc26b85c2">GetBaseSectorForCurrentTown</a>( );
<a name="l05636"></a>05636       sGlobalMapSector = sBaseSectorValue + ( ( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#9841424d54c5cba5a386f14dfd352b0e">sSectorMilitiaMapSector</a> % MILITIA_BOX_ROWS ) + ( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#9841424d54c5cba5a386f14dfd352b0e">sSectorMilitiaMapSector</a> / MILITIA_BOX_ROWS ) * ( 16 ) );
<a name="l05637"></a>05637 
<a name="l05638"></a>05638       iNumberOfGreens =  <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ sGlobalMapSector ].<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840b225c8d872b15875355f348d6e3335b">GREEN_MILITIA</a> ];
<a name="l05639"></a>05639       iNumberOfRegulars = <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ sGlobalMapSector ].<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a845612214b681e2988ea93890806802cc9">REGULAR_MILITIA</a> ];
<a name="l05640"></a>05640       iNumberOfElites = <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ sGlobalMapSector ].<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840fcf7fc556b8af2f6d3ec39652d3a927">ELITE_MILITIA</a> ];
<a name="l05641"></a>05641 
<a name="l05642"></a>05642       <span class="comment">// the greens in this sector</span>
<a name="l05643"></a>05643       swprintf( sString, L<span class="stringliteral">"%d"</span>, iNumberOfGreens );
<a name="l05644"></a>05644       <a class="code" href="Button_01System_8cpp.html#927e98ae8d3535e396faf9ade7f5feb8">SpecifyButtonText</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0f4a0d61ac6bc0b9edfe8f3df3505031">giMapMilitiaButton</a>[ 0 ], sString );
<a name="l05645"></a>05645 
<a name="l05646"></a>05646       <span class="comment">// the regulars in this sector</span>
<a name="l05647"></a>05647       swprintf( sString, L<span class="stringliteral">"%d"</span>, iNumberOfRegulars );
<a name="l05648"></a>05648       <a class="code" href="Button_01System_8cpp.html#927e98ae8d3535e396faf9ade7f5feb8">SpecifyButtonText</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0f4a0d61ac6bc0b9edfe8f3df3505031">giMapMilitiaButton</a>[ 1 ], sString );
<a name="l05649"></a>05649 
<a name="l05650"></a>05650       <span class="comment">// the number of elites in this sector</span>
<a name="l05651"></a>05651       swprintf( sString, L<span class="stringliteral">"%d"</span>, iNumberOfElites );
<a name="l05652"></a>05652       <a class="code" href="Button_01System_8cpp.html#927e98ae8d3535e396faf9ade7f5feb8">SpecifyButtonText</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0f4a0d61ac6bc0b9edfe8f3df3505031">giMapMilitiaButton</a>[ 2 ], sString );
<a name="l05653"></a>05653 
<a name="l05654"></a>05654       <span class="keywordflow">return</span>;
<a name="l05655"></a>05655 }
<a name="l05656"></a>05656 
<a name="l05657"></a>05657 
<a name="l05658"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#be1dab9adfc72e6438fef0cd0d1d68f5">05658</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#be1dab9adfc72e6438fef0cd0d1d68f5">MilitiaButtonCallback</a>(<a class="code" href="struct__GUI__BUTTON.html">GUI_BUTTON</a> *btn,<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> reason)
<a name="l05659"></a>05659 {
<a name="l05660"></a>05660 
<a name="l05661"></a>05661       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sGlobalMapSector = 0;
<a name="l05662"></a>05662       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sBaseSectorValue = 0;
<a name="l05663"></a>05663       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iValue = 0;
<a name="l05664"></a>05664 
<a name="l05665"></a>05665       <span class="comment">// is the button enabled</span>
<a name="l05666"></a>05666       <span class="keywordflow">if</span> (!(btn-&gt;<a class="code" href="struct__GUI__BUTTON.html#1ad6f5c9eb46ea98b25449008c9563d0">uiFlags</a> &amp; BUTTON_ENABLED))
<a name="l05667"></a>05667             <span class="keywordflow">return</span>;
<a name="l05668"></a>05668 
<a name="l05669"></a>05669       <span class="comment">// get the value</span>
<a name="l05670"></a>05670       iValue = <a class="code" href="Button_01System_8cpp.html#82b8ca7efdab9351cde6f80282eca747">MSYS_GetBtnUserData</a>( btn, 0 );
<a name="l05671"></a>05671 
<a name="l05672"></a>05672       <span class="comment">// get the sector value for the upper left corner</span>
<a name="l05673"></a>05673       sBaseSectorValue = <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#a7689a7ef7f9d17f36e83a8fc26b85c2">GetBaseSectorForCurrentTown</a>( );
<a name="l05674"></a>05674       sGlobalMapSector = sBaseSectorValue + ( ( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#9841424d54c5cba5a386f14dfd352b0e">sSectorMilitiaMapSector</a> % MILITIA_BOX_ROWS ) + ( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#9841424d54c5cba5a386f14dfd352b0e">sSectorMilitiaMapSector</a> / MILITIA_BOX_ROWS ) * ( 16 ) );
<a name="l05675"></a>05675 
<a name="l05676"></a>05676 
<a name="l05677"></a>05677       <span class="keywordflow">if</span>(reason &amp; MSYS_CALLBACK_REASON_LBUTTON_DWN )
<a name="l05678"></a>05678       {
<a name="l05679"></a>05679     btn-&gt;<a class="code" href="struct__GUI__BUTTON.html#1ad6f5c9eb46ea98b25449008c9563d0">uiFlags</a>|=(BUTTON_CLICKED_ON);   
<a name="l05680"></a>05680       }
<a name="l05681"></a>05681       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(reason &amp; MSYS_CALLBACK_REASON_LBUTTON_UP )
<a name="l05682"></a>05682       {
<a name="l05683"></a>05683             <span class="keywordflow">if</span>(btn-&gt;<a class="code" href="struct__GUI__BUTTON.html#1ad6f5c9eb46ea98b25449008c9563d0">uiFlags</a> &amp; BUTTON_CLICKED_ON)
<a name="l05684"></a>05684             {
<a name="l05685"></a>05685                   btn-&gt;<a class="code" href="struct__GUI__BUTTON.html#1ad6f5c9eb46ea98b25449008c9563d0">uiFlags</a>&amp;=~(BUTTON_CLICKED_ON);
<a name="l05686"></a>05686                   <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#a8f7b955862d4588f681d888ec3cbc33">DropAPersonInASector</a>( ( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> )( iValue ), ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> )( ( sGlobalMapSector % 16 ) + 1 ), ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> )( ( sGlobalMapSector / 16 ) + 1 )  );
<a name="l05687"></a>05687             }
<a name="l05688"></a>05688       }
<a name="l05689"></a>05689       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(reason &amp; MSYS_CALLBACK_REASON_RBUTTON_DWN )
<a name="l05690"></a>05690       {
<a name="l05691"></a>05691     btn-&gt;<a class="code" href="struct__GUI__BUTTON.html#1ad6f5c9eb46ea98b25449008c9563d0">uiFlags</a>|=(BUTTON_CLICKED_ON);   
<a name="l05692"></a>05692       }
<a name="l05693"></a>05693       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(reason &amp; MSYS_CALLBACK_REASON_RBUTTON_UP )
<a name="l05694"></a>05694       {
<a name="l05695"></a>05695             <span class="keywordflow">if</span>(btn-&gt;<a class="code" href="struct__GUI__BUTTON.html#1ad6f5c9eb46ea98b25449008c9563d0">uiFlags</a> &amp; BUTTON_CLICKED_ON)
<a name="l05696"></a>05696             {
<a name="l05697"></a>05697                   btn-&gt;<a class="code" href="struct__GUI__BUTTON.html#1ad6f5c9eb46ea98b25449008c9563d0">uiFlags</a>&amp;=~(BUTTON_CLICKED_ON);
<a name="l05698"></a>05698                   <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#23e01260f43200d3c0e8b371128b6573">PickUpATownPersonFromSector</a>( ( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> )( iValue ), ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> )( ( sGlobalMapSector % 16 ) + 1 ), ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> )( ( sGlobalMapSector / 16 ) + 1 )  );
<a name="l05699"></a>05699             }
<a name="l05700"></a>05700       }
<a name="l05701"></a>05701 }
<a name="l05702"></a>05702 
<a name="l05703"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#cf54f85153bfbb83365f08465484a702">05703</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#cf54f85153bfbb83365f08465484a702">DisplayUnallocatedMilitia</a>( <span class="keywordtype">void</span> )
<a name="l05704"></a>05704 {
<a name="l05705"></a>05705       <span class="comment">// show the nunber on the cursor</span>
<a name="l05706"></a>05706       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iTotalNumberOfTroops =0, iNumberOfGreens = 0, iNumberOfRegulars =0, iNumberOfElites = 0, iCurrentTroopIcon = 0;
<a name="l05707"></a>05707       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iCurrentIcon = 0;
<a name="l05708"></a>05708       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sX = 0, sY = 0;
<a name="l05709"></a>05709       <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hVObject; 
<a name="l05710"></a>05710 
<a name="l05711"></a>05711       <span class="comment">// get number of each</span>
<a name="l05712"></a>05712       iNumberOfGreens = <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#713d7ee279b00a3921e5d1d053a28e64">sGreensOnCursor</a>;
<a name="l05713"></a>05713       iNumberOfRegulars = <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7fa9e1a37309ac744098ba38183ee51d">sRegularsOnCursor</a>;
<a name="l05714"></a>05714       iNumberOfElites = <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#799f848c53a7307d2ac4d5e5a22eed20">sElitesOnCursor</a>;
<a name="l05715"></a>05715 
<a name="l05716"></a>05716       <span class="comment">// get total </span>
<a name="l05717"></a>05717       iTotalNumberOfTroops = iNumberOfGreens + iNumberOfRegulars + iNumberOfElites;
<a name="l05718"></a>05718 
<a name="l05719"></a>05719       <span class="comment">// get militia video object</span>
<a name="l05720"></a>05720       <a class="code" href="vobject_8cpp.html#bda2b0eae4cb40e612dffd307ad5c692">GetVideoObject</a>( &amp;hVObject, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#dfe6a9ceaeceac0ea98a35881f42ad74">guiMilitia</a> );
<a name="l05721"></a>05721 
<a name="l05722"></a>05722       <span class="comment">// now display</span>
<a name="l05723"></a>05723       <span class="keywordflow">for</span>( iCurrentTroopIcon = 0; iCurrentTroopIcon &lt; iTotalNumberOfTroops; iCurrentTroopIcon++ )
<a name="l05724"></a>05724       {
<a name="l05725"></a>05725             <span class="comment">// get screen x and y coords</span>
<a name="l05726"></a>05726             sX =  ( iCurrentTroopIcon % NUMBER_OF_MILITIA_ICONS_PER_LOWER_ROW ) * MEDIUM_MILITIA_ICON_SPACING + MAP_MILITIA_BOX_POS_X + MAP_MILITIA_MAP_X + 1;
<a name="l05727"></a>05727             sY =  ( iCurrentTroopIcon / NUMBER_OF_MILITIA_ICONS_PER_LOWER_ROW ) * MEDIUM_MILITIA_ICON_SPACING + MAP_MILITIA_BOX_POS_Y + MAP_MILITIA_LOWER_ROW_Y;
<a name="l05728"></a>05728 
<a name="l05729"></a>05729             <span class="keywordflow">if</span>( iCurrentTroopIcon &lt; iNumberOfGreens )
<a name="l05730"></a>05730             {
<a name="l05731"></a>05731                   iCurrentIcon = 8;
<a name="l05732"></a>05732             }
<a name="l05733"></a>05733             <span class="keywordflow">else</span> <span class="keywordflow">if</span>( iCurrentTroopIcon &lt; iNumberOfGreens + iNumberOfRegulars )
<a name="l05734"></a>05734             {
<a name="l05735"></a>05735                   iCurrentIcon = 9;
<a name="l05736"></a>05736             }
<a name="l05737"></a>05737             <span class="keywordflow">else</span>
<a name="l05738"></a>05738             {
<a name="l05739"></a>05739                   iCurrentIcon = 10;
<a name="l05740"></a>05740             }
<a name="l05741"></a>05741 
<a name="l05742"></a>05742             <a class="code" href="vobject_8cpp.html#8a5b07441769401593743b9f52a9e353">BltVideoObject</a>( FRAME_BUFFER, hVObject, ( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> )( iCurrentIcon ), sX, sY, VO_BLT_SRCTRANSPARENCY, NULL );
<a name="l05743"></a>05743       }
<a name="l05744"></a>05744 }
<a name="l05745"></a>05745 
<a name="l05746"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#a6ff6435079dbd77d403864af9a069bc">05746</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#a6ff6435079dbd77d403864af9a069bc">IsThisMilitiaTownSectorAllowable</a>( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorIndexValue )
<a name="l05747"></a>05747 {
<a name="l05748"></a>05748       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sBaseSectorValue = 0, sGlobalMapSector = 0;
<a name="l05749"></a>05749       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorX, sSectorY;
<a name="l05750"></a>05750 
<a name="l05751"></a>05751       <span class="comment">// is this sector allowed to be clicked on?</span>
<a name="l05752"></a>05752       sBaseSectorValue = <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#a7689a7ef7f9d17f36e83a8fc26b85c2">GetBaseSectorForCurrentTown</a>( );
<a name="l05753"></a>05753       sGlobalMapSector = sBaseSectorValue + ( ( sSectorIndexValue % MILITIA_BOX_ROWS ) + ( sSectorIndexValue / MILITIA_BOX_ROWS ) * 16 );
<a name="l05754"></a>05754 
<a name="l05755"></a>05755       sSectorX = SECTORX( sGlobalMapSector );
<a name="l05756"></a>05756       sSectorY = SECTORY( sGlobalMapSector );
<a name="l05757"></a>05757 
<a name="l05758"></a>05758       <span class="comment">// is this in fact part of a town?</span>
<a name="l05759"></a>05759       <span class="keywordflow">if</span>( <a class="code" href="strategic_8cpp.html#6f48fb0ea28e3d4889423290f1a6ede8">StrategicMap</a>[ CALCULATE_STRATEGIC_INDEX( sSectorX, sSectorY ) ].bNameId == <a class="code" href="mapscreen_8h.html#4d1dc70bee62b945929c96dfafebe105d008cfe091b982e6d052565ed0b5acd8">BLANK_SECTOR</a> )
<a name="l05760"></a>05760       {
<a name="l05761"></a>05761             <span class="keywordflow">return</span>( FALSE );
<a name="l05762"></a>05762       }
<a name="l05763"></a>05763 
<a name="l05764"></a>05764       <span class="keywordflow">if</span>( !<a class="code" href="Town_01Militia_8cpp.html#01dd2be30e6898d4dcce7f876a11bee6">SectorOursAndPeaceful</a>( sSectorX, sSectorY, 0 ) )
<a name="l05765"></a>05765       {
<a name="l05766"></a>05766             <span class="keywordflow">return</span>( FALSE );
<a name="l05767"></a>05767       }
<a name="l05768"></a>05768 
<a name="l05769"></a>05769       <span class="comment">// valid</span>
<a name="l05770"></a>05770       <span class="keywordflow">return</span>( TRUE );
<a name="l05771"></a>05771 }
<a name="l05772"></a>05772 
<a name="l05773"></a>05773 
<a name="l05774"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e947c35884afc3a01fb737dc7291e41b">05774</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e947c35884afc3a01fb737dc7291e41b">DrawTownMilitiaName</a>( <span class="keywordtype">void</span> )
<a name="l05775"></a>05775 {
<a name="l05776"></a>05776       <a class="code" href="Types_8h.html#fcdf88c1d4179fcd6d8a1fa9bbcb8a80">CHAR16</a> sString[ 64 ];
<a name="l05777"></a>05777       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sX, sY;
<a name="l05778"></a>05778 
<a name="l05779"></a>05779       <span class="comment">// get the name for the current militia town </span>
<a name="l05780"></a>05780       swprintf( sString, L<span class="stringliteral">"%s %s"</span>, <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#68933d9bb7d357af6609236e47fca927">pTownNames</a>[ <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#51cc0335bcdf1be08103f8d3ab7cf85c">sSelectedMilitiaTown</a> ], <a class="code" href="__DutchText_8cpp.html#a26b93bc719f6a43b384f92b7877a75c">pMilitiaString</a>[ 0 ] );
<a name="l05781"></a>05781       <a class="code" href="Font_8cpp.html#d08dcd11daa6a1189cb123dff18cd7c8">FindFontCenterCoordinates</a>( MAP_MILITIA_BOX_POS_X, MAP_MILITIA_BOX_POS_Y + MILITIA_BOX_TEXT_OFFSET_Y, MILITIA_BOX_WIDTH, MILITIA_BOX_TEXT_TITLE_HEIGHT, sString, FONT10ARIAL, &amp;sX, &amp;sY );
<a name="l05782"></a>05782       <a class="code" href="Font_8cpp.html#b3e12cf19a0ca58abf6689cc8eca3ead">mprintf</a>(  sX, sY, sString );
<a name="l05783"></a>05783 
<a name="l05784"></a>05784       <span class="comment">// might as well show the unassigned string</span>
<a name="l05785"></a>05785       swprintf( sString, L<span class="stringliteral">"%s %s"</span>, <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#68933d9bb7d357af6609236e47fca927">pTownNames</a>[ sSelectedMilitiaTown ], <a class="code" href="__DutchText_8cpp.html#a26b93bc719f6a43b384f92b7877a75c">pMilitiaString</a>[ 1 ] );
<a name="l05786"></a>05786       <a class="code" href="Font_8cpp.html#d08dcd11daa6a1189cb123dff18cd7c8">FindFontCenterCoordinates</a>( MAP_MILITIA_BOX_POS_X, MAP_MILITIA_BOX_POS_Y + MILITIA_BOX_UNASSIGNED_TEXT_OFFSET_Y, MILITIA_BOX_WIDTH, <a class="code" href="Font_8cpp.html#35cddf34696d33489efb820caf968907">GetFontHeight</a>( FONT10ARIAL ), sString, FONT10ARIAL, &amp;sX, &amp;sY );
<a name="l05787"></a>05787       <a class="code" href="Font_8cpp.html#b3e12cf19a0ca58abf6689cc8eca3ead">mprintf</a>(  sX, sY, sString );
<a name="l05788"></a>05788 
<a name="l05789"></a>05789       <span class="keywordflow">return</span>;
<a name="l05790"></a>05790 }
<a name="l05791"></a>05791 
<a name="l05792"></a>05792 
<a name="l05793"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#c5b8184ec37de9c65012853728622cb7">05793</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#c5b8184ec37de9c65012853728622cb7">HandleShutDownOfMilitiaPanelIfPeopleOnTheCursor</a>( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sTownValue  )
<a name="l05794"></a>05794 {
<a name="l05795"></a>05795       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iCounter = 0, iCounterB = 0, iNumberUnderControl = 0, iNumberThatCanFitInSector= 0, iCount = 0;
<a name="l05796"></a>05796       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fLastOne = FALSE;
<a name="l05797"></a>05797       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iMaxMilitiaPerSector = <a class="code" href="GameSettings_8cpp.html#5c32f930e2fef384505c4b91803a92c2">gGameExternalOptions</a>.<a class="code" href="structGAME__EXTERNAL__OPTIONS.html#9db98fdba0ff76f98649cc6c3ded3392">iMaxMilitiaPerSector</a>;
<a name="l05798"></a>05798 DebugMsg (<a class="code" href="DEBUG_8cpp.html#a7985c2fd033797fc67a03b2c26e07c6">TOPIC_JA2</a>,DBG_LEVEL_3,<span class="stringliteral">"Map Screen3"</span>);
<a name="l05799"></a>05799 
<a name="l05800"></a>05800       <span class="comment">// check if anyone still on the cursor</span>
<a name="l05801"></a>05801       <span class="keywordflow">if</span>( !<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#713d7ee279b00a3921e5d1d053a28e64">sGreensOnCursor</a> &amp;&amp; !<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7fa9e1a37309ac744098ba38183ee51d">sRegularsOnCursor</a> &amp;&amp; !<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#799f848c53a7307d2ac4d5e5a22eed20">sElitesOnCursor</a> )
<a name="l05802"></a>05802       {
<a name="l05803"></a>05803             <span class="keywordflow">return</span>;
<a name="l05804"></a>05804       }
<a name="l05805"></a>05805 
<a name="l05806"></a>05806       <span class="comment">// yep someone left</span>
<a name="l05807"></a>05807       iNumberUnderControl = <a class="code" href="strategicmap_8cpp.html#1fab6a2009a1cd32ebff3e51921d830e">GetTownSectorsUnderControl</a>( ( <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> ) sTownValue );
<a name="l05808"></a>05808 
<a name="l05809"></a>05809       <span class="comment">// find number of sectors under player's control</span>
<a name="l05810"></a>05810       <span class="keywordflow">while</span>( <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#1001d8cb48db71e9db760efbf4353e6a">pTownNamesList</a>[ iCounter ] != 0 )
<a name="l05811"></a>05811       {
<a name="l05812"></a>05812             <span class="keywordflow">if</span>( <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#1001d8cb48db71e9db760efbf4353e6a">pTownNamesList</a>[ iCounter] == sTownValue )
<a name="l05813"></a>05813             {
<a name="l05814"></a>05814                   <span class="keywordflow">if</span>( <a class="code" href="Town_01Militia_8cpp.html#01dd2be30e6898d4dcce7f876a11bee6">SectorOursAndPeaceful</a>( ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> )( <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#c994e67a1f8511a80e6418dc483b0861">pTownLocationsList</a>[ iCounter ] % MAP_WORLD_X ) , ( INT16 )( <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#c994e67a1f8511a80e6418dc483b0861">pTownLocationsList</a>[ iCounter ] / MAP_WORLD_X ), 0 ) )
<a name="l05815"></a>05815                   {
<a name="l05816"></a>05816                         iCount = 0;
<a name="l05817"></a>05817                         iNumberThatCanFitInSector = iMaxMilitiaPerSector;
<a name="l05818"></a>05818                         iNumberThatCanFitInSector -= <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ STRATEGIC_INDEX_TO_SECTOR_INFO( <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#c994e67a1f8511a80e6418dc483b0861">pTownLocationsList</a>[ iCounter ] ) ].<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840b225c8d872b15875355f348d6e3335b">GREEN_MILITIA</a> ];
<a name="l05819"></a>05819                         iNumberThatCanFitInSector -= <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ STRATEGIC_INDEX_TO_SECTOR_INFO( <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#c994e67a1f8511a80e6418dc483b0861">pTownLocationsList</a>[ iCounter ] ) ].<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a845612214b681e2988ea93890806802cc9">REGULAR_MILITIA</a> ];
<a name="l05820"></a>05820                         iNumberThatCanFitInSector -= <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ STRATEGIC_INDEX_TO_SECTOR_INFO( <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#c994e67a1f8511a80e6418dc483b0861">pTownLocationsList</a>[ iCounter ] ) ].<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840fcf7fc556b8af2f6d3ec39652d3a927">ELITE_MILITIA</a> ];
<a name="l05821"></a>05821 
<a name="l05822"></a>05822                         <span class="keywordflow">while</span>( ( iCount &lt; iNumberThatCanFitInSector )&amp;&amp;( ( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#713d7ee279b00a3921e5d1d053a28e64">sGreensOnCursor</a> ) || ( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7fa9e1a37309ac744098ba38183ee51d">sRegularsOnCursor</a> ) || ( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#799f848c53a7307d2ac4d5e5a22eed20">sElitesOnCursor</a> ) ) )
<a name="l05823"></a>05823                         {
<a name="l05824"></a>05824                               <span class="comment">// green </span>
<a name="l05825"></a>05825                               <span class="keywordflow">if</span>( ( iCount + 1 &lt;= iNumberThatCanFitInSector )&amp;&amp;( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#713d7ee279b00a3921e5d1d053a28e64">sGreensOnCursor</a> ) )
<a name="l05826"></a>05826                               {
<a name="l05827"></a>05827                                     <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ STRATEGIC_INDEX_TO_SECTOR_INFO( <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#c994e67a1f8511a80e6418dc483b0861">pTownLocationsList</a>[ iCounter ] ) ].<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840b225c8d872b15875355f348d6e3335b">GREEN_MILITIA</a> ]++;
<a name="l05828"></a>05828                                     iCount++;
<a name="l05829"></a>05829                                     <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#713d7ee279b00a3921e5d1d053a28e64">sGreensOnCursor</a>--;
<a name="l05830"></a>05830                               }
<a name="l05831"></a>05831                               
<a name="l05832"></a>05832                               <span class="comment">// regular</span>
<a name="l05833"></a>05833                               <span class="keywordflow">if</span>( ( iCount + 1 &lt;= iNumberThatCanFitInSector ) &amp;&amp; ( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7fa9e1a37309ac744098ba38183ee51d">sRegularsOnCursor</a> ) )
<a name="l05834"></a>05834                               {
<a name="l05835"></a>05835                                     <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ STRATEGIC_INDEX_TO_SECTOR_INFO( <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#c994e67a1f8511a80e6418dc483b0861">pTownLocationsList</a>[ iCounter ] ) ].<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a845612214b681e2988ea93890806802cc9">REGULAR_MILITIA</a> ]++;
<a name="l05836"></a>05836                                     iCount++;
<a name="l05837"></a>05837                                     <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7fa9e1a37309ac744098ba38183ee51d">sRegularsOnCursor</a>--;
<a name="l05838"></a>05838                               }
<a name="l05839"></a>05839                               
<a name="l05840"></a>05840                               <span class="comment">// elite</span>
<a name="l05841"></a>05841                               <span class="keywordflow">if</span>( ( iCount + 1 &lt;= iNumberThatCanFitInSector ) &amp;&amp; ( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#799f848c53a7307d2ac4d5e5a22eed20">sElitesOnCursor</a> ) )
<a name="l05842"></a>05842                               {
<a name="l05843"></a>05843                                     <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ STRATEGIC_INDEX_TO_SECTOR_INFO( <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#c994e67a1f8511a80e6418dc483b0861">pTownLocationsList</a>[ iCounter ] ) ].<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840fcf7fc556b8af2f6d3ec39652d3a927">ELITE_MILITIA</a> ]++;
<a name="l05844"></a>05844                                     iCount++;
<a name="l05845"></a>05845                                     <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#799f848c53a7307d2ac4d5e5a22eed20">sElitesOnCursor</a>--;
<a name="l05846"></a>05846                               }
<a name="l05847"></a>05847                         }
<a name="l05848"></a>05848 
<a name="l05849"></a>05849                         <span class="keywordflow">if</span>( STRATEGIC_INDEX_TO_SECTOR_INFO( <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#c994e67a1f8511a80e6418dc483b0861">pTownLocationsList</a>[ iCounter ] ) == SECTOR( <a class="code" href="strategicmap_8cpp.html#49d9aed144a633fda4ba1990f002d703">gWorldSectorX</a>, <a class="code" href="strategicmap_8cpp.html#ea322310ced0e35ee18a2ee7b32aac5b">gWorldSectorY</a> ) )
<a name="l05850"></a>05850                         {
<a name="l05851"></a>05851                               <a class="code" href="Militia_01Control_8cpp.html#8aeca7bf7233528d93298fc3b2202f0c">gfStrategicMilitiaChangesMade</a> = TRUE;
<a name="l05852"></a>05852                         }
<a name="l05853"></a>05853                   
<a name="l05854"></a>05854                   }
<a name="l05855"></a>05855 
<a name="l05856"></a>05856                   fLastOne = TRUE;
<a name="l05857"></a>05857 
<a name="l05858"></a>05858                   iCounterB = iCounter + 1;
<a name="l05859"></a>05859 
<a name="l05860"></a>05860                   <span class="keywordflow">while</span>( <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#1001d8cb48db71e9db760efbf4353e6a">pTownNamesList</a>[ iCounterB ] != 0 )
<a name="l05861"></a>05861                   {
<a name="l05862"></a>05862                         <span class="keywordflow">if</span>( <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#1001d8cb48db71e9db760efbf4353e6a">pTownNamesList</a>[ iCounterB ] ==  sTownValue )
<a name="l05863"></a>05863                         {
<a name="l05864"></a>05864                               fLastOne = FALSE;
<a name="l05865"></a>05865                         }
<a name="l05866"></a>05866                         
<a name="l05867"></a>05867                         iCounterB++;
<a name="l05868"></a>05868                   }
<a name="l05869"></a>05869 
<a name="l05870"></a>05870                   <span class="keywordflow">if</span>( fLastOne )
<a name="l05871"></a>05871                   {
<a name="l05872"></a>05872                         <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ STRATEGIC_INDEX_TO_SECTOR_INFO( <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#c994e67a1f8511a80e6418dc483b0861">pTownLocationsList</a>[ iCounter ] ) ].<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840b225c8d872b15875355f348d6e3335b">GREEN_MILITIA</a> ] +=  ( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> )( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#713d7ee279b00a3921e5d1d053a28e64">sGreensOnCursor</a> % iNumberUnderControl );
<a name="l05873"></a>05873                         <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ STRATEGIC_INDEX_TO_SECTOR_INFO( <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#c994e67a1f8511a80e6418dc483b0861">pTownLocationsList</a>[ iCounter ] ) ].<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a845612214b681e2988ea93890806802cc9">REGULAR_MILITIA</a> ] +=  ( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> )( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7fa9e1a37309ac744098ba38183ee51d">sRegularsOnCursor</a> % iNumberUnderControl );
<a name="l05874"></a>05874                         <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ STRATEGIC_INDEX_TO_SECTOR_INFO( <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#c994e67a1f8511a80e6418dc483b0861">pTownLocationsList</a>[ iCounter ] ) ].<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840fcf7fc556b8af2f6d3ec39652d3a927">ELITE_MILITIA</a> ] +=  ( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> )( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#799f848c53a7307d2ac4d5e5a22eed20">sElitesOnCursor</a> % iNumberUnderControl );
<a name="l05875"></a>05875                   }
<a name="l05876"></a>05876             }
<a name="l05877"></a>05877 
<a name="l05878"></a>05878             iCounter++;
<a name="l05879"></a>05879       }
<a name="l05880"></a>05880 
<a name="l05881"></a>05881       <span class="comment">// zero out numbers on the cursor</span>
<a name="l05882"></a>05882       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#713d7ee279b00a3921e5d1d053a28e64">sGreensOnCursor</a> = 0;
<a name="l05883"></a>05883       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7fa9e1a37309ac744098ba38183ee51d">sRegularsOnCursor</a> = 0;
<a name="l05884"></a>05884       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#799f848c53a7307d2ac4d5e5a22eed20">sElitesOnCursor</a> = 0;
<a name="l05885"></a>05885 
<a name="l05886"></a>05886       <span class="keywordflow">return</span>;
<a name="l05887"></a>05887 }
<a name="l05888"></a>05888 
<a name="l05889"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#10885d60a1b859f702b95ee85dc2b441">05889</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#10885d60a1b859f702b95ee85dc2b441">HandleEveningOutOfTroopsAmongstSectors</a>( <span class="keywordtype">void</span> )
<a name="l05890"></a>05890 {
<a name="l05891"></a>05891       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iMaxMilitiaPerSector = <a class="code" href="GameSettings_8cpp.html#5c32f930e2fef384505c4b91803a92c2">gGameExternalOptions</a>.<a class="code" href="structGAME__EXTERNAL__OPTIONS.html#9db98fdba0ff76f98649cc6c3ded3392">iMaxMilitiaPerSector</a>;
<a name="l05892"></a>05892 DebugMsg (<a class="code" href="DEBUG_8cpp.html#a7985c2fd033797fc67a03b2c26e07c6">TOPIC_JA2</a>,DBG_LEVEL_3,<span class="stringliteral">"Map Screen4"</span>);
<a name="l05893"></a>05893       <span class="comment">// even out troops among the town</span>
<a name="l05894"></a>05894       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iCounter = 0, iNumberUnderControl = 0, iNumberOfGreens = 0, iNumberOfRegulars = 0, iNumberOfElites = 0, iTotalNumberOfTroops = 0;
<a name="l05895"></a>05895       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iNumberLeftOverGreen = 0, iNumberLeftOverRegular = 0, iNumberLeftOverElite = 0;
<a name="l05896"></a>05896       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sBaseSectorValue = 0, sCurrentSectorValue = 0;
<a name="l05897"></a>05897       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorX = 0, sSectorY = 0, sSector = 0;
<a name="l05898"></a>05898       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sTotalSoFar = 0;
<a name="l05899"></a>05899 
<a name="l05900"></a>05900 
<a name="l05901"></a>05901       <span class="comment">// how many sectors in the selected town do we control?</span>
<a name="l05902"></a>05902       iNumberUnderControl = <a class="code" href="strategicmap_8cpp.html#1fab6a2009a1cd32ebff3e51921d830e">GetTownSectorsUnderControl</a>( ( <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> ) <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#51cc0335bcdf1be08103f8d3ab7cf85c">sSelectedMilitiaTown</a> );
<a name="l05903"></a>05903 
<a name="l05904"></a>05904       <span class="comment">// if none, there's nothing to be done!</span>
<a name="l05905"></a>05905       <span class="keywordflow">if</span>( !iNumberUnderControl )
<a name="l05906"></a>05906       {
<a name="l05907"></a>05907             <span class="keywordflow">return</span>;
<a name="l05908"></a>05908       }
<a name="l05909"></a>05909 
<a name="l05910"></a>05910 
<a name="l05911"></a>05911       <span class="comment">// get the sector value for the upper left corner</span>
<a name="l05912"></a>05912       sBaseSectorValue = <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#a7689a7ef7f9d17f36e83a8fc26b85c2">GetBaseSectorForCurrentTown</a>( );
<a name="l05913"></a>05913 
<a name="l05914"></a>05914       <span class="comment">// render icons for map</span>
<a name="l05915"></a>05915       <span class="keywordflow">for</span>( iCounter = 0; iCounter &lt; 9; iCounter++ )
<a name="l05916"></a>05916       {
<a name="l05917"></a>05917             <span class="comment">// grab current sector value</span>
<a name="l05918"></a>05918             sCurrentSectorValue = sBaseSectorValue + ( ( iCounter % MILITIA_BOX_ROWS ) + ( iCounter / MILITIA_BOX_ROWS ) * ( 16 ) );
<a name="l05919"></a>05919             
<a name="l05920"></a>05920             sSectorX = SECTORX( sCurrentSectorValue );
<a name="l05921"></a>05921             sSectorY = SECTORY( sCurrentSectorValue );
<a name="l05922"></a>05922 
<a name="l05923"></a>05923             <span class="comment">// skip sectors not in the selected town (nearby other towns or wilderness SAM Sites)</span>
<a name="l05924"></a>05924             <span class="keywordflow">if</span>( <a class="code" href="strategicmap_8cpp.html#99dffd29ea4571bc0c833d45636f1403">GetTownIdForSector</a>( sSectorX, sSectorY ) != sSelectedMilitiaTown )
<a name="l05925"></a>05925             {
<a name="l05926"></a>05926                   <span class="keywordflow">continue</span>;
<a name="l05927"></a>05927             }
<a name="l05928"></a>05928 
<a name="l05929"></a>05929             <span class="keywordflow">if</span>( !<a class="code" href="strategic_8cpp.html#6f48fb0ea28e3d4889423290f1a6ede8">StrategicMap</a>[ CALCULATE_STRATEGIC_INDEX( sSectorX, sSectorY ) ].fEnemyControlled )
<a name="l05930"></a>05930             {
<a name="l05931"></a>05931                   <span class="comment">// get number of each</span>
<a name="l05932"></a>05932                   iNumberOfGreens += <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ sCurrentSectorValue ].<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840b225c8d872b15875355f348d6e3335b">GREEN_MILITIA</a> ];
<a name="l05933"></a>05933                   iNumberOfRegulars += <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ sCurrentSectorValue ].<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a845612214b681e2988ea93890806802cc9">REGULAR_MILITIA</a> ];
<a name="l05934"></a>05934                   iNumberOfElites += <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ sCurrentSectorValue ].<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840fcf7fc556b8af2f6d3ec39652d3a927">ELITE_MILITIA</a> ];
<a name="l05935"></a>05935             }
<a name="l05936"></a>05936       }
<a name="l05937"></a>05937 
<a name="l05938"></a>05938       <span class="comment">// now grab those on the cursor</span>
<a name="l05939"></a>05939       iNumberOfGreens += <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#713d7ee279b00a3921e5d1d053a28e64">sGreensOnCursor</a>;
<a name="l05940"></a>05940       iNumberOfRegulars += <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7fa9e1a37309ac744098ba38183ee51d">sRegularsOnCursor</a>;
<a name="l05941"></a>05941       iNumberOfElites += <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#799f848c53a7307d2ac4d5e5a22eed20">sElitesOnCursor</a>;
<a name="l05942"></a>05942 
<a name="l05943"></a>05943       <span class="comment">// now get the left overs</span>
<a name="l05944"></a>05944       iNumberLeftOverGreen = iNumberOfGreens % iNumberUnderControl;
<a name="l05945"></a>05945       iNumberLeftOverRegular = iNumberOfRegulars % iNumberUnderControl;
<a name="l05946"></a>05946       iNumberLeftOverElite = iNumberOfElites % iNumberUnderControl;
<a name="l05947"></a>05947 
<a name="l05948"></a>05948       <span class="comment">// get total</span>
<a name="l05949"></a>05949       iTotalNumberOfTroops = iNumberOfGreens + iNumberOfRegulars + iNumberOfElites;
<a name="l05950"></a>05950 
<a name="l05951"></a>05951       <span class="keywordflow">if</span>( !iTotalNumberOfTroops )
<a name="l05952"></a>05952       {
<a name="l05953"></a>05953             <span class="keywordflow">return</span>;
<a name="l05954"></a>05954       }
<a name="l05955"></a>05955 
<a name="l05956"></a>05956       iCounter = 0;
<a name="l05957"></a>05957 
<a name="l05958"></a>05958       <span class="keywordflow">while</span>( <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#1001d8cb48db71e9db760efbf4353e6a">pTownNamesList</a>[ iCounter ] != 0 )
<a name="l05959"></a>05959       {
<a name="l05960"></a>05960             <span class="keywordflow">if</span>( <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#1001d8cb48db71e9db760efbf4353e6a">pTownNamesList</a>[ iCounter] == sSelectedMilitiaTown )
<a name="l05961"></a>05961             {
<a name="l05962"></a>05962                   sSectorX = GET_X_FROM_STRATEGIC_INDEX( <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#c994e67a1f8511a80e6418dc483b0861">pTownLocationsList</a>[ iCounter ] );
<a name="l05963"></a>05963                   sSectorY = GET_Y_FROM_STRATEGIC_INDEX( <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#c994e67a1f8511a80e6418dc483b0861">pTownLocationsList</a>[ iCounter ] );
<a name="l05964"></a>05964 
<a name="l05965"></a>05965                   <span class="keywordflow">if</span>( !<a class="code" href="strategic_8cpp.html#6f48fb0ea28e3d4889423290f1a6ede8">StrategicMap</a>[ <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#c994e67a1f8511a80e6418dc483b0861">pTownLocationsList</a>[ iCounter ] ].fEnemyControlled &amp;&amp; !<a class="code" href="Queen_01Command_8cpp.html#4c107e5449871be5bef0808839c19787">NumHostilesInSector</a>( sSectorX, sSectorY, 0 ) )
<a name="l05966"></a>05966                   {
<a name="l05967"></a>05967                         sSector = SECTOR( sSectorX, sSectorY );
<a name="l05968"></a>05968 
<a name="l05969"></a>05969                         <span class="comment">// distribute here</span>
<a name="l05970"></a>05970                         <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ sSector ].<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840b225c8d872b15875355f348d6e3335b">GREEN_MILITIA</a> ] =  ( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> )( iNumberOfGreens / iNumberUnderControl );
<a name="l05971"></a>05971                         <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ sSector ].<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a845612214b681e2988ea93890806802cc9">REGULAR_MILITIA</a> ] =  ( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> )( iNumberOfRegulars / iNumberUnderControl );
<a name="l05972"></a>05972                         <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ sSector ].<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840fcf7fc556b8af2f6d3ec39652d3a927">ELITE_MILITIA</a> ] =  ( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> )( iNumberOfElites / iNumberUnderControl );
<a name="l05973"></a>05973                         sTotalSoFar = ( <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> )( ( iNumberOfGreens / iNumberUnderControl ) + ( iNumberOfRegulars / iNumberUnderControl ) + ( iNumberOfElites / iNumberUnderControl ) );
<a name="l05974"></a>05974 
<a name="l05975"></a>05975                         <span class="comment">// add leftovers that weren't included in the div operation</span>
<a name="l05976"></a>05976                         <span class="keywordflow">if</span>( ( iNumberLeftOverGreen ) &amp;&amp; ( sTotalSoFar &lt; iMaxMilitiaPerSector ) )
<a name="l05977"></a>05977                         {
<a name="l05978"></a>05978                               <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ sSector ].<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840b225c8d872b15875355f348d6e3335b">GREEN_MILITIA</a> ]++;
<a name="l05979"></a>05979                               sTotalSoFar++;
<a name="l05980"></a>05980                               iNumberLeftOverGreen--;
<a name="l05981"></a>05981                         }
<a name="l05982"></a>05982 
<a name="l05983"></a>05983                         <span class="keywordflow">if</span>( ( iNumberLeftOverRegular )&amp;&amp;( sTotalSoFar &lt; iMaxMilitiaPerSector ) )
<a name="l05984"></a>05984                         {
<a name="l05985"></a>05985                               <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ sSector ].<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a845612214b681e2988ea93890806802cc9">REGULAR_MILITIA</a> ]++;
<a name="l05986"></a>05986                               sTotalSoFar++;
<a name="l05987"></a>05987                               iNumberLeftOverRegular--;
<a name="l05988"></a>05988                         }
<a name="l05989"></a>05989 
<a name="l05990"></a>05990                         <span class="keywordflow">if</span>( ( iNumberLeftOverElite )&amp;&amp;( sTotalSoFar &lt; iMaxMilitiaPerSector ) )
<a name="l05991"></a>05991                         {
<a name="l05992"></a>05992                               <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ sSector ].<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840fcf7fc556b8af2f6d3ec39652d3a927">ELITE_MILITIA</a> ]++;
<a name="l05993"></a>05993                               sTotalSoFar++;
<a name="l05994"></a>05994                               iNumberLeftOverElite--;
<a name="l05995"></a>05995                         }
<a name="l05996"></a>05996 
<a name="l05997"></a>05997                         <span class="comment">// if this sector is currently loaded</span>
<a name="l05998"></a>05998                         <span class="keywordflow">if</span>( sSector == SECTOR( <a class="code" href="strategicmap_8cpp.html#49d9aed144a633fda4ba1990f002d703">gWorldSectorX</a>, <a class="code" href="strategicmap_8cpp.html#ea322310ced0e35ee18a2ee7b32aac5b">gWorldSectorY</a> ) &amp;&amp; <a class="code" href="strategicmap_8cpp.html#ea322310ced0e35ee18a2ee7b32aac5b">gWorldSectorY</a> != 0 )
<a name="l05999"></a>05999                         {
<a name="l06000"></a>06000                               <a class="code" href="Militia_01Control_8cpp.html#8aeca7bf7233528d93298fc3b2202f0c">gfStrategicMilitiaChangesMade</a> = TRUE;
<a name="l06001"></a>06001                         }
<a name="l06002"></a>06002                   }
<a name="l06003"></a>06003             }
<a name="l06004"></a>06004 
<a name="l06005"></a>06005             iCounter++;
<a name="l06006"></a>06006       }
<a name="l06007"></a>06007 
<a name="l06008"></a>06008 
<a name="l06009"></a>06009       <span class="comment">// zero out numbers on the cursor</span>
<a name="l06010"></a>06010       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#713d7ee279b00a3921e5d1d053a28e64">sGreensOnCursor</a> = 0;
<a name="l06011"></a>06011       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7fa9e1a37309ac744098ba38183ee51d">sRegularsOnCursor</a> = 0;
<a name="l06012"></a>06012       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#799f848c53a7307d2ac4d5e5a22eed20">sElitesOnCursor</a> = 0;
<a name="l06013"></a>06013 
<a name="l06014"></a>06014       <span class="keywordflow">return</span>;
<a name="l06015"></a>06015 }
<a name="l06016"></a>06016 
<a name="l06017"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#f720e46467f59ba82cd575765ad81055">06017</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#f720e46467f59ba82cd575765ad81055">CreateMilitiaPanelBottomButton</a>( <span class="keywordtype">void</span> )
<a name="l06018"></a>06018 {
<a name="l06019"></a>06019       <span class="comment">// set the button image</span>
<a name="l06020"></a>06020       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e747867f24c86066723ce3da34a65cd2">giMapMilitiaButtonImage</a>[ 3 ]=  <a class="code" href="Button_01System_8cpp.html#b0e9fca124dbbab5ea6581af91600feb">LoadButtonImage</a>( <span class="stringliteral">"INTERFACE\\militia.sti"</span> ,-1,1,-1,2,-1 );
<a name="l06021"></a>06021       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e747867f24c86066723ce3da34a65cd2">giMapMilitiaButtonImage</a>[ 4 ]=  <a class="code" href="Button_01System_8cpp.html#b0e9fca124dbbab5ea6581af91600feb">LoadButtonImage</a>( <span class="stringliteral">"INTERFACE\\militia.sti"</span> ,-1,1,-1,2,-1 );
<a name="l06022"></a>06022 
<a name="l06023"></a>06023 
<a name="l06024"></a>06024       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0f4a0d61ac6bc0b9edfe8f3df3505031">giMapMilitiaButton</a>[ 3 ] = <a class="code" href="Button_01System_8cpp.html#0e1355197c21c65bb815d1570751e549">QuickCreateButton</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e747867f24c86066723ce3da34a65cd2">giMapMilitiaButtonImage</a>[ 3 ], MAP_MILITIA_BOX_POS_X + MAP_MILITIA_BOX_AUTO_BOX_X, MAP_MILITIA_BOX_POS_Y + MAP_MILITIA_BOX_AUTO_BOX_Y,
<a name="l06025"></a>06025                                                             BUTTON_TOGGLE, MSYS_PRIORITY_HIGHEST - 1,
<a name="l06026"></a>06026                                                             <a class="code" href="Button_01System_8cpp.html#333b1eca007f1fd3aa03503181ab8ac6">BtnGenericMouseMoveButtonCallback</a>, (<a class="code" href="Button_01System_8h.html#bd566aec25d6e1a33f91530f21194cf3">GUI_CALLBACK</a>) <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#bc393ba4bb6b98212e5c9c92cbe4f443">MilitiaAutoButtonCallback</a> );
<a name="l06027"></a>06027 
<a name="l06028"></a>06028       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0f4a0d61ac6bc0b9edfe8f3df3505031">giMapMilitiaButton</a>[ 4 ] = <a class="code" href="Button_01System_8cpp.html#0e1355197c21c65bb815d1570751e549">QuickCreateButton</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e747867f24c86066723ce3da34a65cd2">giMapMilitiaButtonImage</a>[ 4 ], MAP_MILITIA_BOX_POS_X + MAP_MILITIA_BOX_DONE_BOX_X, MAP_MILITIA_BOX_POS_Y + MAP_MILITIA_BOX_AUTO_BOX_Y,
<a name="l06029"></a>06029                                                             BUTTON_TOGGLE, MSYS_PRIORITY_HIGHEST - 1,
<a name="l06030"></a>06030                                                             <a class="code" href="Button_01System_8cpp.html#333b1eca007f1fd3aa03503181ab8ac6">BtnGenericMouseMoveButtonCallback</a>, (<a class="code" href="Button_01System_8h.html#bd566aec25d6e1a33f91530f21194cf3">GUI_CALLBACK</a>) <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#58fdab56ecd9c6576936d0cf82f97a07">MilitiaDoneButtonCallback</a> );
<a name="l06031"></a>06031 
<a name="l06032"></a>06032 
<a name="l06033"></a>06033       <a class="code" href="Button_01System_8cpp.html#46bfaf6f8490cd717f9641deed553d07">SpecifyButtonFont</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0f4a0d61ac6bc0b9edfe8f3df3505031">giMapMilitiaButton</a>[ 3 ], FONT10ARIAL );
<a name="l06034"></a>06034       <a class="code" href="Button_01System_8cpp.html#a24be039c1d41a9d9ff4c39d83542195">SpecifyButtonUpTextColors</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0f4a0d61ac6bc0b9edfe8f3df3505031">giMapMilitiaButton</a>[ 3 ], FONT_BLACK, FONT_BLACK );
<a name="l06035"></a>06035       <a class="code" href="Button_01System_8cpp.html#43ca9ffecb20ab2c8b142adfdedf61b6">SpecifyButtonDownTextColors</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0f4a0d61ac6bc0b9edfe8f3df3505031">giMapMilitiaButton</a>[ 3 ], FONT_BLACK, FONT_BLACK );
<a name="l06036"></a>06036 
<a name="l06037"></a>06037       <a class="code" href="Button_01System_8cpp.html#46bfaf6f8490cd717f9641deed553d07">SpecifyButtonFont</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0f4a0d61ac6bc0b9edfe8f3df3505031">giMapMilitiaButton</a>[ 4 ], FONT10ARIAL );
<a name="l06038"></a>06038       <a class="code" href="Button_01System_8cpp.html#a24be039c1d41a9d9ff4c39d83542195">SpecifyButtonUpTextColors</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0f4a0d61ac6bc0b9edfe8f3df3505031">giMapMilitiaButton</a>[ 4 ], FONT_BLACK, FONT_BLACK );
<a name="l06039"></a>06039       <a class="code" href="Button_01System_8cpp.html#43ca9ffecb20ab2c8b142adfdedf61b6">SpecifyButtonDownTextColors</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0f4a0d61ac6bc0b9edfe8f3df3505031">giMapMilitiaButton</a>[ 4 ], FONT_BLACK, FONT_BLACK );
<a name="l06040"></a>06040 
<a name="l06041"></a>06041       <a class="code" href="Button_01System_8cpp.html#927e98ae8d3535e396faf9ade7f5feb8">SpecifyButtonText</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0f4a0d61ac6bc0b9edfe8f3df3505031">giMapMilitiaButton</a>[ 3 ], <a class="code" href="__DutchText_8cpp.html#60ba523c4bd323c8d2cb07fc1c4f30b7">pMilitiaButtonString</a>[ 0 ] );
<a name="l06042"></a>06042       <a class="code" href="Button_01System_8cpp.html#927e98ae8d3535e396faf9ade7f5feb8">SpecifyButtonText</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0f4a0d61ac6bc0b9edfe8f3df3505031">giMapMilitiaButton</a>[ 4 ], <a class="code" href="__DutchText_8cpp.html#60ba523c4bd323c8d2cb07fc1c4f30b7">pMilitiaButtonString</a>[ 1 ] );
<a name="l06043"></a>06043 
<a name="l06044"></a>06044       <span class="comment">// AUTO button help</span>
<a name="l06045"></a>06045       <a class="code" href="Button_01System_8cpp.html#b0d81634ea4def6619339dd21375ecbe">SetButtonFastHelpText</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0f4a0d61ac6bc0b9edfe8f3df3505031">giMapMilitiaButton</a>[ 3 ], <a class="code" href="__DutchText_8cpp.html#dbac7abba2644ed81ff0d67c0aee603d">pMilitiaButtonsHelpText</a>[ 3 ] );
<a name="l06046"></a>06046 
<a name="l06047"></a>06047 
<a name="l06048"></a>06048       <span class="comment">// if auto-distribution is not possible</span>
<a name="l06049"></a>06049       <span class="keywordflow">if</span> ( !<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#6d3ca0774ff9c5425be15af74db4e805">CanMilitiaAutoDistribute</a>( ) )
<a name="l06050"></a>06050       {
<a name="l06051"></a>06051             <span class="comment">// disable the AUTO button</span>
<a name="l06052"></a>06052             <a class="code" href="Button_01System_8cpp.html#f47071abdc2fdbae8fae4688cedaddfc">DisableButton</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0f4a0d61ac6bc0b9edfe8f3df3505031">giMapMilitiaButton</a>[ 3 ] );
<a name="l06053"></a>06053       }
<a name="l06054"></a>06054 
<a name="l06055"></a>06055       <span class="keywordflow">return</span>;
<a name="l06056"></a>06056 }
<a name="l06057"></a>06057 
<a name="l06058"></a>06058 
<a name="l06059"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#4b30437270bc543b63a323145dd2b39c">06059</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#4b30437270bc543b63a323145dd2b39c">DeleteMilitiaPanelBottomButton</a>( <span class="keywordtype">void</span> )
<a name="l06060"></a>06060 {
<a name="l06061"></a>06061 
<a name="l06062"></a>06062       <span class="comment">// delete militia panel bottom</span>
<a name="l06063"></a>06063       <a class="code" href="Button_01System_8cpp.html#daa181fdf3d05f2242b5d9cbeb91e9bf">RemoveButton</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0f4a0d61ac6bc0b9edfe8f3df3505031">giMapMilitiaButton</a>[ 3 ] );
<a name="l06064"></a>06064       <a class="code" href="Button_01System_8cpp.html#daa181fdf3d05f2242b5d9cbeb91e9bf">RemoveButton</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0f4a0d61ac6bc0b9edfe8f3df3505031">giMapMilitiaButton</a>[ 4 ] );
<a name="l06065"></a>06065 
<a name="l06066"></a>06066       <a class="code" href="Button_01System_8cpp.html#97a9df228f6eb3a96d06196263d6dc3a">UnloadButtonImage</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e747867f24c86066723ce3da34a65cd2">giMapMilitiaButtonImage</a>[ 3 ] );
<a name="l06067"></a>06067       <a class="code" href="Button_01System_8cpp.html#97a9df228f6eb3a96d06196263d6dc3a">UnloadButtonImage</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e747867f24c86066723ce3da34a65cd2">giMapMilitiaButtonImage</a>[ 4 ] );
<a name="l06068"></a>06068 
<a name="l06069"></a>06069       <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#51cc0335bcdf1be08103f8d3ab7cf85c">sSelectedMilitiaTown</a> != 0 )
<a name="l06070"></a>06070       {
<a name="l06071"></a>06071             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#c5b8184ec37de9c65012853728622cb7">HandleShutDownOfMilitiaPanelIfPeopleOnTheCursor</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#51cc0335bcdf1be08103f8d3ab7cf85c">sSelectedMilitiaTown</a> );
<a name="l06072"></a>06072       }
<a name="l06073"></a>06073 
<a name="l06074"></a>06074       <span class="comment">// redraw the map</span>
<a name="l06075"></a>06075       <a class="code" href="HelpScreen_8cpp.html#be83f0093f2fba05817df5b4592ab0f0">fMapPanelDirty</a> = TRUE;
<a name="l06076"></a>06076 
<a name="l06077"></a>06077 }
<a name="l06078"></a>06078 
<a name="l06079"></a>06079 
<a name="l06080"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#bc393ba4bb6b98212e5c9c92cbe4f443">06080</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#bc393ba4bb6b98212e5c9c92cbe4f443">MilitiaAutoButtonCallback</a>(<a class="code" href="struct__GUI__BUTTON.html">GUI_BUTTON</a> *btn,<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> reason)
<a name="l06081"></a>06081 {
<a name="l06082"></a>06082       <span class="keywordflow">if</span>(reason &amp; MSYS_CALLBACK_REASON_LBUTTON_DWN )
<a name="l06083"></a>06083       {
<a name="l06084"></a>06084     btn-&gt;<a class="code" href="struct__GUI__BUTTON.html#1ad6f5c9eb46ea98b25449008c9563d0">uiFlags</a>|=(BUTTON_CLICKED_ON);   
<a name="l06085"></a>06085       }
<a name="l06086"></a>06086       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(reason &amp; MSYS_CALLBACK_REASON_LBUTTON_UP )
<a name="l06087"></a>06087       {
<a name="l06088"></a>06088             <span class="keywordflow">if</span>( btn-&gt;<a class="code" href="struct__GUI__BUTTON.html#1ad6f5c9eb46ea98b25449008c9563d0">uiFlags</a> &amp; BUTTON_CLICKED_ON )
<a name="l06089"></a>06089             {
<a name="l06090"></a>06090                   btn-&gt;<a class="code" href="struct__GUI__BUTTON.html#1ad6f5c9eb46ea98b25449008c9563d0">uiFlags</a> &amp;= ~( BUTTON_CLICKED_ON );
<a name="l06091"></a>06091 
<a name="l06092"></a>06092                   <span class="comment">// distribute troops over all the sectors under control</span>
<a name="l06093"></a>06093                   <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#10885d60a1b859f702b95ee85dc2b441">HandleEveningOutOfTroopsAmongstSectors</a>( );
<a name="l06094"></a>06094                   <a class="code" href="HelpScreen_8cpp.html#be83f0093f2fba05817df5b4592ab0f0">fMapPanelDirty</a> = TRUE;
<a name="l06095"></a>06095             }
<a name="l06096"></a>06096       }
<a name="l06097"></a>06097 
<a name="l06098"></a>06098       <span class="keywordflow">return</span>;
<a name="l06099"></a>06099 }
<a name="l06100"></a>06100 
<a name="l06101"></a>06101 
<a name="l06102"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#58fdab56ecd9c6576936d0cf82f97a07">06102</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#58fdab56ecd9c6576936d0cf82f97a07">MilitiaDoneButtonCallback</a>(<a class="code" href="struct__GUI__BUTTON.html">GUI_BUTTON</a> *btn,<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> reason)
<a name="l06103"></a>06103 {
<a name="l06104"></a>06104       <span class="keywordflow">if</span>(reason &amp; MSYS_CALLBACK_REASON_LBUTTON_DWN )
<a name="l06105"></a>06105       {
<a name="l06106"></a>06106     btn-&gt;<a class="code" href="struct__GUI__BUTTON.html#1ad6f5c9eb46ea98b25449008c9563d0">uiFlags</a>|=(BUTTON_CLICKED_ON);   
<a name="l06107"></a>06107       }
<a name="l06108"></a>06108       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(reason &amp; MSYS_CALLBACK_REASON_LBUTTON_UP )
<a name="l06109"></a>06109       {
<a name="l06110"></a>06110             <span class="keywordflow">if</span>( btn-&gt;<a class="code" href="struct__GUI__BUTTON.html#1ad6f5c9eb46ea98b25449008c9563d0">uiFlags</a> &amp; BUTTON_CLICKED_ON )
<a name="l06111"></a>06111             {
<a name="l06112"></a>06112                   btn-&gt;<a class="code" href="struct__GUI__BUTTON.html#1ad6f5c9eb46ea98b25449008c9563d0">uiFlags</a> &amp;= ~( BUTTON_CLICKED_ON );
<a name="l06113"></a>06113 
<a name="l06114"></a>06114                   <span class="comment">// reset fact we are in the box</span>
<a name="l06115"></a>06115                   <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#51cc0335bcdf1be08103f8d3ab7cf85c">sSelectedMilitiaTown</a> = 0;
<a name="l06116"></a>06116                   <a class="code" href="HelpScreen_8cpp.html#be83f0093f2fba05817df5b4592ab0f0">fMapPanelDirty</a> = TRUE;
<a name="l06117"></a>06117             }
<a name="l06118"></a>06118       }
<a name="l06119"></a>06119 
<a name="l06120"></a>06120       <span class="keywordflow">return</span>;
<a name="l06121"></a>06121 }
<a name="l06122"></a>06122 
<a name="l06123"></a>06123 
<a name="l06124"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e13c65bca2c5d267ac0f557b5b8df1fe">06124</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e13c65bca2c5d267ac0f557b5b8df1fe">RenderShadingForUnControlledSectors</a>( <span class="keywordtype">void</span> )
<a name="l06125"></a>06125 {
<a name="l06126"></a>06126       <span class="comment">// now render shading over any uncontrolled sectors</span>
<a name="l06127"></a>06127       <span class="comment">// get the sector value for the upper left corner</span>
<a name="l06128"></a>06128       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sBaseSectorValue = 0, sCurrentSectorValue = 0, sX = 0, sY = 0;
<a name="l06129"></a>06129       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iCounter = 0;
<a name="l06130"></a>06130 
<a name="l06131"></a>06131       <span class="comment">// get the base sector value</span>
<a name="l06132"></a>06132       sBaseSectorValue = <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#a7689a7ef7f9d17f36e83a8fc26b85c2">GetBaseSectorForCurrentTown</a>( );
<a name="l06133"></a>06133 
<a name="l06134"></a>06134       <span class="comment">// render icons for map</span>
<a name="l06135"></a>06135       <span class="keywordflow">for</span>( iCounter = 0; iCounter &lt; 9; iCounter++ )
<a name="l06136"></a>06136       {
<a name="l06137"></a>06137             <span class="comment">// grab current sector value</span>
<a name="l06138"></a>06138             sCurrentSectorValue = sBaseSectorValue + ( ( iCounter % MILITIA_BOX_ROWS ) + ( iCounter / MILITIA_BOX_ROWS ) * ( 16 ) );
<a name="l06139"></a>06139 
<a name="l06140"></a>06140             <span class="keywordflow">if</span>( ( <a class="code" href="strategic_8cpp.html#6f48fb0ea28e3d4889423290f1a6ede8">StrategicMap</a>[ SECTOR_INFO_TO_STRATEGIC_INDEX( sCurrentSectorValue ) ].bNameId != <a class="code" href="mapscreen_8h.html#4d1dc70bee62b945929c96dfafebe105d008cfe091b982e6d052565ed0b5acd8">BLANK_SECTOR</a> ) &amp;&amp;
<a name="l06141"></a>06141                   ( ( <a class="code" href="strategic_8cpp.html#6f48fb0ea28e3d4889423290f1a6ede8">StrategicMap</a>[ SECTOR_INFO_TO_STRATEGIC_INDEX( sCurrentSectorValue ) ].fEnemyControlled ) || 
<a name="l06142"></a>06142                         ( <a class="code" href="Queen_01Command_8cpp.html#4c107e5449871be5bef0808839c19787">NumHostilesInSector</a>( ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> ) SECTORX( sCurrentSectorValue ), ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> ) SECTORY( sCurrentSectorValue ), 0 ) ) ) )
<a name="l06143"></a>06143             {
<a name="l06144"></a>06144                   <span class="comment">// shade this sector, not under our control</span>
<a name="l06145"></a>06145                   sX = MAP_MILITIA_BOX_POS_X + MAP_MILITIA_MAP_X + ( ( iCounter % MILITIA_BOX_ROWS ) * MILITIA_BOX_BOX_WIDTH );
<a name="l06146"></a>06146                   sY = MAP_MILITIA_BOX_POS_Y + MAP_MILITIA_MAP_Y + ( ( iCounter / MILITIA_BOX_ROWS ) * MILITIA_BOX_BOX_HEIGHT );
<a name="l06147"></a>06147 
<a name="l06148"></a>06148                   <a class="code" href="vsurface_8cpp.html#194dec4ecd9260057059d3bb0dc303a4">ShadowVideoSurfaceRect</a>( FRAME_BUFFER , sX, sY, sX + MILITIA_BOX_BOX_WIDTH - 1, sY + MILITIA_BOX_BOX_HEIGHT - 1 );
<a name="l06149"></a>06149             }
<a name="l06150"></a>06150       }
<a name="l06151"></a>06151 
<a name="l06152"></a>06152       <span class="keywordflow">return</span>;
<a name="l06153"></a>06153 }
<a name="l06154"></a>06154 
<a name="l06155"></a>06155 
<a name="l06156"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#d4aecba4696481aa3afebddd71da8db0">06156</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#d4aecba4696481aa3afebddd71da8db0">DrawTownMilitiaForcesOnMap</a>( <span class="keywordtype">void</span> )
<a name="l06157"></a>06157 {
<a name="l06158"></a>06158       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iCounter = 0, iCounterB = 0, iTotalNumberOfTroops = 0, iIconValue = 0;
<a name="l06159"></a>06159       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iNumberOfGreens = 0, iNumberOfRegulars = 0,  iNumberOfElites = 0;
<a name="l06160"></a>06160       <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hVObject; 
<a name="l06161"></a>06161       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorX = 0, sSectorY = 0;
<a name="l06162"></a>06162 
<a name="l06163"></a>06163       <span class="comment">// get militia video object</span>
<a name="l06164"></a>06164       <a class="code" href="vobject_8cpp.html#bda2b0eae4cb40e612dffd307ad5c692">GetVideoObject</a>( &amp;hVObject, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#dfe6a9ceaeceac0ea98a35881f42ad74">guiMilitia</a> );
<a name="l06165"></a>06165 
<a name="l06166"></a>06166       <span class="comment">// clip blits to mapscreen region</span>
<a name="l06167"></a>06167       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#1a814c4ade19f909f1082ca012e72ea8">ClipBlitsToMapViewRegion</a>( );
<a name="l06168"></a>06168 <span class="comment">/*    </span>
<a name="l06169"></a>06169 <span class="comment">      while( pTownNamesList[ iCounter ] != 0 )</span>
<a name="l06170"></a>06170 <span class="comment">      {</span>
<a name="l06171"></a>06171 <span class="comment">            // run through each town sector and plot the icons for the militia forces in the town</span>
<a name="l06172"></a>06172 <span class="comment">            if( !StrategicMap[ pTownLocationsList[ iCounter ] ].fEnemyControlled )</span>
<a name="l06173"></a>06173 <span class="comment">            {</span>
<a name="l06174"></a>06174 <span class="comment">                  sSectorX = GET_X_FROM_STRATEGIC_INDEX( pTownLocationsList[ iCounter ] );</span>
<a name="l06175"></a>06175 <span class="comment">                  sSectorY = GET_Y_FROM_STRATEGIC_INDEX( pTownLocationsList[ iCounter ] );</span>
<a name="l06176"></a>06176 <span class="comment"></span>
<a name="l06177"></a>06177 <span class="comment">                  // get number of each</span>
<a name="l06178"></a>06178 <span class="comment">                  iNumberOfGreens =  SectorInfo[ STRATEGIC_INDEX_TO_SECTOR_INFO( pTownLocationsList[ iCounter ] ) ].ubNumberOfCivsAtLevel[ GREEN_MILITIA ];</span>
<a name="l06179"></a>06179 <span class="comment">                  iNumberOfRegulars = SectorInfo[ STRATEGIC_INDEX_TO_SECTOR_INFO( pTownLocationsList[ iCounter ] ) ].ubNumberOfCivsAtLevel[ REGULAR_MILITIA ];</span>
<a name="l06180"></a>06180 <span class="comment">                  iNumberOfElites = SectorInfo[ STRATEGIC_INDEX_TO_SECTOR_INFO( pTownLocationsList[ iCounter ] ) ].ubNumberOfCivsAtLevel[ ELITE_MILITIA ];</span>
<a name="l06181"></a>06181 <span class="comment"></span>
<a name="l06182"></a>06182 <span class="comment">                  // set the total for loop upper bound</span>
<a name="l06183"></a>06183 <span class="comment">                  iTotalNumberOfTroops = iNumberOfGreens + iNumberOfRegulars + iNumberOfElites;</span>
<a name="l06184"></a>06184 <span class="comment"></span>
<a name="l06185"></a>06185 <span class="comment">                  for( iCounterB = 0; iCounterB &lt; iTotalNumberOfTroops; iCounterB++ )</span>
<a name="l06186"></a>06186 <span class="comment">                  {</span>
<a name="l06187"></a>06187 <span class="comment">                        if( fZoomFlag )</span>
<a name="l06188"></a>06188 <span class="comment">                        {</span>
<a name="l06189"></a>06189 <span class="comment">                              // LARGE icon offset in the .sti</span>
<a name="l06190"></a>06190 <span class="comment">                              iIconValue = 11;</span>
<a name="l06191"></a>06191 <span class="comment">                        }</span>
<a name="l06192"></a>06192 <span class="comment">                        else</span>
<a name="l06193"></a>06193 <span class="comment">                        {</span>
<a name="l06194"></a>06194 <span class="comment">                              // SMALL icon offset in the .sti</span>
<a name="l06195"></a>06195 <span class="comment">                              iIconValue = 5;</span>
<a name="l06196"></a>06196 <span class="comment">                        }</span>
<a name="l06197"></a>06197 <span class="comment"></span>
<a name="l06198"></a>06198 <span class="comment">                        // get the offset further into the .sti</span>
<a name="l06199"></a>06199 <span class="comment">                        if( iCounterB &lt; iNumberOfGreens )</span>
<a name="l06200"></a>06200 <span class="comment">                        {</span>
<a name="l06201"></a>06201 <span class="comment">                              iIconValue += 0;</span>
<a name="l06202"></a>06202 <span class="comment">                        }</span>
<a name="l06203"></a>06203 <span class="comment">                        else if( iCounterB &lt; iNumberOfGreens + iNumberOfRegulars )</span>
<a name="l06204"></a>06204 <span class="comment">                        {</span>
<a name="l06205"></a>06205 <span class="comment">                              iIconValue += 1;</span>
<a name="l06206"></a>06206 <span class="comment">                        }</span>
<a name="l06207"></a>06207 <span class="comment">                        else</span>
<a name="l06208"></a>06208 <span class="comment">                        {</span>
<a name="l06209"></a>06209 <span class="comment">                              iIconValue += 2;</span>
<a name="l06210"></a>06210 <span class="comment">                        }</span>
<a name="l06211"></a>06211 <span class="comment"></span>
<a name="l06212"></a>06212 <span class="comment">                        DrawMapBoxIcon( hVObject, ( UINT16 ) iIconValue, sSectorX, sSectorY, (UINT8) iCounterB );</span>
<a name="l06213"></a>06213 <span class="comment">                  }</span>
<a name="l06214"></a>06214 <span class="comment">            }</span>
<a name="l06215"></a>06215 <span class="comment"></span>
<a name="l06216"></a>06216 <span class="comment">            iCounter++;</span>
<a name="l06217"></a>06217 <span class="comment">      }*/</span>
<a name="l06218"></a>06218 
<a name="l06219"></a>06219       <span class="comment">// now handle militia for sam sectors</span>
<a name="l06220"></a>06220       <span class="keywordflow">for</span>( sSectorX = 0; sSectorX &lt; 16 ; ++sSectorX )
<a name="l06221"></a>06221       <span class="keywordflow">for</span>( sSectorY = 0; sSectorY &lt; 16 ; ++sSectorY )
<a name="l06222"></a>06222       <span class="comment">//for( iCounter = 0; iCounter &lt; NUMBER_OF_SAMS; iCounter++ )</span>
<a name="l06223"></a>06223       {
<a name="l06224"></a>06224 <span class="comment">//          sSectorX = SECTORX( pSamList[ iCounter ] );</span>
<a name="l06225"></a>06225 <span class="comment">//          sSectorY = SECTORY( pSamList[ iCounter ] );</span>
<a name="l06226"></a>06226 
<a name="l06227"></a>06227             <span class="keywordflow">if</span>( 1)<span class="comment">// !StrategicMap[ CALCULATE_STRATEGIC_INDEX( sSectorX, sSectorY ) ].fEnemyControlled )</span>
<a name="l06228"></a>06228             {
<a name="l06229"></a>06229                   <span class="comment">// get number of each</span>
<a name="l06230"></a>06230                   iNumberOfGreens =  <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ SECTOR( sSectorX, sSectorY )  ].ubNumberOfCivsAtLevel[ <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840b225c8d872b15875355f348d6e3335b">GREEN_MILITIA</a> ];
<a name="l06231"></a>06231                   iNumberOfRegulars = <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ SECTOR( sSectorX, sSectorY ) ].<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a845612214b681e2988ea93890806802cc9">REGULAR_MILITIA</a> ];
<a name="l06232"></a>06232                   iNumberOfElites = <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ SECTOR( sSectorX, sSectorY ) ].<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840fcf7fc556b8af2f6d3ec39652d3a927">ELITE_MILITIA</a> ];
<a name="l06233"></a>06233             
<a name="l06234"></a>06234                   <span class="comment">// ste the total for loop upper bound</span>
<a name="l06235"></a>06235                   iTotalNumberOfTroops = iNumberOfGreens + iNumberOfRegulars + iNumberOfElites;
<a name="l06236"></a>06236 
<a name="l06237"></a>06237                   <span class="keywordflow">for</span>( iCounterB = 0; iCounterB &lt; iTotalNumberOfTroops; iCounterB++ )
<a name="l06238"></a>06238                   {
<a name="l06239"></a>06239                         <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a> )
<a name="l06240"></a>06240                         {
<a name="l06241"></a>06241                               <span class="comment">// LARGE icon offset in the .sti</span>
<a name="l06242"></a>06242                               iIconValue = 11;
<a name="l06243"></a>06243                         }
<a name="l06244"></a>06244                         <span class="keywordflow">else</span>
<a name="l06245"></a>06245                         {
<a name="l06246"></a>06246                               <span class="comment">// SMALL icon offset in the .sti</span>
<a name="l06247"></a>06247                               iIconValue = 5;
<a name="l06248"></a>06248                         }
<a name="l06249"></a>06249 
<a name="l06250"></a>06250                         <span class="comment">// get the offset further into the .sti</span>
<a name="l06251"></a>06251                         <span class="keywordflow">if</span>( iCounterB &lt; iNumberOfGreens )
<a name="l06252"></a>06252                         {
<a name="l06253"></a>06253                               iIconValue += 0;
<a name="l06254"></a>06254                         }
<a name="l06255"></a>06255                         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( iCounterB &lt; iNumberOfGreens + iNumberOfRegulars )
<a name="l06256"></a>06256                         {
<a name="l06257"></a>06257                               iIconValue += 1;
<a name="l06258"></a>06258                         }
<a name="l06259"></a>06259                         <span class="keywordflow">else</span>
<a name="l06260"></a>06260                         {
<a name="l06261"></a>06261                               iIconValue += 2;
<a name="l06262"></a>06262                         }
<a name="l06263"></a>06263 
<a name="l06264"></a>06264                         <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b7bcc7ea4b4fc2491bcda5e7eb7e0bc9">DrawMapBoxIcon</a>( hVObject, ( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> ) iIconValue, sSectorX, sSectorY, (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>) iCounterB );
<a name="l06265"></a>06265                   }
<a name="l06266"></a>06266             }
<a name="l06267"></a>06267       }
<a name="l06268"></a>06268       <span class="comment">// restore clip blits</span>
<a name="l06269"></a>06269       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#1b9a9fa9699aebedd0c8b2cbd547a614">RestoreClipRegionToFullScreen</a>( );
<a name="l06270"></a>06270 
<a name="l06271"></a>06271       <span class="keywordflow">return</span>;
<a name="l06272"></a>06272 }
<a name="l06273"></a>06273 
<a name="l06274"></a>06274 
<a name="l06275"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#78743cd898c9f4452998f8dde7e19777">06275</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#78743cd898c9f4452998f8dde7e19777">CheckAndUpdateStatesOfSelectedMilitiaSectorButtons</a>( <span class="keywordtype">void</span> )
<a name="l06276"></a>06276 {
<a name="l06277"></a>06277       <span class="comment">// now set the militia map button text</span>
<a name="l06278"></a>06278       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iNumberOfGreens = 0, iNumberOfRegulars = 0, iNumberOfElites = 0;
<a name="l06279"></a>06279       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sBaseSectorValue = 0, sGlobalMapSector = 0;
<a name="l06280"></a>06280 
<a name="l06281"></a>06281       
<a name="l06282"></a>06282       <span class="keywordflow">if</span>( !<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b0091657e8418875491ae952d35663da">fMilitiaMapButtonsCreated</a> )
<a name="l06283"></a>06283       {
<a name="l06284"></a>06284             <a class="code" href="Button_01System_8cpp.html#9f61a46fd5eaed05a1ef4607a29f46e1">EnableButton</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0f4a0d61ac6bc0b9edfe8f3df3505031">giMapMilitiaButton</a>[ 4 ] );
<a name="l06285"></a>06285             <span class="keywordflow">return</span>;
<a name="l06286"></a>06286       }
<a name="l06287"></a>06287 
<a name="l06288"></a>06288       <span class="comment">// grab the appropriate global sector value in the world</span>
<a name="l06289"></a>06289       sBaseSectorValue = <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#a7689a7ef7f9d17f36e83a8fc26b85c2">GetBaseSectorForCurrentTown</a>( );
<a name="l06290"></a>06290       sGlobalMapSector = sBaseSectorValue + ( ( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#9841424d54c5cba5a386f14dfd352b0e">sSectorMilitiaMapSector</a> % MILITIA_BOX_ROWS ) + ( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#9841424d54c5cba5a386f14dfd352b0e">sSectorMilitiaMapSector</a> / MILITIA_BOX_ROWS ) * ( 16 ) );
<a name="l06291"></a>06291 
<a name="l06292"></a>06292       iNumberOfGreens =  <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ sGlobalMapSector ].<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840b225c8d872b15875355f348d6e3335b">GREEN_MILITIA</a> ] + <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#713d7ee279b00a3921e5d1d053a28e64">sGreensOnCursor</a>;
<a name="l06293"></a>06293       iNumberOfRegulars = <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ sGlobalMapSector ].<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a845612214b681e2988ea93890806802cc9">REGULAR_MILITIA</a> ] + <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7fa9e1a37309ac744098ba38183ee51d">sRegularsOnCursor</a>;
<a name="l06294"></a>06294       iNumberOfElites = <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ sGlobalMapSector ].<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840fcf7fc556b8af2f6d3ec39652d3a927">ELITE_MILITIA</a> ] + <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#799f848c53a7307d2ac4d5e5a22eed20">sElitesOnCursor</a>;
<a name="l06295"></a>06295       
<a name="l06296"></a>06296       <span class="keywordflow">if</span>( ( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#713d7ee279b00a3921e5d1d053a28e64">sGreensOnCursor</a> &gt; 0 ) || ( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7fa9e1a37309ac744098ba38183ee51d">sRegularsOnCursor</a> &gt; 0 ) || ( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#799f848c53a7307d2ac4d5e5a22eed20">sElitesOnCursor</a> &gt; 0 ) )
<a name="l06297"></a>06297       {
<a name="l06298"></a>06298             <a class="code" href="Button_01System_8cpp.html#f47071abdc2fdbae8fae4688cedaddfc">DisableButton</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0f4a0d61ac6bc0b9edfe8f3df3505031">giMapMilitiaButton</a>[ 4 ] ); <span class="comment">// DONE</span>
<a name="l06299"></a>06299       }
<a name="l06300"></a>06300       <span class="keywordflow">else</span>
<a name="l06301"></a>06301       {
<a name="l06302"></a>06302             <a class="code" href="Button_01System_8cpp.html#9f61a46fd5eaed05a1ef4607a29f46e1">EnableButton</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0f4a0d61ac6bc0b9edfe8f3df3505031">giMapMilitiaButton</a>[ 4 ] );  <span class="comment">// DONE</span>
<a name="l06303"></a>06303       }
<a name="l06304"></a>06304 
<a name="l06305"></a>06305       <span class="comment">// greens button</span>
<a name="l06306"></a>06306       <span class="keywordflow">if</span>( !iNumberOfGreens )
<a name="l06307"></a>06307       {
<a name="l06308"></a>06308             <a class="code" href="Button_01System_8cpp.html#f47071abdc2fdbae8fae4688cedaddfc">DisableButton</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0f4a0d61ac6bc0b9edfe8f3df3505031">giMapMilitiaButton</a>[ 0 ] );
<a name="l06309"></a>06309       }
<a name="l06310"></a>06310       <span class="keywordflow">else</span>
<a name="l06311"></a>06311       {
<a name="l06312"></a>06312             <a class="code" href="Button_01System_8cpp.html#9f61a46fd5eaed05a1ef4607a29f46e1">EnableButton</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0f4a0d61ac6bc0b9edfe8f3df3505031">giMapMilitiaButton</a>[ 1 ] );
<a name="l06313"></a>06313       }
<a name="l06314"></a>06314 
<a name="l06315"></a>06315       <span class="comment">// regulars button</span>
<a name="l06316"></a>06316       <span class="keywordflow">if</span>( !iNumberOfRegulars )
<a name="l06317"></a>06317       {
<a name="l06318"></a>06318             <a class="code" href="Button_01System_8cpp.html#f47071abdc2fdbae8fae4688cedaddfc">DisableButton</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0f4a0d61ac6bc0b9edfe8f3df3505031">giMapMilitiaButton</a>[ 1 ] );
<a name="l06319"></a>06319       }
<a name="l06320"></a>06320       <span class="keywordflow">else</span>
<a name="l06321"></a>06321       {
<a name="l06322"></a>06322             <a class="code" href="Button_01System_8cpp.html#9f61a46fd5eaed05a1ef4607a29f46e1">EnableButton</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0f4a0d61ac6bc0b9edfe8f3df3505031">giMapMilitiaButton</a>[ 1 ] );
<a name="l06323"></a>06323       }
<a name="l06324"></a>06324 
<a name="l06325"></a>06325       <span class="comment">// elites button</span>
<a name="l06326"></a>06326       <span class="keywordflow">if</span>( !iNumberOfElites )
<a name="l06327"></a>06327       {
<a name="l06328"></a>06328             <a class="code" href="Button_01System_8cpp.html#f47071abdc2fdbae8fae4688cedaddfc">DisableButton</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0f4a0d61ac6bc0b9edfe8f3df3505031">giMapMilitiaButton</a>[ 2 ] );
<a name="l06329"></a>06329       }
<a name="l06330"></a>06330       <span class="keywordflow">else</span>
<a name="l06331"></a>06331       {
<a name="l06332"></a>06332             <a class="code" href="Button_01System_8cpp.html#9f61a46fd5eaed05a1ef4607a29f46e1">EnableButton</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0f4a0d61ac6bc0b9edfe8f3df3505031">giMapMilitiaButton</a>[ 2 ] );
<a name="l06333"></a>06333       }
<a name="l06334"></a>06334 
<a name="l06335"></a>06335 
<a name="l06336"></a>06336       <span class="keywordflow">return</span>;
<a name="l06337"></a>06337 }
<a name="l06338"></a>06338 
<a name="l06339"></a>06339 
<a name="l06340"></a>06340 
<a name="l06341"></a>06341 
<a name="l06342"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#2fab001e92a25776b11236438c6dd5fe">06342</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#2fab001e92a25776b11236438c6dd5fe">ShadeUndergroundMapElem</a>( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorY )
<a name="l06343"></a>06343 {
<a name="l06344"></a>06344       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sScreenX, sScreenY;
<a name="l06345"></a>06345 
<a name="l06346"></a>06346       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#917041ee85b8bfbe1a319c050e137073">GetScreenXYFromMapXY</a>( sSectorX, sSectorY, &amp;sScreenX, &amp;sScreenY );
<a name="l06347"></a>06347 
<a name="l06348"></a>06348       sScreenX += 1;
<a name="l06349"></a>06349 
<a name="l06350"></a>06350       <a class="code" href="vsurface_8cpp.html#194dec4ecd9260057059d3bb0dc303a4">ShadowVideoSurfaceRect</a>( <a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a>, sScreenX, sScreenY, sScreenX + MAP_GRID_X - 2, sScreenY + MAP_GRID_Y - 2 );
<a name="l06351"></a>06351 
<a name="l06352"></a>06352       <span class="keywordflow">return</span>( TRUE );
<a name="l06353"></a>06353 }
<a name="l06354"></a>06354 
<a name="l06355"></a>06355 
<a name="l06356"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7ff4b46fb6c7a72303a1d061bbb6268e">06356</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7ff4b46fb6c7a72303a1d061bbb6268e">ShadeSubLevelsNotVisited</a>( <span class="keywordtype">void</span> )
<a name="l06357"></a>06357 {
<a name="l06358"></a>06358       <a class="code" href="structUNDERGROUND__SECTORINFO.html">UNDERGROUND_SECTORINFO</a> *pNode = <a class="code" href="Campaign_01Types_8h.html#5540f7e07268aba929d40f59d2453dd9">gpUndergroundSectorInfoHead</a>;
<a name="l06359"></a>06359 
<a name="l06360"></a>06360 
<a name="l06361"></a>06361       <span class="comment">// obtain the 16-bit version of the same color used in the mine STIs</span>
<a name="l06362"></a>06362       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#587db110241828c62da9ebbb33677d87">gusUndergroundNearBlack</a> = <a class="code" href="himage_8cpp.html#d29939ffcd39c7d1cc0a91222702d361">Get16BPPColor</a>( FROMRGB( 2, 2, 0 ) );
<a name="l06363"></a>06363 
<a name="l06364"></a>06364       <span class="comment">// run through all (real &amp; possible) underground sectors</span>
<a name="l06365"></a>06365       <span class="keywordflow">while</span>( pNode )
<a name="l06366"></a>06366       {
<a name="l06367"></a>06367             <span class="comment">// if the sector is on the currently displayed sublevel, and has never been visited</span>
<a name="l06368"></a>06368             <span class="keywordflow">if</span>( pNode-&gt;<a class="code" href="structUNDERGROUND__SECTORINFO.html#77a1e97dc913c0dac2912c380b5a0001">ubSectorZ</a> == (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>)<a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b52d71b8f7dc10a22568eb52e0c51a3e">iCurrentMapSectorZ</a> &amp;&amp; !pNode-&gt;<a class="code" href="structUNDERGROUND__SECTORINFO.html#ce215c1383674fd2d464d5c26719160c">fVisited</a> )
<a name="l06369"></a>06369             {
<a name="l06370"></a>06370                   <span class="comment">// remove that portion of the "mine" graphics from view</span>
<a name="l06371"></a>06371                   <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0aec610d7bdd806285e04c5cf47bae19">HideExistenceOfUndergroundMapSector</a>( pNode-&gt;<a class="code" href="structUNDERGROUND__SECTORINFO.html#20f20d9457f57356a12a9edb40dba87d">ubSectorX</a>, pNode-&gt;<a class="code" href="structUNDERGROUND__SECTORINFO.html#b009cc94665a4bec6da4e8aedff2570e">ubSectorY</a> );
<a name="l06372"></a>06372             }
<a name="l06373"></a>06373 
<a name="l06374"></a>06374             pNode = pNode-&gt;<a class="code" href="structUNDERGROUND__SECTORINFO.html#9c5615282a803cde32ddd09163477dfe">next</a>;
<a name="l06375"></a>06375       }
<a name="l06376"></a>06376 }
<a name="l06377"></a>06377 
<a name="l06378"></a>06378 
<a name="l06379"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#c6bca49e1a9be3a6ea99446e1b26fb9e">06379</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#c6bca49e1a9be3a6ea99446e1b26fb9e">HandleLowerLevelMapBlit</a>( <span class="keywordtype">void</span> )
<a name="l06380"></a>06380 {
<a name="l06381"></a>06381       <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hHandle;
<a name="l06382"></a>06382 
<a name="l06383"></a>06383       <span class="comment">// blits the sub level maps</span>
<a name="l06384"></a>06384       <span class="keywordflow">switch</span>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b52d71b8f7dc10a22568eb52e0c51a3e">iCurrentMapSectorZ</a> )
<a name="l06385"></a>06385       {
<a name="l06386"></a>06386             <span class="keywordflow">case</span>( 1 ):
<a name="l06387"></a>06387                   <a class="code" href="vobject_8cpp.html#bda2b0eae4cb40e612dffd307ad5c692">GetVideoObject</a>( &amp;hHandle, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#911fd69fea89aff3ff9e9bc22521fe25">guiSubLevel1</a> );
<a name="l06388"></a>06388                   <span class="keywordflow">break</span>;
<a name="l06389"></a>06389             <span class="keywordflow">case</span>( 2 ):
<a name="l06390"></a>06390                   <a class="code" href="vobject_8cpp.html#bda2b0eae4cb40e612dffd307ad5c692">GetVideoObject</a>( &amp;hHandle, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#8fdd5fee87dd95e3cecf02117495022a">guiSubLevel2</a> );
<a name="l06391"></a>06391                   <span class="keywordflow">break</span>;
<a name="l06392"></a>06392             <span class="keywordflow">case</span>( 3 ):  
<a name="l06393"></a>06393                   <a class="code" href="vobject_8cpp.html#bda2b0eae4cb40e612dffd307ad5c692">GetVideoObject</a>( &amp;hHandle, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#8b1f8e6eda2eaa198c3aad9ef31dbabc">guiSubLevel3</a> );
<a name="l06394"></a>06394                   <span class="keywordflow">break</span>;
<a name="l06395"></a>06395       }
<a name="l06396"></a>06396 
<a name="l06397"></a>06397       <span class="comment">// handle the blt of the sublevel</span>
<a name="l06398"></a>06398       <a class="code" href="vobject_8cpp.html#8a5b07441769401593743b9f52a9e353">BltVideoObject</a>( <a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a>, hHandle, 0,MAP_VIEW_START_X + 21, MAP_VIEW_START_Y + 17, VO_BLT_SRCTRANSPARENCY, NULL );
<a name="l06399"></a>06399 
<a name="l06400"></a>06400       <span class="comment">// handle shading of sublevels</span>
<a name="l06401"></a>06401       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7ff4b46fb6c7a72303a1d061bbb6268e">ShadeSubLevelsNotVisited</a>( );
<a name="l06402"></a>06402 
<a name="l06403"></a>06403       <span class="keywordflow">return</span>;
<a name="l06404"></a>06404 }
<a name="l06405"></a>06405 
<a name="l06406"></a>06406 
<a name="l06407"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#5abdab4c1c0db77e2ad4b702561480a6">06407</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#5abdab4c1c0db77e2ad4b702561480a6">MilitiaBoxMaskBtnCallback</a>(<a class="code" href="struct__MOUSE__REGION.html">MOUSE_REGION</a> * pRegion, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iReason )
<a name="l06408"></a>06408 {
<a name="l06409"></a>06409       <span class="comment">// btn callback handler for assignment screen mask region</span>
<a name="l06410"></a>06410       <span class="keywordflow">if</span>( ( iReason &amp; MSYS_CALLBACK_REASON_LBUTTON_UP )  )
<a name="l06411"></a>06411       {
<a name="l06412"></a>06412             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#9841424d54c5cba5a386f14dfd352b0e">sSectorMilitiaMapSector</a> = -1;
<a name="l06413"></a>06413       }
<a name="l06414"></a>06414       <span class="keywordflow">else</span> <span class="keywordflow">if</span>( iReason &amp; MSYS_CALLBACK_REASON_RBUTTON_UP )
<a name="l06415"></a>06415       {
<a name="l06416"></a>06416             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#9841424d54c5cba5a386f14dfd352b0e">sSectorMilitiaMapSector</a> = -1;
<a name="l06417"></a>06417       }
<a name="l06418"></a>06418 
<a name="l06419"></a>06419       <span class="keywordflow">return</span>;
<a name="l06420"></a>06420 }
<a name="l06421"></a>06421 
<a name="l06422"></a>06422 
<a name="l06423"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#80bdf52655d2ac041644726cc8a94832">06423</a> <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#80bdf52655d2ac041644726cc8a94832">GetNumberOfMilitiaInSector</a>( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorY, <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bSectorZ )
<a name="l06424"></a>06424 {
<a name="l06425"></a>06425       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iNumberInSector = 0;
<a name="l06426"></a>06426       
<a name="l06427"></a>06427       <span class="keywordflow">if</span>( !bSectorZ )
<a name="l06428"></a>06428       {
<a name="l06429"></a>06429        iNumberInSector = <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ SECTOR( sSectorX, sSectorY )].<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840b225c8d872b15875355f348d6e3335b">GREEN_MILITIA</a> ] 
<a name="l06430"></a>06430             +  <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ SECTOR( sSectorX, sSectorY )].<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a845612214b681e2988ea93890806802cc9">REGULAR_MILITIA</a> ] 
<a name="l06431"></a>06431             +  <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ SECTOR( sSectorX, sSectorY )].<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840fcf7fc556b8af2f6d3ec39652d3a927">ELITE_MILITIA</a> ];
<a name="l06432"></a>06432       }
<a name="l06433"></a>06433 
<a name="l06434"></a>06434       <span class="keywordflow">return</span>( iNumberInSector );
<a name="l06435"></a>06435 }
<a name="l06436"></a>06436 
<a name="l06437"></a>06437 
<a name="l06438"></a>06438 <span class="comment">//There is a special case flag used when players encounter enemies in a sector, then retreat.  The number of enemies</span>
<a name="l06439"></a>06439 <span class="comment">//will display on mapscreen until time is compressed.  When time is compressed, the flag is cleared, and</span>
<a name="l06440"></a>06440 <span class="comment">//a question mark is displayed to reflect that the player no longer knows.  This is the function that clears that</span>
<a name="l06441"></a>06441 <span class="comment">//flag.</span>
<a name="l06442"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#8ba63eadef5b887ef3d8c8a16480dbb2">06442</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#8ba63eadef5b887ef3d8c8a16480dbb2">ClearAnySectorsFlashingNumberOfEnemies</a>()
<a name="l06443"></a>06443 {
<a name="l06444"></a>06444       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> i;
<a name="l06445"></a>06445       <span class="keywordflow">for</span>( i = 0; i &lt; 256; i++ )
<a name="l06446"></a>06446       {
<a name="l06447"></a>06447             <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ i ].uiFlags &amp;= ~SF_PLAYER_KNOWS_ENEMIES_ARE_HERE;
<a name="l06448"></a>06448       }
<a name="l06449"></a>06449 
<a name="l06450"></a>06450       <span class="comment">// redraw map</span>
<a name="l06451"></a>06451       <a class="code" href="HelpScreen_8cpp.html#be83f0093f2fba05817df5b4592ab0f0">fMapPanelDirty</a> = TRUE;
<a name="l06452"></a>06452 }
<a name="l06453"></a>06453 
<a name="l06454"></a>06454 
<a name="l06455"></a>06455 
<a name="l06456"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#99ee2ace6b31b31373d011ccd7409bc3">06456</a> <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#99ee2ace6b31b31373d011ccd7409bc3">WhatPlayerKnowsAboutEnemiesInSector</a>( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorY )
<a name="l06457"></a>06457 {
<a name="l06458"></a>06458       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiSectorFlags = <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ SECTOR( sSectorX, sSectorY ) ].<a class="code" href="structSECTORINFO.html#ee318422648cb0f466777759ced21e13">uiFlags</a>;
<a name="l06459"></a>06459 
<a name="l06460"></a>06460 
<a name="l06461"></a>06461       <span class="comment">// if player has militia close enough to scout this sector out, if there are mercs who can scout here, OR</span>
<a name="l06462"></a>06462       <span class="comment">//Special case flag used when players encounter enemies in a sector, then retreat.  The number of enemies</span>
<a name="l06463"></a>06463       <span class="comment">//will display on mapscreen until time is compressed.  When time is compressed, the flag is cleared, and</span>
<a name="l06464"></a>06464       <span class="comment">//a question mark is displayed to reflect that the player no longer knows.</span>
<a name="l06465"></a>06465       <span class="keywordflow">if</span> ( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#5927e6105f3b94cf1573f7a72bd9cde1">CanMercsScoutThisSector</a>( sSectorX, sSectorY, 0 ) ||
<a name="l06466"></a>06466                    <a class="code" href="Town_01Militia_8cpp.html#83a51bcbaa9300d9e6497d6ac24901e3">CanNearbyMilitiaScoutThisSector</a>( sSectorX, sSectorY ) || 
<a name="l06467"></a>06467                    ( uiSectorFlags &amp; SF_PLAYER_KNOWS_ENEMIES_ARE_HERE ) )
<a name="l06468"></a>06468       {
<a name="l06469"></a>06469             <span class="comment">// if the enemies are stationary (i.e. mercs attacking a garrison)</span>
<a name="l06470"></a>06470             <span class="keywordflow">if</span> ( <a class="code" href="Queen_01Command_8cpp.html#fff37edd86e95fef787b8c75741dd154">NumStationaryEnemiesInSector</a>( sSectorX, sSectorY ) &gt; 0 )
<a name="l06471"></a>06471             {
<a name="l06472"></a>06472                   <span class="comment">// inside a garrison - hide their # (show question mark) to match what the PBI is showing</span>
<a name="l06473"></a>06473                   <span class="keywordflow">return</span> <a class="code" href="Map_01Screen_01Interface_01Map_8h.html#ff3701dfcc246bf08b07f25a2cfd9e6dc20c4064d8844ee111c7edd29c8e1ea9">KNOWS_THEYRE_THERE</a>;
<a name="l06474"></a>06474             }
<a name="l06475"></a>06475             <span class="keywordflow">else</span>
<a name="l06476"></a>06476             {
<a name="l06477"></a>06477                   <span class="comment">// other situations - show exactly how many there are</span>
<a name="l06478"></a>06478                   <span class="keywordflow">return</span> <a class="code" href="Map_01Screen_01Interface_01Map_8h.html#ff3701dfcc246bf08b07f25a2cfd9e6d263c4c345350a75664423455311cdc1d">KNOWS_HOW_MANY</a>;
<a name="l06479"></a>06479             }
<a name="l06480"></a>06480       }
<a name="l06481"></a>06481 
<a name="l06482"></a>06482       <span class="comment">// if the player has visited the sector during this game</span>
<a name="l06483"></a>06483       <span class="keywordflow">if</span>( <a class="code" href="Tactical_01Save_8cpp.html#3d497a7fd2468f74aec26360cb9018ea">GetSectorFlagStatus</a>( sSectorX, sSectorY, 0, SF_ALREADY_VISITED ) == TRUE )
<a name="l06484"></a>06484       {
<a name="l06485"></a>06485             <span class="comment">// then he always knows about any enemy presence for the remainder of the game, but not exact numbers</span>
<a name="l06486"></a>06486             <span class="keywordflow">return</span> <a class="code" href="Map_01Screen_01Interface_01Map_8h.html#ff3701dfcc246bf08b07f25a2cfd9e6dc20c4064d8844ee111c7edd29c8e1ea9">KNOWS_THEYRE_THERE</a>;
<a name="l06487"></a>06487       }
<a name="l06488"></a>06488 
<a name="l06489"></a>06489       <span class="comment">// if Skyrider noticed the enemis in the sector recently</span>
<a name="l06490"></a>06490       <span class="keywordflow">if</span> ( uiSectorFlags &amp; SF_SKYRIDER_NOTICED_ENEMIES_HERE )
<a name="l06491"></a>06491       {
<a name="l06492"></a>06492             <span class="comment">// and Skyrider is still in this sector, flying</span>
<a name="l06493"></a>06493             <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#7bc4afb37ebca146332480027103dae8">IsSkyriderIsFlyingInSector</a>( sSectorX, sSectorY ) )
<a name="l06494"></a>06494             {
<a name="l06495"></a>06495                   <span class="comment">// player remains aware of them as long as Skyrider remains in the sector</span>
<a name="l06496"></a>06496                   <span class="keywordflow">return</span> <a class="code" href="Map_01Screen_01Interface_01Map_8h.html#ff3701dfcc246bf08b07f25a2cfd9e6dc20c4064d8844ee111c7edd29c8e1ea9">KNOWS_THEYRE_THERE</a>;
<a name="l06497"></a>06497             }
<a name="l06498"></a>06498             <span class="keywordflow">else</span>
<a name="l06499"></a>06499             {
<a name="l06500"></a>06500                   <span class="comment">// Skyrider is gone, reset the flag that he noticed enemies here</span>
<a name="l06501"></a>06501                   <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ SECTOR( sSectorX, sSectorY ) ].<a class="code" href="structSECTORINFO.html#ee318422648cb0f466777759ced21e13">uiFlags</a> &amp;= ~SF_SKYRIDER_NOTICED_ENEMIES_HERE;
<a name="l06502"></a>06502             }
<a name="l06503"></a>06503       }
<a name="l06504"></a>06504 
<a name="l06505"></a>06505 
<a name="l06506"></a>06506       <span class="comment">// no information available</span>
<a name="l06507"></a>06507       <span class="keywordflow">return</span> <a class="code" href="Map_01Screen_01Interface_01Map_8h.html#ff3701dfcc246bf08b07f25a2cfd9e6d3451cb25dd13c653b430acf439889442">KNOWS_NOTHING</a>;
<a name="l06508"></a>06508 }
<a name="l06509"></a>06509 
<a name="l06510"></a>06510 
<a name="l06511"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#5927e6105f3b94cf1573f7a72bd9cde1">06511</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#5927e6105f3b94cf1573f7a72bd9cde1">CanMercsScoutThisSector</a>( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorY, <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bSectorZ )
<a name="l06512"></a>06512 {
<a name="l06513"></a>06513       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iFirstId = 0, iLastId = 0;
<a name="l06514"></a>06514       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iCounter = 0;
<a name="l06515"></a>06515       <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> = NULL;
<a name="l06516"></a>06516 
<a name="l06517"></a>06517 
<a name="l06518"></a>06518       <span class="comment">// to speed it up a little?</span>
<a name="l06519"></a>06519       iFirstId = <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#2ecddfe580bb019bc92cc4859eaf3edc">Team</a>[ OUR_TEAM ].<a class="code" href="structTacticalTeamType.html#f8fe819ad07b242f5dbf97fd4c69b00d">bFirstID</a>;
<a name="l06520"></a>06520       iLastId = <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#2ecddfe580bb019bc92cc4859eaf3edc">Team</a>[ OUR_TEAM ].<a class="code" href="structTacticalTeamType.html#6a887279dad735dc302f21c1e559d5ce">bLastID</a>;
<a name="l06521"></a>06521 
<a name="l06522"></a>06522       <span class="keywordflow">for</span>( iCounter = iFirstId; iCounter &lt;= iLastId; iCounter++ )
<a name="l06523"></a>06523       {
<a name="l06524"></a>06524             <span class="comment">// get the soldier</span>
<a name="l06525"></a>06525             <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> = &amp;<a class="code" href="Overhead_8cpp.html#f1785e87ea281d015350ec85b9bd8508">Menptr</a>[ iCounter ];
<a name="l06526"></a>06526 
<a name="l06527"></a>06527             <span class="comment">// is the soldier active</span>
<a name="l06528"></a>06528             <span class="keywordflow">if</span>( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#653dad4e2520784e293eca9f948b8532">bActive</a> == FALSE )
<a name="l06529"></a>06529             {
<a name="l06530"></a>06530                   <span class="keywordflow">continue</span>;
<a name="l06531"></a>06531             }
<a name="l06532"></a>06532 
<a name="l06533"></a>06533             <span class="comment">// vehicles can't scout!</span>
<a name="l06534"></a>06534             <span class="keywordflow">if</span> ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#eb633099940bc20ff5a969bce84eab42">uiStatusFlags</a> &amp; SOLDIER_VEHICLE )
<a name="l06535"></a>06535             {
<a name="l06536"></a>06536                   <span class="keywordflow">continue</span>;
<a name="l06537"></a>06537             }
<a name="l06538"></a>06538 
<a name="l06539"></a>06539             <span class="comment">// POWs, dead guys, guys in transit, sleeping, and really hurt guys can't scout!</span>
<a name="l06540"></a>06540             <span class="keywordflow">if</span> ( ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#4269b53195147b458cd1e6874429734b">bAssignment</a> == <a class="code" href="Assignments_8h.html#16db4876b192da08f3ad0cb41afe516fb61244da1eb29e186f8bef98fdfe215a">IN_TRANSIT</a> ) ||
<a name="l06541"></a>06541                          ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#4269b53195147b458cd1e6874429734b">bAssignment</a> == <a class="code" href="Assignments_8h.html#16db4876b192da08f3ad0cb41afe516fe351501d216ef5176da170f600a62026">ASSIGNMENT_POW</a> ) ||
<a name="l06542"></a>06542                          ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#4269b53195147b458cd1e6874429734b">bAssignment</a> == <a class="code" href="Assignments_8h.html#16db4876b192da08f3ad0cb41afe516f718052d73bd10f66df29c7cc2cba8968">ASSIGNMENT_DEAD</a> ) ||
<a name="l06543"></a>06543                          ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> -&gt; fMercAsleep == TRUE ) ||
<a name="l06544"></a>06544                          ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#e308dea18533bf5ab2bcee5bbe27391c">bLife</a> &lt; OKLIFE ) )
<a name="l06545"></a>06545             {
<a name="l06546"></a>06546                   <span class="keywordflow">continue</span>;
<a name="l06547"></a>06547             }
<a name="l06548"></a>06548 
<a name="l06549"></a>06549             <span class="comment">// don't count mercs aboard Skyrider</span>
<a name="l06550"></a>06550             <span class="keywordflow">if</span> ( ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#4269b53195147b458cd1e6874429734b">bAssignment</a> == <a class="code" href="Assignments_8h.html#16db4876b192da08f3ad0cb41afe516fda30f0dfe7c99ccb74e83ba77c5c118d">VEHICLE</a> ) &amp;&amp; ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#401564d4b34b3239805a3ba930e0cb74">iVehicleId</a> == <a class="code" href="Map_01Screen_01Helicopter_8cpp.html#83461889711d71f15a4546aee8f6c062">iHelicopterVehicleId</a> ) )
<a name="l06551"></a>06551             {
<a name="l06552"></a>06552                   <span class="keywordflow">continue</span>;
<a name="l06553"></a>06553             }
<a name="l06554"></a>06554 
<a name="l06555"></a>06555             <span class="comment">// mercs on the move can't scout</span>
<a name="l06556"></a>06556             <span class="keywordflow">if</span> ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#f66e3396115e7d6b63d661a57d3e6895">fBetweenSectors</a> )
<a name="l06557"></a>06557             {
<a name="l06558"></a>06558                   <span class="keywordflow">continue</span>;
<a name="l06559"></a>06559             }
<a name="l06560"></a>06560 
<a name="l06561"></a>06561             <span class="comment">// is he here?</span>
<a name="l06562"></a>06562             <span class="keywordflow">if</span>( ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#6784346500db10daed06c2db02b855c0">sSectorX</a> == sSectorX ) &amp;&amp; ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#6dd68e70c3000beb79e4ac45d28a0cbf">sSectorY</a> == sSectorY ) &amp;&amp; ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#b70b761f0405cc179c1ffba84484df28">bSectorZ</a> == bSectorZ ) )
<a name="l06563"></a>06563             {
<a name="l06564"></a>06564                   <span class="keywordflow">return</span>( TRUE );
<a name="l06565"></a>06565             }
<a name="l06566"></a>06566       }
<a name="l06567"></a>06567 
<a name="l06568"></a>06568       <span class="comment">// none here who can scout</span>
<a name="l06569"></a>06569       <span class="keywordflow">return</span>( FALSE );
<a name="l06570"></a>06570 }
<a name="l06571"></a>06571 
<a name="l06572"></a>06572 
<a name="l06573"></a>06573 
<a name="l06574"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#498fe80d6c2f11f8c084a096628f93f0">06574</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#498fe80d6c2f11f8c084a096628f93f0">HandleShowingOfEnemyForcesInSector</a>( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorY, <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bSectorZ, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubIconPosition )
<a name="l06575"></a>06575 {
<a name="l06576"></a>06576       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sNumberOfEnemies = 0;
<a name="l06577"></a>06577 
<a name="l06578"></a>06578 
<a name="l06579"></a>06579       <span class="comment">// ATE: If game has just started, don't do it!</span>
<a name="l06580"></a>06580       <span class="keywordflow">if</span> ( <a class="code" href="Game_01Clock_8cpp.html#547947bbfa0b83b2c8a54c144cc69463">DidGameJustStart</a>() )
<a name="l06581"></a>06581       {
<a name="l06582"></a>06582             <span class="keywordflow">return</span>;
<a name="l06583"></a>06583       }
<a name="l06584"></a>06584 
<a name="l06585"></a>06585       <span class="comment">// never display enemies underground - sector info doesn't have support for it!</span>
<a name="l06586"></a>06586       <span class="keywordflow">if</span>( bSectorZ != 0 )
<a name="l06587"></a>06587       {
<a name="l06588"></a>06588             <span class="keywordflow">return</span>;
<a name="l06589"></a>06589       }
<a name="l06590"></a>06590 
<a name="l06591"></a>06591       <span class="comment">// get total number of badguys here</span>
<a name="l06592"></a>06592       sNumberOfEnemies = <a class="code" href="Queen_01Command_8cpp.html#d8bc05237d5fab5063d680045f945c48">NumEnemiesInSector</a>( sSectorX, sSectorY );
<a name="l06593"></a>06593 
<a name="l06594"></a>06594       <span class="comment">// anyone here?</span>
<a name="l06595"></a>06595       <span class="keywordflow">if</span>( !sNumberOfEnemies )
<a name="l06596"></a>06596       {
<a name="l06597"></a>06597             <span class="comment">// nope - display nothing</span>
<a name="l06598"></a>06598             <span class="keywordflow">return</span>;
<a name="l06599"></a>06599       }
<a name="l06600"></a>06600 
<a name="l06601"></a>06601 
<a name="l06602"></a>06602       <span class="keywordflow">switch</span> ( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#99ee2ace6b31b31373d011ccd7409bc3">WhatPlayerKnowsAboutEnemiesInSector</a>( sSectorX, sSectorY ) )
<a name="l06603"></a>06603       {
<a name="l06604"></a>06604             <span class="keywordflow">case</span> <a class="code" href="Map_01Screen_01Interface_01Map_8h.html#ff3701dfcc246bf08b07f25a2cfd9e6d3451cb25dd13c653b430acf439889442">KNOWS_NOTHING</a>:
<a name="l06605"></a>06605                   <span class="comment">// display nothing</span>
<a name="l06606"></a>06606                   <span class="keywordflow">break</span>;
<a name="l06607"></a>06607 
<a name="l06608"></a>06608             <span class="keywordflow">case</span> <a class="code" href="Map_01Screen_01Interface_01Map_8h.html#ff3701dfcc246bf08b07f25a2cfd9e6dc20c4064d8844ee111c7edd29c8e1ea9">KNOWS_THEYRE_THERE</a>:
<a name="l06609"></a>06609                   <span class="comment">// display a question mark</span>
<a name="l06610"></a>06610                   <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#8678bb495f91e6f5eda20160f6b046da">ShowUncertainNumberEnemiesInSector</a>( sSectorX, sSectorY );
<a name="l06611"></a>06611                   <span class="keywordflow">break</span>;
<a name="l06612"></a>06612 
<a name="l06613"></a>06613             <span class="keywordflow">case</span> <a class="code" href="Map_01Screen_01Interface_01Map_8h.html#ff3701dfcc246bf08b07f25a2cfd9e6d263c4c345350a75664423455311cdc1d">KNOWS_HOW_MANY</a>:
<a name="l06614"></a>06614                   <span class="comment">// display individual icons for each enemy, starting at the received icon position index</span>
<a name="l06615"></a>06615                   <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#9b56312b0b61092011c732d22a4c1e3f">ShowEnemiesInSector</a>( sSectorX, sSectorY, sNumberOfEnemies, ubIconPosition );
<a name="l06616"></a>06616                   <span class="keywordflow">break</span>;
<a name="l06617"></a>06617       }
<a name="l06618"></a>06618 }
<a name="l06619"></a>06619 
<a name="l06620"></a>06620 
<a name="l06621"></a>06621 <span class="comment">/*</span>
<a name="l06622"></a>06622 <span class="comment">UINT8 NumActiveCharactersInSector( INT16 sSectorX, INT16 sSectorY, INT16 bSectorZ )</span>
<a name="l06623"></a>06623 <span class="comment">{</span>
<a name="l06624"></a>06624 <span class="comment">      INT32 iCounter = 0;</span>
<a name="l06625"></a>06625 <span class="comment">      SOLDIERTYPE *pSoldier = NULL;</span>
<a name="l06626"></a>06626 <span class="comment">      UINT8 ubNumberOnTeam = 0;</span>
<a name="l06627"></a>06627 <span class="comment"></span>
<a name="l06628"></a>06628 <span class="comment">      for( iCounter = 0; iCounter &lt; MAX_CHARACTER_COUNT; iCounter++ )</span>
<a name="l06629"></a>06629 <span class="comment">      {</span>
<a name="l06630"></a>06630 <span class="comment">            if( gCharactersList[ iCounter ].fValid )</span>
<a name="l06631"></a>06631 <span class="comment">            {</span>
<a name="l06632"></a>06632 <span class="comment">                  pSoldier = &amp;( Menptr[ gCharactersList[ iCounter ].usSolID ] );</span>
<a name="l06633"></a>06633 <span class="comment"></span>
<a name="l06634"></a>06634 <span class="comment">                  if( pSoldier-&gt;bActive &amp;&amp; ( pSoldier-&gt;bLife &gt; 0 ) &amp;&amp;</span>
<a name="l06635"></a>06635 <span class="comment">                              ( pSoldier-&gt;bAssignment != ASSIGNMENT_POW ) &amp;&amp; ( pSoldier-&gt;bAssignment != IN_TRANSIT ) )</span>
<a name="l06636"></a>06636 <span class="comment">                  {</span>
<a name="l06637"></a>06637 <span class="comment">                        if( ( pSoldier-&gt;sSectorX == sSectorX ) &amp;&amp; ( pSoldier-&gt;sSectorY == sSectorY ) &amp;&amp; ( pSoldier-&gt;bSectorZ == bSectorZ ) )</span>
<a name="l06638"></a>06638 <span class="comment">                              ubNumberOnTeam++;</span>
<a name="l06639"></a>06639 <span class="comment">                  }</span>
<a name="l06640"></a>06640 <span class="comment">            }</span>
<a name="l06641"></a>06641 <span class="comment">      }</span>
<a name="l06642"></a>06642 <span class="comment"></span>
<a name="l06643"></a>06643 <span class="comment">      return( ubNumberOnTeam );</span>
<a name="l06644"></a>06644 <span class="comment">}</span>
<a name="l06645"></a>06645 <span class="comment">*/</span>
<a name="l06646"></a>06646 
<a name="l06647"></a>06647 
<a name="l06648"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0df6cbd01ba47dadf43d4a78f6895666">06648</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0df6cbd01ba47dadf43d4a78f6895666">ShowSAMSitesOnStrategicMap</a>( <span class="keywordtype">void</span> )
<a name="l06649"></a>06649 {
<a name="l06650"></a>06650       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iCounter = 0;
<a name="l06651"></a>06651       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorX = 0, sSectorY = 0;
<a name="l06652"></a>06652       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sX = 0, sY = 0;
<a name="l06653"></a>06653       <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hHandle;
<a name="l06654"></a>06654       <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> ubVidObjIndex = 0;
<a name="l06655"></a>06655       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *pDestBuf2;
<a name="l06656"></a>06656       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES;
<a name="l06657"></a>06657       <a class="code" href="Types_8h.html#fcdf88c1d4179fcd6d8a1fa9bbcb8a80">CHAR16</a> wString[ 40 ];
<a name="l06658"></a>06658 
<a name="l06659"></a>06659 
<a name="l06660"></a>06660       <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3eb1c4052a5a9718b9b73c9851737930">fShowAircraftFlag</a> )
<a name="l06661"></a>06661       {
<a name="l06662"></a>06662             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0a4d9652b49354b91657e17b0426f111">BlitSAMGridMarkers</a>( );
<a name="l06663"></a>06663       }
<a name="l06664"></a>06664 
<a name="l06665"></a>06665       <span class="keywordflow">for</span>( iCounter = 0; iCounter &lt; <a class="code" href="Map_01Screen_01Helicopter_8h.html#a2baea0e4a061cf7eda1c9589fd7c4fe96d618b0be189a03cf8e22aabfc1158f">NUMBER_OF_SAM_SITES</a>; iCounter++ )
<a name="l06666"></a>06666       {
<a name="l06667"></a>06667             <span class="comment">// has the sam site here been found?</span>
<a name="l06668"></a>06668             <span class="keywordflow">if</span>( !<a class="code" href="strategicmap_8cpp.html#4bd9ad7468be30de044b81f9fee6172f">fSamSiteFound</a>[ iCounter ] )
<a name="l06669"></a>06669             {
<a name="l06670"></a>06670                   <span class="keywordflow">continue</span>;
<a name="l06671"></a>06671             }
<a name="l06672"></a>06672 
<a name="l06673"></a>06673             <span class="comment">// get the sector x and y</span>
<a name="l06674"></a>06674             sSectorX = <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#a20225c9d218e76d1bc7f9047353c5a4">gpSamSectorX</a>[ iCounter ];
<a name="l06675"></a>06675             sSectorY = <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#d306da49d3e48410b554619c8ab0e1bf">gpSamSectorY</a>[ iCounter ];
<a name="l06676"></a>06676 
<a name="l06677"></a>06677             <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a> )
<a name="l06678"></a>06678             {
<a name="l06679"></a>06679                   pDestBuf2 = <a class="code" href="vsurface_8cpp.html#592b2aeda6075fcbf9d7c67dc44fbd47">LockVideoSurface</a>( <a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a>, &amp;uiDestPitchBYTES );
<a name="l06680"></a>06680                   <a class="code" href="line_8cpp.html#03cb6a8fa3b4bbdfcdab02c903bc7b7e">SetClippingRegionAndImageWidth</a>( uiDestPitchBYTES, MAP_VIEW_START_X+MAP_GRID_X - 1, MAP_VIEW_START_Y+MAP_GRID_Y - 1, MAP_VIEW_WIDTH+1,MAP_VIEW_HEIGHT-9 );
<a name="l06681"></a>06681                   <a class="code" href="vsurface_8cpp.html#abe4e4124597b70b046a3b3567002cb2">UnLockVideoSurface</a>(<a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a>);
<a name="l06682"></a>06682 
<a name="l06683"></a>06683                   <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#61b609e8ae7546838d7b9b106d25ff3a">GetScreenXYFromMapXYStationary</a>( sSectorX, sSectorY, &amp;sX, &amp;sY );
<a name="l06684"></a>06684                   sX -= 8;
<a name="l06685"></a>06685                   sY -= 10;
<a name="l06686"></a>06686                   ubVidObjIndex = 0;
<a name="l06687"></a>06687             }
<a name="l06688"></a>06688             <span class="keywordflow">else</span>
<a name="l06689"></a>06689             {
<a name="l06690"></a>06690                   <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#917041ee85b8bfbe1a319c050e137073">GetScreenXYFromMapXY</a>( sSectorX, sSectorY, &amp;sX, &amp;sY );
<a name="l06691"></a>06691                   sX += 5;
<a name="l06692"></a>06692                   sY += 3;
<a name="l06693"></a>06693                   ubVidObjIndex = 1;
<a name="l06694"></a>06694             }
<a name="l06695"></a>06695 
<a name="l06696"></a>06696             <span class="comment">// draw SAM site icon</span>
<a name="l06697"></a>06697             <a class="code" href="vobject_8cpp.html#bda2b0eae4cb40e612dffd307ad5c692">GetVideoObject</a>( &amp;hHandle, <a class="code" href="Map_01Screen_01Interface_8cpp.html#c2f9c9ede613283e21d96bfbb2f410c3">guiSAMICON</a>);
<a name="l06698"></a>06698             <a class="code" href="vobject_8cpp.html#8a5b07441769401593743b9f52a9e353">BltVideoObject</a>( <a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a>, hHandle, ubVidObjIndex, sX, sY, VO_BLT_SRCTRANSPARENCY, NULL );
<a name="l06699"></a>06699 
<a name="l06700"></a>06700 
<a name="l06701"></a>06701             <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3eb1c4052a5a9718b9b73c9851737930">fShowAircraftFlag</a> )
<a name="l06702"></a>06702             {
<a name="l06703"></a>06703                   <span class="comment">// write "SAM Site" centered underneath</span>
<a name="l06704"></a>06704 
<a name="l06705"></a>06705                   <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a> )
<a name="l06706"></a>06706                   {
<a name="l06707"></a>06707                         sX +=  9;
<a name="l06708"></a>06708                         sY += 19;
<a name="l06709"></a>06709                   }
<a name="l06710"></a>06710                   <span class="keywordflow">else</span>
<a name="l06711"></a>06711                   {
<a name="l06712"></a>06712                         sX +=  6;
<a name="l06713"></a>06713                         sY += 16;
<a name="l06714"></a>06714                   }
<a name="l06715"></a>06715 
<a name="l06716"></a>06716                   <a class="code" href="Sys_01Globals_8h.html#3d1e5716a3d04a53b8846319dd57da83">wcscpy</a>( wString, <a class="code" href="__DutchText_8cpp.html#3946dc4c36ce2ef2314801447e3437c9">pLandTypeStrings</a>[ <a class="code" href="Campaign_01Types_8h.html#65a8130020b0f5722cda500f2e67acc2c993a65adb9fc0e5899eca90bb8b5aa9">SAM_SITE</a> ] );
<a name="l06717"></a>06717 
<a name="l06718"></a>06718                   <span class="comment">// we're CENTERING the first string AROUND sX, so calculate the starting X value</span>
<a name="l06719"></a>06719                   sX -= <a class="code" href="Font_8cpp.html#3bbbfeabebae07a03f719f35607c6e4f">StringPixLength</a>( wString, MAP_FONT) / 2;
<a name="l06720"></a>06720 
<a name="l06721"></a>06721                   <span class="comment">// if within view region...render, else don't</span>
<a name="l06722"></a>06722                   <span class="keywordflow">if</span>( ( sX &gt; MAP_VIEW_START_X + MAP_VIEW_WIDTH  ) || ( sX &lt; MAP_VIEW_START_X ) ||
<a name="l06723"></a>06723                               ( sY &gt; MAP_VIEW_START_Y + MAP_VIEW_HEIGHT ) || ( sY &lt; MAP_VIEW_START_Y ) )
<a name="l06724"></a>06724                   {
<a name="l06725"></a>06725                         <span class="keywordflow">continue</span>;
<a name="l06726"></a>06726                   }
<a name="l06727"></a>06727 
<a name="l06728"></a>06728 
<a name="l06729"></a>06729                   <a class="code" href="Font_8cpp.html#a038a1dc2edfc9f9c0766a0cbde2f440">SetFontDestBuffer</a>( <a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a>, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7a5ec290dc3b07a397fd9ddb6ead8fec">MapScreenRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a> + 2, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7a5ec290dc3b07a397fd9ddb6ead8fec">MapScreenRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7a5ec290dc3b07a397fd9ddb6ead8fec">MapScreenRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7a5ec290dc3b07a397fd9ddb6ead8fec">MapScreenRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>, FALSE );
<a name="l06730"></a>06730 
<a name="l06731"></a>06731                   <span class="comment">// clip blits to mapscreen region</span>
<a name="l06732"></a>06732                   <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#1a814c4ade19f909f1082ca012e72ea8">ClipBlitsToMapViewRegion</a>( );
<a name="l06733"></a>06733 
<a name="l06734"></a>06734                   <a class="code" href="Font_8cpp.html#fa4871009f0473cca0380217753947dc">SetFont</a>(MAP_FONT);
<a name="l06735"></a>06735                   <span class="comment">// Green on green doesn't contrast well, use Yellow</span>
<a name="l06736"></a>06736                   <a class="code" href="Font_8cpp.html#388be5810478c3f3bdb861f144085d70">SetFontForeground</a>(FONT_MCOLOR_LTYELLOW);
<a name="l06737"></a>06737                   <a class="code" href="Font_8cpp.html#a1fe8cc526be9e2c96b5dd66e348506f">SetFontBackground</a>(FONT_MCOLOR_BLACK);
<a name="l06738"></a>06738 
<a name="l06739"></a>06739                   <span class="comment">// draw the text</span>
<a name="l06740"></a>06740                   <a class="code" href="Render_01Dirty_8cpp.html#ae5c011dc4af8d9a67af870a92f56e1f">gprintfdirty</a>( sX, sY, wString );
<a name="l06741"></a>06741                   <a class="code" href="Font_8cpp.html#b3e12cf19a0ca58abf6689cc8eca3ead">mprintf</a>( sX, sY, wString);
<a name="l06742"></a>06742 
<a name="l06743"></a>06743                   <span class="comment">// restore clip blits</span>
<a name="l06744"></a>06744                   <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#1b9a9fa9699aebedd0c8b2cbd547a614">RestoreClipRegionToFullScreen</a>( );
<a name="l06745"></a>06745             }
<a name="l06746"></a>06746       }
<a name="l06747"></a>06747 
<a name="l06748"></a>06748       <span class="keywordflow">return</span>;
<a name="l06749"></a>06749 }
<a name="l06750"></a>06750 
<a name="l06751"></a>06751 
<a name="l06752"></a>06752 
<a name="l06753"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0a4d9652b49354b91657e17b0426f111">06753</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0a4d9652b49354b91657e17b0426f111">BlitSAMGridMarkers</a>( <span class="keywordtype">void</span> )
<a name="l06754"></a>06754 {
<a name="l06755"></a>06755       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sScreenX = 0, sScreenY = 0;
<a name="l06756"></a>06756       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>                                                             uiDestPitchBYTES;
<a name="l06757"></a>06757       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>                                                              *pDestBuf;
<a name="l06758"></a>06758       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usColor = 0;
<a name="l06759"></a>06759       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iCounter = 0;
<a name="l06760"></a>06760       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sWidth = 0, sHeight = 0;
<a name="l06761"></a>06761 
<a name="l06762"></a>06762 
<a name="l06763"></a>06763       <span class="comment">// get 16 bpp color</span>
<a name="l06764"></a>06764       usColor = <a class="code" href="himage_8cpp.html#d29939ffcd39c7d1cc0a91222702d361">Get16BPPColor</a>( FROMRGB( 100, 100, 100) );
<a name="l06765"></a>06765 
<a name="l06766"></a>06766       pDestBuf = <a class="code" href="vsurface_8cpp.html#592b2aeda6075fcbf9d7c67dc44fbd47">LockVideoSurface</a>( <a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a>, &amp;uiDestPitchBYTES );              
<a name="l06767"></a>06767 
<a name="l06768"></a>06768       <span class="comment">// clip to view region</span>
<a name="l06769"></a>06769       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0219bd63e8ae634ee810a9186579675c">ClipBlitsToMapViewRegionForRectangleAndABit</a>( uiDestPitchBYTES );
<a name="l06770"></a>06770 
<a name="l06771"></a>06771       <span class="keywordflow">for</span>( iCounter = 0; iCounter &lt; <a class="code" href="Map_01Screen_01Helicopter_8h.html#a2baea0e4a061cf7eda1c9589fd7c4fe96d618b0be189a03cf8e22aabfc1158f">NUMBER_OF_SAM_SITES</a>; iCounter++ )
<a name="l06772"></a>06772       {     
<a name="l06773"></a>06773             <span class="comment">// has the sam site here been found?</span>
<a name="l06774"></a>06774             <span class="keywordflow">if</span>( !<a class="code" href="strategicmap_8cpp.html#4bd9ad7468be30de044b81f9fee6172f">fSamSiteFound</a>[ iCounter ] )
<a name="l06775"></a>06775             {
<a name="l06776"></a>06776                   <span class="keywordflow">continue</span>;
<a name="l06777"></a>06777             }
<a name="l06778"></a>06778 
<a name="l06779"></a>06779             <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a> )
<a name="l06780"></a>06780             {
<a name="l06781"></a>06781                   <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#61b609e8ae7546838d7b9b106d25ff3a">GetScreenXYFromMapXYStationary</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#a20225c9d218e76d1bc7f9047353c5a4">gpSamSectorX</a>[ iCounter ], <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#d306da49d3e48410b554619c8ab0e1bf">gpSamSectorY</a>[ iCounter ], &amp;sScreenX, &amp;sScreenY );
<a name="l06782"></a>06782                   sScreenX -= MAP_GRID_X;
<a name="l06783"></a>06783                   sScreenY -= MAP_GRID_Y;
<a name="l06784"></a>06784 
<a name="l06785"></a>06785                   sWidth = 2 * MAP_GRID_X;
<a name="l06786"></a>06786                   sHeight= 2 * MAP_GRID_Y;
<a name="l06787"></a>06787             }
<a name="l06788"></a>06788             <span class="keywordflow">else</span>
<a name="l06789"></a>06789             {
<a name="l06790"></a>06790                   <span class="comment">// get location on screen</span>
<a name="l06791"></a>06791                   <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#917041ee85b8bfbe1a319c050e137073">GetScreenXYFromMapXY</a>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#a20225c9d218e76d1bc7f9047353c5a4">gpSamSectorX</a>[ iCounter ], <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#d306da49d3e48410b554619c8ab0e1bf">gpSamSectorY</a>[ iCounter ], &amp;sScreenX, &amp;sScreenY );
<a name="l06792"></a>06792                   sWidth = MAP_GRID_X;
<a name="l06793"></a>06793                   sHeight= MAP_GRID_Y;
<a name="l06794"></a>06794             }
<a name="l06795"></a>06795 
<a name="l06796"></a>06796             <span class="comment">// draw rectangle</span>
<a name="l06797"></a>06797             <a class="code" href="line_8cpp.html#2806e958344a513567053e98757e64b3">RectangleDraw</a>( TRUE, sScreenX, sScreenY - 1, sScreenX + sWidth, sScreenY + sHeight - 1, usColor, pDestBuf );      
<a name="l06798"></a>06798       }
<a name="l06799"></a>06799 
<a name="l06800"></a>06800       <span class="comment">// restore clips</span>
<a name="l06801"></a>06801       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#110ca869cf08f45cb41c294c0814ac6f">RestoreClipRegionToFullScreenForRectangle</a>( uiDestPitchBYTES );
<a name="l06802"></a>06802       
<a name="l06803"></a>06803       <span class="comment">// unlock surface</span>
<a name="l06804"></a>06804       <a class="code" href="vsurface_8cpp.html#abe4e4124597b70b046a3b3567002cb2">UnLockVideoSurface</a>( <a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a> );
<a name="l06805"></a>06805 
<a name="l06806"></a>06806 
<a name="l06807"></a>06807       <span class="keywordflow">return</span>;
<a name="l06808"></a>06808 }
<a name="l06809"></a>06809 
<a name="l06810"></a>06810 
<a name="l06811"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#6d3ca0774ff9c5425be15af74db4e805">06811</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#6d3ca0774ff9c5425be15af74db4e805">CanMilitiaAutoDistribute</a>( <span class="keywordtype">void</span> )
<a name="l06812"></a>06812 {
<a name="l06813"></a>06813       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iTotalTroopsOnCursor = 0;
<a name="l06814"></a>06814       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iCounter = 0;
<a name="l06815"></a>06815       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sBaseSectorValue = 0, sCurrentSectorValue = 0;
<a name="l06816"></a>06816       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorX = 0, sSectorY = 0;
<a name="l06817"></a>06817       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iTotalTroopsInTown = 0;
<a name="l06818"></a>06818 
<a name="l06819"></a>06819 
<a name="l06820"></a>06820       <span class="comment">// can't auto-distribute if we don't have a town selected (this excludes SAM sites)</span>
<a name="l06821"></a>06821       <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#51cc0335bcdf1be08103f8d3ab7cf85c">sSelectedMilitiaTown</a> == <a class="code" href="mapscreen_8h.html#4d1dc70bee62b945929c96dfafebe105d008cfe091b982e6d052565ed0b5acd8">BLANK_SECTOR</a> )            
<a name="l06822"></a>06822             <span class="keywordflow">return</span>( FALSE );
<a name="l06823"></a>06823 
<a name="l06824"></a>06824       <span class="comment">// can't auto-distribute if we don't control any sectors in the the town</span>
<a name="l06825"></a>06825       <span class="keywordflow">if</span>( !<a class="code" href="strategicmap_8cpp.html#1fab6a2009a1cd32ebff3e51921d830e">GetTownSectorsUnderControl</a>( ( <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> ) <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#51cc0335bcdf1be08103f8d3ab7cf85c">sSelectedMilitiaTown</a> ) )
<a name="l06826"></a>06826             <span class="keywordflow">return</span>( FALSE );
<a name="l06827"></a>06827 
<a name="l06828"></a>06828 
<a name="l06829"></a>06829       <span class="comment">// get the sector value for the upper left corner</span>
<a name="l06830"></a>06830       sBaseSectorValue = <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#a7689a7ef7f9d17f36e83a8fc26b85c2">GetBaseSectorForCurrentTown</a>( );
<a name="l06831"></a>06831 
<a name="l06832"></a>06832       <span class="comment">// render icons for map</span>
<a name="l06833"></a>06833       <span class="keywordflow">for</span>( iCounter = 0; iCounter &lt; 9; iCounter++ )
<a name="l06834"></a>06834       {
<a name="l06835"></a>06835             <span class="comment">// grab current sector value</span>
<a name="l06836"></a>06836             sCurrentSectorValue = sBaseSectorValue + ( ( iCounter % MILITIA_BOX_ROWS ) + ( iCounter / MILITIA_BOX_ROWS ) * ( 16 ) );
<a name="l06837"></a>06837             
<a name="l06838"></a>06838             sSectorX = SECTORX( sCurrentSectorValue );
<a name="l06839"></a>06839             sSectorY = SECTORY( sCurrentSectorValue );
<a name="l06840"></a>06840 
<a name="l06841"></a>06841             <span class="comment">// skip sectors not in the selected town (nearby other towns or wilderness SAM Sites)</span>
<a name="l06842"></a>06842             <span class="keywordflow">if</span>( <a class="code" href="strategicmap_8cpp.html#99dffd29ea4571bc0c833d45636f1403">GetTownIdForSector</a>( sSectorX, sSectorY ) != sSelectedMilitiaTown )
<a name="l06843"></a>06843             {
<a name="l06844"></a>06844                   <span class="keywordflow">continue</span>;
<a name="l06845"></a>06845             }
<a name="l06846"></a>06846 
<a name="l06847"></a>06847             <span class="keywordflow">if</span>( !<a class="code" href="strategic_8cpp.html#6f48fb0ea28e3d4889423290f1a6ede8">StrategicMap</a>[ CALCULATE_STRATEGIC_INDEX( sSectorX, sSectorY ) ].fEnemyControlled )
<a name="l06848"></a>06848             {
<a name="l06849"></a>06849                   <span class="comment">// get number of each</span>
<a name="l06850"></a>06850                   iTotalTroopsInTown += <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ sCurrentSectorValue ].<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840b225c8d872b15875355f348d6e3335b">GREEN_MILITIA</a> ] +
<a name="l06851"></a>06851                                                                                           <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ sCurrentSectorValue ].<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a845612214b681e2988ea93890806802cc9">REGULAR_MILITIA</a> ] +
<a name="l06852"></a>06852                                                                                           <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ sCurrentSectorValue ].<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840fcf7fc556b8af2f6d3ec39652d3a927">ELITE_MILITIA</a> ];
<a name="l06853"></a>06853             }
<a name="l06854"></a>06854       }
<a name="l06855"></a>06855 
<a name="l06856"></a>06856 
<a name="l06857"></a>06857       iTotalTroopsOnCursor = <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#713d7ee279b00a3921e5d1d053a28e64">sGreensOnCursor</a> + <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7fa9e1a37309ac744098ba38183ee51d">sRegularsOnCursor</a> + <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#799f848c53a7307d2ac4d5e5a22eed20">sElitesOnCursor</a>;
<a name="l06858"></a>06858 
<a name="l06859"></a>06859       <span class="comment">// can't auto-distribute if we don't have any militia in the town</span>
<a name="l06860"></a>06860       <span class="keywordflow">if</span>( !iTotalTroopsInTown )
<a name="l06861"></a>06861             <span class="keywordflow">return</span>( FALSE );
<a name="l06862"></a>06862 
<a name="l06863"></a>06863       <span class="comment">// can auto-distribute</span>
<a name="l06864"></a>06864       <span class="keywordflow">return</span>( TRUE );
<a name="l06865"></a>06865 }
<a name="l06866"></a>06866 
<a name="l06867"></a>06867 
<a name="l06868"></a>06868 
<a name="l06869"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#8d3280f0d547793d50fc051c2787e7de">06869</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#8d3280f0d547793d50fc051c2787e7de">ShowItemsOnMap</a>( <span class="keywordtype">void</span> )
<a name="l06870"></a>06870 {
<a name="l06871"></a>06871       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapX, sMapY;
<a name="l06872"></a>06872       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sXCorner, sYCorner;
<a name="l06873"></a>06873       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usXPos, usYPos;
<a name="l06874"></a>06874       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiItemCnt;
<a name="l06875"></a>06875       <a class="code" href="Types_8h.html#fcdf88c1d4179fcd6d8a1fa9bbcb8a80">CHAR16</a> sString[ 10 ];
<a name="l06876"></a>06876 
<a name="l06877"></a>06877 
<a name="l06878"></a>06878       <span class="comment">// clip blits to mapscreen region</span>
<a name="l06879"></a>06879       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#1a814c4ade19f909f1082ca012e72ea8">ClipBlitsToMapViewRegion</a>( );
<a name="l06880"></a>06880 
<a name="l06881"></a>06881       <a class="code" href="Font_8cpp.html#a038a1dc2edfc9f9c0766a0cbde2f440">SetFontDestBuffer</a>( <a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a>, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7a5ec290dc3b07a397fd9ddb6ead8fec">MapScreenRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a> + 2, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7a5ec290dc3b07a397fd9ddb6ead8fec">MapScreenRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7a5ec290dc3b07a397fd9ddb6ead8fec">MapScreenRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7a5ec290dc3b07a397fd9ddb6ead8fec">MapScreenRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a> , FALSE );
<a name="l06882"></a>06882 
<a name="l06883"></a>06883       <a class="code" href="Font_8cpp.html#fa4871009f0473cca0380217753947dc">SetFont</a>(MAP_FONT);
<a name="l06884"></a>06884   <a class="code" href="Font_8cpp.html#388be5810478c3f3bdb861f144085d70">SetFontForeground</a>(FONT_MCOLOR_LTGREEN);
<a name="l06885"></a>06885   <a class="code" href="Font_8cpp.html#a1fe8cc526be9e2c96b5dd66e348506f">SetFontBackground</a>(FONT_MCOLOR_BLACK);
<a name="l06886"></a>06886 
<a name="l06887"></a>06887       <span class="comment">// run through sectors</span>
<a name="l06888"></a>06888       <span class="keywordflow">for</span>( sMapX = 1; sMapX &lt; ( MAP_WORLD_X - 1 ); sMapX++ )
<a name="l06889"></a>06889       {
<a name="l06890"></a>06890             <span class="keywordflow">for</span>( sMapY = 1; sMapY &lt; ( MAP_WORLD_Y - 1 ); sMapY++ )
<a name="l06891"></a>06891             {
<a name="l06892"></a>06892                   <span class="comment">// to speed this up, only look at sector that player has visited</span>
<a name="l06893"></a>06893                   <span class="keywordflow">if</span>( <a class="code" href="Tactical_01Save_8cpp.html#3d497a7fd2468f74aec26360cb9018ea">GetSectorFlagStatus</a>( sMapX, sMapY, ( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ) <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b52d71b8f7dc10a22568eb52e0c51a3e">iCurrentMapSectorZ</a>, SF_ALREADY_VISITED ) )
<a name="l06894"></a>06894                   {
<a name="l06895"></a>06895 <span class="comment">//                      uiItemCnt = GetSizeOfStashInSector( sMapX, sMapY, ( INT16 ) iCurrentMapSectorZ, FALSE );</span>
<a name="l06896"></a>06896                         uiItemCnt = <a class="code" href="Tactical_01Save_8cpp.html#fe298cab0837f7028ea0891b37498f8f">GetNumberOfVisibleWorldItemsFromSectorStructureForSector</a>( sMapX, sMapY, ( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ) iCurrentMapSectorZ );
<a name="l06897"></a>06897 
<a name="l06898"></a>06898                         <span class="keywordflow">if</span> ( uiItemCnt &gt; 0 )
<a name="l06899"></a>06899                         {
<a name="l06900"></a>06900                               sXCorner = ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> )( MAP_VIEW_START_X + ( sMapX * MAP_GRID_X ) );
<a name="l06901"></a>06901                               sYCorner = ( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> )( MAP_VIEW_START_Y + ( sMapY * MAP_GRID_Y ) );
<a name="l06902"></a>06902 
<a name="l06903"></a>06903                               swprintf( sString, L<span class="stringliteral">"%d"</span>, uiItemCnt );
<a name="l06904"></a>06904 
<a name="l06905"></a>06905                               <a class="code" href="Font_8cpp.html#d08dcd11daa6a1189cb123dff18cd7c8">FindFontCenterCoordinates</a>( sXCorner, sYCorner, MAP_GRID_X, MAP_GRID_Y, sString, MAP_FONT, &amp;usXPos, &amp;usYPos );
<a name="l06906"></a>06906       <span class="comment">//                      sXPos -= StringPixLength( sString, MAP_FONT ) / 2;</span>
<a name="l06907"></a>06907 
<a name="l06908"></a>06908                               <a class="code" href="Render_01Dirty_8cpp.html#ae5c011dc4af8d9a67af870a92f56e1f">gprintfdirty</a>( usXPos, usYPos, sString );
<a name="l06909"></a>06909                               <a class="code" href="Font_8cpp.html#b3e12cf19a0ca58abf6689cc8eca3ead">mprintf</a>( usXPos, usYPos, sString );
<a name="l06910"></a>06910                         }
<a name="l06911"></a>06911                   }
<a name="l06912"></a>06912             }
<a name="l06913"></a>06913       }
<a name="l06914"></a>06914 
<a name="l06915"></a>06915 
<a name="l06916"></a>06916       <span class="comment">// restore clip blits</span>
<a name="l06917"></a>06917       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#1b9a9fa9699aebedd0c8b2cbd547a614">RestoreClipRegionToFullScreen</a>( );
<a name="l06918"></a>06918 }
<a name="l06919"></a>06919 
<a name="l06920"></a>06920 
<a name="l06921"></a>06921 
<a name="l06922"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b7bcc7ea4b4fc2491bcda5e7eb7e0bc9">06922</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b7bcc7ea4b4fc2491bcda5e7eb7e0bc9">DrawMapBoxIcon</a>( <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hIconHandle, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usVOIndex, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapY, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubIconPosition )
<a name="l06923"></a>06923 {
<a name="l06924"></a>06924   <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iRowNumber, iColumnNumber;
<a name="l06925"></a>06925       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, iY;
<a name="l06926"></a>06926 
<a name="l06927"></a>06927 
<a name="l06928"></a>06928       <span class="comment">// don't show any more icons than will fit into one sector, to keep them from spilling into sector(s) beneath</span>
<a name="l06929"></a>06929       <span class="keywordflow">if</span> ( ubIconPosition &gt;= ( MERC_ICONS_PER_LINE * ROWS_PER_SECTOR ) )
<a name="l06930"></a>06930       {
<a name="l06931"></a>06931             <span class="keywordflow">return</span>;
<a name="l06932"></a>06932       }
<a name="l06933"></a>06933 
<a name="l06934"></a>06934 
<a name="l06935"></a>06935       iColumnNumber = ubIconPosition % MERC_ICONS_PER_LINE;
<a name="l06936"></a>06936       iRowNumber    = ubIconPosition / MERC_ICONS_PER_LINE;
<a name="l06937"></a>06937 
<a name="l06938"></a>06938       <span class="keywordflow">if</span> ( !<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a> )
<a name="l06939"></a>06939       {
<a name="l06940"></a>06940             iX = MAP_VIEW_START_X + ( sMapX * MAP_GRID_X ) + MAP_X_ICON_OFFSET + ( 3 * iColumnNumber );
<a name="l06941"></a>06941             iY = MAP_VIEW_START_Y + ( sMapY * MAP_GRID_Y ) + MAP_Y_ICON_OFFSET + ( 3 * iRowNumber );
<a name="l06942"></a>06942 
<a name="l06943"></a>06943             <a class="code" href="vobject_8cpp.html#8a5b07441769401593743b9f52a9e353">BltVideoObject</a>( <a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a>, hIconHandle, usVOIndex , iX, iY, VO_BLT_SRCTRANSPARENCY, NULL );
<a name="l06944"></a>06944             <a class="code" href="video_8cpp.html#4ed7790da612ff97bf9c05cf186823bc">InvalidateRegion</a>( iX, iY, iX + DMAP_GRID_X, iY + DMAP_GRID_Y );
<a name="l06945"></a>06945       }
<a name="l06946"></a>06946 <span class="comment">/*</span>
<a name="l06947"></a>06947 <span class="comment">      else</span>
<a name="l06948"></a>06948 <span class="comment">      {</span>
<a name="l06949"></a>06949 <span class="comment">            INT sX, sY;</span>
<a name="l06950"></a>06950 <span class="comment"></span>
<a name="l06951"></a>06951 <span class="comment">            GetScreenXYFromMapXYStationary( ( UINT16 ) sX,( UINT16 ) sY, &amp;sX, &amp;sY ); </span>
<a name="l06952"></a>06952 <span class="comment">            iY = sY-MAP_GRID_Y;</span>
<a name="l06953"></a>06953 <span class="comment">            iX = sX-MAP_GRID_X;</span>
<a name="l06954"></a>06954 <span class="comment"></span>
<a name="l06955"></a>06955 <span class="comment">            // clip blits to mapscreen region</span>
<a name="l06956"></a>06956 <span class="comment">            ClipBlitsToMapViewRegion( );</span>
<a name="l06957"></a>06957 <span class="comment"></span>
<a name="l06958"></a>06958 <span class="comment">            BltVideoObject(guiSAVEBUFFER, hIconHandle,BIG_YELLOW_BOX,MAP_X_ICON_OFFSET+iX+6*iColumnNumber+2,MAP_Y_ICON_OFFSET+iY+6*iRowNumber, VO_BLT_SRCTRANSPARENCY, NULL );</span>
<a name="l06959"></a>06959 <span class="comment"></span>
<a name="l06960"></a>06960 <span class="comment">            // restore clip blits</span>
<a name="l06961"></a>06961 <span class="comment">            RestoreClipRegionToFullScreen( );</span>
<a name="l06962"></a>06962 <span class="comment">       </span>
<a name="l06963"></a>06963 <span class="comment">            InvalidateRegion(MAP_X_ICON_OFFSET+iX+6*iColumnNumber+2, MAP_Y_ICON_OFFSET+iY+6*iRowNumber,MAP_X_ICON_OFFSET+iX+6*iColumnNumber+2+ DMAP_GRID_ZOOM_X, MAP_Y_ICON_OFFSET+iY+6*iRowNumber + DMAP_GRID_ZOOM_Y );      </span>
<a name="l06964"></a>06964 <span class="comment">      }</span>
<a name="l06965"></a>06965 <span class="comment">*/</span>
<a name="l06966"></a>06966 }
<a name="l06967"></a>06967 
<a name="l06968"></a>06968 
<a name="l06969"></a>06969 
<a name="l06970"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#66d7180eb8fe0dc7fd912491a8f199e5">06970</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#66d7180eb8fe0dc7fd912491a8f199e5">DrawOrta</a>()
<a name="l06971"></a>06971 {
<a name="l06972"></a>06972       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *pDestBuf2;
<a name="l06973"></a>06973   <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES;
<a name="l06974"></a>06974       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sX, sY;
<a name="l06975"></a>06975       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubVidObjIndex;
<a name="l06976"></a>06976       <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hHandle;
<a name="l06977"></a>06977 
<a name="l06978"></a>06978 
<a name="l06979"></a>06979       <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a> )
<a name="l06980"></a>06980       {
<a name="l06981"></a>06981             pDestBuf2 = <a class="code" href="vsurface_8cpp.html#592b2aeda6075fcbf9d7c67dc44fbd47">LockVideoSurface</a>( <a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a>, &amp;uiDestPitchBYTES );
<a name="l06982"></a>06982             <a class="code" href="line_8cpp.html#03cb6a8fa3b4bbdfcdab02c903bc7b7e">SetClippingRegionAndImageWidth</a>( uiDestPitchBYTES, MAP_VIEW_START_X+MAP_GRID_X - 1, MAP_VIEW_START_Y+MAP_GRID_Y - 1, MAP_VIEW_WIDTH+1,MAP_VIEW_HEIGHT-9 );
<a name="l06983"></a>06983             <a class="code" href="vsurface_8cpp.html#abe4e4124597b70b046a3b3567002cb2">UnLockVideoSurface</a>(<a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a>);
<a name="l06984"></a>06984 
<a name="l06985"></a>06985             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#61b609e8ae7546838d7b9b106d25ff3a">GetScreenXYFromMapXYStationary</a>( ORTA_SECTOR_X, ORTA_SECTOR_Y, &amp;sX, &amp;sY );
<a name="l06986"></a>06986             sX += -MAP_GRID_X + 2;
<a name="l06987"></a>06987             sY += -MAP_GRID_Y - 6;
<a name="l06988"></a>06988             ubVidObjIndex = 0;
<a name="l06989"></a>06989       }
<a name="l06990"></a>06990       <span class="keywordflow">else</span>
<a name="l06991"></a>06991       {
<a name="l06992"></a>06992             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#917041ee85b8bfbe1a319c050e137073">GetScreenXYFromMapXY</a>( ORTA_SECTOR_X, ORTA_SECTOR_Y, &amp;sX, &amp;sY );
<a name="l06993"></a>06993             sX += +2;
<a name="l06994"></a>06994             sY += -3;
<a name="l06995"></a>06995             ubVidObjIndex = 1;
<a name="l06996"></a>06996       }
<a name="l06997"></a>06997 
<a name="l06998"></a>06998       <span class="comment">// draw Orta in its sector</span>
<a name="l06999"></a>06999       <a class="code" href="vobject_8cpp.html#bda2b0eae4cb40e612dffd307ad5c692">GetVideoObject</a>( &amp;hHandle, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#69311101fb9e53baa97c0410e7159c2a">guiORTAICON</a>);
<a name="l07000"></a>07000       <a class="code" href="vobject_8cpp.html#8a5b07441769401593743b9f52a9e353">BltVideoObject</a>( <a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a>, hHandle, ubVidObjIndex, sX, sY, VO_BLT_SRCTRANSPARENCY, NULL );
<a name="l07001"></a>07001 }
<a name="l07002"></a>07002 
<a name="l07003"></a>07003 
<a name="l07004"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e50442e5f151eddeb3e8d754d3c8fdb1">07004</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e50442e5f151eddeb3e8d754d3c8fdb1">DrawTixa</a>()
<a name="l07005"></a>07005 {
<a name="l07006"></a>07006       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *pDestBuf2;
<a name="l07007"></a>07007   <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES;
<a name="l07008"></a>07008       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sX, sY;
<a name="l07009"></a>07009       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubVidObjIndex;
<a name="l07010"></a>07010       <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hHandle;
<a name="l07011"></a>07011 
<a name="l07012"></a>07012 
<a name="l07013"></a>07013       <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#3c600dd46f65c5132150646b6060e5cc">fZoomFlag</a> )
<a name="l07014"></a>07014       {
<a name="l07015"></a>07015             pDestBuf2 = <a class="code" href="vsurface_8cpp.html#592b2aeda6075fcbf9d7c67dc44fbd47">LockVideoSurface</a>( <a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a>, &amp;uiDestPitchBYTES );
<a name="l07016"></a>07016             <a class="code" href="line_8cpp.html#03cb6a8fa3b4bbdfcdab02c903bc7b7e">SetClippingRegionAndImageWidth</a>( uiDestPitchBYTES, MAP_VIEW_START_X+MAP_GRID_X - 1, MAP_VIEW_START_Y+MAP_GRID_Y - 1, MAP_VIEW_WIDTH+1,MAP_VIEW_HEIGHT-9 );
<a name="l07017"></a>07017             <a class="code" href="vsurface_8cpp.html#abe4e4124597b70b046a3b3567002cb2">UnLockVideoSurface</a>(<a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a>);
<a name="l07018"></a>07018 
<a name="l07019"></a>07019             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#61b609e8ae7546838d7b9b106d25ff3a">GetScreenXYFromMapXYStationary</a>( TIXA_SECTOR_X, TIXA_SECTOR_Y, &amp;sX, &amp;sY );
<a name="l07020"></a>07020             sX += -MAP_GRID_X + 3;
<a name="l07021"></a>07021             sY += -MAP_GRID_Y + 6;
<a name="l07022"></a>07022             ubVidObjIndex = 0;
<a name="l07023"></a>07023       }
<a name="l07024"></a>07024       <span class="keywordflow">else</span>
<a name="l07025"></a>07025       {
<a name="l07026"></a>07026             <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#917041ee85b8bfbe1a319c050e137073">GetScreenXYFromMapXY</a>( TIXA_SECTOR_X, TIXA_SECTOR_Y, &amp;sX, &amp;sY );
<a name="l07027"></a>07027             sY += +2;
<a name="l07028"></a>07028             ubVidObjIndex = 1;
<a name="l07029"></a>07029       }
<a name="l07030"></a>07030 
<a name="l07031"></a>07031       <span class="comment">// draw Tixa in its sector</span>
<a name="l07032"></a>07032       <a class="code" href="vobject_8cpp.html#bda2b0eae4cb40e612dffd307ad5c692">GetVideoObject</a>( &amp;hHandle, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#3c0d169cfe47645fc0d4dcc9639068d8">guiTIXAICON</a>);
<a name="l07033"></a>07033       <a class="code" href="vobject_8cpp.html#8a5b07441769401593743b9f52a9e353">BltVideoObject</a>( <a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a>, hHandle, ubVidObjIndex, sX, sY, VO_BLT_SRCTRANSPARENCY, NULL );
<a name="l07034"></a>07034 }
<a name="l07035"></a>07035 
<a name="l07036"></a>07036 
<a name="l07037"></a>07037 
<a name="l07038"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b6ed1a16108070185eaf479ab634e5e6">07038</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#b6ed1a16108070185eaf479ab634e5e6">DrawBullseye</a>()
<a name="l07039"></a>07039 {
<a name="l07040"></a>07040       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sX, sY;
<a name="l07041"></a>07041       <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hHandle;
<a name="l07042"></a>07042 
<a name="l07043"></a>07043       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#917041ee85b8bfbe1a319c050e137073">GetScreenXYFromMapXY</a>( <a class="code" href="Merc_01Hiring_8cpp.html#ead2770aecb6815162534d28328fb156">gsMercArriveSectorX</a>, <a class="code" href="Merc_01Hiring_8cpp.html#cb5c5b4505ee042ade18b22eb63a8d46">gsMercArriveSectorY</a>, &amp;sX, &amp;sY );
<a name="l07044"></a>07044       sY -= 2;
<a name="l07045"></a>07045 
<a name="l07046"></a>07046       <span class="comment">// draw the bullseye in that sector</span>
<a name="l07047"></a>07047       <a class="code" href="vobject_8cpp.html#bda2b0eae4cb40e612dffd307ad5c692">GetVideoObject</a>( &amp;hHandle, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#7b4aad02581a1bc4a1e7bb34e348e118">guiBULLSEYE</a>);
<a name="l07048"></a>07048       <a class="code" href="vobject_8cpp.html#8a5b07441769401593743b9f52a9e353">BltVideoObject</a>( <a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a>, hHandle, 0, sX, sY, VO_BLT_SRCTRANSPARENCY, NULL );
<a name="l07049"></a>07049 }
<a name="l07050"></a>07050 
<a name="l07051"></a>07051 
<a name="l07052"></a>07052 
<a name="l07053"></a><a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0aec610d7bdd806285e04c5cf47bae19">07053</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0aec610d7bdd806285e04c5cf47bae19">HideExistenceOfUndergroundMapSector</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubSectorX, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubSectorY )
<a name="l07054"></a>07054 {
<a name="l07055"></a>07055       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sScreenX;
<a name="l07056"></a>07056       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sScreenY;
<a name="l07057"></a>07057 
<a name="l07058"></a>07058       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#917041ee85b8bfbe1a319c050e137073">GetScreenXYFromMapXY</a>( ubSectorX, ubSectorY, &amp;sScreenX, &amp;sScreenY );
<a name="l07059"></a>07059 
<a name="l07060"></a>07060       <span class="comment">// fill it with near black</span>
<a name="l07061"></a>07061       <a class="code" href="vsurface_8cpp.html#10d0257b54c4d27b2d82ead2a46cd581">ColorFillVideoSurfaceArea</a>( <a class="code" href="Map_01Screen_01Interface_8cpp.html#7d9956b05e9b87e244d4fdab6c4f71e4">guiSAVEBUFFER</a>, sScreenX + 1, sScreenY, sScreenX + MAP_GRID_X,  sScreenY + MAP_GRID_Y - 1, <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#587db110241828c62da9ebbb33677d87">gusUndergroundNearBlack</a> );
<a name="l07062"></a>07062 }
<a name="l07063"></a>07063 
<a name="l07064"></a>07064 
<a name="l07065"></a><a class="code" href="Map_01Screen_01Interface_01Map_8h.html#3a191cd46cbbe994c100a5db7d558813">07065</a> <span class="keywordtype">void</span> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#3a191cd46cbbe994c100a5db7d558813">InitMapSecrets</a>( <span class="keywordtype">void</span> )
<a name="l07066"></a>07066 {
<a name="l07067"></a>07067       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubSamIndex;
<a name="l07068"></a>07068 
<a name="l07069"></a>07069       <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#e5d32ba931394430e60f65852d4e36e6">fFoundTixa</a> = FALSE;
<a name="l07070"></a>07070       <a class="code" href="strategicmap_8cpp.html#20549a2f36fdcba9495803c110584b47">fFoundOrta</a> = FALSE;
<a name="l07071"></a>07071 
<a name="l07072"></a>07072       <span class="keywordflow">for</span>( ubSamIndex = 0; ubSamIndex &lt; NUMBER_OF_SAMS; ubSamIndex++ )
<a name="l07073"></a>07073       {
<a name="l07074"></a>07074             <a class="code" href="strategicmap_8cpp.html#4bd9ad7468be30de044b81f9fee6172f">fSamSiteFound</a>[ ubSamIndex ] = FALSE;
<a name="l07075"></a>07075       }
<a name="l07076"></a>07076 }
<a name="l07077"></a>07077 
<a name="l07078"></a>07078 
<a name="l07079"></a>07079 
<a name="l07080"></a><a class="code" href="mapscreen_8cpp.html#a85597fe3bd4aba4c366ee8682acf4a9">07080</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#a85597fe3bd4aba4c366ee8682acf4a9">CanRedistributeMilitiaInSector</a>( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sClickedSectorX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sClickedSectorY, <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bClickedTownId )
<a name="l07081"></a>07081 {
<a name="l07082"></a>07082       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iCounter = 0;
<a name="l07083"></a>07083       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sBaseSectorValue = 0, sCurrentSectorValue = 0;
<a name="l07084"></a>07084       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorX = 0, sSectorY = 0;
<a name="l07085"></a>07085       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iTotalTroopsInTown = 0;
<a name="l07086"></a>07086 
<a name="l07087"></a>07087 
<a name="l07088"></a>07088       <span class="comment">// if no world is loaded, we can't be in combat (PBI/Auto-resolve locks out normal mapscreen interface for this)</span>
<a name="l07089"></a>07089       <span class="keywordflow">if</span>( !<a class="code" href="Map_01Information_8cpp.html#0d739dcb74321d819ef2bfcb1eb5a669">gfWorldLoaded</a> )
<a name="l07090"></a>07090       {
<a name="l07091"></a>07091             <span class="comment">// ok to redistribute</span>
<a name="l07092"></a>07092             <span class="keywordflow">return</span>( TRUE );
<a name="l07093"></a>07093       }
<a name="l07094"></a>07094 
<a name="l07095"></a>07095       <span class="comment">// if tactically not in combat, hostile sector, or air-raid</span>
<a name="l07096"></a>07096       <span class="keywordflow">if</span>( !( <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#89eb954f99ad4f28b84d7cf675c8ed32">uiFlags</a> &amp; INCOMBAT ) &amp;&amp; !( <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#a921ee4fc79277889d9c1cec0985d3a3">fEnemyInSector</a> ) &amp;&amp; !<a class="code" href="Air_01Raid_8cpp.html#d5efb774a98d9948ff648d15c93b0e0e">InAirRaid</a>( ) )
<a name="l07097"></a>07097       {
<a name="l07098"></a>07098             <span class="comment">// ok to redistribute</span>
<a name="l07099"></a>07099             <span class="keywordflow">return</span>( TRUE );
<a name="l07100"></a>07100       }
<a name="l07101"></a>07101 
<a name="l07102"></a>07102       <span class="comment">// if the fight is underground</span>
<a name="l07103"></a>07103       <span class="keywordflow">if</span> ( <a class="code" href="strategicmap_8cpp.html#da715721a8ceedd42acf6ddb33e63ce0">gbWorldSectorZ</a> != 0 )
<a name="l07104"></a>07104       {
<a name="l07105"></a>07105             <span class="comment">// ok to redistribute</span>
<a name="l07106"></a>07106             <span class="keywordflow">return</span>( TRUE );
<a name="l07107"></a>07107       }
<a name="l07108"></a>07108 
<a name="l07109"></a>07109 
<a name="l07110"></a>07110       <span class="comment">// currently loaded surface sector IS hostile - so we must check if it's also one of the sectors in this "militia map"</span>
<a name="l07111"></a>07111 
<a name="l07112"></a>07112       <span class="comment">// get the sector value for the upper left corner</span>
<a name="l07113"></a>07113       sBaseSectorValue = <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#0e13acff97778b5e62d21d90dca2f3dc">sBaseSectorList</a>[ bClickedTownId - 1 ];
<a name="l07114"></a>07114 
<a name="l07115"></a>07115       <span class="comment">// render icons for map</span>
<a name="l07116"></a>07116       <span class="keywordflow">for</span>( iCounter = 0; iCounter &lt; 9; iCounter++ )
<a name="l07117"></a>07117       {
<a name="l07118"></a>07118             <span class="comment">// grab current sector value</span>
<a name="l07119"></a>07119             sCurrentSectorValue = sBaseSectorValue + ( ( iCounter % MILITIA_BOX_ROWS ) + ( iCounter / MILITIA_BOX_ROWS ) * ( 16 ) );
<a name="l07120"></a>07120             
<a name="l07121"></a>07121             sSectorX = SECTORX( sCurrentSectorValue );
<a name="l07122"></a>07122             sSectorY = SECTORY( sCurrentSectorValue );
<a name="l07123"></a>07123 
<a name="l07124"></a>07124             <span class="comment">// not in the same town?</span>
<a name="l07125"></a>07125             <span class="keywordflow">if</span>( <a class="code" href="strategic_8cpp.html#6f48fb0ea28e3d4889423290f1a6ede8">StrategicMap</a>[ CALCULATE_STRATEGIC_INDEX( sSectorX, sSectorY ) ].bNameId != bClickedTownId )
<a name="l07126"></a>07126             {
<a name="l07127"></a>07127                   <span class="keywordflow">continue</span>;
<a name="l07128"></a>07128             }
<a name="l07129"></a>07129 
<a name="l07130"></a>07130             <span class="comment">// if this is the loaded sector that is currently hostile</span>
<a name="l07131"></a>07131             <span class="keywordflow">if</span> ( ( sSectorX == <a class="code" href="strategicmap_8cpp.html#49d9aed144a633fda4ba1990f002d703">gWorldSectorX</a> ) &amp;&amp; ( sSectorY == <a class="code" href="strategicmap_8cpp.html#ea322310ced0e35ee18a2ee7b32aac5b">gWorldSectorY</a> ) )
<a name="l07132"></a>07132             {
<a name="l07133"></a>07133                   <span class="comment">// the fight is within this town!  Can't redistribute.</span>
<a name="l07134"></a>07134                   <span class="keywordflow">return</span>( FALSE );
<a name="l07135"></a>07135             }
<a name="l07136"></a>07136       }
<a name="l07137"></a>07137 
<a name="l07138"></a>07138 
<a name="l07139"></a>07139       <span class="comment">// the fight is elsewhere - ok to redistribute</span>
<a name="l07140"></a>07140       <span class="keywordflow">return</span>( TRUE );
<a name="l07141"></a>07141 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sat Sep 9 13:48:33 2006 for Build by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
