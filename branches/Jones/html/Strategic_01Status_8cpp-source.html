<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Build: Strategic Status.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="classes.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir_3179ea33d55a76dc38212d9eab798728.html">export</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_e5664b4b56927c8728eb3192fa60e338.html">hdc2</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_1eb12a41a47efb9efcd82fa98f4f4dbd.html">FTP</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_80cc1f21a78ab7941088ea567f236150.html">ja2src</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_994ab287602efefceafe55287a3657d6.html">Build</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_5aba590d477d4824a9090ab3f8850834.html">Strategic</a></div>
<h1>Strategic Status.cpp</h1><a href="Strategic_01Status_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#ifdef PRECOMPILEDHEADERS</span>
<a name="l00002"></a>00002 <span class="preprocessor"></span><span class="preprocessor">      #include "<a class="code" href="Strategic_01All_8h.html">Strategic All.h</a>"</span>
<a name="l00003"></a>00003 <span class="preprocessor">#else</span>
<a name="l00004"></a>00004 <span class="preprocessor"></span><span class="preprocessor">      #include &lt;memory.h&gt;</span>
<a name="l00005"></a>00005 <span class="preprocessor">      #include "<a class="code" href="Strategic_01Status_8h.html">Strategic Status.h</a>"</span>
<a name="l00006"></a>00006 <span class="preprocessor">      #include "<a class="code" href="Inventory_01Choosing_8h.html">Inventory Choosing.h</a>"</span>
<a name="l00007"></a>00007 <span class="preprocessor">      #include "<a class="code" href="FileMan_8h.html">FileMan.h</a>"</span>
<a name="l00008"></a>00008 <span class="preprocessor">      #include "<a class="code" href="Soldier_01Profile_8h.html">Soldier Profile.h</a>"</span>
<a name="l00009"></a>00009 <span class="preprocessor">      #include "<a class="code" href="Campaign_8h.html">Campaign.h</a>"</span>
<a name="l00010"></a>00010 <span class="preprocessor">      #include "<a class="code" href="Strategic_01Mines_8h.html">Strategic Mines.h</a>"</span>
<a name="l00011"></a>00011 <span class="preprocessor">      #include "<a class="code" href="email_8h.html">email.h</a>"</span>
<a name="l00012"></a>00012 <span class="preprocessor">      #include "<a class="code" href="Game_01Clock_8h.html">Game Clock.h</a>"</span>
<a name="l00013"></a>00013 <span class="preprocessor">#endif</span>
<a name="l00014"></a>00014 <span class="preprocessor"></span>
<a name="l00015"></a>00015 
<a name="l00016"></a><a class="code" href="Strategic_01Status_8h.html#d72c00003b4e5d43338acc06d679a99f">00016</a> <a class="code" href="structSTRATEGIC__STATUS.html">STRATEGIC_STATUS</a>  <a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>;
<a name="l00017"></a>00017 
<a name="l00018"></a><a class="code" href="Strategic_01Status_8h.html#e066704fbf8418191ead22daf42d81ef">00018</a> <span class="keywordtype">void</span> <a class="code" href="Strategic_01Status_8cpp.html#f705edd28e24ded2972f802bf75c882a">InitStrategicStatus</a>(<span class="keywordtype">void</span>)
<a name="l00019"></a>00019 {
<a name="l00020"></a>00020       DebugMsg (<a class="code" href="DEBUG_8cpp.html#a7985c2fd033797fc67a03b2c26e07c6">TOPIC_JA2</a>,DBG_LEVEL_3,<span class="stringliteral">"InitStrategicStatus: InitArmyGunTypes"</span>);
<a name="l00021"></a>00021       memset( &amp;<a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>, 0, <span class="keyword">sizeof</span>( <a class="code" href="structSTRATEGIC__STATUS.html">STRATEGIC_STATUS</a> ) );
<a name="l00022"></a>00022       <span class="comment">//Add special non-zero start conditions here...</span>
<a name="l00023"></a>00023 
<a name="l00024"></a>00024       <a class="code" href="Inventory_01Choosing_8cpp.html#2897b7ed2fe821a774157d16d4c1048a">InitArmyGunTypes</a>();
<a name="l00025"></a>00025       DebugMsg (<a class="code" href="DEBUG_8cpp.html#a7985c2fd033797fc67a03b2c26e07c6">TOPIC_JA2</a>,DBG_LEVEL_3,<span class="stringliteral">"InitStrategicStatus: InitArmyGunTypes Done"</span>);
<a name="l00026"></a>00026 }
<a name="l00027"></a>00027 
<a name="l00028"></a><a class="code" href="Strategic_01Status_8h.html#5a6f4172cdbd601957573e01782fb94a">00028</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Strategic_01Status_8cpp.html#5a6f4172cdbd601957573e01782fb94a">SaveStrategicStatusToSaveGameFile</a>( <a class="code" href="LibraryDataBase_8h.html#210e2fc1c18208cbf159ef9c087d6721">HWFILE</a> hFile )
<a name="l00029"></a>00029 {
<a name="l00030"></a>00030       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>       uiNumBytesWritten;
<a name="l00031"></a>00031 
<a name="l00032"></a>00032       <span class="comment">//Save the Strategic Status structure to the saved game file</span>
<a name="l00033"></a>00033       <a class="code" href="FileMan_8cpp.html#09ed41c07d607c8c64a7e2b9fb25660c">FileWrite</a>( hFile, &amp;<a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>, <span class="keyword">sizeof</span>( <a class="code" href="structSTRATEGIC__STATUS.html">STRATEGIC_STATUS</a> ), &amp;uiNumBytesWritten );
<a name="l00034"></a>00034       <span class="keywordflow">if</span>( uiNumBytesWritten != <span class="keyword">sizeof</span>( STRATEGIC_STATUS ) )
<a name="l00035"></a>00035       {
<a name="l00036"></a>00036             <span class="keywordflow">return</span>( FALSE );
<a name="l00037"></a>00037       }
<a name="l00038"></a>00038 
<a name="l00039"></a>00039       <span class="keywordflow">return</span>( TRUE );
<a name="l00040"></a>00040 }
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 
<a name="l00043"></a>00043 
<a name="l00044"></a><a class="code" href="Strategic_01Status_8h.html#ad137ef52d7c092978e0300ef72a632b">00044</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Strategic_01Status_8cpp.html#ad137ef52d7c092978e0300ef72a632b">LoadStrategicStatusFromSaveGameFile</a>( <a class="code" href="LibraryDataBase_8h.html#210e2fc1c18208cbf159ef9c087d6721">HWFILE</a> hFile )
<a name="l00045"></a>00045 {
<a name="l00046"></a>00046       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>       uiNumBytesRead;
<a name="l00047"></a>00047 
<a name="l00048"></a>00048       <span class="comment">//Load the Strategic Status structure from the saved game file</span>
<a name="l00049"></a>00049       <a class="code" href="FileMan_8cpp.html#1b213074411fd4c1dc8fd345e787b17e">FileRead</a>( hFile, &amp;<a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>, <span class="keyword">sizeof</span>( <a class="code" href="structSTRATEGIC__STATUS.html">STRATEGIC_STATUS</a> ), &amp;uiNumBytesRead );
<a name="l00050"></a>00050       <span class="keywordflow">if</span>( uiNumBytesRead != <span class="keyword">sizeof</span>( STRATEGIC_STATUS ) )
<a name="l00051"></a>00051       {
<a name="l00052"></a>00052             <span class="keywordflow">return</span>( FALSE );
<a name="l00053"></a>00053       }
<a name="l00054"></a>00054 
<a name="l00055"></a>00055       <span class="keywordflow">return</span>( TRUE );
<a name="l00056"></a>00056 }
<a name="l00057"></a>00057 
<a name="l00058"></a>00058 
<a name="l00059"></a>00059 <span class="preprocessor">#define DEATH_RATE_SEVERITY 1.0f                // increase to make death rates higher for same # of deaths/time</span>
<a name="l00060"></a>00060 <span class="preprocessor"></span>
<a name="l00061"></a><a class="code" href="Strategic_01Status_8h.html#f16b5e1147e8f96f7924a205905c66c4">00061</a> <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> <a class="code" href="Strategic_01Status_8cpp.html#f16b5e1147e8f96f7924a205905c66c4">CalcDeathRate</a>(<span class="keywordtype">void</span>)
<a name="l00062"></a>00062 {
<a name="l00063"></a>00063       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDeathRate = 0;
<a name="l00064"></a>00064 
<a name="l00065"></a>00065       <span class="comment">// give the player a grace period of 1 day</span>
<a name="l00066"></a>00066       <span class="keywordflow">if</span> (<a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#d80d2de99f3ff298468042f699e45da0">uiManDaysPlayed</a> &gt; 0)
<a name="l00067"></a>00067       {
<a name="l00068"></a>00068             <span class="comment">// calculates the player's current death rate</span>
<a name="l00069"></a>00069             uiDeathRate = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>) ((<a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#775f4314dd9bcd598c314366fa4d7cf8">ubMercDeaths</a> * DEATH_RATE_SEVERITY * 100) / <a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#d80d2de99f3ff298468042f699e45da0">uiManDaysPlayed</a>);
<a name="l00070"></a>00070       }
<a name="l00071"></a>00071 
<a name="l00072"></a>00072       <span class="keywordflow">return</span>((<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>) uiDeathRate);
<a name="l00073"></a>00073 }
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 
<a name="l00076"></a><a class="code" href="Strategic_01Status_8h.html#9cd5a946849975bb8b878c9fb373d2c9">00076</a> <span class="keywordtype">void</span> <a class="code" href="Strategic_01Status_8cpp.html#9cd5a946849975bb8b878c9fb373d2c9">ModifyPlayerReputation</a>(<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bRepChange)
<a name="l00077"></a>00077 {
<a name="l00078"></a>00078       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iNewBadRep;
<a name="l00079"></a>00079 
<a name="l00080"></a>00080       <span class="comment">// subtract, so that a negative reputation change results in an increase in bad reputation</span>
<a name="l00081"></a>00081       iNewBadRep = (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>) <a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#1843564008411c384ec7e13679954029">ubBadReputation</a> - bRepChange;
<a name="l00082"></a>00082 
<a name="l00083"></a>00083       <span class="comment">// keep within a 0-100 range (0 = Saint, 100 = Satan)</span>
<a name="l00084"></a>00084       iNewBadRep = __max(   0, iNewBadRep );
<a name="l00085"></a>00085       iNewBadRep = __min( 100, iNewBadRep );
<a name="l00086"></a>00086 
<a name="l00087"></a>00087       <a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#1843564008411c384ec7e13679954029">ubBadReputation</a> = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>) iNewBadRep;
<a name="l00088"></a>00088 }
<a name="l00089"></a>00089 
<a name="l00090"></a>00090 
<a name="l00091"></a><a class="code" href="Strategic_01Status_8h.html#c9808d4e185e89f99875de87720966f1">00091</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Strategic_01Status_8cpp.html#c9808d4e185e89f99875de87720966f1">MercThinksDeathRateTooHigh</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubProfileID )
<a name="l00092"></a>00092 {
<a name="l00093"></a>00093       <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>  bDeathRateTolerance;
<a name="l00094"></a>00094 
<a name="l00095"></a>00095       bDeathRateTolerance = <a class="code" href="Soldier_01Profile_8cpp.html#1bcff2c50b375b1eb32800aa12000289">gMercProfiles</a>[ ubProfileID ].<a class="code" href="structMERCPROFILESTRUCT.html#85927345a6804b4b9b25b2d4b1d51b3f">bDeathRate</a>;
<a name="l00096"></a>00096 
<a name="l00097"></a>00097       <span class="comment">// if he couldn't care less what it is</span>
<a name="l00098"></a>00098       <span class="keywordflow">if</span> (bDeathRateTolerance == 101)
<a name="l00099"></a>00099       {
<a name="l00100"></a>00100             <span class="comment">// then obviously it CAN'T be too high...</span>
<a name="l00101"></a>00101             <span class="keywordflow">return</span>(FALSE);
<a name="l00102"></a>00102       }
<a name="l00103"></a>00103 
<a name="l00104"></a>00104       <span class="keywordflow">if</span> (<a class="code" href="Strategic_01Status_8cpp.html#f16b5e1147e8f96f7924a205905c66c4">CalcDeathRate</a>() &gt; bDeathRateTolerance)
<a name="l00105"></a>00105       {
<a name="l00106"></a>00106             <span class="comment">// too high - sorry</span>
<a name="l00107"></a>00107             <span class="keywordflow">return</span>(TRUE);
<a name="l00108"></a>00108       }
<a name="l00109"></a>00109       <span class="keywordflow">else</span>
<a name="l00110"></a>00110       {
<a name="l00111"></a>00111             <span class="comment">// within tolerance</span>
<a name="l00112"></a>00112             <span class="keywordflow">return</span>(FALSE);
<a name="l00113"></a>00113       }
<a name="l00114"></a>00114 }
<a name="l00115"></a>00115 
<a name="l00116"></a>00116 
<a name="l00117"></a><a class="code" href="Strategic_01Status_8h.html#b59ec02dfc9e3f2c9e8184b2aa62f120">00117</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Strategic_01Status_8cpp.html#b59ec02dfc9e3f2c9e8184b2aa62f120">MercThinksBadReputationTooHigh</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubProfileID )
<a name="l00118"></a>00118 {
<a name="l00119"></a>00119       <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>  bRepTolerance;
<a name="l00120"></a>00120 
<a name="l00121"></a>00121       bRepTolerance = <a class="code" href="Soldier_01Profile_8cpp.html#1bcff2c50b375b1eb32800aa12000289">gMercProfiles</a>[ ubProfileID ].<a class="code" href="structMERCPROFILESTRUCT.html#058ccf7f9b03e1246197567361a580da">bReputationTolerance</a>;
<a name="l00122"></a>00122 
<a name="l00123"></a>00123       <span class="comment">// if he couldn't care less what it is</span>
<a name="l00124"></a>00124       <span class="keywordflow">if</span> (bRepTolerance == 101)
<a name="l00125"></a>00125       {
<a name="l00126"></a>00126             <span class="comment">// then obviously it CAN'T be too high...</span>
<a name="l00127"></a>00127             <span class="keywordflow">return</span>(FALSE);
<a name="l00128"></a>00128       }
<a name="l00129"></a>00129 
<a name="l00130"></a>00130       <span class="keywordflow">if</span> (<a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#1843564008411c384ec7e13679954029">ubBadReputation</a> &gt; bRepTolerance)
<a name="l00131"></a>00131       {
<a name="l00132"></a>00132             <span class="comment">// too high - sorry</span>
<a name="l00133"></a>00133             <span class="keywordflow">return</span>(TRUE);
<a name="l00134"></a>00134       }
<a name="l00135"></a>00135       <span class="keywordflow">else</span>
<a name="l00136"></a>00136       {
<a name="l00137"></a>00137             <span class="comment">// within tolerance</span>
<a name="l00138"></a>00138             <span class="keywordflow">return</span>(FALSE);
<a name="l00139"></a>00139       }
<a name="l00140"></a>00140 }
<a name="l00141"></a>00141 
<a name="l00142"></a>00142 
<a name="l00143"></a>00143 <span class="comment">// only meaningful for already hired mercs</span>
<a name="l00144"></a><a class="code" href="Strategic_01Status_8h.html#6e8ce57ae0e85315cfa404830230a396">00144</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Strategic_01Status_8cpp.html#6e8ce57ae0e85315cfa404830230a396">MercThinksHisMoraleIsTooLow</a>( <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> )
<a name="l00145"></a>00145 {
<a name="l00146"></a>00146       <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>  bRepTolerance;
<a name="l00147"></a>00147       <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>  bMoraleTolerance;
<a name="l00148"></a>00148 
<a name="l00149"></a>00149       bRepTolerance = <a class="code" href="Soldier_01Profile_8cpp.html#1bcff2c50b375b1eb32800aa12000289">gMercProfiles</a>[ <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#5a5648a1bb3507cc41f6be199c51a3f8">ubProfile</a> ].<a class="code" href="structMERCPROFILESTRUCT.html#058ccf7f9b03e1246197567361a580da">bReputationTolerance</a>;
<a name="l00150"></a>00150 
<a name="l00151"></a>00151       <span class="comment">// if he couldn't care less what it is</span>
<a name="l00152"></a>00152       <span class="keywordflow">if</span> (bRepTolerance == 101)
<a name="l00153"></a>00153       {
<a name="l00154"></a>00154             <span class="comment">// that obviously it CAN'T be too low...</span>
<a name="l00155"></a>00155             <span class="keywordflow">return</span>(FALSE);
<a name="l00156"></a>00156       }
<a name="l00157"></a>00157 
<a name="l00158"></a>00158 
<a name="l00159"></a>00159       <span class="comment">// morale tolerance is based directly upon reputation tolerance</span>
<a name="l00160"></a>00160       <span class="comment">// above 50, morale is GOOD, never below tolerance then</span>
<a name="l00161"></a>00161       bMoraleTolerance = (100 - bRepTolerance) / 2;
<a name="l00162"></a>00162 
<a name="l00163"></a>00163       <span class="keywordflow">if</span> (<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#49a3fb0d9318f044c9ad5774b0a89170">bMorale</a> &lt; bMoraleTolerance)
<a name="l00164"></a>00164       {
<a name="l00165"></a>00165             <span class="comment">// too low - sorry</span>
<a name="l00166"></a>00166             <span class="keywordflow">return</span>(TRUE);
<a name="l00167"></a>00167       }
<a name="l00168"></a>00168       <span class="keywordflow">else</span>
<a name="l00169"></a>00169       {
<a name="l00170"></a>00170             <span class="comment">// within tolerance</span>
<a name="l00171"></a>00171             <span class="keywordflow">return</span>(FALSE);
<a name="l00172"></a>00172       }
<a name="l00173"></a>00173 }
<a name="l00174"></a>00174 
<a name="l00175"></a><a class="code" href="Strategic_01Status_8h.html#25f19a321e5d48c2f1652dab96433ca2">00175</a> <span class="keywordtype">void</span> <a class="code" href="Strategic_01Status_8cpp.html#25f19a321e5d48c2f1652dab96433ca2">UpdateLastDayOfPlayerActivity</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usDay )
<a name="l00176"></a>00176 {
<a name="l00177"></a>00177       <span class="keywordflow">if</span> ( usDay &gt; <a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#23eef2a018a4d21e4e18dc153fd652dd">usLastDayOfPlayerActivity</a> )
<a name="l00178"></a>00178       {
<a name="l00179"></a>00179             <a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#23eef2a018a4d21e4e18dc153fd652dd">usLastDayOfPlayerActivity</a> = usDay;
<a name="l00180"></a>00180             <a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#9f8b89ce3bb621cd0c2426f483784e4f">ubNumberOfDaysOfInactivity</a> = 0;
<a name="l00181"></a>00181       }
<a name="l00182"></a>00182 }
<a name="l00183"></a>00183 
<a name="l00184"></a><a class="code" href="Strategic_01Status_8cpp.html#8089c095f8019e5c83b04f0a9164f08b">00184</a> <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> <a class="code" href="Strategic_01Status_8cpp.html#8089c095f8019e5c83b04f0a9164f08b">LackOfProgressTolerance</a>( <span class="keywordtype">void</span> )
<a name="l00185"></a>00185 {
<a name="l00186"></a>00186       <span class="keywordflow">if</span> ( <a class="code" href="GameSettings_8cpp.html#f9f2d5fd368ccadcc26bebc202d52ae7">gGameOptions</a>.<a class="code" href="structGAME__OPTIONS.html#4fb44167906152722f6af5cc9f7c1a99">ubDifficultyLevel</a> &gt;= <a class="code" href="GameSettings_8h.html#c205be2172292384dd687b5471a87edd3d0b73026f1c7122798d578613aa4575">DIF_LEVEL_HARD</a> )
<a name="l00187"></a>00187       {
<a name="l00188"></a>00188             <span class="comment">// give an EXTRA day over normal</span>
<a name="l00189"></a>00189             <span class="keywordflow">return</span>( 7 - <a class="code" href="GameSettings_8h.html#c205be2172292384dd687b5471a87edddd0259b09fef163c6aa62268574191cb">DIF_LEVEL_MEDIUM</a> + <a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#828deb804f635feadcfd57a5a01c5ea5">ubHighestProgress</a> / 42 );
<a name="l00190"></a>00190       }
<a name="l00191"></a>00191       <span class="keywordflow">else</span>
<a name="l00192"></a>00192       {
<a name="l00193"></a>00193             <span class="keywordflow">return</span>( 6 - <a class="code" href="GameSettings_8cpp.html#f9f2d5fd368ccadcc26bebc202d52ae7">gGameOptions</a>.<a class="code" href="structGAME__OPTIONS.html#4fb44167906152722f6af5cc9f7c1a99">ubDifficultyLevel</a> + <a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#828deb804f635feadcfd57a5a01c5ea5">ubHighestProgress</a> / 42 );
<a name="l00194"></a>00194       }
<a name="l00195"></a>00195       
<a name="l00196"></a>00196 }
<a name="l00197"></a>00197 
<a name="l00198"></a>00198 
<a name="l00199"></a>00199 <span class="comment">// called once per day in the morning, decides whether Enrico should send any new E-mails to the player</span>
<a name="l00200"></a><a class="code" href="Strategic_01Status_8h.html#02857deeb4ce0c294e8021139b5acae7">00200</a> <span class="keywordtype">void</span> <a class="code" href="Strategic_01Status_8cpp.html#02857deeb4ce0c294e8021139b5acae7">HandleEnricoEmail</a>(<span class="keywordtype">void</span>)
<a name="l00201"></a>00201 {
<a name="l00202"></a>00202       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubCurrentProgress = <a class="code" href="Campaign_8cpp.html#96236f8fe1389ac2394c491ab8dd6924">CurrentPlayerProgressPercentage</a>();
<a name="l00203"></a>00203       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubHighestProgress = <a class="code" href="Campaign_8cpp.html#c301f0385a7e0d276efe888024738b09">HighestPlayerProgressPercentage</a>();
<a name="l00204"></a>00204 
<a name="l00205"></a>00205       <span class="comment">// if creatures have attacked a mine (doesn't care if they're still there or not at the moment)</span>
<a name="l00206"></a>00206       <span class="keywordflow">if</span> (<a class="code" href="Strategic_01Mines_8cpp.html#842cf333367b3fe617b031aa08ff2e5c">HasAnyMineBeenAttackedByMonsters</a>() &amp;&amp; !(<a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#a617612d95b7042331ff0991eba856ac">usEnricoEmailFlags</a> &amp; ENRICO_EMAIL_SENT_CREATURES))
<a name="l00207"></a>00207       {
<a name="l00208"></a>00208             <a class="code" href="email_8cpp.html#a8c94e8b550c28723c1e587381bd874e">AddEmail</a>(ENRICO_CREATURES, ENRICO_CREATURES_LENGTH, <a class="code" href="email_8h.html#83e8bc15645f9d99ab91a152bb3dc8ce5bfd66eed0e2525e355ddaa593703e35">MAIL_ENRICO</a>, <a class="code" href="Game_01Clock_8cpp.html#4d255e800fba4d64144a7639d5f3421d">GetWorldTotalMin</a>());
<a name="l00209"></a>00209             <a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#a617612d95b7042331ff0991eba856ac">usEnricoEmailFlags</a> |= ENRICO_EMAIL_SENT_CREATURES;
<a name="l00210"></a>00210             <span class="keywordflow">return</span>;     <span class="comment">// avoid any other E-mail at the same time</span>
<a name="l00211"></a>00211       }
<a name="l00212"></a>00212 
<a name="l00213"></a>00213 
<a name="l00214"></a>00214       <span class="keywordflow">if</span> ((ubCurrentProgress &gt;= SOME_PROGRESS_THRESHOLD) &amp;&amp; !(<a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#a617612d95b7042331ff0991eba856ac">usEnricoEmailFlags</a> &amp; ENRICO_EMAIL_SENT_SOME_PROGRESS))
<a name="l00215"></a>00215       {
<a name="l00216"></a>00216             <a class="code" href="email_8cpp.html#a8c94e8b550c28723c1e587381bd874e">AddEmail</a>(ENRICO_PROG_20, ENRICO_PROG_20_LENGTH, <a class="code" href="email_8h.html#83e8bc15645f9d99ab91a152bb3dc8ce5bfd66eed0e2525e355ddaa593703e35">MAIL_ENRICO</a>, <a class="code" href="Game_01Clock_8cpp.html#4d255e800fba4d64144a7639d5f3421d">GetWorldTotalMin</a>());
<a name="l00217"></a>00217             <a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#a617612d95b7042331ff0991eba856ac">usEnricoEmailFlags</a> |= ENRICO_EMAIL_SENT_SOME_PROGRESS;
<a name="l00218"></a>00218             <span class="keywordflow">return</span>;     <span class="comment">// avoid any setback E-mail at the same time</span>
<a name="l00219"></a>00219       }
<a name="l00220"></a>00220 
<a name="l00221"></a>00221       <span class="keywordflow">if</span> ((ubCurrentProgress &gt;= ABOUT_HALFWAY_THRESHOLD) &amp;&amp; !(<a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#a617612d95b7042331ff0991eba856ac">usEnricoEmailFlags</a> &amp; ENRICO_EMAIL_SENT_ABOUT_HALFWAY))
<a name="l00222"></a>00222       {
<a name="l00223"></a>00223             <a class="code" href="email_8cpp.html#a8c94e8b550c28723c1e587381bd874e">AddEmail</a>(ENRICO_PROG_55, ENRICO_PROG_55_LENGTH, <a class="code" href="email_8h.html#83e8bc15645f9d99ab91a152bb3dc8ce5bfd66eed0e2525e355ddaa593703e35">MAIL_ENRICO</a>, <a class="code" href="Game_01Clock_8cpp.html#4d255e800fba4d64144a7639d5f3421d">GetWorldTotalMin</a>());
<a name="l00224"></a>00224             <a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#a617612d95b7042331ff0991eba856ac">usEnricoEmailFlags</a> |= ENRICO_EMAIL_SENT_ABOUT_HALFWAY;
<a name="l00225"></a>00225             <span class="keywordflow">return</span>;     <span class="comment">// avoid any setback E-mail at the same time</span>
<a name="l00226"></a>00226       }
<a name="l00227"></a>00227 
<a name="l00228"></a>00228       <span class="keywordflow">if</span> ((ubCurrentProgress &gt;= NEARLY_DONE_THRESHOLD) &amp;&amp; !(<a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#a617612d95b7042331ff0991eba856ac">usEnricoEmailFlags</a> &amp; ENRICO_EMAIL_SENT_NEARLY_DONE))
<a name="l00229"></a>00229       {
<a name="l00230"></a>00230             <a class="code" href="email_8cpp.html#a8c94e8b550c28723c1e587381bd874e">AddEmail</a>(ENRICO_PROG_80, ENRICO_PROG_80_LENGTH, <a class="code" href="email_8h.html#83e8bc15645f9d99ab91a152bb3dc8ce5bfd66eed0e2525e355ddaa593703e35">MAIL_ENRICO</a>, <a class="code" href="Game_01Clock_8cpp.html#4d255e800fba4d64144a7639d5f3421d">GetWorldTotalMin</a>());
<a name="l00231"></a>00231             <a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#a617612d95b7042331ff0991eba856ac">usEnricoEmailFlags</a> |= ENRICO_EMAIL_SENT_NEARLY_DONE;
<a name="l00232"></a>00232             <span class="keywordflow">return</span>;     <span class="comment">// avoid any setback E-mail at the same time</span>
<a name="l00233"></a>00233       }
<a name="l00234"></a>00234 
<a name="l00235"></a>00235       <span class="comment">// test for a major setback OR a second minor setback</span>
<a name="l00236"></a>00236       <span class="keywordflow">if</span> ((((ubHighestProgress - ubCurrentProgress) &gt;= MAJOR_SETBACK_THRESHOLD) ||
<a name="l00237"></a>00237           (((ubHighestProgress - ubCurrentProgress) &gt;= MINOR_SETBACK_THRESHOLD) &amp;&amp; (<a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#a617612d95b7042331ff0991eba856ac">usEnricoEmailFlags</a> &amp; ENRICO_EMAIL_FLAG_SETBACK_OVER))) &amp;&amp;
<a name="l00238"></a>00238                   !(<a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#a617612d95b7042331ff0991eba856ac">usEnricoEmailFlags</a> &amp; ENRICO_EMAIL_SENT_MAJOR_SETBACK))
<a name="l00239"></a>00239       {
<a name="l00240"></a>00240             <a class="code" href="email_8cpp.html#a8c94e8b550c28723c1e587381bd874e">AddEmail</a>(ENRICO_SETBACK, ENRICO_SETBACK_LENGTH, <a class="code" href="email_8h.html#83e8bc15645f9d99ab91a152bb3dc8ce5bfd66eed0e2525e355ddaa593703e35">MAIL_ENRICO</a>, <a class="code" href="Game_01Clock_8cpp.html#4d255e800fba4d64144a7639d5f3421d">GetWorldTotalMin</a>());
<a name="l00241"></a>00241             <a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#a617612d95b7042331ff0991eba856ac">usEnricoEmailFlags</a> |= ENRICO_EMAIL_SENT_MAJOR_SETBACK;
<a name="l00242"></a>00242       }
<a name="l00243"></a>00243       <span class="keywordflow">else</span>
<a name="l00244"></a>00244       <span class="comment">// test for a first minor setback</span>
<a name="l00245"></a>00245       <span class="keywordflow">if</span> (((ubHighestProgress - ubCurrentProgress) &gt;= MINOR_SETBACK_THRESHOLD) &amp;&amp;
<a name="l00246"></a>00246               !(<a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#a617612d95b7042331ff0991eba856ac">usEnricoEmailFlags</a> &amp; (ENRICO_EMAIL_SENT_MINOR_SETBACK | ENRICO_EMAIL_SENT_MAJOR_SETBACK)))
<a name="l00247"></a>00247       {
<a name="l00248"></a>00248             <a class="code" href="email_8cpp.html#a8c94e8b550c28723c1e587381bd874e">AddEmail</a>(ENRICO_SETBACK_2, ENRICO_SETBACK_2_LENGTH, <a class="code" href="email_8h.html#83e8bc15645f9d99ab91a152bb3dc8ce5bfd66eed0e2525e355ddaa593703e35">MAIL_ENRICO</a>, <a class="code" href="Game_01Clock_8cpp.html#4d255e800fba4d64144a7639d5f3421d">GetWorldTotalMin</a>());
<a name="l00249"></a>00249             <a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#a617612d95b7042331ff0991eba856ac">usEnricoEmailFlags</a> |= ENRICO_EMAIL_SENT_MINOR_SETBACK;
<a name="l00250"></a>00250       }
<a name="l00251"></a>00251       <span class="keywordflow">else</span>
<a name="l00252"></a>00252       <span class="comment">// if player is back at his maximum progress after having suffered a minor setback</span>
<a name="l00253"></a>00253       <span class="keywordflow">if</span> ((ubHighestProgress == ubCurrentProgress) &amp;&amp; (<a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#a617612d95b7042331ff0991eba856ac">usEnricoEmailFlags</a> &amp; ENRICO_EMAIL_SENT_MINOR_SETBACK))
<a name="l00254"></a>00254       {
<a name="l00255"></a>00255             <span class="comment">// remember that the original setback has been overcome, so another one can generate another E-mail</span>
<a name="l00256"></a>00256             <a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#a617612d95b7042331ff0991eba856ac">usEnricoEmailFlags</a> |= ENRICO_EMAIL_FLAG_SETBACK_OVER;
<a name="l00257"></a>00257       }
<a name="l00258"></a>00258       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="Game_01Clock_8cpp.html#41db6fb136e18cfede5f7c1eea89d7fb">GetWorldDay</a>() &gt; (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>) (<a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#23eef2a018a4d21e4e18dc153fd652dd">usLastDayOfPlayerActivity</a>) )
<a name="l00259"></a>00259       {
<a name="l00260"></a>00260             <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>              bComplaint = 0;
<a name="l00261"></a>00261             <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>             ubTolerance;
<a name="l00262"></a>00262 
<a name="l00263"></a>00263             <a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#9f8b89ce3bb621cd0c2426f483784e4f">ubNumberOfDaysOfInactivity</a>++;
<a name="l00264"></a>00264             ubTolerance = <a class="code" href="Strategic_01Status_8cpp.html#8089c095f8019e5c83b04f0a9164f08b">LackOfProgressTolerance</a>();
<a name="l00265"></a>00265 
<a name="l00266"></a>00266             <span class="keywordflow">if</span> ( <a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#9f8b89ce3bb621cd0c2426f483784e4f">ubNumberOfDaysOfInactivity</a> &gt;= ubTolerance )
<a name="l00267"></a>00267             {                 
<a name="l00268"></a>00268                   <span class="keywordflow">if</span> ( <a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#9f8b89ce3bb621cd0c2426f483784e4f">ubNumberOfDaysOfInactivity</a> == ubTolerance )
<a name="l00269"></a>00269                   {
<a name="l00270"></a>00270                         <span class="comment">// send email</span>
<a name="l00271"></a>00271                         <span class="keywordflow">if</span> ( !(<a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#a617612d95b7042331ff0991eba856ac">usEnricoEmailFlags</a> &amp; ENRICO_EMAIL_SENT_LACK_PROGRESS1 ) )
<a name="l00272"></a>00272                         {
<a name="l00273"></a>00273                               bComplaint = 1;
<a name="l00274"></a>00274                         }
<a name="l00275"></a>00275                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( !(<a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#a617612d95b7042331ff0991eba856ac">usEnricoEmailFlags</a> &amp; ENRICO_EMAIL_SENT_LACK_PROGRESS2 ) )
<a name="l00276"></a>00276                         {
<a name="l00277"></a>00277                               bComplaint = 2;
<a name="l00278"></a>00278                         }
<a name="l00279"></a>00279                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( !(<a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#a617612d95b7042331ff0991eba856ac">usEnricoEmailFlags</a> &amp; ENRICO_EMAIL_SENT_LACK_PROGRESS3 ) )
<a name="l00280"></a>00280                         {
<a name="l00281"></a>00281                               bComplaint = 3;
<a name="l00282"></a>00282                         }
<a name="l00283"></a>00283                   }
<a name="l00284"></a>00284                   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#9f8b89ce3bb621cd0c2426f483784e4f">ubNumberOfDaysOfInactivity</a> == (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>) ubTolerance * 2 )
<a name="l00285"></a>00285                   {
<a name="l00286"></a>00286                         <span class="comment">// six days? send 2nd or 3rd message possibly</span>
<a name="l00287"></a>00287                         <span class="keywordflow">if</span> ( !(<a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#a617612d95b7042331ff0991eba856ac">usEnricoEmailFlags</a> &amp; ENRICO_EMAIL_SENT_LACK_PROGRESS2 ) )
<a name="l00288"></a>00288                         {
<a name="l00289"></a>00289                               bComplaint = 2;
<a name="l00290"></a>00290                         }
<a name="l00291"></a>00291                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( !(<a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#a617612d95b7042331ff0991eba856ac">usEnricoEmailFlags</a> &amp; ENRICO_EMAIL_SENT_LACK_PROGRESS3 ) )
<a name="l00292"></a>00292                         {
<a name="l00293"></a>00293                               bComplaint = 3;
<a name="l00294"></a>00294                         }
<a name="l00295"></a>00295 
<a name="l00296"></a>00296                   }
<a name="l00297"></a>00297                   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#9f8b89ce3bb621cd0c2426f483784e4f">ubNumberOfDaysOfInactivity</a> == ubTolerance * 3 )
<a name="l00298"></a>00298                   {
<a name="l00299"></a>00299                         <span class="comment">// nine days??? send 3rd message possibly</span>
<a name="l00300"></a>00300                         <span class="keywordflow">if</span> ( !(<a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#a617612d95b7042331ff0991eba856ac">usEnricoEmailFlags</a> &amp; ENRICO_EMAIL_SENT_LACK_PROGRESS3 ) )
<a name="l00301"></a>00301                         {
<a name="l00302"></a>00302                               bComplaint = 3;
<a name="l00303"></a>00303                         }
<a name="l00304"></a>00304                   }
<a name="l00305"></a>00305 
<a name="l00306"></a>00306                   <span class="keywordflow">if</span> ( bComplaint != 0 )
<a name="l00307"></a>00307                   {
<a name="l00308"></a>00308                         <span class="keywordflow">switch</span>( bComplaint )
<a name="l00309"></a>00309                         {
<a name="l00310"></a>00310                               <span class="keywordflow">case</span> 3:
<a name="l00311"></a>00311                                     <a class="code" href="email_8cpp.html#a8c94e8b550c28723c1e587381bd874e">AddEmail</a>(LACK_PLAYER_PROGRESS_3, LACK_PLAYER_PROGRESS_3_LENGTH, <a class="code" href="email_8h.html#83e8bc15645f9d99ab91a152bb3dc8ce5bfd66eed0e2525e355ddaa593703e35">MAIL_ENRICO</a>, <a class="code" href="Game_01Clock_8cpp.html#4d255e800fba4d64144a7639d5f3421d">GetWorldTotalMin</a>());
<a name="l00312"></a>00312                                     <a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#a617612d95b7042331ff0991eba856ac">usEnricoEmailFlags</a> |= ENRICO_EMAIL_SENT_LACK_PROGRESS3;
<a name="l00313"></a>00313                                     <span class="keywordflow">break</span>;
<a name="l00314"></a>00314                               <span class="keywordflow">case</span> 2:
<a name="l00315"></a>00315                                     <a class="code" href="email_8cpp.html#a8c94e8b550c28723c1e587381bd874e">AddEmail</a>(LACK_PLAYER_PROGRESS_2, LACK_PLAYER_PROGRESS_2_LENGTH, <a class="code" href="email_8h.html#83e8bc15645f9d99ab91a152bb3dc8ce5bfd66eed0e2525e355ddaa593703e35">MAIL_ENRICO</a>, <a class="code" href="Game_01Clock_8cpp.html#4d255e800fba4d64144a7639d5f3421d">GetWorldTotalMin</a>());
<a name="l00316"></a>00316                                     <a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#a617612d95b7042331ff0991eba856ac">usEnricoEmailFlags</a> |= ENRICO_EMAIL_SENT_LACK_PROGRESS2;
<a name="l00317"></a>00317                                     <span class="keywordflow">break</span>;
<a name="l00318"></a>00318                               <span class="keywordflow">default</span>:
<a name="l00319"></a>00319                                     <a class="code" href="email_8cpp.html#a8c94e8b550c28723c1e587381bd874e">AddEmail</a>(LACK_PLAYER_PROGRESS_1, LACK_PLAYER_PROGRESS_1_LENGTH, <a class="code" href="email_8h.html#83e8bc15645f9d99ab91a152bb3dc8ce5bfd66eed0e2525e355ddaa593703e35">MAIL_ENRICO</a>, <a class="code" href="Game_01Clock_8cpp.html#4d255e800fba4d64144a7639d5f3421d">GetWorldTotalMin</a>());
<a name="l00320"></a>00320                                     <a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#a617612d95b7042331ff0991eba856ac">usEnricoEmailFlags</a> |= ENRICO_EMAIL_SENT_LACK_PROGRESS1;
<a name="l00321"></a>00321                                     <span class="keywordflow">break</span>;
<a name="l00322"></a>00322 
<a name="l00323"></a>00323                         }
<a name="l00324"></a>00324 
<a name="l00325"></a>00325                         <a class="code" href="history_8cpp.html#1c2cf05b6c7bafb693481f84d1fd80ae">AddHistoryToPlayersLog</a>( <a class="code" href="history_8h.html#70ad55be767ca0a42c9150d24618e4ca5c47cdc5a43f7864d8cbe2f813b1db35">HISTORY_ENRICO_COMPLAINED</a>, 0, <a class="code" href="Game_01Clock_8cpp.html#4d255e800fba4d64144a7639d5f3421d">GetWorldTotalMin</a>(), -1, -1 );
<a name="l00326"></a>00326                   }
<a name="l00327"></a>00327 
<a name="l00328"></a>00328                   <span class="comment">// penalize loyalty!</span>
<a name="l00329"></a>00329                   <span class="keywordflow">if</span> ( <a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#a617612d95b7042331ff0991eba856ac">usEnricoEmailFlags</a> &amp; ENRICO_EMAIL_SENT_LACK_PROGRESS2 )
<a name="l00330"></a>00330                   {
<a name="l00331"></a>00331                         <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#db183ada56e95199c90cadcd2924a67b">DecrementTownLoyaltyEverywhere</a>( LOYALTY_PENALTY_INACTIVE * (<a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#9f8b89ce3bb621cd0c2426f483784e4f">ubNumberOfDaysOfInactivity</a> - <a class="code" href="Strategic_01Status_8cpp.html#8089c095f8019e5c83b04f0a9164f08b">LackOfProgressTolerance</a>() + 1) );
<a name="l00332"></a>00332                   }
<a name="l00333"></a>00333                   <span class="keywordflow">else</span>
<a name="l00334"></a>00334                   {
<a name="l00335"></a>00335                         <span class="comment">// on first complaint, give a day's grace...</span>
<a name="l00336"></a>00336                         <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#db183ada56e95199c90cadcd2924a67b">DecrementTownLoyaltyEverywhere</a>( LOYALTY_PENALTY_INACTIVE * (<a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#9f8b89ce3bb621cd0c2426f483784e4f">ubNumberOfDaysOfInactivity</a> - <a class="code" href="Strategic_01Status_8cpp.html#8089c095f8019e5c83b04f0a9164f08b">LackOfProgressTolerance</a>() ) );
<a name="l00337"></a>00337                   }
<a name="l00338"></a>00338             }
<a name="l00339"></a>00339       }
<a name="l00340"></a>00340 
<a name="l00341"></a>00341       <span class="comment">// reset # of new sectors visited 'today' </span>
<a name="l00342"></a>00342       <span class="comment">// grant some leeway for the next day, could have started moving</span>
<a name="l00343"></a>00343       <span class="comment">// at night...</span>
<a name="l00344"></a>00344       <a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#a5afeeb954e4d003f3950d126a5faa90">ubNumNewSectorsVisitedToday</a> = __min( <a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#a5afeeb954e4d003f3950d126a5faa90">ubNumNewSectorsVisitedToday</a>, NEW_SECTORS_EQUAL_TO_ACTIVITY ) / 3;
<a name="l00345"></a>00345 }
<a name="l00346"></a>00346 
<a name="l00347"></a>00347 
<a name="l00348"></a><a class="code" href="Strategic_01Status_8h.html#ec7ea169dcefd94e0ad6569e1e766f08">00348</a> <span class="keywordtype">void</span> <a class="code" href="Strategic_01Status_8cpp.html#ec7ea169dcefd94e0ad6569e1e766f08">TrackEnemiesKilled</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubKilledHow, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubSoldierClass )
<a name="l00349"></a>00349 {
<a name="l00350"></a>00350       <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bRankIndex;
<a name="l00351"></a>00351       
<a name="l00352"></a>00352       bRankIndex = <a class="code" href="Strategic_01Status_8cpp.html#be3c22bde64fb65f4087204814fac0e9">SoldierClassToRankIndex</a>( ubSoldierClass );
<a name="l00353"></a>00353       
<a name="l00354"></a>00354       <span class="comment">// if it's not a standard enemy-class soldier</span>
<a name="l00355"></a>00355       <span class="keywordflow">if</span> ( bRankIndex == -1 )
<a name="l00356"></a>00356       {
<a name="l00357"></a>00357             <span class="comment">// don't count him as an enemy</span>
<a name="l00358"></a>00358             <span class="keywordflow">return</span>;
<a name="l00359"></a>00359       }
<a name="l00360"></a>00360 
<a name="l00361"></a>00361       <a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#54ae0e49e0facb1280623f8088f62584">usEnemiesKilled</a>[ ubKilledHow ][ bRankIndex ]++;
<a name="l00362"></a>00362 
<a name="l00363"></a>00363       <span class="keywordflow">if</span> ( ubKilledHow != <a class="code" href="Strategic_01Status_8h.html#c6bea760bc75e449a80b8cc28bf9a2fedbf5e7e7b5e0d6bca3602475fe0edcb9">ENEMY_KILLED_TOTAL</a> )
<a name="l00364"></a>00364       {
<a name="l00365"></a>00365             <a class="code" href="Strategic_01Status_8cpp.html#d72c00003b4e5d43338acc06d679a99f">gStrategicStatus</a>.<a class="code" href="structSTRATEGIC__STATUS.html#54ae0e49e0facb1280623f8088f62584">usEnemiesKilled</a>[ <a class="code" href="Strategic_01Status_8h.html#c6bea760bc75e449a80b8cc28bf9a2fedbf5e7e7b5e0d6bca3602475fe0edcb9">ENEMY_KILLED_TOTAL</a> ][ bRankIndex ]++;
<a name="l00366"></a>00366       }
<a name="l00367"></a>00367 }
<a name="l00368"></a>00368 
<a name="l00369"></a>00369 
<a name="l00370"></a><a class="code" href="Strategic_01Status_8h.html#be3c22bde64fb65f4087204814fac0e9">00370</a> <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> <a class="code" href="Strategic_01Status_8cpp.html#be3c22bde64fb65f4087204814fac0e9">SoldierClassToRankIndex</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubSoldierClass )
<a name="l00371"></a>00371 {
<a name="l00372"></a>00372       <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bRankIndex = -1;
<a name="l00373"></a>00373 
<a name="l00374"></a>00374       <span class="comment">// the soldier class defines are not in natural ascending order, elite comes before army!</span>
<a name="l00375"></a>00375       <span class="keywordflow">switch</span> ( ubSoldierClass )
<a name="l00376"></a>00376       {
<a name="l00377"></a>00377             <span class="keywordflow">case</span> <a class="code" href="Soldier_01Control_8h.html#d559b3ed307be626eacea8b56942de61b149e8fdf658384dd176ef9e706f10dd">SOLDIER_CLASS_ADMINISTRATOR</a>:   bRankIndex = 0;   <span class="keywordflow">break</span>;
<a name="l00378"></a>00378             <span class="keywordflow">case</span> <a class="code" href="Soldier_01Control_8h.html#d559b3ed307be626eacea8b56942de61a3398ebdb00774b852a6dc6a1ba38764">SOLDIER_CLASS_ELITE</a>:                             bRankIndex = 2;   <span class="keywordflow">break</span>;
<a name="l00379"></a>00379             <span class="keywordflow">case</span> <a class="code" href="Soldier_01Control_8h.html#d559b3ed307be626eacea8b56942de61e155251ca19fc71034c52119253642b8">SOLDIER_CLASS_ARMY</a>:                              bRankIndex = 1;   <span class="keywordflow">break</span>;
<a name="l00380"></a>00380             
<a name="l00381"></a>00381             <span class="keywordflow">default</span>:
<a name="l00382"></a>00382                   <span class="comment">// this happens when an NPC joins the enemy team (e.g. Conrad, Iggy, Mike)</span>
<a name="l00383"></a>00383                   <span class="keywordflow">break</span>;
<a name="l00384"></a>00384       }
<a name="l00385"></a>00385 
<a name="l00386"></a>00386       <span class="keywordflow">return</span>( bRankIndex );
<a name="l00387"></a>00387 }
<a name="l00388"></a>00388 
<a name="l00389"></a>00389 
<a name="l00390"></a>00390 
<a name="l00391"></a><a class="code" href="Strategic_01Status_8h.html#476adc8bd8e5924c37105da33ad4e27e">00391</a> <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> <a class="code" href="Strategic_01Status_8cpp.html#476adc8bd8e5924c37105da33ad4e27e">RankIndexToSoldierClass</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubRankIndex )
<a name="l00392"></a>00392 {
<a name="l00393"></a>00393       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubSoldierClass = 0;
<a name="l00394"></a>00394 
<a name="l00395"></a>00395       Assert( ubRankIndex &lt; <a class="code" href="Strategic_01Status_8h.html#3f4a95405348aa63ef907e692901011f3d5d5995d47c3e44046c9f8b493444b3">NUM_ENEMY_RANKS</a> );
<a name="l00396"></a>00396 
<a name="l00397"></a>00397       <span class="keywordflow">switch</span> ( ubRankIndex )
<a name="l00398"></a>00398       {
<a name="l00399"></a>00399             <span class="keywordflow">case</span> 0:     ubSoldierClass = <a class="code" href="Soldier_01Control_8h.html#d559b3ed307be626eacea8b56942de61b149e8fdf658384dd176ef9e706f10dd">SOLDIER_CLASS_ADMINISTRATOR</a>;   <span class="keywordflow">break</span>;
<a name="l00400"></a>00400             <span class="keywordflow">case</span> 1: ubSoldierClass = <a class="code" href="Soldier_01Control_8h.html#d559b3ed307be626eacea8b56942de61e155251ca19fc71034c52119253642b8">SOLDIER_CLASS_ARMY</a>;                            <span class="keywordflow">break</span>;
<a name="l00401"></a>00401             <span class="keywordflow">case</span> 2: ubSoldierClass = <a class="code" href="Soldier_01Control_8h.html#d559b3ed307be626eacea8b56942de61a3398ebdb00774b852a6dc6a1ba38764">SOLDIER_CLASS_ELITE</a>;                           <span class="keywordflow">break</span>;
<a name="l00402"></a>00402       }
<a name="l00403"></a>00403 
<a name="l00404"></a>00404       <span class="keywordflow">return</span>( ubSoldierClass );
<a name="l00405"></a>00405 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sat Sep 9 13:49:06 2006 for Build by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
