<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Build: TeamTurns.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="classes.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir_3179ea33d55a76dc38212d9eab798728.html">export</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_e5664b4b56927c8728eb3192fa60e338.html">hdc2</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_1eb12a41a47efb9efcd82fa98f4f4dbd.html">FTP</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_80cc1f21a78ab7941088ea567f236150.html">ja2src</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_994ab287602efefceafe55287a3657d6.html">Build</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_43ed33c8f48e75fecb0508860a16371c.html">Tactical</a></div>
<h1>TeamTurns.cpp</h1><a href="TeamTurns_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#ifdef PRECOMPILEDHEADERS</span>
<a name="l00002"></a>00002 <span class="preprocessor"></span><span class="preprocessor">      #include "<a class="code" href="Tactical_01All_8h.html">Tactical All.h</a>"</span>
<a name="l00003"></a>00003 <span class="preprocessor">#else</span>
<a name="l00004"></a>00004 <span class="preprocessor"></span><span class="preprocessor">      #include "types.h"</span>
<a name="l00005"></a>00005 <span class="preprocessor">      #include "soldier control.h"</span>
<a name="l00006"></a>00006 <span class="preprocessor">      #include "overhead.h"</span>
<a name="l00007"></a>00007 <span class="preprocessor">      #include "animation control.h"</span>
<a name="l00008"></a>00008 <span class="preprocessor">      #include "points.h"</span>
<a name="l00009"></a>00009 <span class="preprocessor">      #include "<a class="code" href="opplist_8h.html">opplist.h</a>"</span>
<a name="l00010"></a>00010 <span class="preprocessor">      #include "<a class="code" href="timer_8h.html">timer.h</a>"</span>
<a name="l00011"></a>00011 <span class="preprocessor">      #include "event pump.h"</span>
<a name="l00012"></a>00012 <span class="preprocessor">      #include "<a class="code" href="Sound_01Control_8h.html">Sound Control.h</a>"</span>
<a name="l00013"></a>00013 <span class="preprocessor">      #include "interface.h"</span>
<a name="l00014"></a>00014 <span class="preprocessor">      #include "<a class="code" href="Isometric_01Utils_8h.html">Isometric Utils.h</a>"</span>
<a name="l00015"></a>00015 <span class="preprocessor">      #include "Font Control.H"</span>
<a name="l00016"></a>00016 <span class="preprocessor">      #include "<a class="code" href="ai_8h.html">ai.h</a>"</span>
<a name="l00017"></a>00017 <span class="preprocessor">      #include "interface.h"</span>
<a name="l00018"></a>00018 <span class="preprocessor">      #include "<a class="code" href="message_8h.html">message.h</a>"</span>
<a name="l00019"></a>00019 <span class="preprocessor">      #include "text.h"</span>
<a name="l00020"></a>00020 <span class="preprocessor">      #include "<a class="code" href="TeamTurns_8h.html">TeamTurns.h</a>"</span>
<a name="l00021"></a>00021 <span class="preprocessor">      #include "<a class="code" href="Smell_8h.html">Smell.h</a>"</span>
<a name="l00022"></a>00022 <span class="preprocessor">      #include "game clock.h"</span>
<a name="l00023"></a>00023 <span class="preprocessor">      #include "<a class="code" href="Soldier_01Functions_8h.html">Soldier Functions.h</a>"</span>
<a name="l00024"></a>00024 <span class="preprocessor">      #include "cursors.h"</span>
<a name="l00025"></a>00025 <span class="preprocessor">      #include "<a class="code" href="Queen_01Command_8h.html">Queen Command.h</a>"</span>
<a name="l00026"></a>00026 <span class="preprocessor">      #include "Pathai.h"</span>
<a name="l00027"></a>00027 <span class="preprocessor">      #include "<a class="code" href="Music_01Control_8h.html">Music Control.h</a>"</span>
<a name="l00028"></a>00028 <span class="preprocessor">      #include "<a class="code" href="Strategic_01Turns_8h.html">Strategic Turns.h</a>"</span>
<a name="l00029"></a>00029 <span class="preprocessor">      #include "<a class="code" href="lighting_8h.html">lighting.h</a>"</span>
<a name="l00030"></a>00030 <span class="preprocessor">      #include "<a class="code" href="environment_8h.html">environment.h</a>"</span>
<a name="l00031"></a>00031 <span class="preprocessor">      #include "<a class="code" href="Explosion_01Control_8h.html">Explosion Control.h</a>"</span>
<a name="l00032"></a>00032 <span class="preprocessor">      #include "dialogue control.h"</span>
<a name="l00033"></a>00033 <span class="preprocessor">      #include "Soldier Profile Type.h"</span>
<a name="l00034"></a>00034 <span class="preprocessor">      #include "<a class="code" href="SmokeEffects_8h.html">SmokeEffects.h</a>"</span>
<a name="l00035"></a>00035 <span class="preprocessor">      #include "lighteffects.h"</span>
<a name="l00036"></a>00036 <span class="preprocessor">      #include "air raid.h"</span>
<a name="l00037"></a>00037 <span class="preprocessor">      #include "meanwhile.h"</span>
<a name="l00038"></a>00038 <span class="preprocessor">      #include "<a class="code" href="SkillCheck_8h.html">SkillCheck.h</a>"</span>
<a name="l00039"></a>00039 <span class="preprocessor">      #include "<a class="code" href="AIInternals_8h.html">AIInternals.h</a>"</span>
<a name="l00040"></a>00040 <span class="preprocessor">      #include "<a class="code" href="AIList_8h.html">AIList.h</a>"</span>
<a name="l00041"></a>00041 <span class="preprocessor">      #ifdef DEBUG_INTERRUPTS</span>
<a name="l00042"></a>00042 <span class="preprocessor"></span><span class="preprocessor">            #include "debug.h"</span>
<a name="l00043"></a>00043 <span class="preprocessor">      #endif</span>
<a name="l00044"></a>00044 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00045"></a>00045 <span class="preprocessor"></span>
<a name="l00046"></a>00046 <span class="preprocessor">#include "<a class="code" href="Reinforcement_8h.html">Reinforcement.h</a>"</span>
<a name="l00047"></a>00047 
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 <span class="keyword">extern</span> <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> <a class="code" href="opplist_8cpp.html#25719fa0f78cb1129d152b140f1120dc">STRAIGHT</a>;
<a name="l00050"></a>00050 <span class="comment">//extern UINT8 gubSpeedUpAnimationFactor;</span>
<a name="l00051"></a>00051 <span class="keywordtype">void</span> <a class="code" href="opplist_8cpp.html#7db37928201c006be317bbd3a8956d5d">SetSoldierAniSpeed</a>( <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> );
<a name="l00052"></a>00052 
<a name="l00053"></a><a class="code" href="TeamTurns_8cpp.html#2c69a02e8aade1fe62e4e4ba5077f3ec">00053</a> <span class="keywordtype">void</span> <a class="code" href="TeamTurns_8cpp.html#2c69a02e8aade1fe62e4e4ba5077f3ec">RecalculateSoldiersAniSpeed</a>()
<a name="l00054"></a>00054 {
<a name="l00055"></a>00055       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiLoop;
<a name="l00056"></a>00056       <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>;
<a name="l00057"></a>00057 
<a name="l00058"></a>00058 <span class="comment">//    if( gubSpeedUpAnimationFactor == 1 )return;</span>
<a name="l00059"></a>00059 
<a name="l00060"></a>00060       <span class="keywordflow">for</span> (uiLoop = 0; uiLoop &lt; <a class="code" href="Overhead_8cpp.html#d627c552ede524c66140f3410174d3d4">guiNumMercSlots</a>; uiLoop++)
<a name="l00061"></a>00061       {
<a name="l00062"></a>00062             <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> = <a class="code" href="Overhead_8cpp.html#b139938f6b836645dd67972944d21bf3">MercSlots</a>[ uiLoop ];
<a name="l00063"></a>00063 
<a name="l00064"></a>00064             <span class="comment">// if this merc is inactive, at base, on assignment, dead, unconscious</span>
<a name="l00065"></a>00065             <span class="keywordflow">if</span> (!<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>)
<a name="l00066"></a>00066             {
<a name="l00067"></a>00067                   <span class="keywordflow">continue</span>;          <span class="comment">// next merc</span>
<a name="l00068"></a>00068             }
<a name="l00069"></a>00069 
<a name="l00070"></a>00070             <a class="code" href="opplist_8cpp.html#7db37928201c006be317bbd3a8956d5d">SetSoldierAniSpeed</a>( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> );
<a name="l00071"></a>00071       }
<a name="l00072"></a>00072 
<a name="l00073"></a>00073 }
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 
<a name="l00076"></a>00076 
<a name="l00077"></a>00077 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="opplist_8cpp.html#2e44fe9c1060c7ff0e965fe5b6c83808">DecayPublicOpplist</a>(<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bTeam);
<a name="l00078"></a>00078 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="opplist_8cpp.html#cdf3c83cc3cb114abb2d5d9567d11457">VerifyAndDecayOpplist</a>(<a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>);
<a name="l00079"></a>00079 <span class="keywordtype">void</span> <a class="code" href="TeamTurns_8cpp.html#a41b1e4ef95bdf5732f5e41fa257864b">EndInterrupt</a>( <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fMarkInterruptOccurred );
<a name="l00080"></a>00080 <span class="keywordtype">void</span> <a class="code" href="TeamTurns_8cpp.html#9318a9ca429d8a866d11f101bffafd60">DeleteFromIntList</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubIndex, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fCommunicate);
<a name="l00081"></a>00081 
<a name="l00082"></a>00082 <span class="preprocessor">#define END_OF_INTERRUPTS 255</span>
<a name="l00083"></a>00083 <span class="preprocessor"></span>
<a name="l00084"></a><a class="code" href="TeamTurns_8cpp.html#8f8bdbac1eb4174dfb142fd50f762004">00084</a> <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> <a class="code" href="TeamTurns_8cpp.html#8f8bdbac1eb4174dfb142fd50f762004">gubOutOfTurnOrder</a>[MAXMERCS] = { END_OF_INTERRUPTS, 0 };
<a name="l00085"></a><a class="code" href="TeamTurns_8h.html#bba49c23835b863c536a9796e4461183">00085</a> <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> <a class="code" href="TeamTurns_8cpp.html#bba49c23835b863c536a9796e4461183">gubOutOfTurnPersons</a> = 0;
<a name="l00086"></a>00086 
<a name="l00087"></a>00087 <span class="preprocessor">#define LATEST_INTERRUPT_GUY (gubOutOfTurnOrder[gubOutOfTurnPersons])</span>
<a name="l00088"></a>00088 <span class="preprocessor"></span><span class="preprocessor">#define REMOVE_LATEST_INTERRUPT_GUY()     (DeleteFromIntList( (UINT8) (gubOutOfTurnPersons), TRUE ))</span>
<a name="l00089"></a>00089 <span class="preprocessor"></span><span class="preprocessor">#define INTERRUPTS_OVER (gubOutOfTurnPersons == 1)</span>
<a name="l00090"></a>00090 <span class="preprocessor"></span>
<a name="l00091"></a><a class="code" href="TeamTurns_8cpp.html#42bb4eb822afac8c2e18356981e457ce">00091</a> <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> <a class="code" href="TeamTurns_8cpp.html#42bb4eb822afac8c2e18356981e457ce">InterruptOnlyGuynum</a> = NOBODY;
<a name="l00092"></a><a class="code" href="TeamTurns_8cpp.html#3be147c0d8dcf048dd9d8d9449f45965">00092</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="TeamTurns_8cpp.html#3be147c0d8dcf048dd9d8d9449f45965">InterruptsAllowed</a> = TRUE;
<a name="l00093"></a><a class="code" href="DecideAction_8cpp.html#782955f80e251720a735649d4e8a5987">00093</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="TeamTurns_8cpp.html#782955f80e251720a735649d4e8a5987">gfHiddenInterrupt</a> = FALSE;
<a name="l00094"></a><a class="code" href="TeamTurns_8cpp.html#3ff1395df97489a5417b119827e89eb8">00094</a> <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>       <a class="code" href="TeamTurns_8cpp.html#3ff1395df97489a5417b119827e89eb8">gubLastInterruptedGuy</a> = 0;
<a name="l00095"></a>00095 
<a name="l00096"></a>00096 <span class="keyword">extern</span> <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> <a class="code" href="opplist_8cpp.html#d6ad632c68c326aa3e32a911fa48aa18">gsWhoThrewRock</a>;
<a name="l00097"></a>00097 <span class="keyword">extern</span> <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> <a class="code" href="opplist_8cpp.html#6f973cb4a656f717ac624b3a54de0042">gubSightFlags</a>;
<a name="l00098"></a>00098 
<a name="l00099"></a><a class="code" href="structTEAM__TURN__SAVE__STRUCT.html">00099</a> <span class="keyword">typedef</span> <span class="keyword">struct</span>
<a name="l00100"></a>00100 <span class="keyword"></span>{
<a name="l00101"></a><a class="code" href="structTEAM__TURN__SAVE__STRUCT.html#26e8c5d2cbba7a326739bc33a21d4721">00101</a>       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>       ubOutOfTurnPersons;
<a name="l00102"></a>00102 
<a name="l00103"></a><a class="code" href="structTEAM__TURN__SAVE__STRUCT.html#7e022790455a5cc93c12aead6bd471f2">00103</a>       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a>       <a class="code" href="TeamTurns_8cpp.html#42bb4eb822afac8c2e18356981e457ce">InterruptOnlyGuynum</a>;
<a name="l00104"></a><a class="code" href="structTEAM__TURN__SAVE__STRUCT.html#f114804ba7c841a3c9bef6b02a35627d">00104</a>       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a>       sWhoThrewRock;
<a name="l00105"></a><a class="code" href="structTEAM__TURN__SAVE__STRUCT.html#e1b125ad72b926896e3c2fea085ad9b3">00105</a>       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="TeamTurns_8cpp.html#3be147c0d8dcf048dd9d8d9449f45965">InterruptsAllowed</a>;
<a name="l00106"></a><a class="code" href="structTEAM__TURN__SAVE__STRUCT.html#437d5bdec5ad3a4ae4b89b7a3b58832f">00106</a>       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fHiddenInterrupt;
<a name="l00107"></a><a class="code" href="structTEAM__TURN__SAVE__STRUCT.html#19c8d4364c81044be4ccf334eddf4ae7">00107</a>       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>       ubLastInterruptedGuy;
<a name="l00108"></a>00108 
<a name="l00109"></a><a class="code" href="structTEAM__TURN__SAVE__STRUCT.html#c1b9c77a4dc341fcfeff3fb992a5f545">00109</a>       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubFiller[16];
<a name="l00110"></a>00110 } <a class="code" href="structTEAM__TURN__SAVE__STRUCT.html">TEAM_TURN_SAVE_STRUCT</a>;
<a name="l00111"></a>00111 
<a name="l00112"></a>00112 <span class="preprocessor">#define MIN_APS_TO_INTERRUPT 4</span>
<a name="l00113"></a>00113 <span class="preprocessor"></span>
<a name="l00114"></a><a class="code" href="TeamTurns_8h.html#57c69a1ebef93252abc7051c1d9147aa">00114</a> <span class="keywordtype">void</span> <a class="code" href="TeamTurns_8cpp.html#57c69a1ebef93252abc7051c1d9147aa">ClearIntList</a>( <span class="keywordtype">void</span> )
<a name="l00115"></a>00115 {
<a name="l00116"></a>00116       DebugMsg (<a class="code" href="DEBUG_8cpp.html#a7985c2fd033797fc67a03b2c26e07c6">TOPIC_JA2</a>,DBG_LEVEL_3,<span class="stringliteral">"ClearIntList"</span>);
<a name="l00117"></a>00117       memset( &amp;<a class="code" href="TeamTurns_8cpp.html#8f8bdbac1eb4174dfb142fd50f762004">gubOutOfTurnOrder</a>, 0, MAXMERCS );
<a name="l00118"></a>00118       <a class="code" href="TeamTurns_8cpp.html#8f8bdbac1eb4174dfb142fd50f762004">gubOutOfTurnOrder</a>[0] = END_OF_INTERRUPTS;
<a name="l00119"></a>00119       <a class="code" href="TeamTurns_8cpp.html#bba49c23835b863c536a9796e4461183">gubOutOfTurnPersons</a> = 0;
<a name="l00120"></a>00120 }
<a name="l00121"></a>00121 
<a name="l00122"></a><a class="code" href="TeamTurns_8cpp.html#1bb9178e0898254541bdfab29a20d496">00122</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="TeamTurns_8cpp.html#1bb9178e0898254541bdfab29a20d496">BloodcatsPresent</a>( <span class="keywordtype">void</span> )
<a name="l00123"></a>00123 {
<a name="l00124"></a>00124       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>                               iLoop;
<a name="l00125"></a>00125       <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *           <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>;
<a name="l00126"></a>00126 
<a name="l00127"></a>00127       DebugMsg (<a class="code" href="DEBUG_8cpp.html#a7985c2fd033797fc67a03b2c26e07c6">TOPIC_JA2</a>,DBG_LEVEL_3,<span class="stringliteral">"BloodcatsPresent"</span>);
<a name="l00128"></a>00128       <span class="keywordflow">if</span> ( <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#2ecddfe580bb019bc92cc4859eaf3edc">Team</a>[ CREATURE_TEAM ].<a class="code" href="structTacticalTeamType.html#5e2ed425f613a7996ba1a0cd2cbaf050">bTeamActive</a> == FALSE )
<a name="l00129"></a>00129       {
<a name="l00130"></a>00130             <span class="keywordflow">return</span>( FALSE );
<a name="l00131"></a>00131       }
<a name="l00132"></a>00132 
<a name="l00133"></a>00133       <span class="keywordflow">for</span> ( iLoop = <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#2ecddfe580bb019bc92cc4859eaf3edc">Team</a>[ CREATURE_TEAM ].<a class="code" href="structTacticalTeamType.html#f8fe819ad07b242f5dbf97fd4c69b00d">bFirstID</a>; iLoop &lt;= <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#2ecddfe580bb019bc92cc4859eaf3edc">Team</a>[ CREATURE_TEAM ].<a class="code" href="structTacticalTeamType.html#6a887279dad735dc302f21c1e559d5ce">bLastID</a>; iLoop++ )
<a name="l00134"></a>00134       {
<a name="l00135"></a>00135             <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> = <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ iLoop ];
<a name="l00136"></a>00136 
<a name="l00137"></a>00137             <span class="keywordflow">if</span> ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#653dad4e2520784e293eca9f948b8532">bActive</a> &amp;&amp; <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#b0096f321a0de4f0617283f7b3212aa0">bInSector</a> &amp;&amp; <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#e308dea18533bf5ab2bcee5bbe27391c">bLife</a> &gt; 0 &amp;&amp; <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#b082364eed3d7883662f69e1fd96be1a">ubBodyType</a> == <a class="code" href="Animation_01Data_8h.html#d295a916825180b548473dec560093a7fa470b7d78ba43f21bfd04c49f02a70b">BLOODCAT</a> )
<a name="l00138"></a>00138             {
<a name="l00139"></a>00139                   <span class="keywordflow">return</span>( TRUE );
<a name="l00140"></a>00140             }
<a name="l00141"></a>00141       }
<a name="l00142"></a>00142 
<a name="l00143"></a>00143       <span class="keywordflow">return</span>( FALSE );
<a name="l00144"></a>00144 }
<a name="l00145"></a>00145 
<a name="l00146"></a><a class="code" href="TeamTurns_8cpp.html#60bb10cf0b59f54af4a7d17da9049fc3">00146</a> <span class="keywordtype">void</span> <a class="code" href="Overhead_8h.html#60bb10cf0b59f54af4a7d17da9049fc3">StartPlayerTeamTurn</a>( <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fDoBattleSnd, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fEnteringCombatMode )
<a name="l00147"></a>00147 {
<a name="l00148"></a>00148       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> cnt;
<a name="l00149"></a>00149       DebugMsg (<a class="code" href="DEBUG_8cpp.html#a7985c2fd033797fc67a03b2c26e07c6">TOPIC_JA2</a>,DBG_LEVEL_3,<span class="stringliteral">"StartPlayerTeamTurn"</span>);
<a name="l00150"></a>00150 <span class="comment">//    SOLDIERTYPE       *pSoldier;</span>
<a name="l00151"></a>00151 <span class="comment">//    EV_S_BEGINTURN    SBeginTurn;</span>
<a name="l00152"></a>00152 
<a name="l00153"></a>00153       <span class="comment">// Start the turn of player charactors</span>
<a name="l00154"></a>00154       
<a name="l00155"></a>00155       <span class="comment">// </span>
<a name="l00156"></a>00156       <span class="comment">// PATCH 1.06:</span>
<a name="l00157"></a>00157       <span class="comment">//</span>
<a name="l00158"></a>00158       <span class="comment">// make sure set properly in gTacticalStatus:</span>
<a name="l00159"></a>00159       <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#d4322ac2c70a18b5aa84c2041e08c9b1">ubCurrentTeam</a> = OUR_TEAM;
<a name="l00160"></a>00160 
<a name="l00161"></a>00161       cnt = <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#2ecddfe580bb019bc92cc4859eaf3edc">Team</a>[ <a class="code" href="Campaign_8cpp.html#47b2067ff75193e24776eda5297400ff">gbPlayerNum</a> ].<a class="code" href="structTacticalTeamType.html#f8fe819ad07b242f5dbf97fd4c69b00d">bFirstID</a>;
<a name="l00162"></a>00162 
<a name="l00163"></a>00163       <a class="code" href="Interface_8cpp.html#e1d00e8e7f6f650538adc7f8357a7f78">InitPlayerUIBar</a>( FALSE );
<a name="l00164"></a>00164 
<a name="l00165"></a>00165       <span class="keywordflow">if</span> ( <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#89eb954f99ad4f28b84d7cf675c8ed32">uiFlags</a> &amp; TURNBASED )
<a name="l00166"></a>00166       {
<a name="l00167"></a>00167             <span class="comment">// Are we in combat already?</span>
<a name="l00168"></a>00168             <span class="keywordflow">if</span> ( <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#89eb954f99ad4f28b84d7cf675c8ed32">uiFlags</a> &amp; INCOMBAT )
<a name="l00169"></a>00169             {
<a name="l00170"></a>00170                   <a class="code" href="Sound_01Control_8cpp.html#6b140a8e4fcf89b7740c037ff12580a7">PlayJA2Sample</a>( <a class="code" href="Sound_01Control_8h.html#946995a6d03371486c23b23d9ca362b5abe9bfc15d44271d7bf236b81d5218b9">ENDTURN_1</a>, RATE_11025, MIDVOLUME, 1, MIDDLEPAN );
<a name="l00171"></a>00171             }
<a name="l00172"></a>00172 
<a name="l00173"></a>00173             <span class="comment">// Remove deadlock message</span>
<a name="l00174"></a>00174             <a class="code" href="Interface_8cpp.html#0728ce1dc7dcaea64a98f2d25bcf556d">EndDeadlockMsg</a>( );
<a name="l00175"></a>00175 
<a name="l00176"></a>00176             <span class="comment">// Check for victory conditions</span>
<a name="l00177"></a>00177 
<a name="l00178"></a>00178             <span class="comment">// ATE: Commented out - looks like this message is called earlier for our team</span>
<a name="l00179"></a>00179             <span class="comment">// look for all mercs on the same team, </span>
<a name="l00180"></a>00180             <span class="comment">//for ( pSoldier = MercPtrs[ cnt ]; cnt &lt;= gTacticalStatus.Team[ gbPlayerNum ].bLastID; cnt++,pSoldier++)</span>
<a name="l00181"></a>00181             <span class="comment">//{   </span>
<a name="l00182"></a>00182             <span class="comment">//    if ( pSoldier-&gt;bActive &amp;&amp; pSoldier-&gt;bLife &gt; 0 )</span>
<a name="l00183"></a>00183             <span class="comment">//    {</span>
<a name="l00184"></a>00184             <span class="comment">//          SBeginTurn.usSoldierID        = (UINT16)cnt;</span>
<a name="l00185"></a>00185             <span class="comment">//          AddGameEvent( S_BEGINTURN, 0, &amp;SBeginTurn );</span>
<a name="l00186"></a>00186             <span class="comment">//    }</span>
<a name="l00187"></a>00187             <span class="comment">//}</span>
<a name="l00188"></a>00188 
<a name="l00189"></a>00189             <span class="comment">// Are we in combat already?</span>
<a name="l00190"></a>00190             <span class="keywordflow">if</span> ( <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#89eb954f99ad4f28b84d7cf675c8ed32">uiFlags</a> &amp; INCOMBAT )
<a name="l00191"></a>00191             {           
<a name="l00192"></a>00192                   <span class="keywordflow">if</span> ( <a class="code" href="Interface_01Utils_8cpp.html#07d83e717b98bc3cf6628f0bb9bc9205">gusSelectedSoldier</a> != NO_SOLDIER )
<a name="l00193"></a>00193                   {
<a name="l00194"></a>00194                         <span class="comment">// Check if this guy is able to be selected....</span>
<a name="l00195"></a>00195                         <span class="keywordflow">if</span> ( <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ <a class="code" href="Interface_01Utils_8cpp.html#07d83e717b98bc3cf6628f0bb9bc9205">gusSelectedSoldier</a> ]-&gt;bLife &lt; OKLIFE )
<a name="l00196"></a>00196                         {
<a name="l00197"></a>00197                               DebugMsg(<a class="code" href="DEBUG_8cpp.html#a7985c2fd033797fc67a03b2c26e07c6">TOPIC_JA2</a>,DBG_LEVEL_3,<a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>(<span class="stringliteral">"StartPlayerTeamTurn: SelectNextAvailSoldier"</span>));
<a name="l00198"></a>00198                               <a class="code" href="Overhead_8cpp.html#991bb5532d71ee52b0d32a94f407aec1">SelectNextAvailSoldier</a>( <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ <a class="code" href="Interface_01Utils_8cpp.html#07d83e717b98bc3cf6628f0bb9bc9205">gusSelectedSoldier</a> ] );
<a name="l00199"></a>00199                         }
<a name="l00200"></a>00200 
<a name="l00201"></a>00201                         <span class="comment">// Slide to selected guy...</span>
<a name="l00202"></a>00202                         <span class="keywordflow">if</span> ( <a class="code" href="Interface_01Utils_8cpp.html#07d83e717b98bc3cf6628f0bb9bc9205">gusSelectedSoldier</a> != NO_SOLDIER )
<a name="l00203"></a>00203                         {
<a name="l00204"></a>00204                               <a class="code" href="Overhead_8cpp.html#d449ca43df0cc8426ed73cf5eedca433">SlideTo</a>( NOWHERE, <a class="code" href="Interface_01Utils_8cpp.html#07d83e717b98bc3cf6628f0bb9bc9205">gusSelectedSoldier</a>, NOBODY ,SETLOCATOR);
<a name="l00205"></a>00205 
<a name="l00206"></a>00206                               <span class="keywordflow">if</span> ( fDoBattleSnd )
<a name="l00207"></a>00207                               {
<a name="l00208"></a>00208                                     <span class="comment">// Say ATTENTION SOUND...</span>
<a name="l00209"></a>00209                                     <a class="code" href="Soldier_01Control_8cpp.html#62effc98ffa51ddb2fc78301c82acdb8">DoMercBattleSound</a>( <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ <a class="code" href="Interface_01Utils_8cpp.html#07d83e717b98bc3cf6628f0bb9bc9205">gusSelectedSoldier</a> ], <a class="code" href="Soldier_01Control_8h.html#3ab071cf265666f49f6e3f6639d69f0a3db87554c96021371ea027e7d90bea26">BATTLE_SOUND_ATTN1</a> );
<a name="l00210"></a>00210                               }
<a name="l00211"></a>00211 
<a name="l00212"></a>00212                               <span class="keywordflow">if</span> ( <a class="code" href="Interface_8cpp.html#df8b6e6a517d072540efbabfca5ac189">gsInterfaceLevel</a> == 1 )
<a name="l00213"></a>00213                               {
<a name="l00214"></a>00214                                     <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#89eb954f99ad4f28b84d7cf675c8ed32">uiFlags</a> |= SHOW_ALL_ROOFS;
<a name="l00215"></a>00215                                     <a class="code" href="renderworld_8cpp.html#1e1ddb2858063ee68614cd6c221369bb">InvalidateWorldRedundency</a>( );
<a name="l00216"></a>00216                                     <a class="code" href="renderworld_8cpp.html#986f210b1a26336aa2943bdce24ffb94">SetRenderFlags</a>(RENDER_FLAG_FULL);
<a name="l00217"></a>00217                                     <a class="code" href="PATHAI_8cpp.html#33cf219cddf5174a2c1701521a51f38b">ErasePath</a>(FALSE);
<a name="l00218"></a>00218                               }
<a name="l00219"></a>00219                         }
<a name="l00220"></a>00220                   }
<a name="l00221"></a>00221             }
<a name="l00222"></a>00222 
<a name="l00223"></a>00223             <span class="comment">// Dirty panel interface!</span>
<a name="l00224"></a>00224             <a class="code" href="Interface_8cpp.html#310e02e85df33f7794f5c4c11ae1844d">fInterfacePanelDirty</a> = DIRTYLEVEL2;
<a name="l00225"></a>00225 
<a name="l00226"></a>00226             <span class="comment">// Adjust time now!</span>
<a name="l00227"></a>00227             <a class="code" href="Game_01Clock_8cpp.html#c373131d68bbe0b483d23414a17219b0">UpdateClock</a>( );
<a name="l00228"></a>00228 
<a name="l00229"></a>00229             <span class="keywordflow">if</span> ( !fEnteringCombatMode )
<a name="l00230"></a>00230             {
<a name="l00231"></a>00231                   <a class="code" href="Overhead_8cpp.html#985114aea00b606c88f367b87f58c060">CheckForEndOfCombatMode</a>( TRUE );
<a name="l00232"></a>00232             }
<a name="l00233"></a>00233 
<a name="l00234"></a>00234       }
<a name="l00235"></a>00235       <span class="comment">// Signal UI done enemy's turn</span>
<a name="l00236"></a>00236       <a class="code" href="Handle_01UI_8cpp.html#c1a811228f6db879e9c1d67b68651a1b">guiPendingOverrideEvent</a> = <a class="code" href="Handle_01UI_8h.html#af14d9a15c91cd740ff202b6335e405ecdd777bfca71920c86e66ee609316ceb">LU_ENDUILOCK</a>;
<a name="l00237"></a>00237 
<a name="l00238"></a>00238   <span class="comment">// ATE: Reset killed on attack variable.. this is because sometimes timing is such</span><span class="comment"></span>
<a name="l00239"></a>00239 <span class="comment">  /// that a baddie can die and still maintain it's attacker ID</span>
<a name="l00240"></a>00240 <span class="comment"></span>  <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#485362dbba2ad4170def214e4249cd1c">fKilledEnemyOnAttack</a> = FALSE;
<a name="l00241"></a>00241 
<a name="l00242"></a>00242       <a class="code" href="Handle_01UI_8cpp.html#2633147d0d1a1bafac01733902d66452">HandleTacticalUI</a>( );
<a name="l00243"></a>00243 }
<a name="l00244"></a>00244 
<a name="l00245"></a><a class="code" href="TeamTurns_8cpp.html#3d4a12dd64ba5f97a7b4e6216595026f">00245</a> <span class="keywordtype">void</span> <a class="code" href="TeamTurns_8cpp.html#3d4a12dd64ba5f97a7b4e6216595026f">FreezeInterfaceForEnemyTurn</a>( <span class="keywordtype">void</span> )
<a name="l00246"></a>00246 {
<a name="l00247"></a>00247       DebugMsg (<a class="code" href="DEBUG_8cpp.html#a7985c2fd033797fc67a03b2c26e07c6">TOPIC_JA2</a>,DBG_LEVEL_3,<span class="stringliteral">"FreezeInterfaceForEnemyTurn"</span>);
<a name="l00248"></a>00248       <span class="comment">// Reset flags</span>
<a name="l00249"></a>00249       <a class="code" href="Handle_01UI_8cpp.html#5a5e679474e784af12194877e4003ba4">gfPlotNewMovement</a> = TRUE;
<a name="l00250"></a>00250 
<a name="l00251"></a>00251       <span class="comment">// Erase path</span>
<a name="l00252"></a>00252       <a class="code" href="PATHAI_8cpp.html#33cf219cddf5174a2c1701521a51f38b">ErasePath</a>( TRUE );
<a name="l00253"></a>00253 
<a name="l00254"></a>00254       <span class="comment">// Setup locked UI</span>
<a name="l00255"></a>00255       <a class="code" href="Handle_01UI_8cpp.html#c1a811228f6db879e9c1d67b68651a1b">guiPendingOverrideEvent</a> = <a class="code" href="Handle_01UI_8h.html#af14d9a15c91cd740ff202b6335e405e9284e6f1f50ffc974b408c62555d8ba2">LU_BEGINUILOCK</a>;
<a name="l00256"></a>00256 
<a name="l00257"></a>00257       <span class="comment">// Remove any UI messages!</span>
<a name="l00258"></a>00258       <span class="keywordflow">if</span> ( <a class="code" href="Interface_8cpp.html#ae9256d42d7caf8c5f89c066deb57256">giUIMessageOverlay</a> != -1 )
<a name="l00259"></a>00259       {
<a name="l00260"></a>00260             <a class="code" href="Interface_8cpp.html#ab376d835ad21994d395ad9ac0247af0">EndUIMessage</a>( );
<a name="l00261"></a>00261       }
<a name="l00262"></a>00262 } 
<a name="l00263"></a>00263 
<a name="l00264"></a>00264 
<a name="l00265"></a><a class="code" href="TeamTurns_8cpp.html#c633b0456d35aa98854f0484afe69ea6">00265</a> <span class="keywordtype">void</span> <a class="code" href="Overhead_8h.html#5da8ba4c614d8c6eea84d86aa43ef4a8">EndTurn</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubNextTeam )
<a name="l00266"></a>00266 {
<a name="l00267"></a>00267       DebugMsg (<a class="code" href="DEBUG_8cpp.html#a7985c2fd033797fc67a03b2c26e07c6">TOPIC_JA2</a>,DBG_LEVEL_3,<span class="stringliteral">"EndTurn"</span>);
<a name="l00268"></a>00268       <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> * <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>;
<a name="l00269"></a>00269       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> cnt;
<a name="l00270"></a>00270 
<a name="l00271"></a>00271       <span class="comment">//Check for enemy pooling (add enemies if there happens to be more than the max in the</span>
<a name="l00272"></a>00272       <span class="comment">//current battle.  If one or more slots have freed up, we can add them now.</span>
<a name="l00273"></a>00273 
<a name="l00274"></a>00274       <a class="code" href="Interface_8cpp.html#0728ce1dc7dcaea64a98f2d25bcf556d">EndDeadlockMsg</a>( );
<a name="l00275"></a>00275 
<a name="l00276"></a>00276 <span class="comment">/*</span>
<a name="l00277"></a>00277 <span class="comment">      if ( CheckForEndOfCombatMode( FALSE ) )</span>
<a name="l00278"></a>00278 <span class="comment">      {</span>
<a name="l00279"></a>00279 <span class="comment">            return;</span>
<a name="l00280"></a>00280 <span class="comment">      }</span>
<a name="l00281"></a>00281 <span class="comment">      */</span>
<a name="l00282"></a>00282 
<a name="l00283"></a>00283       <span class="keywordflow">if</span> (INTERRUPT_QUEUED)
<a name="l00284"></a>00284       {
<a name="l00285"></a>00285             <a class="code" href="TeamTurns_8cpp.html#a41b1e4ef95bdf5732f5e41fa257864b">EndInterrupt</a>( FALSE );
<a name="l00286"></a>00286       }
<a name="l00287"></a>00287       <span class="keywordflow">else</span>
<a name="l00288"></a>00288       {
<a name="l00289"></a>00289             <a class="code" href="Queen_01Command_8cpp.html#c0c295622fbde510f9149d937368295e">AddPossiblePendingEnemiesToBattle</a>();
<a name="l00290"></a>00290 
<a name="l00291"></a>00291             <a class="code" href="Reinforcement_8cpp.html#bf899650f72e161c6229bf4e28257f71">AddPossiblePendingMilitiaToBattle</a>();
<a name="l00292"></a>00292 
<a name="l00293"></a>00293 <span class="comment">//          InitEnemyUIBar( );</span>
<a name="l00294"></a>00294 
<a name="l00295"></a>00295             <a class="code" href="TeamTurns_8cpp.html#3d4a12dd64ba5f97a7b4e6216595026f">FreezeInterfaceForEnemyTurn</a>();
<a name="l00296"></a>00296 
<a name="l00297"></a>00297             <span class="comment">// Loop through all mercs and set to moved</span>
<a name="l00298"></a>00298             cnt = <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#2ecddfe580bb019bc92cc4859eaf3edc">Team</a>[ <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#d4322ac2c70a18b5aa84c2041e08c9b1">ubCurrentTeam</a> ].<a class="code" href="structTacticalTeamType.html#f8fe819ad07b242f5dbf97fd4c69b00d">bFirstID</a>;
<a name="l00299"></a>00299             <span class="keywordflow">for</span> ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> = <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ cnt ]; cnt &lt;= <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#2ecddfe580bb019bc92cc4859eaf3edc">Team</a>[ <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#d4322ac2c70a18b5aa84c2041e08c9b1">ubCurrentTeam</a> ].<a class="code" href="structTacticalTeamType.html#6a887279dad735dc302f21c1e559d5ce">bLastID</a>; cnt++,<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>++)
<a name="l00300"></a>00300             {
<a name="l00301"></a>00301                   <span class="keywordflow">if</span> ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#653dad4e2520784e293eca9f948b8532">bActive</a> )
<a name="l00302"></a>00302                   {
<a name="l00303"></a>00303                         <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#3f58b0f6efbd23c543ea12258a2f9ef3">bMoved</a> = TRUE;
<a name="l00304"></a>00304                   }
<a name="l00305"></a>00305             }
<a name="l00306"></a>00306 
<a name="l00307"></a>00307             <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#d4322ac2c70a18b5aa84c2041e08c9b1">ubCurrentTeam</a>  = ubNextTeam;
<a name="l00308"></a>00308 
<a name="l00309"></a>00309             <a class="code" href="Overhead_8h.html#b4f9ec77fb351b97b36c301809e4e142">BeginTeamTurn</a>( <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#d4322ac2c70a18b5aa84c2041e08c9b1">ubCurrentTeam</a> );
<a name="l00310"></a>00310 
<a name="l00311"></a>00311             <a class="code" href="opplist_8cpp.html#b8a47d7b99b4b1bdfd3d2ab5a873d26e">BetweenTurnsVisibilityAdjustments</a>();
<a name="l00312"></a>00312       }
<a name="l00313"></a>00313 }
<a name="l00314"></a>00314 
<a name="l00315"></a><a class="code" href="TeamTurns_8h.html#7c0aba67737ac957ec85869f31b1e898">00315</a> <span class="keywordtype">void</span> <a class="code" href="TeamTurns_8cpp.html#7c0aba67737ac957ec85869f31b1e898">EndAITurn</a>( <span class="keywordtype">void</span> )
<a name="l00316"></a>00316 {
<a name="l00317"></a>00317       DebugMsg (<a class="code" href="DEBUG_8cpp.html#a7985c2fd033797fc67a03b2c26e07c6">TOPIC_JA2</a>,DBG_LEVEL_3,<span class="stringliteral">"EndAITurn"</span>);
<a name="l00318"></a>00318       <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> * <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>;
<a name="l00319"></a>00319       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> cnt;
<a name="l00320"></a>00320 
<a name="l00321"></a>00321       <span class="comment">// Remove any deadlock message</span>
<a name="l00322"></a>00322       <a class="code" href="Interface_8cpp.html#0728ce1dc7dcaea64a98f2d25bcf556d">EndDeadlockMsg</a>( );
<a name="l00323"></a>00323       <span class="keywordflow">if</span> (INTERRUPT_QUEUED)
<a name="l00324"></a>00324       {
<a name="l00325"></a>00325             <a class="code" href="TeamTurns_8cpp.html#a41b1e4ef95bdf5732f5e41fa257864b">EndInterrupt</a>( FALSE );
<a name="l00326"></a>00326       }
<a name="l00327"></a>00327       <span class="keywordflow">else</span>
<a name="l00328"></a>00328       {
<a name="l00329"></a>00329             cnt = <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#2ecddfe580bb019bc92cc4859eaf3edc">Team</a>[ <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#d4322ac2c70a18b5aa84c2041e08c9b1">ubCurrentTeam</a> ].<a class="code" href="structTacticalTeamType.html#f8fe819ad07b242f5dbf97fd4c69b00d">bFirstID</a>;
<a name="l00330"></a>00330             <span class="keywordflow">for</span> ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> = <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ cnt ]; cnt &lt;= <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#2ecddfe580bb019bc92cc4859eaf3edc">Team</a>[ <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#d4322ac2c70a18b5aa84c2041e08c9b1">ubCurrentTeam</a> ].<a class="code" href="structTacticalTeamType.html#6a887279dad735dc302f21c1e559d5ce">bLastID</a>; cnt++,<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>++)
<a name="l00331"></a>00331             {
<a name="l00332"></a>00332                   <span class="keywordflow">if</span> ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#653dad4e2520784e293eca9f948b8532">bActive</a> )
<a name="l00333"></a>00333                   {
<a name="l00334"></a>00334                         <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#3f58b0f6efbd23c543ea12258a2f9ef3">bMoved</a> = TRUE;
<a name="l00335"></a>00335                         <span class="comment">// record old life value... for creature AI; the human AI might</span>
<a name="l00336"></a>00336                         <span class="comment">// want to use this too at some point</span>
<a name="l00337"></a>00337                         <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#995fe2e2151567a361207f41f64d8ff0">bOldLife</a> = <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#e308dea18533bf5ab2bcee5bbe27391c">bLife</a>;
<a name="l00338"></a>00338                   }
<a name="l00339"></a>00339             }
<a name="l00340"></a>00340 
<a name="l00341"></a>00341             <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#d4322ac2c70a18b5aa84c2041e08c9b1">ubCurrentTeam</a>++;
<a name="l00342"></a>00342             <a class="code" href="Overhead_8h.html#b4f9ec77fb351b97b36c301809e4e142">BeginTeamTurn</a>( <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#d4322ac2c70a18b5aa84c2041e08c9b1">ubCurrentTeam</a> );
<a name="l00343"></a>00343       }
<a name="l00344"></a>00344 }
<a name="l00345"></a>00345 
<a name="l00346"></a><a class="code" href="TeamTurns_8h.html#1643ee31d6de6678f25f57220ecccccf">00346</a> <span class="keywordtype">void</span> <a class="code" href="TeamTurns_8cpp.html#1643ee31d6de6678f25f57220ecccccf">EndAllAITurns</a>( <span class="keywordtype">void</span> )
<a name="l00347"></a>00347 {
<a name="l00348"></a>00348       DebugMsg (<a class="code" href="DEBUG_8cpp.html#a7985c2fd033797fc67a03b2c26e07c6">TOPIC_JA2</a>,DBG_LEVEL_3,<span class="stringliteral">"EndAllAITurns"</span>);
<a name="l00349"></a>00349       <span class="comment">// warp turn to the player's turn</span>
<a name="l00350"></a>00350       <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> * <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>;
<a name="l00351"></a>00351       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> cnt;
<a name="l00352"></a>00352 
<a name="l00353"></a>00353       <span class="comment">// Remove any deadlock message</span>
<a name="l00354"></a>00354       <a class="code" href="Interface_8cpp.html#0728ce1dc7dcaea64a98f2d25bcf556d">EndDeadlockMsg</a>( );
<a name="l00355"></a>00355       <span class="keywordflow">if</span> (INTERRUPT_QUEUED)
<a name="l00356"></a>00356       {
<a name="l00357"></a>00357             <a class="code" href="TeamTurns_8cpp.html#a41b1e4ef95bdf5732f5e41fa257864b">EndInterrupt</a>( FALSE );
<a name="l00358"></a>00358       }
<a name="l00359"></a>00359 
<a name="l00360"></a>00360       <span class="keywordflow">if</span> ( <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#d4322ac2c70a18b5aa84c2041e08c9b1">ubCurrentTeam</a> != <a class="code" href="Campaign_8cpp.html#47b2067ff75193e24776eda5297400ff">gbPlayerNum</a> )
<a name="l00361"></a>00361       {
<a name="l00362"></a>00362             cnt = <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#2ecddfe580bb019bc92cc4859eaf3edc">Team</a>[ <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#d4322ac2c70a18b5aa84c2041e08c9b1">ubCurrentTeam</a> ].<a class="code" href="structTacticalTeamType.html#f8fe819ad07b242f5dbf97fd4c69b00d">bFirstID</a>;
<a name="l00363"></a>00363             <span class="keywordflow">for</span> ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> = <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ cnt ]; cnt &lt;= <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#2ecddfe580bb019bc92cc4859eaf3edc">Team</a>[ <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#d4322ac2c70a18b5aa84c2041e08c9b1">ubCurrentTeam</a> ].<a class="code" href="structTacticalTeamType.html#6a887279dad735dc302f21c1e559d5ce">bLastID</a>; cnt++,<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>++)
<a name="l00364"></a>00364             {
<a name="l00365"></a>00365                   <span class="keywordflow">if</span> ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#653dad4e2520784e293eca9f948b8532">bActive</a> )
<a name="l00366"></a>00366                   {
<a name="l00367"></a>00367                         <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#3f58b0f6efbd23c543ea12258a2f9ef3">bMoved</a> = TRUE;
<a name="l00368"></a>00368                         <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#eb633099940bc20ff5a969bce84eab42">uiStatusFlags</a> &amp;= (~SOLDIER_UNDERAICONTROL);
<a name="l00369"></a>00369                         <span class="comment">// record old life value... for creature AI; the human AI might</span>
<a name="l00370"></a>00370                         <span class="comment">// want to use this too at some point</span>
<a name="l00371"></a>00371                         <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#995fe2e2151567a361207f41f64d8ff0">bOldLife</a> = <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#e308dea18533bf5ab2bcee5bbe27391c">bLife</a>;
<a name="l00372"></a>00372                   }
<a name="l00373"></a>00373             }
<a name="l00374"></a>00374 
<a name="l00375"></a>00375             <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#d4322ac2c70a18b5aa84c2041e08c9b1">ubCurrentTeam</a> = <a class="code" href="Campaign_8cpp.html#47b2067ff75193e24776eda5297400ff">gbPlayerNum</a>;
<a name="l00376"></a>00376             <span class="comment">//BeginTeamTurn( gTacticalStatus.ubCurrentTeam );</span>
<a name="l00377"></a>00377       }
<a name="l00378"></a>00378 }
<a name="l00379"></a>00379 
<a name="l00380"></a><a class="code" href="TeamTurns_8cpp.html#a20ea9f0835ccf34181d235a28dae609">00380</a> <span class="keywordtype">void</span> <a class="code" href="TeamTurns_8cpp.html#a20ea9f0835ccf34181d235a28dae609">EndTurnEvents</a>( <span class="keywordtype">void</span> )
<a name="l00381"></a>00381 {
<a name="l00382"></a>00382       DebugMsg (<a class="code" href="DEBUG_8cpp.html#a7985c2fd033797fc67a03b2c26e07c6">TOPIC_JA2</a>,DBG_LEVEL_3,<span class="stringliteral">"EndTurnEvents"</span>);
<a name="l00383"></a>00383       <span class="comment">// HANDLE END OF TURN EVENTS</span>
<a name="l00384"></a>00384       <span class="comment">// handle team services like healing</span>
<a name="l00385"></a>00385       <a class="code" href="Overhead_8cpp.html#505bde697df5669cdbbb623619bc5c53">HandleTeamServices</a>( <a class="code" href="Campaign_8cpp.html#47b2067ff75193e24776eda5297400ff">gbPlayerNum</a> );
<a name="l00386"></a>00386       <span class="comment">// handle smell and blood decay</span>
<a name="l00387"></a>00387       <a class="code" href="Smell_8cpp.html#aeaa16d820e9ca5f99f7de711e3801c1">DecaySmells</a>();
<a name="l00388"></a>00388       <span class="comment">// decay bomb timers and maybe set some off!</span>
<a name="l00389"></a>00389       <a class="code" href="Explosion_01Control_8cpp.html#f2eea78f105e7c6969a88fdedc94f354">DecayBombTimers</a>();
<a name="l00390"></a>00390 
<a name="l00391"></a>00391       <a class="code" href="SmokeEffects_8cpp.html#955b7743cb67d340569022a89bc029dd">DecaySmokeEffects</a>( <a class="code" href="Game_01Clock_8cpp.html#44b17d324c70be123694dba2deca1b89">GetWorldTotalSeconds</a>( ) );
<a name="l00392"></a>00392       <a class="code" href="LightEffects_8cpp.html#b033cc31f383709256a0735c26f218a3">DecayLightEffects</a>( <a class="code" href="Game_01Clock_8cpp.html#44b17d324c70be123694dba2deca1b89">GetWorldTotalSeconds</a>( ) );
<a name="l00393"></a>00393 
<a name="l00394"></a>00394       <span class="comment">// decay AI warning values from corpses</span>
<a name="l00395"></a>00395       <a class="code" href="Rotting_01Corpses_8cpp.html#5d7da8bdab6652842ce7c33aa8ce316d">DecayRottingCorpseAIWarnings</a>();
<a name="l00396"></a>00396 }
<a name="l00397"></a>00397 
<a name="l00398"></a>00398 <span class="comment">//rain</span>
<a name="l00399"></a>00399 <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="TeamTurns_8cpp.html#7b439a9e5f11f58383e23f4e3631399d">LightningEndOfTurn</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubTeam );
<a name="l00400"></a>00400 <span class="comment">//end rain</span>
<a name="l00401"></a>00401 
<a name="l00402"></a><a class="code" href="environment_8cpp.html#b4f9ec77fb351b97b36c301809e4e142">00402</a> <span class="keywordtype">void</span> <a class="code" href="Overhead_8h.html#b4f9ec77fb351b97b36c301809e4e142">BeginTeamTurn</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubTeam )
<a name="l00403"></a>00403 {
<a name="l00404"></a>00404       DebugMsg (<a class="code" href="DEBUG_8cpp.html#a7985c2fd033797fc67a03b2c26e07c6">TOPIC_JA2</a>,DBG_LEVEL_3,<span class="stringliteral">"BeginTeamTurn"</span>);
<a name="l00405"></a>00405       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> cnt;
<a name="l00406"></a>00406       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubID;
<a name="l00407"></a>00407       <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a>       *<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>;
<a name="l00408"></a>00408       
<a name="l00409"></a>00409       <span class="comment">//rain</span>
<a name="l00410"></a>00410       <span class="keywordflow">if</span>( !<a class="code" href="TeamTurns_8cpp.html#7b439a9e5f11f58383e23f4e3631399d">LightningEndOfTurn</a>( ubTeam ) )<span class="keywordflow">return</span>;
<a name="l00411"></a>00411       <span class="comment">//end rain</span>
<a name="l00412"></a>00412       
<a name="l00413"></a>00413       
<a name="l00414"></a>00414       <span class="keywordflow">while</span>( 1 )
<a name="l00415"></a>00415       {
<a name="l00416"></a>00416             <span class="keywordflow">if</span> ( ubTeam &gt; LAST_TEAM )
<a name="l00417"></a>00417             {
<a name="l00418"></a>00418                   <span class="keywordflow">if</span> ( <a class="code" href="Air_01Raid_8cpp.html#f23d7f9f303f3d4ea39f6ab74bf1779a">HandleAirRaidEndTurn</a>( ubTeam ) )
<a name="l00419"></a>00419                   {
<a name="l00420"></a>00420                         <span class="comment">// End turn!!</span>
<a name="l00421"></a>00421                         ubTeam = <a class="code" href="Campaign_8cpp.html#47b2067ff75193e24776eda5297400ff">gbPlayerNum</a>;
<a name="l00422"></a>00422                         <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#d4322ac2c70a18b5aa84c2041e08c9b1">ubCurrentTeam</a> = <a class="code" href="Campaign_8cpp.html#47b2067ff75193e24776eda5297400ff">gbPlayerNum</a>;
<a name="l00423"></a>00423                         <a class="code" href="TeamTurns_8cpp.html#a20ea9f0835ccf34181d235a28dae609">EndTurnEvents</a>();
<a name="l00424"></a>00424                   }
<a name="l00425"></a>00425                   <span class="keywordflow">else</span>
<a name="l00426"></a>00426                   {
<a name="l00427"></a>00427                         <span class="keywordflow">break</span>;
<a name="l00428"></a>00428                   }
<a name="l00429"></a>00429             }
<a name="l00430"></a>00430             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!(<a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#2ecddfe580bb019bc92cc4859eaf3edc">Team</a>[ ubTeam ].<a class="code" href="structTacticalTeamType.html#5e2ed425f613a7996ba1a0cd2cbaf050">bTeamActive</a>))
<a name="l00431"></a>00431             {
<a name="l00432"></a>00432                   <span class="comment">// inactive team, skip to the next one</span>
<a name="l00433"></a>00433                   ubTeam++;
<a name="l00434"></a>00434                   <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#d4322ac2c70a18b5aa84c2041e08c9b1">ubCurrentTeam</a>++;
<a name="l00435"></a>00435                   <span class="comment">// skip back to the top, as we are processing another team now.</span>
<a name="l00436"></a>00436                   <span class="keywordflow">continue</span>;               
<a name="l00437"></a>00437             }
<a name="l00438"></a>00438 
<a name="l00439"></a>00439             <span class="keywordflow">if</span> ( <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#89eb954f99ad4f28b84d7cf675c8ed32">uiFlags</a> &amp; TURNBASED )
<a name="l00440"></a>00440             {
<a name="l00441"></a>00441                   <a class="code" href="Dialogue_01Control_8cpp.html#1022102742f786def37f84f47564b89b">BeginLoggingForBleedMeToos</a>( TRUE );
<a name="l00442"></a>00442 
<a name="l00443"></a>00443                   <span class="comment">// decay team's public opplist</span>
<a name="l00444"></a>00444                   <a class="code" href="opplist_8cpp.html#2e44fe9c1060c7ff0e965fe5b6c83808">DecayPublicOpplist</a>( ubTeam );
<a name="l00445"></a>00445 
<a name="l00446"></a>00446                   cnt = <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#2ecddfe580bb019bc92cc4859eaf3edc">Team</a>[ ubTeam ].<a class="code" href="structTacticalTeamType.html#f8fe819ad07b242f5dbf97fd4c69b00d">bFirstID</a>;
<a name="l00447"></a>00447                   <span class="keywordflow">for</span> ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> = <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ cnt ]; cnt &lt;= <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#2ecddfe580bb019bc92cc4859eaf3edc">Team</a>[ ubTeam ].<a class="code" href="structTacticalTeamType.html#6a887279dad735dc302f21c1e559d5ce">bLastID</a>; cnt++,<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>++)
<a name="l00448"></a>00448                   {     
<a name="l00449"></a>00449                         <span class="keywordflow">if</span> ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#653dad4e2520784e293eca9f948b8532">bActive</a> &amp;&amp; <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#e308dea18533bf5ab2bcee5bbe27391c">bLife</a> &gt; 0)
<a name="l00450"></a>00450                         {
<a name="l00451"></a>00451                               <span class="comment">// decay personal opplist, and refresh APs and BPs</span>
<a name="l00452"></a>00452                               <a class="code" href="Soldier_01Control_8cpp.html#7864396be406712d3843fe8dce2b1d39">EVENT_BeginMercTurn</a>( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>, FALSE, 0 );
<a name="l00453"></a>00453                         }
<a name="l00454"></a>00454                   }
<a name="l00455"></a>00455 
<a name="l00456"></a>00456                   <span class="keywordflow">if</span> (<a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#32021b7251048d8c62ea0c2e26b7a021">bBoxingState</a> == <a class="code" href="Overhead_01Types_8h.html#60ed5bd8e4835b98d48cf7afb819b4e5e1a5b31aec8340458acd3ae62d223850">LOST_ROUND</a> || <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#32021b7251048d8c62ea0c2e26b7a021">bBoxingState</a> == <a class="code" href="Overhead_01Types_8h.html#60ed5bd8e4835b98d48cf7afb819b4e56fe9c7948d3b1a13d422f7c49b7b4d76">WON_ROUND</a> || <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#32021b7251048d8c62ea0c2e26b7a021">bBoxingState</a> == <a class="code" href="Overhead_01Types_8h.html#60ed5bd8e4835b98d48cf7afb819b4e5fc952b7b84248f9c3d710b02add2e0d7">DISQUALIFIED</a> )
<a name="l00457"></a>00457                   {
<a name="l00458"></a>00458                         <span class="comment">// we have no business being in here any more!</span>
<a name="l00459"></a>00459                         <span class="keywordflow">return</span>;
<a name="l00460"></a>00460                   }
<a name="l00461"></a>00461 
<a name="l00462"></a>00462                   <a class="code" href="Dialogue_01Control_8cpp.html#1022102742f786def37f84f47564b89b">BeginLoggingForBleedMeToos</a>( FALSE );
<a name="l00463"></a>00463 
<a name="l00464"></a>00464             }
<a name="l00465"></a>00465 
<a name="l00466"></a>00466             <a class="code" href="TeamTurns_8cpp.html#2c69a02e8aade1fe62e4e4ba5077f3ec">RecalculateSoldiersAniSpeed</a>();
<a name="l00467"></a>00467 
<a name="l00468"></a>00468             <span class="keywordflow">if</span> (ubTeam == <a class="code" href="Campaign_8cpp.html#47b2067ff75193e24776eda5297400ff">gbPlayerNum</a> )
<a name="l00469"></a>00469             {
<a name="l00470"></a>00470                   <span class="comment">// ATE: Check if we are still in a valid battle...</span>
<a name="l00471"></a>00471                   <span class="comment">// ( they could have blead to death above )</span>
<a name="l00472"></a>00472                   <span class="keywordflow">if</span> ( ( <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#89eb954f99ad4f28b84d7cf675c8ed32">uiFlags</a> &amp; INCOMBAT ) )
<a name="l00473"></a>00473                   {
<a name="l00474"></a>00474                         <a class="code" href="Overhead_8h.html#60bb10cf0b59f54af4a7d17da9049fc3">StartPlayerTeamTurn</a>( TRUE, FALSE );
<a name="l00475"></a>00475                   }
<a name="l00476"></a>00476                   <span class="keywordflow">break</span>;
<a name="l00477"></a>00477             }
<a name="l00478"></a>00478             <span class="keywordflow">else</span>
<a name="l00479"></a>00479             {
<a name="l00480"></a>00480 <span class="preprocessor">#ifdef NETWORKED</span>
<a name="l00481"></a>00481 <span class="preprocessor"></span>                  <span class="comment">// Only the host should do this</span>
<a name="l00482"></a>00482                   <span class="keywordflow">if</span>(!gfAmIHost)
<a name="l00483"></a>00483                         <span class="keywordflow">break</span>;
<a name="l00484"></a>00484 <span class="preprocessor">#endif</span>
<a name="l00485"></a>00485 <span class="preprocessor"></span>
<a name="l00486"></a>00486                   <span class="comment">// Set First enemy merc to AI control     </span>
<a name="l00487"></a>00487                   <span class="keywordflow">if</span> ( <a class="code" href="AIList_8cpp.html#affc398320dfd3067817cc95930c3f87">BuildAIListForTeam</a>( ubTeam ) )
<a name="l00488"></a>00488                   {
<a name="l00489"></a>00489 
<a name="l00490"></a>00490                         ubID = <a class="code" href="AIList_8cpp.html#3e00e7c335cc3bf9c339fe250eae28cd">RemoveFirstAIListEntry</a>();
<a name="l00491"></a>00491                         <span class="keywordflow">if</span> (ubID != NOBODY)
<a name="l00492"></a>00492                         {
<a name="l00493"></a>00493                               <span class="comment">// Dirty panel interface!</span>
<a name="l00494"></a>00494                               <a class="code" href="Interface_8cpp.html#310e02e85df33f7794f5c4c11ae1844d">fInterfacePanelDirty</a> = DIRTYLEVEL2;
<a name="l00495"></a>00495                               <span class="keywordflow">if</span> ( ubTeam == CREATURE_TEAM &amp;&amp; <a class="code" href="TeamTurns_8cpp.html#1bb9178e0898254541bdfab29a20d496">BloodcatsPresent</a>() )
<a name="l00496"></a>00496                               {
<a name="l00497"></a>00497                                     <a class="code" href="Interface_8cpp.html#0412325f96b29f8c8f39745c57758c39">AddTopMessage</a>( <a class="code" href="Interface_8h.html#65fe2c17232dbf1dd879382defeb6b63b7ef28213b1bd3a0a9ae60a1ed181c80">COMPUTER_TURN_MESSAGE</a>, <a class="code" href="__DutchText_8cpp.html#7813bcd58c4aa688254799c95ea7c6fa">Message</a>[ <a class="code" href="Text_8h.html#2bace310ffbaa508709e8fbb38af6ef34185e54870692483ed0620b6c73a7027">STR_BLOODCATS_TURN</a> ] );
<a name="l00498"></a>00498                               }
<a name="l00499"></a>00499                               <span class="keywordflow">else</span>
<a name="l00500"></a>00500                               {
<a name="l00501"></a>00501                                     <a class="code" href="Interface_8cpp.html#0412325f96b29f8c8f39745c57758c39">AddTopMessage</a>( <a class="code" href="Interface_8h.html#65fe2c17232dbf1dd879382defeb6b63b7ef28213b1bd3a0a9ae60a1ed181c80">COMPUTER_TURN_MESSAGE</a>, <a class="code" href="__DutchText_8cpp.html#4f334b3c24b867bf77c338c130e8b1bc">TeamTurnString</a>[ ubTeam ] );
<a name="l00502"></a>00502                               }
<a name="l00503"></a>00503                               <a class="code" href="ai_8h.html#6354d7a432959d5262c2d8ea5cde06c4">StartNPCAI</a>( <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ ubID ] );
<a name="l00504"></a>00504                               <span class="keywordflow">return</span>;
<a name="l00505"></a>00505                         }
<a name="l00506"></a>00506                   }
<a name="l00507"></a>00507 
<a name="l00508"></a>00508                   <span class="comment">// This team is dead/inactive/being skipped in boxing</span>
<a name="l00509"></a>00509                   <span class="comment">// skip back to the top to process the next team</span>
<a name="l00510"></a>00510                   ubTeam++;
<a name="l00511"></a>00511                   <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#d4322ac2c70a18b5aa84c2041e08c9b1">ubCurrentTeam</a>++;
<a name="l00512"></a>00512             }
<a name="l00513"></a>00513       }
<a name="l00514"></a>00514 }
<a name="l00515"></a>00515 
<a name="l00516"></a><a class="code" href="TeamTurns_8h.html#53df607eaa81957124edb5cb22743d25">00516</a> <span class="keywordtype">void</span> <a class="code" href="TeamTurns_8cpp.html#53df607eaa81957124edb5cb22743d25">DisplayHiddenInterrupt</a>( <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> * <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> )
<a name="l00517"></a>00517 {
<a name="l00518"></a>00518       DebugMsg (<a class="code" href="DEBUG_8cpp.html#a7985c2fd033797fc67a03b2c26e07c6">TOPIC_JA2</a>,DBG_LEVEL_3,<span class="stringliteral">"DisplayHiddenInterrupt"</span>);
<a name="l00519"></a>00519       <span class="comment">// If the AI got an interrupt but this has been hidden from the player until this point,</span>
<a name="l00520"></a>00520       <span class="comment">// this code will display the interrupt</span>
<a name="l00521"></a>00521 
<a name="l00522"></a>00522       <span class="keywordflow">if</span> (!<a class="code" href="TeamTurns_8cpp.html#782955f80e251720a735649d4e8a5987">gfHiddenInterrupt</a>)
<a name="l00523"></a>00523       {
<a name="l00524"></a>00524             <span class="keywordflow">return</span>;
<a name="l00525"></a>00525       }
<a name="l00526"></a>00526       <a class="code" href="Interface_8cpp.html#0728ce1dc7dcaea64a98f2d25bcf556d">EndDeadlockMsg</a>( );
<a name="l00527"></a>00527 
<a name="l00528"></a>00528       <span class="keywordflow">if</span> (<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#73246323764393ce2a5ece7fcb7b7cf8">bVisible</a> != -1 )
<a name="l00529"></a>00529       {
<a name="l00530"></a>00530             <a class="code" href="Overhead_8cpp.html#d449ca43df0cc8426ed73cf5eedca433">SlideTo</a>( NOWHERE, <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#18aef170576da81b10d00e7b6cd3627b">ubID</a>, NOBODY ,SETLOCATOR);
<a name="l00531"></a>00531       }
<a name="l00532"></a>00532 
<a name="l00533"></a>00533       <a class="code" href="Handle_01UI_8cpp.html#c1a811228f6db879e9c1d67b68651a1b">guiPendingOverrideEvent</a> = <a class="code" href="Handle_01UI_8h.html#af14d9a15c91cd740ff202b6335e405e9284e6f1f50ffc974b408c62555d8ba2">LU_BEGINUILOCK</a>;
<a name="l00534"></a>00534 
<a name="l00535"></a>00535       <span class="comment">// Dirty panel interface!</span>
<a name="l00536"></a>00536       <a class="code" href="Interface_8cpp.html#310e02e85df33f7794f5c4c11ae1844d">fInterfacePanelDirty</a> = DIRTYLEVEL2;
<a name="l00537"></a>00537 
<a name="l00538"></a>00538       DebugMsg (<a class="code" href="DEBUG_8cpp.html#a7985c2fd033797fc67a03b2c26e07c6">TOPIC_JA2</a>,DBG_LEVEL_3,<span class="stringliteral">"about to call ErasePath"</span>);
<a name="l00539"></a>00539       <span class="comment">// Erase path!</span>
<a name="l00540"></a>00540       <a class="code" href="PATHAI_8cpp.html#33cf219cddf5174a2c1701521a51f38b">ErasePath</a>( TRUE );
<a name="l00541"></a>00541 
<a name="l00542"></a>00542       <span class="comment">// Reset flags</span>
<a name="l00543"></a>00543       <a class="code" href="Handle_01UI_8cpp.html#5a5e679474e784af12194877e4003ba4">gfPlotNewMovement</a> = TRUE;
<a name="l00544"></a>00544 
<a name="l00545"></a>00545       DebugMsg (<a class="code" href="DEBUG_8cpp.html#a7985c2fd033797fc67a03b2c26e07c6">TOPIC_JA2</a>,DBG_LEVEL_3,<span class="stringliteral">"about to call AdjustNoAPToFinishMove"</span>);
<a name="l00546"></a>00546       <span class="comment">// Stop our guy....</span>
<a name="l00547"></a>00547       <a class="code" href="Soldier_01Control_8cpp.html#11fd19e17adc39731d2b3688a028a833">AdjustNoAPToFinishMove</a>( <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ LATEST_INTERRUPT_GUY ], TRUE ); 
<a name="l00548"></a>00548       <span class="comment">// Stop him from going to prone position if doing a turn while prone</span>
<a name="l00549"></a>00549       <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ LATEST_INTERRUPT_GUY ]-&gt;<a class="code" href="structSOLDIERTYPE.html#3a52d1286affb8bb63c00d01e805267c">fTurningFromPronePosition</a> = FALSE;
<a name="l00550"></a>00550 
<a name="l00551"></a>00551       DebugMsg (<a class="code" href="DEBUG_8cpp.html#a7985c2fd033797fc67a03b2c26e07c6">TOPIC_JA2</a>,DBG_LEVEL_3,<span class="stringliteral">"about to call AddTopMessage"</span>);
<a name="l00552"></a>00552       <span class="comment">// get rid of any old overlay message</span>
<a name="l00553"></a>00553       <span class="keywordflow">if</span> ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#74a40a8aaf3efe840cdaf6be62556d82">bTeam</a> == MILITIA_TEAM )
<a name="l00554"></a>00554       {
<a name="l00555"></a>00555             <a class="code" href="Interface_8cpp.html#0412325f96b29f8c8f39745c57758c39">AddTopMessage</a>( <a class="code" href="Interface_8h.html#65fe2c17232dbf1dd879382defeb6b638c4b10ac9d92dc896bd430fef409d776">MILITIA_INTERRUPT_MESSAGE</a>, <a class="code" href="__DutchText_8cpp.html#7813bcd58c4aa688254799c95ea7c6fa">Message</a>[ <a class="code" href="Text_8h.html#2bace310ffbaa508709e8fbb38af6ef3ec4c50eeca16f17cf12964b2b622e1ec">STR_INTERRUPT</a> ] );
<a name="l00556"></a>00556       }
<a name="l00557"></a>00557       <span class="keywordflow">else</span>
<a name="l00558"></a>00558       {
<a name="l00559"></a>00559             <a class="code" href="Interface_8cpp.html#0412325f96b29f8c8f39745c57758c39">AddTopMessage</a>( <a class="code" href="Interface_8h.html#65fe2c17232dbf1dd879382defeb6b63206207a05f18c7716ef31212016a55e1">COMPUTER_INTERRUPT_MESSAGE</a>, <a class="code" href="__DutchText_8cpp.html#7813bcd58c4aa688254799c95ea7c6fa">Message</a>[ <a class="code" href="Text_8h.html#2bace310ffbaa508709e8fbb38af6ef3ec4c50eeca16f17cf12964b2b622e1ec">STR_INTERRUPT</a> ] );
<a name="l00560"></a>00560       }
<a name="l00561"></a>00561 
<a name="l00562"></a>00562       <a class="code" href="TeamTurns_8cpp.html#782955f80e251720a735649d4e8a5987">gfHiddenInterrupt</a> = FALSE;
<a name="l00563"></a>00563 
<a name="l00564"></a>00564       DebugMsg (<a class="code" href="DEBUG_8cpp.html#a7985c2fd033797fc67a03b2c26e07c6">TOPIC_JA2</a>,DBG_LEVEL_3,<span class="stringliteral">"DisplayHiddenInterrupt completed"</span>);
<a name="l00565"></a>00565 }
<a name="l00566"></a>00566 
<a name="l00567"></a><a class="code" href="AIMain_8cpp.html#02da951e111db983c8215f4c726bdc65">00567</a> <span class="keywordtype">void</span> <a class="code" href="TeamTurns_8cpp.html#02da951e111db983c8215f4c726bdc65">DisplayHiddenTurnbased</a>( <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> * pActingSoldier )
<a name="l00568"></a>00568 {
<a name="l00569"></a>00569       DebugMsg (<a class="code" href="DEBUG_8cpp.html#a7985c2fd033797fc67a03b2c26e07c6">TOPIC_JA2</a>,DBG_LEVEL_3,<span class="stringliteral">"DisplayHiddenTurnBased"</span>);
<a name="l00570"></a>00570       <span class="comment">// This code should put the game in turn-based and give control to the AI-controlled soldier</span>
<a name="l00571"></a>00571       <span class="comment">// whose pointer has been passed in as an argument (we were in non-combat and the AI is doing</span>
<a name="l00572"></a>00572       <span class="comment">// something visible, i.e. making an attack)</span>
<a name="l00573"></a>00573 
<a name="l00574"></a>00574       <span class="keywordflow">if</span> ( <a class="code" href="Meanwhile_8cpp.html#469f9fe7efd5677c25840cf980c1fb55">AreInMeanwhile</a>( ) )
<a name="l00575"></a>00575       {
<a name="l00576"></a>00576             <span class="keywordflow">return</span>;
<a name="l00577"></a>00577       }
<a name="l00578"></a>00578 
<a name="l00579"></a>00579       <span class="keywordflow">if</span> (<a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#89eb954f99ad4f28b84d7cf675c8ed32">uiFlags</a> &amp; REALTIME || <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#89eb954f99ad4f28b84d7cf675c8ed32">uiFlags</a> &amp; INCOMBAT)
<a name="l00580"></a>00580       {
<a name="l00581"></a>00581             <span class="comment">// pointless call here; do nothing</span>
<a name="l00582"></a>00582             <span class="keywordflow">return</span>;
<a name="l00583"></a>00583       }
<a name="l00584"></a>00584 
<a name="l00585"></a>00585       <span class="comment">// Enter combat mode starting with this side's turn</span>
<a name="l00586"></a>00586       <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#d4322ac2c70a18b5aa84c2041e08c9b1">ubCurrentTeam</a>  = pActingSoldier-&gt;<a class="code" href="structSOLDIERTYPE.html#74a40a8aaf3efe840cdaf6be62556d82">bTeam</a>;
<a name="l00587"></a>00587 
<a name="l00588"></a>00588       <a class="code" href="Overhead_8cpp.html#8fe2ee500e7c7a9f8bbd88d31820d8ef">CommonEnterCombatModeCode</a>( );
<a name="l00589"></a>00589 
<a name="l00590"></a>00590       <span class="comment">//JA2Gold: use function to make sure flags turned off everywhere else</span>
<a name="l00591"></a>00591       <span class="comment">//pActingSoldier-&gt;uiStatusFlags |= SOLDIER_UNDERAICONTROL;</span>
<a name="l00592"></a>00592       <a class="code" href="Soldier_01Control_8cpp.html#ed4e321e06fac73dcc6c3cabb4a1f1f5">SetSoldierAsUnderAiControl</a>( pActingSoldier );
<a name="l00593"></a>00593       <a class="code" href="ai_8h.html#67640c28ffcaa1eb59c6780ea4bb2e23">DebugAI</a>( (<a class="code" href="Types_8h.html#ba0652aa53ceb4404f77e13a0c993b0e">STR</a>)<a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>( <span class="stringliteral">"Giving AI control to %d"</span>, pActingSoldier-&gt;<a class="code" href="structSOLDIERTYPE.html#18aef170576da81b10d00e7b6cd3627b">ubID</a> ) );
<a name="l00594"></a>00594       pActingSoldier-&gt;<a class="code" href="structSOLDIERTYPE.html#87feaf9475b90143652df19829930b96">fTurnInProgress</a> = TRUE;
<a name="l00595"></a>00595       <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#a1b7eae915048f8deb7376f3ea5bc920">uiTimeSinceMercAIStart</a> = GetJA2Clock();
<a name="l00596"></a>00596 
<a name="l00597"></a>00597       <span class="keywordflow">if</span> ( <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#e9c5eccc985038314344af7a60cd7ccb">ubTopMessageType</a> != <a class="code" href="Interface_8h.html#65fe2c17232dbf1dd879382defeb6b63b7ef28213b1bd3a0a9ae60a1ed181c80">COMPUTER_TURN_MESSAGE</a>)
<a name="l00598"></a>00598       {
<a name="l00599"></a>00599             <span class="comment">// Dirty panel interface!</span>
<a name="l00600"></a>00600             <a class="code" href="Interface_8cpp.html#310e02e85df33f7794f5c4c11ae1844d">fInterfacePanelDirty</a> = DIRTYLEVEL2;
<a name="l00601"></a>00601             <span class="keywordflow">if</span> ( <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#d4322ac2c70a18b5aa84c2041e08c9b1">ubCurrentTeam</a> == CREATURE_TEAM &amp;&amp; <a class="code" href="TeamTurns_8cpp.html#1bb9178e0898254541bdfab29a20d496">BloodcatsPresent</a>() )
<a name="l00602"></a>00602             {
<a name="l00603"></a>00603                   <a class="code" href="Interface_8cpp.html#0412325f96b29f8c8f39745c57758c39">AddTopMessage</a>( <a class="code" href="Interface_8h.html#65fe2c17232dbf1dd879382defeb6b63b7ef28213b1bd3a0a9ae60a1ed181c80">COMPUTER_TURN_MESSAGE</a>, <a class="code" href="__DutchText_8cpp.html#7813bcd58c4aa688254799c95ea7c6fa">Message</a>[ <a class="code" href="Text_8h.html#2bace310ffbaa508709e8fbb38af6ef34185e54870692483ed0620b6c73a7027">STR_BLOODCATS_TURN</a> ] );
<a name="l00604"></a>00604             }
<a name="l00605"></a>00605             <span class="keywordflow">else</span>
<a name="l00606"></a>00606             {
<a name="l00607"></a>00607                   <a class="code" href="Interface_8cpp.html#0412325f96b29f8c8f39745c57758c39">AddTopMessage</a>( <a class="code" href="Interface_8h.html#65fe2c17232dbf1dd879382defeb6b63b7ef28213b1bd3a0a9ae60a1ed181c80">COMPUTER_TURN_MESSAGE</a>, <a class="code" href="__DutchText_8cpp.html#4f334b3c24b867bf77c338c130e8b1bc">TeamTurnString</a>[ <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#d4322ac2c70a18b5aa84c2041e08c9b1">ubCurrentTeam</a> ] );
<a name="l00608"></a>00608             }
<a name="l00609"></a>00609 
<a name="l00610"></a>00610       }
<a name="l00611"></a>00611 
<a name="l00612"></a>00612 
<a name="l00613"></a>00613       <span class="comment">// freeze the user's interface</span>
<a name="l00614"></a>00614       <a class="code" href="TeamTurns_8cpp.html#3d4a12dd64ba5f97a7b4e6216595026f">FreezeInterfaceForEnemyTurn</a>();
<a name="l00615"></a>00615 }
<a name="l00616"></a>00616 
<a name="l00617"></a><a class="code" href="TeamTurns_8cpp.html#624e3dd003e482573366a5527d11aa84">00617</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="TeamTurns_8cpp.html#624e3dd003e482573366a5527d11aa84">EveryoneInInterruptListOnSameTeam</a>( <span class="keywordtype">void</span> )
<a name="l00618"></a>00618 {
<a name="l00619"></a>00619       DebugMsg (<a class="code" href="DEBUG_8cpp.html#a7985c2fd033797fc67a03b2c26e07c6">TOPIC_JA2</a>,DBG_LEVEL_3,<span class="stringliteral">"EveryoneInInterruptListOnSameTeam"</span>);
<a name="l00620"></a>00620       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubLoop;
<a name="l00621"></a>00621       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubTeam = 255;
<a name="l00622"></a>00622 
<a name="l00623"></a>00623       <span class="keywordflow">for</span> (ubLoop = 1; ubLoop &lt;= <a class="code" href="TeamTurns_8cpp.html#bba49c23835b863c536a9796e4461183">gubOutOfTurnPersons</a>; ubLoop++)
<a name="l00624"></a>00624       {
<a name="l00625"></a>00625             <span class="keywordflow">if</span> ( ubTeam == 255 )
<a name="l00626"></a>00626             {
<a name="l00627"></a>00627                   ubTeam = <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ <a class="code" href="TeamTurns_8cpp.html#8f8bdbac1eb4174dfb142fd50f762004">gubOutOfTurnOrder</a>[ ubLoop ] ]-&gt;bTeam;
<a name="l00628"></a>00628             }
<a name="l00629"></a>00629             <span class="keywordflow">else</span>
<a name="l00630"></a>00630             {
<a name="l00631"></a>00631                   <span class="keywordflow">if</span> ( <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ <a class="code" href="TeamTurns_8cpp.html#8f8bdbac1eb4174dfb142fd50f762004">gubOutOfTurnOrder</a>[ ubLoop ] ]-&gt;bTeam != ubTeam )
<a name="l00632"></a>00632                   {
<a name="l00633"></a>00633                         <span class="keywordflow">return</span>( FALSE );
<a name="l00634"></a>00634                   }
<a name="l00635"></a>00635             }
<a name="l00636"></a>00636       }
<a name="l00637"></a>00637       <span class="keywordflow">return</span>( TRUE );
<a name="l00638"></a>00638 }
<a name="l00639"></a>00639 
<a name="l00640"></a><a class="code" href="TeamTurns_8cpp.html#23696bb3b808ce3a04abab4deb7f2ce7">00640</a> <span class="keywordtype">void</span> <a class="code" href="TeamTurns_8cpp.html#23696bb3b808ce3a04abab4deb7f2ce7">StartInterrupt</a>( <span class="keywordtype">void</span> )
<a name="l00641"></a>00641 {
<a name="l00642"></a>00642       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>                               ubFirstInterrupter;
<a name="l00643"></a>00643       <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>                                bTeam;
<a name="l00644"></a>00644       <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *           <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>;
<a name="l00645"></a>00645       <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *           <a class="code" href="EditorMercs_8cpp.html#93f0d7aeeac23b3a7528643fca0d2012">pTempSoldier</a>;
<a name="l00646"></a>00646       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>                               ubInterrupter;
<a name="l00647"></a>00647       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>                               cnt;
<a name="l00648"></a>00648 
<a name="l00649"></a>00649       DebugMsg (<a class="code" href="DEBUG_8cpp.html#a7985c2fd033797fc67a03b2c26e07c6">TOPIC_JA2</a>,DBG_LEVEL_3,<span class="stringliteral">"StartInterrupt"</span>);
<a name="l00650"></a>00650       ubFirstInterrupter = LATEST_INTERRUPT_GUY;
<a name="l00651"></a>00651       <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> = <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ubFirstInterrupter];
<a name="l00652"></a>00652       bTeam = <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#74a40a8aaf3efe840cdaf6be62556d82">bTeam</a>;
<a name="l00653"></a>00653       ubInterrupter = ubFirstInterrupter;
<a name="l00654"></a>00654 
<a name="l00655"></a>00655       <span class="comment">// display everyone on int queue!</span>
<a name="l00656"></a>00656       <span class="keywordflow">for</span> ( cnt = <a class="code" href="TeamTurns_8cpp.html#bba49c23835b863c536a9796e4461183">gubOutOfTurnPersons</a>; cnt &gt; 0; cnt-- )
<a name="l00657"></a>00657       {
<a name="l00658"></a>00658             DebugMsg( <a class="code" href="DEBUG_8cpp.html#a7985c2fd033797fc67a03b2c26e07c6">TOPIC_JA2</a>, DBG_LEVEL_3, <a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>(<span class="stringliteral">"STARTINT:  Q position %d: %d"</span>, cnt, <a class="code" href="TeamTurns_8cpp.html#8f8bdbac1eb4174dfb142fd50f762004">gubOutOfTurnOrder</a>[ cnt ] ) );
<a name="l00659"></a>00659       }
<a name="l00660"></a>00660 
<a name="l00661"></a>00661       <span class="comment">//DebugMsg( TOPIC_JA2, DBG_LEVEL_3, String("INTERRUPT: %d is now on top of the interrupt queue", ubFirstInterrupter ) );</span>
<a name="l00662"></a>00662 
<a name="l00663"></a>00663       <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#1548ced3c6d159efdbd02efbc1aaf4c6">fInterruptOccurred</a> = TRUE;
<a name="l00664"></a>00664 
<a name="l00665"></a>00665       cnt = 0;
<a name="l00666"></a>00666       <span class="keywordflow">for</span> ( <a class="code" href="EditorMercs_8cpp.html#93f0d7aeeac23b3a7528643fca0d2012">pTempSoldier</a> = <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ cnt ]; cnt &lt;= MAX_NUM_SOLDIERS; cnt++,<a class="code" href="EditorMercs_8cpp.html#93f0d7aeeac23b3a7528643fca0d2012">pTempSoldier</a>++)
<a name="l00667"></a>00667       {
<a name="l00668"></a>00668             <span class="keywordflow">if</span> ( <a class="code" href="EditorMercs_8cpp.html#93f0d7aeeac23b3a7528643fca0d2012">pTempSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#653dad4e2520784e293eca9f948b8532">bActive</a> )
<a name="l00669"></a>00669             {
<a name="l00670"></a>00670                   <a class="code" href="EditorMercs_8cpp.html#93f0d7aeeac23b3a7528643fca0d2012">pTempSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#f7e1b2c79ee994f4be61f6c62e53b0a2">bMovedPriorToInterrupt</a> = <a class="code" href="EditorMercs_8cpp.html#93f0d7aeeac23b3a7528643fca0d2012">pTempSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#3f58b0f6efbd23c543ea12258a2f9ef3">bMoved</a>;
<a name="l00671"></a>00671                   <a class="code" href="EditorMercs_8cpp.html#93f0d7aeeac23b3a7528643fca0d2012">pTempSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#3f58b0f6efbd23c543ea12258a2f9ef3">bMoved</a> = TRUE;
<a name="l00672"></a>00672             }
<a name="l00673"></a>00673       }
<a name="l00674"></a>00674 
<a name="l00675"></a>00675       <span class="keywordflow">if</span> (<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#74a40a8aaf3efe840cdaf6be62556d82">bTeam</a> == OUR_TEAM)
<a name="l00676"></a>00676       {
<a name="l00677"></a>00677             <span class="comment">// start interrupts for everyone on our side at once</span>
<a name="l00678"></a>00678             <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a>       sTemp[ 255 ];
<a name="l00679"></a>00679             <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>       ubInterrupters = 0;
<a name="l00680"></a>00680             <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>       iSquad, iCounter;
<a name="l00681"></a>00681 
<a name="l00682"></a>00682             <span class="comment">// build string for display of who gets interrupt</span>
<a name="l00683"></a>00683             <span class="keywordflow">while</span>( 1 )
<a name="l00684"></a>00684             {
<a name="l00685"></a>00685                   <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ubInterrupter]-&gt;<a class="code" href="structSOLDIERTYPE.html#3f58b0f6efbd23c543ea12258a2f9ef3">bMoved</a> = FALSE;
<a name="l00686"></a>00686                   DebugMsg( <a class="code" href="DEBUG_8cpp.html#a7985c2fd033797fc67a03b2c26e07c6">TOPIC_JA2</a>, DBG_LEVEL_3, <a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>(<span class="stringliteral">"INTERRUPT: popping %d off of the interrupt queue"</span>, ubInterrupter ) );
<a name="l00687"></a>00687 
<a name="l00688"></a>00688                   REMOVE_LATEST_INTERRUPT_GUY();
<a name="l00689"></a>00689                   <span class="comment">// now LATEST_INTERRUPT_GUY is the guy before the previous</span>
<a name="l00690"></a>00690                   ubInterrupter = LATEST_INTERRUPT_GUY;
<a name="l00691"></a>00691 
<a name="l00692"></a>00692                   <span class="keywordflow">if</span> (ubInterrupter == NOBODY) <span class="comment">// previously emptied slot!</span>
<a name="l00693"></a>00693                   {
<a name="l00694"></a>00694                         <span class="keywordflow">continue</span>;
<a name="l00695"></a>00695                   }
<a name="l00696"></a>00696                   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ubInterrupter]-&gt;bTeam != bTeam)
<a name="l00697"></a>00697                   {
<a name="l00698"></a>00698                         <span class="keywordflow">break</span>;
<a name="l00699"></a>00699                   }
<a name="l00700"></a>00700             }
<a name="l00701"></a>00701 
<a name="l00702"></a>00702             <a class="code" href="Sys_01Globals_8h.html#3d1e5716a3d04a53b8846319dd57da83">wcscpy</a>( sTemp, <a class="code" href="__DutchText_8cpp.html#7813bcd58c4aa688254799c95ea7c6fa">Message</a>[ <a class="code" href="Text_8h.html#2bace310ffbaa508709e8fbb38af6ef3ff0e8de754cce4e3f2542c0ed8db31a4">STR_INTERRUPT_FOR</a> ] );
<a name="l00703"></a>00703 
<a name="l00704"></a>00704             <span class="comment">// build string in separate loop here, want to linearly process squads...</span>
<a name="l00705"></a>00705             <span class="keywordflow">for</span> ( iSquad = 0; iSquad &lt; <a class="code" href="Squads_8h.html#19516aacc906a3c234aed4c5fdb53c3569e0d9a3efcedbba52faebfe02116adb">NUMBER_OF_SQUADS</a>; iSquad++ )
<a name="l00706"></a>00706             {
<a name="l00707"></a>00707                   <span class="keywordflow">for</span> ( iCounter = 0; iCounter &lt; NUMBER_OF_SOLDIERS_PER_SQUAD; iCounter++ )
<a name="l00708"></a>00708                   {
<a name="l00709"></a>00709                         <a class="code" href="EditorMercs_8cpp.html#93f0d7aeeac23b3a7528643fca0d2012">pTempSoldier</a> = <a class="code" href="Squads_8cpp.html#c7d3b2609f0382d7cf84e6dcc8d5899b">Squad</a>[ iSquad ][ iCounter ];
<a name="l00710"></a>00710                         <span class="keywordflow">if</span> ( <a class="code" href="EditorMercs_8cpp.html#93f0d7aeeac23b3a7528643fca0d2012">pTempSoldier</a> &amp;&amp; <a class="code" href="EditorMercs_8cpp.html#93f0d7aeeac23b3a7528643fca0d2012">pTempSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#653dad4e2520784e293eca9f948b8532">bActive</a> &amp;&amp; <a class="code" href="EditorMercs_8cpp.html#93f0d7aeeac23b3a7528643fca0d2012">pTempSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#b0096f321a0de4f0617283f7b3212aa0">bInSector</a> &amp;&amp; !<a class="code" href="EditorMercs_8cpp.html#93f0d7aeeac23b3a7528643fca0d2012">pTempSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#3f58b0f6efbd23c543ea12258a2f9ef3">bMoved</a> )
<a name="l00711"></a>00711                         {
<a name="l00712"></a>00712                               <span class="comment">// then this guy got an interrupt...</span>
<a name="l00713"></a>00713                               ubInterrupters++;
<a name="l00714"></a>00714                               <a class="code" href="Soldier_01Ani_8cpp.html#c294aa65f0375eb6343a2de2a25dafcc">if</a> ( ubInterrupters &gt; 6 )
<a name="l00715"></a>00715                               {
<a name="l00716"></a>00716                                     <span class="comment">// flush... display string, then clear it (we could have 20 names!)</span>
<a name="l00717"></a>00717                                     <span class="comment">// add comma to end, we know we have another person after this...</span>
<a name="l00718"></a>00718                                     <a class="code" href="Sys_01Globals_8h.html#92a23b0a8bea9679b6f78aa26b1715e7">wcscat</a>( sTemp, L<span class="stringliteral">", "</span> );
<a name="l00719"></a>00719                                     <a class="code" href="message_8cpp.html#818e47bc59bd5a5755f06ec51cd74928">ScreenMsg</a>( FONT_MCOLOR_LTYELLOW, MSG_INTERFACE, (<a class="code" href="Types_8h.html#94ebfccc6e846c28751f8d616371f1e5">STR16</a>) sTemp );
<a name="l00720"></a>00720                                     <a class="code" href="Sys_01Globals_8h.html#3d1e5716a3d04a53b8846319dd57da83">wcscpy</a>( sTemp, L<span class="stringliteral">""</span> );
<a name="l00721"></a>00721                                     ubInterrupters = 1;
<a name="l00722"></a>00722                               }
<a name="l00723"></a>00723 
<a name="l00724"></a>00724                               <span class="keywordflow">if</span> ( ubInterrupters &gt; 1 )
<a name="l00725"></a>00725                               {
<a name="l00726"></a>00726                                     <a class="code" href="Sys_01Globals_8h.html#92a23b0a8bea9679b6f78aa26b1715e7">wcscat</a>( sTemp, L<span class="stringliteral">", "</span> );
<a name="l00727"></a>00727                               }
<a name="l00728"></a>00728                               <a class="code" href="Sys_01Globals_8h.html#92a23b0a8bea9679b6f78aa26b1715e7">wcscat</a>( sTemp, <a class="code" href="EditorMercs_8cpp.html#93f0d7aeeac23b3a7528643fca0d2012">pTempSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#7bf7231f416aa66f38010b7a7e8f2341">name</a> );
<a name="l00729"></a>00729                         }
<a name="l00730"></a>00730                   }
<a name="l00731"></a>00731             }
<a name="l00732"></a>00732 
<a name="l00733"></a>00733             <a class="code" href="message_8cpp.html#818e47bc59bd5a5755f06ec51cd74928">ScreenMsg</a>( FONT_MCOLOR_LTYELLOW, MSG_INTERFACE, (<a class="code" href="Types_8h.html#94ebfccc6e846c28751f8d616371f1e5">STR16</a>) sTemp );
<a name="l00734"></a>00734 
<a name="l00735"></a>00735             DebugMsg( TOPIC_JA2, DBG_LEVEL_3, <a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>(<span class="stringliteral">"INTERRUPT: starting interrupt for %d"</span>, ubFirstInterrupter ) );
<a name="l00736"></a>00736             <span class="comment">// gusSelectedSoldier should become the topmost guy on the interrupt list</span>
<a name="l00737"></a>00737             <span class="comment">//gusSelectedSoldier = ubFirstInterrupter;</span>
<a name="l00738"></a>00738 
<a name="l00739"></a>00739             <span class="comment">// Remove deadlock message</span>
<a name="l00740"></a>00740             <a class="code" href="Interface_8cpp.html#0728ce1dc7dcaea64a98f2d25bcf556d">EndDeadlockMsg</a>( );
<a name="l00741"></a>00741             
<a name="l00742"></a>00742             <span class="comment">// Select guy....</span>
<a name="l00743"></a>00743             <a class="code" href="Overhead_8cpp.html#9c8656f3f3153ede7b7d896e908864b7">SelectSoldier</a>( ubFirstInterrupter, TRUE, TRUE );
<a name="l00744"></a>00744 
<a name="l00745"></a>00745             <span class="comment">// ATE; Slide to guy who got interrupted!</span>
<a name="l00746"></a>00746             <a class="code" href="Overhead_8cpp.html#d449ca43df0cc8426ed73cf5eedca433">SlideTo</a>( NOWHERE, <a class="code" href="TeamTurns_8cpp.html#3ff1395df97489a5417b119827e89eb8">gubLastInterruptedGuy</a>, NOBODY, SETLOCATOR);
<a name="l00747"></a>00747 
<a name="l00748"></a>00748             <span class="comment">// Dirty panel interface!</span>
<a name="l00749"></a>00749             <a class="code" href="Interface_8cpp.html#310e02e85df33f7794f5c4c11ae1844d">fInterfacePanelDirty</a>                                  = DIRTYLEVEL2;
<a name="l00750"></a>00750             <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#d4322ac2c70a18b5aa84c2041e08c9b1">ubCurrentTeam</a>   = <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#74a40a8aaf3efe840cdaf6be62556d82">bTeam</a>;
<a name="l00751"></a>00751 
<a name="l00752"></a>00752             <span class="comment">// Signal UI done enemy's turn</span>
<a name="l00753"></a>00753             <a class="code" href="Handle_01UI_8cpp.html#c1a811228f6db879e9c1d67b68651a1b">guiPendingOverrideEvent</a> = <a class="code" href="Handle_01UI_8h.html#af14d9a15c91cd740ff202b6335e405ecdd777bfca71920c86e66ee609316ceb">LU_ENDUILOCK</a>;
<a name="l00754"></a>00754             <a class="code" href="Handle_01UI_8cpp.html#2633147d0d1a1bafac01733902d66452">HandleTacticalUI</a>( );
<a name="l00755"></a>00755 
<a name="l00756"></a>00756             <a class="code" href="Interface_8cpp.html#e1d00e8e7f6f650538adc7f8357a7f78">InitPlayerUIBar</a>( TRUE );
<a name="l00757"></a>00757             <span class="comment">//AddTopMessage( PLAYER_INTERRUPT_MESSAGE, Message[STR_INTERRUPT] );</span>
<a name="l00758"></a>00758 
<a name="l00759"></a>00759             <a class="code" href="Sound_01Control_8cpp.html#6b140a8e4fcf89b7740c037ff12580a7">PlayJA2Sample</a>( <a class="code" href="Sound_01Control_8h.html#946995a6d03371486c23b23d9ca362b5abe9bfc15d44271d7bf236b81d5218b9">ENDTURN_1</a>, RATE_11025, MIDVOLUME, 1, MIDDLEPAN );
<a name="l00760"></a>00760 
<a name="l00761"></a>00761             <span class="comment">// report any close call quotes for us here</span>
<a name="l00762"></a>00762             <span class="keywordflow">for</span> ( iCounter = <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#2ecddfe580bb019bc92cc4859eaf3edc">Team</a>[ <a class="code" href="Campaign_8cpp.html#47b2067ff75193e24776eda5297400ff">gbPlayerNum</a> ].bFirstID; iCounter &lt;= <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#2ecddfe580bb019bc92cc4859eaf3edc">Team</a>[ <a class="code" href="Campaign_8cpp.html#47b2067ff75193e24776eda5297400ff">gbPlayerNum</a> ].bLastID; iCounter++ )
<a name="l00763"></a>00763             {
<a name="l00764"></a>00764                   <span class="keywordflow">if</span> ( OK_INSECTOR_MERC( <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ iCounter ] ) )
<a name="l00765"></a>00765                   {
<a name="l00766"></a>00766                         <span class="keywordflow">if</span> ( <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ iCounter ]-&gt;fCloseCall )
<a name="l00767"></a>00767                         {
<a name="l00768"></a>00768                               <span class="keywordflow">if</span> ( <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ iCounter ]-&gt;bNumHitsThisTurn == 0 &amp;&amp; !(<a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ iCounter ]-&gt;usQuoteSaidExtFlags &amp; SOLDIER_QUOTE_SAID_EXT_CLOSE_CALL) &amp;&amp; <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 3 ) == 0 )
<a name="l00769"></a>00769                               {
<a name="l00770"></a>00770                                     <span class="comment">// say close call quote!</span>
<a name="l00771"></a>00771                                     <a class="code" href="Dialogue_01Control_8cpp.html#78d57daff1e69f02d5d83bd74d30e520">TacticalCharacterDialogue</a>( <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ iCounter ], <a class="code" href="Dialogue_01Control_8h.html#db9a2c9e383607c8609a364ff1521a29ec56245cb043c59dbcaa9a91b68d76d9">QUOTE_CLOSE_CALL</a> );
<a name="l00772"></a>00772                                     <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ iCounter ]-&gt;<a class="code" href="structSOLDIERTYPE.html#7e63debe882783fb2cb8641f3b3e8214">usQuoteSaidExtFlags</a> |= SOLDIER_QUOTE_SAID_EXT_CLOSE_CALL;
<a name="l00773"></a>00773                               }
<a name="l00774"></a>00774                               <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ iCounter ]-&gt;<a class="code" href="structSOLDIERTYPE.html#f42230b2347185f74e37b268f4cc8012">fCloseCall</a> = FALSE;
<a name="l00775"></a>00775                         }
<a name="l00776"></a>00776                   }
<a name="l00777"></a>00777             }
<a name="l00778"></a>00778 
<a name="l00779"></a>00779       }
<a name="l00780"></a>00780       <span class="keywordflow">else</span>
<a name="l00781"></a>00781       {
<a name="l00782"></a>00782             <span class="comment">// start interrupts for everyone on that side at once... and start AI with the lowest # guy</span>
<a name="l00783"></a>00783 
<a name="l00784"></a>00784             <span class="comment">// what we do is set everyone to moved except for people with interrupts at the moment</span>
<a name="l00785"></a>00785             <span class="comment">/*</span>
<a name="l00786"></a>00786 <span class="comment">            cnt = gTacticalStatus.Team[ pSoldier-&gt;bTeam ].bFirstID;</span>
<a name="l00787"></a>00787 <span class="comment">            for ( pTempSoldier = MercPtrs[ cnt ]; cnt &lt;= gTacticalStatus.Team[ pSoldier-&gt;bTeam ].bLastID; cnt++,pTempSoldier++)</span>
<a name="l00788"></a>00788 <span class="comment">            {</span>
<a name="l00789"></a>00789 <span class="comment">                  if ( pTempSoldier-&gt;bActive )</span>
<a name="l00790"></a>00790 <span class="comment">                  {</span>
<a name="l00791"></a>00791 <span class="comment">                        pTempSoldier-&gt;bMovedPriorToInterrupt = pTempSoldier-&gt;bMoved;</span>
<a name="l00792"></a>00792 <span class="comment">                        pTempSoldier-&gt;bMoved = TRUE;</span>
<a name="l00793"></a>00793 <span class="comment">                  }</span>
<a name="l00794"></a>00794 <span class="comment">            }</span>
<a name="l00795"></a>00795 <span class="comment">            */</span>
<a name="l00796"></a>00796 
<a name="l00797"></a>00797             <span class="keywordflow">while</span>( 1 )
<a name="l00798"></a>00798             {
<a name="l00799"></a>00799 
<a name="l00800"></a>00800                   <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ubInterrupter]-&gt;<a class="code" href="structSOLDIERTYPE.html#3f58b0f6efbd23c543ea12258a2f9ef3">bMoved</a> = FALSE;
<a name="l00801"></a>00801 
<a name="l00802"></a>00802                   DebugMsg( TOPIC_JA2, DBG_LEVEL_3, <a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>(<span class="stringliteral">"INTERRUPT: popping %d off of the interrupt queue"</span>, ubInterrupter ) );
<a name="l00803"></a>00803 
<a name="l00804"></a>00804                   REMOVE_LATEST_INTERRUPT_GUY();
<a name="l00805"></a>00805                   <span class="comment">// now LATEST_INTERRUPT_GUY is the guy before the previous</span>
<a name="l00806"></a>00806                   ubInterrupter = LATEST_INTERRUPT_GUY;
<a name="l00807"></a>00807                   <span class="keywordflow">if</span> (ubInterrupter == NOBODY) <span class="comment">// previously emptied slot!</span>
<a name="l00808"></a>00808                   {
<a name="l00809"></a>00809                         <span class="keywordflow">continue</span>;
<a name="l00810"></a>00810                   }
<a name="l00811"></a>00811                   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ubInterrupter]-&gt;bTeam != bTeam)
<a name="l00812"></a>00812                   {
<a name="l00813"></a>00813                         <span class="keywordflow">break</span>;
<a name="l00814"></a>00814                   }
<a name="l00815"></a>00815                   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ubInterrupter &lt; ubFirstInterrupter)
<a name="l00816"></a>00816                   {
<a name="l00817"></a>00817                         ubFirstInterrupter = ubInterrupter;
<a name="l00818"></a>00818                   }
<a name="l00819"></a>00819             }
<a name="l00820"></a>00820 
<a name="l00821"></a>00821 
<a name="l00822"></a>00822             <span class="comment">// here we have to rebuilt the AI list!</span>
<a name="l00823"></a>00823             <a class="code" href="AIList_8cpp.html#affc398320dfd3067817cc95930c3f87">BuildAIListForTeam</a>( bTeam );
<a name="l00824"></a>00824 
<a name="l00825"></a>00825             <span class="comment">// set to the new first interrupter</span>
<a name="l00826"></a>00826             cnt = <a class="code" href="AIList_8cpp.html#3e00e7c335cc3bf9c339fe250eae28cd">RemoveFirstAIListEntry</a>();
<a name="l00827"></a>00827 
<a name="l00828"></a>00828             <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> = <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ cnt ];
<a name="l00829"></a>00829 <span class="comment">//          pSoldier = MercPtrs[ubFirstInterrupter];</span>
<a name="l00830"></a>00830 
<a name="l00831"></a>00831             <span class="comment">//if ( gTacticalStatus.ubCurrentTeam == OUR_TEAM)</span>
<a name="l00832"></a>00832             <span class="keywordflow">if</span> ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#74a40a8aaf3efe840cdaf6be62556d82">bTeam</a> != OUR_TEAM )
<a name="l00833"></a>00833             {
<a name="l00834"></a>00834                   <span class="comment">// we're being interrupted by the computer!</span>
<a name="l00835"></a>00835                   <span class="comment">// we delay displaying any interrupt message until the computer</span>
<a name="l00836"></a>00836                   <span class="comment">// does something...</span>
<a name="l00837"></a>00837                   <a class="code" href="TeamTurns_8cpp.html#782955f80e251720a735649d4e8a5987">gfHiddenInterrupt</a> = TRUE;
<a name="l00838"></a>00838                   <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#b7a722b9cec25307fa87185497655ebd">fUnLockUIAfterHiddenInterrupt</a> = FALSE;
<a name="l00839"></a>00839             }
<a name="l00840"></a>00840             <span class="comment">// otherwise it's the AI interrupting another AI team</span>
<a name="l00841"></a>00841 
<a name="l00842"></a>00842             <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#d4322ac2c70a18b5aa84c2041e08c9b1">ubCurrentTeam</a>  = <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#74a40a8aaf3efe840cdaf6be62556d82">bTeam</a>;
<a name="l00843"></a>00843             
<a name="l00844"></a>00844 <span class="preprocessor">            #ifdef JA2BETAVERSION</span>
<a name="l00845"></a>00845 <span class="preprocessor"></span>                  <a class="code" href="message_8cpp.html#818e47bc59bd5a5755f06ec51cd74928">ScreenMsg</a>( FONT_MCOLOR_LTYELLOW, MSG_TESTVERSION, L<span class="stringliteral">"Interrupt ( could be hidden )"</span> );
<a name="l00846"></a>00846 <span class="preprocessor">            #endif</span>
<a name="l00847"></a>00847 <span class="preprocessor"></span>
<a name="l00848"></a>00848             <a class="code" href="ai_8h.html#6354d7a432959d5262c2d8ea5cde06c4">StartNPCAI</a>( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> );
<a name="l00849"></a>00849       }
<a name="l00850"></a>00850 
<a name="l00851"></a>00851       <span class="keywordflow">if</span> ( !<a class="code" href="TeamTurns_8cpp.html#782955f80e251720a735649d4e8a5987">gfHiddenInterrupt</a> )
<a name="l00852"></a>00852       {
<a name="l00853"></a>00853             <span class="comment">// Stop this guy....</span>
<a name="l00854"></a>00854             <a class="code" href="Soldier_01Control_8cpp.html#11fd19e17adc39731d2b3688a028a833">AdjustNoAPToFinishMove</a>( <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ LATEST_INTERRUPT_GUY ], TRUE ); 
<a name="l00855"></a>00855             <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ LATEST_INTERRUPT_GUY ]-&gt;<a class="code" href="structSOLDIERTYPE.html#3a52d1286affb8bb63c00d01e805267c">fTurningFromPronePosition</a> = FALSE;
<a name="l00856"></a>00856       }
<a name="l00857"></a>00857             DebugMsg (TOPIC_JA2,DBG_LEVEL_3,<span class="stringliteral">"StartInterrupt done"</span>);
<a name="l00858"></a>00858 
<a name="l00859"></a>00859 }
<a name="l00860"></a>00860 
<a name="l00861"></a><a class="code" href="TeamTurns_8cpp.html#a41b1e4ef95bdf5732f5e41fa257864b">00861</a> <span class="keywordtype">void</span> <a class="code" href="TeamTurns_8cpp.html#a41b1e4ef95bdf5732f5e41fa257864b">EndInterrupt</a>( <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fMarkInterruptOccurred )
<a name="l00862"></a>00862 {
<a name="l00863"></a>00863       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>                               ubInterruptedSoldier;
<a name="l00864"></a>00864       <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *           <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>;
<a name="l00865"></a>00865       <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *           <a class="code" href="EditorMercs_8cpp.html#93f0d7aeeac23b3a7528643fca0d2012">pTempSoldier</a>;
<a name="l00866"></a>00866       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>                               cnt;
<a name="l00867"></a>00867       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a>                             fFound;
<a name="l00868"></a>00868       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>                               ubMinAPsToAttack;
<a name="l00869"></a>00869 
<a name="l00870"></a>00870       DebugMsg (TOPIC_JA2,DBG_LEVEL_3,<span class="stringliteral">"EndInterrupt"</span>);
<a name="l00871"></a>00871 
<a name="l00872"></a>00872       <span class="keywordflow">for</span> ( cnt = <a class="code" href="TeamTurns_8cpp.html#bba49c23835b863c536a9796e4461183">gubOutOfTurnPersons</a>; cnt &gt; 0; cnt-- )
<a name="l00873"></a>00873       {
<a name="l00874"></a>00874             DebugMsg( TOPIC_JA2, DBG_LEVEL_3, <a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>(<span class="stringliteral">"ENDINT:  Q position %d: %d"</span>, cnt, <a class="code" href="TeamTurns_8cpp.html#8f8bdbac1eb4174dfb142fd50f762004">gubOutOfTurnOrder</a>[ cnt ] ) );
<a name="l00875"></a>00875       }
<a name="l00876"></a>00876 
<a name="l00877"></a>00877       <span class="comment">// ATE: OK, now if this all happended on one frame, we may not have to stop</span>
<a name="l00878"></a>00878       <span class="comment">// guy from walking... so set this flag to false if so...</span>
<a name="l00879"></a>00879       <span class="keywordflow">if</span> ( fMarkInterruptOccurred )
<a name="l00880"></a>00880       {
<a name="l00881"></a>00881             <span class="comment">// flag as true if an int occurs which ends an interrupt (int loop)</span>
<a name="l00882"></a>00882             <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#1548ced3c6d159efdbd02efbc1aaf4c6">fInterruptOccurred</a> = TRUE;
<a name="l00883"></a>00883       }
<a name="l00884"></a>00884       <span class="keywordflow">else</span>
<a name="l00885"></a>00885       {
<a name="l00886"></a>00886             <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#1548ced3c6d159efdbd02efbc1aaf4c6">fInterruptOccurred</a> = FALSE;
<a name="l00887"></a>00887       }
<a name="l00888"></a>00888 
<a name="l00889"></a>00889       <span class="comment">// Loop through all mercs and see if any passed on this interrupt</span>
<a name="l00890"></a>00890       cnt = <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#2ecddfe580bb019bc92cc4859eaf3edc">Team</a>[ <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#d4322ac2c70a18b5aa84c2041e08c9b1">ubCurrentTeam</a> ].<a class="code" href="structTacticalTeamType.html#f8fe819ad07b242f5dbf97fd4c69b00d">bFirstID</a>;
<a name="l00891"></a>00891       <span class="keywordflow">for</span> ( <a class="code" href="EditorMercs_8cpp.html#93f0d7aeeac23b3a7528643fca0d2012">pTempSoldier</a> = <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ cnt ]; cnt &lt;= <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#2ecddfe580bb019bc92cc4859eaf3edc">Team</a>[ <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#d4322ac2c70a18b5aa84c2041e08c9b1">ubCurrentTeam</a> ].<a class="code" href="structTacticalTeamType.html#6a887279dad735dc302f21c1e559d5ce">bLastID</a>; cnt++,<a class="code" href="EditorMercs_8cpp.html#93f0d7aeeac23b3a7528643fca0d2012">pTempSoldier</a>++)
<a name="l00892"></a>00892       {
<a name="l00893"></a>00893             <span class="keywordflow">if</span> ( <a class="code" href="EditorMercs_8cpp.html#93f0d7aeeac23b3a7528643fca0d2012">pTempSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#653dad4e2520784e293eca9f948b8532">bActive</a> &amp;&amp; <a class="code" href="EditorMercs_8cpp.html#93f0d7aeeac23b3a7528643fca0d2012">pTempSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#b0096f321a0de4f0617283f7b3212aa0">bInSector</a> &amp;&amp; !<a class="code" href="EditorMercs_8cpp.html#93f0d7aeeac23b3a7528643fca0d2012">pTempSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#3f58b0f6efbd23c543ea12258a2f9ef3">bMoved</a> &amp;&amp; (<a class="code" href="EditorMercs_8cpp.html#93f0d7aeeac23b3a7528643fca0d2012">pTempSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#080980e5fe705dcea5c819b05aef6f21">bActionPoints</a> == <a class="code" href="EditorMercs_8cpp.html#93f0d7aeeac23b3a7528643fca0d2012">pTempSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#4e5e7dac2b77d4437e75c319a20f0872">bIntStartAPs</a>))
<a name="l00894"></a>00894             {
<a name="l00895"></a>00895                   ubMinAPsToAttack = <a class="code" href="Points_8cpp.html#84f116b33524232723bfa74949877c21">MinAPsToAttack</a>( <a class="code" href="EditorMercs_8cpp.html#93f0d7aeeac23b3a7528643fca0d2012">pTempSoldier</a>, <a class="code" href="EditorMercs_8cpp.html#93f0d7aeeac23b3a7528643fca0d2012">pTempSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#cd62bec1ef14927e4fb8ef7540273beb">sLastTarget</a>, FALSE );
<a name="l00896"></a>00896                   <a class="code" href="Soldier_01Ani_8cpp.html#c294aa65f0375eb6343a2de2a25dafcc">if</a> ( (ubMinAPsToAttack &lt;= pTempSoldier-&gt;bActionPoints) &amp;&amp; (ubMinAPsToAttack &gt; 0) )
<a name="l00897"></a>00897                   {
<a name="l00898"></a>00898                         <a class="code" href="EditorMercs_8cpp.html#93f0d7aeeac23b3a7528643fca0d2012">pTempSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#1d499631188ba2009800a8fac6241e3a">bPassedLastInterrupt</a> = TRUE;
<a name="l00899"></a>00899                   }
<a name="l00900"></a>00900             }
<a name="l00901"></a>00901       }
<a name="l00902"></a>00902 
<a name="l00903"></a>00903       <span class="keywordflow">if</span> ( !<a class="code" href="TeamTurns_8cpp.html#624e3dd003e482573366a5527d11aa84">EveryoneInInterruptListOnSameTeam</a>() )
<a name="l00904"></a>00904       {
<a name="l00905"></a>00905             <a class="code" href="TeamTurns_8cpp.html#782955f80e251720a735649d4e8a5987">gfHiddenInterrupt</a> = FALSE;
<a name="l00906"></a>00906 
<a name="l00907"></a>00907             <span class="comment">// resume interrupted interrupt</span>
<a name="l00908"></a>00908             <a class="code" href="TeamTurns_8cpp.html#23696bb3b808ce3a04abab4deb7f2ce7">StartInterrupt</a>();
<a name="l00909"></a>00909       }
<a name="l00910"></a>00910       <span class="keywordflow">else</span>
<a name="l00911"></a>00911       {
<a name="l00912"></a>00912             ubInterruptedSoldier = LATEST_INTERRUPT_GUY;
<a name="l00913"></a>00913 
<a name="l00914"></a>00914             DebugMsg( TOPIC_JA2, DBG_LEVEL_3, <a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>(<span class="stringliteral">"INTERRUPT: interrupt over, %d's team regains control"</span>, ubInterruptedSoldier ) );
<a name="l00915"></a>00915 
<a name="l00916"></a>00916             <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> = <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ubInterruptedSoldier];
<a name="l00917"></a>00917 
<a name="l00918"></a>00918             cnt = 0;
<a name="l00919"></a>00919             <span class="keywordflow">for</span> ( <a class="code" href="EditorMercs_8cpp.html#93f0d7aeeac23b3a7528643fca0d2012">pTempSoldier</a> = <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ cnt ]; cnt &lt;= MAX_NUM_SOLDIERS; cnt++,<a class="code" href="EditorMercs_8cpp.html#93f0d7aeeac23b3a7528643fca0d2012">pTempSoldier</a>++)
<a name="l00920"></a>00920             {
<a name="l00921"></a>00921                   <span class="keywordflow">if</span> ( <a class="code" href="EditorMercs_8cpp.html#93f0d7aeeac23b3a7528643fca0d2012">pTempSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#653dad4e2520784e293eca9f948b8532">bActive</a> )
<a name="l00922"></a>00922                   {
<a name="l00923"></a>00923                         <span class="comment">// AI guys only here...</span>
<a name="l00924"></a>00924                         <a class="code" href="Soldier_01Ani_8cpp.html#c294aa65f0375eb6343a2de2a25dafcc">if</a> ( <a class="code" href="EditorMercs_8cpp.html#93f0d7aeeac23b3a7528643fca0d2012">pTempSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#080980e5fe705dcea5c819b05aef6f21">bActionPoints</a> == 0 )
<a name="l00925"></a>00925                         {
<a name="l00926"></a>00926                               <a class="code" href="EditorMercs_8cpp.html#93f0d7aeeac23b3a7528643fca0d2012">pTempSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#3f58b0f6efbd23c543ea12258a2f9ef3">bMoved</a> = TRUE;
<a name="l00927"></a>00927                         }
<a name="l00928"></a>00928                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="EditorMercs_8cpp.html#93f0d7aeeac23b3a7528643fca0d2012">pTempSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#74a40a8aaf3efe840cdaf6be62556d82">bTeam</a> != <a class="code" href="Campaign_8cpp.html#47b2067ff75193e24776eda5297400ff">gbPlayerNum</a> &amp;&amp; <a class="code" href="EditorMercs_8cpp.html#93f0d7aeeac23b3a7528643fca0d2012">pTempSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#1897f6330181ea58e948eaa23a5fd75c">bNewSituation</a> == IS_NEW_SITUATION )
<a name="l00929"></a>00929                         {
<a name="l00930"></a>00930                               <a class="code" href="EditorMercs_8cpp.html#93f0d7aeeac23b3a7528643fca0d2012">pTempSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#3f58b0f6efbd23c543ea12258a2f9ef3">bMoved</a> = FALSE;
<a name="l00931"></a>00931                         }
<a name="l00932"></a>00932                         <span class="keywordflow">else</span>
<a name="l00933"></a>00933                         {
<a name="l00934"></a>00934                               <a class="code" href="EditorMercs_8cpp.html#93f0d7aeeac23b3a7528643fca0d2012">pTempSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#3f58b0f6efbd23c543ea12258a2f9ef3">bMoved</a> = <a class="code" href="EditorMercs_8cpp.html#93f0d7aeeac23b3a7528643fca0d2012">pTempSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#f7e1b2c79ee994f4be61f6c62e53b0a2">bMovedPriorToInterrupt</a>;
<a name="l00935"></a>00935                         }                        
<a name="l00936"></a>00936                   }
<a name="l00937"></a>00937             }
<a name="l00938"></a>00938 
<a name="l00939"></a>00939 
<a name="l00940"></a>00940             <span class="comment">// change team</span>
<a name="l00941"></a>00941             <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#d4322ac2c70a18b5aa84c2041e08c9b1">ubCurrentTeam</a>  = <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#74a40a8aaf3efe840cdaf6be62556d82">bTeam</a>;
<a name="l00942"></a>00942             <span class="comment">// switch appropriate messages &amp; flags</span>
<a name="l00943"></a>00943             <span class="keywordflow">if</span> ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#74a40a8aaf3efe840cdaf6be62556d82">bTeam</a> == OUR_TEAM)
<a name="l00944"></a>00944             {
<a name="l00945"></a>00945                   <span class="comment">// set everyone on the team to however they were set moved before the interrupt</span>
<a name="l00946"></a>00946                   <span class="comment">// must do this before selecting soldier...</span>
<a name="l00947"></a>00947                   <span class="comment">/*</span>
<a name="l00948"></a>00948 <span class="comment">                  cnt = gTacticalStatus.Team[ gTacticalStatus.ubCurrentTeam ].bFirstID;</span>
<a name="l00949"></a>00949 <span class="comment">                  for ( pTempSoldier = MercPtrs[ cnt ]; cnt &lt;= gTacticalStatus.Team[ gTacticalStatus.ubCurrentTeam ].bLastID; cnt++,pTempSoldier++)</span>
<a name="l00950"></a>00950 <span class="comment">                  {</span>
<a name="l00951"></a>00951 <span class="comment">                        if ( pTempSoldier-&gt;bActive )</span>
<a name="l00952"></a>00952 <span class="comment">                        {</span>
<a name="l00953"></a>00953 <span class="comment">                              pTempSoldier-&gt;bMoved = pTempSoldier-&gt;bMovedPriorToInterrupt;</span>
<a name="l00954"></a>00954 <span class="comment">                        }</span>
<a name="l00955"></a>00955 <span class="comment">                  }</span>
<a name="l00956"></a>00956 <span class="comment">                  */</span>
<a name="l00957"></a>00957 
<a name="l00958"></a>00958                   <a class="code" href="TeamTurns_8cpp.html#57c69a1ebef93252abc7051c1d9147aa">ClearIntList</a>();
<a name="l00959"></a>00959 
<a name="l00960"></a>00960                   <span class="comment">// Select soldier....</span>
<a name="l00961"></a>00961                   <span class="keywordflow">if</span> ( <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ ubInterruptedSoldier ]-&gt;bLife &lt; OKLIFE )
<a name="l00962"></a>00962                   {
<a name="l00963"></a>00963                         DebugMsg(TOPIC_JA2,DBG_LEVEL_3,<a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>(<span class="stringliteral">"EndInterrupt: SelectNextAvailSoldier"</span>));
<a name="l00964"></a>00964                         <a class="code" href="Overhead_8cpp.html#991bb5532d71ee52b0d32a94f407aec1">SelectNextAvailSoldier</a>( <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ ubInterruptedSoldier ] );
<a name="l00965"></a>00965                   }
<a name="l00966"></a>00966                   <span class="keywordflow">else</span>
<a name="l00967"></a>00967                   {
<a name="l00968"></a>00968                         <a class="code" href="Overhead_8cpp.html#9c8656f3f3153ede7b7d896e908864b7">SelectSoldier</a>( ubInterruptedSoldier, FALSE, FALSE );
<a name="l00969"></a>00969                   }
<a name="l00970"></a>00970 
<a name="l00971"></a>00971                   <span class="keywordflow">if</span> (<a class="code" href="TeamTurns_8cpp.html#782955f80e251720a735649d4e8a5987">gfHiddenInterrupt</a>)
<a name="l00972"></a>00972                   {
<a name="l00973"></a>00973                         <span class="comment">// Try to make things look like nothing happened at all.</span>
<a name="l00974"></a>00974                         <a class="code" href="TeamTurns_8cpp.html#782955f80e251720a735649d4e8a5987">gfHiddenInterrupt</a> = FALSE;
<a name="l00975"></a>00975 
<a name="l00976"></a>00976                         <span class="comment">// If we can continue a move, do so!</span>
<a name="l00977"></a>00977                         <span class="keywordflow">if</span> ( <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ <a class="code" href="Interface_01Utils_8cpp.html#07d83e717b98bc3cf6628f0bb9bc9205">gusSelectedSoldier</a> ]-&gt;fNoAPToFinishMove &amp;&amp; <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#bd249e3af996ca0cffb2fe1e62751f73">ubReasonCantFinishMove</a> != <a class="code" href="Soldier_01Control_8h.html#d2d3a7869c500e9ee6bfbdcc1cd8ff46712629497b6bf6c8b39f021aa3c797c0">REASON_STOPPED_SIGHT</a> )
<a name="l00978"></a>00978                         {
<a name="l00979"></a>00979                               <span class="comment">// Continue</span>
<a name="l00980"></a>00980                               <a class="code" href="Soldier_01Control_8cpp.html#11fd19e17adc39731d2b3688a028a833">AdjustNoAPToFinishMove</a>( <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ <a class="code" href="Interface_01Utils_8cpp.html#07d83e717b98bc3cf6628f0bb9bc9205">gusSelectedSoldier</a> ], FALSE );
<a name="l00981"></a>00981 
<a name="l00982"></a>00982                               <span class="keywordflow">if</span> ( <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ <a class="code" href="Interface_01Utils_8cpp.html#07d83e717b98bc3cf6628f0bb9bc9205">gusSelectedSoldier</a> ]-&gt;sGridNo != <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ <a class="code" href="Interface_01Utils_8cpp.html#07d83e717b98bc3cf6628f0bb9bc9205">gusSelectedSoldier</a> ]-&gt;sFinalDestination )
<a name="l00983"></a>00983                               {
<a name="l00984"></a>00984                                     <a class="code" href="Soldier_01Control_8cpp.html#b05ad69d15646823d9464ad2285fc865">EVENT_GetNewSoldierPath</a>( <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ <a class="code" href="Interface_01Utils_8cpp.html#07d83e717b98bc3cf6628f0bb9bc9205">gusSelectedSoldier</a> ], <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ gusSelectedSoldier ]-&gt;sFinalDestination, <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ gusSelectedSoldier ]-&gt;usUIMovementMode );
<a name="l00985"></a>00985                               }
<a name="l00986"></a>00986                               <span class="keywordflow">else</span>
<a name="l00987"></a>00987                               {
<a name="l00988"></a>00988                                     <a class="code" href="Handle_01UI_8cpp.html#3ca9f7e43b153367710a1bee6c71d7bc">UnSetUIBusy</a>( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#18aef170576da81b10d00e7b6cd3627b">ubID</a> );
<a name="l00989"></a>00989                               }
<a name="l00990"></a>00990                         }
<a name="l00991"></a>00991                         <span class="keywordflow">else</span>
<a name="l00992"></a>00992                         {
<a name="l00993"></a>00993                               <a class="code" href="Handle_01UI_8cpp.html#3ca9f7e43b153367710a1bee6c71d7bc">UnSetUIBusy</a>( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#18aef170576da81b10d00e7b6cd3627b">ubID</a> );
<a name="l00994"></a>00994                         }
<a name="l00995"></a>00995 
<a name="l00996"></a>00996                         <span class="keywordflow">if</span> ( <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#b7a722b9cec25307fa87185497655ebd">fUnLockUIAfterHiddenInterrupt</a> )
<a name="l00997"></a>00997                         {
<a name="l00998"></a>00998                               <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#b7a722b9cec25307fa87185497655ebd">fUnLockUIAfterHiddenInterrupt</a> = FALSE;
<a name="l00999"></a>00999                               <a class="code" href="Handle_01UI_8cpp.html#3ca9f7e43b153367710a1bee6c71d7bc">UnSetUIBusy</a>( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#18aef170576da81b10d00e7b6cd3627b">ubID</a> );
<a name="l01000"></a>01000                         }
<a name="l01001"></a>01001                   }
<a name="l01002"></a>01002                   <span class="keywordflow">else</span>
<a name="l01003"></a>01003                   {
<a name="l01004"></a>01004                         <span class="comment">// Signal UI done enemy's turn</span><span class="comment"></span>
<a name="l01005"></a>01005 <span class="comment">                        /// ATE: This used to be ablow so it would get done for</span>
<a name="l01006"></a>01006 <span class="comment"></span>                        <span class="comment">// both hidden interrupts as well - NOT good because</span>
<a name="l01007"></a>01007                         <span class="comment">// hidden interrupts should leave it locked if it was already...</span>
<a name="l01008"></a>01008                         <a class="code" href="Handle_01UI_8cpp.html#c1a811228f6db879e9c1d67b68651a1b">guiPendingOverrideEvent</a> = <a class="code" href="Handle_01UI_8h.html#af14d9a15c91cd740ff202b6335e405ecdd777bfca71920c86e66ee609316ceb">LU_ENDUILOCK</a>;
<a name="l01009"></a>01009                         <a class="code" href="Handle_01UI_8cpp.html#2633147d0d1a1bafac01733902d66452">HandleTacticalUI</a>( );
<a name="l01010"></a>01010 
<a name="l01011"></a>01011                         <span class="keywordflow">if</span> ( <a class="code" href="Interface_01Utils_8cpp.html#07d83e717b98bc3cf6628f0bb9bc9205">gusSelectedSoldier</a> != NO_SOLDIER )
<a name="l01012"></a>01012                         {
<a name="l01013"></a>01013                               <a class="code" href="Overhead_8cpp.html#d449ca43df0cc8426ed73cf5eedca433">SlideTo</a>( NOWHERE, <a class="code" href="Interface_01Utils_8cpp.html#07d83e717b98bc3cf6628f0bb9bc9205">gusSelectedSoldier</a>, NOBODY ,SETLOCATOR);
<a name="l01014"></a>01014 
<a name="l01015"></a>01015                               <span class="comment">// Say ATTENTION SOUND...</span>
<a name="l01016"></a>01016                               <a class="code" href="Soldier_01Control_8cpp.html#62effc98ffa51ddb2fc78301c82acdb8">DoMercBattleSound</a>( <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ <a class="code" href="Interface_01Utils_8cpp.html#07d83e717b98bc3cf6628f0bb9bc9205">gusSelectedSoldier</a> ], <a class="code" href="Soldier_01Control_8h.html#3ab071cf265666f49f6e3f6639d69f0a3db87554c96021371ea027e7d90bea26">BATTLE_SOUND_ATTN1</a> );
<a name="l01017"></a>01017 
<a name="l01018"></a>01018                               <span class="keywordflow">if</span> ( <a class="code" href="Interface_8cpp.html#df8b6e6a517d072540efbabfca5ac189">gsInterfaceLevel</a> == 1 )
<a name="l01019"></a>01019                               {
<a name="l01020"></a>01020                                     <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#89eb954f99ad4f28b84d7cf675c8ed32">uiFlags</a> |= SHOW_ALL_ROOFS;
<a name="l01021"></a>01021                                     <a class="code" href="renderworld_8cpp.html#1e1ddb2858063ee68614cd6c221369bb">InvalidateWorldRedundency</a>( );
<a name="l01022"></a>01022                                     <a class="code" href="renderworld_8cpp.html#986f210b1a26336aa2943bdce24ffb94">SetRenderFlags</a>(RENDER_FLAG_FULL);
<a name="l01023"></a>01023                                     <a class="code" href="PATHAI_8cpp.html#33cf219cddf5174a2c1701521a51f38b">ErasePath</a>(FALSE);
<a name="l01024"></a>01024                               }
<a name="l01025"></a>01025                         }
<a name="l01026"></a>01026                         <span class="comment">// 2 indicates that we're ending an interrupt and going back to</span>
<a name="l01027"></a>01027                         <span class="comment">// normal player's turn without readjusting time left in turn (for</span>
<a name="l01028"></a>01028                         <span class="comment">// timed turns)</span>
<a name="l01029"></a>01029                         <a class="code" href="Interface_8cpp.html#e1d00e8e7f6f650538adc7f8357a7f78">InitPlayerUIBar</a>( 2 );
<a name="l01030"></a>01030                   }
<a name="l01031"></a>01031 
<a name="l01032"></a>01032             }
<a name="l01033"></a>01033             <span class="keywordflow">else</span>
<a name="l01034"></a>01034             {
<a name="l01035"></a>01035                   <span class="comment">// this could be set to true for AI-vs-AI interrupts</span>
<a name="l01036"></a>01036                   <a class="code" href="TeamTurns_8cpp.html#782955f80e251720a735649d4e8a5987">gfHiddenInterrupt</a> = FALSE;
<a name="l01037"></a>01037 
<a name="l01038"></a>01038                   <span class="comment">// Dirty panel interface!</span>
<a name="l01039"></a>01039                   <a class="code" href="Interface_8cpp.html#310e02e85df33f7794f5c4c11ae1844d">fInterfacePanelDirty</a> = DIRTYLEVEL2;
<a name="l01040"></a>01040 
<a name="l01041"></a>01041                   <span class="comment">// Erase path!</span>
<a name="l01042"></a>01042                   <a class="code" href="PATHAI_8cpp.html#33cf219cddf5174a2c1701521a51f38b">ErasePath</a>( TRUE );
<a name="l01043"></a>01043 
<a name="l01044"></a>01044                   <span class="comment">// Reset flags</span>
<a name="l01045"></a>01045                   <a class="code" href="Handle_01UI_8cpp.html#5a5e679474e784af12194877e4003ba4">gfPlotNewMovement</a> = TRUE;
<a name="l01046"></a>01046             
<a name="l01047"></a>01047                   <span class="comment">// restart AI with first available soldier</span>
<a name="l01048"></a>01048                   fFound = FALSE;         
<a name="l01049"></a>01049 
<a name="l01050"></a>01050                   <span class="comment">// rebuild list for this team if anyone on the team is still available</span>
<a name="l01051"></a>01051                   cnt = <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#2ecddfe580bb019bc92cc4859eaf3edc">Team</a>[ ENEMY_TEAM ].<a class="code" href="structTacticalTeamType.html#f8fe819ad07b242f5dbf97fd4c69b00d">bFirstID</a>;
<a name="l01052"></a>01052                   <span class="keywordflow">for</span> ( <a class="code" href="EditorMercs_8cpp.html#93f0d7aeeac23b3a7528643fca0d2012">pTempSoldier</a> = <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ cnt ]; cnt &lt;= <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#2ecddfe580bb019bc92cc4859eaf3edc">Team</a>[ <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#d4322ac2c70a18b5aa84c2041e08c9b1">ubCurrentTeam</a> ].<a class="code" href="structTacticalTeamType.html#6a887279dad735dc302f21c1e559d5ce">bLastID</a>; cnt++,<a class="code" href="EditorMercs_8cpp.html#93f0d7aeeac23b3a7528643fca0d2012">pTempSoldier</a>++)
<a name="l01053"></a>01053                   {     
<a name="l01054"></a>01054                         <span class="keywordflow">if</span> ( <a class="code" href="EditorMercs_8cpp.html#93f0d7aeeac23b3a7528643fca0d2012">pTempSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#653dad4e2520784e293eca9f948b8532">bActive</a> &amp;&amp; <a class="code" href="EditorMercs_8cpp.html#93f0d7aeeac23b3a7528643fca0d2012">pTempSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#b0096f321a0de4f0617283f7b3212aa0">bInSector</a> &amp;&amp; <a class="code" href="EditorMercs_8cpp.html#93f0d7aeeac23b3a7528643fca0d2012">pTempSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#e308dea18533bf5ab2bcee5bbe27391c">bLife</a> &gt;= OKLIFE )
<a name="l01055"></a>01055                         {
<a name="l01056"></a>01056                               fFound = TRUE;
<a name="l01057"></a>01057                               <span class="keywordflow">break</span>;
<a name="l01058"></a>01058                         }
<a name="l01059"></a>01059                   }
<a name="l01060"></a>01060 
<a name="l01061"></a>01061                   <span class="keywordflow">if</span> ( fFound )
<a name="l01062"></a>01062                   {
<a name="l01063"></a>01063                         <span class="comment">// reset found flag because we are rebuilding the AI list</span>
<a name="l01064"></a>01064                         fFound = FALSE;
<a name="l01065"></a>01065 
<a name="l01066"></a>01066                         <span class="keywordflow">if</span> ( <a class="code" href="AIList_8cpp.html#affc398320dfd3067817cc95930c3f87">BuildAIListForTeam</a>( <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#d4322ac2c70a18b5aa84c2041e08c9b1">ubCurrentTeam</a> ) )
<a name="l01067"></a>01067                         {
<a name="l01068"></a>01068                               <span class="comment">// now bubble up everyone left in the interrupt queue, starting</span>
<a name="l01069"></a>01069                               <span class="comment">// at the front of the array</span>
<a name="l01070"></a>01070                               for (cnt = 1; cnt &lt;= <a class="code" href="TeamTurns_8cpp.html#bba49c23835b863c536a9796e4461183">gubOutOfTurnPersons</a>; cnt++)
<a name="l01071"></a>01071                               {
<a name="l01072"></a>01072                                     <a class="code" href="AIList_8cpp.html#a2edd156243362ef9f144b14962426ad">MoveToFrontOfAIList</a>( <a class="code" href="TeamTurns_8cpp.html#8f8bdbac1eb4174dfb142fd50f762004">gubOutOfTurnOrder</a>[ cnt ] );
<a name="l01073"></a>01073                               }
<a name="l01074"></a>01074 
<a name="l01075"></a>01075                               cnt = <a class="code" href="AIList_8cpp.html#3e00e7c335cc3bf9c339fe250eae28cd">RemoveFirstAIListEntry</a>();
<a name="l01076"></a>01076                               <span class="keywordflow">if</span> (cnt != NOBODY)
<a name="l01077"></a>01077                               {
<a name="l01078"></a>01078                                     fFound = TRUE;
<a name="l01079"></a>01079                                     <a class="code" href="ai_8h.html#6354d7a432959d5262c2d8ea5cde06c4">StartNPCAI</a>( <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ cnt ] );                  
<a name="l01080"></a>01080                               }
<a name="l01081"></a>01081                         }
<a name="l01082"></a>01082 
<a name="l01083"></a>01083                   }
<a name="l01084"></a>01084 
<a name="l01085"></a>01085                   <span class="keywordflow">if</span> (fFound)
<a name="l01086"></a>01086                   {
<a name="l01087"></a>01087                         <span class="comment">// back to the computer!</span>
<a name="l01088"></a>01088                         <span class="keywordflow">if</span> ( <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#d4322ac2c70a18b5aa84c2041e08c9b1">ubCurrentTeam</a> == CREATURE_TEAM &amp;&amp; <a class="code" href="TeamTurns_8cpp.html#1bb9178e0898254541bdfab29a20d496">BloodcatsPresent</a>() )
<a name="l01089"></a>01089                         {
<a name="l01090"></a>01090                               <a class="code" href="Interface_8cpp.html#0412325f96b29f8c8f39745c57758c39">AddTopMessage</a>( <a class="code" href="Interface_8h.html#65fe2c17232dbf1dd879382defeb6b63b7ef28213b1bd3a0a9ae60a1ed181c80">COMPUTER_TURN_MESSAGE</a>, <a class="code" href="__DutchText_8cpp.html#7813bcd58c4aa688254799c95ea7c6fa">Message</a>[ <a class="code" href="Text_8h.html#2bace310ffbaa508709e8fbb38af6ef34185e54870692483ed0620b6c73a7027">STR_BLOODCATS_TURN</a> ] );
<a name="l01091"></a>01091                         }
<a name="l01092"></a>01092                         <span class="keywordflow">else</span>
<a name="l01093"></a>01093                         {
<a name="l01094"></a>01094                               <a class="code" href="Interface_8cpp.html#0412325f96b29f8c8f39745c57758c39">AddTopMessage</a>( <a class="code" href="Interface_8h.html#65fe2c17232dbf1dd879382defeb6b63b7ef28213b1bd3a0a9ae60a1ed181c80">COMPUTER_TURN_MESSAGE</a>, <a class="code" href="__DutchText_8cpp.html#4f334b3c24b867bf77c338c130e8b1bc">TeamTurnString</a>[ <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#d4322ac2c70a18b5aa84c2041e08c9b1">ubCurrentTeam</a> ] );
<a name="l01095"></a>01095                         }
<a name="l01096"></a>01096 
<a name="l01097"></a>01097                         <span class="comment">// Signal UI done enemy's turn</span>
<a name="l01098"></a>01098                         <a class="code" href="Handle_01UI_8cpp.html#c1a811228f6db879e9c1d67b68651a1b">guiPendingOverrideEvent</a> = <a class="code" href="Handle_01UI_8h.html#af14d9a15c91cd740ff202b6335e405e9284e6f1f50ffc974b408c62555d8ba2">LU_BEGINUILOCK</a>;
<a name="l01099"></a>01099 
<a name="l01100"></a>01100                         <a class="code" href="TeamTurns_8cpp.html#57c69a1ebef93252abc7051c1d9147aa">ClearIntList</a>();
<a name="l01101"></a>01101                   }
<a name="l01102"></a>01102                   <span class="keywordflow">else</span>
<a name="l01103"></a>01103                   {
<a name="l01104"></a>01104                         <span class="comment">// back to the computer!</span>
<a name="l01105"></a>01105                         <span class="keywordflow">if</span> ( <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#d4322ac2c70a18b5aa84c2041e08c9b1">ubCurrentTeam</a> == CREATURE_TEAM &amp;&amp; <a class="code" href="TeamTurns_8cpp.html#1bb9178e0898254541bdfab29a20d496">BloodcatsPresent</a>() )
<a name="l01106"></a>01106                         {
<a name="l01107"></a>01107                               <a class="code" href="Interface_8cpp.html#0412325f96b29f8c8f39745c57758c39">AddTopMessage</a>( <a class="code" href="Interface_8h.html#65fe2c17232dbf1dd879382defeb6b63b7ef28213b1bd3a0a9ae60a1ed181c80">COMPUTER_TURN_MESSAGE</a>, <a class="code" href="__DutchText_8cpp.html#7813bcd58c4aa688254799c95ea7c6fa">Message</a>[ <a class="code" href="Text_8h.html#2bace310ffbaa508709e8fbb38af6ef34185e54870692483ed0620b6c73a7027">STR_BLOODCATS_TURN</a> ] );
<a name="l01108"></a>01108                         }
<a name="l01109"></a>01109                         <span class="keywordflow">else</span>
<a name="l01110"></a>01110                         {
<a name="l01111"></a>01111                               <a class="code" href="Interface_8cpp.html#0412325f96b29f8c8f39745c57758c39">AddTopMessage</a>( <a class="code" href="Interface_8h.html#65fe2c17232dbf1dd879382defeb6b63b7ef28213b1bd3a0a9ae60a1ed181c80">COMPUTER_TURN_MESSAGE</a>, <a class="code" href="__DutchText_8cpp.html#4f334b3c24b867bf77c338c130e8b1bc">TeamTurnString</a>[ <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#d4322ac2c70a18b5aa84c2041e08c9b1">ubCurrentTeam</a> ] );
<a name="l01112"></a>01112                         }
<a name="l01113"></a>01113 
<a name="l01114"></a>01114                         <span class="comment">// Signal UI done enemy's turn</span>
<a name="l01115"></a>01115                         <a class="code" href="Handle_01UI_8cpp.html#c1a811228f6db879e9c1d67b68651a1b">guiPendingOverrideEvent</a> = <a class="code" href="Handle_01UI_8h.html#af14d9a15c91cd740ff202b6335e405e9284e6f1f50ffc974b408c62555d8ba2">LU_BEGINUILOCK</a>;
<a name="l01116"></a>01116 
<a name="l01117"></a>01117                         <span class="comment">// must clear int list before ending turn</span>
<a name="l01118"></a>01118                         <a class="code" href="TeamTurns_8cpp.html#57c69a1ebef93252abc7051c1d9147aa">ClearIntList</a>();
<a name="l01119"></a>01119                         <a class="code" href="TeamTurns_8cpp.html#7c0aba67737ac957ec85869f31b1e898">EndAITurn</a>();
<a name="l01120"></a>01120                   }
<a name="l01121"></a>01121             }
<a name="l01122"></a>01122 
<a name="l01123"></a>01123             <span class="comment">// Reset our interface!</span>
<a name="l01124"></a>01124             <a class="code" href="Interface_8cpp.html#310e02e85df33f7794f5c4c11ae1844d">fInterfacePanelDirty</a> = DIRTYLEVEL2;
<a name="l01125"></a>01125 
<a name="l01126"></a>01126       }
<a name="l01127"></a>01127 }
<a name="l01128"></a>01128 
<a name="l01129"></a>01129 
<a name="l01130"></a><a class="code" href="TeamTurns_8h.html#f42832fb6fd19f55ba658bda268239e2">01130</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="TeamTurns_8cpp.html#f42832fb6fd19f55ba658bda268239e2">StandardInterruptConditionsMet</a>( <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> * <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubOpponentID, <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bOldOppList)
<a name="l01131"></a>01131 {
<a name="l01132"></a>01132       DebugMsg (TOPIC_JA2,DBG_LEVEL_3,<span class="stringliteral">"StandardInterruptConditionsMet"</span>);
<a name="l01133"></a>01133 <span class="comment">//    UINT8 ubAniType;</span>
<a name="l01134"></a>01134       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>                               ubMinPtsNeeded;
<a name="l01135"></a>01135       <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>                                bDir;
<a name="l01136"></a>01136       <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *           pOpponent;
<a name="l01137"></a>01137 
<a name="l01138"></a>01138       <span class="keywordflow">if</span> ( (<a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#89eb954f99ad4f28b84d7cf675c8ed32">uiFlags</a> &amp; TURNBASED) &amp;&amp; (<a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#89eb954f99ad4f28b84d7cf675c8ed32">uiFlags</a> &amp; INCOMBAT) &amp;&amp; !(<a class="code" href="opplist_8cpp.html#6f973cb4a656f717ac624b3a54de0042">gubSightFlags</a> &amp; SIGHT_INTERRUPT) )
<a name="l01139"></a>01139       {
<a name="l01140"></a>01140             <span class="keywordflow">return</span>( FALSE );
<a name="l01141"></a>01141       }
<a name="l01142"></a>01142 
<a name="l01143"></a>01143       <span class="keywordflow">if</span> ( <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#b44a086b36d7dd7af18e11f8fdea4d05">ubAttackBusyCount</a> &gt; 0 )
<a name="l01144"></a>01144       {
<a name="l01145"></a>01145             <span class="keywordflow">return</span>( FALSE );
<a name="l01146"></a>01146       }
<a name="l01147"></a>01147 
<a name="l01148"></a>01148       <span class="keywordflow">if</span> (ubOpponentID &lt; NOBODY)
<a name="l01149"></a>01149       {
<a name="l01150"></a>01150             <span class="comment">/*</span>
<a name="l01151"></a>01151 <span class="comment">            // only the OPPONENT'S controller's decision matters</span>
<a name="l01152"></a>01152 <span class="comment">            if (Menptr[ubOpponentID].controller != Net.pnum)</span>
<a name="l01153"></a>01153 <span class="comment">            {</span>
<a name="l01154"></a>01154 <span class="comment">                  return(FALSE);</span>
<a name="l01155"></a>01155 <span class="comment">            }</span>
<a name="l01156"></a>01156 <span class="comment">            */</span>
<a name="l01157"></a>01157 
<a name="l01158"></a>01158             <span class="comment">// ALEX</span>
<a name="l01159"></a>01159             <span class="comment">// if interrupts are restricted to a particular opponent only &amp; he's not it</span>
<a name="l01160"></a>01160             <span class="keywordflow">if</span> ((<a class="code" href="TeamTurns_8cpp.html#42bb4eb822afac8c2e18356981e457ce">InterruptOnlyGuynum</a> != NOBODY) &amp;&amp; (ubOpponentID != <a class="code" href="TeamTurns_8cpp.html#42bb4eb822afac8c2e18356981e457ce">InterruptOnlyGuynum</a>))
<a name="l01161"></a>01161             {
<a name="l01162"></a>01162                   <span class="keywordflow">return</span>(FALSE);
<a name="l01163"></a>01163             }
<a name="l01164"></a>01164 
<a name="l01165"></a>01165             pOpponent = <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ ubOpponentID ];
<a name="l01166"></a>01166       }
<a name="l01167"></a>01167       <span class="keywordflow">else</span>  <span class="comment">// no opponent, so controller of 'ptr' makes the call instead</span>
<a name="l01168"></a>01168       {
<a name="l01169"></a>01169             <span class="comment">// ALEX</span>
<a name="l01170"></a>01170             <span class="keywordflow">if</span> (<a class="code" href="opplist_8cpp.html#d6ad632c68c326aa3e32a911fa48aa18">gsWhoThrewRock</a> &gt;= NOBODY)
<a name="l01171"></a>01171             {
<a name="l01172"></a>01172 <span class="preprocessor">#ifdef BETAVERSION</span>
<a name="l01173"></a>01173 <span class="preprocessor"></span>                  NumMessage(<span class="stringliteral">"StandardInterruptConditions: ERROR - ubOpponentID is NOBODY, don't know who threw rock, guynum = "</span>,<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;guynum);
<a name="l01174"></a>01174 <span class="preprocessor">#endif</span>
<a name="l01175"></a>01175 <span class="preprocessor"></span>
<a name="l01176"></a>01176                   <span class="keywordflow">return</span>(FALSE);
<a name="l01177"></a>01177             }
<a name="l01178"></a>01178 
<a name="l01179"></a>01179             <span class="comment">// the machine that controls the guy who threw the rock makes the decision</span>
<a name="l01180"></a>01180             <span class="comment">/*</span>
<a name="l01181"></a>01181 <span class="comment">            if (Menptr[WhoThrewRock].controller != Net.pnum)</span>
<a name="l01182"></a>01182 <span class="comment">                  return(FALSE);</span>
<a name="l01183"></a>01183 <span class="comment">            */</span>
<a name="l01184"></a>01184             pOpponent = NULL;
<a name="l01185"></a>01185   }
<a name="l01186"></a>01186 
<a name="l01187"></a>01187       <span class="comment">// if interrupts have been disabled for any reason</span>
<a name="l01188"></a>01188       <span class="keywordflow">if</span> (!<a class="code" href="TeamTurns_8cpp.html#3be147c0d8dcf048dd9d8d9449f45965">InterruptsAllowed</a>)
<a name="l01189"></a>01189       {
<a name="l01190"></a>01190             <span class="keywordflow">return</span>(FALSE);
<a name="l01191"></a>01191       }
<a name="l01192"></a>01192 
<a name="l01193"></a>01193       <span class="comment">// in non-combat allow interrupt points to be calculated freely (everyone's in control!)</span>
<a name="l01194"></a>01194       <span class="comment">// also allow calculation for storing in AllTeamsLookForAll</span>
<a name="l01195"></a>01195       <span class="keywordflow">if</span> ( (<a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#89eb954f99ad4f28b84d7cf675c8ed32">uiFlags</a> &amp; INCOMBAT) &amp;&amp; ( <a class="code" href="opplist_8cpp.html#e969275dbd53f371738ebc6ff57decc8">gubBestToMakeSightingSize</a> != BEST_SIGHTING_ARRAY_SIZE_ALL_TEAMS_LOOK_FOR_ALL ) )
<a name="l01196"></a>01196       {
<a name="l01197"></a>01197             <span class="comment">// if his team's already in control</span>
<a name="l01198"></a>01198             <span class="keywordflow">if</span> (<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#74a40a8aaf3efe840cdaf6be62556d82">bTeam</a> == <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#d4322ac2c70a18b5aa84c2041e08c9b1">ubCurrentTeam</a> )
<a name="l01199"></a>01199             {
<a name="l01200"></a>01200                   <span class="comment">// if this is a player's a merc or civilian</span>
<a name="l01201"></a>01201                   <span class="keywordflow">if</span> ((<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#eb633099940bc20ff5a969bce84eab42">uiStatusFlags</a> &amp; SOLDIER_PC) || PTR_CIVILIAN)
<a name="l01202"></a>01202                   {
<a name="l01203"></a>01203                         <span class="comment">// then they are not allowed to interrupt their own team</span>
<a name="l01204"></a>01204                         <span class="keywordflow">return</span>(FALSE);
<a name="l01205"></a>01205                   }
<a name="l01206"></a>01206                   <span class="keywordflow">else</span>
<a name="l01207"></a>01207                   {
<a name="l01208"></a>01208                         <span class="comment">// enemies, MAY interrupt each other, but NOT themselves!</span>
<a name="l01209"></a>01209                         <span class="comment">//if ( pSoldier-&gt;uiStatusFlags &amp; SOLDIER_UNDERAICONTROL )</span>
<a name="l01210"></a>01210                         <span class="comment">//{</span>
<a name="l01211"></a>01211                               <span class="keywordflow">return</span>(FALSE);
<a name="l01212"></a>01212                         <span class="comment">//}</span>
<a name="l01213"></a>01213                   }
<a name="l01214"></a>01214                   
<a name="l01215"></a>01215             <span class="comment">// CJC, July 9 1998</span>
<a name="l01216"></a>01216                   <span class="comment">// NO ONE EVER interrupts his own team</span>
<a name="l01217"></a>01217                   <span class="comment">//return( FALSE );</span>
<a name="l01218"></a>01218             }
<a name="l01219"></a>01219             <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#32021b7251048d8c62ea0c2e26b7a021">bBoxingState</a> != <a class="code" href="Overhead_01Types_8h.html#60ed5bd8e4835b98d48cf7afb819b4e5f2caf361bed5cf6236018fbb59ecded2">NOT_BOXING</a> )
<a name="l01220"></a>01220             {
<a name="l01221"></a>01221                   <span class="comment">// while anything to do with boxing is going on, skip interrupts!</span>
<a name="l01222"></a>01222                   <span class="keywordflow">return</span>( FALSE );
<a name="l01223"></a>01223             }
<a name="l01224"></a>01224 
<a name="l01225"></a>01225       }
<a name="l01226"></a>01226 
<a name="l01227"></a>01227       <span class="keywordflow">if</span> ( !(<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#653dad4e2520784e293eca9f948b8532">bActive</a>) || !(<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#b0096f321a0de4f0617283f7b3212aa0">bInSector</a> ) )
<a name="l01228"></a>01228       {
<a name="l01229"></a>01229             <span class="keywordflow">return</span>( FALSE );
<a name="l01230"></a>01230       }
<a name="l01231"></a>01231 
<a name="l01232"></a>01232       <span class="comment">// soldiers at less than OKLIFE can't perform any actions</span>
<a name="l01233"></a>01233       <span class="keywordflow">if</span> (<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#e308dea18533bf5ab2bcee5bbe27391c">bLife</a> &lt; OKLIFE)
<a name="l01234"></a>01234       {
<a name="l01235"></a>01235             <span class="keywordflow">return</span>(FALSE);
<a name="l01236"></a>01236       }
<a name="l01237"></a>01237 
<a name="l01238"></a>01238       <span class="comment">// soldiers out of breath are about to fall over, no interrupt</span>
<a name="l01239"></a>01239       <span class="keywordflow">if</span> (<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#2a44d10fbcd1df19ba5bdbb4c1e60a38">bBreath</a> &lt; OKBREATH || <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#e7deba64e58676518e5d31bb7657da01">bCollapsed</a> )
<a name="l01240"></a>01240       {
<a name="l01241"></a>01241             <span class="keywordflow">return</span>(FALSE);
<a name="l01242"></a>01242       }
<a name="l01243"></a>01243 
<a name="l01244"></a>01244       <span class="comment">// if soldier doesn't have enough APs</span>
<a name="l01245"></a>01245       <span class="keywordflow">if</span> ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#080980e5fe705dcea5c819b05aef6f21">bActionPoints</a> &lt; MIN_APS_TO_INTERRUPT )
<a name="l01246"></a>01246       {
<a name="l01247"></a>01247             <span class="keywordflow">return</span>( FALSE );
<a name="l01248"></a>01248       }
<a name="l01249"></a>01249 
<a name="l01250"></a>01250       <span class="comment">// soldiers gagging on gas are too busy about holding their cookies down...</span>
<a name="l01251"></a>01251       <span class="keywordflow">if</span> ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#eb633099940bc20ff5a969bce84eab42">uiStatusFlags</a> &amp; SOLDIER_GASSED )
<a name="l01252"></a>01252       {
<a name="l01253"></a>01253             <span class="keywordflow">return</span>(FALSE);
<a name="l01254"></a>01254       }
<a name="l01255"></a>01255 
<a name="l01256"></a>01256       <span class="comment">// a soldier already engaged in a life &amp; death battle is too busy doing his</span>
<a name="l01257"></a>01257       <span class="comment">// best to survive to worry about "getting the jump" on additional threats</span>
<a name="l01258"></a>01258       <span class="keywordflow">if</span> (<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#4d7d451394eccbed289b3276bc325722">bUnderFire</a>)
<a name="l01259"></a>01259       {
<a name="l01260"></a>01260             <span class="keywordflow">return</span>(FALSE);
<a name="l01261"></a>01261       }
<a name="l01262"></a>01262 
<a name="l01263"></a>01263       <span class="keywordflow">if</span> (<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#e7deba64e58676518e5d31bb7657da01">bCollapsed</a>)
<a name="l01264"></a>01264       {
<a name="l01265"></a>01265             <span class="keywordflow">return</span>( FALSE );
<a name="l01266"></a>01266       }
<a name="l01267"></a>01267 
<a name="l01268"></a>01268       <span class="comment">// don't allow neutral folks to get interrupts</span>
<a name="l01269"></a>01269       <span class="keywordflow">if</span> (<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#165874ef5822faaf165da91996ad4a7b">bNeutral</a>)
<a name="l01270"></a>01270       {
<a name="l01271"></a>01271             <span class="keywordflow">return</span>( FALSE );
<a name="l01272"></a>01272       }
<a name="l01273"></a>01273 
<a name="l01274"></a>01274       <span class="comment">// no EPCs allowed to get interrupts</span>
<a name="l01275"></a>01275       <span class="keywordflow">if</span> ( AM_AN_EPC( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> ) &amp;&amp; !AM_A_ROBOT( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> ) )
<a name="l01276"></a>01276       {
<a name="l01277"></a>01277             <span class="keywordflow">return</span>( FALSE );
<a name="l01278"></a>01278       }
<a name="l01279"></a>01279 
<a name="l01280"></a>01280 
<a name="l01281"></a>01281       <span class="comment">// don't let mercs on assignment get interrupts</span>
<a name="l01282"></a>01282       <span class="keywordflow">if</span> ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#74a40a8aaf3efe840cdaf6be62556d82">bTeam</a> == <a class="code" href="Campaign_8cpp.html#47b2067ff75193e24776eda5297400ff">gbPlayerNum</a> &amp;&amp; <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#4269b53195147b458cd1e6874429734b">bAssignment</a> &gt;= <a class="code" href="Assignments_8h.html#16db4876b192da08f3ad0cb41afe516fd7123deb063a379062f08a16a7bfa242">ON_DUTY</a>)
<a name="l01283"></a>01283       {
<a name="l01284"></a>01284             <span class="keywordflow">return</span>( FALSE );
<a name="l01285"></a>01285       }
<a name="l01286"></a>01286 
<a name="l01287"></a>01287 
<a name="l01288"></a>01288       <span class="comment">// the bare minimum default is enough APs left to TURN</span>
<a name="l01289"></a>01289       ubMinPtsNeeded = AP_CHANGE_FACING;
<a name="l01290"></a>01290 
<a name="l01291"></a>01291       <span class="comment">// if the opponent is SOMEBODY</span>
<a name="l01292"></a>01292       <span class="keywordflow">if</span> (ubOpponentID &lt; NOBODY)
<a name="l01293"></a>01293       {
<a name="l01294"></a>01294             <span class="comment">// if the soldiers are on the same side</span>
<a name="l01295"></a>01295             <span class="keywordflow">if</span> (<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#1e61c0006bacccf9457c3f6c43607578">bSide</a> == pOpponent-&gt;<a class="code" href="structSOLDIERTYPE.html#1e61c0006bacccf9457c3f6c43607578">bSide</a>)
<a name="l01296"></a>01296             {
<a name="l01297"></a>01297                   <span class="comment">// human/civilians on same side can't interrupt each other</span>
<a name="l01298"></a>01298                   <span class="keywordflow">if</span> ((<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#eb633099940bc20ff5a969bce84eab42">uiStatusFlags</a> &amp; SOLDIER_PC) || PTR_CIVILIAN)
<a name="l01299"></a>01299                   {
<a name="l01300"></a>01300                         <span class="keywordflow">return</span>(FALSE);
<a name="l01301"></a>01301                   }
<a name="l01302"></a>01302                   <span class="keywordflow">else</span>  <span class="comment">// enemy</span>
<a name="l01303"></a>01303                   {
<a name="l01304"></a>01304                         <span class="comment">// enemies can interrupt EACH OTHER, but enemies and civilians on the</span>
<a name="l01305"></a>01305                         <span class="comment">// same side (but different teams) can't interrupt each other.</span>
<a name="l01306"></a>01306                         <span class="keywordflow">if</span> (<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#74a40a8aaf3efe840cdaf6be62556d82">bTeam</a> != pOpponent-&gt;<a class="code" href="structSOLDIERTYPE.html#74a40a8aaf3efe840cdaf6be62556d82">bTeam</a>)
<a name="l01307"></a>01307                         {
<a name="l01308"></a>01308                               <span class="keywordflow">return</span>(FALSE);
<a name="l01309"></a>01309                         }
<a name="l01310"></a>01310                   }
<a name="l01311"></a>01311             }
<a name="l01312"></a>01312 
<a name="l01313"></a>01313             <span class="comment">// if the interrupted opponent is not the selected character, then the only</span>
<a name="l01314"></a>01314             <span class="comment">// people eligible to win an interrupt are those on the SAME SIDE AS</span>
<a name="l01315"></a>01315             <span class="comment">// the selected character, ie. his friends...</span>
<a name="l01316"></a>01316             <span class="keywordflow">if</span> ( pOpponent-&gt;<a class="code" href="structSOLDIERTYPE.html#74a40a8aaf3efe840cdaf6be62556d82">bTeam</a> == <a class="code" href="Campaign_8cpp.html#47b2067ff75193e24776eda5297400ff">gbPlayerNum</a> )
<a name="l01317"></a>01317             {
<a name="l01318"></a>01318                   <span class="keywordflow">if</span> ((ubOpponentID != <a class="code" href="Interface_01Utils_8cpp.html#07d83e717b98bc3cf6628f0bb9bc9205">gusSelectedSoldier</a>) &amp;&amp; (<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#1e61c0006bacccf9457c3f6c43607578">bSide</a> != <a class="code" href="Overhead_8cpp.html#f1785e87ea281d015350ec85b9bd8508">Menptr</a>[<a class="code" href="Interface_01Utils_8cpp.html#07d83e717b98bc3cf6628f0bb9bc9205">gusSelectedSoldier</a>].bSide))
<a name="l01319"></a>01319                   {
<a name="l01320"></a>01320                         <span class="keywordflow">return</span>( FALSE );
<a name="l01321"></a>01321                   }
<a name="l01322"></a>01322             }
<a name="l01323"></a>01323             <span class="keywordflow">else</span>
<a name="l01324"></a>01324             {
<a name="l01325"></a>01325                   <span class="keywordflow">if</span> ( !(pOpponent-&gt;<a class="code" href="structSOLDIERTYPE.html#eb633099940bc20ff5a969bce84eab42">uiStatusFlags</a> &amp; SOLDIER_UNDERAICONTROL) &amp;&amp; (<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#1e61c0006bacccf9457c3f6c43607578">bSide</a> != pOpponent-&gt;<a class="code" href="structSOLDIERTYPE.html#1e61c0006bacccf9457c3f6c43607578">bSide</a>))
<a name="l01326"></a>01326                   {
<a name="l01327"></a>01327                         <span class="keywordflow">return</span>( FALSE );
<a name="l01328"></a>01328                   }
<a name="l01329"></a>01329             }
<a name="l01330"></a>01330             <span class="comment">/* old DG code for same:</span>
<a name="l01331"></a>01331 <span class="comment"></span>
<a name="l01332"></a>01332 <span class="comment">            if ((ubOpponentID != gusSelectedSoldier) &amp;&amp; (pSoldier-&gt;bSide != Menptr[gusSelectedSoldier].bSide))</span>
<a name="l01333"></a>01333 <span class="comment">            {</span>
<a name="l01334"></a>01334 <span class="comment">                  return(FALSE);</span>
<a name="l01335"></a>01335 <span class="comment">            }</span>
<a name="l01336"></a>01336 <span class="comment">            */</span>
<a name="l01337"></a>01337 
<a name="l01338"></a>01338             <span class="comment">// an non-active soldier can't interrupt a soldier who is also non-active!</span>
<a name="l01339"></a>01339             <span class="keywordflow">if</span> ((pOpponent-&gt;<a class="code" href="structSOLDIERTYPE.html#74a40a8aaf3efe840cdaf6be62556d82">bTeam</a> != <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#d4322ac2c70a18b5aa84c2041e08c9b1">ubCurrentTeam</a>) &amp;&amp; (<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#74a40a8aaf3efe840cdaf6be62556d82">bTeam</a> != <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#d4322ac2c70a18b5aa84c2041e08c9b1">ubCurrentTeam</a>))
<a name="l01340"></a>01340             {
<a name="l01341"></a>01341                   <span class="keywordflow">return</span>(FALSE);
<a name="l01342"></a>01342             }
<a name="l01343"></a>01343 
<a name="l01344"></a>01344 
<a name="l01345"></a>01345             <span class="comment">// if this is a "SEEING" interrupt</span>
<a name="l01346"></a>01346             <span class="keywordflow">if</span> (<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#d0a0bdddaeb7bbea617b4294b539ef32">bOppList</a>[ubOpponentID] == SEEN_CURRENTLY)
<a name="l01347"></a>01347             {
<a name="l01348"></a>01348                   <span class="comment">// if pSoldier already saw the opponent last "look" or at least this turn</span>
<a name="l01349"></a>01349                   <span class="keywordflow">if</span> ((bOldOppList == SEEN_CURRENTLY) || (bOldOppList == SEEN_THIS_TURN))
<a name="l01350"></a>01350                   {
<a name="l01351"></a>01351                         <span class="keywordflow">return</span>(FALSE);     <span class="comment">// no interrupt is possible</span>
<a name="l01352"></a>01352                   }
<a name="l01353"></a>01353 
<a name="l01354"></a>01354                   <span class="comment">// if the soldier is behind him and not very close, forget it</span>
<a name="l01355"></a>01355                   bDir = <a class="code" href="Soldier_01Control_8cpp.html#5d07f5ec1830ee43c5ea64def81cfded">atan8</a>( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#80d05007932f81f157f2773852ebf62f">sX</a>, <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#bad6abc8c1fd843d332db84aa9c1a10c">sY</a>, pOpponent-&gt;<a class="code" href="structSOLDIERTYPE.html#80d05007932f81f157f2773852ebf62f">sX</a>, pOpponent-&gt;<a class="code" href="structSOLDIERTYPE.html#bad6abc8c1fd843d332db84aa9c1a10c">sY</a> );
<a name="l01356"></a>01356                   <span class="keywordflow">if</span> ( <a class="code" href="Isometric_01Utils_8cpp.html#9591ab6c902758a420fd3d9f4e49ba2e">gOppositeDirection</a>[ <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#7d2defbf893cfe6135722921bef9bd94">bDesiredDirection</a> ] == bDir )
<a name="l01357"></a>01357                   {
<a name="l01358"></a>01358                         <span class="comment">// directly behind; allow interrupts only within # of tiles equal to level</span>
<a name="l01359"></a>01359                         <span class="keywordflow">if</span> ( <a class="code" href="Isometric_01Utils_8cpp.html#a9c80c0c7523c83360aeb6b46963780b">PythSpacesAway</a>( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#2ab66ee0f37902cd448f4a738df4f2bf">sGridNo</a>, pOpponent-&gt;<a class="code" href="structSOLDIERTYPE.html#2ab66ee0f37902cd448f4a738df4f2bf">sGridNo</a> ) &gt; <a class="code" href="SkillCheck_8cpp.html#15874afa42450a6228e52f68f6871178">EffectiveExpLevel</a>( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> ) )
<a name="l01360"></a>01360                         {
<a name="l01361"></a>01361                               <span class="keywordflow">return</span>( FALSE );
<a name="l01362"></a>01362                         }
<a name="l01363"></a>01363                   }
<a name="l01364"></a>01364             
<a name="l01365"></a>01365                   <span class="comment">// if the soldier isn't currently crouching</span>
<a name="l01366"></a>01366                   <span class="keywordflow">if</span> (!PTR_CROUCHED)
<a name="l01367"></a>01367                   {
<a name="l01368"></a>01368                         ubMinPtsNeeded = AP_CROUCH;
<a name="l01369"></a>01369                   }
<a name="l01370"></a>01370                   <span class="keywordflow">else</span>
<a name="l01371"></a>01371                   {
<a name="l01372"></a>01372                         ubMinPtsNeeded = <a class="code" href="Points_8cpp.html#2d38f8d23814118ef8a616c4d28c2089">MinPtsToMove</a>(<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>);
<a name="l01373"></a>01373                   }
<a name="l01374"></a>01374             }
<a name="l01375"></a>01375             <span class="keywordflow">else</span>   <span class="comment">// this is a "HEARING" interrupt</span>
<a name="l01376"></a>01376             {
<a name="l01377"></a>01377                   <span class="comment">// if the opponent can't see the "interrupter" either, OR</span>
<a name="l01378"></a>01378                   <span class="comment">// if the "interrupter" already has any opponents already in sight, OR</span>
<a name="l01379"></a>01379                   <span class="comment">// if the "interrupter" already heard the active soldier this turn</span>
<a name="l01380"></a>01380                   <span class="keywordflow">if</span> ((pOpponent-&gt;<a class="code" href="structSOLDIERTYPE.html#d0a0bdddaeb7bbea617b4294b539ef32">bOppList</a>[<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#18aef170576da81b10d00e7b6cd3627b">ubID</a>] != SEEN_CURRENTLY) || (<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#794f2b53a1e037c0f011fe3aa2cebec8">bOppCnt</a> &gt; 0) || (bOldOppList == HEARD_THIS_TURN))
<a name="l01381"></a>01381                   {
<a name="l01382"></a>01382                         <span class="keywordflow">return</span>(FALSE);     <span class="comment">// no interrupt is possible</span>
<a name="l01383"></a>01383                   }
<a name="l01384"></a>01384             }
<a name="l01385"></a>01385       }
<a name="l01386"></a>01386 
<a name="l01387"></a>01387 
<a name="l01388"></a>01388       <span class="comment">// soldiers without sufficient APs to do something productive can't interrupt</span>
<a name="l01389"></a>01389       <span class="keywordflow">if</span> (<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#080980e5fe705dcea5c819b05aef6f21">bActionPoints</a> &lt; ubMinPtsNeeded)
<a name="l01390"></a>01390       {
<a name="l01391"></a>01391             <span class="keywordflow">return</span>(FALSE);
<a name="l01392"></a>01392       }
<a name="l01393"></a>01393 
<a name="l01394"></a>01394       <span class="comment">// soldier passed on the chance to react during previous interrupt this turn</span>
<a name="l01395"></a>01395       <span class="keywordflow">if</span> (<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#1d499631188ba2009800a8fac6241e3a">bPassedLastInterrupt</a>)
<a name="l01396"></a>01396       {
<a name="l01397"></a>01397 <span class="preprocessor">#ifdef RECORDNET</span>
<a name="l01398"></a>01398 <span class="preprocessor"></span>            fprintf(NetDebugFile,<span class="stringliteral">"\tStandardInterruptConditionsMet: FAILING because PassedLastInterrupt %d(%s)\n"</span>,
<a name="l01399"></a>01399                   <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;guynum,ExtMen[<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;guynum].<a class="code" href="structSOLDIERTYPE.html#7bf7231f416aa66f38010b7a7e8f2341">name</a>);
<a name="l01400"></a>01400 <span class="preprocessor">#endif</span>
<a name="l01401"></a>01401 <span class="preprocessor"></span>
<a name="l01402"></a>01402 <span class="comment">//          return(FALSE);</span>
<a name="l01403"></a>01403       }
<a name="l01404"></a>01404 
<a name="l01405"></a>01405 
<a name="l01406"></a>01406 <span class="preprocessor">#ifdef RECORDINTERRUPT</span>
<a name="l01407"></a>01407 <span class="preprocessor"></span>      <span class="comment">// this usually starts a new series of logs, so that's why the blank line</span>
<a name="l01408"></a>01408       fprintf(InterruptFile,<span class="stringliteral">"\nStandardInterruptConditionsMet by %d vs. %d\n"</span>,<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;guynum,ubOpponentID);
<a name="l01409"></a>01409 <span class="preprocessor">#endif</span>
<a name="l01410"></a>01410 <span class="preprocessor"></span>
<a name="l01411"></a>01411       <span class="keywordflow">return</span>(TRUE);
<a name="l01412"></a>01412 }
<a name="l01413"></a>01413 
<a name="l01414"></a>01414 
<a name="l01415"></a><a class="code" href="TeamTurns_8h.html#45f9de4f8220ae8a1fc7ce7d059e38ef">01415</a> <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> <a class="code" href="TeamTurns_8cpp.html#45f9de4f8220ae8a1fc7ce7d059e38ef">CalcInterruptDuelPts</a>( <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> * <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubOpponentID, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fUseWatchSpots )
<a name="l01416"></a>01416 {
<a name="l01417"></a>01417       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iPoints;
<a name="l01418"></a>01418       <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bLightLevel;
<a name="l01419"></a>01419       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubDistance;
<a name="l01420"></a>01420       DebugMsg (TOPIC_JA2,DBG_LEVEL_3,<span class="stringliteral">"CalcInterruptDuelPts"</span>);
<a name="l01421"></a>01421 
<a name="l01422"></a>01422       <span class="comment">// extra check to make sure neutral folks never get interrupts</span>
<a name="l01423"></a>01423       <span class="keywordflow">if</span> (<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#165874ef5822faaf165da91996ad4a7b">bNeutral</a>)
<a name="l01424"></a>01424       {
<a name="l01425"></a>01425             <span class="keywordflow">return</span>( NO_INTERRUPT );
<a name="l01426"></a>01426       }
<a name="l01427"></a>01427 
<a name="l01428"></a>01428       <span class="comment">// Old: BASE is one point for each experience level.</span>
<a name="l01429"></a>01429       <span class="comment">// Snap: Agility should be a factor, since it is a measure of</span>
<a name="l01430"></a>01430       <span class="comment">// a person's reactions.  We'll give more weight to experience</span>
<a name="l01431"></a>01431       <span class="comment">// though, since combat initiative is too important to be left up</span>
<a name="l01432"></a>01432       <span class="comment">// to an ordinary skill like agility.</span>
<a name="l01433"></a>01433       <span class="comment">// BASE = (2*lev + agi/10) / 3</span>
<a name="l01434"></a>01434       <span class="comment">// Robot has interrupt points based on the controller...</span>
<a name="l01435"></a>01435       <span class="comment">// Controller's interrupt points are reduced by 2 for being distracted...</span>
<a name="l01436"></a>01436       <span class="keywordflow">if</span> ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#eb633099940bc20ff5a969bce84eab42">uiStatusFlags</a> &amp; SOLDIER_ROBOT &amp;&amp; <a class="code" href="Soldier_01Control_8cpp.html#27a564588e387182cda2c13468d889c3">CanRobotBeControlled</a>( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> ) )
<a name="l01437"></a>01437       {
<a name="l01438"></a>01438             <span class="comment">//iPoints = EffectiveExpLevel( MercPtrs[ pSoldier-&gt;ubRobotRemoteHolderID ] ) - 2;</span>
<a name="l01439"></a>01439             <span class="comment">// Snap: (do some proper rounding here)</span>
<a name="l01440"></a>01440             iPoints = ( 20*<a class="code" href="SkillCheck_8cpp.html#15874afa42450a6228e52f68f6871178">EffectiveExpLevel</a>( <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#aae279c5f2bba1c95cc01a190531c14b">ubRobotRemoteHolderID</a> ] )
<a name="l01441"></a>01441                   + <a class="code" href="SkillCheck_8cpp.html#052d775995f7b8ea19709a0c13c142bb">EffectiveAgility</a>( <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#aae279c5f2bba1c95cc01a190531c14b">ubRobotRemoteHolderID</a> ] ) + 15 ) / 30 - 2;
<a name="l01442"></a>01442       }
<a name="l01443"></a>01443       <span class="keywordflow">else</span>
<a name="l01444"></a>01444       {
<a name="l01445"></a>01445             <span class="comment">//iPoints = EffectiveExpLevel( pSoldier );</span>
<a name="l01446"></a>01446             <span class="comment">// Snap:</span>
<a name="l01447"></a>01447             iPoints = ( 20*<a class="code" href="SkillCheck_8cpp.html#15874afa42450a6228e52f68f6871178">EffectiveExpLevel</a>( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> ) + <a class="code" href="SkillCheck_8cpp.html#052d775995f7b8ea19709a0c13c142bb">EffectiveAgility</a>( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> ) + 15 ) / 30;
<a name="l01448"></a>01448 
<a name="l01449"></a>01449             <span class="comment">/*</span>
<a name="l01450"></a>01450 <span class="comment">            if ( pSoldier-&gt;bTeam == ENEMY_TEAM )</span>
<a name="l01451"></a>01451 <span class="comment">            {</span>
<a name="l01452"></a>01452 <span class="comment">                  // modify by the difficulty level setting</span>
<a name="l01453"></a>01453 <span class="comment">                  iPoints += gbDiff[ DIFF_ENEMY_INTERRUPT_MOD ][ SoldierDifficultyLevel( pSoldier ) ];</span>
<a name="l01454"></a>01454 <span class="comment">                  iPoints = __max( iPoints, 9 );</span>
<a name="l01455"></a>01455 <span class="comment">            }</span>
<a name="l01456"></a>01456 <span class="comment">            */</span>
<a name="l01457"></a>01457 
<a name="l01458"></a>01458             <span class="keywordflow">if</span> ( <a class="code" href="Soldier_01Control_8cpp.html#23463b591d6f9116e8e0276029f38a9a">ControllingRobot</a>( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> ) )
<a name="l01459"></a>01459             {
<a name="l01460"></a>01460                   iPoints -= 2;
<a name="l01461"></a>01461             }
<a name="l01462"></a>01462       }
<a name="l01463"></a>01463 
<a name="l01464"></a>01464       <span class="keywordflow">if</span> (fUseWatchSpots)
<a name="l01465"></a>01465       {
<a name="l01466"></a>01466             <span class="comment">// if this is a previously noted spot of enemies, give bonus points!</span>
<a name="l01467"></a>01467             iPoints += <a class="code" href="opplist_8cpp.html#1267d880efda29faf7f3298384854d74">GetWatchedLocPoints</a>( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#18aef170576da81b10d00e7b6cd3627b">ubID</a>, <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ ubOpponentID ]-&gt;<a class="code" href="structSOLDIERTYPE.html#2ab66ee0f37902cd448f4a738df4f2bf">sGridNo</a>, <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ ubOpponentID ]-&gt;<a class="code" href="structSOLDIERTYPE.html#0d1f73c5d0ac839ec84a4792505949cb">bLevel</a> );
<a name="l01468"></a>01468       }
<a name="l01469"></a>01469 
<a name="l01470"></a>01470       <span class="comment">// LOSE one point for each 2 additional opponents he currently sees, above 2</span>
<a name="l01471"></a>01471       <span class="keywordflow">if</span> (<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#794f2b53a1e037c0f011fe3aa2cebec8">bOppCnt</a> &gt; 2)
<a name="l01472"></a>01472       {
<a name="l01473"></a>01473             <span class="comment">// subtract 1 here so there is a penalty of 1 for seeing 3 enemies</span>
<a name="l01474"></a>01474             iPoints -= (<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#794f2b53a1e037c0f011fe3aa2cebec8">bOppCnt</a> - 1) / 2;
<a name="l01475"></a>01475       }
<a name="l01476"></a>01476 
<a name="l01477"></a>01477       <span class="comment">// LOSE one point if he's trying to interrupt only by hearing</span>
<a name="l01478"></a>01478       <span class="keywordflow">if</span> (<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#d0a0bdddaeb7bbea617b4294b539ef32">bOppList</a>[ubOpponentID] == HEARD_THIS_TURN)
<a name="l01479"></a>01479       {
<a name="l01480"></a>01480             iPoints--;
<a name="l01481"></a>01481       }
<a name="l01482"></a>01482 
<a name="l01483"></a>01483       <span class="comment">// if soldier is still in shock from recent injuries, that penalizes him</span>
<a name="l01484"></a>01484       iPoints -= <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#f9d318c8e6c8f11cf39d8c039f24858a">bShock</a>;
<a name="l01485"></a>01485 
<a name="l01486"></a>01486       ubDistance = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>) <a class="code" href="Isometric_01Utils_8cpp.html#a9c80c0c7523c83360aeb6b46963780b">PythSpacesAway</a>( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#2ab66ee0f37902cd448f4a738df4f2bf">sGridNo</a>, <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ ubOpponentID ]-&gt;<a class="code" href="structSOLDIERTYPE.html#2ab66ee0f37902cd448f4a738df4f2bf">sGridNo</a> );
<a name="l01487"></a>01487 
<a name="l01488"></a>01488       <span class="comment">// if we are in combat mode - thus doing an interrupt rather than determine who gets first turn - </span>
<a name="l01489"></a>01489       <span class="comment">// then give bonus </span>
<a name="l01490"></a>01490       <span class="keywordflow">if</span> ( (<a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#89eb954f99ad4f28b84d7cf675c8ed32">uiFlags</a> &amp; INCOMBAT) &amp;&amp; (<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#74a40a8aaf3efe840cdaf6be62556d82">bTeam</a> != <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#d4322ac2c70a18b5aa84c2041e08c9b1">ubCurrentTeam</a>) )
<a name="l01491"></a>01491       {
<a name="l01492"></a>01492             <span class="comment">// passive player gets penalty due to range</span>
<a name="l01493"></a>01493             iPoints -= (ubDistance / 10);
<a name="l01494"></a>01494       }
<a name="l01495"></a>01495       <span class="keywordflow">else</span>
<a name="l01496"></a>01496       {
<a name="l01497"></a>01497             <span class="comment">// either non-combat or the player with the current turn... i.e. active...</span>
<a name="l01498"></a>01498             <span class="comment">// unfortunately we can't use opplist here to record whether or not we saw this guy before, because at this point</span>
<a name="l01499"></a>01499             <span class="comment">// the opplist has been updated to seen.  But we can use gbSeenOpponents ...</span>
<a name="l01500"></a>01500 
<a name="l01501"></a>01501             <span class="comment">// this soldier is moving, so give them a bonus for crawling or swatting at long distances</span>
<a name="l01502"></a>01502             <span class="keywordflow">if</span> ( !<a class="code" href="opplist_8cpp.html#dd7c89aa9009496a1ac04e9f9122980c">gbSeenOpponents</a>[ ubOpponentID ][ <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#18aef170576da81b10d00e7b6cd3627b">ubID</a> ] )
<a name="l01503"></a>01503             {
<a name="l01504"></a>01504                   <span class="keywordflow">if</span> (<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#1f73b62a5ea0dd26fa1bec1d9f522b41">usAnimState</a> == <a class="code" href="Animation_01Control_8h.html#9c02dc5e870a2c7d20bbaafb3e7be2ebc4ee957db5c1a8f43b9d84b46335a30a">SWATTING</a> &amp;&amp; ubDistance &gt; (<a class="code" href="opplist_8cpp.html#ce89c9f1017d9a6e473df03acb6f1a2a">MaxDistanceVisible</a>() / 2) ) <span class="comment">// more than 1/2 sight distance</span>
<a name="l01505"></a>01505                   {
<a name="l01506"></a>01506                         iPoints++;
<a name="l01507"></a>01507                   }
<a name="l01508"></a>01508                   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#1f73b62a5ea0dd26fa1bec1d9f522b41">usAnimState</a> == <a class="code" href="Animation_01Control_8h.html#9c02dc5e870a2c7d20bbaafb3e7be2eb45bc234750d2854454598b52df3583c9">CRAWLING</a> &amp;&amp; ubDistance &gt; (<a class="code" href="opplist_8cpp.html#ce89c9f1017d9a6e473df03acb6f1a2a">MaxDistanceVisible</a>() / 4) ) <span class="comment">// more than 1/4 sight distance</span>
<a name="l01509"></a>01509                   {
<a name="l01510"></a>01510                         iPoints += ubDistance / <a class="code" href="opplist_8cpp.html#25719fa0f78cb1129d152b140f1120dc">STRAIGHT</a>;
<a name="l01511"></a>01511                   }
<a name="l01512"></a>01512             }
<a name="l01513"></a>01513       }
<a name="l01514"></a>01514 
<a name="l01515"></a>01515       <span class="comment">// whether active or not, penalize people who are running</span>
<a name="l01516"></a>01516       <span class="keywordflow">if</span> ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#1f73b62a5ea0dd26fa1bec1d9f522b41">usAnimState</a> == <a class="code" href="Animation_01Control_8h.html#9c02dc5e870a2c7d20bbaafb3e7be2eb1061be6c3fb88d32829cba6f6b2be304">RUNNING</a> &amp;&amp; !<a class="code" href="opplist_8cpp.html#dd7c89aa9009496a1ac04e9f9122980c">gbSeenOpponents</a>[ <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#18aef170576da81b10d00e7b6cd3627b">ubID</a> ][ ubOpponentID ] )
<a name="l01517"></a>01517       {
<a name="l01518"></a>01518             iPoints -= 2;
<a name="l01519"></a>01519       }
<a name="l01520"></a>01520 
<a name="l01521"></a>01521       <span class="keywordflow">if</span> (<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#fe3b06e2ba46bbcfad78e9e628d0aeb6">ubServicePartner</a> != NOBODY)
<a name="l01522"></a>01522       {
<a name="l01523"></a>01523             <span class="comment">// distracted by being bandaged/doing bandaging</span>
<a name="l01524"></a>01524             iPoints -= 2;
<a name="l01525"></a>01525       }
<a name="l01526"></a>01526 
<a name="l01527"></a>01527       <span class="keywordflow">if</span> ( HAS_SKILL_TRAIT( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>, <a class="code" href="soldier_01profile_01type_8h.html#88183a1fc58897e3edb65b354323264b98b590ff5b126a99b72fd5670369d2b4">NIGHTOPS</a> ) )
<a name="l01528"></a>01528       {
<a name="l01529"></a>01529             bLightLevel = <a class="code" href="lighting_8cpp.html#452f2e0842d351e1fb5f930673d023e0">LightTrueLevel</a>(<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#2ab66ee0f37902cd448f4a738df4f2bf">sGridNo</a>, <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#0d1f73c5d0ac839ec84a4792505949cb">bLevel</a>);
<a name="l01530"></a>01530             <span class="keywordflow">if</span> (bLightLevel &gt; NORMAL_LIGHTLEVEL_DAY + 3)
<a name="l01531"></a>01531             {
<a name="l01532"></a>01532                   <span class="comment">// it's dark, give a bonus for interrupts</span>
<a name="l01533"></a>01533                   iPoints += 1 * NUM_SKILL_TRAITS( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>, <a class="code" href="soldier_01profile_01type_8h.html#88183a1fc58897e3edb65b354323264b98b590ff5b126a99b72fd5670369d2b4">NIGHTOPS</a> );
<a name="l01534"></a>01534             }
<a name="l01535"></a>01535       }
<a name="l01536"></a>01536 
<a name="l01537"></a>01537       <span class="comment">// if he's a computer soldier</span>
<a name="l01538"></a>01538 
<a name="l01539"></a>01539       <span class="comment">// CJC note: this will affect friendly AI as well...</span>
<a name="l01540"></a>01540       
<a name="l01541"></a>01541       <span class="keywordflow">if</span> ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#eb633099940bc20ff5a969bce84eab42">uiStatusFlags</a> &amp; SOLDIER_PC )
<a name="l01542"></a>01542       {
<a name="l01543"></a>01543             <span class="keywordflow">if</span> ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#4269b53195147b458cd1e6874429734b">bAssignment</a> &gt;= <a class="code" href="Assignments_8h.html#16db4876b192da08f3ad0cb41afe516fd7123deb063a379062f08a16a7bfa242">ON_DUTY</a> )
<a name="l01544"></a>01544             {
<a name="l01545"></a>01545                   <span class="comment">// make sure don't get interrupts!</span>
<a name="l01546"></a>01546                   iPoints = -10;
<a name="l01547"></a>01547             }
<a name="l01548"></a>01548 
<a name="l01549"></a>01549             <span class="comment">// GAIN one point if he's previously seen the opponent</span>
<a name="l01550"></a>01550             <span class="comment">// check for TRUE because -1 means we JUST saw him (always so here)</span>
<a name="l01551"></a>01551             <span class="keywordflow">if</span> (<a class="code" href="opplist_8cpp.html#dd7c89aa9009496a1ac04e9f9122980c">gbSeenOpponents</a>[<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#18aef170576da81b10d00e7b6cd3627b">ubID</a>][ubOpponentID] == TRUE)
<a name="l01552"></a>01552             {
<a name="l01553"></a>01553                   iPoints++;  <span class="comment">// seen him before, easier to react to him</span>
<a name="l01554"></a>01554             }
<a name="l01555"></a>01555       }
<a name="l01556"></a>01556       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#74a40a8aaf3efe840cdaf6be62556d82">bTeam</a> == ENEMY_TEAM )
<a name="l01557"></a>01557       {
<a name="l01558"></a>01558             <span class="comment">// GAIN one point if he's previously seen the opponent</span>
<a name="l01559"></a>01559             <span class="comment">// check for TRUE because -1 means we JUST saw him (always so here)</span>
<a name="l01560"></a>01560             <span class="keywordflow">if</span> (<a class="code" href="opplist_8cpp.html#dd7c89aa9009496a1ac04e9f9122980c">gbSeenOpponents</a>[<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#18aef170576da81b10d00e7b6cd3627b">ubID</a>][ubOpponentID] == TRUE)
<a name="l01561"></a>01561             {
<a name="l01562"></a>01562                   iPoints++;  <span class="comment">// seen him before, easier to react to him</span>
<a name="l01563"></a>01563             }
<a name="l01564"></a>01564             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="opplist_8cpp.html#f9971dd5d2083f2f174bdc81b1be1c82">gbPublicOpplist</a>[<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#74a40a8aaf3efe840cdaf6be62556d82">bTeam</a>][ubOpponentID] != NOT_HEARD_OR_SEEN)
<a name="l01565"></a>01565             {
<a name="l01566"></a>01566                   <span class="comment">// GAIN one point if opponent has been recently radioed in by his team</span>
<a name="l01567"></a>01567                   iPoints++;
<a name="l01568"></a>01568             }
<a name="l01569"></a>01569       }
<a name="l01570"></a>01570 
<a name="l01571"></a>01571       <span class="keywordflow">if</span> ( TANK( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> ) )
<a name="l01572"></a>01572       {
<a name="l01573"></a>01573             <span class="comment">// reduce interrupt possibilities for tanks!</span>
<a name="l01574"></a>01574             iPoints /= 2;
<a name="l01575"></a>01575       }
<a name="l01576"></a>01576 
<a name="l01577"></a>01577       <span class="keywordflow">if</span> (iPoints &gt;= AUTOMATIC_INTERRUPT)
<a name="l01578"></a>01578       {
<a name="l01579"></a>01579 <span class="preprocessor">#ifdef BETAVERSION</span>
<a name="l01580"></a>01580 <span class="preprocessor"></span>            NumMessage(<span class="stringliteral">"CalcInterruptDuelPts: ERROR - Invalid bInterruptDuelPts calculated for soldier "</span>,<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;guynum);
<a name="l01581"></a>01581 <span class="preprocessor">#endif</span>
<a name="l01582"></a>01582 <span class="preprocessor"></span>            iPoints = AUTOMATIC_INTERRUPT - 1;  <span class="comment">// hack it to one less than max so its legal</span>
<a name="l01583"></a>01583       }
<a name="l01584"></a>01584 
<a name="l01585"></a>01585 <span class="preprocessor">      #ifdef DEBUG_INTERRUPTS</span>
<a name="l01586"></a>01586 <span class="preprocessor"></span>            DebugMsg( TOPIC_JA2, DBG_LEVEL_3, <a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>(<span class="stringliteral">"Calculating int pts for %d vs %d, number is %d"</span>, <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#18aef170576da81b10d00e7b6cd3627b">ubID</a>, ubOpponentID, iPoints ) );
<a name="l01587"></a>01587 <span class="preprocessor">      #endif</span>
<a name="l01588"></a>01588 <span class="preprocessor"></span>
<a name="l01589"></a>01589 
<a name="l01590"></a>01590       DebugMsg (TOPIC_JA2,DBG_LEVEL_3,<span class="stringliteral">"CalcInterruptDuelPts done"</span>);
<a name="l01591"></a>01591       <span class="keywordflow">return</span>( (<a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>)iPoints );
<a name="l01592"></a>01592 }
<a name="l01593"></a>01593 
<a name="l01594"></a><a class="code" href="TeamTurns_8h.html#0b4e0cde0186bbb931b9205b7055d762">01594</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="TeamTurns_8cpp.html#0b4e0cde0186bbb931b9205b7055d762">InterruptDuel</a>( <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> * <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>, <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> * pOpponent)
<a name="l01595"></a>01595 {
<a name="l01596"></a>01596       DebugMsg (TOPIC_JA2,DBG_LEVEL_3,<span class="stringliteral">"InterruptDuel"</span>);
<a name="l01597"></a>01597       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fResult = FALSE;
<a name="l01598"></a>01598 
<a name="l01599"></a>01599       <span class="comment">// if opponent can't currently see us and we can see them</span>
<a name="l01600"></a>01600       <span class="keywordflow">if</span> ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#d0a0bdddaeb7bbea617b4294b539ef32">bOppList</a>[ pOpponent-&gt;<a class="code" href="structSOLDIERTYPE.html#18aef170576da81b10d00e7b6cd3627b">ubID</a> ] == SEEN_CURRENTLY &amp;&amp; pOpponent-&gt;<a class="code" href="structSOLDIERTYPE.html#d0a0bdddaeb7bbea617b4294b539ef32">bOppList</a>[<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#18aef170576da81b10d00e7b6cd3627b">ubID</a>] != SEEN_CURRENTLY )
<a name="l01601"></a>01601       {
<a name="l01602"></a>01602             fResult = TRUE;       <span class="comment">// we automatically interrupt</span>
<a name="l01603"></a>01603             <span class="comment">// fix up our interrupt duel pts if necessary</span>
<a name="l01604"></a>01604             <span class="keywordflow">if</span> (<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#041daf8c77b17f894fc6b20b3d1d289b">bInterruptDuelPts</a> &lt; pOpponent-&gt;<a class="code" href="structSOLDIERTYPE.html#041daf8c77b17f894fc6b20b3d1d289b">bInterruptDuelPts</a>)
<a name="l01605"></a>01605             {
<a name="l01606"></a>01606                   <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#041daf8c77b17f894fc6b20b3d1d289b">bInterruptDuelPts</a> = pOpponent-&gt;<a class="code" href="structSOLDIERTYPE.html#041daf8c77b17f894fc6b20b3d1d289b">bInterruptDuelPts</a>;
<a name="l01607"></a>01607             }
<a name="l01608"></a>01608       }
<a name="l01609"></a>01609       <span class="keywordflow">else</span>
<a name="l01610"></a>01610       {
<a name="l01611"></a>01611             <span class="comment">// If our total points is HIGHER, then we interrupt him anyway</span>
<a name="l01612"></a>01612             <span class="keywordflow">if</span> (<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#041daf8c77b17f894fc6b20b3d1d289b">bInterruptDuelPts</a> &gt; pOpponent-&gt;<a class="code" href="structSOLDIERTYPE.html#041daf8c77b17f894fc6b20b3d1d289b">bInterruptDuelPts</a>)
<a name="l01613"></a>01613             {
<a name="l01614"></a>01614                   fResult = TRUE;
<a name="l01615"></a>01615             }
<a name="l01616"></a>01616       }
<a name="l01617"></a>01617 <span class="comment">//    ScreenMsg( FONT_MCOLOR_LTYELLOW, MSG_INTERFACE, L"Interrupt duel %d (%d pts) vs %d (%d pts)", pSoldier-&gt;ubID, pSoldier-&gt;bInterruptDuelPts, pOpponent-&gt;ubID, pOpponent-&gt;bInterruptDuelPts );</span>
<a name="l01618"></a>01618       DebugMsg (TOPIC_JA2,DBG_LEVEL_3,<span class="stringliteral">"InterruptDuel done"</span>);
<a name="l01619"></a>01619       <span class="keywordflow">return</span>( fResult );
<a name="l01620"></a>01620 }
<a name="l01621"></a>01621 
<a name="l01622"></a>01622 
<a name="l01623"></a><a class="code" href="TeamTurns_8cpp.html#9318a9ca429d8a866d11f101bffafd60">01623</a> <span class="keywordtype">void</span> <a class="code" href="TeamTurns_8cpp.html#9318a9ca429d8a866d11f101bffafd60">DeleteFromIntList</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubIndex, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fCommunicate)
<a name="l01624"></a>01624 {
<a name="l01625"></a>01625       DebugMsg (TOPIC_JA2,DBG_LEVEL_3,<span class="stringliteral">"DeleteFromIntList"</span>);
<a name="l01626"></a>01626       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubLoop;
<a name="l01627"></a>01627       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubID;
<a name="l01628"></a>01628 
<a name="l01629"></a>01629       <span class="keywordflow">if</span> ( ubIndex &gt; <a class="code" href="TeamTurns_8cpp.html#bba49c23835b863c536a9796e4461183">gubOutOfTurnPersons</a>)
<a name="l01630"></a>01630       {
<a name="l01631"></a>01631             <span class="keywordflow">return</span>;
<a name="l01632"></a>01632       }
<a name="l01633"></a>01633 
<a name="l01634"></a>01634       <span class="comment">// remember who we're getting rid of</span>
<a name="l01635"></a>01635       ubID = <a class="code" href="TeamTurns_8cpp.html#8f8bdbac1eb4174dfb142fd50f762004">gubOutOfTurnOrder</a>[ubIndex];
<a name="l01636"></a>01636 
<a name="l01637"></a>01637 <span class="preprocessor">      #ifdef DEBUG_INTERRUPTS</span>
<a name="l01638"></a>01638 <span class="preprocessor"></span>            DebugMsg( TOPIC_JA2, DBG_LEVEL_3, <a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>(<span class="stringliteral">"INTERRUPT: removing ID %d"</span>, ubID ) );
<a name="l01639"></a>01639 <span class="preprocessor">      #endif</span>
<a name="l01640"></a>01640 <span class="preprocessor"></span><span class="comment">//    ScreenMsg( FONT_MCOLOR_LTYELLOW, MSG_INTERFACE, L"%d removed from int list", ubID );</span>
<a name="l01641"></a>01641       <span class="comment">// if we're NOT deleting the LAST entry in the int list</span>
<a name="l01642"></a>01642       <span class="keywordflow">if</span> (ubIndex &lt; <a class="code" href="TeamTurns_8cpp.html#bba49c23835b863c536a9796e4461183">gubOutOfTurnPersons</a>)
<a name="l01643"></a>01643       {
<a name="l01644"></a>01644             <span class="comment">// not the last entry, must move all those behind it over to fill the gap</span>
<a name="l01645"></a>01645             <span class="keywordflow">for</span> (ubLoop = ubIndex; ubLoop &lt; <a class="code" href="TeamTurns_8cpp.html#bba49c23835b863c536a9796e4461183">gubOutOfTurnPersons</a>; ubLoop++)
<a name="l01646"></a>01646             {
<a name="l01647"></a>01647                   <a class="code" href="TeamTurns_8cpp.html#8f8bdbac1eb4174dfb142fd50f762004">gubOutOfTurnOrder</a>[ubLoop] = <a class="code" href="TeamTurns_8cpp.html#8f8bdbac1eb4174dfb142fd50f762004">gubOutOfTurnOrder</a>[ubLoop + 1];
<a name="l01648"></a>01648             }
<a name="l01649"></a>01649       }
<a name="l01650"></a>01650 
<a name="l01651"></a>01651       <span class="comment">// either way, whack the last entry to NOBODY and decrement the list size</span>
<a name="l01652"></a>01652       <a class="code" href="TeamTurns_8cpp.html#8f8bdbac1eb4174dfb142fd50f762004">gubOutOfTurnOrder</a>[<a class="code" href="TeamTurns_8cpp.html#bba49c23835b863c536a9796e4461183">gubOutOfTurnPersons</a>] = NOBODY;
<a name="l01653"></a>01653       <a class="code" href="TeamTurns_8cpp.html#bba49c23835b863c536a9796e4461183">gubOutOfTurnPersons</a>--;
<a name="l01654"></a>01654 
<a name="l01655"></a>01655       <span class="comment">// once the last interrupted guy gets deleted from the list, he's no longer</span>
<a name="l01656"></a>01656       <span class="comment">// the last interrupted guy!</span>
<a name="l01657"></a>01657       <span class="comment">/*</span>
<a name="l01658"></a>01658 <span class="comment">      if (Status.lastInterruptedWas == ubID)</span>
<a name="l01659"></a>01659 <span class="comment">      {</span>
<a name="l01660"></a>01660 <span class="comment">            Status.lastInterruptedWas = NOBODY;</span>
<a name="l01661"></a>01661 <span class="comment">      }</span>
<a name="l01662"></a>01662 <span class="comment">      */</span>
<a name="l01663"></a>01663 }
<a name="l01664"></a>01664 
<a name="l01665"></a><a class="code" href="TeamTurns_8h.html#912a969190e42955b409706d3f843495">01665</a> <span class="keywordtype">void</span> <a class="code" href="TeamTurns_8cpp.html#912a969190e42955b409706d3f843495">AddToIntList</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubID, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fGainControl, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fCommunicate )
<a name="l01666"></a>01666 {
<a name="l01667"></a>01667       DebugMsg (TOPIC_JA2,DBG_LEVEL_3,<span class="stringliteral">"AddToIntList"</span>);
<a name="l01668"></a>01668       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubLoop;
<a name="l01669"></a>01669 
<a name="l01670"></a>01670 <span class="comment">//    ScreenMsg( FONT_MCOLOR_LTYELLOW, MSG_INTERFACE, L"%d added to int list", ubID );</span>
<a name="l01671"></a>01671       DebugMsg( TOPIC_JA2, DBG_LEVEL_3, <a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>(<span class="stringliteral">"INTERRUPT: adding ID %d who %s"</span>, ubID, fGainControl ? <span class="stringliteral">"gains control"</span> : <span class="stringliteral">"loses control"</span> ) );
<a name="l01672"></a>01672       
<a name="l01673"></a>01673       <span class="comment">// check whether 'who' is already anywhere on the queue after the first index</span>
<a name="l01674"></a>01674       <span class="comment">// which we want to preserve so we can restore turn order</span>
<a name="l01675"></a>01675       <span class="keywordflow">for</span> (ubLoop = 2; ubLoop &lt;= <a class="code" href="TeamTurns_8cpp.html#bba49c23835b863c536a9796e4461183">gubOutOfTurnPersons</a>; ubLoop++)
<a name="l01676"></a>01676       {
<a name="l01677"></a>01677             <span class="keywordflow">if</span> (<a class="code" href="TeamTurns_8cpp.html#8f8bdbac1eb4174dfb142fd50f762004">gubOutOfTurnOrder</a>[ubLoop] == ubID)
<a name="l01678"></a>01678             {
<a name="l01679"></a>01679                   <span class="keywordflow">if</span> (!fGainControl)
<a name="l01680"></a>01680                   {
<a name="l01681"></a>01681                         <span class="comment">// he's LOSING control; that's it, we're done, DON'T add him to the queue again</span>
<a name="l01682"></a>01682                         <a class="code" href="TeamTurns_8cpp.html#3ff1395df97489a5417b119827e89eb8">gubLastInterruptedGuy</a> = ubID;
<a name="l01683"></a>01683                         <span class="keywordflow">return</span>;
<a name="l01684"></a>01684                   }
<a name="l01685"></a>01685                   <span class="keywordflow">else</span>
<a name="l01686"></a>01686                   {
<a name="l01687"></a>01687                         <span class="comment">// GAINING control, so delete him from this slot (because later he'll</span>
<a name="l01688"></a>01688                         <span class="comment">// get added to the end and we don't want him listed more than once!)</span>
<a name="l01689"></a>01689                         <a class="code" href="TeamTurns_8cpp.html#9318a9ca429d8a866d11f101bffafd60">DeleteFromIntList</a>( ubLoop, FALSE ); 
<a name="l01690"></a>01690                   }
<a name="l01691"></a>01691             }
<a name="l01692"></a>01692       }
<a name="l01693"></a>01693 
<a name="l01694"></a>01694       <span class="comment">// increment total (making index valid) and add him to list</span>
<a name="l01695"></a>01695       <a class="code" href="TeamTurns_8cpp.html#bba49c23835b863c536a9796e4461183">gubOutOfTurnPersons</a>++;
<a name="l01696"></a>01696       <a class="code" href="TeamTurns_8cpp.html#8f8bdbac1eb4174dfb142fd50f762004">gubOutOfTurnOrder</a>[<a class="code" href="TeamTurns_8cpp.html#bba49c23835b863c536a9796e4461183">gubOutOfTurnPersons</a>] = ubID;
<a name="l01697"></a>01697 
<a name="l01698"></a>01698 <span class="comment">/*</span>
<a name="l01699"></a>01699 <span class="comment">      // the guy being interrupted HAS to be the currently selected character</span>
<a name="l01700"></a>01700 <span class="comment">      if (Status.lastInterruptedWas != CharacterSelected)</span>
<a name="l01701"></a>01701 <span class="comment">      {</span>
<a name="l01702"></a>01702 <span class="comment">            // if we don't already do so, remember who that was</span>
<a name="l01703"></a>01703 <span class="comment">            Status.lastInterruptedWas = CharacterSelected;</span>
<a name="l01704"></a>01704 <span class="comment">      }</span>
<a name="l01705"></a>01705 <span class="comment">*/</span>
<a name="l01706"></a>01706 
<a name="l01707"></a>01707       <span class="comment">// if the guy is gaining control</span>
<a name="l01708"></a>01708       <span class="keywordflow">if</span> (fGainControl)
<a name="l01709"></a>01709       {
<a name="l01710"></a>01710             <span class="comment">// record his initial APs at the start of his interrupt at this time</span>
<a name="l01711"></a>01711             <span class="comment">// this is not the ideal place for this, but it's the best I could do...</span>
<a name="l01712"></a>01712             <a class="code" href="Overhead_8cpp.html#f1785e87ea281d015350ec85b9bd8508">Menptr</a>[ubID].<a class="code" href="structSOLDIERTYPE.html#4e5e7dac2b77d4437e75c319a20f0872">bIntStartAPs</a> = <a class="code" href="Overhead_8cpp.html#f1785e87ea281d015350ec85b9bd8508">Menptr</a>[ubID].<a class="code" href="structSOLDIERTYPE.html#080980e5fe705dcea5c819b05aef6f21">bActionPoints</a>;
<a name="l01713"></a>01713       }
<a name="l01714"></a>01714       <span class="keywordflow">else</span>
<a name="l01715"></a>01715       {
<a name="l01716"></a>01716             <a class="code" href="TeamTurns_8cpp.html#3ff1395df97489a5417b119827e89eb8">gubLastInterruptedGuy</a> = ubID;
<a name="l01717"></a>01717             <span class="comment">// turn off AI control flag if they lost control</span>
<a name="l01718"></a>01718             <span class="keywordflow">if</span> (<a class="code" href="Overhead_8cpp.html#f1785e87ea281d015350ec85b9bd8508">Menptr</a>[ubID].uiStatusFlags &amp; SOLDIER_UNDERAICONTROL)
<a name="l01719"></a>01719             {
<a name="l01720"></a>01720                   <a class="code" href="ai_8h.html#67640c28ffcaa1eb59c6780ea4bb2e23">DebugAI</a>( (<a class="code" href="Types_8h.html#ba0652aa53ceb4404f77e13a0c993b0e">STR</a>)<a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>( <span class="stringliteral">"Taking away AI control from %d"</span>, ubID ) );
<a name="l01721"></a>01721                   <a class="code" href="Overhead_8cpp.html#f1785e87ea281d015350ec85b9bd8508">Menptr</a>[ubID].<a class="code" href="structSOLDIERTYPE.html#eb633099940bc20ff5a969bce84eab42">uiStatusFlags</a> &amp;= (~SOLDIER_UNDERAICONTROL);
<a name="l01722"></a>01722             }
<a name="l01723"></a>01723       }
<a name="l01724"></a>01724 }
<a name="l01725"></a>01725 
<a name="l01726"></a><a class="code" href="TeamTurns_8cpp.html#f3d6601d445481eb74690c91be0447ca">01726</a> <span class="keywordtype">void</span> <a class="code" href="TeamTurns_8cpp.html#f3d6601d445481eb74690c91be0447ca">VerifyOutOfTurnOrderArray</a>()
<a name="l01727"></a>01727 {
<a name="l01728"></a>01728       DebugMsg (TOPIC_JA2,DBG_LEVEL_3,<span class="stringliteral">"VerifyOutOfTurnOrderArray"</span>);
<a name="l01729"></a>01729       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>       ubTeamHighest[ MAXTEAMS ] = { 0 };
<a name="l01730"></a>01730       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>       ubTeamsInList;
<a name="l01731"></a>01731       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>       ubNextInArrayOnTeam, ubNextIndex;
<a name="l01732"></a>01732       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>       ubTeam;
<a name="l01733"></a>01733       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>       ubLoop, ubLoop2;
<a name="l01734"></a>01734       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a>     fFoundLoop = FALSE;
<a name="l01735"></a>01735 
<a name="l01736"></a>01736       <span class="keywordflow">for</span> (ubLoop = 1; ubLoop &lt;= <a class="code" href="TeamTurns_8cpp.html#bba49c23835b863c536a9796e4461183">gubOutOfTurnPersons</a>; ubLoop++)
<a name="l01737"></a>01737       {
<a name="l01738"></a>01738             ubTeam = <a class="code" href="Overhead_8cpp.html#f1785e87ea281d015350ec85b9bd8508">Menptr</a>[ <a class="code" href="TeamTurns_8cpp.html#8f8bdbac1eb4174dfb142fd50f762004">gubOutOfTurnOrder</a>[ ubLoop ] ].bTeam;
<a name="l01739"></a>01739             <span class="keywordflow">if</span> (ubTeamHighest[ ubTeam ] &gt; 0)
<a name="l01740"></a>01740             {
<a name="l01741"></a>01741                   <span class="comment">// check the other teams to see if any of them are between our last team's mention in</span>
<a name="l01742"></a>01742                   <span class="comment">// the array and this</span>
<a name="l01743"></a>01743                   <span class="keywordflow">for</span> (ubLoop2 = 0; ubLoop2 &lt; MAXTEAMS; ubLoop2++)
<a name="l01744"></a>01744                   {
<a name="l01745"></a>01745                         <span class="keywordflow">if</span> (ubLoop2 == ubTeam)
<a name="l01746"></a>01746                         {
<a name="l01747"></a>01747                               <span class="keywordflow">continue</span>;
<a name="l01748"></a>01748                         }
<a name="l01749"></a>01749                         <span class="keywordflow">else</span>
<a name="l01750"></a>01750                         {
<a name="l01751"></a>01751                               <span class="keywordflow">if</span> (ubTeamHighest[ ubLoop2 ] &gt; ubTeamHighest[ ubTeam ])
<a name="l01752"></a>01752                               {
<a name="l01753"></a>01753                                     <span class="comment">// there's a loop!! delete it!</span>
<a name="l01754"></a>01754                                     ubNextInArrayOnTeam = <a class="code" href="TeamTurns_8cpp.html#8f8bdbac1eb4174dfb142fd50f762004">gubOutOfTurnOrder</a>[ ubLoop ];
<a name="l01755"></a>01755                                     ubNextIndex = ubTeamHighest[ ubTeam ] + 1;
<a name="l01756"></a>01756 
<a name="l01757"></a>01757                                     <span class="keywordflow">while</span>( <a class="code" href="TeamTurns_8cpp.html#8f8bdbac1eb4174dfb142fd50f762004">gubOutOfTurnOrder</a>[ ubNextIndex ] != ubNextInArrayOnTeam )
<a name="l01758"></a>01758                                     {
<a name="l01759"></a>01759                                           <span class="comment">// Pause them...</span>
<a name="l01760"></a>01760                                           <a class="code" href="Soldier_01Control_8cpp.html#11fd19e17adc39731d2b3688a028a833">AdjustNoAPToFinishMove</a>( <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ <a class="code" href="TeamTurns_8cpp.html#8f8bdbac1eb4174dfb142fd50f762004">gubOutOfTurnOrder</a>[ ubNextIndex ] ], TRUE );
<a name="l01761"></a>01761 
<a name="l01762"></a>01762                                           <span class="comment">// If they were turning from prone, stop them</span>
<a name="l01763"></a>01763                                           <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ <a class="code" href="TeamTurns_8cpp.html#8f8bdbac1eb4174dfb142fd50f762004">gubOutOfTurnOrder</a>[ ubNextIndex ] ]-&gt;<a class="code" href="structSOLDIERTYPE.html#3a52d1286affb8bb63c00d01e805267c">fTurningFromPronePosition</a> = FALSE;
<a name="l01764"></a>01764 
<a name="l01765"></a>01765                                           <a class="code" href="TeamTurns_8cpp.html#9318a9ca429d8a866d11f101bffafd60">DeleteFromIntList</a>( ubNextIndex, FALSE );
<a name="l01766"></a>01766                                     }
<a name="l01767"></a>01767 
<a name="l01768"></a>01768                                     fFoundLoop = TRUE;
<a name="l01769"></a>01769                                     <span class="keywordflow">break</span>;
<a name="l01770"></a>01770                               }
<a name="l01771"></a>01771                         }
<a name="l01772"></a>01772                   }
<a name="l01773"></a>01773 
<a name="l01774"></a>01774                   <span class="keywordflow">if</span> (fFoundLoop)
<a name="l01775"></a>01775                   {
<a name="l01776"></a>01776                         <span class="comment">// at this point we should restart our outside loop (ugh)</span>
<a name="l01777"></a>01777                         fFoundLoop = FALSE;
<a name="l01778"></a>01778                         <span class="keywordflow">for</span> (ubLoop2 = 0; ubLoop2 &lt; MAXTEAMS; ubLoop2++)
<a name="l01779"></a>01779                         {
<a name="l01780"></a>01780                               ubTeamHighest[ ubLoop2 ] = 0;
<a name="l01781"></a>01781                         }
<a name="l01782"></a>01782                         ubLoop = 0;
<a name="l01783"></a>01783                         <span class="keywordflow">continue</span>;
<a name="l01784"></a>01784 
<a name="l01785"></a>01785                   }
<a name="l01786"></a>01786 
<a name="l01787"></a>01787             }
<a name="l01788"></a>01788 
<a name="l01789"></a>01789             ubTeamHighest[ ubTeam ] = ubLoop;
<a name="l01790"></a>01790       }
<a name="l01791"></a>01791 
<a name="l01792"></a>01792       <span class="comment">// Another potential problem: the player is interrupted by the enemy who is interrupted by </span>
<a name="l01793"></a>01793       <span class="comment">// the militia.  In this situation the enemy should just lose their interrupt.</span>
<a name="l01794"></a>01794       <span class="comment">// (Or, the militia is interrupted by the enemy who is interrupted by the player.)</span>
<a name="l01795"></a>01795       
<a name="l01796"></a>01796       <span class="comment">// Check for 3+ teams in the interrupt queue.  If three exist then abort all interrupts (return</span>
<a name="l01797"></a>01797       <span class="comment">// control to the first team)</span>
<a name="l01798"></a>01798       ubTeamsInList = 0;
<a name="l01799"></a>01799       <span class="keywordflow">for</span> ( ubLoop = 0; ubLoop &lt; MAXTEAMS; ubLoop++ )
<a name="l01800"></a>01800       {
<a name="l01801"></a>01801             <span class="keywordflow">if</span> ( ubTeamHighest[ ubLoop ] &gt; 0 )
<a name="l01802"></a>01802             {
<a name="l01803"></a>01803                   ubTeamsInList++;
<a name="l01804"></a>01804             }
<a name="l01805"></a>01805       }
<a name="l01806"></a>01806       <span class="keywordflow">if</span> ( ubTeamsInList &gt;= 3 )
<a name="l01807"></a>01807       {
<a name="l01808"></a>01808             <span class="comment">// This is bad.  Loop through everyone but the first person in the INT list and remove 'em</span>
<a name="l01809"></a>01809             <span class="keywordflow">for</span> (ubLoop = 2; ubLoop &lt;= <a class="code" href="TeamTurns_8cpp.html#bba49c23835b863c536a9796e4461183">gubOutOfTurnPersons</a>; )
<a name="l01810"></a>01810             {
<a name="l01811"></a>01811                   <span class="keywordflow">if</span> ( <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ <a class="code" href="TeamTurns_8cpp.html#8f8bdbac1eb4174dfb142fd50f762004">gubOutOfTurnOrder</a>[ ubLoop ] ]-&gt;bTeam != <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ <a class="code" href="TeamTurns_8cpp.html#8f8bdbac1eb4174dfb142fd50f762004">gubOutOfTurnOrder</a>[ 1 ] ]-&gt;bTeam )
<a name="l01812"></a>01812                   {
<a name="l01813"></a>01813                         <span class="comment">// remove!</span>
<a name="l01814"></a>01814 
<a name="l01815"></a>01815                         <span class="comment">// Pause them...</span>
<a name="l01816"></a>01816                         <a class="code" href="Soldier_01Control_8cpp.html#11fd19e17adc39731d2b3688a028a833">AdjustNoAPToFinishMove</a>( <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ <a class="code" href="TeamTurns_8cpp.html#8f8bdbac1eb4174dfb142fd50f762004">gubOutOfTurnOrder</a>[ ubLoop ] ], TRUE );
<a name="l01817"></a>01817 
<a name="l01818"></a>01818                         <span class="comment">// If they were turning from prone, stop them</span>
<a name="l01819"></a>01819                         <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ <a class="code" href="TeamTurns_8cpp.html#8f8bdbac1eb4174dfb142fd50f762004">gubOutOfTurnOrder</a>[ ubLoop ] ]-&gt;<a class="code" href="structSOLDIERTYPE.html#3a52d1286affb8bb63c00d01e805267c">fTurningFromPronePosition</a> = FALSE;
<a name="l01820"></a>01820 
<a name="l01821"></a>01821                         <a class="code" href="TeamTurns_8cpp.html#9318a9ca429d8a866d11f101bffafd60">DeleteFromIntList</a>( ubLoop, FALSE );
<a name="l01822"></a>01822 
<a name="l01823"></a>01823                         <span class="comment">// since we deleted someone from the list, we want to check the same index in the</span>
<a name="l01824"></a>01824                         <span class="comment">// array again, hence we DON'T increment.</span>
<a name="l01825"></a>01825                   }
<a name="l01826"></a>01826                   <span class="keywordflow">else</span>
<a name="l01827"></a>01827                   {
<a name="l01828"></a>01828                         ubLoop++;
<a name="l01829"></a>01829                   }
<a name="l01830"></a>01830             }
<a name="l01831"></a>01831       }
<a name="l01832"></a>01832 
<a name="l01833"></a>01833 }
<a name="l01834"></a>01834 
<a name="l01835"></a><a class="code" href="TeamTurns_8h.html#244ee03900fb7c5b2f5c1f285916756b">01835</a> <span class="keywordtype">void</span> <a class="code" href="TeamTurns_8cpp.html#244ee03900fb7c5b2f5c1f285916756b">DoneAddingToIntList</a>( <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> * <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fChange, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubInterruptType)
<a name="l01836"></a>01836 {
<a name="l01837"></a>01837       DebugMsg (TOPIC_JA2,DBG_LEVEL_3,<span class="stringliteral">"DoneAddingToIntList"</span>);
<a name="l01838"></a>01838       <span class="keywordflow">if</span> (fChange)
<a name="l01839"></a>01839       {
<a name="l01840"></a>01840             <a class="code" href="TeamTurns_8cpp.html#f3d6601d445481eb74690c91be0447ca">VerifyOutOfTurnOrderArray</a>();
<a name="l01841"></a>01841             <span class="keywordflow">if</span> ( <a class="code" href="TeamTurns_8cpp.html#624e3dd003e482573366a5527d11aa84">EveryoneInInterruptListOnSameTeam</a>() )
<a name="l01842"></a>01842             {
<a name="l01843"></a>01843                   <a class="code" href="TeamTurns_8cpp.html#a41b1e4ef95bdf5732f5e41fa257864b">EndInterrupt</a>( TRUE );
<a name="l01844"></a>01844             }
<a name="l01845"></a>01845             <span class="keywordflow">else</span>
<a name="l01846"></a>01846             {
<a name="l01847"></a>01847                   <a class="code" href="TeamTurns_8cpp.html#23696bb3b808ce3a04abab4deb7f2ce7">StartInterrupt</a>();
<a name="l01848"></a>01848             }
<a name="l01849"></a>01849       }
<a name="l01850"></a>01850 }
<a name="l01851"></a>01851 
<a name="l01852"></a><a class="code" href="TeamTurns_8cpp.html#70892a8050821eb3da3163d00c09dc40">01852</a> <span class="keywordtype">void</span> <a class="code" href="opplist_8h.html#70892a8050821eb3da3163d00c09dc40">ResolveInterruptsVs</a>( <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> * <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubInterruptType)
<a name="l01853"></a>01853 {
<a name="l01854"></a>01854       DebugMsg (TOPIC_JA2,DBG_LEVEL_3,<a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>(<span class="stringliteral">"ResolveInterruptsVs: Soldier ID = %d, APs = %d"</span>,<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#18aef170576da81b10d00e7b6cd3627b">ubID</a>,<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#080980e5fe705dcea5c819b05aef6f21">bActionPoints</a>));
<a name="l01855"></a>01855       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubTeam, ubOpp;
<a name="l01856"></a>01856       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubIntCnt;
<a name="l01857"></a>01857       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubIntList[MAXMERCS];
<a name="l01858"></a>01858       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubIntDiff[MAXMERCS];
<a name="l01859"></a>01859       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubSmallestDiff;
<a name="l01860"></a>01860       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubSlot, ubSmallestSlot;
<a name="l01861"></a>01861       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubLoop;
<a name="l01862"></a>01862       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fIntOccurs;
<a name="l01863"></a>01863       <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> * pOpponent;
<a name="l01864"></a>01864       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fControlChanged = FALSE;
<a name="l01865"></a>01865 
<a name="l01866"></a>01866       <span class="keywordflow">if</span> ( (<a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#89eb954f99ad4f28b84d7cf675c8ed32">uiFlags</a> &amp; TURNBASED) &amp;&amp; (<a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#89eb954f99ad4f28b84d7cf675c8ed32">uiFlags</a> &amp; INCOMBAT) )
<a name="l01867"></a>01867       {
<a name="l01868"></a>01868             ubIntCnt = 0;
<a name="l01869"></a>01869 
<a name="l01870"></a>01870             <span class="keywordflow">for</span> (ubTeam = 0; ubTeam &lt; MAXTEAMS; ubTeam++)
<a name="l01871"></a>01871             {
<a name="l01872"></a>01872                   <span class="keywordflow">if</span> (<a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#2ecddfe580bb019bc92cc4859eaf3edc">Team</a>[ubTeam].<a class="code" href="structTacticalTeamType.html#5e2ed425f613a7996ba1a0cd2cbaf050">bTeamActive</a> &amp;&amp; (<a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#2ecddfe580bb019bc92cc4859eaf3edc">Team</a>[ubTeam].<a class="code" href="structTacticalTeamType.html#ae2dc80f36a253171cbe752592926683">bSide</a> != <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#1e61c0006bacccf9457c3f6c43607578">bSide</a>) &amp;&amp; ubTeam != CIV_TEAM)
<a name="l01873"></a>01873                   {
<a name="l01874"></a>01874                         for ( ubOpp = <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#2ecddfe580bb019bc92cc4859eaf3edc">Team</a>[ ubTeam ].<a class="code" href="structTacticalTeamType.html#f8fe819ad07b242f5dbf97fd4c69b00d">bFirstID</a>; ubOpp &lt;= <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#2ecddfe580bb019bc92cc4859eaf3edc">Team</a>[ ubTeam ].<a class="code" href="structTacticalTeamType.html#6a887279dad735dc302f21c1e559d5ce">bLastID</a>; ubOpp++)
<a name="l01875"></a>01875                         {
<a name="l01876"></a>01876                               pOpponent = <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ubOpp];
<a name="l01877"></a>01877                               <a class="code" href="Soldier_01Ani_8cpp.html#c294aa65f0375eb6343a2de2a25dafcc">if</a> ( pOpponent-&gt;<a class="code" href="structSOLDIERTYPE.html#653dad4e2520784e293eca9f948b8532">bActive</a> &amp;&amp; pOpponent-&gt;<a class="code" href="structSOLDIERTYPE.html#b0096f321a0de4f0617283f7b3212aa0">bInSector</a> &amp;&amp; (pOpponent-&gt;<a class="code" href="structSOLDIERTYPE.html#e308dea18533bf5ab2bcee5bbe27391c">bLife</a> &gt;= OKLIFE) &amp;&amp; !(pOpponent-&gt;<a class="code" href="structSOLDIERTYPE.html#e7deba64e58676518e5d31bb7657da01">bCollapsed</a>) )
<a name="l01878"></a>01878                               {
<a name="l01879"></a>01879                                     <a class="code" href="Soldier_01Ani_8cpp.html#c294aa65f0375eb6343a2de2a25dafcc">if</a> ( ubInterruptType == NOISEINTERRUPT )
<a name="l01880"></a>01880                                     {
<a name="l01881"></a>01881                                           <span class="comment">// don't grant noise interrupts at greater than max. visible distance </span>
<a name="l01882"></a>01882                                           <span class="keywordflow">if</span> ( <a class="code" href="Isometric_01Utils_8cpp.html#a9c80c0c7523c83360aeb6b46963780b">PythSpacesAway</a>( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#2ab66ee0f37902cd448f4a738df4f2bf">sGridNo</a>, pOpponent-&gt;<a class="code" href="structSOLDIERTYPE.html#2ab66ee0f37902cd448f4a738df4f2bf">sGridNo</a> ) &gt; <a class="code" href="opplist_8cpp.html#ce89c9f1017d9a6e473df03acb6f1a2a">MaxDistanceVisible</a>() )
<a name="l01883"></a>01883                                           {
<a name="l01884"></a>01884                                                 pOpponent-&gt;<a class="code" href="structSOLDIERTYPE.html#041daf8c77b17f894fc6b20b3d1d289b">bInterruptDuelPts</a> = NO_INTERRUPT;
<a name="l01885"></a>01885 
<a name="l01886"></a>01886                                                 DebugMsg( TOPIC_JA2, DBG_LEVEL_3, <a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>(<span class="stringliteral">"Resetting int pts for %d - NOISE BEYOND SIGHT DISTANCE!?"</span>, pOpponent-&gt;<a class="code" href="structSOLDIERTYPE.html#18aef170576da81b10d00e7b6cd3627b">ubID</a> ) );
<a name="l01887"></a>01887 
<a name="l01888"></a>01888                                                 <span class="keywordflow">continue</span>;
<a name="l01889"></a>01889                                           }
<a name="l01890"></a>01890                                     }
<a name="l01891"></a>01891                                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( pOpponent-&gt;<a class="code" href="structSOLDIERTYPE.html#d0a0bdddaeb7bbea617b4294b539ef32">bOppList</a>[<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#18aef170576da81b10d00e7b6cd3627b">ubID</a>] != SEEN_CURRENTLY )
<a name="l01892"></a>01892                                     {
<a name="l01893"></a>01893                                           pOpponent-&gt;<a class="code" href="structSOLDIERTYPE.html#041daf8c77b17f894fc6b20b3d1d289b">bInterruptDuelPts</a> = NO_INTERRUPT;
<a name="l01894"></a>01894 
<a name="l01895"></a>01895                                           DebugMsg( TOPIC_JA2, DBG_LEVEL_3, <a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>(<span class="stringliteral">"Resetting int pts for %d - DOESN'T SEE ON SIGHT INTERRUPT!?"</span>, pOpponent-&gt;<a class="code" href="structSOLDIERTYPE.html#18aef170576da81b10d00e7b6cd3627b">ubID</a> ) );
<a name="l01896"></a>01896 
<a name="l01897"></a>01897 
<a name="l01898"></a>01898                                           <span class="keywordflow">continue</span>;
<a name="l01899"></a>01899                                     }
<a name="l01900"></a>01900 
<a name="l01901"></a>01901                                     <span class="keywordflow">switch</span> (pOpponent-&gt;<a class="code" href="structSOLDIERTYPE.html#041daf8c77b17f894fc6b20b3d1d289b">bInterruptDuelPts</a>)
<a name="l01902"></a>01902                                     {
<a name="l01903"></a>01903                                           <span class="keywordflow">case</span> NO_INTERRUPT:            <span class="comment">// no interrupt possible, no duel necessary</span>
<a name="l01904"></a>01904                                                 DebugMsg( TOPIC_JA2, DBG_LEVEL_3, <a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>(<span class="stringliteral">"ResolveInterruptsVs: No interrupt for opponent %d"</span>, pOpponent-&gt;<a class="code" href="structSOLDIERTYPE.html#18aef170576da81b10d00e7b6cd3627b">ubID</a> ) );
<a name="l01905"></a>01905                                                 fIntOccurs = FALSE;
<a name="l01906"></a>01906                                                 <span class="keywordflow">break</span>;
<a name="l01907"></a>01907 
<a name="l01908"></a>01908                                           <span class="keywordflow">case</span> AUTOMATIC_INTERRUPT:     <span class="comment">// interrupts occurs automatically</span>
<a name="l01909"></a>01909                                                 <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#041daf8c77b17f894fc6b20b3d1d289b">bInterruptDuelPts</a> = 0;    <span class="comment">// just to have a valid intDiff later</span>
<a name="l01910"></a>01910                                                 fIntOccurs = TRUE;
<a name="l01911"></a>01911 
<a name="l01912"></a>01912                                                 DebugMsg( TOPIC_JA2, DBG_LEVEL_3, <a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>(<span class="stringliteral">"INTERRUPT: automatic interrupt on %d by %d"</span>, <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#18aef170576da81b10d00e7b6cd3627b">ubID</a>, pOpponent-&gt;<a class="code" href="structSOLDIERTYPE.html#18aef170576da81b10d00e7b6cd3627b">ubID</a> ) );
<a name="l01913"></a>01913 
<a name="l01914"></a>01914                                                 <span class="keywordflow">break</span>;
<a name="l01915"></a>01915 
<a name="l01916"></a>01916                                           <span class="keywordflow">default</span>:          <span class="comment">// interrupt is possible, run a duel</span>
<a name="l01917"></a>01917                                                 DebugMsg( TOPIC_JA2, DBG_LEVEL_3, <span class="stringliteral">"Calculating int duel pts for onlooker in ResolveInterruptsVs"</span> );
<a name="l01918"></a>01918                                                 <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#041daf8c77b17f894fc6b20b3d1d289b">bInterruptDuelPts</a> = <a class="code" href="TeamTurns_8cpp.html#45f9de4f8220ae8a1fc7ce7d059e38ef">CalcInterruptDuelPts</a>(<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>,pOpponent-&gt;<a class="code" href="structSOLDIERTYPE.html#18aef170576da81b10d00e7b6cd3627b">ubID</a>,TRUE);
<a name="l01919"></a>01919                                                 fIntOccurs = <a class="code" href="TeamTurns_8cpp.html#0b4e0cde0186bbb931b9205b7055d762">InterruptDuel</a>(pOpponent,<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>);
<a name="l01920"></a>01920 <span class="preprocessor">                                                #ifdef DEBUG_INTERRUPTS</span>
<a name="l01921"></a>01921 <span class="preprocessor"></span>                                                <span class="keywordflow">if</span> (fIntOccurs)
<a name="l01922"></a>01922                                                 {
<a name="l01923"></a>01923                                                       DebugMsg( TOPIC_JA2, DBG_LEVEL_3, <a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>(<span class="stringliteral">"INTERRUPT: standard interrupt on %d (%d pts) by %d (%d pts)"</span>, <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#18aef170576da81b10d00e7b6cd3627b">ubID</a>, <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#041daf8c77b17f894fc6b20b3d1d289b">bInterruptDuelPts</a>, pOpponent-&gt;<a class="code" href="structSOLDIERTYPE.html#18aef170576da81b10d00e7b6cd3627b">ubID</a>, pOpponent-&gt;<a class="code" href="structSOLDIERTYPE.html#041daf8c77b17f894fc6b20b3d1d289b">bInterruptDuelPts</a>) );
<a name="l01924"></a>01924                                                 }
<a name="l01925"></a>01925 <span class="preprocessor">                                                #endif</span>
<a name="l01926"></a>01926 <span class="preprocessor"></span>
<a name="l01927"></a>01927                                                 <span class="keywordflow">break</span>;
<a name="l01928"></a>01928                                     }
<a name="l01929"></a>01929 
<a name="l01930"></a>01930                                     <span class="keywordflow">if</span> (fIntOccurs)
<a name="l01931"></a>01931                                     {
<a name="l01932"></a>01932                                           <span class="comment">// remember that this opponent's scheduled to interrupt us</span>
<a name="l01933"></a>01933                                           ubIntList[ubIntCnt] = pOpponent-&gt;<a class="code" href="structSOLDIERTYPE.html#18aef170576da81b10d00e7b6cd3627b">ubID</a>;
<a name="l01934"></a>01934 
<a name="l01935"></a>01935                                           <span class="comment">// and by how much he beat us in the duel</span>
<a name="l01936"></a>01936                                           ubIntDiff[ubIntCnt] = pOpponent-&gt;<a class="code" href="structSOLDIERTYPE.html#041daf8c77b17f894fc6b20b3d1d289b">bInterruptDuelPts</a> - <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#041daf8c77b17f894fc6b20b3d1d289b">bInterruptDuelPts</a>;
<a name="l01937"></a>01937 
<a name="l01938"></a>01938                                           <span class="comment">// increment counter of interrupts lost</span>
<a name="l01939"></a>01939                                           ubIntCnt++;
<a name="l01940"></a>01940                                     }
<a name="l01941"></a>01941                                     <span class="keywordflow">else</span>
<a name="l01942"></a>01942                                     {
<a name="l01943"></a>01943                                     <span class="comment">/*</span>
<a name="l01944"></a>01944 <span class="comment">                                          if (pOpponent-&gt;bInterruptDuelPts != NO_INTERRUPT)</span>
<a name="l01945"></a>01945 <span class="comment">                                          {</span>
<a name="l01946"></a>01946 <span class="comment">                                                ScreenMsg( FONT_MCOLOR_LTYELLOW, MSG_INTERFACE, L"%d fails to interrupt %d (%d vs %d pts)", pOpponent-&gt;ubID, pSoldier-&gt;ubID, pOpponent-&gt;bInterruptDuelPts, pSoldier-&gt;bInterruptDuelPts);</span>
<a name="l01947"></a>01947 <span class="comment">                                          }</span>
<a name="l01948"></a>01948 <span class="comment">                                          */</span>
<a name="l01949"></a>01949                                     }
<a name="l01950"></a>01950 
<a name="l01951"></a>01951                                     <span class="comment">// either way, clear out both sides' bInterruptDuelPts field to prepare next one</span>
<a name="l01952"></a>01952 
<a name="l01953"></a>01953                                     <span class="keywordflow">if</span> (<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#041daf8c77b17f894fc6b20b3d1d289b">bInterruptDuelPts</a> != NO_INTERRUPT)
<a name="l01954"></a>01954                                     {
<a name="l01955"></a>01955                                           DebugMsg( TOPIC_JA2, DBG_LEVEL_3, <a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>(<span class="stringliteral">"Resetting int pts for %d"</span>, <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#18aef170576da81b10d00e7b6cd3627b">ubID</a> ) );
<a name="l01956"></a>01956                                     }
<a name="l01957"></a>01957 
<a name="l01958"></a>01958 
<a name="l01959"></a>01959                                     <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#041daf8c77b17f894fc6b20b3d1d289b">bInterruptDuelPts</a> = NO_INTERRUPT;
<a name="l01960"></a>01960 
<a name="l01961"></a>01961 
<a name="l01962"></a>01962                                     <span class="keywordflow">if</span> (pOpponent-&gt;<a class="code" href="structSOLDIERTYPE.html#041daf8c77b17f894fc6b20b3d1d289b">bInterruptDuelPts</a> != NO_INTERRUPT)
<a name="l01963"></a>01963                                     {
<a name="l01964"></a>01964                                           DebugMsg( TOPIC_JA2, DBG_LEVEL_3, <a class="code" href="DEBUG_8cpp.html#88565bf27eec0b2003eb5bc9426b8e4b">String</a>(<span class="stringliteral">"Resetting int pts for %d"</span>, pOpponent-&gt;<a class="code" href="structSOLDIERTYPE.html#18aef170576da81b10d00e7b6cd3627b">ubID</a> ) );
<a name="l01965"></a>01965                                     }
<a name="l01966"></a>01966 
<a name="l01967"></a>01967                                     pOpponent-&gt;<a class="code" href="structSOLDIERTYPE.html#041daf8c77b17f894fc6b20b3d1d289b">bInterruptDuelPts</a> = NO_INTERRUPT;
<a name="l01968"></a>01968 
<a name="l01969"></a>01969                               }
<a name="l01970"></a>01970 
<a name="l01971"></a>01971                         }
<a name="l01972"></a>01972                   }
<a name="l01973"></a>01973             }
<a name="l01974"></a>01974 
<a name="l01975"></a>01975             <span class="comment">// if any interrupts are scheduled to occur (ie. I lost at least once)</span>
<a name="l01976"></a>01976             <span class="keywordflow">if</span> (ubIntCnt)
<a name="l01977"></a>01977             {
<a name="l01978"></a>01978                   <span class="comment">// First add currently active character to the interrupt queue.  This is</span>
<a name="l01979"></a>01979                   <span class="comment">// USUALLY pSoldier-&gt;guynum, but NOT always, because one enemy can</span>
<a name="l01980"></a>01980                   <span class="comment">// "interrupt" on another enemy's turn if he hears another team's wound</span>
<a name="l01981"></a>01981                   <span class="comment">// victim's screaming...  the guy screaming is pSoldier here, it's not his turn!</span>
<a name="l01982"></a>01982                   <span class="comment">//AddToIntList( (UINT8) gusSelectedSoldier, FALSE, TRUE);</span>
<a name="l01983"></a>01983 
<a name="l01984"></a>01984                   <span class="keywordflow">if</span> ( (<a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#d4322ac2c70a18b5aa84c2041e08c9b1">ubCurrentTeam</a> != <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#74a40a8aaf3efe840cdaf6be62556d82">bTeam</a>) &amp;&amp; !(<a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#2ecddfe580bb019bc92cc4859eaf3edc">Team</a>[ <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#d4322ac2c70a18b5aa84c2041e08c9b1">ubCurrentTeam</a> ].bHuman) )
<a name="l01985"></a>01985                   {
<a name="l01986"></a>01986                         <span class="comment">// if anyone on this team is under AI control, remove </span>
<a name="l01987"></a>01987                         <span class="comment">// their AI control flag and put them on the queue instead of this guy</span>
<a name="l01988"></a>01988                         <span class="keywordflow">for</span> ( ubLoop = <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#2ecddfe580bb019bc92cc4859eaf3edc">Team</a>[ <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#d4322ac2c70a18b5aa84c2041e08c9b1">ubCurrentTeam</a> ].bFirstID; ubLoop &lt;= <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#2ecddfe580bb019bc92cc4859eaf3edc">Team</a>[ <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#d4322ac2c70a18b5aa84c2041e08c9b1">ubCurrentTeam</a> ].bLastID; ubLoop++ )
<a name="l01989"></a>01989                         {
<a name="l01990"></a>01990                               <span class="keywordflow">if</span> ( (<a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ ubLoop ]-&gt;uiStatusFlags &amp; SOLDIER_UNDERAICONTROL) )
<a name="l01991"></a>01991                               {
<a name="l01992"></a>01992                                     <span class="comment">// this guy lost control</span>
<a name="l01993"></a>01993                                     <a class="code" href="Overhead_8cpp.html#2b9a828d7d92ec404b2f9a39fc001177">MercPtrs</a>[ ubLoop ]-&gt;<a class="code" href="structSOLDIERTYPE.html#eb633099940bc20ff5a969bce84eab42">uiStatusFlags</a> &amp;= (~SOLDIER_UNDERAICONTROL);
<a name="l01994"></a>01994                                     <a class="code" href="TeamTurns_8cpp.html#912a969190e42955b409706d3f843495">AddToIntList</a>( ubLoop, FALSE, TRUE);
<a name="l01995"></a>01995                                     <span class="keywordflow">break</span>;
<a name="l01996"></a>01996                               }
<a name="l01997"></a>01997                         }
<a name="l01998"></a>01998 
<a name="l01999"></a>01999                   }
<a name="l02000"></a>02000                   <span class="keywordflow">else</span>
<a name="l02001"></a>02001                   {
<a name="l02002"></a>02002                         <span class="comment">// this guy lost control</span>
<a name="l02003"></a>02003                         <a class="code" href="TeamTurns_8cpp.html#912a969190e42955b409706d3f843495">AddToIntList</a>( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#18aef170576da81b10d00e7b6cd3627b">ubID</a>, FALSE, TRUE);
<a name="l02004"></a>02004                   }
<a name="l02005"></a>02005 
<a name="l02006"></a>02006                   <span class="comment">// loop once for each opponent who interrupted</span>
<a name="l02007"></a>02007                   <span class="keywordflow">for</span> (ubLoop = 0; ubLoop &lt; ubIntCnt; ubLoop++)
<a name="l02008"></a>02008                   {
<a name="l02009"></a>02009                         <span class="comment">// find the smallest intDiff still remaining in the list</span>
<a name="l02010"></a>02010                         ubSmallestDiff = NO_INTERRUPT;
<a name="l02011"></a>02011                         ubSmallestSlot = NOBODY;
<a name="l02012"></a>02012 
<a name="l02013"></a>02013                         <span class="keywordflow">for</span> (ubSlot = 0; ubSlot &lt; ubIntCnt; ubSlot++)
<a name="l02014"></a>02014                         {
<a name="l02015"></a>02015                               <span class="keywordflow">if</span> (ubIntDiff[ubSlot] &lt; ubSmallestDiff)
<a name="l02016"></a>02016                               {
<a name="l02017"></a>02017                                     ubSmallestDiff = ubIntDiff[ubSlot];
<a name="l02018"></a>02018                                     ubSmallestSlot = ubSlot;
<a name="l02019"></a>02019                               }
<a name="l02020"></a>02020                         }
<a name="l02021"></a>02021 
<a name="l02022"></a>02022                         <span class="keywordflow">if</span> (ubSmallestSlot &lt; NOBODY)
<a name="l02023"></a>02023                         {
<a name="l02024"></a>02024                               <span class="comment">// add this guy to everyone's interrupt queue</span>
<a name="l02025"></a>02025                               <a class="code" href="TeamTurns_8cpp.html#912a969190e42955b409706d3f843495">AddToIntList</a>(ubIntList[ubSmallestSlot],TRUE,TRUE);
<a name="l02026"></a>02026                               <span class="keywordflow">if</span> (INTERRUPTS_OVER)
<a name="l02027"></a>02027                               {
<a name="l02028"></a>02028                                     <span class="comment">// a loop was created which removed all the people in the interrupt queue!</span>
<a name="l02029"></a>02029                                     <a class="code" href="TeamTurns_8cpp.html#a41b1e4ef95bdf5732f5e41fa257864b">EndInterrupt</a>( TRUE );
<a name="l02030"></a>02030                                     <span class="keywordflow">return</span>;
<a name="l02031"></a>02031                               }
<a name="l02032"></a>02032 
<a name="l02033"></a>02033                               ubIntDiff[ubSmallestSlot] = NO_INTERRUPT;      <span class="comment">// mark slot as been handled</span>
<a name="l02034"></a>02034                         }
<a name="l02035"></a>02035                   }
<a name="l02036"></a>02036 
<a name="l02037"></a>02037                   fControlChanged = TRUE;
<a name="l02038"></a>02038             }
<a name="l02039"></a>02039 
<a name="l02040"></a>02040             <span class="comment">// sends off an end-of-list msg telling everyone whether to switch control,</span>
<a name="l02041"></a>02041             <span class="comment">// unless it's a MOVEMENT interrupt, in which case that is delayed til later</span>
<a name="l02042"></a>02042             <a class="code" href="TeamTurns_8cpp.html#244ee03900fb7c5b2f5c1f285916756b">DoneAddingToIntList</a>(<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>,fControlChanged,ubInterruptType);
<a name="l02043"></a>02043       }
<a name="l02044"></a>02044       DebugMsg (TOPIC_JA2,DBG_LEVEL_3,<span class="stringliteral">"ResolveInterruptsVs done"</span>);
<a name="l02045"></a>02045 }
<a name="l02046"></a>02046 
<a name="l02047"></a>02047 
<a name="l02048"></a><a class="code" href="TeamTurns_8h.html#99f819ab3cc31d2f7a1fe596b7a535af">02048</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a>     <a class="code" href="TeamTurns_8cpp.html#99f819ab3cc31d2f7a1fe596b7a535af">SaveTeamTurnsToTheSaveGameFile</a>( <a class="code" href="LibraryDataBase_8h.html#210e2fc1c18208cbf159ef9c087d6721">HWFILE</a> hFile )
<a name="l02049"></a>02049 {
<a name="l02050"></a>02050       DebugMsg (TOPIC_JA2,DBG_LEVEL_3,<span class="stringliteral">"SaveTeamTurnsToTheSaveGameFile"</span>);
<a name="l02051"></a>02051       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>      uiNumBytesWritten;
<a name="l02052"></a>02052       <a class="code" href="structTEAM__TURN__SAVE__STRUCT.html">TEAM_TURN_SAVE_STRUCT</a> TeamTurnStruct;
<a name="l02053"></a>02053 
<a name="l02054"></a>02054       <span class="comment">//Save the gubTurn Order Array</span>
<a name="l02055"></a>02055       <a class="code" href="FileMan_8cpp.html#09ed41c07d607c8c64a7e2b9fb25660c">FileWrite</a>( hFile, <a class="code" href="TeamTurns_8cpp.html#8f8bdbac1eb4174dfb142fd50f762004">gubOutOfTurnOrder</a>, <span class="keyword">sizeof</span>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ) * MAXMERCS, &amp;uiNumBytesWritten );
<a name="l02056"></a>02056       <span class="keywordflow">if</span>( uiNumBytesWritten != <span class="keyword">sizeof</span>( UINT8 ) * MAXMERCS )
<a name="l02057"></a>02057       {
<a name="l02058"></a>02058             <span class="keywordflow">return</span>( FALSE );
<a name="l02059"></a>02059       }
<a name="l02060"></a>02060 
<a name="l02061"></a>02061 
<a name="l02062"></a>02062       TeamTurnStruct.<a class="code" href="structTEAM__TURN__SAVE__STRUCT.html#26e8c5d2cbba7a326739bc33a21d4721">ubOutOfTurnPersons</a> = <a class="code" href="TeamTurns_8cpp.html#bba49c23835b863c536a9796e4461183">gubOutOfTurnPersons</a>;
<a name="l02063"></a>02063 
<a name="l02064"></a>02064       TeamTurnStruct.<a class="code" href="structTEAM__TURN__SAVE__STRUCT.html#7e022790455a5cc93c12aead6bd471f2">InterruptOnlyGuynum</a> = <a class="code" href="TeamTurns_8cpp.html#42bb4eb822afac8c2e18356981e457ce">InterruptOnlyGuynum</a>;
<a name="l02065"></a>02065       TeamTurnStruct.<a class="code" href="structTEAM__TURN__SAVE__STRUCT.html#f114804ba7c841a3c9bef6b02a35627d">sWhoThrewRock</a> = <a class="code" href="opplist_8cpp.html#d6ad632c68c326aa3e32a911fa48aa18">gsWhoThrewRock</a>;
<a name="l02066"></a>02066       TeamTurnStruct.<a class="code" href="structTEAM__TURN__SAVE__STRUCT.html#e1b125ad72b926896e3c2fea085ad9b3">InterruptsAllowed</a> = <a class="code" href="TeamTurns_8cpp.html#3be147c0d8dcf048dd9d8d9449f45965">InterruptsAllowed</a>;
<a name="l02067"></a>02067       TeamTurnStruct.<a class="code" href="structTEAM__TURN__SAVE__STRUCT.html#437d5bdec5ad3a4ae4b89b7a3b58832f">fHiddenInterrupt</a> = <a class="code" href="TeamTurns_8cpp.html#782955f80e251720a735649d4e8a5987">gfHiddenInterrupt</a>;
<a name="l02068"></a>02068       TeamTurnStruct.<a class="code" href="structTEAM__TURN__SAVE__STRUCT.html#19c8d4364c81044be4ccf334eddf4ae7">ubLastInterruptedGuy</a> = <a class="code" href="TeamTurns_8cpp.html#3ff1395df97489a5417b119827e89eb8">gubLastInterruptedGuy</a>;
<a name="l02069"></a>02069 
<a name="l02070"></a>02070 
<a name="l02071"></a>02071       <span class="comment">//Save the Team turn save structure</span>
<a name="l02072"></a>02072       <a class="code" href="FileMan_8cpp.html#09ed41c07d607c8c64a7e2b9fb25660c">FileWrite</a>( hFile, &amp;TeamTurnStruct, <span class="keyword">sizeof</span>( <a class="code" href="structTEAM__TURN__SAVE__STRUCT.html">TEAM_TURN_SAVE_STRUCT</a> ), &amp;uiNumBytesWritten );
<a name="l02073"></a>02073       <span class="keywordflow">if</span>( uiNumBytesWritten != <span class="keyword">sizeof</span>( TEAM_TURN_SAVE_STRUCT ) )
<a name="l02074"></a>02074       {
<a name="l02075"></a>02075             <span class="keywordflow">return</span>( FALSE );
<a name="l02076"></a>02076       }
<a name="l02077"></a>02077 
<a name="l02078"></a>02078       <span class="keywordflow">return</span>( TRUE );
<a name="l02079"></a>02079 }
<a name="l02080"></a>02080 
<a name="l02081"></a><a class="code" href="TeamTurns_8h.html#11c79f387fd2eddd11fa37f199360f46">02081</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a>     <a class="code" href="TeamTurns_8cpp.html#11c79f387fd2eddd11fa37f199360f46">LoadTeamTurnsFromTheSavedGameFile</a>( <a class="code" href="LibraryDataBase_8h.html#210e2fc1c18208cbf159ef9c087d6721">HWFILE</a> hFile )
<a name="l02082"></a>02082 {
<a name="l02083"></a>02083       DebugMsg (TOPIC_JA2,DBG_LEVEL_3,<span class="stringliteral">"LoadTeamTurnsFromTheSavedGameFile"</span>);
<a name="l02084"></a>02084       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>      uiNumBytesRead;
<a name="l02085"></a>02085       <a class="code" href="structTEAM__TURN__SAVE__STRUCT.html">TEAM_TURN_SAVE_STRUCT</a> TeamTurnStruct;
<a name="l02086"></a>02086 
<a name="l02087"></a>02087       <span class="comment">//Load the gubTurn Order Array</span>
<a name="l02088"></a>02088       <a class="code" href="FileMan_8cpp.html#1b213074411fd4c1dc8fd345e787b17e">FileRead</a>( hFile, <a class="code" href="TeamTurns_8cpp.html#8f8bdbac1eb4174dfb142fd50f762004">gubOutOfTurnOrder</a>, <span class="keyword">sizeof</span>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ) * MAXMERCS, &amp;uiNumBytesRead );
<a name="l02089"></a>02089       <span class="keywordflow">if</span>( uiNumBytesRead != <span class="keyword">sizeof</span>( UINT8 ) * MAXMERCS )
<a name="l02090"></a>02090       {
<a name="l02091"></a>02091             <span class="keywordflow">return</span>( FALSE );
<a name="l02092"></a>02092       }
<a name="l02093"></a>02093 
<a name="l02094"></a>02094 
<a name="l02095"></a>02095       <span class="comment">//Load the Team turn save structure</span>
<a name="l02096"></a>02096       <a class="code" href="FileMan_8cpp.html#1b213074411fd4c1dc8fd345e787b17e">FileRead</a>( hFile, &amp;TeamTurnStruct, <span class="keyword">sizeof</span>( <a class="code" href="structTEAM__TURN__SAVE__STRUCT.html">TEAM_TURN_SAVE_STRUCT</a> ), &amp;uiNumBytesRead );
<a name="l02097"></a>02097       <span class="keywordflow">if</span>( uiNumBytesRead != <span class="keyword">sizeof</span>( TEAM_TURN_SAVE_STRUCT ) )
<a name="l02098"></a>02098       {
<a name="l02099"></a>02099             <span class="keywordflow">return</span>( FALSE );
<a name="l02100"></a>02100       }
<a name="l02101"></a>02101 
<a name="l02102"></a>02102       <a class="code" href="TeamTurns_8cpp.html#bba49c23835b863c536a9796e4461183">gubOutOfTurnPersons</a> = TeamTurnStruct.<a class="code" href="structTEAM__TURN__SAVE__STRUCT.html#26e8c5d2cbba7a326739bc33a21d4721">ubOutOfTurnPersons</a>;
<a name="l02103"></a>02103 
<a name="l02104"></a>02104       <a class="code" href="TeamTurns_8cpp.html#42bb4eb822afac8c2e18356981e457ce">InterruptOnlyGuynum</a> = TeamTurnStruct.<a class="code" href="structTEAM__TURN__SAVE__STRUCT.html#7e022790455a5cc93c12aead6bd471f2">InterruptOnlyGuynum</a>;
<a name="l02105"></a>02105       <a class="code" href="opplist_8cpp.html#d6ad632c68c326aa3e32a911fa48aa18">gsWhoThrewRock</a> = TeamTurnStruct.<a class="code" href="structTEAM__TURN__SAVE__STRUCT.html#f114804ba7c841a3c9bef6b02a35627d">sWhoThrewRock</a>;
<a name="l02106"></a>02106       <a class="code" href="TeamTurns_8cpp.html#3be147c0d8dcf048dd9d8d9449f45965">InterruptsAllowed</a> = TeamTurnStruct.<a class="code" href="structTEAM__TURN__SAVE__STRUCT.html#e1b125ad72b926896e3c2fea085ad9b3">InterruptsAllowed</a>;
<a name="l02107"></a>02107       <a class="code" href="TeamTurns_8cpp.html#782955f80e251720a735649d4e8a5987">gfHiddenInterrupt</a> = TeamTurnStruct.<a class="code" href="structTEAM__TURN__SAVE__STRUCT.html#437d5bdec5ad3a4ae4b89b7a3b58832f">fHiddenInterrupt</a>;
<a name="l02108"></a>02108       <a class="code" href="TeamTurns_8cpp.html#3ff1395df97489a5417b119827e89eb8">gubLastInterruptedGuy</a> = TeamTurnStruct.<a class="code" href="structTEAM__TURN__SAVE__STRUCT.html#19c8d4364c81044be4ccf334eddf4ae7">ubLastInterruptedGuy</a>;
<a name="l02109"></a>02109 
<a name="l02110"></a>02110 
<a name="l02111"></a>02111       <span class="keywordflow">return</span>( TRUE );
<a name="l02112"></a>02112 }
<a name="l02113"></a>02113 
<a name="l02114"></a><a class="code" href="TeamTurns_8h.html#4c6f019d3565f247e6bfcadac87d1e15">02114</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="TeamTurns_8cpp.html#4c6f019d3565f247e6bfcadac87d1e15">NPCFirstDraw</a>( <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> * <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>, <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> * pTargetSoldier )
<a name="l02115"></a>02115 {
<a name="l02116"></a>02116       DebugMsg (TOPIC_JA2,DBG_LEVEL_3,<span class="stringliteral">"NPCFirstDraw"</span>);
<a name="l02117"></a>02117       <span class="comment">// if attacking an NPC check to see who draws first!</span>
<a name="l02118"></a>02118 
<a name="l02119"></a>02119       <span class="keywordflow">if</span> ( pTargetSoldier-&gt;<a class="code" href="structSOLDIERTYPE.html#5a5648a1bb3507cc41f6be199c51a3f8">ubProfile</a> != NO_PROFILE &amp;&amp; pTargetSoldier-&gt;<a class="code" href="structSOLDIERTYPE.html#5a5648a1bb3507cc41f6be199c51a3f8">ubProfile</a> != <a class="code" href="Soldier_01Profile_8h.html#acaa92dcb344e96138c964deae3e2fa16fdbd42950596fda948b4caabe34d053">SLAY</a> &amp;&amp; pTargetSoldier-&gt;<a class="code" href="structSOLDIERTYPE.html#165874ef5822faaf165da91996ad4a7b">bNeutral</a> &amp;&amp; pTargetSoldier-&gt;<a class="code" href="structSOLDIERTYPE.html#d0a0bdddaeb7bbea617b4294b539ef32">bOppList</a>[ <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#18aef170576da81b10d00e7b6cd3627b">ubID</a> ] == SEEN_CURRENTLY &amp;&amp; (  <a class="code" href="Items_8cpp.html#4d7b6f8ecfa44d103eaf0b3e206edba4">FindAIUsableObjClass</a>( pTargetSoldier, IC_WEAPON ) != NO_SLOT ) )
<a name="l02120"></a>02120       {
<a name="l02121"></a>02121             <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubLargerHalf, ubSmallerHalf, ubTargetLargerHalf, ubTargetSmallerHalf;
<a name="l02122"></a>02122 
<a name="l02123"></a>02123             <span class="comment">// roll the dice!</span>
<a name="l02124"></a>02124             <span class="comment">// e.g. if level 5, roll Random( 3 + 1 ) + 2 for result from 2 to 5</span>
<a name="l02125"></a>02125             <span class="comment">// if level 4, roll Random( 2 + 1 ) + 2 for result from 2 to 4</span>
<a name="l02126"></a>02126             ubSmallerHalf = <a class="code" href="SkillCheck_8cpp.html#15874afa42450a6228e52f68f6871178">EffectiveExpLevel</a>( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> ) / 2;
<a name="l02127"></a>02127             ubLargerHalf = <a class="code" href="SkillCheck_8cpp.html#15874afa42450a6228e52f68f6871178">EffectiveExpLevel</a>( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> ) - ubSmallerHalf;
<a name="l02128"></a>02128       
<a name="l02129"></a>02129             ubTargetSmallerHalf = <a class="code" href="SkillCheck_8cpp.html#15874afa42450a6228e52f68f6871178">EffectiveExpLevel</a>( pTargetSoldier ) / 2;
<a name="l02130"></a>02130             ubTargetLargerHalf = <a class="code" href="SkillCheck_8cpp.html#15874afa42450a6228e52f68f6871178">EffectiveExpLevel</a>( pTargetSoldier ) - ubTargetSmallerHalf;
<a name="l02131"></a>02131             <span class="keywordflow">if</span> ( <a class="code" href="Soldier_01Profile_8cpp.html#1bcff2c50b375b1eb32800aa12000289">gMercProfiles</a>[ pTargetSoldier-&gt;<a class="code" href="structSOLDIERTYPE.html#5a5648a1bb3507cc41f6be199c51a3f8">ubProfile</a> ].bApproached &amp; <a class="code" href="NPC_8cpp.html#5091f8c7f50321c60389e844fcb9a96c">gbFirstApproachFlags</a>[ <a class="code" href="NPC_8h.html#fe4ba80db4eca5533465fe913160a13a2b4ef153949ea09a43af0f3d8760b4e8">APPROACH_THREATEN</a> - 1 ] )
<a name="l02132"></a>02132             {
<a name="l02133"></a>02133                   <span class="comment">// gains 1 to 2 points</span>
<a name="l02134"></a>02134                   ubTargetSmallerHalf += 1;
<a name="l02135"></a>02135                   ubTargetLargerHalf += 1;
<a name="l02136"></a>02136             }
<a name="l02137"></a>02137             <span class="keywordflow">if</span> ( <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( ubTargetSmallerHalf + 1) + ubTargetLargerHalf &gt; <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( ubSmallerHalf + 1) + ubLargerHalf )
<a name="l02138"></a>02138             {
<a name="l02139"></a>02139                   <span class="keywordflow">return</span>( TRUE );
<a name="l02140"></a>02140             }
<a name="l02141"></a>02141       }
<a name="l02142"></a>02142       <span class="keywordflow">return</span>( FALSE );
<a name="l02143"></a>02143 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sat Sep 9 13:49:09 2006 for Build by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
