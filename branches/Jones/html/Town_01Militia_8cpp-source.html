<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Build: Town Militia.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="classes.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir_3179ea33d55a76dc38212d9eab798728.html">export</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_e5664b4b56927c8728eb3192fa60e338.html">hdc2</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_1eb12a41a47efb9efcd82fa98f4f4dbd.html">FTP</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_80cc1f21a78ab7941088ea567f236150.html">ja2src</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_994ab287602efefceafe55287a3657d6.html">Build</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_5aba590d477d4824a9090ab3f8850834.html">Strategic</a></div>
<h1>Town Militia.cpp</h1><a href="Town_01Militia_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#ifdef PRECOMPILEDHEADERS</span>
<a name="l00002"></a>00002 <span class="preprocessor"></span><span class="preprocessor">      #include "<a class="code" href="Strategic_01All_8h.html">Strategic All.h</a>"</span>
<a name="l00003"></a>00003 <span class="preprocessor">      #include "<a class="code" href="GameSettings_8h.html">GameSettings.h</a>"</span>
<a name="l00004"></a>00004 <span class="preprocessor">#else</span>
<a name="l00005"></a>00005 <span class="preprocessor"></span><span class="preprocessor">      #include "<a class="code" href="Town_01Militia_8h.html">Town Militia.h</a>"</span>
<a name="l00006"></a>00006 <span class="preprocessor">      #include "<a class="code" href="Militia_01Control_8h.html">Militia Control.h</a>"</span>
<a name="l00007"></a>00007 <span class="preprocessor">      #include "<a class="code" href="Campaign_01Types_8h.html">Campaign Types.h</a>"</span>
<a name="l00008"></a>00008 <span class="preprocessor">      #include "<a class="code" href="strategic_8h.html">strategic.h</a>"</span>
<a name="l00009"></a>00009 <span class="preprocessor">      #include "<a class="code" href="strategicmap_8h.html">strategicmap.h</a>"</span>
<a name="l00010"></a>00010 <span class="preprocessor">      #include "<a class="code" href="Overhead_8h.html">Overhead.h</a>"</span>
<a name="l00011"></a>00011 <span class="preprocessor">      #include "<a class="code" href="Strategic_01Town_01Loyalty_8h.html">Strategic Town Loyalty.h</a>"</span>
<a name="l00012"></a>00012 <span class="preprocessor">      #include "<a class="code" href="Utilities_8h.html">Utilities.h</a>"</span>
<a name="l00013"></a>00013 <span class="preprocessor">      #include "<a class="code" href="random_8h.html">random.h</a>"</span>
<a name="l00014"></a>00014 <span class="preprocessor">      #include "text.h"</span>
<a name="l00015"></a>00015 <span class="preprocessor">      #include "<a class="code" href="Map_01Screen_01Interface_8h.html">Map Screen Interface.h</a>"</span>
<a name="l00016"></a>00016 <span class="preprocessor">      #include "<a class="code" href="Interface_8h.html">Interface.h</a>"</span>
<a name="l00017"></a>00017 <span class="preprocessor">      #include "Laptopsave.h"</span>
<a name="l00018"></a>00018 <span class="preprocessor">      #include "<a class="code" href="finances_8h.html">finances.h</a>"</span>
<a name="l00019"></a>00019 <span class="preprocessor">      #include "<a class="code" href="Game_01Clock_8h.html">Game Clock.h</a>"</span>
<a name="l00020"></a>00020 <span class="preprocessor">      #include "<a class="code" href="Assignments_8h.html">Assignments.h</a>"</span>
<a name="l00021"></a>00021 <span class="preprocessor">      #include "squads.h"</span>
<a name="l00022"></a>00022 <span class="preprocessor">      #include "<a class="code" href="Soldier_01Create_8h.html">Soldier Create.h</a>"</span>
<a name="l00023"></a>00023 <span class="preprocessor">      #include "<a class="code" href="Dialogue_01Control_8h.html">Dialogue Control.h</a>"</span>
<a name="l00024"></a>00024 <span class="preprocessor">      #include "<a class="code" href="GameSettings_8h.html">GameSettings.h</a>"</span>
<a name="l00025"></a>00025 <span class="preprocessor">#endif</span>
<a name="l00026"></a>00026 <span class="preprocessor"></span>
<a name="l00027"></a>00027 <span class="preprocessor">#define SIZE_OF_MILITIA_COMPLETED_TRAINING_LIST 50</span>
<a name="l00028"></a>00028 <span class="preprocessor"></span>
<a name="l00029"></a>00029 <span class="comment">// temporary local global variables</span>
<a name="l00030"></a><a class="code" href="Town_01Militia_8cpp.html#22a985e510722b0fdc6b65a6b6df8ce8">00030</a> <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> <a class="code" href="Town_01Militia_8cpp.html#22a985e510722b0fdc6b65a6b6df8ce8">gubTownSectorServerTownId</a> = <a class="code" href="mapscreen_8h.html#4d1dc70bee62b945929c96dfafebe105d008cfe091b982e6d052565ed0b5acd8">BLANK_SECTOR</a>;
<a name="l00031"></a><a class="code" href="Town_01Militia_8cpp.html#536787aa04119866d635b64d7ada0e71">00031</a> <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> <a class="code" href="Town_01Militia_8cpp.html#536787aa04119866d635b64d7ada0e71">gsTownSectorServerSkipX</a> = -1;
<a name="l00032"></a><a class="code" href="Town_01Militia_8cpp.html#88b3292c458cdb5154a7cd9e6c41503a">00032</a> <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> <a class="code" href="Town_01Militia_8cpp.html#88b3292c458cdb5154a7cd9e6c41503a">gsTownSectorServerSkipY</a> = -1;
<a name="l00033"></a><a class="code" href="Town_01Militia_8cpp.html#e4431fbe0d42c7b2591c8710a5edbb30">00033</a> <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> <a class="code" href="Town_01Militia_8cpp.html#e4431fbe0d42c7b2591c8710a5edbb30">gubTownSectorServerIndex</a> = 0;
<a name="l00034"></a><a class="code" href="Town_01Militia_8cpp.html#86e323b36777d78b2ae9a5c0b65381d3">00034</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Town_01Militia_8cpp.html#86e323b36777d78b2ae9a5c0b65381d3">gfYesNoPromptIsForContinue</a> = FALSE;           <span class="comment">// this flag remembers whether we're starting new training, or continuing</span>
<a name="l00035"></a><a class="code" href="Town_01Militia_8cpp.html#dc9fb004b47603a7037918ead2c0ee81">00035</a> <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> <a class="code" href="Town_01Militia_8cpp.html#dc9fb004b47603a7037918ead2c0ee81">giTotalCostOfTraining</a> = 0;
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 <span class="comment">//the completed list of sector soldiers for training militia</span>
<a name="l00039"></a><a class="code" href="Town_01Militia_8cpp.html#3488a42037d11f6b6caf919e75919fe2">00039</a> <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> <a class="code" href="Town_01Militia_8cpp.html#3488a42037d11f6b6caf919e75919fe2">giListOfMercsInSectorsCompletedMilitiaTraining</a>[ SIZE_OF_MILITIA_COMPLETED_TRAINING_LIST ];
<a name="l00040"></a><a class="code" href="Town_01Militia_8cpp.html#f6fc5490beeed4fea61f225e930dc560">00040</a> <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *<a class="code" href="Assignments_8cpp.html#f6fc5490beeed4fea61f225e930dc560">pMilitiaTrainerSoldier</a> = NULL;
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 <span class="comment">// note that these sector values are STRATEGIC INDEXES, not 0-255!</span>
<a name="l00043"></a><a class="code" href="Town_01Militia_8cpp.html#23d8e740f8bbf84ba1151d24ab10890d">00043</a> <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> <a class="code" href="Town_01Militia_8cpp.html#23d8e740f8bbf84ba1151d24ab10890d">gsUnpaidStrategicSector</a>[ MAX_CHARACTER_COUNT ];
<a name="l00044"></a>00044 
<a name="l00045"></a>00045 <span class="comment">// the selected list of mercs</span>
<a name="l00046"></a>00046 <span class="keyword">extern</span> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Assignments_8cpp.html#605eaa913620dea638fecf6cdb4cfc3a">fSelectedListOfMercsForMapScreen</a>[ MAX_CHARACTER_COUNT ];
<a name="l00047"></a>00047 
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 
<a name="l00050"></a>00050 <span class="comment">// private prototypes</span>
<a name="l00051"></a>00051 <span class="keywordtype">void</span> <a class="code" href="Town_01Militia_8cpp.html#023bb67a797f4a8c6043cc204dd49c31">PayMilitiaTrainingYesNoBoxCallback</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> bExitValue );
<a name="l00052"></a>00052 <span class="keywordtype">void</span> <a class="code" href="Town_01Militia_8cpp.html#28e4ed1f735a6a7698ebbe59352d455c">CantTrainMilitiaOkBoxCallback</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> bExitValue );
<a name="l00053"></a>00053 <span class="keywordtype">void</span> <a class="code" href="Town_01Militia_8cpp.html#e188e7f8e9bd8d10030f9dbd3483fa73">MilitiaTrainingRejected</a>( <span class="keywordtype">void</span> );
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 <span class="keywordtype">void</span> <a class="code" href="Town_01Militia_8cpp.html#bd48589a6f4d14183032a0ea16f427ce">InitFriendlyTownSectorServer</a>(<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubTownId, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSkipSectorX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSkipSectorY);
<a name="l00056"></a>00056 <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Town_01Militia_8cpp.html#565faa3553f4c8370959b0feb7b13a44">ServeNextFriendlySectorInTown</a>( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> *sNeighbourX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> *sNeighbourY );
<a name="l00057"></a>00057 
<a name="l00058"></a>00058 <span class="keywordtype">void</span> <a class="code" href="Town_01Militia_8cpp.html#d83c0a732fdee804038c50b81691c2bd">BuildListOfUnpaidTrainableSectors</a>( <span class="keywordtype">void</span> );
<a name="l00059"></a>00059 <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> <a class="code" href="Town_01Militia_8cpp.html#b018f3626819deef3789bfb653a6c50b">GetNumberOfUnpaidTrainableSectors</a>( <span class="keywordtype">void</span> );
<a name="l00060"></a>00060 <span class="keywordtype">void</span> <a class="code" href="Town_01Militia_8cpp.html#7cd331b0f36945bed7155f750eb9b739">ContinueTrainingInThisSector</a>( <span class="keywordtype">void</span> );
<a name="l00061"></a>00061 <span class="keywordtype">void</span> <a class="code" href="Town_01Militia_8cpp.html#62df96ee814f86ce09ffc78f23163938">StartTrainingInAllUnpaidTrainableSectors</a>();
<a name="l00062"></a>00062 <span class="keywordtype">void</span> <a class="code" href="Town_01Militia_8cpp.html#13136f3dd704d84d12f96b134853cbfd">PayForTrainingInSector</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubSector );
<a name="l00063"></a>00063 <span class="keywordtype">void</span> <a class="code" href="Town_01Militia_8cpp.html#2927f4f7d0d79d4caa47e56f5d43ab7e">ResetDoneFlagForAllMilitiaTrainersInSector</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubSector );
<a name="l00064"></a>00064 
<a name="l00065"></a>00065 
<a name="l00066"></a>00066 <span class="preprocessor">#ifdef JA2BETAVERSION</span>
<a name="l00067"></a>00067 <span class="preprocessor"></span><span class="keywordtype">void</span> <a class="code" href="Assignments_8cpp.html#8ed61e31dc0b97e88f2aaf050a0b47d0">VerifyTownTrainingIsPaidFor</a>( <span class="keywordtype">void</span> );
<a name="l00068"></a>00068 <span class="preprocessor">#endif</span>
<a name="l00069"></a>00069 <span class="preprocessor"></span>
<a name="l00070"></a>00070 
<a name="l00071"></a>00071 
<a name="l00072"></a>00072 
<a name="l00073"></a>00073 
<a name="l00074"></a><a class="code" href="Town_01Militia_8h.html#1eb990a5dac7aee7e094cc3a608ee4c0">00074</a> <span class="keywordtype">void</span> <a class="code" href="Town_01Militia_8cpp.html#1eb990a5dac7aee7e094cc3a608ee4c0">TownMilitiaTrainingCompleted</a>( <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *pTrainer, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapY )
<a name="l00075"></a>00075 {
<a name="l00076"></a>00076       <a class="code" href="structSECTORINFO.html">SECTORINFO</a> *pSectorInfo = &amp;( <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ SECTOR( sMapX, sMapY ) ] );
<a name="l00077"></a>00077       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubMilitiaTrained = 0;
<a name="l00078"></a>00078       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fFoundOne;
<a name="l00079"></a>00079       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sNeighbourX, sNeighbourY;
<a name="l00080"></a>00080       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubTownId;
<a name="l00081"></a>00081 
<a name="l00082"></a>00082       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iMaxMilitiaPerSector = <a class="code" href="GameSettings_8cpp.html#5c32f930e2fef384505c4b91803a92c2">gGameExternalOptions</a>.<a class="code" href="structGAME__EXTERNAL__OPTIONS.html#9db98fdba0ff76f98649cc6c3ded3392">iMaxMilitiaPerSector</a>;
<a name="l00083"></a>00083       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iTrainingSquadSize = <a class="code" href="GameSettings_8cpp.html#5c32f930e2fef384505c4b91803a92c2">gGameExternalOptions</a>.<a class="code" href="structGAME__EXTERNAL__OPTIONS.html#00872a29d39aa71386a1d6f69addcdb6">iTrainingSquadSize</a>;
<a name="l00084"></a>00084 DebugMsg (<a class="code" href="DEBUG_8cpp.html#a7985c2fd033797fc67a03b2c26e07c6">TOPIC_JA2</a>,DBG_LEVEL_3,<span class="stringliteral">"Militia1"</span>);
<a name="l00085"></a>00085       <span class="comment">// get town index</span>
<a name="l00086"></a>00086       ubTownId = <a class="code" href="strategic_8cpp.html#6f48fb0ea28e3d4889423290f1a6ede8">StrategicMap</a>[ sMapX + sMapY * MAP_WORLD_X ].<a class="code" href="structstrategicmapelement.html#88b09d3c6cd00efaeace5c705929ba87">bNameId</a>;
<a name="l00087"></a>00087 
<a name="l00088"></a>00088       <span class="keywordflow">if</span>( ubTownId == <a class="code" href="mapscreen_8h.html#4d1dc70bee62b945929c96dfafebe105d008cfe091b982e6d052565ed0b5acd8">BLANK_SECTOR</a> )
<a name="l00089"></a>00089       {
<a name="l00090"></a>00090             Assert( <a class="code" href="strategicmap_8cpp.html#aad459c13b87dd12c43c473c71641070">IsThisSectorASAMSector</a>( sMapX, sMapY, 0 ) );
<a name="l00091"></a>00091       }
<a name="l00092"></a>00092 
<a name="l00093"></a>00093 
<a name="l00094"></a>00094       <span class="comment">// force tactical to update militia status</span>
<a name="l00095"></a>00095       <a class="code" href="Militia_01Control_8cpp.html#8aeca7bf7233528d93298fc3b2202f0c">gfStrategicMilitiaChangesMade</a> = TRUE;
<a name="l00096"></a>00096 
<a name="l00097"></a>00097       <span class="comment">// ok, so what do we do with all this training?  Well, in order of decreasing priority:</span>
<a name="l00098"></a>00098       <span class="comment">// 1) If there's room in training sector, create new GREEN militia guys there</span>
<a name="l00099"></a>00099       <span class="comment">// 2) If not enough room there, create new GREEN militia guys in friendly sectors of the same town</span>
<a name="l00100"></a>00100       <span class="comment">// 3) If not enough room anywhere in town, promote a number of GREENs in this sector into regulars</span>
<a name="l00101"></a>00101       <span class="comment">// 4) If not enough GREENS there to promote, promote GREENs in other sectors.</span>
<a name="l00102"></a>00102       <span class="comment">// 5) If all friendly sectors of this town are completely filled with REGULAR militia, then training effect is wasted</span>
<a name="l00103"></a>00103 
<a name="l00104"></a>00104       <span class="keywordflow">while</span> (ubMilitiaTrained &lt; iTrainingSquadSize)
<a name="l00105"></a>00105       {
<a name="l00106"></a>00106             <span class="comment">// is there room for another militia in the training sector itself?</span>
<a name="l00107"></a>00107             <span class="keywordflow">if</span> (<a class="code" href="Town_01Militia_8cpp.html#d5f4d1a7e2d1489b786239270acbdda1">CountAllMilitiaInSector</a>(sMapX, sMapY) &lt; iMaxMilitiaPerSector)
<a name="l00108"></a>00108             {
<a name="l00109"></a>00109                   <span class="comment">// great! Create a new GREEN militia guy in the training sector</span>
<a name="l00110"></a>00110                   <a class="code" href="Town_01Militia_8cpp.html#39dcf5c2b737c78fc1799b0a4d443bc6">StrategicAddMilitiaToSector</a>(sMapX, sMapY, <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840b225c8d872b15875355f348d6e3335b">GREEN_MILITIA</a>, 1);
<a name="l00111"></a>00111             }
<a name="l00112"></a>00112             <span class="keywordflow">else</span>
<a name="l00113"></a>00113             {
<a name="l00114"></a>00114                   fFoundOne = FALSE;
<a name="l00115"></a>00115 
<a name="l00116"></a>00116                   <span class="keywordflow">if</span>( ubTownId != <a class="code" href="mapscreen_8h.html#4d1dc70bee62b945929c96dfafebe105d008cfe091b982e6d052565ed0b5acd8">BLANK_SECTOR</a> )
<a name="l00117"></a>00117                   {
<a name="l00118"></a>00118                         <a class="code" href="Town_01Militia_8cpp.html#bd48589a6f4d14183032a0ea16f427ce">InitFriendlyTownSectorServer</a>(ubTownId, sMapX, sMapY);
<a name="l00119"></a>00119 
<a name="l00120"></a>00120                         <span class="comment">// check other eligible sectors in this town for room for another militia</span>
<a name="l00121"></a>00121                         <span class="keywordflow">while</span>( <a class="code" href="Town_01Militia_8cpp.html#565faa3553f4c8370959b0feb7b13a44">ServeNextFriendlySectorInTown</a>( &amp;sNeighbourX, &amp;sNeighbourY ) )
<a name="l00122"></a>00122                         {
<a name="l00123"></a>00123                               <span class="comment">// is there room for another militia in this neighbouring sector ?</span>
<a name="l00124"></a>00124                               <span class="keywordflow">if</span> (<a class="code" href="Town_01Militia_8cpp.html#d5f4d1a7e2d1489b786239270acbdda1">CountAllMilitiaInSector</a>(sNeighbourX, sNeighbourY) &lt; iMaxMilitiaPerSector)
<a name="l00125"></a>00125                               {
<a name="l00126"></a>00126                                     <span class="comment">// great! Create a new GREEN militia guy in the neighbouring sector</span>
<a name="l00127"></a>00127                                     <a class="code" href="Town_01Militia_8cpp.html#39dcf5c2b737c78fc1799b0a4d443bc6">StrategicAddMilitiaToSector</a>(sNeighbourX, sNeighbourY, <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840b225c8d872b15875355f348d6e3335b">GREEN_MILITIA</a>, 1);
<a name="l00128"></a>00128 
<a name="l00129"></a>00129                                     fFoundOne = TRUE;
<a name="l00130"></a>00130                                     <span class="keywordflow">break</span>;
<a name="l00131"></a>00131                               }
<a name="l00132"></a>00132                         }
<a name="l00133"></a>00133                   }
<a name="l00134"></a>00134 
<a name="l00135"></a>00135                   <span class="comment">// if we still haven't been able to train anyone</span>
<a name="l00136"></a>00136                   <span class="keywordflow">if</span> (!fFoundOne)
<a name="l00137"></a>00137                   {
<a name="l00138"></a>00138                         <span class="comment">// alrighty, then.  We'll have to *promote* guys instead.</span>
<a name="l00139"></a>00139 
<a name="l00140"></a>00140                         <span class="comment">// are there any GREEN militia men in the training sector itself?</span>
<a name="l00141"></a>00141                         <span class="keywordflow">if</span> (<a class="code" href="Town_01Militia_8cpp.html#5d75ed19e423a36b9384185bc181fcb3">MilitiaInSectorOfRank</a>(sMapX, sMapY, <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840b225c8d872b15875355f348d6e3335b">GREEN_MILITIA</a>) &gt; 0)
<a name="l00142"></a>00142                         {
<a name="l00143"></a>00143                               <span class="comment">// great! Promote a GREEN militia guy in the training sector to a REGULAR</span>
<a name="l00144"></a>00144                               <a class="code" href="Town_01Militia_8cpp.html#f7896810850c951d8ff534adf95ee979">StrategicPromoteMilitiaInSector</a>(sMapX, sMapY, <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840b225c8d872b15875355f348d6e3335b">GREEN_MILITIA</a>, 1);
<a name="l00145"></a>00145                         }
<a name="l00146"></a>00146                         <span class="keywordflow">else</span>
<a name="l00147"></a>00147                         {
<a name="l00148"></a>00148                               <span class="keywordflow">if</span>( ubTownId != <a class="code" href="mapscreen_8h.html#4d1dc70bee62b945929c96dfafebe105d008cfe091b982e6d052565ed0b5acd8">BLANK_SECTOR</a> )
<a name="l00149"></a>00149                               {
<a name="l00150"></a>00150                                     <span class="comment">// dammit! Last chance - try to find other eligible sectors in the same town with a Green guy to be promoted</span>
<a name="l00151"></a>00151                                     <a class="code" href="Town_01Militia_8cpp.html#bd48589a6f4d14183032a0ea16f427ce">InitFriendlyTownSectorServer</a>(ubTownId, sMapX, sMapY);
<a name="l00152"></a>00152 
<a name="l00153"></a>00153                                     <span class="comment">// check other eligible sectors in this town for room for another militia</span>
<a name="l00154"></a>00154                                     <span class="keywordflow">while</span>( <a class="code" href="Town_01Militia_8cpp.html#565faa3553f4c8370959b0feb7b13a44">ServeNextFriendlySectorInTown</a>( &amp;sNeighbourX, &amp;sNeighbourY ) )
<a name="l00155"></a>00155                                     {
<a name="l00156"></a>00156                                           <span class="comment">// are there any GREEN militia men in the neighbouring sector ?</span>
<a name="l00157"></a>00157                                           <span class="keywordflow">if</span> (<a class="code" href="Town_01Militia_8cpp.html#5d75ed19e423a36b9384185bc181fcb3">MilitiaInSectorOfRank</a>(sNeighbourX, sNeighbourY, <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840b225c8d872b15875355f348d6e3335b">GREEN_MILITIA</a>) &gt; 0)
<a name="l00158"></a>00158                                           {
<a name="l00159"></a>00159                                                 <span class="comment">// great! Promote a GREEN militia guy in the neighbouring sector to a REGULAR</span>
<a name="l00160"></a>00160                                                 <a class="code" href="Town_01Militia_8cpp.html#f7896810850c951d8ff534adf95ee979">StrategicPromoteMilitiaInSector</a>(sNeighbourX, sNeighbourY, <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840b225c8d872b15875355f348d6e3335b">GREEN_MILITIA</a>, 1);
<a name="l00161"></a>00161 
<a name="l00162"></a>00162                                                 fFoundOne = TRUE;
<a name="l00163"></a>00163                                                 <span class="keywordflow">break</span>;
<a name="l00164"></a>00164                                           }
<a name="l00165"></a>00165                                     }
<a name="l00166"></a>00166                               }
<a name="l00167"></a>00167 
<a name="l00168"></a>00168                               <span class="comment">// if we still haven't been able to train anyone</span>
<a name="l00169"></a>00169                               <span class="keywordflow">if</span> (!fFoundOne)
<a name="l00170"></a>00170                               {
<a name="l00171"></a>00171                                     <span class="comment">// Well, that's it.  All eligible sectors of this town are full of REGULARs or ELITEs.</span>
<a name="l00172"></a>00172                                     <span class="comment">// The training goes to waste in this situation.</span>
<a name="l00173"></a>00173                                     <span class="keywordflow">break</span>; <span class="comment">// the main while loop</span>
<a name="l00174"></a>00174                               }
<a name="l00175"></a>00175                         }
<a name="l00176"></a>00176                   }
<a name="l00177"></a>00177             }
<a name="l00178"></a>00178 
<a name="l00179"></a>00179             <span class="comment">// next, please!</span>
<a name="l00180"></a>00180             ubMilitiaTrained++;
<a name="l00181"></a>00181       }
<a name="l00182"></a>00182 
<a name="l00183"></a>00183 
<a name="l00184"></a>00184       <span class="comment">// if anyone actually got trained</span>
<a name="l00185"></a>00185       <span class="keywordflow">if</span> (ubMilitiaTrained &gt; 0)
<a name="l00186"></a>00186       {
<a name="l00187"></a>00187             <span class="comment">// update the screen display</span>
<a name="l00188"></a>00188             <a class="code" href="HelpScreen_8cpp.html#be83f0093f2fba05817df5b4592ab0f0">fMapPanelDirty</a> = TRUE;
<a name="l00189"></a>00189 
<a name="l00190"></a>00190             <span class="keywordflow">if</span>( ubTownId != <a class="code" href="mapscreen_8h.html#4d1dc70bee62b945929c96dfafebe105d008cfe091b982e6d052565ed0b5acd8">BLANK_SECTOR</a> )
<a name="l00191"></a>00191             {
<a name="l00192"></a>00192                   <span class="comment">// loyalty in this town increases a bit because we obviously care about them...</span>
<a name="l00193"></a>00193                   <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#0213c5a18d28686e5740e748d8e19754">IncrementTownLoyalty</a>( ubTownId, LOYALTY_BONUS_FOR_TOWN_TRAINING );
<a name="l00194"></a>00194             }
<a name="l00195"></a>00195 
<a name="l00196"></a>00196       }
<a name="l00197"></a>00197 
<a name="l00198"></a>00198 
<a name="l00199"></a>00199       <span class="comment">// the trainer announces to player that he's finished his assignment.  Make his sector flash!</span>
<a name="l00200"></a>00200       <a class="code" href="Assignments_8cpp.html#1b8dd88b03c418ca466e71eba1dba6ae">AssignmentDone</a>( pTrainer, TRUE, FALSE );
<a name="l00201"></a>00201 
<a name="l00202"></a>00202       <span class="comment">// handle completion of town by training group</span>
<a name="l00203"></a>00203       <a class="code" href="Town_01Militia_8cpp.html#1c4ce62b438666763a9c0855996dd4fc">HandleCompletionOfTownTrainingByGroupWithTrainer</a>( pTrainer );
<a name="l00204"></a>00204 
<a name="l00205"></a>00205 }
<a name="l00206"></a>00206 
<a name="l00207"></a>00207 
<a name="l00208"></a>00208 <span class="comment">// feed this a SOLDIER_CLASS_, it will return you a _MITILIA rank, or -1 if the guy's not militia</span>
<a name="l00209"></a><a class="code" href="Town_01Militia_8h.html#b3838d278ec5c9579561ae8a598fcce2">00209</a> <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> <a class="code" href="Town_01Militia_8cpp.html#b3838d278ec5c9579561ae8a598fcce2">SoldierClassToMilitiaRank</a>(<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubSoldierClass)
<a name="l00210"></a>00210 {
<a name="l00211"></a>00211       <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bRank = -1;
<a name="l00212"></a>00212 
<a name="l00213"></a>00213       <span class="keywordflow">switch</span>( ubSoldierClass )
<a name="l00214"></a>00214       {
<a name="l00215"></a>00215             <span class="keywordflow">case</span> <a class="code" href="Soldier_01Control_8h.html#d559b3ed307be626eacea8b56942de615d87e4b53a22c14df589d9df96ddb0dc">SOLDIER_CLASS_GREEN_MILITIA</a>:
<a name="l00216"></a>00216                   bRank = <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840b225c8d872b15875355f348d6e3335b">GREEN_MILITIA</a>;
<a name="l00217"></a>00217                   <span class="keywordflow">break</span>;
<a name="l00218"></a>00218             <span class="keywordflow">case</span> <a class="code" href="Soldier_01Control_8h.html#d559b3ed307be626eacea8b56942de610534cbb3d918376e9f10be3bf049666e">SOLDIER_CLASS_REG_MILITIA</a>:
<a name="l00219"></a>00219                   bRank = <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a845612214b681e2988ea93890806802cc9">REGULAR_MILITIA</a>;
<a name="l00220"></a>00220                   <span class="keywordflow">break</span>;
<a name="l00221"></a>00221             <span class="keywordflow">case</span> <a class="code" href="Soldier_01Control_8h.html#d559b3ed307be626eacea8b56942de61f2c9f1bbece4a7bd58b4a83a54dac6b6">SOLDIER_CLASS_ELITE_MILITIA</a>:
<a name="l00222"></a>00222                   bRank = <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840fcf7fc556b8af2f6d3ec39652d3a927">ELITE_MILITIA</a>;
<a name="l00223"></a>00223                   <span class="keywordflow">break</span>;
<a name="l00224"></a>00224       }
<a name="l00225"></a>00225 
<a name="l00226"></a>00226       <span class="keywordflow">return</span>(bRank);
<a name="l00227"></a>00227 }
<a name="l00228"></a>00228 
<a name="l00229"></a>00229 
<a name="l00230"></a>00230 <span class="comment">// feed this a _MITILIA rank, it will return you a SOLDIER_CLASS_, or -1 if the guy's not militia</span>
<a name="l00231"></a><a class="code" href="Town_01Militia_8h.html#77731f6932e9c3c9a18bb5a21dbe11ef">00231</a> <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> <a class="code" href="Town_01Militia_8cpp.html#77731f6932e9c3c9a18bb5a21dbe11ef">MilitiaRankToSoldierClass</a>(<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubRank)
<a name="l00232"></a>00232 {
<a name="l00233"></a>00233       <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bSoldierClass = -1;
<a name="l00234"></a>00234 
<a name="l00235"></a>00235       <span class="keywordflow">switch</span>( ubRank )
<a name="l00236"></a>00236       {
<a name="l00237"></a>00237             <span class="keywordflow">case</span> <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840b225c8d872b15875355f348d6e3335b">GREEN_MILITIA</a>:
<a name="l00238"></a>00238                   bSoldierClass = <a class="code" href="Soldier_01Control_8h.html#d559b3ed307be626eacea8b56942de615d87e4b53a22c14df589d9df96ddb0dc">SOLDIER_CLASS_GREEN_MILITIA</a>;
<a name="l00239"></a>00239                   <span class="keywordflow">break</span>;
<a name="l00240"></a>00240             <span class="keywordflow">case</span> <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a845612214b681e2988ea93890806802cc9">REGULAR_MILITIA</a>:
<a name="l00241"></a>00241                   bSoldierClass = <a class="code" href="Soldier_01Control_8h.html#d559b3ed307be626eacea8b56942de610534cbb3d918376e9f10be3bf049666e">SOLDIER_CLASS_REG_MILITIA</a>;
<a name="l00242"></a>00242                   <span class="keywordflow">break</span>;
<a name="l00243"></a>00243             <span class="keywordflow">case</span> <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840fcf7fc556b8af2f6d3ec39652d3a927">ELITE_MILITIA</a>:
<a name="l00244"></a>00244                   bSoldierClass = <a class="code" href="Soldier_01Control_8h.html#d559b3ed307be626eacea8b56942de61f2c9f1bbece4a7bd58b4a83a54dac6b6">SOLDIER_CLASS_ELITE_MILITIA</a>;
<a name="l00245"></a>00245                   <span class="keywordflow">break</span>;
<a name="l00246"></a>00246       }
<a name="l00247"></a>00247 
<a name="l00248"></a>00248       <span class="keywordflow">return</span>(bSoldierClass);
<a name="l00249"></a>00249 }
<a name="l00250"></a>00250 
<a name="l00251"></a>00251 
<a name="l00252"></a><a class="code" href="Town_01Militia_8h.html#39dcf5c2b737c78fc1799b0a4d443bc6">00252</a> <span class="keywordtype">void</span> <a class="code" href="Town_01Militia_8cpp.html#39dcf5c2b737c78fc1799b0a4d443bc6">StrategicAddMilitiaToSector</a>(<a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapY, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubRank, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubHowMany)
<a name="l00253"></a>00253 {
<a name="l00254"></a>00254       <a class="code" href="structSECTORINFO.html">SECTORINFO</a> *pSectorInfo = &amp;( <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ SECTOR( sMapX, sMapY ) ] );
<a name="l00255"></a>00255 
<a name="l00256"></a>00256       pSectorInfo-&gt;<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ ubRank ] += ubHowMany;
<a name="l00257"></a>00257 
<a name="l00258"></a>00258       <span class="comment">// update the screen display</span>
<a name="l00259"></a>00259       <a class="code" href="HelpScreen_8cpp.html#be83f0093f2fba05817df5b4592ab0f0">fMapPanelDirty</a> = TRUE;
<a name="l00260"></a>00260 }
<a name="l00261"></a>00261 
<a name="l00262"></a>00262 
<a name="l00263"></a><a class="code" href="Town_01Militia_8h.html#f7896810850c951d8ff534adf95ee979">00263</a> <span class="keywordtype">void</span> <a class="code" href="Town_01Militia_8cpp.html#f7896810850c951d8ff534adf95ee979">StrategicPromoteMilitiaInSector</a>(<a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapY, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubCurrentRank, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubHowMany)
<a name="l00264"></a>00264 {
<a name="l00265"></a>00265       <a class="code" href="structSECTORINFO.html">SECTORINFO</a> *pSectorInfo = &amp;( <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ SECTOR( sMapX, sMapY ) ] );
<a name="l00266"></a>00266 
<a name="l00267"></a>00267       <span class="comment">// damn well better have that many around to promote!</span>
<a name="l00268"></a>00268       Assert(pSectorInfo-&gt;<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ ubCurrentRank ] &gt;= ubHowMany);
<a name="l00269"></a>00269 
<a name="l00270"></a>00270       <span class="comment">//KM : July 21, 1999 patch fix</span>
<a name="l00271"></a>00271       <span class="keywordflow">if</span>( pSectorInfo-&gt;<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ ubCurrentRank ] &lt; ubHowMany )
<a name="l00272"></a>00272       {
<a name="l00273"></a>00273             <span class="keywordflow">return</span>;
<a name="l00274"></a>00274       }
<a name="l00275"></a>00275 
<a name="l00276"></a>00276       pSectorInfo-&gt;<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ ubCurrentRank     ] -= ubHowMany;
<a name="l00277"></a>00277       pSectorInfo-&gt;<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ ubCurrentRank + 1 ] += ubHowMany;
<a name="l00278"></a>00278 
<a name="l00279"></a>00279       <span class="comment">// update the screen display</span>
<a name="l00280"></a>00280       <a class="code" href="HelpScreen_8cpp.html#be83f0093f2fba05817df5b4592ab0f0">fMapPanelDirty</a> = TRUE;
<a name="l00281"></a>00281 }
<a name="l00282"></a>00282 
<a name="l00283"></a>00283 
<a name="l00284"></a><a class="code" href="Town_01Militia_8h.html#cf872fb1ab411cf613deb1b432e1cbe9">00284</a> <span class="keywordtype">void</span> <a class="code" href="Town_01Militia_8cpp.html#cf872fb1ab411cf613deb1b432e1cbe9">StrategicRemoveMilitiaFromSector</a>(<a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapY, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubRank, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubHowMany)
<a name="l00285"></a>00285 {
<a name="l00286"></a>00286       <a class="code" href="structSECTORINFO.html">SECTORINFO</a> *pSectorInfo = &amp;( <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ SECTOR( sMapX, sMapY ) ] );
<a name="l00287"></a>00287 
<a name="l00288"></a>00288       <span class="comment">// damn well better have that many around to remove!</span>
<a name="l00289"></a>00289       Assert(pSectorInfo-&gt;<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ ubRank ] &gt;= ubHowMany);
<a name="l00290"></a>00290 
<a name="l00291"></a>00291       <span class="comment">//KM : July 21, 1999 patch fix</span>
<a name="l00292"></a>00292       <span class="keywordflow">if</span>( pSectorInfo-&gt;<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ ubRank ] &lt; ubHowMany )
<a name="l00293"></a>00293       {
<a name="l00294"></a>00294             <span class="keywordflow">return</span>;
<a name="l00295"></a>00295       }
<a name="l00296"></a>00296 
<a name="l00297"></a>00297       pSectorInfo-&gt;<a class="code" href="structSECTORINFO.html#71d253db041a4884b9ae6335f52fb082">ubNumberOfCivsAtLevel</a>[ ubRank ] -= ubHowMany;
<a name="l00298"></a>00298 
<a name="l00299"></a>00299       <span class="comment">// update the screen display</span>
<a name="l00300"></a>00300       <a class="code" href="HelpScreen_8cpp.html#be83f0093f2fba05817df5b4592ab0f0">fMapPanelDirty</a> = TRUE;
<a name="l00301"></a>00301 }
<a name="l00302"></a>00302 
<a name="l00303"></a>00303 
<a name="l00304"></a>00304 <span class="comment">// kill pts are (2 * kills) + assists</span>
<a name="l00305"></a><a class="code" href="Town_01Militia_8h.html#3db3e09d15d947aee8283604e64920b1">00305</a> <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> <a class="code" href="Town_01Militia_8cpp.html#3db3e09d15d947aee8283604e64920b1">CheckOneMilitiaForPromotion</a>(<a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapY, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubCurrentRank, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubRecentKillPts)
<a name="l00306"></a>00306 {
<a name="l00307"></a>00307       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiChanceToLevel = 0;
<a name="l00308"></a>00308 
<a name="l00309"></a>00309       <span class="keywordflow">switch</span>( ubCurrentRank )
<a name="l00310"></a>00310       {
<a name="l00311"></a>00311             <span class="keywordflow">case</span> <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840b225c8d872b15875355f348d6e3335b">GREEN_MILITIA</a>:
<a name="l00312"></a>00312                   <span class="comment">// 2 kill pts minimum</span>
<a name="l00313"></a>00313                   <span class="keywordflow">if</span> (ubRecentKillPts &gt;= 2)
<a name="l00314"></a>00314                   {
<a name="l00315"></a>00315                         <span class="comment">// 25% chance per kill pt</span>
<a name="l00316"></a>00316                         uiChanceToLevel = 25 * ubRecentKillPts;
<a name="l00317"></a>00317                   }
<a name="l00318"></a>00318                   <span class="keywordflow">break</span>;
<a name="l00319"></a>00319             <span class="keywordflow">case</span> <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a845612214b681e2988ea93890806802cc9">REGULAR_MILITIA</a>:
<a name="l00320"></a>00320                   <span class="comment">// 5 kill pts minimum</span>
<a name="l00321"></a>00321                   <span class="keywordflow">if</span> (ubRecentKillPts &gt;= 5)
<a name="l00322"></a>00322                   {
<a name="l00323"></a>00323                         <span class="comment">// 10% chance per kill pt.</span>
<a name="l00324"></a>00324                         uiChanceToLevel = 10 * ubRecentKillPts;
<a name="l00325"></a>00325                   }
<a name="l00326"></a>00326                   <span class="keywordflow">break</span>;
<a name="l00327"></a>00327             <span class="keywordflow">case</span> <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840fcf7fc556b8af2f6d3ec39652d3a927">ELITE_MILITIA</a>:
<a name="l00328"></a>00328                   <span class="keywordflow">return</span> 0;
<a name="l00329"></a>00329                   <span class="keywordflow">break</span>;
<a name="l00330"></a>00330 
<a name="l00331"></a>00331       }
<a name="l00332"></a>00332       <span class="comment">// roll the bones, and see if he makes it</span>
<a name="l00333"></a>00333       <span class="keywordflow">if</span> (<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(100) &lt; uiChanceToLevel)
<a name="l00334"></a>00334       {
<a name="l00335"></a>00335             <a class="code" href="Town_01Militia_8cpp.html#f7896810850c951d8ff534adf95ee979">StrategicPromoteMilitiaInSector</a>(sMapX, sMapY, ubCurrentRank, 1);
<a name="l00336"></a>00336             <span class="keywordflow">if</span>( ubCurrentRank == <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840b225c8d872b15875355f348d6e3335b">GREEN_MILITIA</a> )
<a name="l00337"></a>00337             { <span class="comment">//Attempt yet another level up if sufficient points</span>
<a name="l00338"></a>00338                   <span class="keywordflow">if</span>( ubRecentKillPts &gt; 2 )
<a name="l00339"></a>00339                   {
<a name="l00340"></a>00340                         <span class="keywordflow">if</span>( <a class="code" href="Town_01Militia_8cpp.html#3db3e09d15d947aee8283604e64920b1">CheckOneMilitiaForPromotion</a>( sMapX, sMapY, <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a845612214b681e2988ea93890806802cc9">REGULAR_MILITIA</a>, (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>)(ubRecentKillPts - 2) ) )
<a name="l00341"></a>00341                         { <span class="comment">//success, this militia was promoted twice</span>
<a name="l00342"></a>00342                               <span class="keywordflow">return</span> 2;
<a name="l00343"></a>00343                         }
<a name="l00344"></a>00344                   }
<a name="l00345"></a>00345             }
<a name="l00346"></a>00346             <span class="keywordflow">return</span> 1;
<a name="l00347"></a>00347       }
<a name="l00348"></a>00348       <span class="keywordflow">return</span> 0;
<a name="l00349"></a>00349 }
<a name="l00350"></a>00350 
<a name="l00351"></a>00351 
<a name="l00352"></a>00352 <span class="comment">// call this if the player attacks his own militia</span>
<a name="l00353"></a><a class="code" href="Town_01Militia_8h.html#ab5a2c14f98f11be8eb3d557eb671267">00353</a> <span class="keywordtype">void</span> <a class="code" href="Town_01Militia_8cpp.html#ab5a2c14f98f11be8eb3d557eb671267">HandleMilitiaDefections</a>(<a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapY)
<a name="l00354"></a>00354 {
<a name="l00355"></a>00355       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubRank;
<a name="l00356"></a>00356       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubMilitiaCnt;
<a name="l00357"></a>00357       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubCount;
<a name="l00358"></a>00358       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiChanceToDefect;
<a name="l00359"></a>00359 
<a name="l00360"></a>00360       <span class="keywordflow">for</span>( ubRank = 0; ubRank &lt; <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a848fda64e7cb5d2c224ec8cce5d824c9ef">MAX_MILITIA_LEVELS</a>; ubRank++ )
<a name="l00361"></a>00361       {
<a name="l00362"></a>00362             ubMilitiaCnt = <a class="code" href="Town_01Militia_8cpp.html#5d75ed19e423a36b9384185bc181fcb3">MilitiaInSectorOfRank</a>(sMapX, sMapY, ubRank);
<a name="l00363"></a>00363 
<a name="l00364"></a>00364             <span class="comment">// check each guy at each rank to see if he defects</span>
<a name="l00365"></a>00365             <span class="keywordflow">for</span> (ubCount = 0; ubCount &lt; ubMilitiaCnt; ubCount++)
<a name="l00366"></a>00366             {
<a name="l00367"></a>00367                   <span class="keywordflow">switch</span>( ubRank )
<a name="l00368"></a>00368                   {
<a name="l00369"></a>00369                         <span class="keywordflow">case</span> <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840b225c8d872b15875355f348d6e3335b">GREEN_MILITIA</a>:
<a name="l00370"></a>00370                               uiChanceToDefect = 50;
<a name="l00371"></a>00371                               <span class="keywordflow">break</span>;
<a name="l00372"></a>00372                         <span class="keywordflow">case</span> <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a845612214b681e2988ea93890806802cc9">REGULAR_MILITIA</a>:
<a name="l00373"></a>00373                               uiChanceToDefect = 75;
<a name="l00374"></a>00374                               <span class="keywordflow">break</span>;
<a name="l00375"></a>00375                         <span class="keywordflow">case</span> <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840fcf7fc556b8af2f6d3ec39652d3a927">ELITE_MILITIA</a>:
<a name="l00376"></a>00376                               uiChanceToDefect = 90;
<a name="l00377"></a>00377                               <span class="keywordflow">break</span>;
<a name="l00378"></a>00378                         <span class="keywordflow">default</span>:
<a name="l00379"></a>00379                               Assert( 0 );
<a name="l00380"></a>00380                               <span class="keywordflow">return</span>;
<a name="l00381"></a>00381                   }
<a name="l00382"></a>00382 
<a name="l00383"></a>00383                   <span class="comment">// roll the bones; should I stay or should I go now?  (for you music fans out there)</span>
<a name="l00384"></a>00384                   <span class="keywordflow">if</span> (<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>(100) &lt; uiChanceToDefect)
<a name="l00385"></a>00385                   {
<a name="l00386"></a>00386                         <span class="comment">//B'bye!  (for you SNL fans out there)</span>
<a name="l00387"></a>00387                         <a class="code" href="Town_01Militia_8cpp.html#cf872fb1ab411cf613deb1b432e1cbe9">StrategicRemoveMilitiaFromSector</a>(sMapX, sMapY, ubRank, 1);
<a name="l00388"></a>00388                   }
<a name="l00389"></a>00389             }
<a name="l00390"></a>00390       }
<a name="l00391"></a>00391 }
<a name="l00392"></a>00392 
<a name="l00393"></a>00393 
<a name="l00394"></a><a class="code" href="Town_01Militia_8h.html#d5f4d1a7e2d1489b786239270acbdda1">00394</a> <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> <a class="code" href="Town_01Militia_8cpp.html#d5f4d1a7e2d1489b786239270acbdda1">CountAllMilitiaInSector</a>(<a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapY)
<a name="l00395"></a>00395 {
<a name="l00396"></a>00396       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubMilitiaTotal = 0;
<a name="l00397"></a>00397       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubRank;
<a name="l00398"></a>00398 
<a name="l00399"></a>00399       <span class="comment">// find out if there are any town militia in this SECTOR (don't care about other sectors in same town)</span>
<a name="l00400"></a>00400       <span class="keywordflow">for</span>( ubRank = 0; ubRank &lt; <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a848fda64e7cb5d2c224ec8cce5d824c9ef">MAX_MILITIA_LEVELS</a>; ubRank++ )
<a name="l00401"></a>00401       {
<a name="l00402"></a>00402             ubMilitiaTotal += <a class="code" href="Town_01Militia_8cpp.html#5d75ed19e423a36b9384185bc181fcb3">MilitiaInSectorOfRank</a>(sMapX, sMapY, ubRank);
<a name="l00403"></a>00403       }
<a name="l00404"></a>00404 
<a name="l00405"></a>00405       <span class="keywordflow">return</span>(ubMilitiaTotal);
<a name="l00406"></a>00406 }
<a name="l00407"></a>00407 
<a name="l00408"></a>00408 
<a name="l00409"></a><a class="code" href="Town_01Militia_8h.html#5d75ed19e423a36b9384185bc181fcb3">00409</a> <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> <a class="code" href="Town_01Militia_8cpp.html#5d75ed19e423a36b9384185bc181fcb3">MilitiaInSectorOfRank</a>(<a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapY, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubRank)
<a name="l00410"></a>00410 {
<a name="l00411"></a>00411       <span class="keywordflow">return</span>( <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ SECTOR( sMapX, sMapY ) ].ubNumberOfCivsAtLevel[ ubRank ] );
<a name="l00412"></a>00412 }
<a name="l00413"></a>00413 
<a name="l00414"></a>00414 
<a name="l00415"></a><a class="code" href="Town_01Militia_8h.html#01dd2be30e6898d4dcce7f876a11bee6">00415</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Town_01Militia_8cpp.html#01dd2be30e6898d4dcce7f876a11bee6">SectorOursAndPeaceful</a>( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapY, <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bMapZ )
<a name="l00416"></a>00416 {
<a name="l00417"></a>00417       <span class="comment">// if this sector is currently loaded</span>
<a name="l00418"></a>00418       <span class="keywordflow">if</span> ( ( sMapX == <a class="code" href="strategicmap_8cpp.html#49d9aed144a633fda4ba1990f002d703">gWorldSectorX</a> ) &amp;&amp; ( sMapY == <a class="code" href="strategicmap_8cpp.html#ea322310ced0e35ee18a2ee7b32aac5b">gWorldSectorY</a> ) &amp;&amp; ( bMapZ == <a class="code" href="strategicmap_8cpp.html#da715721a8ceedd42acf6ddb33e63ce0">gbWorldSectorZ</a> ) )
<a name="l00419"></a>00419       {
<a name="l00420"></a>00420             <span class="comment">// and either there are enemies prowling this sector, or combat is in progress</span>
<a name="l00421"></a>00421             <span class="keywordflow">if</span> ( <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#a921ee4fc79277889d9c1cec0985d3a3">fEnemyInSector</a> || ( <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#89eb954f99ad4f28b84d7cf675c8ed32">uiFlags</a> &amp; INCOMBAT ) )
<a name="l00422"></a>00422             {
<a name="l00423"></a>00423                   <span class="keywordflow">return</span> FALSE;
<a name="l00424"></a>00424             }
<a name="l00425"></a>00425       }
<a name="l00426"></a>00426 
<a name="l00427"></a>00427       <span class="comment">// if sector is controlled by enemies, it's not ours (duh!)</span>
<a name="l00428"></a>00428       <span class="keywordflow">if</span>( !bMapZ &amp;&amp; <a class="code" href="strategic_8cpp.html#6f48fb0ea28e3d4889423290f1a6ede8">StrategicMap</a>[ sMapX + sMapY * MAP_WORLD_X ].fEnemyControlled == TRUE )
<a name="l00429"></a>00429       {
<a name="l00430"></a>00430             <span class="keywordflow">return</span> FALSE;
<a name="l00431"></a>00431       }
<a name="l00432"></a>00432 
<a name="l00433"></a>00433       <span class="keywordflow">if</span>( <a class="code" href="Queen_01Command_8cpp.html#4c107e5449871be5bef0808839c19787">NumHostilesInSector</a>( sMapX, sMapY, bMapZ ) )
<a name="l00434"></a>00434       {
<a name="l00435"></a>00435             <span class="keywordflow">return</span> FALSE;
<a name="l00436"></a>00436       }
<a name="l00437"></a>00437 
<a name="l00438"></a>00438       <span class="comment">// safe &amp; secure, s'far as we can tell</span>
<a name="l00439"></a>00439       <span class="keywordflow">return</span>(TRUE);
<a name="l00440"></a>00440 }
<a name="l00441"></a>00441 
<a name="l00442"></a>00442 
<a name="l00443"></a><a class="code" href="Town_01Militia_8cpp.html#bd48589a6f4d14183032a0ea16f427ce">00443</a> <span class="keywordtype">void</span> <a class="code" href="Town_01Militia_8cpp.html#bd48589a6f4d14183032a0ea16f427ce">InitFriendlyTownSectorServer</a>(<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubTownId, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSkipSectorX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSkipSectorY)
<a name="l00444"></a>00444 {
<a name="l00445"></a>00445       <span class="comment">// reset globals</span>
<a name="l00446"></a>00446       <a class="code" href="Town_01Militia_8cpp.html#22a985e510722b0fdc6b65a6b6df8ce8">gubTownSectorServerTownId</a> = ubTownId;
<a name="l00447"></a>00447       <a class="code" href="Town_01Militia_8cpp.html#536787aa04119866d635b64d7ada0e71">gsTownSectorServerSkipX</a> = sSkipSectorX;
<a name="l00448"></a>00448       <a class="code" href="Town_01Militia_8cpp.html#88b3292c458cdb5154a7cd9e6c41503a">gsTownSectorServerSkipY</a> = sSkipSectorY;
<a name="l00449"></a>00449 
<a name="l00450"></a>00450       <a class="code" href="Town_01Militia_8cpp.html#e4431fbe0d42c7b2591c8710a5edbb30">gubTownSectorServerIndex</a> = 0;
<a name="l00451"></a>00451 }
<a name="l00452"></a>00452 
<a name="l00453"></a>00453 
<a name="l00454"></a>00454 <span class="comment">// this feeds the X,Y of the next town sector on the town list for the town specified at initialization</span>
<a name="l00455"></a>00455 <span class="comment">// it will skip an entry that matches the skip X/Y value if one was specified at initialization</span>
<a name="l00456"></a>00456 <span class="comment">// MUST CALL InitFriendlyTownSectorServer() before using!!!</span>
<a name="l00457"></a><a class="code" href="Town_01Militia_8cpp.html#565faa3553f4c8370959b0feb7b13a44">00457</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Town_01Militia_8cpp.html#565faa3553f4c8370959b0feb7b13a44">ServeNextFriendlySectorInTown</a>( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> *sNeighbourX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> *sNeighbourY )
<a name="l00458"></a>00458 {
<a name="l00459"></a>00459       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iTownSector;
<a name="l00460"></a>00460       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sMapX, sMapY;
<a name="l00461"></a>00461       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fStopLooking = FALSE;
<a name="l00462"></a>00462 
<a name="l00463"></a>00463       <span class="keywordflow">do</span>
<a name="l00464"></a>00464       {
<a name="l00465"></a>00465             <span class="comment">// have we reached the end of the town list?</span>
<a name="l00466"></a>00466             <span class="keywordflow">if</span> (<a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#1001d8cb48db71e9db760efbf4353e6a">pTownNamesList</a>[ <a class="code" href="Town_01Militia_8cpp.html#e4431fbe0d42c7b2591c8710a5edbb30">gubTownSectorServerIndex</a> ] == <a class="code" href="mapscreen_8h.html#4d1dc70bee62b945929c96dfafebe105d008cfe091b982e6d052565ed0b5acd8">BLANK_SECTOR</a>)
<a name="l00467"></a>00467             {
<a name="l00468"></a>00468                   <span class="comment">// end of list reached</span>
<a name="l00469"></a>00469                   <span class="keywordflow">return</span>(FALSE);
<a name="l00470"></a>00470             }
<a name="l00471"></a>00471 
<a name="l00472"></a>00472             iTownSector = <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#c994e67a1f8511a80e6418dc483b0861">pTownLocationsList</a>[ <a class="code" href="Town_01Militia_8cpp.html#e4431fbe0d42c7b2591c8710a5edbb30">gubTownSectorServerIndex</a> ];
<a name="l00473"></a>00473 
<a name="l00474"></a>00474             <span class="comment">// if this sector is in the town we're looking for</span>
<a name="l00475"></a>00475             <span class="keywordflow">if</span>( <a class="code" href="strategic_8cpp.html#6f48fb0ea28e3d4889423290f1a6ede8">StrategicMap</a>[ iTownSector ].bNameId == <a class="code" href="Town_01Militia_8cpp.html#22a985e510722b0fdc6b65a6b6df8ce8">gubTownSectorServerTownId</a> )
<a name="l00476"></a>00476             {
<a name="l00477"></a>00477                   <span class="comment">// A sector in the specified town.  Calculate its X &amp; Y sector compotents</span>
<a name="l00478"></a>00478                   sMapX = iTownSector % MAP_WORLD_X;
<a name="l00479"></a>00479                   sMapY = iTownSector / MAP_WORLD_X;
<a name="l00480"></a>00480 
<a name="l00481"></a>00481                   <span class="comment">// Make sure we're not supposed to skip it</span>
<a name="l00482"></a>00482                   <span class="keywordflow">if</span> ( ( sMapX != <a class="code" href="Town_01Militia_8cpp.html#536787aa04119866d635b64d7ada0e71">gsTownSectorServerSkipX</a> ) || ( sMapY != <a class="code" href="Town_01Militia_8cpp.html#88b3292c458cdb5154a7cd9e6c41503a">gsTownSectorServerSkipY</a> ) )
<a name="l00483"></a>00483                   {
<a name="l00484"></a>00484                         <span class="comment">// check if it's "friendly" - not enemy controlled, no enemies in it, no combat in progress</span>
<a name="l00485"></a>00485                         <span class="keywordflow">if</span> (<a class="code" href="Town_01Militia_8cpp.html#01dd2be30e6898d4dcce7f876a11bee6">SectorOursAndPeaceful</a>( sMapX, sMapY, 0 ))
<a name="l00486"></a>00486                         {
<a name="l00487"></a>00487                               <span class="comment">// then that's it!</span>
<a name="l00488"></a>00488                               *sNeighbourX = sMapX;
<a name="l00489"></a>00489                               *sNeighbourY = sMapY;
<a name="l00490"></a>00490 
<a name="l00491"></a>00491                               fStopLooking = TRUE;
<a name="l00492"></a>00492                         }
<a name="l00493"></a>00493                   }
<a name="l00494"></a>00494             }
<a name="l00495"></a>00495 
<a name="l00496"></a>00496             <span class="comment">// advance to next entry in town list</span>
<a name="l00497"></a>00497             <a class="code" href="Town_01Militia_8cpp.html#e4431fbe0d42c7b2591c8710a5edbb30">gubTownSectorServerIndex</a>++;
<a name="l00498"></a>00498 
<a name="l00499"></a>00499       } <span class="keywordflow">while</span> ( !fStopLooking );
<a name="l00500"></a>00500 
<a name="l00501"></a>00501 
<a name="l00502"></a>00502       <span class="comment">// found &amp; returning a valid sector</span>
<a name="l00503"></a>00503       <span class="keywordflow">return</span>(TRUE);
<a name="l00504"></a>00504 }
<a name="l00505"></a>00505 
<a name="l00506"></a>00506 
<a name="l00507"></a><a class="code" href="Town_01Militia_8h.html#1469d9f63918b480e18e840ed0748aea">00507</a> <span class="keywordtype">void</span> <a class="code" href="Town_01Militia_8cpp.html#1469d9f63918b480e18e840ed0748aea">HandleInterfaceMessageForCostOfTrainingMilitia</a>( <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> )
<a name="l00508"></a>00508 {
<a name="l00509"></a>00509       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iMilitiaTrainingCost = <a class="code" href="GameSettings_8cpp.html#5c32f930e2fef384505c4b91803a92c2">gGameExternalOptions</a>.<a class="code" href="structGAME__EXTERNAL__OPTIONS.html#312cf0aee51467ca04d89529d66494c8">iMilitiaTrainingCost</a>;
<a name="l00510"></a>00510 DebugMsg (<a class="code" href="DEBUG_8cpp.html#a7985c2fd033797fc67a03b2c26e07c6">TOPIC_JA2</a>,DBG_LEVEL_3,<span class="stringliteral">"Militia2"</span>);
<a name="l00511"></a>00511 
<a name="l00512"></a>00512       <a class="code" href="Types_8h.html#fcdf88c1d4179fcd6d8a1fa9bbcb8a80">CHAR16</a> sString[ 128 ];
<a name="l00513"></a>00513       <a class="code" href="structSGPRect.html">SGPRect</a> pCenteringRect= {0, 0, 640, <a class="code" href="Interface_8cpp.html#37871c8e1ece32a7d52bbad885f14d32">INV_INTERFACE_START_Y</a> };
<a name="l00514"></a>00514       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iNumberOfSectors = 0;
<a name="l00515"></a>00515 
<a name="l00516"></a>00516       <a class="code" href="Assignments_8cpp.html#f6fc5490beeed4fea61f225e930dc560">pMilitiaTrainerSoldier</a> = <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>;
<a name="l00517"></a>00517 
<a name="l00518"></a>00518       <span class="comment">// grab total number of sectors</span>
<a name="l00519"></a>00519       iNumberOfSectors = <a class="code" href="Town_01Militia_8cpp.html#b018f3626819deef3789bfb653a6c50b">GetNumberOfUnpaidTrainableSectors</a>( );
<a name="l00520"></a>00520       Assert( iNumberOfSectors &gt; 0 );
<a name="l00521"></a>00521 
<a name="l00522"></a>00522       <span class="comment">// get total cost</span>
<a name="l00523"></a>00523       <a class="code" href="Town_01Militia_8cpp.html#dc9fb004b47603a7037918ead2c0ee81">giTotalCostOfTraining</a> = iMilitiaTrainingCost * iNumberOfSectors; 
<a name="l00524"></a>00524       Assert( <a class="code" href="Town_01Militia_8cpp.html#dc9fb004b47603a7037918ead2c0ee81">giTotalCostOfTraining</a> &gt; 0 );
<a name="l00525"></a>00525 
<a name="l00526"></a>00526       <a class="code" href="Town_01Militia_8cpp.html#86e323b36777d78b2ae9a5c0b65381d3">gfYesNoPromptIsForContinue</a> = FALSE;
<a name="l00527"></a>00527 
<a name="l00528"></a>00528       <span class="keywordflow">if</span>( <a class="code" href="laptop_8cpp.html#f70f6c2c1a7d6afb0044a2611197a028">LaptopSaveInfo</a>.<a class="code" href="structLaptopSaveInfoStruct.html#a38f8741fa08d0d06663ec8fb8571ccb">iCurrentBalance</a> &lt; <a class="code" href="Town_01Militia_8cpp.html#dc9fb004b47603a7037918ead2c0ee81">giTotalCostOfTraining</a> )
<a name="l00529"></a>00529       {
<a name="l00530"></a>00530             swprintf( sString, <a class="code" href="__DutchText_8cpp.html#60f981814ce8a6b64f73f638021f4c3f">pMilitiaConfirmStrings</a>[ 8 ], <a class="code" href="Town_01Militia_8cpp.html#dc9fb004b47603a7037918ead2c0ee81">giTotalCostOfTraining</a> );
<a name="l00531"></a>00531             <a class="code" href="MessageBoxScreen_8cpp.html#f480404e936544ddb29a371b785dc2f3">DoScreenIndependantMessageBox</a>( sString, MSG_BOX_FLAG_OK, <a class="code" href="Town_01Militia_8cpp.html#28e4ed1f735a6a7698ebbe59352d455c">CantTrainMilitiaOkBoxCallback</a> );
<a name="l00532"></a>00532             <span class="keywordflow">return</span>;
<a name="l00533"></a>00533       }
<a name="l00534"></a>00534 
<a name="l00535"></a>00535       <span class="comment">// ok to start training, ask player</span>
<a name="l00536"></a>00536 
<a name="l00537"></a>00537 
<a name="l00538"></a>00538       <span class="keywordflow">if</span>( iNumberOfSectors &gt; 1 )
<a name="l00539"></a>00539       {
<a name="l00540"></a>00540             swprintf( sString, <a class="code" href="__DutchText_8cpp.html#60f981814ce8a6b64f73f638021f4c3f">pMilitiaConfirmStrings</a>[ 7 ], iNumberOfSectors, <a class="code" href="Town_01Militia_8cpp.html#dc9fb004b47603a7037918ead2c0ee81">giTotalCostOfTraining</a>, <a class="code" href="__DutchText_8cpp.html#60f981814ce8a6b64f73f638021f4c3f">pMilitiaConfirmStrings</a>[ 1 ] );
<a name="l00541"></a>00541       }
<a name="l00542"></a>00542       <span class="keywordflow">else</span>
<a name="l00543"></a>00543       {
<a name="l00544"></a>00544             swprintf( sString, L<span class="stringliteral">"%s%d. %s"</span>, <a class="code" href="__DutchText_8cpp.html#60f981814ce8a6b64f73f638021f4c3f">pMilitiaConfirmStrings</a>[ 0 ], <a class="code" href="Town_01Militia_8cpp.html#dc9fb004b47603a7037918ead2c0ee81">giTotalCostOfTraining</a>, <a class="code" href="__DutchText_8cpp.html#60f981814ce8a6b64f73f638021f4c3f">pMilitiaConfirmStrings</a>[ 1 ] );
<a name="l00545"></a>00545       }
<a name="l00546"></a>00546 
<a name="l00547"></a>00547       <span class="comment">// if we are in mapscreen, make a pop up</span>
<a name="l00548"></a>00548       <span class="keywordflow">if</span>( <a class="code" href="gameloop_8cpp.html#8cd832c7f0ec6ab02ba9fddd4a2257aa">guiCurrentScreen</a> == <a class="code" href="screenids_8h.html#a4ee5dea8709d2b490486a62df77faf26f9c31d9e3c6ef2f0d8e4917d387b871">MAP_SCREEN</a> )
<a name="l00549"></a>00549       {
<a name="l00550"></a>00550             <a class="code" href="Map_01Screen_01Interface_8cpp.html#26dcf8c773526930c16498a61c5dcb66">DoMapMessageBox</a>( <a class="code" href="MessageBoxScreen_8h.html#2f1398dba5e4a5616b83437528bdb28edfaaee6cf60e9dcec27ec0650dbbc39f">MSG_BOX_BASIC_STYLE</a>, (<a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> *)sString, <a class="code" href="screenids_8h.html#a4ee5dea8709d2b490486a62df77faf26f9c31d9e3c6ef2f0d8e4917d387b871">MAP_SCREEN</a>, MSG_BOX_FLAG_YESNO, <a class="code" href="Town_01Militia_8cpp.html#023bb67a797f4a8c6043cc204dd49c31">PayMilitiaTrainingYesNoBoxCallback</a> );
<a name="l00551"></a>00551       }
<a name="l00552"></a>00552       <span class="keywordflow">else</span>
<a name="l00553"></a>00553       {
<a name="l00554"></a>00554             <a class="code" href="MessageBoxScreen_8cpp.html#ff890475da4a6f8d61959852ea396a03">DoMessageBox</a>( <a class="code" href="MessageBoxScreen_8h.html#2f1398dba5e4a5616b83437528bdb28edfaaee6cf60e9dcec27ec0650dbbc39f">MSG_BOX_BASIC_STYLE</a>, (<a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> *)sString, <a class="code" href="screenids_8h.html#a4ee5dea8709d2b490486a62df77faf29873e16bc1530dedb416060abbeea6d0">GAME_SCREEN</a>, MSG_BOX_FLAG_YESNO, <a class="code" href="Town_01Militia_8cpp.html#023bb67a797f4a8c6043cc204dd49c31">PayMilitiaTrainingYesNoBoxCallback</a>, &amp;pCenteringRect );
<a name="l00555"></a>00555       }
<a name="l00556"></a>00556 
<a name="l00557"></a>00557       <span class="keywordflow">return</span>;
<a name="l00558"></a>00558 }
<a name="l00559"></a>00559 
<a name="l00560"></a><a class="code" href="Town_01Militia_8cpp.html#305851cd6cac9dcf0e5d07c4681f880f">00560</a> <span class="keywordtype">void</span> <a class="code" href="Town_01Militia_8cpp.html#305851cd6cac9dcf0e5d07c4681f880f">DoContinueMilitiaTrainingMessageBox</a>( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *<a class="code" href="Button_01System_8cpp.html#ac22642f3052cc77a6991a262ce4ad23">str</a>, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usFlags, <a class="code" href="MessageBoxScreen_8cpp.html#9227e34a11fa44eec4eaec54ef643d21">MSGBOX_CALLBACK</a> ReturnCallback )
<a name="l00561"></a>00561 {
<a name="l00562"></a>00562       <span class="keywordflow">if</span>( sSectorX &lt;= 10 &amp;&amp; sSectorY &gt;= 6 &amp;&amp; sSectorY &lt;= 11 )
<a name="l00563"></a>00563       {
<a name="l00564"></a>00564             <a class="code" href="MessageBoxScreen_8cpp.html#59866ed018ff27149aa8e0365739e1c3">DoLowerScreenIndependantMessageBox</a>( str, usFlags, ReturnCallback );
<a name="l00565"></a>00565       }
<a name="l00566"></a>00566       <span class="keywordflow">else</span>
<a name="l00567"></a>00567       {
<a name="l00568"></a>00568             <a class="code" href="MessageBoxScreen_8cpp.html#f480404e936544ddb29a371b785dc2f3">DoScreenIndependantMessageBox</a>( str, usFlags, ReturnCallback );
<a name="l00569"></a>00569       }
<a name="l00570"></a>00570 }
<a name="l00571"></a>00571 
<a name="l00572"></a><a class="code" href="Town_01Militia_8h.html#2d516089071c014a084c0e61c538cf74">00572</a> <span class="keywordtype">void</span> <a class="code" href="Town_01Militia_8cpp.html#2d516089071c014a084c0e61c538cf74">HandleInterfaceMessageForContinuingTrainingMilitia</a>( <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> )
<a name="l00573"></a>00573 {
<a name="l00574"></a>00574       <a class="code" href="Types_8h.html#fcdf88c1d4179fcd6d8a1fa9bbcb8a80">CHAR16</a> sString[ 128 ];
<a name="l00575"></a>00575       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorX = 0, sSectorY = 0;
<a name="l00576"></a>00576       <a class="code" href="Types_8h.html#fcdf88c1d4179fcd6d8a1fa9bbcb8a80">CHAR16</a> sStringB[ 128 ];
<a name="l00577"></a>00577       <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bTownId;
<a name="l00578"></a>00578 
<a name="l00579"></a>00579 
<a name="l00580"></a>00580       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iMinLoyaltyToTrain = <a class="code" href="GameSettings_8cpp.html#5c32f930e2fef384505c4b91803a92c2">gGameExternalOptions</a>.<a class="code" href="structGAME__EXTERNAL__OPTIONS.html#a08f813ff6015242621fc2cfbdcc59d4">iMinLoyaltyToTrain</a>;
<a name="l00581"></a>00581       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iMilitiaTrainingCost = <a class="code" href="GameSettings_8cpp.html#5c32f930e2fef384505c4b91803a92c2">gGameExternalOptions</a>.<a class="code" href="structGAME__EXTERNAL__OPTIONS.html#312cf0aee51467ca04d89529d66494c8">iMilitiaTrainingCost</a>;
<a name="l00582"></a>00582 DebugMsg (<a class="code" href="DEBUG_8cpp.html#a7985c2fd033797fc67a03b2c26e07c6">TOPIC_JA2</a>,DBG_LEVEL_3,<span class="stringliteral">"Militia3"</span>);
<a name="l00583"></a>00583 
<a name="l00584"></a>00584       sSectorX = <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#6784346500db10daed06c2db02b855c0">sSectorX</a>;
<a name="l00585"></a>00585       sSectorY = <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#6dd68e70c3000beb79e4ac45d28a0cbf">sSectorY</a>;
<a name="l00586"></a>00586 
<a name="l00587"></a>00587       Assert( <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ SECTOR( sSectorX, sSectorY ) ].fMilitiaTrainingPaid == FALSE );
<a name="l00588"></a>00588 
<a name="l00589"></a>00589       <a class="code" href="Assignments_8cpp.html#f6fc5490beeed4fea61f225e930dc560">pMilitiaTrainerSoldier</a> = <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>;
<a name="l00590"></a>00590 
<a name="l00591"></a>00591       <a class="code" href="Town_01Militia_8cpp.html#86e323b36777d78b2ae9a5c0b65381d3">gfYesNoPromptIsForContinue</a> = TRUE;
<a name="l00592"></a>00592 
<a name="l00593"></a>00593       <span class="comment">// is there enough loyalty to continue training</span>
<a name="l00594"></a>00594       <span class="keywordflow">if</span>( <a class="code" href="Assignments_8cpp.html#1b0b29a7fe7ce9923088715b6c4a0a96">DoesSectorMercIsInHaveSufficientLoyaltyToTrainMilitia</a>( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> ) == FALSE )
<a name="l00595"></a>00595       {
<a name="l00596"></a>00596             <span class="comment">// loyalty too low to continue training</span>
<a name="l00597"></a>00597             swprintf( sString, <a class="code" href="__DutchText_8cpp.html#60f981814ce8a6b64f73f638021f4c3f">pMilitiaConfirmStrings</a>[ 9 ], <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#68933d9bb7d357af6609236e47fca927">pTownNames</a>[ <a class="code" href="strategicmap_8cpp.html#99dffd29ea4571bc0c833d45636f1403">GetTownIdForSector</a>( sSectorX, sSectorY )], iMinLoyaltyToTrain );
<a name="l00598"></a>00598             <a class="code" href="Town_01Militia_8cpp.html#305851cd6cac9dcf0e5d07c4681f880f">DoContinueMilitiaTrainingMessageBox</a>( sSectorX, sSectorY, sString, MSG_BOX_FLAG_OK, <a class="code" href="Town_01Militia_8cpp.html#28e4ed1f735a6a7698ebbe59352d455c">CantTrainMilitiaOkBoxCallback</a> );
<a name="l00599"></a>00599             <span class="keywordflow">return</span>;
<a name="l00600"></a>00600       }
<a name="l00601"></a>00601 
<a name="l00602"></a>00602       <span class="keywordflow">if</span> ( <a class="code" href="Assignments_8cpp.html#5cd2c31fb17eb1e19f802e5d0800d675">IsMilitiaTrainableFromSoldiersSectorMaxed</a>( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> ) )
<a name="l00603"></a>00603       {
<a name="l00604"></a>00604             <span class="comment">// we're full!!! go home!</span>
<a name="l00605"></a>00605             bTownId = <a class="code" href="strategicmap_8cpp.html#99dffd29ea4571bc0c833d45636f1403">GetTownIdForSector</a>( sSectorX, sSectorY );
<a name="l00606"></a>00606             <span class="keywordflow">if</span> ( bTownId == <a class="code" href="mapscreen_8h.html#4d1dc70bee62b945929c96dfafebe105d008cfe091b982e6d052565ed0b5acd8">BLANK_SECTOR</a> )
<a name="l00607"></a>00607             {
<a name="l00608"></a>00608                   <span class="comment">// wilderness SAM site</span>
<a name="l00609"></a>00609                   <a class="code" href="strategicmap_8cpp.html#ffa2d45aafc21a44b8dc0177a8cddf96">GetSectorIDString</a>( sSectorX, sSectorY, 0, sStringB, TRUE );
<a name="l00610"></a>00610                   <a class="code" href="expat_8h.html#3980d15795c6349fecd06c1b035c1ae9">void</a> (*tempFptr)(<a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> , <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> , <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a>  , <a class="code" href="Types_8h.html#fcdf88c1d4179fcd6d8a1fa9bbcb8a80">CHAR16</a> *, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a>) = <a class="code" href="strategicmap_8cpp.html#ffa2d45aafc21a44b8dc0177a8cddf96">GetSectorIDString</a>;
<a name="l00611"></a>00611                   swprintf( (<span class="keywordtype">wchar_t</span> *)sString, (<span class="keywordtype">wchar_t</span> *)<a class="code" href="__DutchText_8cpp.html#60f981814ce8a6b64f73f638021f4c3f">pMilitiaConfirmStrings</a>[ 10 ], sStringB, tempFptr, iMinLoyaltyToTrain );
<a name="l00612"></a>00612             }
<a name="l00613"></a>00613             <span class="keywordflow">else</span>
<a name="l00614"></a>00614             {
<a name="l00615"></a>00615                   <span class="comment">// town</span>
<a name="l00616"></a>00616                   swprintf( (<span class="keywordtype">wchar_t</span> *)sString, (<span class="keywordtype">wchar_t</span> *)<a class="code" href="__DutchText_8cpp.html#60f981814ce8a6b64f73f638021f4c3f">pMilitiaConfirmStrings</a>[ 10 ], <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#68933d9bb7d357af6609236e47fca927">pTownNames</a>[ bTownId ], iMinLoyaltyToTrain );
<a name="l00617"></a>00617             }
<a name="l00618"></a>00618             <a class="code" href="Town_01Militia_8cpp.html#305851cd6cac9dcf0e5d07c4681f880f">DoContinueMilitiaTrainingMessageBox</a>( sSectorX, sSectorY, sString, MSG_BOX_FLAG_OK, <a class="code" href="Town_01Militia_8cpp.html#28e4ed1f735a6a7698ebbe59352d455c">CantTrainMilitiaOkBoxCallback</a> );
<a name="l00619"></a>00619             <span class="keywordflow">return</span>;
<a name="l00620"></a>00620       }
<a name="l00621"></a>00621 
<a name="l00622"></a>00622       <span class="comment">// continue training always handles just one sector at a time</span>
<a name="l00623"></a>00623       <a class="code" href="Town_01Militia_8cpp.html#dc9fb004b47603a7037918ead2c0ee81">giTotalCostOfTraining</a> = iMilitiaTrainingCost;
<a name="l00624"></a>00624 
<a name="l00625"></a>00625       <span class="comment">// can player afford to continue training?</span>
<a name="l00626"></a>00626       <span class="keywordflow">if</span>( <a class="code" href="laptop_8cpp.html#f70f6c2c1a7d6afb0044a2611197a028">LaptopSaveInfo</a>.<a class="code" href="structLaptopSaveInfoStruct.html#a38f8741fa08d0d06663ec8fb8571ccb">iCurrentBalance</a> &lt; <a class="code" href="Town_01Militia_8cpp.html#dc9fb004b47603a7037918ead2c0ee81">giTotalCostOfTraining</a> )
<a name="l00627"></a>00627       {
<a name="l00628"></a>00628             <span class="comment">// can't afford to continue training</span>
<a name="l00629"></a>00629             swprintf( sString, <a class="code" href="__DutchText_8cpp.html#60f981814ce8a6b64f73f638021f4c3f">pMilitiaConfirmStrings</a>[ 8 ], <a class="code" href="Town_01Militia_8cpp.html#dc9fb004b47603a7037918ead2c0ee81">giTotalCostOfTraining</a> );
<a name="l00630"></a>00630             <a class="code" href="Town_01Militia_8cpp.html#305851cd6cac9dcf0e5d07c4681f880f">DoContinueMilitiaTrainingMessageBox</a>( sSectorX, sSectorY, sString, MSG_BOX_FLAG_OK, <a class="code" href="Town_01Militia_8cpp.html#28e4ed1f735a6a7698ebbe59352d455c">CantTrainMilitiaOkBoxCallback</a> );
<a name="l00631"></a>00631             <span class="keywordflow">return</span>;
<a name="l00632"></a>00632       }
<a name="l00633"></a>00633 
<a name="l00634"></a>00634       <span class="comment">// ok to continue, ask player</span>
<a name="l00635"></a>00635 
<a name="l00636"></a>00636       <a class="code" href="strategicmap_8cpp.html#ffa2d45aafc21a44b8dc0177a8cddf96">GetSectorIDString</a>( sSectorX, sSectorY, 0, sStringB, TRUE );
<a name="l00637"></a>00637       swprintf( sString, <a class="code" href="__DutchText_8cpp.html#60f981814ce8a6b64f73f638021f4c3f">pMilitiaConfirmStrings</a>[ 3 ], sStringB, <a class="code" href="__DutchText_8cpp.html#60f981814ce8a6b64f73f638021f4c3f">pMilitiaConfirmStrings</a>[ 4 ], <a class="code" href="Town_01Militia_8cpp.html#dc9fb004b47603a7037918ead2c0ee81">giTotalCostOfTraining</a> );
<a name="l00638"></a>00638 
<a name="l00639"></a>00639       <span class="comment">// ask player whether he'd like to continue training</span>
<a name="l00640"></a>00640       <span class="comment">//DoContinueMilitiaTrainingMessageBox( sSectorX, sSectorY, sString, MSG_BOX_FLAG_YESNO, PayMilitiaTrainingYesNoBoxCallback );</span>
<a name="l00641"></a>00641       <a class="code" href="Map_01Screen_01Interface_8cpp.html#26dcf8c773526930c16498a61c5dcb66">DoMapMessageBox</a>( <a class="code" href="MessageBoxScreen_8h.html#2f1398dba5e4a5616b83437528bdb28edfaaee6cf60e9dcec27ec0650dbbc39f">MSG_BOX_BASIC_STYLE</a>, (<a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> *)sString, <a class="code" href="screenids_8h.html#a4ee5dea8709d2b490486a62df77faf26f9c31d9e3c6ef2f0d8e4917d387b871">MAP_SCREEN</a>, MSG_BOX_FLAG_YESNO, <a class="code" href="Town_01Militia_8cpp.html#023bb67a797f4a8c6043cc204dd49c31">PayMilitiaTrainingYesNoBoxCallback</a> );
<a name="l00642"></a>00642 }
<a name="l00643"></a>00643 
<a name="l00644"></a>00644 
<a name="l00645"></a>00645 
<a name="l00646"></a>00646 <span class="comment">// IMPORTANT: This same callback is used both for initial training and for continue training prompt</span>
<a name="l00647"></a>00647 <span class="comment">// use 'gfYesNoPromptIsForContinue' flag to tell them apart</span>
<a name="l00648"></a><a class="code" href="Town_01Militia_8cpp.html#023bb67a797f4a8c6043cc204dd49c31">00648</a> <span class="keywordtype">void</span> <a class="code" href="Town_01Militia_8cpp.html#023bb67a797f4a8c6043cc204dd49c31">PayMilitiaTrainingYesNoBoxCallback</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> bExitValue )
<a name="l00649"></a>00649 {
<a name="l00650"></a>00650       <a class="code" href="Types_8h.html#fcdf88c1d4179fcd6d8a1fa9bbcb8a80">CHAR16</a> sString[ 128 ];
<a name="l00651"></a>00651 
<a name="l00652"></a>00652       Assert( <a class="code" href="Town_01Militia_8cpp.html#dc9fb004b47603a7037918ead2c0ee81">giTotalCostOfTraining</a> &gt; 0 );
<a name="l00653"></a>00653 
<a name="l00654"></a>00654       <span class="comment">// yes</span>
<a name="l00655"></a>00655   <span class="keywordflow">if</span>( bExitValue == MSG_BOX_RETURN_YES )
<a name="l00656"></a>00656       {
<a name="l00657"></a>00657             <span class="comment">// does the player have enough</span>
<a name="l00658"></a>00658             <span class="keywordflow">if</span>( <a class="code" href="laptop_8cpp.html#f70f6c2c1a7d6afb0044a2611197a028">LaptopSaveInfo</a>.<a class="code" href="structLaptopSaveInfoStruct.html#a38f8741fa08d0d06663ec8fb8571ccb">iCurrentBalance</a> &gt;= <a class="code" href="Town_01Militia_8cpp.html#dc9fb004b47603a7037918ead2c0ee81">giTotalCostOfTraining</a> )
<a name="l00659"></a>00659             {
<a name="l00660"></a>00660                   <span class="keywordflow">if</span>( <a class="code" href="Town_01Militia_8cpp.html#86e323b36777d78b2ae9a5c0b65381d3">gfYesNoPromptIsForContinue</a> )
<a name="l00661"></a>00661                   {
<a name="l00662"></a>00662                         <a class="code" href="Town_01Militia_8cpp.html#7cd331b0f36945bed7155f750eb9b739">ContinueTrainingInThisSector</a>();
<a name="l00663"></a>00663                   }
<a name="l00664"></a>00664                   <span class="keywordflow">else</span>
<a name="l00665"></a>00665                   {
<a name="l00666"></a>00666                         <a class="code" href="Town_01Militia_8cpp.html#62df96ee814f86ce09ffc78f23163938">StartTrainingInAllUnpaidTrainableSectors</a>();
<a name="l00667"></a>00667                   }
<a name="l00668"></a>00668 
<a name="l00669"></a>00669 <span class="preprocessor">#ifdef JA2BETAVERSION</span>
<a name="l00670"></a>00670 <span class="preprocessor"></span>                  <span class="comment">// put this BEFORE training gets handled to avoid detecting an error everytime a sector completes training</span>
<a name="l00671"></a>00671                   <a class="code" href="Assignments_8cpp.html#8ed61e31dc0b97e88f2aaf050a0b47d0">VerifyTownTrainingIsPaidFor</a>();
<a name="l00672"></a>00672 <span class="preprocessor">#endif</span>
<a name="l00673"></a>00673 <span class="preprocessor"></span>
<a name="l00674"></a>00674                   <span class="comment">// this completes the training prompt sequence</span>
<a name="l00675"></a>00675                   <a class="code" href="Assignments_8cpp.html#f6fc5490beeed4fea61f225e930dc560">pMilitiaTrainerSoldier</a> = NULL;
<a name="l00676"></a>00676             }
<a name="l00677"></a>00677             <span class="keywordflow">else</span>  <span class="comment">// can't afford it</span>
<a name="l00678"></a>00678             {
<a name="l00679"></a>00679                   <a class="code" href="Game_01Clock_8cpp.html#571d623de0660dfd350dbbc43ac0cd90">StopTimeCompression</a>();
<a name="l00680"></a>00680 
<a name="l00681"></a>00681                   swprintf( sString, L<span class="stringliteral">"%s"</span>, <a class="code" href="__DutchText_8cpp.html#60f981814ce8a6b64f73f638021f4c3f">pMilitiaConfirmStrings</a>[ 2 ] );
<a name="l00682"></a>00682                   <a class="code" href="Map_01Screen_01Interface_8cpp.html#26dcf8c773526930c16498a61c5dcb66">DoMapMessageBox</a>( <a class="code" href="MessageBoxScreen_8h.html#2f1398dba5e4a5616b83437528bdb28edfaaee6cf60e9dcec27ec0650dbbc39f">MSG_BOX_BASIC_STYLE</a>, (<a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> *)sString, <a class="code" href="screenids_8h.html#a4ee5dea8709d2b490486a62df77faf26f9c31d9e3c6ef2f0d8e4917d387b871">MAP_SCREEN</a>, MSG_BOX_FLAG_OK, <a class="code" href="Town_01Militia_8cpp.html#28e4ed1f735a6a7698ebbe59352d455c">CantTrainMilitiaOkBoxCallback</a> );
<a name="l00683"></a>00683             }
<a name="l00684"></a>00684       }
<a name="l00685"></a>00685       <span class="keywordflow">else</span> <span class="keywordflow">if</span>( bExitValue == MSG_BOX_RETURN_NO )
<a name="l00686"></a>00686       {
<a name="l00687"></a>00687             <a class="code" href="Game_01Clock_8cpp.html#571d623de0660dfd350dbbc43ac0cd90">StopTimeCompression</a>();
<a name="l00688"></a>00688 
<a name="l00689"></a>00689             <a class="code" href="Town_01Militia_8cpp.html#e188e7f8e9bd8d10030f9dbd3483fa73">MilitiaTrainingRejected</a>();
<a name="l00690"></a>00690       }
<a name="l00691"></a>00691 
<a name="l00692"></a>00692       <span class="keywordflow">return</span>;
<a name="l00693"></a>00693 }
<a name="l00694"></a>00694 
<a name="l00695"></a>00695 
<a name="l00696"></a><a class="code" href="Town_01Militia_8cpp.html#28e4ed1f735a6a7698ebbe59352d455c">00696</a> <span class="keywordtype">void</span> <a class="code" href="Town_01Militia_8cpp.html#28e4ed1f735a6a7698ebbe59352d455c">CantTrainMilitiaOkBoxCallback</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> bExitValue )
<a name="l00697"></a>00697 {
<a name="l00698"></a>00698       <a class="code" href="Town_01Militia_8cpp.html#e188e7f8e9bd8d10030f9dbd3483fa73">MilitiaTrainingRejected</a>();
<a name="l00699"></a>00699       <span class="keywordflow">return</span>;
<a name="l00700"></a>00700 }
<a name="l00701"></a>00701 
<a name="l00702"></a>00702 
<a name="l00703"></a>00703 <span class="comment">// IMPORTANT: This same callback is used both for initial training and for continue training prompt</span>
<a name="l00704"></a>00704 <span class="comment">// use 'gfYesNoPromptIsForContinue' flag to tell them apart</span>
<a name="l00705"></a><a class="code" href="Town_01Militia_8cpp.html#e188e7f8e9bd8d10030f9dbd3483fa73">00705</a> <span class="keywordtype">void</span> <a class="code" href="Town_01Militia_8cpp.html#e188e7f8e9bd8d10030f9dbd3483fa73">MilitiaTrainingRejected</a>( <span class="keywordtype">void</span> )
<a name="l00706"></a>00706 {
<a name="l00707"></a>00707       <span class="keywordflow">if</span>( <a class="code" href="Town_01Militia_8cpp.html#86e323b36777d78b2ae9a5c0b65381d3">gfYesNoPromptIsForContinue</a> )
<a name="l00708"></a>00708       {
<a name="l00709"></a>00709             <span class="comment">// take all mercs in that sector off militia training</span>
<a name="l00710"></a>00710             <a class="code" href="Map_01Screen_01Interface_8cpp.html#f92a68bb50572ce789b4eebe9a5bf451">ResetAssignmentOfMercsThatWereTrainingMilitiaInThisSector</a>( <a class="code" href="Assignments_8cpp.html#f6fc5490beeed4fea61f225e930dc560">pMilitiaTrainerSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#6784346500db10daed06c2db02b855c0">sSectorX</a>, <a class="code" href="Assignments_8cpp.html#f6fc5490beeed4fea61f225e930dc560">pMilitiaTrainerSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#6dd68e70c3000beb79e4ac45d28a0cbf">sSectorY</a> );
<a name="l00711"></a>00711       }
<a name="l00712"></a>00712       <span class="keywordflow">else</span>
<a name="l00713"></a>00713       {
<a name="l00714"></a>00714             <span class="comment">// take all mercs in unpaid sectors EVERYWHERE off militia training</span>
<a name="l00715"></a>00715             <a class="code" href="Map_01Screen_01Interface_8cpp.html#a5bd06e43e0023f92f2955733054ae7b">ResetAssignmentsForMercsTrainingUnpaidSectorsInSelectedList</a>( 0 );
<a name="l00716"></a>00716       }
<a name="l00717"></a>00717 
<a name="l00718"></a>00718 <span class="preprocessor">#ifdef JA2BETAVERSION</span>
<a name="l00719"></a>00719 <span class="preprocessor"></span>      <span class="comment">// put this BEFORE training gets handled to avoid detecting an error everytime a sector completes training</span>
<a name="l00720"></a>00720       <a class="code" href="Assignments_8cpp.html#8ed61e31dc0b97e88f2aaf050a0b47d0">VerifyTownTrainingIsPaidFor</a>();
<a name="l00721"></a>00721 <span class="preprocessor">#endif</span>
<a name="l00722"></a>00722 <span class="preprocessor"></span>
<a name="l00723"></a>00723       <span class="comment">// this completes the training prompt sequence</span>
<a name="l00724"></a>00724       <a class="code" href="Assignments_8cpp.html#f6fc5490beeed4fea61f225e930dc560">pMilitiaTrainerSoldier</a> = NULL;
<a name="l00725"></a>00725 }
<a name="l00726"></a>00726 
<a name="l00727"></a>00727 
<a name="l00728"></a>00728 
<a name="l00729"></a><a class="code" href="Town_01Militia_8h.html#f3fe7ba90dab70d6093cbed87d551666">00729</a> <span class="keywordtype">void</span> <a class="code" href="Town_01Militia_8cpp.html#f3fe7ba90dab70d6093cbed87d551666">HandleMilitiaStatusInCurrentMapBeforeLoadingNewMap</a>( <span class="keywordtype">void</span> )
<a name="l00730"></a>00730 {
<a name="l00731"></a>00731       <span class="keywordflow">if</span> ( <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#2ecddfe580bb019bc92cc4859eaf3edc">Team</a>[ MILITIA_TEAM ].<a class="code" href="structTacticalTeamType.html#ae2dc80f36a253171cbe752592926683">bSide</a> != 0 )
<a name="l00732"></a>00732       {
<a name="l00733"></a>00733             <span class="comment">// handle militia defections and reset team to friendly</span>
<a name="l00734"></a>00734             <a class="code" href="Town_01Militia_8cpp.html#ab5a2c14f98f11be8eb3d557eb671267">HandleMilitiaDefections</a>( <a class="code" href="strategicmap_8cpp.html#49d9aed144a633fda4ba1990f002d703">gWorldSectorX</a>, <a class="code" href="strategicmap_8cpp.html#ea322310ced0e35ee18a2ee7b32aac5b">gWorldSectorY</a> );
<a name="l00735"></a>00735             <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#2ecddfe580bb019bc92cc4859eaf3edc">Team</a>[ MILITIA_TEAM ].<a class="code" href="structTacticalTeamType.html#ae2dc80f36a253171cbe752592926683">bSide</a> = 0;
<a name="l00736"></a>00736       }
<a name="l00737"></a>00737       <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !<a class="code" href="PreBattle_01Interface_8cpp.html#c2b7344a3b53c65feabd6a9679ca5157">gfAutomaticallyStartAutoResolve</a> )
<a name="l00738"></a>00738       { <span class="comment">//Don't promote militia if we are going directly to autoresolve to finish the current battle.</span>
<a name="l00739"></a>00739             <a class="code" href="Militia_01Control_8cpp.html#8fb41fd1e989ec4426c74d50c4e92978">HandleMilitiaPromotions</a>();
<a name="l00740"></a>00740       }
<a name="l00741"></a>00741 }
<a name="l00742"></a>00742 
<a name="l00743"></a>00743 
<a name="l00744"></a><a class="code" href="Town_01Militia_8h.html#83a51bcbaa9300d9e6497d6ac24901e3">00744</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Town_01Militia_8cpp.html#83a51bcbaa9300d9e6497d6ac24901e3">CanNearbyMilitiaScoutThisSector</a>( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorY )
<a name="l00745"></a>00745 {
<a name="l00746"></a>00746       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorValue = 0, sSector = 0;
<a name="l00747"></a>00747       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sCounterA = 0, sCounterB = 0;
<a name="l00748"></a>00748       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubScoutingRange = 1;
<a name="l00749"></a>00749 
<a name="l00750"></a>00750 
<a name="l00751"></a>00751       <span class="comment">// get the sector value</span>
<a name="l00752"></a>00752       sSector = sSectorX + sSectorY * MAP_WORLD_X;
<a name="l00753"></a>00753 
<a name="l00754"></a>00754       <span class="keywordflow">for</span>( sCounterA = sSectorX - ubScoutingRange; sCounterA &lt;= sSectorX + ubScoutingRange; sCounterA++ )
<a name="l00755"></a>00755       {
<a name="l00756"></a>00756             <span class="keywordflow">for</span>( sCounterB = sSectorY - ubScoutingRange; sCounterB &lt;= sSectorY + ubScoutingRange; sCounterB++ )
<a name="l00757"></a>00757             {
<a name="l00758"></a>00758                   <span class="comment">// skip out of bounds sectors</span>
<a name="l00759"></a>00759                   <span class="keywordflow">if</span> ( ( sCounterA &lt; 1 ) || ( sCounterA &gt; 16 ) || ( sCounterB &lt; 1 ) || ( sCounterB &gt; 16 ) )
<a name="l00760"></a>00760                   {
<a name="l00761"></a>00761                         <span class="keywordflow">continue</span>;
<a name="l00762"></a>00762                   }
<a name="l00763"></a>00763 
<a name="l00764"></a>00764                   sSectorValue = SECTOR( sCounterA, sCounterB );
<a name="l00765"></a>00765 
<a name="l00766"></a>00766                   <span class="comment">// check if any sort of militia here</span>
<a name="l00767"></a>00767                   <span class="keywordflow">if</span>( <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ sSectorValue ].ubNumberOfCivsAtLevel[ <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840b225c8d872b15875355f348d6e3335b">GREEN_MILITIA</a> ] )
<a name="l00768"></a>00768                   {
<a name="l00769"></a>00769                         <span class="keywordflow">return</span>( TRUE );
<a name="l00770"></a>00770                   }
<a name="l00771"></a>00771                   <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ sSectorValue ].ubNumberOfCivsAtLevel[ <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a845612214b681e2988ea93890806802cc9">REGULAR_MILITIA</a> ] )
<a name="l00772"></a>00772                   {
<a name="l00773"></a>00773                         <span class="keywordflow">return</span>( TRUE );
<a name="l00774"></a>00774                   }
<a name="l00775"></a>00775                   <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ sSectorValue ].ubNumberOfCivsAtLevel[ <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840fcf7fc556b8af2f6d3ec39652d3a927">ELITE_MILITIA</a> ] )
<a name="l00776"></a>00776                   {
<a name="l00777"></a>00777                         <span class="keywordflow">return</span>( TRUE );
<a name="l00778"></a>00778                   }
<a name="l00779"></a>00779             }
<a name="l00780"></a>00780       }
<a name="l00781"></a>00781 
<a name="l00782"></a>00782       <span class="keywordflow">return</span>( FALSE );
<a name="l00783"></a>00783 }
<a name="l00784"></a>00784 
<a name="l00785"></a><a class="code" href="Town_01Militia_8h.html#9ae0dd3f061fa6ab06132c1a7e62f862">00785</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Town_01Militia_8cpp.html#9ae0dd3f061fa6ab06132c1a7e62f862">IsTownFullMilitia</a>( <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bTownId )
<a name="l00786"></a>00786 {
<a name="l00787"></a>00787       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iMaxMilitiaPerSector = <a class="code" href="GameSettings_8cpp.html#5c32f930e2fef384505c4b91803a92c2">gGameExternalOptions</a>.<a class="code" href="structGAME__EXTERNAL__OPTIONS.html#9db98fdba0ff76f98649cc6c3ded3392">iMaxMilitiaPerSector</a>;
<a name="l00788"></a>00788 DebugMsg (<a class="code" href="DEBUG_8cpp.html#a7985c2fd033797fc67a03b2c26e07c6">TOPIC_JA2</a>,DBG_LEVEL_3,<span class="stringliteral">"Militia4"</span>);
<a name="l00789"></a>00789 
<a name="l00790"></a>00790       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iCounter = 0;
<a name="l00791"></a>00791       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorX = 0, sSectorY = 0;
<a name="l00792"></a>00792       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iNumberOfMilitia = 0;
<a name="l00793"></a>00793       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iMaxNumber = 0;
<a name="l00794"></a>00794 
<a name="l00795"></a>00795       <span class="keywordflow">while</span>( <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#1001d8cb48db71e9db760efbf4353e6a">pTownNamesList</a>[ iCounter ] != 0 )
<a name="l00796"></a>00796       {     
<a name="l00797"></a>00797             <span class="keywordflow">if</span>( <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#1001d8cb48db71e9db760efbf4353e6a">pTownNamesList</a>[ iCounter ] == bTownId )
<a name="l00798"></a>00798             {
<a name="l00799"></a>00799                   <span class="comment">// get the sector x and y</span>
<a name="l00800"></a>00800                   sSectorX = <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#c994e67a1f8511a80e6418dc483b0861">pTownLocationsList</a>[ iCounter ] % MAP_WORLD_X;
<a name="l00801"></a>00801                   sSectorY = <a class="code" href="Strategic_01Town_01Loyalty_8cpp.html#c994e67a1f8511a80e6418dc483b0861">pTownLocationsList</a>[ iCounter ] / MAP_WORLD_X;
<a name="l00802"></a>00802 
<a name="l00803"></a>00803                   <span class="comment">// if sector is ours get number of militia here</span>
<a name="l00804"></a>00804                   <span class="keywordflow">if</span>( <a class="code" href="Town_01Militia_8cpp.html#01dd2be30e6898d4dcce7f876a11bee6">SectorOursAndPeaceful</a>( sSectorX, sSectorY, 0 ) )
<a name="l00805"></a>00805                   {
<a name="l00806"></a>00806                         <span class="comment">// don't count GREEN militia, they can be trained into regulars first</span>
<a name="l00807"></a>00807                         iNumberOfMilitia += <a class="code" href="Town_01Militia_8cpp.html#5d75ed19e423a36b9384185bc181fcb3">MilitiaInSectorOfRank</a>( sSectorX, sSectorY, <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a845612214b681e2988ea93890806802cc9">REGULAR_MILITIA</a> );
<a name="l00808"></a>00808                         iNumberOfMilitia += <a class="code" href="Town_01Militia_8cpp.html#5d75ed19e423a36b9384185bc181fcb3">MilitiaInSectorOfRank</a>( sSectorX, sSectorY, <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840fcf7fc556b8af2f6d3ec39652d3a927">ELITE_MILITIA</a> );
<a name="l00809"></a>00809                         iMaxNumber += iMaxMilitiaPerSector;
<a name="l00810"></a>00810                   }
<a name="l00811"></a>00811             }
<a name="l00812"></a>00812 
<a name="l00813"></a>00813             iCounter++;
<a name="l00814"></a>00814       }
<a name="l00815"></a>00815 
<a name="l00816"></a>00816       <span class="comment">// now check the number of militia</span>
<a name="l00817"></a>00817       <span class="keywordflow">if</span> ( iMaxNumber &gt; iNumberOfMilitia )
<a name="l00818"></a>00818       {
<a name="l00819"></a>00819             <span class="keywordflow">return</span>( FALSE );
<a name="l00820"></a>00820       }
<a name="l00821"></a>00821 
<a name="l00822"></a>00822       <span class="keywordflow">return</span>( TRUE );
<a name="l00823"></a>00823 }
<a name="l00824"></a>00824 
<a name="l00825"></a><a class="code" href="Town_01Militia_8h.html#455f6e033d6c890cc82213756a599d6e">00825</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Town_01Militia_8cpp.html#455f6e033d6c890cc82213756a599d6e">IsSAMSiteFullOfMilitia</a>( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorY )
<a name="l00826"></a>00826 {
<a name="l00827"></a>00827       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fSamSitePresent = FALSE;
<a name="l00828"></a>00828       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iNumberOfMilitia = 0;
<a name="l00829"></a>00829       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iMaxNumber = 0;
<a name="l00830"></a>00830       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iMaxMilitiaPerSector = <a class="code" href="GameSettings_8cpp.html#5c32f930e2fef384505c4b91803a92c2">gGameExternalOptions</a>.<a class="code" href="structGAME__EXTERNAL__OPTIONS.html#9db98fdba0ff76f98649cc6c3ded3392">iMaxMilitiaPerSector</a>;
<a name="l00831"></a>00831 DebugMsg (<a class="code" href="DEBUG_8cpp.html#a7985c2fd033797fc67a03b2c26e07c6">TOPIC_JA2</a>,DBG_LEVEL_3,<span class="stringliteral">"Militia5"</span>);
<a name="l00832"></a>00832       <span class="comment">// check if SAM site is ours?</span>
<a name="l00833"></a>00833       fSamSitePresent = <a class="code" href="strategicmap_8cpp.html#aad459c13b87dd12c43c473c71641070">IsThisSectorASAMSector</a>(  sSectorX, sSectorY, 0 );
<a name="l00834"></a>00834 
<a name="l00835"></a>00835       <span class="keywordflow">if</span>( fSamSitePresent == FALSE )
<a name="l00836"></a>00836       {
<a name="l00837"></a>00837             <span class="keywordflow">return</span>( FALSE );
<a name="l00838"></a>00838       }
<a name="l00839"></a>00839 
<a name="l00840"></a>00840       <span class="keywordflow">if</span>( <a class="code" href="Town_01Militia_8cpp.html#01dd2be30e6898d4dcce7f876a11bee6">SectorOursAndPeaceful</a>( sSectorX, sSectorY, 0 ) )
<a name="l00841"></a>00841       {
<a name="l00842"></a>00842             <span class="comment">// don't count GREEN militia, they can be trained into regulars first</span>
<a name="l00843"></a>00843             iNumberOfMilitia += <a class="code" href="Town_01Militia_8cpp.html#5d75ed19e423a36b9384185bc181fcb3">MilitiaInSectorOfRank</a>( sSectorX, sSectorY, <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a845612214b681e2988ea93890806802cc9">REGULAR_MILITIA</a> );
<a name="l00844"></a>00844             iNumberOfMilitia += <a class="code" href="Town_01Militia_8cpp.html#5d75ed19e423a36b9384185bc181fcb3">MilitiaInSectorOfRank</a>( sSectorX, sSectorY, <a class="code" href="Campaign_01Types_8h.html#6fde86696b9fb4575b16ddc150ff0a840fcf7fc556b8af2f6d3ec39652d3a927">ELITE_MILITIA</a> );
<a name="l00845"></a>00845             iMaxNumber += iMaxMilitiaPerSector;
<a name="l00846"></a>00846       }
<a name="l00847"></a>00847 
<a name="l00848"></a>00848       <span class="comment">// now check the number of militia</span>
<a name="l00849"></a>00849       <span class="keywordflow">if</span> ( iMaxNumber &gt; iNumberOfMilitia )
<a name="l00850"></a>00850       {
<a name="l00851"></a>00851             <span class="keywordflow">return</span>( FALSE );
<a name="l00852"></a>00852       }
<a name="l00853"></a>00853 
<a name="l00854"></a>00854       <span class="keywordflow">return</span>( TRUE );
<a name="l00855"></a>00855 }
<a name="l00856"></a>00856 
<a name="l00857"></a>00857 
<a name="l00858"></a><a class="code" href="Town_01Militia_8h.html#1c4ce62b438666763a9c0855996dd4fc">00858</a> <span class="keywordtype">void</span> <a class="code" href="Town_01Militia_8cpp.html#1c4ce62b438666763a9c0855996dd4fc">HandleCompletionOfTownTrainingByGroupWithTrainer</a>( <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *pTrainer )
<a name="l00859"></a>00859 {
<a name="l00860"></a>00860 
<a name="l00861"></a>00861       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorX = 0, sSectorY = 0;
<a name="l00862"></a>00862       <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bSectorZ = 0;
<a name="l00863"></a>00863       <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> = NULL;
<a name="l00864"></a>00864       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iCounter = 0;
<a name="l00865"></a>00865 
<a name="l00866"></a>00866 
<a name="l00867"></a>00867       <span class="comment">// get the sector values</span>
<a name="l00868"></a>00868       sSectorX = pTrainer-&gt;<a class="code" href="structSOLDIERTYPE.html#6784346500db10daed06c2db02b855c0">sSectorX</a>;
<a name="l00869"></a>00869       sSectorY = pTrainer-&gt;<a class="code" href="structSOLDIERTYPE.html#6dd68e70c3000beb79e4ac45d28a0cbf">sSectorY</a>;
<a name="l00870"></a>00870       bSectorZ = pTrainer-&gt;<a class="code" href="structSOLDIERTYPE.html#b70b761f0405cc179c1ffba84484df28">bSectorZ</a>;
<a name="l00871"></a>00871 
<a name="l00872"></a>00872       <span class="keywordflow">for</span>( iCounter = 0; iCounter &lt; MAX_CHARACTER_COUNT; iCounter++ )
<a name="l00873"></a>00873       {
<a name="l00874"></a>00874             <span class="comment">// valid character?</span>
<a name="l00875"></a>00875             <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Interface_8cpp.html#a800323f5af9722f82bfbd00b388bbd9">gCharactersList</a>[ iCounter ].fValid == FALSE )
<a name="l00876"></a>00876             {
<a name="l00877"></a>00877                   <span class="comment">// nope</span>
<a name="l00878"></a>00878                   <span class="keywordflow">continue</span>;
<a name="l00879"></a>00879             }
<a name="l00880"></a>00880 
<a name="l00881"></a>00881             <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> = &amp;<a class="code" href="Overhead_8cpp.html#f1785e87ea281d015350ec85b9bd8508">Menptr</a>[ <a class="code" href="Map_01Screen_01Interface_8cpp.html#a800323f5af9722f82bfbd00b388bbd9">gCharactersList</a>[ iCounter ].<a class="code" href="structMapScreenCharacterSt.html#6ef6247ab890bd960c34602d36c8c7af">usSolID</a> ];
<a name="l00882"></a>00882 
<a name="l00883"></a>00883             <span class="comment">// valid soldier?</span>
<a name="l00884"></a>00884             <span class="keywordflow">if</span>( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#653dad4e2520784e293eca9f948b8532">bActive</a> == FALSE )
<a name="l00885"></a>00885             {
<a name="l00886"></a>00886                   <span class="keywordflow">continue</span>;
<a name="l00887"></a>00887             }
<a name="l00888"></a>00888 
<a name="l00889"></a>00889             <span class="keywordflow">if</span>( ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#4269b53195147b458cd1e6874429734b">bAssignment</a> == <a class="code" href="Assignments_8h.html#16db4876b192da08f3ad0cb41afe516f060ca182475849caac7325fdd4f55cce">TRAIN_TOWN</a> ) &amp;&amp; ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#6784346500db10daed06c2db02b855c0">sSectorX</a> == sSectorX )&amp;&amp;( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#6dd68e70c3000beb79e4ac45d28a0cbf">sSectorY</a> == sSectorY )&amp;&amp;( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#b70b761f0405cc179c1ffba84484df28">bSectorZ</a> == bSectorZ ) )
<a name="l00890"></a>00890             {
<a name="l00891"></a>00891                   <span class="comment">// done assignment</span>
<a name="l00892"></a>00892                   <a class="code" href="Assignments_8cpp.html#1b8dd88b03c418ca466e71eba1dba6ae">AssignmentDone</a>( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>, FALSE, FALSE );
<a name="l00893"></a>00893             }
<a name="l00894"></a>00894       }
<a name="l00895"></a>00895 
<a name="l00896"></a>00896 
<a name="l00897"></a>00897       <span class="keywordflow">return</span>;
<a name="l00898"></a>00898 }
<a name="l00899"></a>00899 
<a name="l00900"></a><a class="code" href="Town_01Militia_8cpp.html#d0563a5cc1006782b76ccfa23dd5e29d">00900</a> <span class="keywordtype">void</span> <a class="code" href="Assignments_8cpp.html#d0563a5cc1006782b76ccfa23dd5e29d">AddSectorForSoldierToListOfSectorsThatCompletedMilitiaTraining</a>( <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> )
<a name="l00901"></a>00901 {
<a name="l00902"></a>00902       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iCounter = 0;
<a name="l00903"></a>00903       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSector = 0, sCurrentSector = 0;
<a name="l00904"></a>00904       <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *pCurrentSoldier = NULL;
<a name="l00905"></a>00905 
<a name="l00906"></a>00906       <span class="comment">// get the sector value</span>
<a name="l00907"></a>00907       sSector = <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#6784346500db10daed06c2db02b855c0">sSectorX</a> + <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#6dd68e70c3000beb79e4ac45d28a0cbf">sSectorY</a> * MAP_WORLD_X;
<a name="l00908"></a>00908 
<a name="l00909"></a>00909       <span class="keywordflow">while</span>( <a class="code" href="Town_01Militia_8cpp.html#3488a42037d11f6b6caf919e75919fe2">giListOfMercsInSectorsCompletedMilitiaTraining</a>[ iCounter ] != -1 )
<a name="l00910"></a>00910       {
<a name="l00911"></a>00911             <span class="comment">// get the current soldier</span>
<a name="l00912"></a>00912             pCurrentSoldier = &amp;<a class="code" href="Overhead_8cpp.html#f1785e87ea281d015350ec85b9bd8508">Menptr</a>[ <a class="code" href="Town_01Militia_8cpp.html#3488a42037d11f6b6caf919e75919fe2">giListOfMercsInSectorsCompletedMilitiaTraining</a>[ iCounter ] ];
<a name="l00913"></a>00913 
<a name="l00914"></a>00914             <span class="comment">// get the current sector value</span>
<a name="l00915"></a>00915             sCurrentSector = pCurrentSoldier-&gt;<a class="code" href="structSOLDIERTYPE.html#6784346500db10daed06c2db02b855c0">sSectorX</a> + pCurrentSoldier-&gt;<a class="code" href="structSOLDIERTYPE.html#6dd68e70c3000beb79e4ac45d28a0cbf">sSectorY</a> * MAP_WORLD_X;
<a name="l00916"></a>00916             
<a name="l00917"></a>00917             <span class="comment">// is the merc's sector already in the list?</span>
<a name="l00918"></a>00918             <span class="keywordflow">if</span>( sCurrentSector == sSector )
<a name="l00919"></a>00919             {
<a name="l00920"></a>00920                   <span class="comment">// already here</span>
<a name="l00921"></a>00921                   <span class="keywordflow">return</span>;
<a name="l00922"></a>00922             }
<a name="l00923"></a>00923 
<a name="l00924"></a>00924             iCounter++;
<a name="l00925"></a>00925 
<a name="l00926"></a>00926             Assert( iCounter &lt; SIZE_OF_MILITIA_COMPLETED_TRAINING_LIST );
<a name="l00927"></a>00927       }
<a name="l00928"></a>00928 
<a name="l00929"></a>00929       <span class="comment">// add merc to the list</span>
<a name="l00930"></a>00930       <a class="code" href="Town_01Militia_8cpp.html#3488a42037d11f6b6caf919e75919fe2">giListOfMercsInSectorsCompletedMilitiaTraining</a>[ iCounter ] = <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#18aef170576da81b10d00e7b6cd3627b">ubID</a>;
<a name="l00931"></a>00931       
<a name="l00932"></a>00932       <span class="keywordflow">return</span>;
<a name="l00933"></a>00933 }
<a name="l00934"></a>00934 
<a name="l00935"></a>00935 <span class="comment">// clear out the list of training sectors...should be done once the list is posted</span>
<a name="l00936"></a><a class="code" href="Town_01Militia_8h.html#478382b090a9718dee10bf1a515dff0d">00936</a> <span class="keywordtype">void</span> <a class="code" href="Town_01Militia_8cpp.html#478382b090a9718dee10bf1a515dff0d">ClearSectorListForCompletedTrainingOfMilitia</a>( <span class="keywordtype">void</span> )
<a name="l00937"></a>00937 {
<a name="l00938"></a>00938       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iCounter = 0;
<a name="l00939"></a>00939 
<a name="l00940"></a>00940       <span class="keywordflow">for</span>( iCounter = 0; iCounter &lt; SIZE_OF_MILITIA_COMPLETED_TRAINING_LIST; iCounter++ )
<a name="l00941"></a>00941       {
<a name="l00942"></a>00942             <a class="code" href="Town_01Militia_8cpp.html#3488a42037d11f6b6caf919e75919fe2">giListOfMercsInSectorsCompletedMilitiaTraining</a>[ iCounter ] = -1;
<a name="l00943"></a>00943       }
<a name="l00944"></a>00944 
<a name="l00945"></a>00945       <span class="keywordflow">return</span>;
<a name="l00946"></a>00946 }
<a name="l00947"></a>00947 
<a name="l00948"></a>00948 
<a name="l00949"></a><a class="code" href="Town_01Militia_8h.html#26005eaddeaa8a56db0c32449f7bbb75">00949</a> <span class="keywordtype">void</span> <a class="code" href="Town_01Militia_8cpp.html#26005eaddeaa8a56db0c32449f7bbb75">HandleContinueOfTownTraining</a>( <span class="keywordtype">void</span> )
<a name="l00950"></a>00950 {
<a name="l00951"></a>00951       <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> = NULL;
<a name="l00952"></a>00952       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iCounter = 0;
<a name="l00953"></a>00953       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fContinueEventPosted = FALSE;
<a name="l00954"></a>00954 
<a name="l00955"></a>00955 
<a name="l00956"></a>00956       <span class="keywordflow">while</span>( <a class="code" href="Town_01Militia_8cpp.html#3488a42037d11f6b6caf919e75919fe2">giListOfMercsInSectorsCompletedMilitiaTraining</a>[ iCounter ] != -1 )
<a name="l00957"></a>00957       {
<a name="l00958"></a>00958             <span class="comment">// get the soldier</span>
<a name="l00959"></a>00959             <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> = &amp;<a class="code" href="Overhead_8cpp.html#f1785e87ea281d015350ec85b9bd8508">Menptr</a>[ <a class="code" href="Town_01Militia_8cpp.html#3488a42037d11f6b6caf919e75919fe2">giListOfMercsInSectorsCompletedMilitiaTraining</a>[ iCounter ] ];
<a name="l00960"></a>00960 
<a name="l00961"></a>00961             <span class="keywordflow">if</span>( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#653dad4e2520784e293eca9f948b8532">bActive</a> )
<a name="l00962"></a>00962             {
<a name="l00963"></a>00963                   fContinueEventPosted = TRUE;
<a name="l00964"></a>00964                   <a class="code" href="Dialogue_01Control_8cpp.html#9c7b126747b7255086d33bd7c4764865">SpecialCharacterDialogueEvent</a>( DIALOGUE_SPECIAL_EVENT_CONTINUE_TRAINING_MILITIA, <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#5a5648a1bb3507cc41f6be199c51a3f8">ubProfile</a>, 0, 0, 0, 0 );
<a name="l00965"></a>00965 
<a name="l00966"></a>00966                   <span class="comment">// now set all of these peoples assignment done too</span>
<a name="l00967"></a>00967                   <span class="comment">//HandleInterfaceMessageForContinuingTrainingMilitia( pSoldier );</span>
<a name="l00968"></a>00968             }
<a name="l00969"></a>00969 
<a name="l00970"></a>00970             <span class="comment">// next entry</span>
<a name="l00971"></a>00971             iCounter++;
<a name="l00972"></a>00972       }
<a name="l00973"></a>00973 
<a name="l00974"></a>00974       <span class="comment">// now clear the list</span>
<a name="l00975"></a>00975       <a class="code" href="Town_01Militia_8cpp.html#478382b090a9718dee10bf1a515dff0d">ClearSectorListForCompletedTrainingOfMilitia</a>( );
<a name="l00976"></a>00976 
<a name="l00977"></a>00977       <span class="keywordflow">if</span>( fContinueEventPosted )
<a name="l00978"></a>00978       { 
<a name="l00979"></a>00979     <span class="comment">// ATE: If this event happens in tactical mode we will be switching at some time to mapscreen...</span>
<a name="l00980"></a>00980     <span class="keywordflow">if</span> ( <a class="code" href="gameloop_8cpp.html#8cd832c7f0ec6ab02ba9fddd4a2257aa">guiCurrentScreen</a> == <a class="code" href="screenids_8h.html#a4ee5dea8709d2b490486a62df77faf29873e16bc1530dedb416060abbeea6d0">GAME_SCREEN</a> )
<a name="l00981"></a>00981     {
<a name="l00982"></a>00982               <a class="code" href="gamescreen_8cpp.html#d845bd2dc817b9afa52df6eb115ac413">gfEnteringMapScreen</a> = TRUE;
<a name="l00983"></a>00983     }
<a name="l00984"></a>00984 
<a name="l00985"></a>00985             <span class="comment">//If the militia view isn't currently active, then turn it on when prompting to continue training.</span>
<a name="l00986"></a>00986             <span class="keywordflow">if</span> ( !<a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#046cad083db131ea9be5f91417b1f13e">fShowMilitia</a> )
<a name="l00987"></a>00987     {
<a name="l00988"></a>00988               <a class="code" href="Map_01Screen_01Interface_01Border_8cpp.html#495098b90b6731d286e5c1c1f12a49c2">ToggleShowMilitiaMode</a>();
<a name="l00989"></a>00989     }
<a name="l00990"></a>00990       }
<a name="l00991"></a>00991 
<a name="l00992"></a>00992       <span class="keywordflow">return</span>;
<a name="l00993"></a>00993 }
<a name="l00994"></a>00994 
<a name="l00995"></a>00995 
<a name="l00996"></a>00996 
<a name="l00997"></a><a class="code" href="Town_01Militia_8cpp.html#d83c0a732fdee804038c50b81691c2bd">00997</a> <span class="keywordtype">void</span> <a class="code" href="Town_01Militia_8cpp.html#d83c0a732fdee804038c50b81691c2bd">BuildListOfUnpaidTrainableSectors</a>( <span class="keywordtype">void</span> )
<a name="l00998"></a>00998 {
<a name="l00999"></a>00999       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iCounter = 0, iCounterB = 0;
<a name="l01000"></a>01000       <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> = NULL;
<a name="l01001"></a>01001 
<a name="l01002"></a>01002       memset( <a class="code" href="Town_01Militia_8cpp.html#23d8e740f8bbf84ba1151d24ab10890d">gsUnpaidStrategicSector</a>, 0, <span class="keyword">sizeof</span>( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> ) * MAX_CHARACTER_COUNT );
<a name="l01003"></a>01003 
<a name="l01004"></a>01004       <span class="keywordflow">if</span>( <a class="code" href="Interface_01Control_8cpp.html#13888453701b7175bfe2287212a0d666">guiTacticalInterfaceFlags</a> &amp; INTERFACE_MAPSCREEN )
<a name="l01005"></a>01005       {
<a name="l01006"></a>01006             <span class="keywordflow">for</span>( iCounter = 0; iCounter &lt; MAX_CHARACTER_COUNT; iCounter++ )
<a name="l01007"></a>01007             {
<a name="l01008"></a>01008                   <span class="comment">// valid character?</span>
<a name="l01009"></a>01009                   <span class="keywordflow">if</span>( <a class="code" href="Map_01Screen_01Interface_8cpp.html#a800323f5af9722f82bfbd00b388bbd9">gCharactersList</a>[ iCounter ].fValid )
<a name="l01010"></a>01010                   {
<a name="l01011"></a>01011                         <span class="comment">// selected?</span>
<a name="l01012"></a>01012                         <span class="keywordflow">if</span>( ( <a class="code" href="Assignments_8cpp.html#605eaa913620dea638fecf6cdb4cfc3a">fSelectedListOfMercsForMapScreen</a>[ iCounter ] == TRUE ) || ( iCounter == <a class="code" href="Map_01Screen_01Interface_01Map_8cpp.html#6b0a1907e6c3fd22875ac11e966e7803">bSelectedAssignChar</a> ) )
<a name="l01013"></a>01013                         {
<a name="l01014"></a>01014                               <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> = &amp;<a class="code" href="Overhead_8cpp.html#f1785e87ea281d015350ec85b9bd8508">Menptr</a>[ <a class="code" href="Map_01Screen_01Interface_8cpp.html#a800323f5af9722f82bfbd00b388bbd9">gCharactersList</a>[ iCounter ].usSolID ];
<a name="l01015"></a>01015 
<a name="l01016"></a>01016                               <span class="keywordflow">if</span>( <a class="code" href="Assignments_8cpp.html#1fdfbc9e940b015e8557664a73d901a5">CanCharacterTrainMilitia</a>( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> ) == TRUE )
<a name="l01017"></a>01017                               {
<a name="l01018"></a>01018                                     <span class="keywordflow">if</span>( <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ SECTOR( pSoldier-&gt;sSectorX, pSoldier-&gt;sSectorY ) ].<a class="code" href="structSECTORINFO.html#38e142a2d66837eee6367e293317ab63">fMilitiaTrainingPaid</a> == FALSE )
<a name="l01019"></a>01019                                     {
<a name="l01020"></a>01020                                           <span class="comment">// check to see if this sector is a town and needs equipment</span>
<a name="l01021"></a>01021                                           <a class="code" href="Town_01Militia_8cpp.html#23d8e740f8bbf84ba1151d24ab10890d">gsUnpaidStrategicSector</a>[ iCounter ] = CALCULATE_STRATEGIC_INDEX( pSoldier-&gt;sSectorX, pSoldier-&gt;sSectorY );
<a name="l01022"></a>01022                                     }
<a name="l01023"></a>01023                               }
<a name="l01024"></a>01024                         }
<a name="l01025"></a>01025                   }
<a name="l01026"></a>01026             }
<a name="l01027"></a>01027       }
<a name="l01028"></a>01028       <span class="keywordflow">else</span>
<a name="l01029"></a>01029       {
<a name="l01030"></a>01030             <span class="comment">// handle for tactical</span>
<a name="l01031"></a>01031             <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> = &amp;<a class="code" href="Overhead_8cpp.html#f1785e87ea281d015350ec85b9bd8508">Menptr</a>[ <a class="code" href="Assignments_8cpp.html#0f5ec3a47f9c8bbd96557e71c1833d5e">gusUIFullTargetID</a> ];
<a name="l01032"></a>01032             iCounter = 0;
<a name="l01033"></a>01033 
<a name="l01034"></a>01034             <span class="keywordflow">if</span>( <a class="code" href="Assignments_8cpp.html#1fdfbc9e940b015e8557664a73d901a5">CanCharacterTrainMilitia</a>( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> ) == TRUE )
<a name="l01035"></a>01035             {
<a name="l01036"></a>01036                   <span class="keywordflow">if</span>( <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ SECTOR( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#6784346500db10daed06c2db02b855c0">sSectorX</a>, <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#6dd68e70c3000beb79e4ac45d28a0cbf">sSectorY</a> ) ].<a class="code" href="structSECTORINFO.html#38e142a2d66837eee6367e293317ab63">fMilitiaTrainingPaid</a> == FALSE )
<a name="l01037"></a>01037                   {
<a name="l01038"></a>01038                         <span class="comment">// check to see if this sector is a town and needs equipment</span>
<a name="l01039"></a>01039                         <a class="code" href="Town_01Militia_8cpp.html#23d8e740f8bbf84ba1151d24ab10890d">gsUnpaidStrategicSector</a>[ iCounter ] = CALCULATE_STRATEGIC_INDEX( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#6784346500db10daed06c2db02b855c0">sSectorX</a>, <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#6dd68e70c3000beb79e4ac45d28a0cbf">sSectorY</a> );
<a name="l01040"></a>01040                   }
<a name="l01041"></a>01041             }
<a name="l01042"></a>01042       }
<a name="l01043"></a>01043 
<a name="l01044"></a>01044       <span class="comment">// now clean out repeated sectors</span>
<a name="l01045"></a>01045       <span class="keywordflow">for</span>( iCounter = 0; iCounter &lt; MAX_CHARACTER_COUNT - 1; iCounter++ )
<a name="l01046"></a>01046       {
<a name="l01047"></a>01047             <span class="keywordflow">if</span>( <a class="code" href="Town_01Militia_8cpp.html#23d8e740f8bbf84ba1151d24ab10890d">gsUnpaidStrategicSector</a>[ iCounter ] &gt; 0 )
<a name="l01048"></a>01048             {
<a name="l01049"></a>01049                   <span class="keywordflow">for</span>( iCounterB = iCounter + 1 ; iCounterB &lt; MAX_CHARACTER_COUNT; iCounterB++ )
<a name="l01050"></a>01050                   {
<a name="l01051"></a>01051                         <span class="keywordflow">if</span>( <a class="code" href="Town_01Militia_8cpp.html#23d8e740f8bbf84ba1151d24ab10890d">gsUnpaidStrategicSector</a>[ iCounterB ] == <a class="code" href="Town_01Militia_8cpp.html#23d8e740f8bbf84ba1151d24ab10890d">gsUnpaidStrategicSector</a>[ iCounter ] )
<a name="l01052"></a>01052                         {
<a name="l01053"></a>01053                               <a class="code" href="Town_01Militia_8cpp.html#23d8e740f8bbf84ba1151d24ab10890d">gsUnpaidStrategicSector</a>[ iCounterB ] = 0;
<a name="l01054"></a>01054                         }
<a name="l01055"></a>01055                   }
<a name="l01056"></a>01056             }
<a name="l01057"></a>01057       }
<a name="l01058"></a>01058 }
<a name="l01059"></a>01059 
<a name="l01060"></a>01060 
<a name="l01061"></a>01061 
<a name="l01062"></a><a class="code" href="Town_01Militia_8cpp.html#b018f3626819deef3789bfb653a6c50b">01062</a> <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> <a class="code" href="Town_01Militia_8cpp.html#b018f3626819deef3789bfb653a6c50b">GetNumberOfUnpaidTrainableSectors</a>( <span class="keywordtype">void</span> )
<a name="l01063"></a>01063 {
<a name="l01064"></a>01064       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iCounter = 0;
<a name="l01065"></a>01065       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iNumberOfSectors = 0;
<a name="l01066"></a>01066 
<a name="l01067"></a>01067       <a class="code" href="Town_01Militia_8cpp.html#d83c0a732fdee804038c50b81691c2bd">BuildListOfUnpaidTrainableSectors</a>();
<a name="l01068"></a>01068 
<a name="l01069"></a>01069       <span class="comment">// now count up the results</span>
<a name="l01070"></a>01070       <span class="keywordflow">for</span>( iCounter = 0; iCounter &lt; MAX_CHARACTER_COUNT; iCounter++ )
<a name="l01071"></a>01071       {
<a name="l01072"></a>01072             <span class="keywordflow">if</span>( <a class="code" href="Town_01Militia_8cpp.html#23d8e740f8bbf84ba1151d24ab10890d">gsUnpaidStrategicSector</a>[ iCounter ] &gt; 0 )
<a name="l01073"></a>01073             {
<a name="l01074"></a>01074                   iNumberOfSectors++;
<a name="l01075"></a>01075             }
<a name="l01076"></a>01076       }
<a name="l01077"></a>01077 
<a name="l01078"></a>01078       <span class="comment">// return the result </span>
<a name="l01079"></a>01079       <span class="keywordflow">return</span>( iNumberOfSectors );
<a name="l01080"></a>01080 
<a name="l01081"></a>01081 }
<a name="l01082"></a>01082 
<a name="l01083"></a>01083 
<a name="l01084"></a><a class="code" href="Town_01Militia_8cpp.html#62df96ee814f86ce09ffc78f23163938">01084</a> <span class="keywordtype">void</span> <a class="code" href="Town_01Militia_8cpp.html#62df96ee814f86ce09ffc78f23163938">StartTrainingInAllUnpaidTrainableSectors</a>()
<a name="l01085"></a>01085 {
<a name="l01086"></a>01086       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iCounter = 0;
<a name="l01087"></a>01087       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubSector;
<a name="l01088"></a>01088 
<a name="l01089"></a>01089 
<a name="l01090"></a>01090       <a class="code" href="Assignments_8cpp.html#d8e65a321580d6df8deaf5688d0a0a42">SetAssignmentForList</a>( <a class="code" href="Assignments_8h.html#16db4876b192da08f3ad0cb41afe516f060ca182475849caac7325fdd4f55cce">TRAIN_TOWN</a>, 0 );
<a name="l01091"></a>01091 
<a name="l01092"></a>01092       <a class="code" href="Town_01Militia_8cpp.html#d83c0a732fdee804038c50b81691c2bd">BuildListOfUnpaidTrainableSectors</a>();
<a name="l01093"></a>01093 
<a name="l01094"></a>01094       <span class="comment">// pay up in each sector</span>
<a name="l01095"></a>01095       <span class="keywordflow">for</span>( iCounter = 0; iCounter &lt; MAX_CHARACTER_COUNT; iCounter++ )
<a name="l01096"></a>01096       {
<a name="l01097"></a>01097             <span class="keywordflow">if</span>( <a class="code" href="Town_01Militia_8cpp.html#23d8e740f8bbf84ba1151d24ab10890d">gsUnpaidStrategicSector</a>[ iCounter ] &gt; 0 )
<a name="l01098"></a>01098             {
<a name="l01099"></a>01099                   <span class="comment">// convert strategic sector to 0-255 system</span>
<a name="l01100"></a>01100                   ubSector = STRATEGIC_INDEX_TO_SECTOR_INFO( <a class="code" href="Town_01Militia_8cpp.html#23d8e740f8bbf84ba1151d24ab10890d">gsUnpaidStrategicSector</a>[ iCounter ] );
<a name="l01101"></a>01101                   <a class="code" href="Town_01Militia_8cpp.html#13136f3dd704d84d12f96b134853cbfd">PayForTrainingInSector</a>( ubSector );
<a name="l01102"></a>01102             }
<a name="l01103"></a>01103       }
<a name="l01104"></a>01104 }
<a name="l01105"></a>01105 
<a name="l01106"></a>01106 
<a name="l01107"></a><a class="code" href="Town_01Militia_8cpp.html#7cd331b0f36945bed7155f750eb9b739">01107</a> <span class="keywordtype">void</span> <a class="code" href="Town_01Militia_8cpp.html#7cd331b0f36945bed7155f750eb9b739">ContinueTrainingInThisSector</a>( <span class="keywordtype">void</span> )
<a name="l01108"></a>01108 {
<a name="l01109"></a>01109       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubSector;
<a name="l01110"></a>01110 
<a name="l01111"></a>01111       Assert( <a class="code" href="Assignments_8cpp.html#f6fc5490beeed4fea61f225e930dc560">pMilitiaTrainerSoldier</a> );
<a name="l01112"></a>01112 
<a name="l01113"></a>01113       <span class="comment">// pay up in the sector where pMilitiaTrainerSoldier is</span>
<a name="l01114"></a>01114       ubSector = SECTOR( <a class="code" href="Assignments_8cpp.html#f6fc5490beeed4fea61f225e930dc560">pMilitiaTrainerSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#6784346500db10daed06c2db02b855c0">sSectorX</a>, <a class="code" href="Assignments_8cpp.html#f6fc5490beeed4fea61f225e930dc560">pMilitiaTrainerSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#6dd68e70c3000beb79e4ac45d28a0cbf">sSectorY</a> );
<a name="l01115"></a>01115       <a class="code" href="Town_01Militia_8cpp.html#13136f3dd704d84d12f96b134853cbfd">PayForTrainingInSector</a>( ubSector );
<a name="l01116"></a>01116 }
<a name="l01117"></a>01117 
<a name="l01118"></a>01118 
<a name="l01119"></a><a class="code" href="Town_01Militia_8cpp.html#13136f3dd704d84d12f96b134853cbfd">01119</a> <span class="keywordtype">void</span> <a class="code" href="Town_01Militia_8cpp.html#13136f3dd704d84d12f96b134853cbfd">PayForTrainingInSector</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubSector )
<a name="l01120"></a>01120 {
<a name="l01121"></a>01121       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iMilitiaTrainingCost = <a class="code" href="GameSettings_8cpp.html#5c32f930e2fef384505c4b91803a92c2">gGameExternalOptions</a>.<a class="code" href="structGAME__EXTERNAL__OPTIONS.html#312cf0aee51467ca04d89529d66494c8">iMilitiaTrainingCost</a>;
<a name="l01122"></a>01122 DebugMsg (<a class="code" href="DEBUG_8cpp.html#a7985c2fd033797fc67a03b2c26e07c6">TOPIC_JA2</a>,DBG_LEVEL_3,<span class="stringliteral">"Militia6"</span>);
<a name="l01123"></a>01123       Assert( <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ ubSector ].fMilitiaTrainingPaid == FALSE );
<a name="l01124"></a>01124 
<a name="l01125"></a>01125       <span class="comment">// spend the money</span>
<a name="l01126"></a>01126       <a class="code" href="finances_8cpp.html#eb22c8a06fb93e33daca35a985a2b76b">AddTransactionToPlayersBook</a>( <a class="code" href="finances_8h.html#79e9f285d34216706a748fd7ba8941b7c129a419173de1e979d67062bf9d3e9f">TRAIN_TOWN_MILITIA</a>, ubSector, <a class="code" href="Game_01Clock_8cpp.html#4d255e800fba4d64144a7639d5f3421d">GetWorldTotalMin</a>(), -( iMilitiaTrainingCost ) );
<a name="l01127"></a>01127 
<a name="l01128"></a>01128       <span class="comment">// mark this sector sectors as being paid up</span>
<a name="l01129"></a>01129       <a class="code" href="Campaign_01Types_8h.html#d83c6f699f17a47cf6a662c91d959126">SectorInfo</a>[ ubSector ].<a class="code" href="structSECTORINFO.html#38e142a2d66837eee6367e293317ab63">fMilitiaTrainingPaid</a> = TRUE;
<a name="l01130"></a>01130 
<a name="l01131"></a>01131       <span class="comment">// reset done flags</span>
<a name="l01132"></a>01132       <a class="code" href="Town_01Militia_8cpp.html#2927f4f7d0d79d4caa47e56f5d43ab7e">ResetDoneFlagForAllMilitiaTrainersInSector</a>( ubSector );
<a name="l01133"></a>01133 }
<a name="l01134"></a>01134 
<a name="l01135"></a>01135 
<a name="l01136"></a><a class="code" href="Town_01Militia_8cpp.html#2927f4f7d0d79d4caa47e56f5d43ab7e">01136</a> <span class="keywordtype">void</span> <a class="code" href="Town_01Militia_8cpp.html#2927f4f7d0d79d4caa47e56f5d43ab7e">ResetDoneFlagForAllMilitiaTrainersInSector</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubSector )
<a name="l01137"></a>01137 {
<a name="l01138"></a>01138       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iCounter = 0;
<a name="l01139"></a>01139       <a class="code" href="structSOLDIERTYPE.html">SOLDIERTYPE</a> *<a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> = NULL;
<a name="l01140"></a>01140 
<a name="l01141"></a>01141 
<a name="l01142"></a>01142       <span class="keywordflow">for</span>( iCounter = 0; iCounter &lt;= <a class="code" href="Overhead_8cpp.html#46bd754f8875c305ab18731ed10e3364">gTacticalStatus</a>.<a class="code" href="structTacticalStatusType.html#2ecddfe580bb019bc92cc4859eaf3edc">Team</a>[ OUR_TEAM ].<a class="code" href="structTacticalTeamType.html#6a887279dad735dc302f21c1e559d5ce">bLastID</a>; iCounter++ )
<a name="l01143"></a>01143       {
<a name="l01144"></a>01144             <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a> = &amp;<a class="code" href="Overhead_8cpp.html#f1785e87ea281d015350ec85b9bd8508">Menptr</a>[ iCounter ];
<a name="l01145"></a>01145             
<a name="l01146"></a>01146             <span class="keywordflow">if</span>( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#653dad4e2520784e293eca9f948b8532">bActive</a> )
<a name="l01147"></a>01147             {
<a name="l01148"></a>01148                   <span class="keywordflow">if</span>( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#4269b53195147b458cd1e6874429734b">bAssignment</a> == <a class="code" href="Assignments_8h.html#16db4876b192da08f3ad0cb41afe516f060ca182475849caac7325fdd4f55cce">TRAIN_TOWN</a> )
<a name="l01149"></a>01149                   {
<a name="l01150"></a>01150                         <span class="keywordflow">if</span>( ( SECTOR( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#6784346500db10daed06c2db02b855c0">sSectorX</a>, <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#6dd68e70c3000beb79e4ac45d28a0cbf">sSectorY</a> ) == ubSector ) &amp;&amp; ( <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#b70b761f0405cc179c1ffba84484df28">bSectorZ</a> == 0 ) )
<a name="l01151"></a>01151                         {
<a name="l01152"></a>01152                               <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#7a88851a2b4f04cb22f633ff86a08625">fDoneAssignmentAndNothingToDoFlag</a> = FALSE;
<a name="l01153"></a>01153                               <a class="code" href="aniviewscreen_8cpp.html#629cf92081f22af2ea4014413ff37801">pSoldier</a>-&gt;<a class="code" href="structSOLDIERTYPE.html#7e63debe882783fb2cb8641f3b3e8214">usQuoteSaidExtFlags</a> &amp;= ~SOLDIER_QUOTE_SAID_DONE_ASSIGNMENT;
<a name="l01154"></a>01154                         }
<a name="l01155"></a>01155                   }
<a name="l01156"></a>01156             }
<a name="l01157"></a>01157       }
<a name="l01158"></a>01158 }
<a name="l01159"></a>01159 
<a name="l01160"></a>01160 
<a name="l01161"></a><a class="code" href="Town_01Militia_8h.html#e674aa192c58edfe28bc9ae3eb37dedf">01161</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Town_01Militia_8cpp.html#e674aa192c58edfe28bc9ae3eb37dedf">MilitiaTrainingAllowedInSector</a>( <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorX, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sSectorY, <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bSectorZ )
<a name="l01162"></a>01162 {
<a name="l01163"></a>01163       <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bTownId;
<a name="l01164"></a>01164       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fSamSitePresent = FALSE;
<a name="l01165"></a>01165 
<a name="l01166"></a>01166 
<a name="l01167"></a>01167       <span class="keywordflow">if</span>( bSectorZ != 0 )
<a name="l01168"></a>01168       {
<a name="l01169"></a>01169             <span class="keywordflow">return</span>( FALSE );
<a name="l01170"></a>01170       }
<a name="l01171"></a>01171 
<a name="l01172"></a>01172       fSamSitePresent = <a class="code" href="strategicmap_8cpp.html#aad459c13b87dd12c43c473c71641070">IsThisSectorASAMSector</a>( sSectorX, sSectorY, bSectorZ );
<a name="l01173"></a>01173 
<a name="l01174"></a>01174       <span class="keywordflow">if</span>( fSamSitePresent )
<a name="l01175"></a>01175       {
<a name="l01176"></a>01176             <span class="comment">// all SAM sites may have militia trained at them</span>
<a name="l01177"></a>01177             <span class="keywordflow">return</span>(TRUE);
<a name="l01178"></a>01178       }
<a name="l01179"></a>01179 
<a name="l01180"></a>01180 
<a name="l01181"></a>01181       bTownId = <a class="code" href="strategicmap_8cpp.html#99dffd29ea4571bc0c833d45636f1403">GetTownIdForSector</a>( sSectorX, sSectorY );
<a name="l01182"></a>01182 
<a name="l01183"></a>01183 
<a name="l01184"></a>01184       <span class="keywordflow">return</span>( <a class="code" href="Town_01Militia_8cpp.html#b641dcc19fcd9bf831e6fd678c8e10b2">MilitiaTrainingAllowedInTown</a>( bTownId ) );
<a name="l01185"></a>01185 }
<a name="l01186"></a>01186 
<a name="l01187"></a>01187 
<a name="l01188"></a>01188 
<a name="l01189"></a><a class="code" href="Town_01Militia_8h.html#b641dcc19fcd9bf831e6fd678c8e10b2">01189</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="Town_01Militia_8cpp.html#b641dcc19fcd9bf831e6fd678c8e10b2">MilitiaTrainingAllowedInTown</a>( <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> bTownId )
<a name="l01190"></a>01190 {
<a name="l01191"></a>01191       <span class="keywordflow">switch</span> ( bTownId )
<a name="l01192"></a>01192       {
<a name="l01193"></a>01193             <span class="keywordflow">case</span> <a class="code" href="mapscreen_8h.html#4d1dc70bee62b945929c96dfafebe1052d90315dc5189006a917572886dd5919">DRASSEN</a>:
<a name="l01194"></a>01194             <span class="keywordflow">case</span> <a class="code" href="mapscreen_8h.html#4d1dc70bee62b945929c96dfafebe105b27f427a025e60b9feb35edaa5556f63">ALMA</a>:
<a name="l01195"></a>01195             <span class="keywordflow">case</span> <a class="code" href="mapscreen_8h.html#4d1dc70bee62b945929c96dfafebe10582fb82fae08599485a465d9f342a0e80">GRUMM</a>:
<a name="l01196"></a>01196             <span class="keywordflow">case</span> <a class="code" href="mapscreen_8h.html#4d1dc70bee62b945929c96dfafebe105457ae8d0acf7ebe5ad016ecdf6020b3e">CAMBRIA</a>:
<a name="l01197"></a>01197             <span class="keywordflow">case</span> <a class="code" href="mapscreen_8h.html#4d1dc70bee62b945929c96dfafebe105e70227c42a462ac01e06b19638569574">BALIME</a>:
<a name="l01198"></a>01198             <span class="keywordflow">case</span> <a class="code" href="mapscreen_8h.html#4d1dc70bee62b945929c96dfafebe105b27f2688f728440518c090cc805f6282">MEDUNA</a>:
<a name="l01199"></a>01199             <span class="keywordflow">case</span> <a class="code" href="mapscreen_8h.html#4d1dc70bee62b945929c96dfafebe10577a4855ca65fb8eae6e8e89bef607477">CHITZENA</a>:
<a name="l01200"></a>01200                   <span class="keywordflow">return</span>(TRUE);
<a name="l01201"></a>01201 
<a name="l01202"></a>01202             <span class="keywordflow">case</span> <a class="code" href="mapscreen_8h.html#4d1dc70bee62b945929c96dfafebe105d4e8ff4822ac436590f6cfbf3b35764d">OMERTA</a>:
<a name="l01203"></a>01203             <span class="keywordflow">case</span> <a class="code" href="mapscreen_8h.html#4d1dc70bee62b945929c96dfafebe1056945503be50d65fc837b843a86aace5a">ESTONI</a>:
<a name="l01204"></a>01204             <span class="keywordflow">case</span> <a class="code" href="mapscreen_8h.html#4d1dc70bee62b945929c96dfafebe10555d5a38897a02d66fd24bf2d6d92dee8">SAN_MONA</a>:
<a name="l01205"></a>01205             <span class="keywordflow">case</span> <a class="code" href="mapscreen_8h.html#4d1dc70bee62b945929c96dfafebe10560f8283526f5d52c03edfd9bff8b218a">TIXA</a>:
<a name="l01206"></a>01206             <span class="keywordflow">case</span> <a class="code" href="mapscreen_8h.html#4d1dc70bee62b945929c96dfafebe1051ae6da30d1617c09899e280a04bde521">ORTA</a>:
<a name="l01207"></a>01207                   <span class="comment">// can't keep militia in these towns</span>
<a name="l01208"></a>01208                   <span class="keywordflow">return</span>(FALSE);
<a name="l01209"></a>01209 
<a name="l01210"></a>01210             <span class="keywordflow">case</span> <a class="code" href="mapscreen_8h.html#4d1dc70bee62b945929c96dfafebe105d008cfe091b982e6d052565ed0b5acd8">BLANK_SECTOR</a>:
<a name="l01211"></a>01211             <span class="keywordflow">default</span>:
<a name="l01212"></a>01212                   <span class="comment">// not a town sector!</span>
<a name="l01213"></a>01213                   <span class="keywordflow">return</span>(FALSE);
<a name="l01214"></a>01214 
<a name="l01215"></a>01215       }
<a name="l01216"></a>01216 }
<a name="l01217"></a>01217 
<a name="l01218"></a><a class="code" href="Town_01Militia_8h.html#d6df1ba4c1bf6e6b4b21fb77555582eb">01218</a> <span class="keywordtype">void</span> <a class="code" href="Town_01Militia_8cpp.html#d6df1ba4c1bf6e6b4b21fb77555582eb">BuildMilitiaPromotionsString</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *<a class="code" href="Button_01System_8cpp.html#ac22642f3052cc77a6991a262ce4ad23">str</a> )
<a name="l01219"></a>01219 {
<a name="l01220"></a>01220       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> pStr[256];
<a name="l01221"></a>01221       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fAddSpace = FALSE;
<a name="l01222"></a>01222       swprintf( str, L<span class="stringliteral">""</span> );
<a name="l01223"></a>01223 
<a name="l01224"></a>01224       <span class="keywordflow">if</span>( !<a class="code" href="strategicmap_8cpp.html#e66f0de9612db4316e80c626b2e15fd3">gbMilitiaPromotions</a> )
<a name="l01225"></a>01225       {
<a name="l01226"></a>01226             <span class="keywordflow">return</span>;
<a name="l01227"></a>01227       }
<a name="l01228"></a>01228       <span class="keywordflow">if</span>( <a class="code" href="strategicmap_8cpp.html#1ef1c0dc3937285c02c9bb094f867cfd">gbGreenToElitePromotions</a> &gt; 1 )
<a name="l01229"></a>01229       {
<a name="l01230"></a>01230             swprintf( pStr, <a class="code" href="__DutchText_8cpp.html#c5c7f48843bbaeab7848215f323578c9">gzLateLocalizedString</a>[22], <a class="code" href="strategicmap_8cpp.html#1ef1c0dc3937285c02c9bb094f867cfd">gbGreenToElitePromotions</a> );
<a name="l01231"></a>01231             <a class="code" href="Sys_01Globals_8h.html#92a23b0a8bea9679b6f78aa26b1715e7">wcscat</a>( str, pStr );
<a name="l01232"></a>01232             fAddSpace = TRUE;
<a name="l01233"></a>01233       }
<a name="l01234"></a>01234       <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="strategicmap_8cpp.html#1ef1c0dc3937285c02c9bb094f867cfd">gbGreenToElitePromotions</a> == 1 )
<a name="l01235"></a>01235       {
<a name="l01236"></a>01236             <a class="code" href="Sys_01Globals_8h.html#92a23b0a8bea9679b6f78aa26b1715e7">wcscat</a>( str, <a class="code" href="__DutchText_8cpp.html#c5c7f48843bbaeab7848215f323578c9">gzLateLocalizedString</a>[29] );
<a name="l01237"></a>01237             fAddSpace = TRUE;
<a name="l01238"></a>01238       }
<a name="l01239"></a>01239 
<a name="l01240"></a>01240       <span class="keywordflow">if</span>( <a class="code" href="strategicmap_8cpp.html#9062eb53e590e71bd6d5fbe6d774d67b">gbGreenToRegPromotions</a> &gt; 1 )
<a name="l01241"></a>01241       {
<a name="l01242"></a>01242             <span class="keywordflow">if</span>( fAddSpace )
<a name="l01243"></a>01243             {
<a name="l01244"></a>01244                   <a class="code" href="Sys_01Globals_8h.html#92a23b0a8bea9679b6f78aa26b1715e7">wcscat</a>( str, L<span class="stringliteral">" "</span> );
<a name="l01245"></a>01245             }
<a name="l01246"></a>01246             swprintf( pStr, <a class="code" href="__DutchText_8cpp.html#c5c7f48843bbaeab7848215f323578c9">gzLateLocalizedString</a>[23], <a class="code" href="strategicmap_8cpp.html#9062eb53e590e71bd6d5fbe6d774d67b">gbGreenToRegPromotions</a> );
<a name="l01247"></a>01247             <a class="code" href="Sys_01Globals_8h.html#92a23b0a8bea9679b6f78aa26b1715e7">wcscat</a>( str, pStr );
<a name="l01248"></a>01248             fAddSpace = TRUE;
<a name="l01249"></a>01249       }
<a name="l01250"></a>01250       <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="strategicmap_8cpp.html#9062eb53e590e71bd6d5fbe6d774d67b">gbGreenToRegPromotions</a> == 1 )
<a name="l01251"></a>01251       {
<a name="l01252"></a>01252             <span class="keywordflow">if</span>( fAddSpace )
<a name="l01253"></a>01253             {
<a name="l01254"></a>01254                   <a class="code" href="Sys_01Globals_8h.html#92a23b0a8bea9679b6f78aa26b1715e7">wcscat</a>( str, L<span class="stringliteral">" "</span> );
<a name="l01255"></a>01255             }
<a name="l01256"></a>01256             <a class="code" href="Sys_01Globals_8h.html#92a23b0a8bea9679b6f78aa26b1715e7">wcscat</a>( str, <a class="code" href="__DutchText_8cpp.html#c5c7f48843bbaeab7848215f323578c9">gzLateLocalizedString</a>[30] );
<a name="l01257"></a>01257             fAddSpace = TRUE;
<a name="l01258"></a>01258       }
<a name="l01259"></a>01259 
<a name="l01260"></a>01260       <span class="keywordflow">if</span>( <a class="code" href="strategicmap_8cpp.html#a44df3355b6a0c3820742cbfb43e9710">gbRegToElitePromotions</a> &gt; 1 )
<a name="l01261"></a>01261       {
<a name="l01262"></a>01262             <span class="keywordflow">if</span>( fAddSpace )
<a name="l01263"></a>01263             {
<a name="l01264"></a>01264                   <a class="code" href="Sys_01Globals_8h.html#92a23b0a8bea9679b6f78aa26b1715e7">wcscat</a>( str, L<span class="stringliteral">" "</span> );
<a name="l01265"></a>01265             }
<a name="l01266"></a>01266             swprintf( pStr, <a class="code" href="__DutchText_8cpp.html#c5c7f48843bbaeab7848215f323578c9">gzLateLocalizedString</a>[24], <a class="code" href="strategicmap_8cpp.html#a44df3355b6a0c3820742cbfb43e9710">gbRegToElitePromotions</a> );
<a name="l01267"></a>01267             <a class="code" href="Sys_01Globals_8h.html#92a23b0a8bea9679b6f78aa26b1715e7">wcscat</a>( str, pStr );
<a name="l01268"></a>01268       }
<a name="l01269"></a>01269       <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="strategicmap_8cpp.html#a44df3355b6a0c3820742cbfb43e9710">gbRegToElitePromotions</a> == 1 )
<a name="l01270"></a>01270       {
<a name="l01271"></a>01271             <span class="keywordflow">if</span>( fAddSpace )
<a name="l01272"></a>01272             {
<a name="l01273"></a>01273                   <a class="code" href="Sys_01Globals_8h.html#92a23b0a8bea9679b6f78aa26b1715e7">wcscat</a>( str, L<span class="stringliteral">" "</span> );
<a name="l01274"></a>01274             }
<a name="l01275"></a>01275             <a class="code" href="Sys_01Globals_8h.html#92a23b0a8bea9679b6f78aa26b1715e7">wcscat</a>( str, <a class="code" href="__DutchText_8cpp.html#c5c7f48843bbaeab7848215f323578c9">gzLateLocalizedString</a>[31] );
<a name="l01276"></a>01276             fAddSpace = TRUE;
<a name="l01277"></a>01277       }
<a name="l01278"></a>01278       
<a name="l01279"></a>01279       <span class="comment">//Clear the fields</span>
<a name="l01280"></a>01280       <a class="code" href="strategicmap_8cpp.html#1ef1c0dc3937285c02c9bb094f867cfd">gbGreenToElitePromotions</a> = 0;
<a name="l01281"></a>01281       <a class="code" href="strategicmap_8cpp.html#9062eb53e590e71bd6d5fbe6d774d67b">gbGreenToRegPromotions</a> = 0;
<a name="l01282"></a>01282       <a class="code" href="strategicmap_8cpp.html#a44df3355b6a0c3820742cbfb43e9710">gbRegToElitePromotions</a> = 0;
<a name="l01283"></a>01283       <a class="code" href="strategicmap_8cpp.html#e66f0de9612db4316e80c626b2e15fd3">gbMilitiaPromotions</a> = 0;
<a name="l01284"></a>01284 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sat Sep 9 13:49:12 2006 for Build by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
