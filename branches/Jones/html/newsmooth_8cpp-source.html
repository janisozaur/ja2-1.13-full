<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Build: newsmooth.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="classes.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir_3179ea33d55a76dc38212d9eab798728.html">export</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_e5664b4b56927c8728eb3192fa60e338.html">hdc2</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_1eb12a41a47efb9efcd82fa98f4f4dbd.html">FTP</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_80cc1f21a78ab7941088ea567f236150.html">ja2src</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_994ab287602efefceafe55287a3657d6.html">Build</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_33ea1c43094532be6a81f120546fc3d7.html">Editor</a></div>
<h1>newsmooth.cpp</h1><a href="newsmooth_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#ifdef PRECOMPILEDHEADERS</span>
<a name="l00002"></a>00002 <span class="preprocessor"></span><span class="preprocessor">      #include "<a class="code" href="Editor_01All_8h.html">Editor All.h</a>"</span>
<a name="l00003"></a>00003 <span class="preprocessor">#else</span>
<a name="l00004"></a>00004 <span class="preprocessor"></span><span class="preprocessor">      #include "<a class="code" href="builddefines_8h.html">builddefines.h</a>"</span>
<a name="l00005"></a>00005 <span class="preprocessor">#endif</span>
<a name="l00006"></a>00006 <span class="preprocessor"></span>
<a name="l00007"></a>00007 <span class="preprocessor">#ifdef JA2EDITOR</span>
<a name="l00008"></a>00008 <span class="preprocessor"></span>
<a name="l00009"></a>00009 <span class="preprocessor">#ifndef PRECOMPILEDHEADERS</span>
<a name="l00010"></a>00010 <span class="preprocessor"></span><span class="preprocessor">      #include &lt;stdlib.h&gt;</span>
<a name="l00011"></a>00011 <span class="preprocessor">      #include "<a class="code" href="tiledef_8h.html">tiledef.h</a>"</span>
<a name="l00012"></a>00012 <span class="preprocessor">      #include "<a class="code" href="worlddef_8h.html">worlddef.h</a>"</span>
<a name="l00013"></a>00013 <span class="preprocessor">      #include "<a class="code" href="worldman_8h.html">worldman.h</a>"</span>
<a name="l00014"></a>00014 <span class="preprocessor">      #include "<a class="code" href="newsmooth_8h.html">newsmooth.h</a>"</span>
<a name="l00015"></a>00015 <span class="preprocessor">      #include "<a class="code" href="Isometric_01Utils_8h.html">Isometric Utils.h</a>"</span>
<a name="l00016"></a>00016 <span class="preprocessor">      #include "<a class="code" href="EditorBuildings_8h.html">EditorBuildings.h</a>"</span>
<a name="l00017"></a>00017 <span class="preprocessor">      #include "<a class="code" href="edit__sys_8h.html">edit_sys.h</a>"</span>
<a name="l00018"></a>00018 <span class="preprocessor">      #include "<a class="code" href="Smoothing_01Utils_8h.html">Smoothing Utils.h</a>"</span>
<a name="l00019"></a>00019 <span class="preprocessor">      #include "<a class="code" href="Editor_01Undo_8h.html">Editor Undo.h</a>"</span>
<a name="l00020"></a>00020 <span class="preprocessor">      #include "<a class="code" href="Structure_01Internals_8h.html">Structure Internals.h</a>"</span>
<a name="l00021"></a>00021 <span class="preprocessor">      #include "<a class="code" href="environment_8h.html">environment.h</a>"</span>
<a name="l00022"></a>00022 <span class="preprocessor">      #include "Random.h"</span>
<a name="l00023"></a>00023 <span class="preprocessor">      #include "<a class="code" href="Render_01Fun_8h.html">Render Fun.h</a>"</span>
<a name="l00024"></a>00024 <span class="preprocessor">#endif</span>
<a name="l00025"></a>00025 <span class="preprocessor"></span>
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="newsmooth_8cpp.html#66062e27517c0e62d139c0fd57b124d1">CaveAtGridNo</a>( <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> <a class="code" href="editscreen_8cpp.html#48f31659f64cd18c814b1612166c50b5">iMapIndex</a> );
<a name="l00028"></a>00028 <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> <a class="code" href="newsmooth_8cpp.html#0c813d52db477dbbd482e3e6bd17fdc2">GetCaveTileIndexFromPerimeterValue</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubTotal );
<a name="l00029"></a>00029 <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> <a class="code" href="newsmooth_8cpp.html#6c0b1a7384947f890223a72d03e88084">CalcNewCavePerimeterValue</a>( <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> <a class="code" href="editscreen_8cpp.html#48f31659f64cd18c814b1612166c50b5">iMapIndex</a> );
<a name="l00030"></a>00030 
<a name="l00031"></a><a class="code" href="newsmooth_8cpp.html#66062e27517c0e62d139c0fd57b124d1">00031</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="newsmooth_8cpp.html#66062e27517c0e62d139c0fd57b124d1">CaveAtGridNo</a>( <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> <a class="code" href="editscreen_8cpp.html#48f31659f64cd18c814b1612166c50b5">iMapIndex</a> )
<a name="l00032"></a>00032 {
<a name="l00033"></a>00033       <a class="code" href="structTAG__STRUCTURE.html">STRUCTURE</a> *pStruct;
<a name="l00034"></a>00034       <a class="code" href="structTAG__level__node.html">LEVELNODE</a>* pLevel;
<a name="l00035"></a>00035       <span class="keywordflow">if</span>( iMapIndex &lt; 0 || iMapIndex &gt;= NOWHERE )
<a name="l00036"></a>00036             <span class="keywordflow">return</span> TRUE;
<a name="l00037"></a>00037       pStruct = <a class="code" href="worlddef_8cpp.html#a1c640bcf89772795e6517da9963e0d7">gpWorldLevelData</a>[ iMapIndex ].<a class="code" href="structMAP__ELEMENT.html#0d46be2b220e50e39931ac2ae3762bde">pStructureHead</a>;
<a name="l00038"></a>00038       <span class="keywordflow">while</span>( pStruct )
<a name="l00039"></a>00039       {
<a name="l00040"></a>00040             <span class="keywordflow">if</span>( pStruct-&gt;<a class="code" href="structTAG__STRUCTURE.html#5a803a00d8769236709b4f0665951383">fFlags</a> &amp; STRUCTURE_CAVEWALL )
<a name="l00041"></a>00041             {
<a name="l00042"></a>00042                   <span class="keywordflow">return</span> TRUE;
<a name="l00043"></a>00043             }
<a name="l00044"></a>00044             pStruct = pStruct-&gt;<a class="code" href="structTAG__STRUCTURE.html#5c2c06f53ef4052ce9a47a562a1c7810">pNext</a>;
<a name="l00045"></a>00045       }
<a name="l00046"></a>00046       <span class="comment">//may not have structure information, so check if there is a levelnode flag.</span>
<a name="l00047"></a>00047       pLevel = <a class="code" href="worlddef_8cpp.html#a1c640bcf89772795e6517da9963e0d7">gpWorldLevelData</a>[ iMapIndex ].<a class="code" href="structMAP__ELEMENT.html#0cc751d3c74e25ab6dd78d58da155f6d">pStructHead</a>;
<a name="l00048"></a>00048       <span class="keywordflow">while</span>( pLevel )
<a name="l00049"></a>00049       {
<a name="l00050"></a>00050             <span class="keywordflow">if</span>( pLevel-&gt;<a class="code" href="structTAG__level__node.html#d2f7b6a466532e1f2bb982a0f206db6a">uiFlags</a> &amp; LEVELNODE_CAVE )
<a name="l00051"></a>00051             {
<a name="l00052"></a>00052                   <span class="keywordflow">return</span> TRUE;
<a name="l00053"></a>00053             }
<a name="l00054"></a>00054             pLevel = pLevel-&gt;<a class="code" href="structTAG__level__node.html#7c693acc3b593ab866b789ba7542eef7">pNext</a>;
<a name="l00055"></a>00055       }
<a name="l00056"></a>00056       <span class="keywordflow">return</span> FALSE;
<a name="l00057"></a>00057 }
<a name="l00058"></a>00058 
<a name="l00059"></a><a class="code" href="newsmooth_8cpp.html#0c813d52db477dbbd482e3e6bd17fdc2">00059</a> <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> <a class="code" href="newsmooth_8cpp.html#0c813d52db477dbbd482e3e6bd17fdc2">GetCaveTileIndexFromPerimeterValue</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubTotal )
<a name="l00060"></a>00060 {
<a name="l00061"></a>00061       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usType = <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f79748562c9c35be47be8af96e1ec9a898513c">FIRSTWALL</a>;
<a name="l00062"></a>00062       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex;
<a name="l00063"></a>00063       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usTileIndex;
<a name="l00064"></a>00064       
<a name="l00065"></a>00065       <span class="keywordflow">switch</span>( ubTotal )
<a name="l00066"></a>00066       {
<a name="l00067"></a>00067             <span class="keywordflow">case</span> 0x00: <span class="keywordflow">case</span> 0x10: <span class="keywordflow">case</span> 0x20: <span class="keywordflow">case</span> 0x30: <span class="keywordflow">case</span> 0x40: <span class="keywordflow">case</span> 0x50: <span class="keywordflow">case</span> 0x60: <span class="keywordflow">case</span> 0x70: 
<a name="l00068"></a>00068             <span class="keywordflow">case</span> 0x80: <span class="keywordflow">case</span> 0x90: <span class="keywordflow">case</span> 0xa0: <span class="keywordflow">case</span> 0xb0: <span class="keywordflow">case</span> 0xc0: <span class="keywordflow">case</span> 0xd0: <span class="keywordflow">case</span> 0xe0: <span class="keywordflow">case</span> 0xf0:
<a name="l00069"></a>00069                   <span class="comment">//usIndex = 0;    </span>
<a name="l00070"></a>00070                   <span class="comment">//break;</span>
<a name="l00071"></a>00071                   <span class="keywordflow">return</span> 0xffff;
<a name="l00072"></a>00072             <span class="keywordflow">case</span> 0x01: <span class="keywordflow">case</span> 0x11: <span class="keywordflow">case</span> 0x21: <span class="keywordflow">case</span> 0x31: <span class="keywordflow">case</span> 0x41: <span class="keywordflow">case</span> 0x51: <span class="keywordflow">case</span> 0x61: <span class="keywordflow">case</span> 0x71: 
<a name="l00073"></a>00073             <span class="keywordflow">case</span> 0x81: <span class="keywordflow">case</span> 0x91: <span class="keywordflow">case</span> 0xa1: <span class="keywordflow">case</span> 0xb1: <span class="keywordflow">case</span> 0xc1: <span class="keywordflow">case</span> 0xd1: <span class="keywordflow">case</span> 0xe1: <span class="keywordflow">case</span> 0xf1:
<a name="l00074"></a>00074                   usType = <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f7974889399482ff824341e35acad9e2c4057c">SECONDWALL</a>;
<a name="l00075"></a>00075                   usIndex = 1 + (<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>)<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 4 ); 
<a name="l00076"></a>00076                   <span class="keywordflow">break</span>;
<a name="l00077"></a>00077             <span class="keywordflow">case</span> 0x02: <span class="keywordflow">case</span> 0x12: <span class="keywordflow">case</span> 0x22: <span class="keywordflow">case</span> 0x32: <span class="keywordflow">case</span> 0x42: <span class="keywordflow">case</span> 0x52: <span class="keywordflow">case</span> 0x62: <span class="keywordflow">case</span> 0x72: 
<a name="l00078"></a>00078             <span class="keywordflow">case</span> 0x82: <span class="keywordflow">case</span> 0x92: <span class="keywordflow">case</span> 0xa2: <span class="keywordflow">case</span> 0xb2: <span class="keywordflow">case</span> 0xc2: <span class="keywordflow">case</span> 0xd2: <span class="keywordflow">case</span> 0xe2: <span class="keywordflow">case</span> 0xf2:
<a name="l00079"></a>00079                   usType = <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f7974889399482ff824341e35acad9e2c4057c">SECONDWALL</a>;
<a name="l00080"></a>00080                   usIndex = 5 + (<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>)<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 4 );  
<a name="l00081"></a>00081                   <span class="keywordflow">break</span>;
<a name="l00082"></a>00082             <span class="keywordflow">case</span> 0x03: <span class="keywordflow">case</span> 0x13: <span class="keywordflow">case</span> 0x43: <span class="keywordflow">case</span> 0x53: <span class="keywordflow">case</span> 0x83: <span class="keywordflow">case</span> 0x93: <span class="keywordflow">case</span> 0xc3: <span class="keywordflow">case</span> 0xd3: 
<a name="l00083"></a>00083                   usIndex = 1;      
<a name="l00084"></a>00084                   <span class="keywordflow">break</span>;
<a name="l00085"></a>00085             <span class="keywordflow">case</span> 0x04: <span class="keywordflow">case</span> 0x14: <span class="keywordflow">case</span> 0x24: <span class="keywordflow">case</span> 0x34: <span class="keywordflow">case</span> 0x44: <span class="keywordflow">case</span> 0x54: <span class="keywordflow">case</span> 0x64: <span class="keywordflow">case</span> 0x74: 
<a name="l00086"></a>00086             <span class="keywordflow">case</span> 0x84: <span class="keywordflow">case</span> 0x94: <span class="keywordflow">case</span> 0xa4: <span class="keywordflow">case</span> 0xb4: <span class="keywordflow">case</span> 0xc4: <span class="keywordflow">case</span> 0xd4: <span class="keywordflow">case</span> 0xe4: <span class="keywordflow">case</span> 0xf4:
<a name="l00087"></a>00087                   usType = <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f7974889399482ff824341e35acad9e2c4057c">SECONDWALL</a>;
<a name="l00088"></a>00088                   usIndex = 9 + (<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>)<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 4 );  
<a name="l00089"></a>00089                   <span class="keywordflow">break</span>;
<a name="l00090"></a>00090             <span class="keywordflow">case</span> 0x05: <span class="keywordflow">case</span> 0x15: <span class="keywordflow">case</span> 0x25: <span class="keywordflow">case</span> 0x35: <span class="keywordflow">case</span> 0x45: <span class="keywordflow">case</span> 0x55: <span class="keywordflow">case</span> 0x65: <span class="keywordflow">case</span> 0x75: 
<a name="l00091"></a>00091             <span class="keywordflow">case</span> 0x85: <span class="keywordflow">case</span> 0x95: <span class="keywordflow">case</span> 0xa5: <span class="keywordflow">case</span> 0xb5: <span class="keywordflow">case</span> 0xc5: <span class="keywordflow">case</span> 0xd5: <span class="keywordflow">case</span> 0xe5: <span class="keywordflow">case</span> 0xf5:
<a name="l00092"></a>00092                   usIndex = 2 + (<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>)<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 2 );
<a name="l00093"></a>00093                   <span class="keywordflow">break</span>;
<a name="l00094"></a>00094             <span class="keywordflow">case</span> 0x06: <span class="keywordflow">case</span> 0x16: <span class="keywordflow">case</span> 0x26: <span class="keywordflow">case</span> 0x36: <span class="keywordflow">case</span> 0x86: <span class="keywordflow">case</span> 0x96: <span class="keywordflow">case</span> 0xa6: <span class="keywordflow">case</span> 0xb6: 
<a name="l00095"></a>00095                   usIndex = 4;
<a name="l00096"></a>00096                   <span class="keywordflow">break</span>;
<a name="l00097"></a>00097             <span class="keywordflow">case</span> 0x07: <span class="keywordflow">case</span> 0x17: <span class="keywordflow">case</span> 0x87: <span class="keywordflow">case</span> 0x97:
<a name="l00098"></a>00098                   usIndex = 5;
<a name="l00099"></a>00099                   <span class="keywordflow">break</span>;
<a name="l00100"></a>00100             <span class="keywordflow">case</span> 0x08: <span class="keywordflow">case</span> 0x18: <span class="keywordflow">case</span> 0x28: <span class="keywordflow">case</span> 0x38: <span class="keywordflow">case</span> 0x48: <span class="keywordflow">case</span> 0x58: <span class="keywordflow">case</span> 0x68: <span class="keywordflow">case</span> 0x78: 
<a name="l00101"></a>00101             <span class="keywordflow">case</span> 0x88: <span class="keywordflow">case</span> 0x98: <span class="keywordflow">case</span> 0xa8: <span class="keywordflow">case</span> 0xb8: <span class="keywordflow">case</span> 0xc8: <span class="keywordflow">case</span> 0xd8: <span class="keywordflow">case</span> 0xe8: <span class="keywordflow">case</span> 0xf8:
<a name="l00102"></a>00102                   usType = <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f7974889399482ff824341e35acad9e2c4057c">SECONDWALL</a>;
<a name="l00103"></a>00103                   usIndex = 13 + (<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>)<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 4 ); 
<a name="l00104"></a>00104                   <span class="keywordflow">break</span>;
<a name="l00105"></a>00105             <span class="keywordflow">case</span> 0x09: <span class="keywordflow">case</span> 0x29: <span class="keywordflow">case</span> 0x49: <span class="keywordflow">case</span> 0x69: <span class="keywordflow">case</span> 0x89: <span class="keywordflow">case</span> 0xa9: <span class="keywordflow">case</span> 0xc9: <span class="keywordflow">case</span> 0xe9: 
<a name="l00106"></a>00106                   usIndex = 6;
<a name="l00107"></a>00107                   <span class="keywordflow">break</span>;
<a name="l00108"></a>00108             <span class="keywordflow">case</span> 0x0a: <span class="keywordflow">case</span> 0x1a: <span class="keywordflow">case</span> 0x2a: <span class="keywordflow">case</span> 0x3a: <span class="keywordflow">case</span> 0x4a: <span class="keywordflow">case</span> 0x5a: <span class="keywordflow">case</span> 0x6a: <span class="keywordflow">case</span> 0x7a: 
<a name="l00109"></a>00109             <span class="keywordflow">case</span> 0x8a: <span class="keywordflow">case</span> 0x9a: <span class="keywordflow">case</span> 0xaa: <span class="keywordflow">case</span> 0xba: <span class="keywordflow">case</span> 0xca: <span class="keywordflow">case</span> 0xda: <span class="keywordflow">case</span> 0xea: <span class="keywordflow">case</span> 0xfa:
<a name="l00110"></a>00110                   usIndex = 7 + (<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>)<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 2 );
<a name="l00111"></a>00111                   <span class="keywordflow">break</span>;
<a name="l00112"></a>00112             <span class="keywordflow">case</span> 0x0b: <span class="keywordflow">case</span> 0x4b: <span class="keywordflow">case</span> 0x8b: <span class="keywordflow">case</span> 0xcb: 
<a name="l00113"></a>00113                   usIndex = 9;
<a name="l00114"></a>00114                   <span class="keywordflow">break</span>;
<a name="l00115"></a>00115             <span class="keywordflow">case</span> 0x0c: <span class="keywordflow">case</span> 0x1c: <span class="keywordflow">case</span> 0x2c: <span class="keywordflow">case</span> 0x3c: <span class="keywordflow">case</span> 0x4c: <span class="keywordflow">case</span> 0x5c: <span class="keywordflow">case</span> 0x6c: <span class="keywordflow">case</span> 0x7c: 
<a name="l00116"></a>00116                   usIndex = 10;
<a name="l00117"></a>00117                   <span class="keywordflow">break</span>;
<a name="l00118"></a>00118             <span class="keywordflow">case</span> 0x0d: <span class="keywordflow">case</span> 0x2d: <span class="keywordflow">case</span> 0x4d: <span class="keywordflow">case</span> 0x6d:
<a name="l00119"></a>00119                   usIndex = 11;
<a name="l00120"></a>00120                   <span class="keywordflow">break</span>;
<a name="l00121"></a>00121             <span class="keywordflow">case</span> 0x0e: <span class="keywordflow">case</span> 0x1e: <span class="keywordflow">case</span> 0x2e: <span class="keywordflow">case</span> 0x3e: 
<a name="l00122"></a>00122                   usIndex = 12;
<a name="l00123"></a>00123                   <span class="keywordflow">break</span>;
<a name="l00124"></a>00124             <span class="keywordflow">case</span> 0x0f: 
<a name="l00125"></a>00125                   usIndex = 13;
<a name="l00126"></a>00126                   <span class="keywordflow">break</span>;
<a name="l00127"></a>00127             <span class="keywordflow">case</span> 0x19: <span class="keywordflow">case</span> 0x39: <span class="keywordflow">case</span> 0x59: <span class="keywordflow">case</span> 0x79: <span class="keywordflow">case</span> 0x99: <span class="keywordflow">case</span> 0xb9: <span class="keywordflow">case</span> 0xd9: <span class="keywordflow">case</span> 0xf9: 
<a name="l00128"></a>00128                   usIndex = 14 + (<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>)<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 2 );
<a name="l00129"></a>00129                   <span class="keywordflow">break</span>;
<a name="l00130"></a>00130             <span class="keywordflow">case</span> 0x1b: <span class="keywordflow">case</span> 0x5b: <span class="keywordflow">case</span> 0x9b: <span class="keywordflow">case</span> 0xdb: 
<a name="l00131"></a>00131                   usIndex = 16;
<a name="l00132"></a>00132                   <span class="keywordflow">break</span>;
<a name="l00133"></a>00133             <span class="keywordflow">case</span> 0x1d: <span class="keywordflow">case</span> 0x3d: <span class="keywordflow">case</span> 0x5d: <span class="keywordflow">case</span> 0x7d:
<a name="l00134"></a>00134                   usIndex = 17;
<a name="l00135"></a>00135                   <span class="keywordflow">break</span>;
<a name="l00136"></a>00136             <span class="keywordflow">case</span> 0x1f:
<a name="l00137"></a>00137                   usIndex = 18;
<a name="l00138"></a>00138                   <span class="keywordflow">break</span>;
<a name="l00139"></a>00139             <span class="keywordflow">case</span> 0x23: <span class="keywordflow">case</span> 0x33: <span class="keywordflow">case</span> 0x63: <span class="keywordflow">case</span> 0x73: <span class="keywordflow">case</span> 0xa3: <span class="keywordflow">case</span> 0xb3: <span class="keywordflow">case</span> 0xe3: <span class="keywordflow">case</span> 0xf3: 
<a name="l00140"></a>00140                   usIndex = 19 + (<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>)<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 2 );
<a name="l00141"></a>00141                   <span class="keywordflow">break</span>;
<a name="l00142"></a>00142             <span class="keywordflow">case</span> 0x27: <span class="keywordflow">case</span> 0x37: <span class="keywordflow">case</span> 0xa7: <span class="keywordflow">case</span> 0xb7:
<a name="l00143"></a>00143                   usIndex = 21;
<a name="l00144"></a>00144                   <span class="keywordflow">break</span>;
<a name="l00145"></a>00145             <span class="keywordflow">case</span> 0x2b: <span class="keywordflow">case</span> 0x6b: <span class="keywordflow">case</span> 0xab: <span class="keywordflow">case</span> 0xeb: 
<a name="l00146"></a>00146                   usIndex = 22;
<a name="l00147"></a>00147                   <span class="keywordflow">break</span>;
<a name="l00148"></a>00148             <span class="keywordflow">case</span> 0x2f:
<a name="l00149"></a>00149                   usIndex = 23;
<a name="l00150"></a>00150                   <span class="keywordflow">break</span>;
<a name="l00151"></a>00151             <span class="keywordflow">case</span> 0x3b: <span class="keywordflow">case</span> 0x7b: <span class="keywordflow">case</span> 0xbb: <span class="keywordflow">case</span> 0xfb: 
<a name="l00152"></a>00152                   usIndex = 24 + (<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>)<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 3 );
<a name="l00153"></a>00153                   <span class="keywordflow">break</span>;
<a name="l00154"></a>00154             <span class="keywordflow">case</span> 0x3f:
<a name="l00155"></a>00155                   usIndex = 27;
<a name="l00156"></a>00156                   <span class="keywordflow">break</span>;
<a name="l00157"></a>00157             <span class="keywordflow">case</span> 0x46: <span class="keywordflow">case</span> 0x56: <span class="keywordflow">case</span> 0x66: <span class="keywordflow">case</span> 0x76: <span class="keywordflow">case</span> 0xc6: <span class="keywordflow">case</span> 0xd6: <span class="keywordflow">case</span> 0xe6: <span class="keywordflow">case</span> 0xf6: 
<a name="l00158"></a>00158                   usIndex = 28 + (<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>)<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 2 );
<a name="l00159"></a>00159                   <span class="keywordflow">break</span>;
<a name="l00160"></a>00160             <span class="keywordflow">case</span> 0x47: <span class="keywordflow">case</span> 0x57: <span class="keywordflow">case</span> 0xc7: <span class="keywordflow">case</span> 0xd7:
<a name="l00161"></a>00161                   usIndex = 30;
<a name="l00162"></a>00162                   <span class="keywordflow">break</span>;
<a name="l00163"></a>00163             <span class="keywordflow">case</span> 0x4e: <span class="keywordflow">case</span> 0x5e: <span class="keywordflow">case</span> 0x6e: <span class="keywordflow">case</span> 0x7e: 
<a name="l00164"></a>00164                   usIndex = 31;
<a name="l00165"></a>00165                   <span class="keywordflow">break</span>;
<a name="l00166"></a>00166             <span class="keywordflow">case</span> 0x4f:
<a name="l00167"></a>00167                   usIndex = 32;
<a name="l00168"></a>00168                   <span class="keywordflow">break</span>;
<a name="l00169"></a>00169             <span class="keywordflow">case</span> 0x5f:
<a name="l00170"></a>00170                   usIndex = 33;
<a name="l00171"></a>00171                   <span class="keywordflow">break</span>;
<a name="l00172"></a>00172             <span class="keywordflow">case</span> 0x67: <span class="keywordflow">case</span> 0x77: <span class="keywordflow">case</span> 0xe7: <span class="keywordflow">case</span> 0xf7:
<a name="l00173"></a>00173                   usIndex = 34 + (<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>)<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 3 );
<a name="l00174"></a>00174                   <span class="keywordflow">break</span>;
<a name="l00175"></a>00175             <span class="keywordflow">case</span> 0x6f:
<a name="l00176"></a>00176                   usIndex = 37;
<a name="l00177"></a>00177                   <span class="keywordflow">break</span>;
<a name="l00178"></a>00178             <span class="keywordflow">case</span> 0x7f:
<a name="l00179"></a>00179                   usIndex = 38 + (<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>)<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 2 );
<a name="l00180"></a>00180                   <span class="keywordflow">break</span>;
<a name="l00181"></a>00181             <span class="keywordflow">case</span> 0x8c: <span class="keywordflow">case</span> 0x9c: <span class="keywordflow">case</span> 0xac: <span class="keywordflow">case</span> 0xbc: <span class="keywordflow">case</span> 0xcc: <span class="keywordflow">case</span> 0xdc: <span class="keywordflow">case</span> 0xec: <span class="keywordflow">case</span> 0xfc:
<a name="l00182"></a>00182                   usIndex = 40 + (<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>)<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 2 );
<a name="l00183"></a>00183                   <span class="keywordflow">break</span>;
<a name="l00184"></a>00184             <span class="keywordflow">case</span> 0x8d: <span class="keywordflow">case</span> 0xad: <span class="keywordflow">case</span> 0xcd: <span class="keywordflow">case</span> 0xed:
<a name="l00185"></a>00185                   usIndex = 42;
<a name="l00186"></a>00186                   <span class="keywordflow">break</span>;
<a name="l00187"></a>00187             <span class="keywordflow">case</span> 0x8e: <span class="keywordflow">case</span> 0x9e: <span class="keywordflow">case</span> 0xae: <span class="keywordflow">case</span> 0xbe: 
<a name="l00188"></a>00188                   usIndex = 43;
<a name="l00189"></a>00189                   <span class="keywordflow">break</span>;
<a name="l00190"></a>00190             <span class="keywordflow">case</span> 0x8f:
<a name="l00191"></a>00191                   usIndex = 44;
<a name="l00192"></a>00192                   <span class="keywordflow">break</span>;
<a name="l00193"></a>00193             <span class="keywordflow">case</span> 0x9d: <span class="keywordflow">case</span> 0xbd: <span class="keywordflow">case</span> 0xdd: <span class="keywordflow">case</span> 0xfd:
<a name="l00194"></a>00194                   usIndex = 45 + (<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>)<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 3 );
<a name="l00195"></a>00195                   <span class="keywordflow">break</span>;
<a name="l00196"></a>00196             <span class="keywordflow">case</span> 0x9f:
<a name="l00197"></a>00197                   usIndex = 48;
<a name="l00198"></a>00198                   <span class="keywordflow">break</span>;
<a name="l00199"></a>00199             <span class="keywordflow">case</span> 0xaf:
<a name="l00200"></a>00200                   usIndex = 49;
<a name="l00201"></a>00201                   <span class="keywordflow">break</span>;
<a name="l00202"></a>00202             <span class="keywordflow">case</span> 0xbf:
<a name="l00203"></a>00203                   usIndex = 50 + (<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>)<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 2 );
<a name="l00204"></a>00204                   <span class="keywordflow">break</span>;
<a name="l00205"></a>00205             <span class="keywordflow">case</span> 0xce: <span class="keywordflow">case</span> 0xde: <span class="keywordflow">case</span> 0xee: <span class="keywordflow">case</span> 0xfe: 
<a name="l00206"></a>00206                   usIndex = 52 + (<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>)<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 3 );
<a name="l00207"></a>00207                   <span class="keywordflow">break</span>;
<a name="l00208"></a>00208             <span class="keywordflow">case</span> 0xcf:
<a name="l00209"></a>00209                   usIndex = 55;
<a name="l00210"></a>00210                   <span class="keywordflow">break</span>;
<a name="l00211"></a>00211             <span class="keywordflow">case</span> 0xdf:
<a name="l00212"></a>00212                   usIndex = 56 + (<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>)<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 2 );
<a name="l00213"></a>00213                   <span class="keywordflow">break</span>;
<a name="l00214"></a>00214             <span class="keywordflow">case</span> 0xef:
<a name="l00215"></a>00215                   usIndex = 58 + (<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>)<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 2 );
<a name="l00216"></a>00216                   <span class="keywordflow">break</span>;
<a name="l00217"></a>00217             <span class="keywordflow">case</span> 0xff:
<a name="l00218"></a>00218                   usIndex = 60 + (<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>)<a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( 6 );
<a name="l00219"></a>00219                   <span class="keywordflow">break</span>;
<a name="l00220"></a>00220       }
<a name="l00221"></a>00221       <a class="code" href="tiledef_8cpp.html#88fb4209f479cf8705b24390553f0e16">GetTileIndexFromTypeSubIndex</a>( usType, usIndex, &amp;usTileIndex );
<a name="l00222"></a>00222       <span class="keywordflow">return</span> usTileIndex;
<a name="l00223"></a>00223 }
<a name="l00224"></a>00224 
<a name="l00225"></a>00225 <span class="comment">//    16 | 1 | 32</span>
<a name="l00226"></a>00226 <span class="comment">//    ---+---+---</span>
<a name="l00227"></a>00227 <span class="comment">//     8 |   | 2</span>
<a name="l00228"></a>00228 <span class="comment">//    ---+---+---</span>
<a name="l00229"></a>00229 <span class="comment">//    128| 4 | 64</span>
<a name="l00230"></a>00230 <span class="comment">//These values are combined in any possible order ranging in </span>
<a name="l00231"></a>00231 <span class="comment">//values from 0 - 255.  If there is a cave existing in any of</span>
<a name="l00232"></a>00232 <span class="comment">//these bordering gridnos, then the corresponding number is added</span>
<a name="l00233"></a>00233 <span class="comment">//to this total.  The lookup table has been precalculated to know</span>
<a name="l00234"></a>00234 <span class="comment">//which piece to use for all of these combinations.  In many cases,</span>
<a name="l00235"></a>00235 <span class="comment">//up to 16 combinations can share the same graphic image, as corners</span>
<a name="l00236"></a>00236 <span class="comment">//may not effect the look of the piece.</span>
<a name="l00237"></a><a class="code" href="newsmooth_8cpp.html#6c0b1a7384947f890223a72d03e88084">00237</a> <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> <a class="code" href="newsmooth_8cpp.html#6c0b1a7384947f890223a72d03e88084">CalcNewCavePerimeterValue</a>( <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> <a class="code" href="editscreen_8cpp.html#48f31659f64cd18c814b1612166c50b5">iMapIndex</a> )
<a name="l00238"></a>00238 {
<a name="l00239"></a>00239       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubTotal = 0;
<a name="l00240"></a>00240       <span class="keywordflow">if</span>( <a class="code" href="newsmooth_8cpp.html#66062e27517c0e62d139c0fd57b124d1">CaveAtGridNo</a>( iMapIndex - WORLD_COLS ) )
<a name="l00241"></a>00241             ubTotal += 0x01;  <span class="comment">//north</span>
<a name="l00242"></a>00242       <span class="keywordflow">if</span>( <a class="code" href="newsmooth_8cpp.html#66062e27517c0e62d139c0fd57b124d1">CaveAtGridNo</a>( iMapIndex + 1 ) )
<a name="l00243"></a>00243             ubTotal += 0x02;  <span class="comment">//east</span>
<a name="l00244"></a>00244       <span class="keywordflow">if</span>( <a class="code" href="newsmooth_8cpp.html#66062e27517c0e62d139c0fd57b124d1">CaveAtGridNo</a>( iMapIndex + WORLD_COLS ) )
<a name="l00245"></a>00245             ubTotal += 0x04;  <span class="comment">//south      </span>
<a name="l00246"></a>00246       <span class="keywordflow">if</span>( <a class="code" href="newsmooth_8cpp.html#66062e27517c0e62d139c0fd57b124d1">CaveAtGridNo</a>( iMapIndex - 1 ) )
<a name="l00247"></a>00247             ubTotal += 0x08;  <span class="comment">//west</span>
<a name="l00248"></a>00248       <span class="keywordflow">if</span>( <a class="code" href="newsmooth_8cpp.html#66062e27517c0e62d139c0fd57b124d1">CaveAtGridNo</a>( iMapIndex - WORLD_COLS - 1 ) )
<a name="l00249"></a>00249             ubTotal += 0x10;  <span class="comment">//north west</span>
<a name="l00250"></a>00250       <span class="keywordflow">if</span>( <a class="code" href="newsmooth_8cpp.html#66062e27517c0e62d139c0fd57b124d1">CaveAtGridNo</a>( iMapIndex - WORLD_COLS + 1 ) )
<a name="l00251"></a>00251             ubTotal += 0x20;  <span class="comment">//north east</span>
<a name="l00252"></a>00252       <span class="keywordflow">if</span>( <a class="code" href="newsmooth_8cpp.html#66062e27517c0e62d139c0fd57b124d1">CaveAtGridNo</a>( iMapIndex + WORLD_COLS + 1 ) )
<a name="l00253"></a>00253             ubTotal += 0x40;  <span class="comment">//south east</span>
<a name="l00254"></a>00254       <span class="keywordflow">if</span>( <a class="code" href="newsmooth_8cpp.html#66062e27517c0e62d139c0fd57b124d1">CaveAtGridNo</a>( iMapIndex + WORLD_COLS - 1 ) )
<a name="l00255"></a>00255             ubTotal += 0x80;  <span class="comment">//south west</span>
<a name="l00256"></a>00256       <span class="keywordflow">return</span> ubTotal;
<a name="l00257"></a>00257 }
<a name="l00258"></a>00258 
<a name="l00259"></a><a class="code" href="newsmooth_8h.html#e71c70b825417bc706a561f024e10228">00259</a> <span class="keywordtype">void</span> <a class="code" href="newsmooth_8cpp.html#e71c70b825417bc706a561f024e10228">AddCave</a>( <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> <a class="code" href="editscreen_8cpp.html#48f31659f64cd18c814b1612166c50b5">iMapIndex</a>, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex )
<a name="l00260"></a>00260 {
<a name="l00261"></a>00261       <a class="code" href="structTAG__level__node.html">LEVELNODE</a> *pStruct;
<a name="l00262"></a>00262 
<a name="l00263"></a>00263       <span class="keywordflow">if</span>( iMapIndex &lt; 0 || iMapIndex &gt;= NOWHERE )
<a name="l00264"></a>00264             <span class="keywordflow">return</span>;
<a name="l00265"></a>00265       <span class="comment">//First toast any existing wall (caves)</span>
<a name="l00266"></a>00266       <a class="code" href="worldman_8cpp.html#1acec58102dd248ff2c5d15b9f59609b">RemoveAllStructsOfTypeRange</a>( iMapIndex, <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f79748562c9c35be47be8af96e1ec9a898513c">FIRSTWALL</a>, LASTWALL );
<a name="l00267"></a>00267       <span class="comment">//Now, add this piece</span>
<a name="l00268"></a>00268       <span class="keywordflow">if</span>( !<a class="code" href="worldman_8cpp.html#9253fa7589780a7dfc3feee0cd812eb2">AddWallToStructLayer</a>( iMapIndex, usIndex, TRUE ) )
<a name="l00269"></a>00269             <span class="keywordflow">return</span>;
<a name="l00270"></a>00270       <span class="comment">//Set the cave flag</span>
<a name="l00271"></a>00271       pStruct = <a class="code" href="worlddef_8cpp.html#a1c640bcf89772795e6517da9963e0d7">gpWorldLevelData</a>[ iMapIndex ].<a class="code" href="structMAP__ELEMENT.html#0cc751d3c74e25ab6dd78d58da155f6d">pStructHead</a>;
<a name="l00272"></a>00272       Assert( pStruct );
<a name="l00273"></a>00273       pStruct-&gt;<a class="code" href="structTAG__level__node.html#d2f7b6a466532e1f2bb982a0f206db6a">uiFlags</a> |= LEVELNODE_CAVE;
<a name="l00274"></a>00274 }
<a name="l00275"></a>00275 
<a name="l00276"></a>00276 <span class="comment">//These walls have shadows associated with them, and are draw when the wall is drawn.</span>
<a name="l00277"></a>00277 <span class="preprocessor">#define EXTERIOR_L_SHADOW_INDEX                             30</span>
<a name="l00278"></a>00278 <span class="preprocessor"></span><span class="preprocessor">#define INTERIOR_BOTTOMEND_SHADOW_INDEX   31</span>
<a name="l00279"></a>00279 <span class="preprocessor"></span>
<a name="l00280"></a>00280 <span class="comment">//Wall Look Up Table containing variants and indices with each row being a different walltype.</span>
<a name="l00281"></a><a class="code" href="Smoothing_01Utils_8h.html#5a036135a2ed2c706e2264d6e49e3b49">00281</a> <a class="code" href="Types_8h.html#7ebe70ceca856797319175e30bcf003d">INT8</a> <a class="code" href="newsmooth_8cpp.html#5a036135a2ed2c706e2264d6e49e3b49">gbWallTileLUT</a>[<a class="code" href="Smoothing_01Utils_8h.html#96a58e29e8dbf2b5bdeb775cba46556ee912e81326bf44891ae6daedc0a565ad">NUM_WALL_TYPES</a>][7] = 
<a name="l00282"></a>00282 { 
<a name="l00283"></a>00283 <span class="comment">//    The number of variants of this tile type.</span>
<a name="l00284"></a>00284 <span class="comment">//  |             The first relative index of the wall type (FIRSTWALL, SECONDWALL, etc. )  walltype + 10</span>
<a name="l00285"></a>00285 <span class="comment">//    |                 |           The 2nd relative index  ( walltype + 11 )</span>
<a name="l00286"></a>00286 <span class="comment">//    |                 |           |           3rd   4th 5th 6th</span>
<a name="l00287"></a>00287 <span class="comment">//    |                 |           |           |           |   |   |</span>
<a name="l00288"></a>00288             6,          10, 11, 12, 27, 28, 29,                         <span class="comment">//INTERIOR_L</span>
<a name="l00289"></a>00289             6,           7,  8,  9, 24, 25, 26,                         <span class="comment">//INTERIOR_R</span>
<a name="l00290"></a>00290             6,     4,  5,  6, 21, 22, 23,                         <span class="comment">//EXTERIOR_L</span>
<a name="l00291"></a>00291             6,           1,  2,  3, 18, 19, 20,                         <span class="comment">//EXTERIOR_R</span>
<a name="l00292"></a>00292             1,          14,  0,  0,  0,  0,  0,                         <span class="comment">//INTERIOR_CORNER</span>
<a name="l00293"></a>00293             1,    15,  0,  0,  0,  0,  0,                         <span class="comment">//INTERIOR_BOTTOMEND</span>
<a name="l00294"></a>00294             1,    13,  0,  0,  0,  0,  0,                         <span class="comment">//EXTERIOR_BOTTOMEND</span>
<a name="l00295"></a>00295             1,    16,  0,  0,  0,  0,  0,                         <span class="comment">//INTERIOR_EXTENDED</span>
<a name="l00296"></a>00296             1,    57,  0,  0,  0,  0,  0,                         <span class="comment">//EXTERIOR_EXTENDED</span>
<a name="l00297"></a>00297             1,    56,  0,  0,  0,  0,  0,                         <span class="comment">//INTERIOR_EXTENDED_BOTTOMEND  </span>
<a name="l00298"></a>00298             1,    17,  0,  0,  0,  0,  0,                         <span class="comment">//EXTERIOR_EXTENDED_BOTTOMEND  </span>
<a name="l00299"></a>00299 };
<a name="l00300"></a>00300 
<a name="l00301"></a>00301 <span class="comment">//Roof table -- such a small table, using definitions instead.</span>
<a name="l00302"></a>00302 <span class="preprocessor">#define TOP_ROOF_INDEX                          2</span>
<a name="l00303"></a>00303 <span class="preprocessor"></span><span class="preprocessor">#define BOTTOM_ROOF_INDEX                       4</span>
<a name="l00304"></a>00304 <span class="preprocessor"></span><span class="preprocessor">#define LEFT_ROOF_INDEX                         1</span>
<a name="l00305"></a>00305 <span class="preprocessor"></span><span class="preprocessor">#define RIGHT_ROOF_INDEX                        5</span>
<a name="l00306"></a>00306 <span class="preprocessor"></span><span class="preprocessor">#define TOPLEFT_ROOF_INDEX                3</span>
<a name="l00307"></a>00307 <span class="preprocessor"></span><span class="preprocessor">#define TOPRIGHT_ROOF_INDEX               7</span>
<a name="l00308"></a>00308 <span class="preprocessor"></span><span class="preprocessor">#define BOTTOMLEFT_ROOF_INDEX       8</span>
<a name="l00309"></a>00309 <span class="preprocessor"></span><span class="preprocessor">#define BOTTOMRIGHT_ROOF_INDEX      6</span>
<a name="l00310"></a>00310 <span class="preprocessor"></span><span class="preprocessor">#define CENTER_ROOF_BASE_INDEX      9</span>
<a name="l00311"></a>00311 <span class="preprocessor"></span><span class="preprocessor">#define CENTER_ROOF_VARIANTS        3</span>
<a name="l00312"></a>00312 <span class="preprocessor"></span>
<a name="l00313"></a>00313 <span class="comment">//slant roof table</span>
<a name="l00314"></a>00314 <span class="preprocessor">#define THIN_BOTTOM           1</span>
<a name="l00315"></a>00315 <span class="preprocessor"></span><span class="preprocessor">#define THIN_TOP              2</span>
<a name="l00316"></a>00316 <span class="preprocessor"></span><span class="preprocessor">#define THIN_LEFT             5</span>
<a name="l00317"></a>00317 <span class="preprocessor"></span><span class="preprocessor">#define THIN_RIGHT            6</span>
<a name="l00318"></a>00318 <span class="preprocessor"></span><span class="preprocessor">#define THICK_BOTTOM    3</span>
<a name="l00319"></a>00319 <span class="preprocessor"></span><span class="preprocessor">#define THICK_TOP             4</span>
<a name="l00320"></a>00320 <span class="preprocessor"></span><span class="preprocessor">#define THICK_LEFT            7</span>
<a name="l00321"></a>00321 <span class="preprocessor"></span><span class="preprocessor">#define     THICK_RIGHT       8</span>
<a name="l00322"></a>00322 <span class="preprocessor"></span><span class="preprocessor">#define VWALL_LEFT            32</span>
<a name="l00323"></a>00323 <span class="preprocessor"></span><span class="preprocessor">#define VWALL_RIGHT           33</span>
<a name="l00324"></a>00324 <span class="preprocessor"></span><span class="preprocessor">#define HWALL_LEFT            35</span>
<a name="l00325"></a>00325 <span class="preprocessor"></span><span class="preprocessor">#define HWALL_RIGHT           34</span>
<a name="l00326"></a>00326 <span class="preprocessor"></span>
<a name="l00327"></a>00327 
<a name="l00328"></a>00328 <span class="preprocessor">#define FLOOR_VARIANTS                          8</span>
<a name="l00329"></a>00329 <span class="preprocessor"></span>
<a name="l00330"></a>00330 <span class="comment">//PRIVATELY "ENCAPSULATED" FUNCTIONS</span>
<a name="l00331"></a>00331 
<a name="l00332"></a>00332 <span class="comment">//These construction functions do all the smoothing.</span>
<a name="l00333"></a>00333 <span class="comment">//NOTE:  passing null for wall/roof type will force the function to search for the nearest </span>
<a name="l00334"></a>00334 <span class="comment">//  existing respective type.</span>
<a name="l00335"></a>00335 <span class="keywordtype">void</span> <a class="code" href="newsmooth_8cpp.html#a401a45a362fc6fd2203d1a6896cb6bb">BuildSlantRoof</a>( <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iLeft, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iTop, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iRight, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iBottom, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usWallType, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usRoofType, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fVertical ); 
<a name="l00336"></a>00336 
<a name="l00337"></a>00337 <span class="keywordtype">void</span> <a class="code" href="newsmooth_8cpp.html#f603663531a105d18fef60a0a2f3e612">BulldozeNature</a>( <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="editscreen_8cpp.html#48f31659f64cd18c814b1612166c50b5">iMapIndex</a> );
<a name="l00338"></a>00338 <span class="keywordtype">void</span> <a class="code" href="newsmooth_8cpp.html#7323c011de10e4227ba2bb0eb61decb2">EraseRoof</a>( <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="editscreen_8cpp.html#48f31659f64cd18c814b1612166c50b5">iMapIndex</a> );
<a name="l00339"></a>00339 <span class="keywordtype">void</span> <a class="code" href="newsmooth_8cpp.html#df917a9847f4ef4e8c8023e2dc2ee4e7">EraseFloor</a>( <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="editscreen_8cpp.html#48f31659f64cd18c814b1612166c50b5">iMapIndex</a> );
<a name="l00340"></a>00340 <span class="keywordtype">void</span> <a class="code" href="newsmooth_8cpp.html#acb8d2a13fccbfcc46a3a1cf064943d8">EraseBuilding</a>( <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="editscreen_8cpp.html#48f31659f64cd18c814b1612166c50b5">iMapIndex</a> );
<a name="l00341"></a>00341 <span class="keywordtype">void</span> <a class="code" href="newsmooth_8cpp.html#dded0d807f1fbf5bc7cbe40d4c13d6fe">EraseFloorOwnedBuildingPieces</a>( <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="editscreen_8cpp.html#48f31659f64cd18c814b1612166c50b5">iMapIndex</a> );
<a name="l00342"></a>00342 <span class="keywordtype">void</span> <a class="code" href="newsmooth_8cpp.html#f3bd2b99eda9b052721c4b2b602d1d03">ConsiderEffectsOfNewWallPiece</a>( <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="editscreen_8cpp.html#48f31659f64cd18c814b1612166c50b5">iMapIndex</a>, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> usWallOrientation );
<a name="l00343"></a>00343 
<a name="l00344"></a>00344 <span class="comment">//----------------------------------------------------------------------------------------------------</span>
<a name="l00345"></a>00345 <span class="comment">//BEGIN IMPLEMENTATION OF PRIVATE FUNCTIONS</span>
<a name="l00346"></a>00346 <span class="comment">//----------------------------------------------------------------------------------------------------</span>
<a name="l00347"></a>00347 
<a name="l00348"></a><a class="code" href="newsmooth_8cpp.html#a401a45a362fc6fd2203d1a6896cb6bb">00348</a> <span class="keywordtype">void</span> <a class="code" href="newsmooth_8cpp.html#a401a45a362fc6fd2203d1a6896cb6bb">BuildSlantRoof</a>( <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iLeft, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iTop, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iRight, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iBottom, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usWallType, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usRoofType, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fVertical )
<a name="l00349"></a>00349 {
<a name="l00350"></a>00350       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> i;
<a name="l00351"></a>00351       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usTileIndex;
<a name="l00352"></a>00352       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> <a class="code" href="editscreen_8cpp.html#48f31659f64cd18c814b1612166c50b5">iMapIndex</a>;
<a name="l00353"></a>00353       <span class="keywordflow">if</span>( fVertical )
<a name="l00354"></a>00354       {
<a name="l00355"></a>00355             iMapIndex = iBottom * WORLD_COLS + iLeft;
<a name="l00356"></a>00356             <span class="comment">//This happens to be the only mapindex that needs to be backed up.  The rest have already been</span>
<a name="l00357"></a>00357             <span class="comment">//done because of the building code before this.</span>
<a name="l00358"></a>00358             <a class="code" href="Editor_01Undo_8cpp.html#9b2fd306128d272a5745c07ff45478cc">AddToUndoList</a>( iMapIndex + 8 );
<a name="l00359"></a>00359             <span class="comment">//Add the closest viewable pieces.  There are two aframe walls pieces, and extended aframe roof pieces.</span>
<a name="l00360"></a>00360             <a class="code" href="tiledef_8cpp.html#88fb4209f479cf8705b24390553f0e16">GetTileIndexFromTypeSubIndex</a>( usWallType, VWALL_LEFT, &amp;usTileIndex );
<a name="l00361"></a>00361             <a class="code" href="worldman_8cpp.html#9c17e54f8854f79a814dc473877fb094">AddRoofToHead</a>( iMapIndex + 4, usTileIndex );
<a name="l00362"></a>00362             <a class="code" href="tiledef_8cpp.html#88fb4209f479cf8705b24390553f0e16">GetTileIndexFromTypeSubIndex</a>( usWallType, VWALL_RIGHT, &amp;usTileIndex );
<a name="l00363"></a>00363             <a class="code" href="worldman_8cpp.html#9c17e54f8854f79a814dc473877fb094">AddRoofToHead</a>( iMapIndex + 8, usTileIndex );
<a name="l00364"></a>00364             <a class="code" href="tiledef_8cpp.html#88fb4209f479cf8705b24390553f0e16">GetTileIndexFromTypeSubIndex</a>( usRoofType, THICK_LEFT, &amp;usTileIndex );
<a name="l00365"></a>00365             <a class="code" href="worldman_8cpp.html#9c17e54f8854f79a814dc473877fb094">AddRoofToHead</a>( iMapIndex + 3, usTileIndex );
<a name="l00366"></a>00366             <a class="code" href="tiledef_8cpp.html#88fb4209f479cf8705b24390553f0e16">GetTileIndexFromTypeSubIndex</a>( usRoofType, THICK_RIGHT, &amp;usTileIndex );
<a name="l00367"></a>00367             <a class="code" href="worldman_8cpp.html#9c17e54f8854f79a814dc473877fb094">AddRoofToHead</a>( iMapIndex + 7, usTileIndex );
<a name="l00368"></a>00368             <span class="keywordflow">for</span>( i = iBottom - 1; i &gt; iTop; i-- )
<a name="l00369"></a>00369             {
<a name="l00370"></a>00370                   iMapIndex -= WORLD_COLS;
<a name="l00371"></a>00371                   <a class="code" href="tiledef_8cpp.html#88fb4209f479cf8705b24390553f0e16">GetTileIndexFromTypeSubIndex</a>( usRoofType, THIN_LEFT, &amp;usTileIndex );
<a name="l00372"></a>00372                   <a class="code" href="worldman_8cpp.html#9c17e54f8854f79a814dc473877fb094">AddRoofToHead</a>( iMapIndex + 3, usTileIndex );
<a name="l00373"></a>00373                   <a class="code" href="tiledef_8cpp.html#88fb4209f479cf8705b24390553f0e16">GetTileIndexFromTypeSubIndex</a>( usRoofType, THIN_RIGHT, &amp;usTileIndex );
<a name="l00374"></a>00374                   <a class="code" href="worldman_8cpp.html#9c17e54f8854f79a814dc473877fb094">AddRoofToHead</a>( iMapIndex + 7, usTileIndex );
<a name="l00375"></a>00375             }
<a name="l00376"></a>00376             iMapIndex -= WORLD_COLS;
<a name="l00377"></a>00377             <a class="code" href="tiledef_8cpp.html#88fb4209f479cf8705b24390553f0e16">GetTileIndexFromTypeSubIndex</a>( usRoofType, THICK_LEFT, &amp;usTileIndex );
<a name="l00378"></a>00378             <a class="code" href="worldman_8cpp.html#9c17e54f8854f79a814dc473877fb094">AddRoofToHead</a>( iMapIndex + 3, usTileIndex );
<a name="l00379"></a>00379             <a class="code" href="tiledef_8cpp.html#88fb4209f479cf8705b24390553f0e16">GetTileIndexFromTypeSubIndex</a>( usRoofType, THICK_RIGHT, &amp;usTileIndex );
<a name="l00380"></a>00380             <a class="code" href="worldman_8cpp.html#9c17e54f8854f79a814dc473877fb094">AddRoofToHead</a>( iMapIndex + 7, usTileIndex );
<a name="l00381"></a>00381       }
<a name="l00382"></a>00382       <span class="keywordflow">else</span>
<a name="l00383"></a>00383       {
<a name="l00384"></a>00384             iMapIndex = iTop * WORLD_COLS + iRight;
<a name="l00385"></a>00385             <span class="comment">//This happens to be the only mapindex that needs to be backed up.  The rest have already been</span>
<a name="l00386"></a>00386             <span class="comment">//done because of the building code before this.</span>
<a name="l00387"></a>00387             <a class="code" href="Editor_01Undo_8cpp.html#9b2fd306128d272a5745c07ff45478cc">AddToUndoList</a>( iMapIndex + 8*WORLD_COLS );
<a name="l00388"></a>00388             <span class="comment">//Add the closest viewable pieces.  There are two aframe walls pieces, and extended aframe roof pieces.</span>
<a name="l00389"></a>00389             <a class="code" href="tiledef_8cpp.html#88fb4209f479cf8705b24390553f0e16">GetTileIndexFromTypeSubIndex</a>( usWallType, HWALL_LEFT, &amp;usTileIndex );
<a name="l00390"></a>00390             <a class="code" href="worldman_8cpp.html#9c17e54f8854f79a814dc473877fb094">AddRoofToHead</a>( iMapIndex + 4*WORLD_COLS, usTileIndex );
<a name="l00391"></a>00391             <a class="code" href="tiledef_8cpp.html#88fb4209f479cf8705b24390553f0e16">GetTileIndexFromTypeSubIndex</a>( usWallType, HWALL_RIGHT, &amp;usTileIndex );
<a name="l00392"></a>00392             <a class="code" href="worldman_8cpp.html#9c17e54f8854f79a814dc473877fb094">AddRoofToHead</a>( iMapIndex + 8*WORLD_COLS, usTileIndex );
<a name="l00393"></a>00393             <a class="code" href="tiledef_8cpp.html#88fb4209f479cf8705b24390553f0e16">GetTileIndexFromTypeSubIndex</a>( usRoofType, THICK_TOP, &amp;usTileIndex );
<a name="l00394"></a>00394             <a class="code" href="worldman_8cpp.html#9c17e54f8854f79a814dc473877fb094">AddRoofToHead</a>( iMapIndex + 3*WORLD_COLS, usTileIndex );
<a name="l00395"></a>00395             <a class="code" href="tiledef_8cpp.html#88fb4209f479cf8705b24390553f0e16">GetTileIndexFromTypeSubIndex</a>( usRoofType, THICK_BOTTOM, &amp;usTileIndex );
<a name="l00396"></a>00396             <a class="code" href="worldman_8cpp.html#9c17e54f8854f79a814dc473877fb094">AddRoofToHead</a>( iMapIndex + 7*WORLD_COLS, usTileIndex );
<a name="l00397"></a>00397             <span class="keywordflow">for</span>( i = iRight - 1; i &gt; iLeft; i-- )
<a name="l00398"></a>00398             {
<a name="l00399"></a>00399                   iMapIndex--;
<a name="l00400"></a>00400                   <a class="code" href="tiledef_8cpp.html#88fb4209f479cf8705b24390553f0e16">GetTileIndexFromTypeSubIndex</a>( usRoofType, THIN_TOP, &amp;usTileIndex );
<a name="l00401"></a>00401                   <a class="code" href="worldman_8cpp.html#9c17e54f8854f79a814dc473877fb094">AddRoofToHead</a>( iMapIndex + 3*WORLD_COLS, usTileIndex );
<a name="l00402"></a>00402                   <a class="code" href="tiledef_8cpp.html#88fb4209f479cf8705b24390553f0e16">GetTileIndexFromTypeSubIndex</a>( usRoofType, THIN_BOTTOM, &amp;usTileIndex );
<a name="l00403"></a>00403                   <a class="code" href="worldman_8cpp.html#9c17e54f8854f79a814dc473877fb094">AddRoofToHead</a>( iMapIndex + 7*WORLD_COLS, usTileIndex );
<a name="l00404"></a>00404             }
<a name="l00405"></a>00405             iMapIndex--;
<a name="l00406"></a>00406             <a class="code" href="tiledef_8cpp.html#88fb4209f479cf8705b24390553f0e16">GetTileIndexFromTypeSubIndex</a>( usRoofType, THICK_TOP, &amp;usTileIndex );
<a name="l00407"></a>00407             <a class="code" href="worldman_8cpp.html#9c17e54f8854f79a814dc473877fb094">AddRoofToHead</a>( iMapIndex + 3*WORLD_COLS, usTileIndex );
<a name="l00408"></a>00408             <a class="code" href="tiledef_8cpp.html#88fb4209f479cf8705b24390553f0e16">GetTileIndexFromTypeSubIndex</a>( usRoofType, THICK_BOTTOM, &amp;usTileIndex );
<a name="l00409"></a>00409             <a class="code" href="worldman_8cpp.html#9c17e54f8854f79a814dc473877fb094">AddRoofToHead</a>( iMapIndex + 7*WORLD_COLS, usTileIndex );
<a name="l00410"></a>00410       }
<a name="l00411"></a>00411 }
<a name="l00412"></a>00412 
<a name="l00413"></a><a class="code" href="Smoothing_01Utils_8cpp.html#ad6d62a9a21af65c9c96370f6b24e588">00413</a> <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> <a class="code" href="newsmooth_8cpp.html#ad6d62a9a21af65c9c96370f6b24e588">PickAWallPiece</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usWallPieceType )
<a name="l00414"></a>00414 {
<a name="l00415"></a>00415       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usVariants;
<a name="l00416"></a>00416       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usVariantChosen;
<a name="l00417"></a>00417       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usWallPieceChosen = 0;
<a name="l00418"></a>00418       <span class="keywordflow">if</span>( usWallPieceType &gt;= 0 || usWallPieceType &lt; <a class="code" href="Smoothing_01Utils_8h.html#96a58e29e8dbf2b5bdeb775cba46556ee912e81326bf44891ae6daedc0a565ad">NUM_WALL_TYPES</a> )
<a name="l00419"></a>00419       {
<a name="l00420"></a>00420             usVariants = <a class="code" href="newsmooth_8cpp.html#5a036135a2ed2c706e2264d6e49e3b49">gbWallTileLUT</a>[ usWallPieceType ][ 0 ];
<a name="l00421"></a>00421             usVariantChosen = ( rand() % usVariants ) + 1;
<a name="l00422"></a>00422             usWallPieceChosen = <a class="code" href="newsmooth_8cpp.html#5a036135a2ed2c706e2264d6e49e3b49">gbWallTileLUT</a>[ usWallPieceType ][ usVariantChosen ];
<a name="l00423"></a>00423       }
<a name="l00424"></a>00424       <span class="keywordflow">return</span> usWallPieceChosen;
<a name="l00425"></a>00425 }
<a name="l00426"></a>00426 
<a name="l00427"></a>00427 <span class="comment">//From a given gridNo and perspective (wallpiece), it will calculate the new piece, and </span>
<a name="l00428"></a>00428 <span class="comment">//where to place it as well as handle the special cases.</span>
<a name="l00429"></a>00429 <span class="comment">//NOTE:  Placing top and left pieces are placed relative to the gridno, and the gridNo will</span>
<a name="l00430"></a>00430 <span class="comment">// shift accordingly to place the piece.  Pretend you are the floor, and you want to place a piece to</span>
<a name="l00431"></a>00431 <span class="comment">// the left.  You pass your position, and INTERIOR_LEFT, with interior meaning from the inside of a </span>
<a name="l00432"></a>00432 <span class="comment">// building.  If you were outside the building, you would call EXTERIOR_LEFT.  The left tile will be </span>
<a name="l00433"></a>00433 <span class="comment">// placed on gridNo - 1!  Up tiles will be placed on gridNo - 160.</span>
<a name="l00434"></a>00434 <span class="comment">//NOTE:  Passing NULL for usWallType will force it to calculate the closest existing wall type, and</span>
<a name="l00435"></a>00435 <span class="comment">//  use that for building this new wall.  It is necessary for restructuring a building, but not for</span>
<a name="l00436"></a>00436 <span class="comment">//  adding on to an existing building, where the type is already known.</span>
<a name="l00437"></a><a class="code" href="Smoothing_01Utils_8h.html#0787df998fca595b9ce1ec4cb93da260">00437</a> <span class="keywordtype">void</span> <a class="code" href="newsmooth_8cpp.html#0787df998fca595b9ce1ec4cb93da260">BuildWallPiece</a>( <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="editscreen_8cpp.html#48f31659f64cd18c814b1612166c50b5">iMapIndex</a>, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubWallPiece, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usWallType )
<a name="l00438"></a>00438 {
<a name="l00439"></a>00439       <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sIndex;
<a name="l00440"></a>00440       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usTileIndex;
<a name="l00441"></a>00441       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> ubWallClass;
<a name="l00442"></a>00442       <a class="code" href="structTAG__level__node.html">LEVELNODE</a> *pStruct;
<a name="l00443"></a>00443       <span class="keywordflow">if</span>( !usWallType )
<a name="l00444"></a>00444       {
<a name="l00445"></a>00445             usWallType = <a class="code" href="Smoothing_01Utils_8cpp.html#bc21281b2435040c0f95eb938149d7b2">SearchForWallType</a>( iMapIndex );
<a name="l00446"></a>00446       }
<a name="l00447"></a>00447       <span class="keywordflow">switch</span>( ubWallPiece )
<a name="l00448"></a>00448       {
<a name="l00449"></a>00449             <span class="keywordflow">case</span> <a class="code" href="Smoothing_01Utils_8h.html#b48899087cc647f0f791ed0c459adc535e95a48a03fb58ace65e804fb25837d1">EXTERIOR_TOP</a>:
<a name="l00450"></a>00450                   iMapIndex -= WORLD_COLS;
<a name="l00451"></a>00451                   <span class="comment">//exterior bottom left corner generated</span>
<a name="l00452"></a>00452                   <span class="keywordflow">if</span> ( !<a class="code" href="environment_8cpp.html#766b3fc59d0883a3dffe106a75d85de9">gfBasement</a> &amp;&amp; <a class="code" href="Smoothing_01Utils_8cpp.html#b67373a18a820e211a4a7b74c497bc63">GetVerticalWall</a>( iMapIndex - 1) &amp;&amp; !<a class="code" href="Smoothing_01Utils_8cpp.html#b67373a18a820e211a4a7b74c497bc63">GetVerticalWall</a>( iMapIndex + WORLD_COLS - 1) )
<a name="l00453"></a>00453                   {     <span class="comment">//Special case where a shadow has to be created as it now is a bottom corner and</span>
<a name="l00454"></a>00454                         <span class="comment">//must contribute to the bottom shadow.</span>
<a name="l00455"></a>00455                         <a class="code" href="Editor_01Undo_8cpp.html#9b2fd306128d272a5745c07ff45478cc">AddToUndoList</a>( iMapIndex - 1 );
<a name="l00456"></a>00456                         <a class="code" href="tiledef_8cpp.html#88fb4209f479cf8705b24390553f0e16">GetTileIndexFromTypeSubIndex</a>( usWallType, INTERIOR_BOTTOMEND_SHADOW_INDEX, &amp;usTileIndex );
<a name="l00457"></a>00457                         <a class="code" href="worldman_8cpp.html#a151af07d5ff0d1e0bfbd5c3eb88c0e7">AddExclusiveShadow</a>( iMapIndex - 1, usTileIndex );
<a name="l00458"></a>00458                   }
<a name="l00459"></a>00459                   <span class="keywordflow">if</span> ( pStruct = <a class="code" href="Smoothing_01Utils_8cpp.html#b67373a18a820e211a4a7b74c497bc63">GetVerticalWall</a>( iMapIndex ) ) <span class="comment">//right corner</span>
<a name="l00460"></a>00460                   {     <span class="comment">//Special case where placing the new wall will generate a corner to the right, so replace </span>
<a name="l00461"></a>00461                         <span class="comment">//the vertical piece with a bottomend.</span>
<a name="l00462"></a>00462                         sIndex = <a class="code" href="newsmooth_8cpp.html#ad6d62a9a21af65c9c96370f6b24e588">PickAWallPiece</a>( <a class="code" href="Smoothing_01Utils_8h.html#96a58e29e8dbf2b5bdeb775cba46556e4eed523ef085f2fcc070ea55c85a9adb">EXTERIOR_BOTTOMEND</a> );
<a name="l00463"></a>00463                         <a class="code" href="Editor_01Undo_8cpp.html#9b2fd306128d272a5745c07ff45478cc">AddToUndoList</a>( iMapIndex );
<a name="l00464"></a>00464                         <a class="code" href="tiledef_8cpp.html#88fb4209f479cf8705b24390553f0e16">GetTileIndexFromTypeSubIndex</a>( usWallType, sIndex, &amp;usTileIndex );
<a name="l00465"></a>00465                         <a class="code" href="worldman_8cpp.html#d4e83690f6fa6b38031d54c7482addb3">ReplaceStructIndex</a>( iMapIndex, pStruct-&gt;<a class="code" href="structTAG__level__node.html#52b821707a4f7d758df5f97d376ef9f7">usIndex</a>, usTileIndex );
<a name="l00466"></a>00466                   }
<a name="l00467"></a>00467                   ubWallClass = <a class="code" href="Smoothing_01Utils_8h.html#96a58e29e8dbf2b5bdeb775cba46556ee5e34cf9ca7f0a2472feeab6e1357473">EXTERIOR_L</a>;
<a name="l00468"></a>00468                   <span class="keywordflow">if</span>( !<a class="code" href="environment_8cpp.html#766b3fc59d0883a3dffe106a75d85de9">gfBasement</a> )
<a name="l00469"></a>00469                   {
<a name="l00470"></a>00470                         <span class="comment">//All exterior_l walls have shadows.</span>
<a name="l00471"></a>00471                         <a class="code" href="tiledef_8cpp.html#88fb4209f479cf8705b24390553f0e16">GetTileIndexFromTypeSubIndex</a>( usWallType, EXTERIOR_L_SHADOW_INDEX, &amp;usTileIndex );
<a name="l00472"></a>00472                         <a class="code" href="worldman_8cpp.html#a151af07d5ff0d1e0bfbd5c3eb88c0e7">AddExclusiveShadow</a>( iMapIndex, usTileIndex );
<a name="l00473"></a>00473                   }
<a name="l00474"></a>00474                   <span class="keywordflow">break</span>;
<a name="l00475"></a>00475             <span class="keywordflow">case</span> <a class="code" href="Smoothing_01Utils_8h.html#b48899087cc647f0f791ed0c459adc539296889f1e97c7af8b8c3fcf1671900e">EXTERIOR_BOTTOM</a>:
<a name="l00476"></a>00476                   ubWallClass = <a class="code" href="Smoothing_01Utils_8h.html#96a58e29e8dbf2b5bdeb775cba46556e240baf37a8d9efe7ed9852e61f193998">INTERIOR_L</a>;
<a name="l00477"></a>00477                   <span class="keywordflow">if</span>( (pStruct = <a class="code" href="Smoothing_01Utils_8cpp.html#b67373a18a820e211a4a7b74c497bc63">GetVerticalWall</a>( iMapIndex + WORLD_COLS - 1 )) &amp;&amp; !<a class="code" href="Smoothing_01Utils_8cpp.html#b67373a18a820e211a4a7b74c497bc63">GetVerticalWall</a>( iMapIndex - 1) )
<a name="l00478"></a>00478                   {
<a name="l00479"></a>00479                         sIndex = <a class="code" href="newsmooth_8cpp.html#ad6d62a9a21af65c9c96370f6b24e588">PickAWallPiece</a>( <a class="code" href="Smoothing_01Utils_8h.html#96a58e29e8dbf2b5bdeb775cba46556e289a2269043419cb8640cee3a6870ace">INTERIOR_EXTENDED</a> );
<a name="l00480"></a>00480                         <a class="code" href="Editor_01Undo_8cpp.html#9b2fd306128d272a5745c07ff45478cc">AddToUndoList</a>( iMapIndex + WORLD_COLS - 1 );
<a name="l00481"></a>00481                         <a class="code" href="tiledef_8cpp.html#88fb4209f479cf8705b24390553f0e16">GetTileIndexFromTypeSubIndex</a>( usWallType, sIndex, &amp;usTileIndex );
<a name="l00482"></a>00482                         <a class="code" href="worldman_8cpp.html#d4e83690f6fa6b38031d54c7482addb3">ReplaceStructIndex</a>( iMapIndex + WORLD_COLS - 1, pStruct-&gt;<a class="code" href="structTAG__level__node.html#52b821707a4f7d758df5f97d376ef9f7">usIndex</a>, usTileIndex );
<a name="l00483"></a>00483                   }
<a name="l00484"></a>00484                   <span class="keywordflow">break</span>;
<a name="l00485"></a>00485             <span class="keywordflow">case</span> <a class="code" href="Smoothing_01Utils_8h.html#b48899087cc647f0f791ed0c459adc53c3d99e261299fb199adfcbc77ab02ca8">EXTERIOR_LEFT</a>:
<a name="l00486"></a>00486                   iMapIndex--;
<a name="l00487"></a>00487                   ubWallClass = <a class="code" href="Smoothing_01Utils_8h.html#96a58e29e8dbf2b5bdeb775cba46556e7bf0c0dd4da48ac374022b0f6a6639ec">EXTERIOR_R</a>;
<a name="l00488"></a>00488                   <span class="keywordflow">if</span>( <a class="code" href="Smoothing_01Utils_8cpp.html#5d6ebbdb7c42ccf67514e2c8182508ac">GetHorizontalWall</a>( iMapIndex ) )
<a name="l00489"></a>00489                   {     <span class="comment">//Special case where placing the new wall will generate a corner.  This piece</span>
<a name="l00490"></a>00490                         <span class="comment">//becomes an exterior bottomend, but nothing else is effected.</span>
<a name="l00491"></a>00491                         ubWallClass = <a class="code" href="Smoothing_01Utils_8h.html#96a58e29e8dbf2b5bdeb775cba46556e4eed523ef085f2fcc070ea55c85a9adb">EXTERIOR_BOTTOMEND</a>;
<a name="l00492"></a>00492                   }
<a name="l00493"></a>00493                   <span class="keywordflow">if</span>( <a class="code" href="Smoothing_01Utils_8cpp.html#5d6ebbdb7c42ccf67514e2c8182508ac">GetHorizontalWall</a>( iMapIndex - WORLD_COLS + 1 ) )
<a name="l00494"></a>00494                   {
<a name="l00495"></a>00495                         <span class="keywordflow">if</span>( ubWallClass == <a class="code" href="Smoothing_01Utils_8h.html#96a58e29e8dbf2b5bdeb775cba46556e4eed523ef085f2fcc070ea55c85a9adb">EXTERIOR_BOTTOMEND</a> )
<a name="l00496"></a>00496                               ubWallClass = <a class="code" href="Smoothing_01Utils_8h.html#96a58e29e8dbf2b5bdeb775cba46556e17852f29b9a85b595e0eeb012708b93b">EXTERIOR_EXTENDED_BOTTOMEND</a>;
<a name="l00497"></a>00497                         <span class="keywordflow">else</span>
<a name="l00498"></a>00498                               ubWallClass = <a class="code" href="Smoothing_01Utils_8h.html#96a58e29e8dbf2b5bdeb775cba46556e84812e7fa2b970849a6490138059ed8c">EXTERIOR_EXTENDED</a>;
<a name="l00499"></a>00499                   }
<a name="l00500"></a>00500                   <span class="keywordflow">break</span>;
<a name="l00501"></a>00501             <span class="keywordflow">case</span> <a class="code" href="Smoothing_01Utils_8h.html#b48899087cc647f0f791ed0c459adc53b1a2d07db8acf3d4c47609b4f36ba337">EXTERIOR_RIGHT</a>:
<a name="l00502"></a>00502                   ubWallClass = <a class="code" href="Smoothing_01Utils_8h.html#96a58e29e8dbf2b5bdeb775cba46556eafa6b8e348f026638cdb3ded4f75da85">INTERIOR_R</a>;
<a name="l00503"></a>00503                   <span class="keywordflow">if</span>( <a class="code" href="Smoothing_01Utils_8cpp.html#5d6ebbdb7c42ccf67514e2c8182508ac">GetHorizontalWall</a>( iMapIndex - WORLD_COLS + 1 ) &amp;&amp; !<a class="code" href="Smoothing_01Utils_8cpp.html#5d6ebbdb7c42ccf67514e2c8182508ac">GetHorizontalWall</a>( iMapIndex - WORLD_COLS ) )
<a name="l00504"></a>00504                   {
<a name="l00505"></a>00505                         ubWallClass = <a class="code" href="Smoothing_01Utils_8h.html#96a58e29e8dbf2b5bdeb775cba46556e289a2269043419cb8640cee3a6870ace">INTERIOR_EXTENDED</a>;
<a name="l00506"></a>00506                   }
<a name="l00507"></a>00507                   <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="Smoothing_01Utils_8cpp.html#5d6ebbdb7c42ccf67514e2c8182508ac">GetHorizontalWall</a>( iMapIndex ) &amp;&amp; !<a class="code" href="Smoothing_01Utils_8cpp.html#b67373a18a820e211a4a7b74c497bc63">GetVerticalWall</a>( iMapIndex + WORLD_COLS ) )
<a name="l00508"></a>00508                   {
<a name="l00509"></a>00509                         ubWallClass = <a class="code" href="Smoothing_01Utils_8h.html#96a58e29e8dbf2b5bdeb775cba46556e58cbfe15979817b782dae96735f45f87">INTERIOR_BOTTOMEND</a>;
<a name="l00510"></a>00510                   }
<a name="l00511"></a>00511                   <span class="keywordflow">break</span>;
<a name="l00512"></a>00512             <span class="keywordflow">case</span> <a class="code" href="Smoothing_01Utils_8h.html#b48899087cc647f0f791ed0c459adc53331f938556c6a2a6f1e8a7766e9c31b9">INTERIOR_TOP</a>:
<a name="l00513"></a>00513                   iMapIndex -= WORLD_COLS;
<a name="l00514"></a>00514                   ubWallClass = <a class="code" href="Smoothing_01Utils_8h.html#96a58e29e8dbf2b5bdeb775cba46556e240baf37a8d9efe7ed9852e61f193998">INTERIOR_L</a>;
<a name="l00515"></a>00515                   <span class="comment">//check for a lower left corner.</span>
<a name="l00516"></a>00516                   <span class="keywordflow">if</span>( pStruct = <a class="code" href="Smoothing_01Utils_8cpp.html#b67373a18a820e211a4a7b74c497bc63">GetVerticalWall</a>( iMapIndex + WORLD_COLS - 1 ) )
<a name="l00517"></a>00517                   {     <span class="comment">//Replace the piece with an extended piece.</span>
<a name="l00518"></a>00518                         sIndex = <a class="code" href="newsmooth_8cpp.html#ad6d62a9a21af65c9c96370f6b24e588">PickAWallPiece</a>( <a class="code" href="Smoothing_01Utils_8h.html#96a58e29e8dbf2b5bdeb775cba46556e289a2269043419cb8640cee3a6870ace">INTERIOR_EXTENDED</a> );
<a name="l00519"></a>00519                         <a class="code" href="Editor_01Undo_8cpp.html#9b2fd306128d272a5745c07ff45478cc">AddToUndoList</a>( iMapIndex + WORLD_COLS - 1 );
<a name="l00520"></a>00520                         <a class="code" href="tiledef_8cpp.html#88fb4209f479cf8705b24390553f0e16">GetTileIndexFromTypeSubIndex</a>( usWallType, sIndex, &amp;usTileIndex );
<a name="l00521"></a>00521                         <a class="code" href="worldman_8cpp.html#d4e83690f6fa6b38031d54c7482addb3">ReplaceStructIndex</a>( iMapIndex + WORLD_COLS - 1, pStruct-&gt;<a class="code" href="structTAG__level__node.html#52b821707a4f7d758df5f97d376ef9f7">usIndex</a>, usTileIndex );
<a name="l00522"></a>00522                         <span class="comment">//NOTE:  Not yet checking for interior extended bottomend!</span>
<a name="l00523"></a>00523                   }
<a name="l00524"></a>00524                   <span class="keywordflow">if</span>( pStruct = <a class="code" href="Smoothing_01Utils_8cpp.html#b67373a18a820e211a4a7b74c497bc63">GetVerticalWall</a>( iMapIndex ) )
<a name="l00525"></a>00525                   {
<a name="l00526"></a>00526                         sIndex = <a class="code" href="newsmooth_8cpp.html#ad6d62a9a21af65c9c96370f6b24e588">PickAWallPiece</a>( <a class="code" href="Smoothing_01Utils_8h.html#96a58e29e8dbf2b5bdeb775cba46556e58cbfe15979817b782dae96735f45f87">INTERIOR_BOTTOMEND</a> );
<a name="l00527"></a>00527                         <a class="code" href="Editor_01Undo_8cpp.html#9b2fd306128d272a5745c07ff45478cc">AddToUndoList</a>( iMapIndex );
<a name="l00528"></a>00528                         <a class="code" href="tiledef_8cpp.html#88fb4209f479cf8705b24390553f0e16">GetTileIndexFromTypeSubIndex</a>( usWallType, sIndex, &amp;usTileIndex );
<a name="l00529"></a>00529                         <a class="code" href="worldman_8cpp.html#d4e83690f6fa6b38031d54c7482addb3">ReplaceStructIndex</a>( iMapIndex, pStruct-&gt;<a class="code" href="structTAG__level__node.html#52b821707a4f7d758df5f97d376ef9f7">usIndex</a>, usTileIndex );
<a name="l00530"></a>00530                   }
<a name="l00531"></a>00531                   <span class="keywordflow">break</span>;
<a name="l00532"></a>00532             <span class="keywordflow">case</span> <a class="code" href="Smoothing_01Utils_8h.html#b48899087cc647f0f791ed0c459adc53e3f96fba94c5917b02d294414f085842">INTERIOR_BOTTOM</a>:
<a name="l00533"></a>00533                   ubWallClass = <a class="code" href="Smoothing_01Utils_8h.html#96a58e29e8dbf2b5bdeb775cba46556ee5e34cf9ca7f0a2472feeab6e1357473">EXTERIOR_L</a>;
<a name="l00534"></a>00534                   <span class="keywordflow">if</span>( pStruct = <a class="code" href="Smoothing_01Utils_8cpp.html#b67373a18a820e211a4a7b74c497bc63">GetVerticalWall</a>( iMapIndex ) ) <span class="comment">//right corner</span>
<a name="l00535"></a>00535                   {     <span class="comment">//Special case where placing the new wall will generate a corner to the right, so replace </span>
<a name="l00536"></a>00536                         <span class="comment">//the vertical piece with a bottomend.</span>
<a name="l00537"></a>00537                         sIndex = <a class="code" href="newsmooth_8cpp.html#ad6d62a9a21af65c9c96370f6b24e588">PickAWallPiece</a>( <a class="code" href="Smoothing_01Utils_8h.html#96a58e29e8dbf2b5bdeb775cba46556e4eed523ef085f2fcc070ea55c85a9adb">EXTERIOR_BOTTOMEND</a> );
<a name="l00538"></a>00538                         <a class="code" href="Editor_01Undo_8cpp.html#9b2fd306128d272a5745c07ff45478cc">AddToUndoList</a>( iMapIndex );
<a name="l00539"></a>00539                         <a class="code" href="tiledef_8cpp.html#88fb4209f479cf8705b24390553f0e16">GetTileIndexFromTypeSubIndex</a>( usWallType, sIndex, &amp;usTileIndex );
<a name="l00540"></a>00540                         <a class="code" href="worldman_8cpp.html#d4e83690f6fa6b38031d54c7482addb3">ReplaceStructIndex</a>( iMapIndex, pStruct-&gt;<a class="code" href="structTAG__level__node.html#52b821707a4f7d758df5f97d376ef9f7">usIndex</a>, usTileIndex );
<a name="l00541"></a>00541                   }
<a name="l00542"></a>00542                   <span class="keywordflow">if</span>( (pStruct = <a class="code" href="Smoothing_01Utils_8cpp.html#b67373a18a820e211a4a7b74c497bc63">GetVerticalWall</a>( iMapIndex + WORLD_COLS - 1 )) &amp;&amp; !<a class="code" href="Smoothing_01Utils_8cpp.html#b67373a18a820e211a4a7b74c497bc63">GetVerticalWall</a>( iMapIndex - 1) )
<a name="l00543"></a>00543                   {
<a name="l00544"></a>00544                         sIndex = <a class="code" href="newsmooth_8cpp.html#ad6d62a9a21af65c9c96370f6b24e588">PickAWallPiece</a>( <a class="code" href="Smoothing_01Utils_8h.html#96a58e29e8dbf2b5bdeb775cba46556e84812e7fa2b970849a6490138059ed8c">EXTERIOR_EXTENDED</a> );
<a name="l00545"></a>00545                         <a class="code" href="Editor_01Undo_8cpp.html#9b2fd306128d272a5745c07ff45478cc">AddToUndoList</a>( iMapIndex + WORLD_COLS - 1 );
<a name="l00546"></a>00546                         <a class="code" href="tiledef_8cpp.html#88fb4209f479cf8705b24390553f0e16">GetTileIndexFromTypeSubIndex</a>( usWallType, sIndex, &amp;usTileIndex );
<a name="l00547"></a>00547                         <a class="code" href="worldman_8cpp.html#d4e83690f6fa6b38031d54c7482addb3">ReplaceStructIndex</a>( iMapIndex + WORLD_COLS - 1, pStruct-&gt;<a class="code" href="structTAG__level__node.html#52b821707a4f7d758df5f97d376ef9f7">usIndex</a>, usTileIndex );
<a name="l00548"></a>00548                   }
<a name="l00549"></a>00549                   <span class="keywordflow">if</span>( !<a class="code" href="environment_8cpp.html#766b3fc59d0883a3dffe106a75d85de9">gfBasement</a> )
<a name="l00550"></a>00550                   {
<a name="l00551"></a>00551                         <span class="comment">//All exterior_l walls have shadows.</span>
<a name="l00552"></a>00552                         <a class="code" href="tiledef_8cpp.html#88fb4209f479cf8705b24390553f0e16">GetTileIndexFromTypeSubIndex</a>( usWallType, EXTERIOR_L_SHADOW_INDEX, &amp;usTileIndex );
<a name="l00553"></a>00553                         <a class="code" href="worldman_8cpp.html#a151af07d5ff0d1e0bfbd5c3eb88c0e7">AddExclusiveShadow</a>( iMapIndex, usTileIndex );
<a name="l00554"></a>00554                   }
<a name="l00555"></a>00555                   <span class="keywordflow">break</span>;
<a name="l00556"></a>00556             <span class="keywordflow">case</span> <a class="code" href="Smoothing_01Utils_8h.html#b48899087cc647f0f791ed0c459adc5376f4595378482c64a3aaef23e6ea2ee5">INTERIOR_LEFT</a>:
<a name="l00557"></a>00557                   iMapIndex--;
<a name="l00558"></a>00558                   ubWallClass = <a class="code" href="Smoothing_01Utils_8h.html#96a58e29e8dbf2b5bdeb775cba46556eafa6b8e348f026638cdb3ded4f75da85">INTERIOR_R</a>;
<a name="l00559"></a>00559                   <span class="keywordflow">if</span>( <a class="code" href="Smoothing_01Utils_8cpp.html#5d6ebbdb7c42ccf67514e2c8182508ac">GetHorizontalWall</a>( iMapIndex ) )
<a name="l00560"></a>00560                   {
<a name="l00561"></a>00561                         ubWallClass = <a class="code" href="Smoothing_01Utils_8h.html#96a58e29e8dbf2b5bdeb775cba46556e58cbfe15979817b782dae96735f45f87">INTERIOR_BOTTOMEND</a>;
<a name="l00562"></a>00562                   }
<a name="l00563"></a>00563                   <span class="keywordflow">if</span>( !<a class="code" href="environment_8cpp.html#766b3fc59d0883a3dffe106a75d85de9">gfBasement</a> &amp;&amp; <a class="code" href="Smoothing_01Utils_8cpp.html#5d6ebbdb7c42ccf67514e2c8182508ac">GetHorizontalWall</a>( iMapIndex + 1 ) )
<a name="l00564"></a>00564                   {
<a name="l00565"></a>00565                         <a class="code" href="Editor_01Undo_8cpp.html#9b2fd306128d272a5745c07ff45478cc">AddToUndoList</a>( iMapIndex );
<a name="l00566"></a>00566                         <a class="code" href="tiledef_8cpp.html#88fb4209f479cf8705b24390553f0e16">GetTileIndexFromTypeSubIndex</a>( usWallType, INTERIOR_BOTTOMEND_SHADOW_INDEX, &amp;usTileIndex );
<a name="l00567"></a>00567                         <a class="code" href="worldman_8cpp.html#a151af07d5ff0d1e0bfbd5c3eb88c0e7">AddExclusiveShadow</a>( iMapIndex, usTileIndex );
<a name="l00568"></a>00568                   }
<a name="l00569"></a>00569                   <span class="keywordflow">if</span>( <a class="code" href="Smoothing_01Utils_8cpp.html#5d6ebbdb7c42ccf67514e2c8182508ac">GetHorizontalWall</a>( iMapIndex - WORLD_COLS + 1 ) )
<a name="l00570"></a>00570                   {
<a name="l00571"></a>00571                         <span class="keywordflow">if</span>( ubWallClass == <a class="code" href="Smoothing_01Utils_8h.html#96a58e29e8dbf2b5bdeb775cba46556e58cbfe15979817b782dae96735f45f87">INTERIOR_BOTTOMEND</a> )
<a name="l00572"></a>00572                               ubWallClass = <a class="code" href="Smoothing_01Utils_8h.html#96a58e29e8dbf2b5bdeb775cba46556ec2635f08d01259cf59337a11b1af07be">INTERIOR_EXTENDED_BOTTOMEND</a>;
<a name="l00573"></a>00573                         <span class="keywordflow">else</span>
<a name="l00574"></a>00574                               ubWallClass = <a class="code" href="Smoothing_01Utils_8h.html#96a58e29e8dbf2b5bdeb775cba46556e289a2269043419cb8640cee3a6870ace">INTERIOR_EXTENDED</a>;
<a name="l00575"></a>00575                   }
<a name="l00576"></a>00576                   <span class="keywordflow">break</span>;
<a name="l00577"></a>00577             <span class="keywordflow">case</span> <a class="code" href="Smoothing_01Utils_8h.html#b48899087cc647f0f791ed0c459adc53f16f1be3af82db6056b6e11253cac21c">INTERIOR_RIGHT</a>:
<a name="l00578"></a>00578                   ubWallClass = <a class="code" href="Smoothing_01Utils_8h.html#96a58e29e8dbf2b5bdeb775cba46556e7bf0c0dd4da48ac374022b0f6a6639ec">EXTERIOR_R</a>;
<a name="l00579"></a>00579                   <span class="keywordflow">if</span>( <a class="code" href="Smoothing_01Utils_8cpp.html#5d6ebbdb7c42ccf67514e2c8182508ac">GetHorizontalWall</a>( iMapIndex ) )
<a name="l00580"></a>00580                   {     <span class="comment">//Special case where placing the new wall will generate a corner.  This piece</span>
<a name="l00581"></a>00581                         <span class="comment">//becomes an exterior bottomend, but nothing else is effected.</span>
<a name="l00582"></a>00582                         ubWallClass = <a class="code" href="Smoothing_01Utils_8h.html#96a58e29e8dbf2b5bdeb775cba46556e4eed523ef085f2fcc070ea55c85a9adb">EXTERIOR_BOTTOMEND</a>;
<a name="l00583"></a>00583                   }
<a name="l00584"></a>00584                   <span class="keywordflow">if</span>( <a class="code" href="Smoothing_01Utils_8cpp.html#5d6ebbdb7c42ccf67514e2c8182508ac">GetHorizontalWall</a>( iMapIndex - WORLD_COLS + 1 ) )
<a name="l00585"></a>00585                   {
<a name="l00586"></a>00586                         <span class="keywordflow">if</span>( ubWallClass == <a class="code" href="Smoothing_01Utils_8h.html#96a58e29e8dbf2b5bdeb775cba46556e4eed523ef085f2fcc070ea55c85a9adb">EXTERIOR_BOTTOMEND</a> )
<a name="l00587"></a>00587                               ubWallClass = <a class="code" href="Smoothing_01Utils_8h.html#96a58e29e8dbf2b5bdeb775cba46556e17852f29b9a85b595e0eeb012708b93b">EXTERIOR_EXTENDED_BOTTOMEND</a>;
<a name="l00588"></a>00588                         <span class="keywordflow">else</span>
<a name="l00589"></a>00589                               ubWallClass = <a class="code" href="Smoothing_01Utils_8h.html#96a58e29e8dbf2b5bdeb775cba46556e84812e7fa2b970849a6490138059ed8c">EXTERIOR_EXTENDED</a>;
<a name="l00590"></a>00590                   }
<a name="l00591"></a>00591                   <span class="keywordflow">if</span>( !<a class="code" href="environment_8cpp.html#766b3fc59d0883a3dffe106a75d85de9">gfBasement</a> &amp;&amp; <a class="code" href="Smoothing_01Utils_8cpp.html#5d6ebbdb7c42ccf67514e2c8182508ac">GetHorizontalWall</a>( iMapIndex + 1 ) &amp;&amp; !<a class="code" href="Smoothing_01Utils_8cpp.html#5d6ebbdb7c42ccf67514e2c8182508ac">GetHorizontalWall</a>( iMapIndex ) 
<a name="l00592"></a>00592                           &amp;&amp; !<a class="code" href="worlddef_8cpp.html#2b0bbb0a711487d90a4cbc59eb3135e9">FloorAtGridNo</a>( iMapIndex + WORLD_COLS ) )
<a name="l00593"></a>00593                   {
<a name="l00594"></a>00594                         <a class="code" href="tiledef_8cpp.html#88fb4209f479cf8705b24390553f0e16">GetTileIndexFromTypeSubIndex</a>( usWallType, INTERIOR_BOTTOMEND_SHADOW_INDEX, &amp;usTileIndex );
<a name="l00595"></a>00595                         <a class="code" href="worldman_8cpp.html#a151af07d5ff0d1e0bfbd5c3eb88c0e7">AddExclusiveShadow</a>( iMapIndex, usTileIndex );
<a name="l00596"></a>00596                   }
<a name="l00597"></a>00597                   <span class="keywordflow">break</span>;
<a name="l00598"></a>00598       }
<a name="l00599"></a>00599       sIndex = <a class="code" href="newsmooth_8cpp.html#ad6d62a9a21af65c9c96370f6b24e588">PickAWallPiece</a>( ubWallClass );
<a name="l00600"></a>00600       <a class="code" href="tiledef_8cpp.html#88fb4209f479cf8705b24390553f0e16">GetTileIndexFromTypeSubIndex</a>( usWallType, sIndex, &amp;usTileIndex );
<a name="l00601"></a>00601       <a class="code" href="Editor_01Undo_8cpp.html#9b2fd306128d272a5745c07ff45478cc">AddToUndoList</a>( iMapIndex );
<a name="l00602"></a>00602       <a class="code" href="worldman_8cpp.html#9253fa7589780a7dfc3feee0cd812eb2">AddWallToStructLayer</a>( iMapIndex, usTileIndex, FALSE );
<a name="l00603"></a>00603 }
<a name="l00604"></a>00604 
<a name="l00605"></a><a class="code" href="newsmooth_8h.html#3ffd319dcd6e81938debd4bc06eacd6a">00605</a> <span class="keywordtype">void</span> <a class="code" href="newsmooth_8cpp.html#3ffd319dcd6e81938debd4bc06eacd6a">RebuildRoofUsingFloorInfo</a>( <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> <a class="code" href="editscreen_8cpp.html#48f31659f64cd18c814b1612166c50b5">iMapIndex</a>, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usRoofType )
<a name="l00606"></a>00606 {
<a name="l00607"></a>00607       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usRoofIndex, usTileIndex;
<a name="l00608"></a>00608       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fTop = FALSE, fBottom = FALSE, fLeft = FALSE, fRight = FALSE;
<a name="l00609"></a>00609       <span class="keywordflow">if</span>( !usRoofType )
<a name="l00610"></a>00610       {
<a name="l00611"></a>00611             usRoofType = <a class="code" href="Smoothing_01Utils_8cpp.html#bdd2c37907cce9eef5d0759497939f18">SearchForRoofType</a>( iMapIndex );
<a name="l00612"></a>00612       }
<a name="l00613"></a>00613       <span class="keywordflow">if</span>( usRoofType == 0xffff )
<a name="l00614"></a>00614             <span class="keywordflow">return</span>;  <span class="comment">//no roof type around, so don't draw one.</span>
<a name="l00615"></a>00615       <span class="comment">//Analyse the mapindex for walls and set the flags.</span>
<a name="l00616"></a>00616       <span class="comment">//NOTE:  There is no support for more than 2 side on a roof, so if there is, draw TOPLEFT</span>
<a name="l00617"></a>00617       <a class="code" href="Editor_01Undo_8cpp.html#9b2fd306128d272a5745c07ff45478cc">AddToUndoList</a>( iMapIndex );
<a name="l00618"></a>00618       <a class="code" href="newsmooth_8cpp.html#7323c011de10e4227ba2bb0eb61decb2">EraseRoof</a>( iMapIndex );
<a name="l00619"></a>00619 
<a name="l00620"></a>00620       fTop = <a class="code" href="worlddef_8cpp.html#2b0bbb0a711487d90a4cbc59eb3135e9">FloorAtGridNo</a>( iMapIndex - WORLD_COLS ) ? FALSE : TRUE;
<a name="l00621"></a>00621       fLeft = <a class="code" href="worlddef_8cpp.html#2b0bbb0a711487d90a4cbc59eb3135e9">FloorAtGridNo</a>( iMapIndex - 1 ) ? FALSE : TRUE;
<a name="l00622"></a>00622       fBottom = <a class="code" href="worlddef_8cpp.html#2b0bbb0a711487d90a4cbc59eb3135e9">FloorAtGridNo</a>( iMapIndex + WORLD_COLS ) ? FALSE : TRUE;
<a name="l00623"></a>00623       fRight = <a class="code" href="worlddef_8cpp.html#2b0bbb0a711487d90a4cbc59eb3135e9">FloorAtGridNo</a>( iMapIndex + 1 ) ? FALSE : TRUE;
<a name="l00624"></a>00624       <span class="keywordflow">if</span>( fTop &amp;&amp; fLeft )                                   usRoofIndex = TOPLEFT_ROOF_INDEX;
<a name="l00625"></a>00625       <span class="keywordflow">else</span> <span class="keywordflow">if</span>( fTop &amp;&amp; fRight)                  usRoofIndex = TOPRIGHT_ROOF_INDEX;
<a name="l00626"></a>00626       <span class="keywordflow">else</span> <span class="keywordflow">if</span>( fBottom &amp;&amp; fLeft )         usRoofIndex = BOTTOMLEFT_ROOF_INDEX;
<a name="l00627"></a>00627       <span class="keywordflow">else</span> <span class="keywordflow">if</span>( fBottom &amp;&amp; fRight )  usRoofIndex = BOTTOMRIGHT_ROOF_INDEX;
<a name="l00628"></a>00628       <span class="keywordflow">else</span> <span class="keywordflow">if</span>( fTop )                                             usRoofIndex = TOP_ROOF_INDEX;
<a name="l00629"></a>00629       <span class="keywordflow">else</span> <span class="keywordflow">if</span>( fBottom )                                    usRoofIndex = BOTTOM_ROOF_INDEX;
<a name="l00630"></a>00630       <span class="keywordflow">else</span> <span class="keywordflow">if</span>( fLeft )                                      usRoofIndex = LEFT_ROOF_INDEX;
<a name="l00631"></a>00631       <span class="keywordflow">else</span> <span class="keywordflow">if</span>( fRight )                                     usRoofIndex = RIGHT_ROOF_INDEX;
<a name="l00632"></a>00632       <span class="keywordflow">else</span>                                                                          usRoofIndex = CENTER_ROOF_BASE_INDEX + ( rand() % CENTER_ROOF_VARIANTS );
<a name="l00633"></a>00633       <a class="code" href="tiledef_8cpp.html#88fb4209f479cf8705b24390553f0e16">GetTileIndexFromTypeSubIndex</a>( usRoofType, usRoofIndex, &amp;usTileIndex );
<a name="l00634"></a>00634       <a class="code" href="worldman_8cpp.html#9c17e54f8854f79a814dc473877fb094">AddRoofToHead</a>( iMapIndex, usTileIndex );
<a name="l00635"></a>00635       <span class="comment">//if the editor view roofs is off, then the new roofs need to be hidden.</span>
<a name="l00636"></a>00636       <span class="keywordflow">if</span>( !<a class="code" href="EditorBuildings_8cpp.html#4e46a616ed46b32dd35c6e2d5df4baa1">fBuildingShowRoofs</a> )
<a name="l00637"></a>00637       {
<a name="l00638"></a>00638             <a class="code" href="worldman_8cpp.html#ed5137e0ff7396e95504a4c72c9b45f2">HideStructOfGivenType</a>( iMapIndex, usRoofType, TRUE );
<a name="l00639"></a>00639       }
<a name="l00640"></a>00640 }
<a name="l00641"></a>00641 
<a name="l00642"></a>00642 <span class="comment">//Given a gridno, it will erase the current roof, and calculate the new roof piece based on the</span>
<a name="l00643"></a>00643 <span class="comment">//wall orientions giving priority to the top and left walls before anything else.</span>
<a name="l00644"></a>00644 <span class="comment">//NOTE:  passing NULL for usRoofType will force the function to calculate the nearest roof type,</span>
<a name="l00645"></a>00645 <span class="comment">//  and use that for the new roof.  This is needed when erasing parts of multiple buildings simultaneously.</span>
<a name="l00646"></a><a class="code" href="newsmooth_8h.html#9a728ec9c5cac6997770f83001ecf5f9">00646</a> <span class="keywordtype">void</span> <a class="code" href="newsmooth_8cpp.html#9a728ec9c5cac6997770f83001ecf5f9">RebuildRoof</a>( <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="editscreen_8cpp.html#48f31659f64cd18c814b1612166c50b5">iMapIndex</a>, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usRoofType )
<a name="l00647"></a>00647 {
<a name="l00648"></a>00648       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usRoofIndex, usTileIndex;
<a name="l00649"></a>00649       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fTop, fBottom, fLeft, fRight;
<a name="l00650"></a>00650       <span class="keywordflow">if</span>( !usRoofType )
<a name="l00651"></a>00651       {
<a name="l00652"></a>00652             usRoofType = <a class="code" href="Smoothing_01Utils_8cpp.html#bdd2c37907cce9eef5d0759497939f18">SearchForRoofType</a>( iMapIndex );
<a name="l00653"></a>00653       }
<a name="l00654"></a>00654       <span class="keywordflow">if</span>( usRoofType == 0xffff )
<a name="l00655"></a>00655             <span class="keywordflow">return</span>;  <span class="comment">//no roof type around, so don't draw one.</span>
<a name="l00656"></a>00656       <span class="comment">//Analyse the mapindex for walls and set the flags.</span>
<a name="l00657"></a>00657       <span class="comment">//NOTE:  There is no support for more than 2 side on a roof, so if there is, draw TOPLEFT</span>
<a name="l00658"></a>00658       <a class="code" href="Editor_01Undo_8cpp.html#9b2fd306128d272a5745c07ff45478cc">AddToUndoList</a>( iMapIndex );
<a name="l00659"></a>00659       <a class="code" href="newsmooth_8cpp.html#7323c011de10e4227ba2bb0eb61decb2">EraseRoof</a>( iMapIndex );
<a name="l00660"></a>00660 
<a name="l00661"></a>00661       fTop = <a class="code" href="Smoothing_01Utils_8cpp.html#5d6ebbdb7c42ccf67514e2c8182508ac">GetHorizontalWall</a>( iMapIndex - WORLD_COLS ) ? TRUE : FALSE;
<a name="l00662"></a>00662       fLeft = <a class="code" href="Smoothing_01Utils_8cpp.html#b67373a18a820e211a4a7b74c497bc63">GetVerticalWall</a>( iMapIndex - 1 ) ? TRUE : FALSE;
<a name="l00663"></a>00663       fBottom = <a class="code" href="Smoothing_01Utils_8cpp.html#5d6ebbdb7c42ccf67514e2c8182508ac">GetHorizontalWall</a>( iMapIndex ) ? TRUE : FALSE;
<a name="l00664"></a>00664       fRight = <a class="code" href="Smoothing_01Utils_8cpp.html#b67373a18a820e211a4a7b74c497bc63">GetVerticalWall</a>( iMapIndex ) ? TRUE : FALSE;
<a name="l00665"></a>00665       <span class="keywordflow">if</span>( fTop &amp;&amp; fLeft )                                   usRoofIndex = TOPLEFT_ROOF_INDEX;
<a name="l00666"></a>00666       <span class="keywordflow">else</span> <span class="keywordflow">if</span>( fTop &amp;&amp; fRight)                  usRoofIndex = TOPRIGHT_ROOF_INDEX;
<a name="l00667"></a>00667       <span class="keywordflow">else</span> <span class="keywordflow">if</span>( fBottom &amp;&amp; fLeft )         usRoofIndex = BOTTOMLEFT_ROOF_INDEX;
<a name="l00668"></a>00668       <span class="keywordflow">else</span> <span class="keywordflow">if</span>( fBottom &amp;&amp; fRight )  usRoofIndex = BOTTOMRIGHT_ROOF_INDEX;
<a name="l00669"></a>00669       <span class="keywordflow">else</span> <span class="keywordflow">if</span>( fTop )                                             usRoofIndex = TOP_ROOF_INDEX;
<a name="l00670"></a>00670       <span class="keywordflow">else</span> <span class="keywordflow">if</span>( fBottom )                                    usRoofIndex = BOTTOM_ROOF_INDEX;
<a name="l00671"></a>00671       <span class="keywordflow">else</span> <span class="keywordflow">if</span>( fLeft )                                      usRoofIndex = LEFT_ROOF_INDEX;
<a name="l00672"></a>00672       <span class="keywordflow">else</span> <span class="keywordflow">if</span>( fRight )                                     usRoofIndex = RIGHT_ROOF_INDEX;
<a name="l00673"></a>00673       <span class="keywordflow">else</span>                                                                          usRoofIndex = CENTER_ROOF_BASE_INDEX + ( rand() % CENTER_ROOF_VARIANTS );
<a name="l00674"></a>00674       <a class="code" href="tiledef_8cpp.html#88fb4209f479cf8705b24390553f0e16">GetTileIndexFromTypeSubIndex</a>( usRoofType, usRoofIndex, &amp;usTileIndex );
<a name="l00675"></a>00675       <a class="code" href="worldman_8cpp.html#9c17e54f8854f79a814dc473877fb094">AddRoofToHead</a>( iMapIndex, usTileIndex );
<a name="l00676"></a>00676       <span class="comment">//if the editor view roofs is off, then the new roofs need to be hidden.</span>
<a name="l00677"></a>00677       <span class="keywordflow">if</span>( !<a class="code" href="EditorBuildings_8cpp.html#4e46a616ed46b32dd35c6e2d5df4baa1">fBuildingShowRoofs</a> )
<a name="l00678"></a>00678       {
<a name="l00679"></a>00679             <a class="code" href="worldman_8cpp.html#ed5137e0ff7396e95504a4c72c9b45f2">HideStructOfGivenType</a>( iMapIndex, usRoofType, TRUE );
<a name="l00680"></a>00680       }
<a name="l00681"></a>00681 }     
<a name="l00682"></a>00682 
<a name="l00683"></a><a class="code" href="newsmooth_8cpp.html#f603663531a105d18fef60a0a2f3e612">00683</a> <span class="keywordtype">void</span> <a class="code" href="newsmooth_8cpp.html#f603663531a105d18fef60a0a2f3e612">BulldozeNature</a>( <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="editscreen_8cpp.html#48f31659f64cd18c814b1612166c50b5">iMapIndex</a> )
<a name="l00684"></a>00684 {
<a name="l00685"></a>00685       <a class="code" href="Editor_01Undo_8cpp.html#9b2fd306128d272a5745c07ff45478cc">AddToUndoList</a>( iMapIndex );
<a name="l00686"></a>00686       <a class="code" href="worldman_8cpp.html#1acec58102dd248ff2c5d15b9f59609b">RemoveAllStructsOfTypeRange</a>( iMapIndex, <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f7974864b1773c9c55956861e8873255235a04">FIRSTISTRUCT</a>,LASTISTRUCT );
<a name="l00687"></a>00687       <a class="code" href="worldman_8cpp.html#dd620bf7994d7926c5e56d8bf4710a11">RemoveAllShadowsOfTypeRange</a>( iMapIndex, <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f7974845ffc0629963d741f927e95fe8a3f958">FIRSTCLIFFSHADOW</a>, LASTCLIFFSHADOW );
<a name="l00688"></a>00688       <a class="code" href="worldman_8cpp.html#1acec58102dd248ff2c5d15b9f59609b">RemoveAllStructsOfTypeRange</a>( iMapIndex, <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f797483ba37ea0e990ac759ea9fe365bf80e9c">FIRSTOSTRUCT</a>,LASTOSTRUCT ); <span class="comment">//outside objects.</span>
<a name="l00689"></a>00689       <a class="code" href="worldman_8cpp.html#dd620bf7994d7926c5e56d8bf4710a11">RemoveAllShadowsOfTypeRange</a>( iMapIndex, <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f7974803c54832b24057df367a61c5fac60724">FIRSTSHADOW</a>,LASTSHADOW );
<a name="l00690"></a>00690       <a class="code" href="worldman_8cpp.html#1acec58102dd248ff2c5d15b9f59609b">RemoveAllStructsOfTypeRange</a>( iMapIndex, <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f79748dd0fd72d62e3cd4c4a5e9faa1f93270f">FIRSTROAD</a>, LASTROAD );
<a name="l00691"></a>00691       <a class="code" href="worldman_8cpp.html#06771734bfdafaa969b791b111992259">RemoveAllObjectsOfTypeRange</a>( iMapIndex, <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f79748e6923b8dcec20963c85fa97dd270821e">DEBRISROCKS</a>, LASTDEBRIS );
<a name="l00692"></a>00692       <a class="code" href="worldman_8cpp.html#06771734bfdafaa969b791b111992259">RemoveAllObjectsOfTypeRange</a>( iMapIndex, <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f79748824d6d8354b8656c885d311cec76a78e">ANOTHERDEBRIS</a>, <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f79748824d6d8354b8656c885d311cec76a78e">ANOTHERDEBRIS</a> );
<a name="l00693"></a>00693 }
<a name="l00694"></a>00694 
<a name="l00695"></a><a class="code" href="newsmooth_8cpp.html#7323c011de10e4227ba2bb0eb61decb2">00695</a> <span class="keywordtype">void</span> <a class="code" href="newsmooth_8cpp.html#7323c011de10e4227ba2bb0eb61decb2">EraseRoof</a>( <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="editscreen_8cpp.html#48f31659f64cd18c814b1612166c50b5">iMapIndex</a> )
<a name="l00696"></a>00696 {
<a name="l00697"></a>00697       <a class="code" href="Editor_01Undo_8cpp.html#9b2fd306128d272a5745c07ff45478cc">AddToUndoList</a>( iMapIndex );
<a name="l00698"></a>00698       <a class="code" href="worldman_8cpp.html#a0a975e0c954dd5375bb977c8b725aed">RemoveAllRoofsOfTypeRange</a>( iMapIndex, <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f79748f2532d0a25b98f71a276c921a37706ff">FIRSTTEXTURE</a>, LASTITEM );   
<a name="l00699"></a>00699       <a class="code" href="worldman_8cpp.html#49a74f5e08dde8d0787ca0555ff961c1">RemoveAllOnRoofsOfTypeRange</a>( iMapIndex, <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f79748f2532d0a25b98f71a276c921a37706ff">FIRSTTEXTURE</a>, LASTITEM );
<a name="l00700"></a>00700       <a class="code" href="worldman_8cpp.html#dd620bf7994d7926c5e56d8bf4710a11">RemoveAllShadowsOfTypeRange</a>( iMapIndex, <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f797485bbd7f634154077d5ecd6898d240595a">FIRSTROOF</a>, LASTSLANTROOF );
<a name="l00701"></a>00701 }
<a name="l00702"></a>00702 
<a name="l00703"></a><a class="code" href="newsmooth_8cpp.html#df917a9847f4ef4e8c8023e2dc2ee4e7">00703</a> <span class="keywordtype">void</span> <a class="code" href="newsmooth_8cpp.html#df917a9847f4ef4e8c8023e2dc2ee4e7">EraseFloor</a>( <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="editscreen_8cpp.html#48f31659f64cd18c814b1612166c50b5">iMapIndex</a> )
<a name="l00704"></a>00704 {
<a name="l00705"></a>00705       <a class="code" href="Editor_01Undo_8cpp.html#9b2fd306128d272a5745c07ff45478cc">AddToUndoList</a>( iMapIndex );
<a name="l00706"></a>00706       <a class="code" href="worldman_8cpp.html#57ad680a1f6b72ec385af4f7ef5a881c">RemoveAllLandsOfTypeRange</a>( iMapIndex, <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f79748c36f86dfa067ad8525732284862bfa31">FIRSTFLOOR</a>, LASTFLOOR );
<a name="l00707"></a>00707 }
<a name="l00708"></a>00708 
<a name="l00709"></a><a class="code" href="Smoothing_01Utils_8h.html#bf71755333ac6005eee1b1166ecd2643">00709</a> <span class="keywordtype">void</span> <a class="code" href="newsmooth_8cpp.html#bf71755333ac6005eee1b1166ecd2643">EraseWalls</a>( <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="editscreen_8cpp.html#48f31659f64cd18c814b1612166c50b5">iMapIndex</a> )
<a name="l00710"></a>00710 {
<a name="l00711"></a>00711       <a class="code" href="Editor_01Undo_8cpp.html#9b2fd306128d272a5745c07ff45478cc">AddToUndoList</a>( iMapIndex );
<a name="l00712"></a>00712       <a class="code" href="worldman_8cpp.html#1acec58102dd248ff2c5d15b9f59609b">RemoveAllStructsOfTypeRange</a>( iMapIndex, <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f79748f2532d0a25b98f71a276c921a37706ff">FIRSTTEXTURE</a>, LASTITEM );
<a name="l00713"></a>00713       <a class="code" href="worldman_8cpp.html#dd620bf7994d7926c5e56d8bf4710a11">RemoveAllShadowsOfTypeRange</a>( iMapIndex, <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f79748562c9c35be47be8af96e1ec9a898513c">FIRSTWALL</a>, LASTWALL );
<a name="l00714"></a>00714       <a class="code" href="worldman_8cpp.html#dd620bf7994d7926c5e56d8bf4710a11">RemoveAllShadowsOfTypeRange</a>( iMapIndex, <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f797483a7b975cddb801e2a1b88c28791abfc3">FIRSTDOORSHADOW</a>, LASTDOORSHADOW );
<a name="l00715"></a>00715       <a class="code" href="worldman_8cpp.html#06771734bfdafaa969b791b111992259">RemoveAllObjectsOfTypeRange</a>( iMapIndex, <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f79748e6923b8dcec20963c85fa97dd270821e">DEBRISROCKS</a>, LASTDEBRIS );
<a name="l00716"></a>00716       <a class="code" href="worldman_8cpp.html#7ce933e703b39ac61c59c955013bedb1">RemoveAllTopmostsOfTypeRange</a>( iMapIndex, <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f797487f7767c1e32bbbef74146f85918e7e54">WIREFRAMES</a>, <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f797487f7767c1e32bbbef74146f85918e7e54">WIREFRAMES</a> );
<a name="l00717"></a>00717       <a class="code" href="worldman_8cpp.html#06771734bfdafaa969b791b111992259">RemoveAllObjectsOfTypeRange</a>( iMapIndex, <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f79748c3ea89484f00d17f504419dc208c79ef">DEBRIS2MISC</a>, <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f79748c3ea89484f00d17f504419dc208c79ef">DEBRIS2MISC</a> );
<a name="l00718"></a>00718       <a class="code" href="worldman_8cpp.html#06771734bfdafaa969b791b111992259">RemoveAllObjectsOfTypeRange</a>( iMapIndex, <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f79748824d6d8354b8656c885d311cec76a78e">ANOTHERDEBRIS</a>, <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f79748824d6d8354b8656c885d311cec76a78e">ANOTHERDEBRIS</a> );
<a name="l00719"></a>00719 }
<a name="l00720"></a>00720 
<a name="l00721"></a><a class="code" href="newsmooth_8cpp.html#acb8d2a13fccbfcc46a3a1cf064943d8">00721</a> <span class="keywordtype">void</span> <a class="code" href="newsmooth_8cpp.html#acb8d2a13fccbfcc46a3a1cf064943d8">EraseBuilding</a>( <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="editscreen_8cpp.html#48f31659f64cd18c814b1612166c50b5">iMapIndex</a> )
<a name="l00722"></a>00722 {
<a name="l00723"></a>00723       <a class="code" href="newsmooth_8cpp.html#7323c011de10e4227ba2bb0eb61decb2">EraseRoof</a>( iMapIndex );
<a name="l00724"></a>00724       <a class="code" href="newsmooth_8cpp.html#df917a9847f4ef4e8c8023e2dc2ee4e7">EraseFloor</a>( iMapIndex );
<a name="l00725"></a>00725       <a class="code" href="newsmooth_8cpp.html#bf71755333ac6005eee1b1166ecd2643">EraseWalls</a>( iMapIndex );
<a name="l00726"></a>00726       <a class="code" href="Render_01Fun_8cpp.html#b222bc5b1d3fce42afbf2c0f197eeb68">gubWorldRoomInfo</a>[ iMapIndex ] = 0;
<a name="l00727"></a>00727 }
<a name="l00728"></a>00728 
<a name="l00729"></a>00729 <span class="comment">//Specialized function that will delete only the TOP_RIGHT oriented wall in the gridno to the left</span>
<a name="l00730"></a>00730 <span class="comment">//and the TOP_LEFT oriented wall in the gridno up one as well as the other building information at this</span>
<a name="l00731"></a>00731 <span class="comment">//gridno.</span>
<a name="l00732"></a><a class="code" href="newsmooth_8cpp.html#dded0d807f1fbf5bc7cbe40d4c13d6fe">00732</a> <span class="keywordtype">void</span> <a class="code" href="newsmooth_8cpp.html#dded0d807f1fbf5bc7cbe40d4c13d6fe">EraseFloorOwnedBuildingPieces</a>( <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="editscreen_8cpp.html#48f31659f64cd18c814b1612166c50b5">iMapIndex</a> )
<a name="l00733"></a>00733 {     
<a name="l00734"></a>00734       <a class="code" href="structTAG__level__node.html">LEVELNODE</a>   *pStruct = NULL;
<a name="l00735"></a>00735       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiTileType;
<a name="l00736"></a>00736       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usWallOrientation;
<a name="l00737"></a>00737 
<a name="l00738"></a>00738       <span class="keywordflow">if</span>( !<a class="code" href="environment_8cpp.html#766b3fc59d0883a3dffe106a75d85de9">gfBasement</a> &amp;&amp; !<a class="code" href="worlddef_8cpp.html#2b0bbb0a711487d90a4cbc59eb3135e9">FloorAtGridNo</a>( iMapIndex ) )
<a name="l00739"></a>00739       {     <span class="comment">//We don't have ownership issues if there isn't a floor here.</span>
<a name="l00740"></a>00740             <span class="keywordflow">return</span>;
<a name="l00741"></a>00741       }
<a name="l00742"></a>00742       <a class="code" href="newsmooth_8cpp.html#acb8d2a13fccbfcc46a3a1cf064943d8">EraseBuilding</a>( iMapIndex );
<a name="l00743"></a>00743       <span class="comment">//FIRST, SEARCH AND DESTROY FOR A LEFT NEIGHBORING TILE WITH A TOP_RIGHT ORIENTED WALL</span>
<a name="l00744"></a>00744       pStruct = <a class="code" href="worlddef_8cpp.html#a1c640bcf89772795e6517da9963e0d7">gpWorldLevelData</a>[ iMapIndex - 1 ].<a class="code" href="structMAP__ELEMENT.html#0cc751d3c74e25ab6dd78d58da155f6d">pStructHead</a>;
<a name="l00745"></a>00745       <span class="keywordflow">while</span>( pStruct != NULL )
<a name="l00746"></a>00746       {
<a name="l00747"></a>00747             <span class="keywordflow">if</span> ( pStruct-&gt;<a class="code" href="structTAG__level__node.html#52b821707a4f7d758df5f97d376ef9f7">usIndex</a> != NO_TILE )
<a name="l00748"></a>00748             {
<a name="l00749"></a>00749                   <a class="code" href="tiledef_8cpp.html#997c9e24de80577e1e7bcc85f5a5b7ec">GetTileType</a>( pStruct-&gt;<a class="code" href="structTAG__level__node.html#52b821707a4f7d758df5f97d376ef9f7">usIndex</a>, &amp;uiTileType );
<a name="l00750"></a>00750                   <span class="keywordflow">if</span> ( uiTileType &gt;= <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f79748562c9c35be47be8af96e1ec9a898513c">FIRSTWALL</a> &amp;&amp; uiTileType &lt;= LASTWALL ||
<a name="l00751"></a>00751                                uiTileType &gt;= <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f79748b580838524946655ef0d1ca8fd992e46">FIRSTDOOR</a> &amp;&amp; uiTileType &lt;= LASTDOOR )
<a name="l00752"></a>00752                   {
<a name="l00753"></a>00753                         <a class="code" href="tiledef_8cpp.html#88cd3b32d6027d45c72a6f6e6b0e190b">GetWallOrientation</a>( pStruct-&gt;<a class="code" href="structTAG__level__node.html#52b821707a4f7d758df5f97d376ef9f7">usIndex</a>, &amp;usWallOrientation );
<a name="l00754"></a>00754                         <span class="keywordflow">if</span>( usWallOrientation == <a class="code" href="tiledef_8h.html#894e4ad72f98fcf9d632b22db77845a82ae9ed271ada2567debafc536d5b0379">INSIDE_TOP_RIGHT</a> || usWallOrientation == <a class="code" href="tiledef_8h.html#894e4ad72f98fcf9d632b22db77845a80116de02cab510615bb2e55d6f02bf31">OUTSIDE_TOP_RIGHT</a> )
<a name="l00755"></a>00755                         {
<a name="l00756"></a>00756                               <a class="code" href="Editor_01Undo_8cpp.html#9b2fd306128d272a5745c07ff45478cc">AddToUndoList</a>( iMapIndex - 1 );
<a name="l00757"></a>00757                               <a class="code" href="worldman_8cpp.html#d86473576ee54508483e8f6f988fb0c5">RemoveStruct</a>( iMapIndex - 1, pStruct-&gt;<a class="code" href="structTAG__level__node.html#52b821707a4f7d758df5f97d376ef9f7">usIndex</a> );
<a name="l00758"></a>00758                               <a class="code" href="worldman_8cpp.html#dd620bf7994d7926c5e56d8bf4710a11">RemoveAllShadowsOfTypeRange</a>( iMapIndex - 1, <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f79748562c9c35be47be8af96e1ec9a898513c">FIRSTWALL</a>, LASTWALL );
<a name="l00759"></a>00759                               <span class="keywordflow">break</span>; <span class="comment">//otherwise, it'll crash because pStruct is toast.</span>
<a name="l00760"></a>00760                         }
<a name="l00761"></a>00761                   }
<a name="l00762"></a>00762             }
<a name="l00763"></a>00763             pStruct = pStruct-&gt;<a class="code" href="structTAG__level__node.html#7c693acc3b593ab866b789ba7542eef7">pNext</a>;
<a name="l00764"></a>00764       }
<a name="l00765"></a>00765       <span class="comment">//FINALLY, SEARCH AND DESTROY FOR A TOP NEIGHBORING TILE WITH A TOP_LEFT ORIENTED WALL</span>
<a name="l00766"></a>00766       pStruct = <a class="code" href="worlddef_8cpp.html#a1c640bcf89772795e6517da9963e0d7">gpWorldLevelData</a>[ iMapIndex - WORLD_COLS ].<a class="code" href="structMAP__ELEMENT.html#0cc751d3c74e25ab6dd78d58da155f6d">pStructHead</a>;
<a name="l00767"></a>00767       <span class="keywordflow">while</span>( pStruct != NULL )
<a name="l00768"></a>00768       {
<a name="l00769"></a>00769             <span class="keywordflow">if</span> ( pStruct-&gt;<a class="code" href="structTAG__level__node.html#52b821707a4f7d758df5f97d376ef9f7">usIndex</a> != NO_TILE )
<a name="l00770"></a>00770             {
<a name="l00771"></a>00771                   <a class="code" href="tiledef_8cpp.html#997c9e24de80577e1e7bcc85f5a5b7ec">GetTileType</a>( pStruct-&gt;<a class="code" href="structTAG__level__node.html#52b821707a4f7d758df5f97d376ef9f7">usIndex</a>, &amp;uiTileType );
<a name="l00772"></a>00772                   <span class="keywordflow">if</span> ( uiTileType &gt;= <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f79748562c9c35be47be8af96e1ec9a898513c">FIRSTWALL</a> &amp;&amp; uiTileType &lt;= LASTWALL ||
<a name="l00773"></a>00773                                uiTileType &gt;= <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f79748b580838524946655ef0d1ca8fd992e46">FIRSTDOOR</a> &amp;&amp; uiTileType &lt;= LASTDOOR )
<a name="l00774"></a>00774                   {
<a name="l00775"></a>00775                         <a class="code" href="tiledef_8cpp.html#88cd3b32d6027d45c72a6f6e6b0e190b">GetWallOrientation</a>( pStruct-&gt;<a class="code" href="structTAG__level__node.html#52b821707a4f7d758df5f97d376ef9f7">usIndex</a>, &amp;usWallOrientation );
<a name="l00776"></a>00776                         <span class="keywordflow">if</span>( usWallOrientation == <a class="code" href="tiledef_8h.html#894e4ad72f98fcf9d632b22db77845a8f75944718d83d0d6dacc7c27b74bd5c1">INSIDE_TOP_LEFT</a> || usWallOrientation == <a class="code" href="tiledef_8h.html#894e4ad72f98fcf9d632b22db77845a8eaa089acb450ae53dc9c990eb80c40b9">OUTSIDE_TOP_LEFT</a> )
<a name="l00777"></a>00777                         {
<a name="l00778"></a>00778                               <a class="code" href="Editor_01Undo_8cpp.html#9b2fd306128d272a5745c07ff45478cc">AddToUndoList</a>( iMapIndex - WORLD_COLS );
<a name="l00779"></a>00779                               <a class="code" href="worldman_8cpp.html#d86473576ee54508483e8f6f988fb0c5">RemoveStruct</a>( iMapIndex - WORLD_COLS , pStruct-&gt;<a class="code" href="structTAG__level__node.html#52b821707a4f7d758df5f97d376ef9f7">usIndex</a> );
<a name="l00780"></a>00780                               <a class="code" href="worldman_8cpp.html#dd620bf7994d7926c5e56d8bf4710a11">RemoveAllShadowsOfTypeRange</a>( iMapIndex - WORLD_COLS, <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f79748562c9c35be47be8af96e1ec9a898513c">FIRSTWALL</a>, LASTWALL );
<a name="l00781"></a>00781                               <span class="keywordflow">break</span>; <span class="comment">//otherwise, it'll crash because pStruct is toast.</span>
<a name="l00782"></a>00782                         }
<a name="l00783"></a>00783                   }
<a name="l00784"></a>00784             }
<a name="l00785"></a>00785             pStruct = pStruct-&gt;<a class="code" href="structTAG__level__node.html#7c693acc3b593ab866b789ba7542eef7">pNext</a>;
<a name="l00786"></a>00786       }
<a name="l00787"></a>00787 }
<a name="l00788"></a>00788 
<a name="l00789"></a>00789 <span class="comment">/*</span>
<a name="l00790"></a>00790 <span class="comment">BOOLEAN CaveAtGridNo( INT32 iMapIndex );</span>
<a name="l00791"></a>00791 <span class="comment">UINT16 GetCaveTileIndexFromPerimeterValue( UINT8 ubTotal );</span>
<a name="l00792"></a>00792 <span class="comment">UINT8 CalcNewCavePerimeterValue( INT32 iMapIndex );</span>
<a name="l00793"></a>00793 <span class="comment">void AddCave( INT32 iMapIndex, UINT16 usIndex );</span>
<a name="l00794"></a>00794 <span class="comment">*/</span>
<a name="l00795"></a>00795 
<a name="l00796"></a><a class="code" href="newsmooth_8h.html#f460d1a00b56fa4ffd4c6d541c580b11">00796</a> <span class="keywordtype">void</span> <a class="code" href="newsmooth_8cpp.html#f460d1a00b56fa4ffd4c6d541c580b11">RemoveCaveSectionFromWorld</a>( <a class="code" href="structSGPRect.html">SGPRect</a> *pSelectRegion )
<a name="l00797"></a>00797 {
<a name="l00798"></a>00798       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="Editor_01Undo_8cpp.html#7c94d45f9da71d3f628ba77b870f39fb">top</a>, left, right, bottom, <a class="code" href="Sound_01Control_8cpp.html#6150e0515f7202e2fb518f7206ed97dc">x</a>, y;
<a name="l00799"></a>00799       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="editscreen_8cpp.html#48f31659f64cd18c814b1612166c50b5">iMapIndex</a>;
<a name="l00800"></a>00800       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex;
<a name="l00801"></a>00801       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubPerimeterValue;
<a name="l00802"></a>00802       top = pSelectRegion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l00803"></a>00803       left = pSelectRegion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l00804"></a>00804       right = pSelectRegion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l00805"></a>00805       bottom = pSelectRegion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l00806"></a>00806       <span class="comment">//Pass 1:  Remove all pieces in area</span>
<a name="l00807"></a>00807       <span class="keywordflow">for</span>( y = top; y &lt;= bottom; y++ ) <span class="keywordflow">for</span>( x = left; x &lt;= right; x++ )
<a name="l00808"></a>00808       {
<a name="l00809"></a>00809             iMapIndex = y * WORLD_COLS + x;
<a name="l00810"></a>00810             <a class="code" href="Editor_01Undo_8cpp.html#9b2fd306128d272a5745c07ff45478cc">AddToUndoList</a>( iMapIndex );
<a name="l00811"></a>00811             <a class="code" href="worldman_8cpp.html#1acec58102dd248ff2c5d15b9f59609b">RemoveAllStructsOfTypeRange</a>( iMapIndex, <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f79748562c9c35be47be8af96e1ec9a898513c">FIRSTWALL</a>, LASTWALL );          
<a name="l00812"></a>00812       }
<a name="l00813"></a>00813       <span class="comment">//Past 2:  Go around outside perimeter and smooth each piece</span>
<a name="l00814"></a>00814       <span class="keywordflow">for</span>( y = top - 1; y &lt;= bottom + 1; y++ ) <span class="keywordflow">for</span>( x = left - 1; x &lt;= right + 1; x++ )
<a name="l00815"></a>00815       {
<a name="l00816"></a>00816             iMapIndex = y * WORLD_COLS + x;
<a name="l00817"></a>00817             <span class="keywordflow">if</span>( <a class="code" href="newsmooth_8cpp.html#66062e27517c0e62d139c0fd57b124d1">CaveAtGridNo</a>( iMapIndex ) )
<a name="l00818"></a>00818             {
<a name="l00819"></a>00819               ubPerimeterValue = <a class="code" href="newsmooth_8cpp.html#6c0b1a7384947f890223a72d03e88084">CalcNewCavePerimeterValue</a>( iMapIndex );
<a name="l00820"></a>00820                   usIndex = <a class="code" href="newsmooth_8cpp.html#0c813d52db477dbbd482e3e6bd17fdc2">GetCaveTileIndexFromPerimeterValue</a>( ubPerimeterValue );
<a name="l00821"></a>00821                   <a class="code" href="Editor_01Undo_8cpp.html#9b2fd306128d272a5745c07ff45478cc">AddToUndoList</a>( iMapIndex );
<a name="l00822"></a>00822                   <span class="keywordflow">if</span>( usIndex != 0xffff )
<a name="l00823"></a>00823                         <a class="code" href="newsmooth_8cpp.html#e71c70b825417bc706a561f024e10228">AddCave</a>( iMapIndex, usIndex );
<a name="l00824"></a>00824                   <span class="keywordflow">else</span>
<a name="l00825"></a>00825                   {     <span class="comment">//change piece to stalagmite...</span>
<a name="l00826"></a>00826                         <a class="code" href="worldman_8cpp.html#1acec58102dd248ff2c5d15b9f59609b">RemoveAllStructsOfTypeRange</a>( iMapIndex, <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f79748562c9c35be47be8af96e1ec9a898513c">FIRSTWALL</a>, LASTWALL );
<a name="l00827"></a>00827                   }
<a name="l00828"></a>00828             }
<a name="l00829"></a>00829       }
<a name="l00830"></a>00830 }
<a name="l00831"></a>00831 
<a name="l00832"></a><a class="code" href="newsmooth_8h.html#a511423915698d6250679dd88ee69ee6">00832</a> <span class="keywordtype">void</span> <a class="code" href="newsmooth_8cpp.html#a511423915698d6250679dd88ee69ee6">AddCaveSectionToWorld</a>( <a class="code" href="structSGPRect.html">SGPRect</a> *pSelectRegion )
<a name="l00833"></a>00833 {
<a name="l00834"></a>00834       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> <a class="code" href="Editor_01Undo_8cpp.html#7c94d45f9da71d3f628ba77b870f39fb">top</a>, left, right, bottom, <a class="code" href="Sound_01Control_8cpp.html#6150e0515f7202e2fb518f7206ed97dc">x</a>, y;
<a name="l00835"></a>00835       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiMapIndex;
<a name="l00836"></a>00836       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex;
<a name="l00837"></a>00837       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubPerimeterValue;
<a name="l00838"></a>00838       top = pSelectRegion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l00839"></a>00839       left = pSelectRegion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l00840"></a>00840       right = pSelectRegion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l00841"></a>00841       bottom = pSelectRegion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l00842"></a>00842       <span class="comment">//Pass 1:  Add bogus piece to each gridno in region</span>
<a name="l00843"></a>00843       <span class="keywordflow">for</span>( y = top; y &lt;= bottom; y++ ) <span class="keywordflow">for</span>( x = left; x &lt;= right; x++ )
<a name="l00844"></a>00844       {
<a name="l00845"></a>00845             uiMapIndex = y * WORLD_COLS + x;
<a name="l00846"></a>00846             <span class="keywordflow">if</span>( uiMapIndex &lt; NOWHERE )
<a name="l00847"></a>00847             {
<a name="l00848"></a>00848                   usIndex = <a class="code" href="newsmooth_8cpp.html#0c813d52db477dbbd482e3e6bd17fdc2">GetCaveTileIndexFromPerimeterValue</a>( 0xff );
<a name="l00849"></a>00849                   <a class="code" href="Editor_01Undo_8cpp.html#9b2fd306128d272a5745c07ff45478cc">AddToUndoList</a>( uiMapIndex );
<a name="l00850"></a>00850                   <a class="code" href="newsmooth_8cpp.html#e71c70b825417bc706a561f024e10228">AddCave</a>( uiMapIndex, usIndex );
<a name="l00851"></a>00851             }
<a name="l00852"></a>00852       }
<a name="l00853"></a>00853       <span class="comment">//Past 2:  Go around outside perimeter and smooth each piece</span>
<a name="l00854"></a>00854       <span class="keywordflow">for</span>( y = top - 1; y &lt;= bottom + 1; y++ ) <span class="keywordflow">for</span>( x = left - 1; x &lt;= right + 1; x++ )
<a name="l00855"></a>00855       {
<a name="l00856"></a>00856             uiMapIndex = y * WORLD_COLS + x;
<a name="l00857"></a>00857             <span class="keywordflow">if</span>( uiMapIndex &lt; NOWHERE )
<a name="l00858"></a>00858             {
<a name="l00859"></a>00859                   <span class="keywordflow">if</span>( <a class="code" href="newsmooth_8cpp.html#66062e27517c0e62d139c0fd57b124d1">CaveAtGridNo</a>( uiMapIndex ) )
<a name="l00860"></a>00860                   {
<a name="l00861"></a>00861                         ubPerimeterValue = <a class="code" href="newsmooth_8cpp.html#6c0b1a7384947f890223a72d03e88084">CalcNewCavePerimeterValue</a>( uiMapIndex );
<a name="l00862"></a>00862                         usIndex = <a class="code" href="newsmooth_8cpp.html#0c813d52db477dbbd482e3e6bd17fdc2">GetCaveTileIndexFromPerimeterValue</a>( ubPerimeterValue );
<a name="l00863"></a>00863                         <a class="code" href="Editor_01Undo_8cpp.html#9b2fd306128d272a5745c07ff45478cc">AddToUndoList</a>( uiMapIndex );
<a name="l00864"></a>00864                         <span class="keywordflow">if</span>( usIndex != 0xffff )
<a name="l00865"></a>00865                               <a class="code" href="newsmooth_8cpp.html#e71c70b825417bc706a561f024e10228">AddCave</a>( uiMapIndex, usIndex );
<a name="l00866"></a>00866                         <span class="keywordflow">else</span>
<a name="l00867"></a>00867                         {     <span class="comment">//change piece to stalagmite...</span>
<a name="l00868"></a>00868                               <a class="code" href="worldman_8cpp.html#1acec58102dd248ff2c5d15b9f59609b">RemoveAllStructsOfTypeRange</a>( uiMapIndex, <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f79748562c9c35be47be8af96e1ec9a898513c">FIRSTWALL</a>, LASTWALL );
<a name="l00869"></a>00869                         }
<a name="l00870"></a>00870                   }
<a name="l00871"></a>00871             }
<a name="l00872"></a>00872       }
<a name="l00873"></a>00873 }
<a name="l00874"></a>00874 
<a name="l00875"></a>00875 <span class="comment">//--------------------------------------------------------------------------------------------------</span>
<a name="l00876"></a>00876 <span class="comment">// END OF PRIVATE FUNCTION IMPLEMENTATION</span>
<a name="l00877"></a>00877 <span class="comment">//--------------------------------------------------------------------------------------------------</span>
<a name="l00878"></a>00878 
<a name="l00879"></a>00879 
<a name="l00880"></a>00880 
<a name="l00881"></a>00881 <span class="comment">//--------------------------------------------------------------------------------------------------</span>
<a name="l00882"></a>00882 <span class="comment">// BEGIN PUBLIC FUNCTION IMPLEMENTATION</span>
<a name="l00883"></a>00883 <span class="comment">//--------------------------------------------------------------------------------------------------</span>
<a name="l00884"></a>00884 
<a name="l00885"></a>00885 <span class="comment">//When the user removes a section from a building, it will not only erase the </span>
<a name="l00886"></a>00886 <span class="comment">//entire highlighted area, it'll repair the building itself so there are no</span>
<a name="l00887"></a>00887 <span class="comment">//outside walls missing from the new building. </span>
<a name="l00888"></a><a class="code" href="newsmooth_8h.html#4ba56b1d22c2e0017cb74f3c9b2cd2eb">00888</a> <span class="keywordtype">void</span> <a class="code" href="newsmooth_8cpp.html#4ba56b1d22c2e0017cb74f3c9b2cd2eb">RemoveBuildingSectionFromWorld</a>( <a class="code" href="structSGPRect.html">SGPRect</a> *pSelectRegion )
<a name="l00889"></a>00889 {
<a name="l00890"></a>00890       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="Editor_01Undo_8cpp.html#7c94d45f9da71d3f628ba77b870f39fb">top</a>, left, right, bottom, <a class="code" href="Sound_01Control_8cpp.html#6150e0515f7202e2fb518f7206ed97dc">x</a>, y;
<a name="l00891"></a>00891       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="editscreen_8cpp.html#48f31659f64cd18c814b1612166c50b5">iMapIndex</a>;
<a name="l00892"></a>00892       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usTileIndex;
<a name="l00893"></a>00893       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usFloorType;
<a name="l00894"></a>00894       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fFloor;
<a name="l00895"></a>00895 
<a name="l00896"></a>00896       top = pSelectRegion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l00897"></a>00897       left = pSelectRegion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l00898"></a>00898       right = pSelectRegion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l00899"></a>00899       bottom = pSelectRegion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l00900"></a>00900 
<a name="l00901"></a>00901       <span class="comment">//1ST PASS:  Erase all building owned by the floor tile if there is one.</span>
<a name="l00902"></a>00902       <span class="keywordflow">for</span>( y = top; y &lt;= bottom; y++ ) <span class="keywordflow">for</span>( x = left; x &lt;= right; x++ )
<a name="l00903"></a>00903       {
<a name="l00904"></a>00904             iMapIndex = y * WORLD_COLS + x;
<a name="l00905"></a>00905             <a class="code" href="newsmooth_8cpp.html#dded0d807f1fbf5bc7cbe40d4c13d6fe">EraseFloorOwnedBuildingPieces</a>( iMapIndex ); <span class="comment">//Erase possible top and left walls in bordering tiles.</span>
<a name="l00906"></a>00906       }
<a name="l00907"></a>00907       <span class="comment">//2ND PASS:  Build new walls whereever there are neighboring floor tiles.</span>
<a name="l00908"></a>00908       <span class="keywordflow">for</span>( y = top; y &lt;= bottom; y++ ) <span class="keywordflow">for</span>( x = left; x &lt;= right; x++ )
<a name="l00909"></a>00909       {
<a name="l00910"></a>00910             iMapIndex = y * WORLD_COLS + x;
<a name="l00911"></a>00911             <span class="comment">//NOTE:  Top and bottom walls MUST be placed first -- it minimizes the number of special cases.</span>
<a name="l00912"></a>00912             <span class="keywordflow">if</span>( y == top )
<a name="l00913"></a>00913             {
<a name="l00914"></a>00914                   fFloor = <a class="code" href="worlddef_8cpp.html#2b0bbb0a711487d90a4cbc59eb3135e9">FloorAtGridNo</a>( iMapIndex - WORLD_COLS );
<a name="l00915"></a>00915                   <span class="keywordflow">if</span>( <a class="code" href="environment_8cpp.html#766b3fc59d0883a3dffe106a75d85de9">gfBasement</a> &amp;&amp; !fFloor || !<a class="code" href="environment_8cpp.html#766b3fc59d0883a3dffe106a75d85de9">gfBasement</a> &amp;&amp; fFloor &amp;&amp; !<a class="code" href="Smoothing_01Utils_8cpp.html#5d6ebbdb7c42ccf67514e2c8182508ac">GetHorizontalWall</a>( iMapIndex - WORLD_COLS ) )
<a name="l00916"></a>00916                         <a class="code" href="newsmooth_8cpp.html#0787df998fca595b9ce1ec4cb93da260">BuildWallPiece</a>( iMapIndex, <a class="code" href="Smoothing_01Utils_8h.html#b48899087cc647f0f791ed0c459adc535e95a48a03fb58ace65e804fb25837d1">EXTERIOR_TOP</a>, 0 );
<a name="l00917"></a>00917             }
<a name="l00918"></a>00918             <span class="keywordflow">if</span>( y == bottom )
<a name="l00919"></a>00919             {
<a name="l00920"></a>00920                   fFloor = <a class="code" href="worlddef_8cpp.html#2b0bbb0a711487d90a4cbc59eb3135e9">FloorAtGridNo</a>( iMapIndex + WORLD_COLS );
<a name="l00921"></a>00921                   <span class="keywordflow">if</span>( <a class="code" href="environment_8cpp.html#766b3fc59d0883a3dffe106a75d85de9">gfBasement</a> &amp;&amp; !fFloor || !<a class="code" href="environment_8cpp.html#766b3fc59d0883a3dffe106a75d85de9">gfBasement</a> &amp;&amp; fFloor &amp;&amp; !<a class="code" href="Smoothing_01Utils_8cpp.html#5d6ebbdb7c42ccf67514e2c8182508ac">GetHorizontalWall</a>( iMapIndex ) )
<a name="l00922"></a>00922                         <a class="code" href="newsmooth_8cpp.html#0787df998fca595b9ce1ec4cb93da260">BuildWallPiece</a>( iMapIndex, <a class="code" href="Smoothing_01Utils_8h.html#b48899087cc647f0f791ed0c459adc539296889f1e97c7af8b8c3fcf1671900e">EXTERIOR_BOTTOM</a>, 0 );
<a name="l00923"></a>00923             }
<a name="l00924"></a>00924             <span class="keywordflow">if</span>( x == left )
<a name="l00925"></a>00925             {
<a name="l00926"></a>00926                   fFloor = <a class="code" href="worlddef_8cpp.html#2b0bbb0a711487d90a4cbc59eb3135e9">FloorAtGridNo</a>( iMapIndex - 1 );
<a name="l00927"></a>00927                   <span class="keywordflow">if</span>( <a class="code" href="environment_8cpp.html#766b3fc59d0883a3dffe106a75d85de9">gfBasement</a> &amp;&amp; !fFloor || !<a class="code" href="environment_8cpp.html#766b3fc59d0883a3dffe106a75d85de9">gfBasement</a> &amp;&amp; fFloor &amp;&amp; !<a class="code" href="Smoothing_01Utils_8cpp.html#b67373a18a820e211a4a7b74c497bc63">GetVerticalWall</a>( iMapIndex - 1 ) )
<a name="l00928"></a>00928                         <a class="code" href="newsmooth_8cpp.html#0787df998fca595b9ce1ec4cb93da260">BuildWallPiece</a>( iMapIndex, <a class="code" href="Smoothing_01Utils_8h.html#b48899087cc647f0f791ed0c459adc53c3d99e261299fb199adfcbc77ab02ca8">EXTERIOR_LEFT</a>, 0 );
<a name="l00929"></a>00929             }
<a name="l00930"></a>00930             <span class="keywordflow">if</span>( x == right )
<a name="l00931"></a>00931             {
<a name="l00932"></a>00932                   fFloor = <a class="code" href="worlddef_8cpp.html#2b0bbb0a711487d90a4cbc59eb3135e9">FloorAtGridNo</a>( iMapIndex + 1);
<a name="l00933"></a>00933                   <span class="keywordflow">if</span>( <a class="code" href="environment_8cpp.html#766b3fc59d0883a3dffe106a75d85de9">gfBasement</a> &amp;&amp; !fFloor || !<a class="code" href="environment_8cpp.html#766b3fc59d0883a3dffe106a75d85de9">gfBasement</a> &amp;&amp; fFloor &amp;&amp; !<a class="code" href="Smoothing_01Utils_8cpp.html#b67373a18a820e211a4a7b74c497bc63">GetVerticalWall</a>( iMapIndex ) ) 
<a name="l00934"></a>00934                         <a class="code" href="newsmooth_8cpp.html#0787df998fca595b9ce1ec4cb93da260">BuildWallPiece</a>( iMapIndex, <a class="code" href="Smoothing_01Utils_8h.html#b48899087cc647f0f791ed0c459adc53b1a2d07db8acf3d4c47609b4f36ba337">EXTERIOR_RIGHT</a>, 0 );
<a name="l00935"></a>00935             }
<a name="l00936"></a>00936       }
<a name="l00937"></a>00937       <span class="comment">//3RD PASS:  Go around the outside of the region, and rebuild the roof.</span>
<a name="l00938"></a>00938       <span class="keywordflow">if</span>( <a class="code" href="environment_8cpp.html#766b3fc59d0883a3dffe106a75d85de9">gfBasement</a> )
<a name="l00939"></a>00939       {
<a name="l00940"></a>00940             usFloorType = <a class="code" href="edit__sys_8cpp.html#5692b4784d26b2c5e54e3465dd2cb036">GetRandomIndexByRange</a>( <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f79748c36f86dfa067ad8525732284862bfa31">FIRSTFLOOR</a>, LASTFLOOR );
<a name="l00941"></a>00941             <span class="keywordflow">if</span>( usFloorType == 0xffff ) 
<a name="l00942"></a>00942                   usFloorType = <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f79748c36f86dfa067ad8525732284862bfa31">FIRSTFLOOR</a>;
<a name="l00943"></a>00943             <span class="keywordflow">for</span>( y = top; y &lt;= bottom; y++ ) <span class="keywordflow">for</span>( x = left; x &lt;= right; x++ )
<a name="l00944"></a>00944             {
<a name="l00945"></a>00945                   iMapIndex = y * WORLD_COLS + x;
<a name="l00946"></a>00946                   <a class="code" href="tiledef_8cpp.html#88fb4209f479cf8705b24390553f0e16">GetTileIndexFromTypeSubIndex</a>( usFloorType, 1, &amp;usTileIndex );
<a name="l00947"></a>00947                   <a class="code" href="worldman_8cpp.html#205ed9951af6dabc1c5e857689628cd9">AddLandToHead</a>( iMapIndex, (<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>)( usTileIndex + <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( FLOOR_VARIANTS ) ) );
<a name="l00948"></a>00948             }
<a name="l00949"></a>00949       }
<a name="l00950"></a>00950       <span class="keywordflow">for</span>( y = top - 1; y &lt;= bottom + 1; y++ ) <span class="keywordflow">for</span>( x = left - 1; x &lt;= right + 1; x++ )
<a name="l00951"></a>00951       {
<a name="l00952"></a>00952             iMapIndex = y * WORLD_COLS + x;
<a name="l00953"></a>00953             <span class="keywordflow">if</span>( y == top - 1 || y == bottom + 1 || x == left - 1 || x == right + 1 )
<a name="l00954"></a>00954             {
<a name="l00955"></a>00955                   <span class="keywordflow">if</span>( !<a class="code" href="environment_8cpp.html#766b3fc59d0883a3dffe106a75d85de9">gfBasement</a> &amp;&amp; <a class="code" href="worlddef_8cpp.html#2b0bbb0a711487d90a4cbc59eb3135e9">FloorAtGridNo</a>( iMapIndex ) || <a class="code" href="environment_8cpp.html#766b3fc59d0883a3dffe106a75d85de9">gfBasement</a> &amp;&amp; !<a class="code" href="worlddef_8cpp.html#2b0bbb0a711487d90a4cbc59eb3135e9">FloorAtGridNo</a>( iMapIndex ) )
<a name="l00956"></a>00956                   {
<a name="l00957"></a>00957                         <a class="code" href="newsmooth_8cpp.html#9a728ec9c5cac6997770f83001ecf5f9">RebuildRoof</a>( iMapIndex, 0 );
<a name="l00958"></a>00958                   }
<a name="l00959"></a>00959             }
<a name="l00960"></a>00960       }
<a name="l00961"></a>00961 }
<a name="l00962"></a>00962 
<a name="l00963"></a><a class="code" href="newsmooth_8h.html#f07e527797a144369d243e5f263f55e7">00963</a> <span class="keywordtype">void</span> <a class="code" href="newsmooth_8cpp.html#f07e527797a144369d243e5f263f55e7">AddBuildingSectionToWorld</a>( <a class="code" href="structSGPRect.html">SGPRect</a> *pSelectRegion )
<a name="l00964"></a>00964 {
<a name="l00965"></a>00965       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> <a class="code" href="Editor_01Undo_8cpp.html#7c94d45f9da71d3f628ba77b870f39fb">top</a>, left, right, bottom, <a class="code" href="Sound_01Control_8cpp.html#6150e0515f7202e2fb518f7206ed97dc">x</a>, y;
<a name="l00966"></a>00966       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> <a class="code" href="editscreen_8cpp.html#48f31659f64cd18c814b1612166c50b5">iMapIndex</a>;
<a name="l00967"></a>00967       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usFloorType, usWallType, usRoofType;
<a name="l00968"></a>00968       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usTileIndex;
<a name="l00969"></a>00969       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fNewBuilding;
<a name="l00970"></a>00970       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fSlantRoof = FALSE;
<a name="l00971"></a>00971       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fVertical;
<a name="l00972"></a>00972       <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fFloor;
<a name="l00973"></a>00973       top = pSelectRegion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l00974"></a>00974       left = pSelectRegion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l00975"></a>00975       right = pSelectRegion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l00976"></a>00976       bottom = pSelectRegion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l00977"></a>00977 
<a name="l00978"></a>00978       <span class="comment">//Special case scenario:</span>
<a name="l00979"></a>00979       <span class="comment">//If the user selects a floor without walls, then it is implied that the user wishes to </span>
<a name="l00980"></a>00980       <span class="comment">//change the floor for say a kitchen which might have a different floor type.</span>
<a name="l00981"></a>00981       usWallType = <a class="code" href="edit__sys_8cpp.html#5692b4784d26b2c5e54e3465dd2cb036">GetRandomIndexByRange</a>( <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f79748562c9c35be47be8af96e1ec9a898513c">FIRSTWALL</a>, LASTWALL );
<a name="l00982"></a>00982       usFloorType = <a class="code" href="edit__sys_8cpp.html#5692b4784d26b2c5e54e3465dd2cb036">GetRandomIndexByRange</a>( <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f79748c36f86dfa067ad8525732284862bfa31">FIRSTFLOOR</a>, LASTFLOOR );
<a name="l00983"></a>00983       <span class="keywordflow">if</span>( usWallType == 0xffff &amp;&amp; usFloorType != 0xffff )
<a name="l00984"></a>00984       { <span class="comment">//allow user to place floors</span>
<a name="l00985"></a>00985             <span class="keywordflow">for</span>( y = top; y &lt;= bottom; y++ ) <span class="keywordflow">for</span>( x = left; x &lt;= right; x++ )
<a name="l00986"></a>00986             {
<a name="l00987"></a>00987                   iMapIndex = y * WORLD_COLS + x;
<a name="l00988"></a>00988                   <a class="code" href="newsmooth_8cpp.html#df917a9847f4ef4e8c8023e2dc2ee4e7">EraseFloor</a>( iMapIndex );
<a name="l00989"></a>00989                   <a class="code" href="tiledef_8cpp.html#88fb4209f479cf8705b24390553f0e16">GetTileIndexFromTypeSubIndex</a>( usFloorType, 1, &amp;usTileIndex );
<a name="l00990"></a>00990                   <a class="code" href="worldman_8cpp.html#205ed9951af6dabc1c5e857689628cd9">AddLandToHead</a>( iMapIndex, (<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>)( usTileIndex + <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( FLOOR_VARIANTS ) ) );
<a name="l00991"></a>00991             }
<a name="l00992"></a>00992             <span class="comment">//we are done!</span>
<a name="l00993"></a>00993             <span class="keywordflow">return</span>;
<a name="l00994"></a>00994       }
<a name="l00995"></a>00995 
<a name="l00996"></a>00996       <span class="comment">//1ST PASS:  Determine if there are any floor tiles in this region.  If there are, then</span>
<a name="l00997"></a>00997       <span class="comment">//  that signifies that we are concantenating this building to an existing one.  Otherwise,</span>
<a name="l00998"></a>00998       <span class="comment">//  we are just drawing an individual building.  If we find a floor, extract the type so</span>
<a name="l00999"></a>00999       <span class="comment">//  we know how to draw it later.</span>
<a name="l01000"></a>01000       fNewBuilding = TRUE;
<a name="l01001"></a>01001       <span class="keywordflow">for</span>( y = top; y &lt;= bottom; y++ ) <span class="keywordflow">for</span>( x = left; x &lt;= right; x++ )
<a name="l01002"></a>01002       {
<a name="l01003"></a>01003             iMapIndex = y * WORLD_COLS + x;
<a name="l01004"></a>01004             <span class="keywordflow">if</span>( <a class="code" href="worlddef_8cpp.html#2b0bbb0a711487d90a4cbc59eb3135e9">FloorAtGridNo</a>( iMapIndex ) )
<a name="l01005"></a>01005             {
<a name="l01006"></a>01006                   <a class="code" href="structTAG__level__node.html">LEVELNODE</a> *pFloor;
<a name="l01007"></a>01007                   <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiTileType;
<a name="l01008"></a>01008                   <span class="comment">//If a floor is found, then we are adding to an existing structure.</span>
<a name="l01009"></a>01009                   fNewBuilding = FALSE;
<a name="l01010"></a>01010                   <span class="comment">//Extract the floor type.  We already checked if there was a floor here, so it is assumed.</span>
<a name="l01011"></a>01011                   pFloor = <a class="code" href="worlddef_8cpp.html#a1c640bcf89772795e6517da9963e0d7">gpWorldLevelData</a>[ iMapIndex ].<a class="code" href="structMAP__ELEMENT.html#a1705924637065ad2cf2cf884e6429f7">pLandHead</a>;
<a name="l01012"></a>01012                   <span class="keywordflow">while</span>( pFloor )
<a name="l01013"></a>01013                   {
<a name="l01014"></a>01014                         <a class="code" href="tiledef_8cpp.html#997c9e24de80577e1e7bcc85f5a5b7ec">GetTileType</a>( pFloor-&gt;usIndex, &amp;uiTileType );
<a name="l01015"></a>01015                         <span class="keywordflow">if</span>( uiTileType &gt;= <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f79748c36f86dfa067ad8525732284862bfa31">FIRSTFLOOR</a> &amp;&amp; uiTileType &lt;= LASTFLOOR )
<a name="l01016"></a>01016                         {     
<a name="l01017"></a>01017                               usFloorType = (<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>)uiTileType;
<a name="l01018"></a>01018                               <span class="keywordflow">break</span>;
<a name="l01019"></a>01019                         }
<a name="l01020"></a>01020                   }
<a name="l01021"></a>01021                   usWallType = <a class="code" href="Smoothing_01Utils_8cpp.html#bc21281b2435040c0f95eb938149d7b2">SearchForWallType</a>( iMapIndex );
<a name="l01022"></a>01022                   usRoofType = <a class="code" href="Smoothing_01Utils_8cpp.html#bdd2c37907cce9eef5d0759497939f18">SearchForRoofType</a>( iMapIndex );
<a name="l01023"></a>01023                   <span class="keywordflow">if</span>( usWallType != 0xffff &amp;&amp; usRoofType != 0xffff &amp;&amp; usFloorType !=0xffff )
<a name="l01024"></a>01024                   {     <span class="comment">//we have extracted all of the information we need, so we can break out.</span>
<a name="l01025"></a>01025                         y = bottom;
<a name="l01026"></a>01026                         <span class="keywordflow">break</span>;
<a name="l01027"></a>01027                   }
<a name="l01028"></a>01028             }
<a name="l01029"></a>01029       }
<a name="l01030"></a>01030       
<a name="l01031"></a>01031       <span class="keywordflow">if</span>( fNewBuilding )
<a name="l01032"></a>01032       {
<a name="l01033"></a>01033             <span class="comment">//if( gfBasement )</span>
<a name="l01034"></a>01034             <span class="comment">//    return;</span>
<a name="l01035"></a>01035             <span class="comment">//Get materials via selection window method.</span>
<a name="l01036"></a>01036             usWallType = <a class="code" href="edit__sys_8cpp.html#5692b4784d26b2c5e54e3465dd2cb036">GetRandomIndexByRange</a>( <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f79748562c9c35be47be8af96e1ec9a898513c">FIRSTWALL</a>, LASTWALL );
<a name="l01037"></a>01037             usFloorType = <a class="code" href="edit__sys_8cpp.html#5692b4784d26b2c5e54e3465dd2cb036">GetRandomIndexByRange</a>( <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f79748c36f86dfa067ad8525732284862bfa31">FIRSTFLOOR</a>, LASTFLOOR );
<a name="l01038"></a>01038             usRoofType = <a class="code" href="edit__sys_8cpp.html#5692b4784d26b2c5e54e3465dd2cb036">GetRandomIndexByRange</a>( <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f797485bbd7f634154077d5ecd6898d240595a">FIRSTROOF</a>, LASTROOF );
<a name="l01039"></a>01039             <span class="keywordflow">if</span>( usRoofType == 0xffff )
<a name="l01040"></a>01040             {
<a name="l01041"></a>01041                   usRoofType = <a class="code" href="edit__sys_8cpp.html#5692b4784d26b2c5e54e3465dd2cb036">GetRandomIndexByRange</a>( <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f79748853719fae3cf603b86e9454b11b5b377">FIRSTSLANTROOF</a>, LASTSLANTROOF );
<a name="l01042"></a>01042                   <span class="keywordflow">if</span>( usRoofType != 0xffff )
<a name="l01043"></a>01043                   {
<a name="l01044"></a>01044                         <span class="keywordflow">if</span>( !<a class="code" href="environment_8cpp.html#766b3fc59d0883a3dffe106a75d85de9">gfBasement</a> )
<a name="l01045"></a>01045                               fSlantRoof = TRUE;
<a name="l01046"></a>01046                         <span class="keywordflow">else</span>
<a name="l01047"></a>01047                               usRoofType = <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f797485bbd7f634154077d5ecd6898d240595a">FIRSTROOF</a>;
<a name="l01048"></a>01048                   }
<a name="l01049"></a>01049             }
<a name="l01050"></a>01050             <span class="keywordflow">if</span>( usWallType == 0xffff )
<a name="l01051"></a>01051                   <span class="keywordflow">return</span>;
<a name="l01052"></a>01052       }
<a name="l01053"></a>01053 
<a name="l01054"></a>01054       <span class="comment">//2ND PASS:  Remove all walls in the region that border no floor tile, or simply walls</span>
<a name="l01055"></a>01055       <span class="comment">//  that are considered exterior walls.  That way, it won't wreck the inside of a building</span>
<a name="l01056"></a>01056       <span class="comment">//  if you select too much interior.  Also, gridnos that delete walls will also delete the </span>
<a name="l01057"></a>01057       <span class="comment">//  floor and roof tiles there.  That signifies that the floorless parts will be resmoothed, </span>
<a name="l01058"></a>01058       <span class="comment">//  and rebuilt in the third pass.</span>
<a name="l01059"></a>01059       <span class="keywordflow">for</span>( y = <a class="code" href="Editor_01Undo_8cpp.html#7c94d45f9da71d3f628ba77b870f39fb">top</a>; y &lt;= bottom; y++ ) <span class="keywordflow">for</span>( <a class="code" href="Sound_01Control_8cpp.html#6150e0515f7202e2fb518f7206ed97dc">x</a> = left; <a class="code" href="Sound_01Control_8cpp.html#6150e0515f7202e2fb518f7206ed97dc">x</a> &lt;= right; <a class="code" href="Sound_01Control_8cpp.html#6150e0515f7202e2fb518f7206ed97dc">x</a>++ )
<a name="l01060"></a>01060       {
<a name="l01061"></a>01061             <a class="code" href="editscreen_8cpp.html#48f31659f64cd18c814b1612166c50b5">iMapIndex</a> = y * WORLD_COLS + <a class="code" href="Sound_01Control_8cpp.html#6150e0515f7202e2fb518f7206ed97dc">x</a>;
<a name="l01062"></a>01062             <span class="keywordflow">if</span>( <a class="code" href="environment_8cpp.html#766b3fc59d0883a3dffe106a75d85de9">gfBasement</a> )
<a name="l01063"></a>01063             {
<a name="l01064"></a>01064                   <a class="code" href="newsmooth_8cpp.html#acb8d2a13fccbfcc46a3a1cf064943d8">EraseBuilding</a>( <a class="code" href="editscreen_8cpp.html#48f31659f64cd18c814b1612166c50b5">iMapIndex</a> );               
<a name="l01065"></a>01065             }
<a name="l01066"></a>01066             <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="worlddef_8cpp.html#2b0bbb0a711487d90a4cbc59eb3135e9">FloorAtGridNo</a>( <a class="code" href="editscreen_8cpp.html#48f31659f64cd18c814b1612166c50b5">iMapIndex</a> ) &amp;&amp; !fNewBuilding) 
<a name="l01067"></a>01067             {
<a name="l01068"></a>01068                   <span class="keywordflow">if</span>( y &gt;= <a class="code" href="Editor_01Undo_8cpp.html#7c94d45f9da71d3f628ba77b870f39fb">top</a> &amp;&amp; !<a class="code" href="worlddef_8cpp.html#2b0bbb0a711487d90a4cbc59eb3135e9">FloorAtGridNo</a>( iMapIndex - WORLD_COLS ) )
<a name="l01069"></a>01069                   {
<a name="l01070"></a>01070                         <a class="code" href="Smoothing_01Utils_8cpp.html#144f731eae770e1d1f38dad56fd95323">EraseHorizontalWall</a>( iMapIndex - WORLD_COLS );
<a name="l01071"></a>01071                         <a class="code" href="newsmooth_8cpp.html#df917a9847f4ef4e8c8023e2dc2ee4e7">EraseFloor</a>( iMapIndex );
<a name="l01072"></a>01072                         <a class="code" href="newsmooth_8cpp.html#7323c011de10e4227ba2bb0eb61decb2">EraseRoof</a>( iMapIndex );
<a name="l01073"></a>01073                   }
<a name="l01074"></a>01074                   <span class="keywordflow">if</span>( y &lt;= bottom &amp;&amp; !<a class="code" href="worlddef_8cpp.html#2b0bbb0a711487d90a4cbc59eb3135e9">FloorAtGridNo</a>( iMapIndex + WORLD_COLS ) )
<a name="l01075"></a>01075                   {
<a name="l01076"></a>01076                         <a class="code" href="Smoothing_01Utils_8cpp.html#144f731eae770e1d1f38dad56fd95323">EraseHorizontalWall</a>( iMapIndex );
<a name="l01077"></a>01077                         <a class="code" href="newsmooth_8cpp.html#df917a9847f4ef4e8c8023e2dc2ee4e7">EraseFloor</a>( iMapIndex );
<a name="l01078"></a>01078                         <a class="code" href="newsmooth_8cpp.html#7323c011de10e4227ba2bb0eb61decb2">EraseRoof</a>( iMapIndex );
<a name="l01079"></a>01079                   }
<a name="l01080"></a>01080                   <span class="keywordflow">if</span>( <a class="code" href="Sound_01Control_8cpp.html#6150e0515f7202e2fb518f7206ed97dc">x</a> &gt;= left &amp;&amp; !<a class="code" href="worlddef_8cpp.html#2b0bbb0a711487d90a4cbc59eb3135e9">FloorAtGridNo</a>( iMapIndex - 1 ) )
<a name="l01081"></a>01081                   {
<a name="l01082"></a>01082                         <a class="code" href="Smoothing_01Utils_8cpp.html#48ba11a44281b6494748d2b35425bbaf">EraseVerticalWall</a>( iMapIndex - 1 );
<a name="l01083"></a>01083                         <a class="code" href="newsmooth_8cpp.html#df917a9847f4ef4e8c8023e2dc2ee4e7">EraseFloor</a>( iMapIndex );
<a name="l01084"></a>01084                         <a class="code" href="newsmooth_8cpp.html#7323c011de10e4227ba2bb0eb61decb2">EraseRoof</a>( iMapIndex );
<a name="l01085"></a>01085                   }
<a name="l01086"></a>01086                   <span class="keywordflow">if</span>( <a class="code" href="Sound_01Control_8cpp.html#6150e0515f7202e2fb518f7206ed97dc">x</a> &lt;= right &amp;&amp; !<a class="code" href="worlddef_8cpp.html#2b0bbb0a711487d90a4cbc59eb3135e9">FloorAtGridNo</a>( iMapIndex + 1 ) )
<a name="l01087"></a>01087                   {
<a name="l01088"></a>01088                         <a class="code" href="Smoothing_01Utils_8cpp.html#48ba11a44281b6494748d2b35425bbaf">EraseVerticalWall</a>( iMapIndex );
<a name="l01089"></a>01089                         <a class="code" href="newsmooth_8cpp.html#df917a9847f4ef4e8c8023e2dc2ee4e7">EraseFloor</a>( iMapIndex );
<a name="l01090"></a>01090                         <a class="code" href="newsmooth_8cpp.html#7323c011de10e4227ba2bb0eb61decb2">EraseRoof</a>( iMapIndex );
<a name="l01091"></a>01091                   }
<a name="l01092"></a>01092             }
<a name="l01093"></a>01093             <span class="keywordflow">else</span>  <span class="comment">//we will be building outside of this structure, so bulldoze the nature -- trees, rocks, etc.</span>
<a name="l01094"></a>01094             {
<a name="l01095"></a>01095                   <a class="code" href="newsmooth_8cpp.html#f603663531a105d18fef60a0a2f3e612">BulldozeNature</a>( iMapIndex );
<a name="l01096"></a>01096             }
<a name="l01097"></a>01097       }
<a name="l01098"></a>01098       <span class="comment">//3RD PASS:  Process the region, and all walls of floorless tiles are rebuilt from interior perspective.</span>
<a name="l01099"></a>01099       <span class="keywordflow">for</span>( y = <a class="code" href="Editor_01Undo_8cpp.html#7c94d45f9da71d3f628ba77b870f39fb">top</a>; y &lt;= bottom; y++ ) <span class="keywordflow">for</span>( <a class="code" href="Sound_01Control_8cpp.html#6150e0515f7202e2fb518f7206ed97dc">x</a> = left; <a class="code" href="Sound_01Control_8cpp.html#6150e0515f7202e2fb518f7206ed97dc">x</a> &lt;= right; <a class="code" href="Sound_01Control_8cpp.html#6150e0515f7202e2fb518f7206ed97dc">x</a>++ )
<a name="l01100"></a>01100       {
<a name="l01101"></a>01101             iMapIndex = y * WORLD_COLS + <a class="code" href="Sound_01Control_8cpp.html#6150e0515f7202e2fb518f7206ed97dc">x</a>;
<a name="l01102"></a>01102             <span class="keywordflow">if</span>( !<a class="code" href="worlddef_8cpp.html#2b0bbb0a711487d90a4cbc59eb3135e9">FloorAtGridNo</a>( iMapIndex ) ) 
<a name="l01103"></a>01103             {
<a name="l01104"></a>01104                   <span class="keywordflow">if</span>( y == <a class="code" href="Editor_01Undo_8cpp.html#7c94d45f9da71d3f628ba77b870f39fb">top</a> &amp;&amp; !<a class="code" href="Smoothing_01Utils_8cpp.html#5d6ebbdb7c42ccf67514e2c8182508ac">GetHorizontalWall</a>( iMapIndex - WORLD_COLS ) )
<a name="l01105"></a>01105                   {
<a name="l01106"></a>01106                         fFloor = <a class="code" href="worlddef_8cpp.html#2b0bbb0a711487d90a4cbc59eb3135e9">FloorAtGridNo</a>( iMapIndex - WORLD_COLS );
<a name="l01107"></a>01107                         <span class="keywordflow">if</span>( gfBasement == fFloor )
<a name="l01108"></a>01108                               <a class="code" href="newsmooth_8cpp.html#0787df998fca595b9ce1ec4cb93da260">BuildWallPiece</a>( iMapIndex, <a class="code" href="Smoothing_01Utils_8h.html#b48899087cc647f0f791ed0c459adc53331f938556c6a2a6f1e8a7766e9c31b9">INTERIOR_TOP</a>, usWallType);
<a name="l01109"></a>01109                   }
<a name="l01110"></a>01110                   <span class="keywordflow">if</span>( y == bottom &amp;&amp; !<a class="code" href="Smoothing_01Utils_8cpp.html#5d6ebbdb7c42ccf67514e2c8182508ac">GetHorizontalWall</a>( iMapIndex ) )
<a name="l01111"></a>01111                   {
<a name="l01112"></a>01112                         fFloor = <a class="code" href="worlddef_8cpp.html#2b0bbb0a711487d90a4cbc59eb3135e9">FloorAtGridNo</a>( iMapIndex + WORLD_COLS );
<a name="l01113"></a>01113                         <span class="keywordflow">if</span>( gfBasement == fFloor )
<a name="l01114"></a>01114                               <a class="code" href="newsmooth_8cpp.html#0787df998fca595b9ce1ec4cb93da260">BuildWallPiece</a>( iMapIndex, <a class="code" href="Smoothing_01Utils_8h.html#b48899087cc647f0f791ed0c459adc53e3f96fba94c5917b02d294414f085842">INTERIOR_BOTTOM</a>, usWallType );
<a name="l01115"></a>01115                   }
<a name="l01116"></a>01116                   <span class="keywordflow">if</span>( <a class="code" href="Sound_01Control_8cpp.html#6150e0515f7202e2fb518f7206ed97dc">x</a> == left &amp;&amp; !<a class="code" href="Smoothing_01Utils_8cpp.html#b67373a18a820e211a4a7b74c497bc63">GetVerticalWall</a>( iMapIndex - 1 ) )
<a name="l01117"></a>01117                   {
<a name="l01118"></a>01118                         fFloor = <a class="code" href="worlddef_8cpp.html#2b0bbb0a711487d90a4cbc59eb3135e9">FloorAtGridNo</a>( iMapIndex - 1 );
<a name="l01119"></a>01119                         <span class="keywordflow">if</span>( gfBasement == fFloor )
<a name="l01120"></a>01120                               <a class="code" href="newsmooth_8cpp.html#0787df998fca595b9ce1ec4cb93da260">BuildWallPiece</a>( iMapIndex, <a class="code" href="Smoothing_01Utils_8h.html#b48899087cc647f0f791ed0c459adc5376f4595378482c64a3aaef23e6ea2ee5">INTERIOR_LEFT</a>, usWallType );
<a name="l01121"></a>01121                   }
<a name="l01122"></a>01122                   <span class="keywordflow">if</span>( <a class="code" href="Sound_01Control_8cpp.html#6150e0515f7202e2fb518f7206ed97dc">x</a> == right &amp;&amp; !<a class="code" href="Smoothing_01Utils_8cpp.html#b67373a18a820e211a4a7b74c497bc63">GetVerticalWall</a>( iMapIndex ) )
<a name="l01123"></a>01123                   {
<a name="l01124"></a>01124                         fFloor = <a class="code" href="worlddef_8cpp.html#2b0bbb0a711487d90a4cbc59eb3135e9">FloorAtGridNo</a>( iMapIndex + 1 );
<a name="l01125"></a>01125                         <span class="keywordflow">if</span>( gfBasement == fFloor )
<a name="l01126"></a>01126                               <a class="code" href="newsmooth_8cpp.html#0787df998fca595b9ce1ec4cb93da260">BuildWallPiece</a>( iMapIndex, <a class="code" href="Smoothing_01Utils_8h.html#b48899087cc647f0f791ed0c459adc53f16f1be3af82db6056b6e11253cac21c">INTERIOR_RIGHT</a>, usWallType );
<a name="l01127"></a>01127                   }
<a name="l01128"></a>01128             }
<a name="l01129"></a>01129       }
<a name="l01130"></a>01130 
<a name="l01131"></a>01131       <span class="comment">//If we are dealing with slant roofs then build the whole thing now.</span>
<a name="l01132"></a>01132       <span class="comment">//Slant roofs always have a width or height of 8 tiles.</span>
<a name="l01133"></a>01133       <span class="keywordflow">if</span>( fSlantRoof )
<a name="l01134"></a>01134       {
<a name="l01135"></a>01135             fVertical = (bottom - <a class="code" href="Editor_01Undo_8cpp.html#7c94d45f9da71d3f628ba77b870f39fb">top</a> == 7) ? FALSE : TRUE;
<a name="l01136"></a>01136             <a class="code" href="newsmooth_8cpp.html#a401a45a362fc6fd2203d1a6896cb6bb">BuildSlantRoof</a>( left, <a class="code" href="Editor_01Undo_8cpp.html#7c94d45f9da71d3f628ba77b870f39fb">top</a>, right, bottom, usWallType, usRoofType, fVertical ); 
<a name="l01137"></a>01137       }
<a name="l01138"></a>01138 
<a name="l01139"></a>01139       <span class="comment">//4TH PASS:  Process the region, and all floorless tiles get new roofs and floors.</span>
<a name="l01140"></a>01140       <span class="keywordflow">for</span>( y = <a class="code" href="Editor_01Undo_8cpp.html#7c94d45f9da71d3f628ba77b870f39fb">top</a>; y &lt;= bottom; y++ ) <span class="keywordflow">for</span>( <a class="code" href="Sound_01Control_8cpp.html#6150e0515f7202e2fb518f7206ed97dc">x</a> = left; <a class="code" href="Sound_01Control_8cpp.html#6150e0515f7202e2fb518f7206ed97dc">x</a> &lt;= right; <a class="code" href="Sound_01Control_8cpp.html#6150e0515f7202e2fb518f7206ed97dc">x</a>++ )
<a name="l01141"></a>01141       {
<a name="l01142"></a>01142             iMapIndex = y * WORLD_COLS + <a class="code" href="Sound_01Control_8cpp.html#6150e0515f7202e2fb518f7206ed97dc">x</a>;
<a name="l01143"></a>01143             <span class="keywordflow">if</span>( !<a class="code" href="worlddef_8cpp.html#2b0bbb0a711487d90a4cbc59eb3135e9">FloorAtGridNo</a>( iMapIndex ) ) 
<a name="l01144"></a>01144             {
<a name="l01145"></a>01145                   <span class="keywordflow">if</span>( !fSlantRoof )
<a name="l01146"></a>01146                         <a class="code" href="newsmooth_8cpp.html#9a728ec9c5cac6997770f83001ecf5f9">RebuildRoof</a>( iMapIndex, usRoofType );
<a name="l01147"></a>01147                   <span class="keywordflow">if</span>( usFloorType != 0xffff &amp;&amp; !gfBasement )
<a name="l01148"></a>01148                   {
<a name="l01149"></a>01149                         <a class="code" href="tiledef_8cpp.html#88fb4209f479cf8705b24390553f0e16">GetTileIndexFromTypeSubIndex</a>( usFloorType, 1, &amp;usTileIndex );
<a name="l01150"></a>01150                         <a class="code" href="worldman_8cpp.html#205ed9951af6dabc1c5e857689628cd9">AddLandToHead</a>( iMapIndex, (<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>)( usTileIndex + <a class="code" href="Random_8cpp.html#49f938d1313ab6ef09ac6223a16ac334">Random</a>( FLOOR_VARIANTS ) ) );
<a name="l01151"></a>01151                   }
<a name="l01152"></a>01152             }
<a name="l01153"></a>01153       }
<a name="l01154"></a>01154 }
<a name="l01155"></a>01155 
<a name="l01156"></a><a class="code" href="newsmooth_8h.html#8d8287a8635360e26e91ff7ef95f1984">01156</a> <span class="keywordtype">void</span> <a class="code" href="newsmooth_8cpp.html#8d8287a8635360e26e91ff7ef95f1984">AnalyseCaveMapForStructureInfo</a>()
<a name="l01157"></a>01157 {
<a name="l01158"></a>01158       <a class="code" href="structTAG__level__node.html">LEVELNODE</a> *pStruct;
<a name="l01159"></a>01159       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiTileType;
<a name="l01160"></a>01160       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iMapIndex;
<a name="l01161"></a>01161       <span class="keywordflow">for</span>( iMapIndex = 0; iMapIndex &lt; WORLD_MAX; iMapIndex++ )
<a name="l01162"></a>01162       {
<a name="l01163"></a>01163             pStruct = <a class="code" href="worlddef_8cpp.html#a1c640bcf89772795e6517da9963e0d7">gpWorldLevelData</a>[ iMapIndex ].pStructHead;
<a name="l01164"></a>01164             <span class="keywordflow">while</span>( pStruct )
<a name="l01165"></a>01165             {
<a name="l01166"></a>01166                   <span class="keywordflow">if</span> ( pStruct-&gt;usIndex != NO_TILE )
<a name="l01167"></a>01167                   {
<a name="l01168"></a>01168                         <a class="code" href="tiledef_8cpp.html#997c9e24de80577e1e7bcc85f5a5b7ec">GetTileType</a>( pStruct-&gt;usIndex, &amp;uiTileType );
<a name="l01169"></a>01169                         <span class="keywordflow">if</span>( uiTileType == <a class="code" href="TileDat_8h.html#6a650646c036f06b5166f92a83f79748562c9c35be47be8af96e1ec9a898513c">FIRSTWALL</a> )
<a name="l01170"></a>01170                         {
<a name="l01171"></a>01171                               <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usSubIndex;
<a name="l01172"></a>01172                               <a class="code" href="tiledef_8cpp.html#70b2dc1cf7d8a17a865955e1937f2345">GetSubIndexFromTileIndex</a>( pStruct-&gt;usIndex, &amp;usSubIndex );
<a name="l01173"></a>01173                               <span class="keywordflow">if</span>( usSubIndex &gt;= 60 &amp;&amp; usSubIndex &lt;= 65 )
<a name="l01174"></a>01174                               {
<a name="l01175"></a>01175                                     pStruct-&gt;uiFlags |= LEVELNODE_CAVE;
<a name="l01176"></a>01176                               }
<a name="l01177"></a>01177                         }
<a name="l01178"></a>01178                   }
<a name="l01179"></a>01179                   pStruct = pStruct-&gt;pNext;
<a name="l01180"></a>01180             }
<a name="l01181"></a>01181       }
<a name="l01182"></a>01182 }
<a name="l01183"></a>01183 
<a name="l01184"></a>01184 <span class="preprocessor">#endif</span>
<a name="l01185"></a>01185 <span class="preprocessor"></span>
<a name="l01186"></a>01186 
<a name="l01187"></a>01187 
<a name="l01188"></a>01188  
<a name="l01189"></a>01189 
<a name="l01190"></a>01190 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sat Sep 9 13:48:40 2006 for Build by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
