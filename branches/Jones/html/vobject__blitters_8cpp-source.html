<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Build: vobject_blitters.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="classes.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir_3179ea33d55a76dc38212d9eab798728.html">export</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_e5664b4b56927c8728eb3192fa60e338.html">hdc2</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_1eb12a41a47efb9efcd82fa98f4f4dbd.html">FTP</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_80cc1f21a78ab7941088ea567f236150.html">ja2src</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_994ab287602efefceafe55287a3657d6.html">Build</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_c6629bd0d26b7dbd823904aeb42208ed.html">Standard Gaming Platform</a></div>
<h1>vobject_blitters.cpp</h1><a href="vobject__blitters_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#ifdef JA2_PRECOMPILED_HEADERS</span>
<a name="l00002"></a>00002 <span class="preprocessor"></span><span class="preprocessor">      #include "JA2 SGP ALL.H"</span>
<a name="l00003"></a>00003 <span class="preprocessor">#elif defined( WIZ8_PRECOMPILED_HEADERS )</span>
<a name="l00004"></a>00004 <span class="preprocessor"></span><span class="preprocessor">      #include "WIZ8 SGP ALL.H"</span>
<a name="l00005"></a>00005 <span class="preprocessor">#else</span>
<a name="l00006"></a>00006 <span class="preprocessor"></span><span class="preprocessor">      #include "<a class="code" href="DirectDraw_01Calls_8h.html">DirectDraw Calls.h</a>"</span>
<a name="l00007"></a>00007 <span class="preprocessor">      #include &lt;stdio.h&gt;</span>
<a name="l00008"></a>00008 <span class="preprocessor">      #include "debug.h"</span>
<a name="l00009"></a>00009 <span class="preprocessor">      #if defined( JA2 ) || defined( UTIL )</span>
<a name="l00010"></a>00010 <span class="preprocessor"></span><span class="preprocessor">            #include "<a class="code" href="video_8h.html">video.h</a>"</span>                                                                              <span class="comment">// JA2</span>
<a name="l00011"></a>00011 <span class="preprocessor">      #else</span>
<a name="l00012"></a>00012 <span class="preprocessor"></span><span class="preprocessor">            #include "video2.h"</span>                       <span class="comment">// Wiz8</span>
<a name="l00013"></a>00013 <span class="preprocessor">      #endif</span>
<a name="l00014"></a>00014 <span class="preprocessor"></span><span class="preprocessor">      #include "<a class="code" href="himage_8h.html">himage.h</a>"</span>
<a name="l00015"></a>00015 <span class="preprocessor">      #include "<a class="code" href="vobject_8h.html">vobject.h</a>"</span>
<a name="l00016"></a>00016 <span class="preprocessor">      #include "<a class="code" href="vobject__private_8h.html">vobject_private.h</a>"</span>
<a name="l00017"></a>00017 <span class="preprocessor">      #include "<a class="code" href="video__private_8h.html">video_private.h</a>"</span>
<a name="l00018"></a>00018 <span class="preprocessor">      #include "wcheck.h"</span>
<a name="l00019"></a>00019 <span class="preprocessor">      #include "<a class="code" href="vobject_8h.html">vobject.h</a>"</span>
<a name="l00020"></a>00020 <span class="preprocessor">      #include "<a class="code" href="vobject__blitters_8h.html">vobject_blitters.h</a>"</span>
<a name="l00021"></a>00021 <span class="preprocessor">      #include "<a class="code" href="shading_8h.html">shading.h</a>"</span>
<a name="l00022"></a>00022 <span class="preprocessor">#endif</span>
<a name="l00023"></a>00023 <span class="preprocessor"></span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="comment">/*    Here are bliting functions. If you dont know what kind of functions they are so :</span>
<a name="l00026"></a>00026 <span class="comment"> *  correct me if im wrong they copy array of bits from src image to dest image</span>
<a name="l00027"></a>00027 <span class="comment"> *  maby we can get ride this includes above? we dont need theme here i thinks so</span>
<a name="l00028"></a>00028 <span class="comment"> *  any questions? joker</span>
<a name="l00029"></a>00029 <span class="comment"> */</span>
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 <span class="comment">/*  ClipingRect was declared here with static initializer </span>
<a name="l00032"></a>00032 <span class="comment"> *  We need to change that and initialize it in run-time</span>
<a name="l00033"></a>00033 <span class="comment"> *  any questions? joker</span>
<a name="l00034"></a>00034 <span class="comment"> */</span>
<a name="l00035"></a>00035 
<a name="l00036"></a><a class="code" href="vobject__blitters_8h.html#880a4a0e053285be78f868d0e8b7a101">00036</a> <a class="code" href="structSGPRect.html">SGPRect</a>     <a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>;
<a name="l00037"></a>00037                                                                               
<a name="l00038"></a><a class="code" href="vobject__blitters_8h.html#bf24fc3348d453dcdc6063f5c62b2468">00038</a> <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>      <a class="code" href="vobject__blitters_8cpp.html#bf24fc3348d453dcdc6063f5c62b2468">guiTranslucentMask</a>=0x3def; <span class="comment">//0x7bef;            // mask for halving 5,6,5</span>
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 <span class="comment">// GLOBALS for pre-calculating skip values</span>
<a name="l00041"></a><a class="code" href="vobject__blitters_8cpp.html#6962546a67abac08ad7524bb6b172f5c">00041</a> <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>       <a class="code" href="vobject__blitters_8cpp.html#76a2f0aadb5a7f4e9d9e9df1d6bdea0b">gLeftSkip</a>, <a class="code" href="vobject__blitters_8cpp.html#032002a0b234e0864f34fff123d5da8a">gRightSkip</a>, <a class="code" href="vobject__blitters_8cpp.html#6962546a67abac08ad7524bb6b172f5c">gTopSkip</a>, <a class="code" href="vobject__blitters_8cpp.html#3e6c3b744060355ea9244b358f00c109">gBottomSkip</a>;
<a name="l00042"></a><a class="code" href="vobject__blitters_8cpp.html#a8801855d8661dd550fee4f76752746f">00042</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a>     <a class="code" href="vobject__blitters_8cpp.html#a8801855d8661dd550fee4f76752746f">gfUsePreCalcSkips</a> = FALSE;
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 
<a name="l00045"></a>00045 <span class="comment">//*Experimental**********************************************************************</span>
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="comment">/**********************************************************************************************</span>
<a name="l00048"></a>00048 <span class="comment"> Blt16BPPDataTo16BPPBufferTransZClip</span>
<a name="l00049"></a>00049 <span class="comment"></span>
<a name="l00050"></a>00050 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l00051"></a>00051 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l00052"></a>00052 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on, and the Z value is</span>
<a name="l00053"></a>00053 <span class="comment">      updated to the current value, for any non-transparent pixels. The Z-buffer is 16 bit, and</span>
<a name="l00054"></a>00054 <span class="comment">      must be the same dimensions (including Pitch) as the destination.</span>
<a name="l00055"></a>00055 <span class="comment"></span>
<a name="l00056"></a>00056 <span class="comment">**********************************************************************************************/</span>
<a name="l00057"></a><a class="code" href="vobject__blitters_8h.html#c5fc15d48fdffa120910853176285c5c">00057</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#c5fc15d48fdffa120910853176285c5c">Blt16BPPDataTo16BPPBufferTransZClip</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="structSGPRect.html">SGPRect</a> *clipregion)
<a name="l00058"></a>00058 {
<a name="l00059"></a>00059 <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>            *p16BPPPalette;
<a name="l00060"></a>00060 <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>            uiOffset;
<a name="l00061"></a>00061 <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>            usHeight, usWidth, Unblitted;
<a name="l00062"></a>00062 <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>       *SrcPtr, *DestPtr, *ZPtr;
<a name="l00063"></a>00063 <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>            LineSkip;
<a name="l00064"></a>00064 <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l00065"></a>00065 <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>       iTempX, iTempY, LeftSkip, RightSkip, TopSkip, BottomSkip, BlitLength, BlitHeight, LSCount;
<a name="l00066"></a>00066 <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>       ClipX1, ClipY1, ClipX2, ClipY2;
<a name="l00067"></a>00067 
<a name="l00068"></a>00068       <span class="comment">// Assertions</span>
<a name="l00069"></a>00069       Assert( hSrcVObject != NULL );
<a name="l00070"></a>00070       Assert( pBuffer != NULL );
<a name="l00071"></a>00071 
<a name="l00072"></a>00072       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l00073"></a>00073       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l00074"></a>00074       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l00075"></a>00075       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l00076"></a>00076       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l00077"></a>00077 
<a name="l00078"></a>00078       <span class="comment">// Add to start position of dest buffer</span>
<a name="l00079"></a>00079       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l00080"></a>00080       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l00081"></a>00081 
<a name="l00082"></a>00082       <span class="keywordflow">if</span>(clipregion==NULL)
<a name="l00083"></a>00083       {
<a name="l00084"></a>00084             ClipX1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l00085"></a>00085             ClipY1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l00086"></a>00086             ClipX2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l00087"></a>00087             ClipY2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l00088"></a>00088       }
<a name="l00089"></a>00089       <span class="keywordflow">else</span>
<a name="l00090"></a>00090       {
<a name="l00091"></a>00091             ClipX1=clipregion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l00092"></a>00092             ClipY1=clipregion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l00093"></a>00093             ClipX2=clipregion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l00094"></a>00094             ClipY2=clipregion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l00095"></a>00095       }
<a name="l00096"></a>00096 
<a name="l00097"></a>00097       <span class="comment">// Calculate rows hanging off each side of the screen</span>
<a name="l00098"></a>00098       LeftSkip=__min(ClipX1 - min(ClipX1, iTempX), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l00099"></a>00099       RightSkip=__min(max(ClipX2, (iTempX+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth)) - ClipX2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l00100"></a>00100       TopSkip=__min(ClipY1 - __min(ClipY1, iTempY), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l00101"></a>00101       BottomSkip=__min(__max(ClipY2, (iTempY+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight)) - ClipY2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l00102"></a>00102 
<a name="l00103"></a>00103       <span class="comment">// calculate the remaining rows and columns to blit</span>
<a name="l00104"></a>00104       BlitLength=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth-LeftSkip-RightSkip);
<a name="l00105"></a>00105       BlitHeight=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight-TopSkip-BottomSkip);
<a name="l00106"></a>00106 
<a name="l00107"></a>00107       <span class="comment">// check if whole thing is clipped</span>
<a name="l00108"></a>00108       <span class="keywordflow">if</span>((LeftSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth) || (RightSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth))
<a name="l00109"></a>00109             <span class="keywordflow">return</span>(TRUE);
<a name="l00110"></a>00110 
<a name="l00111"></a>00111       <span class="comment">// check if whole thing is clipped</span>
<a name="l00112"></a>00112       <span class="keywordflow">if</span>((TopSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight) || (BottomSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight))
<a name="l00113"></a>00113             <span class="keywordflow">return</span>(TRUE);
<a name="l00114"></a>00114 
<a name="l00115"></a>00115       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l00116"></a>00116       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l00117"></a>00117       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l00118"></a>00118       p16BPPPalette = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#930609ad8d5cdbb05449df70bd83cfcd">pShadeCurrent</a>;
<a name="l00119"></a>00119       LineSkip=(uiDestPitchBYTES-(BlitLength*2));
<a name="l00120"></a>00120 
<a name="l00121"></a>00121       __asm {
<a name="l00122"></a>00122 
<a name="l00123"></a>00123             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l00124"></a>00124             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l00125"></a>00125             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, p16BPPPalette
<a name="l00126"></a>00126             xor         eax, eax
<a name="l00127"></a>00127             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l00128"></a>00128             xor         ecx, ecx
<a name="l00129"></a>00129 
<a name="l00130"></a>00130             cmp         TopSkip, 0                                      <span class="comment">// check for nothing clipped on top</span>
<a name="l00131"></a>00131             je          LeftSkipSetup
<a name="l00132"></a>00132 
<a name="l00133"></a>00133 TopSkipLoop:                                                            <span class="comment">// Skips the number of lines clipped at the top</span>
<a name="l00134"></a>00134 
<a name="l00135"></a>00135             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l00136"></a>00136             inc         esi
<a name="l00137"></a>00137             or          cl, cl
<a name="l00138"></a>00138             js          TopSkipLoop
<a name="l00139"></a>00139             jz          TSEndLine
<a name="l00140"></a>00140 
<a name="l00141"></a>00141             add         esi, ecx
<a name="l00142"></a>00142             add         esi, ecx
<a name="l00143"></a>00143             jmp         TopSkipLoop
<a name="l00144"></a>00144 
<a name="l00145"></a>00145 TSEndLine:
<a name="l00146"></a>00146             dec         TopSkip
<a name="l00147"></a>00147             jnz         TopSkipLoop
<a name="l00148"></a>00148 
<a name="l00149"></a>00149 LeftSkipSetup:
<a name="l00150"></a>00150 
<a name="l00151"></a>00151             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l00152"></a>00152             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, LeftSkip
<a name="l00153"></a>00153             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l00154"></a>00154             or          eax, eax
<a name="l00155"></a>00155             jz          BlitLineSetup
<a name="l00156"></a>00156 
<a name="l00157"></a>00157 LeftSkipLoop:
<a name="l00158"></a>00158 
<a name="l00159"></a>00159             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l00160"></a>00160             inc         esi
<a name="l00161"></a>00161 
<a name="l00162"></a>00162             or          cl, cl
<a name="l00163"></a>00163             js          LSTrans
<a name="l00164"></a>00164 
<a name="l00165"></a>00165             cmp         ecx, LSCount
<a name="l00166"></a>00166             je          LSSkip2                                               <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l00167"></a>00167             jb          LSSkip1                                               <span class="comment">// if less, skip whole thing</span>
<a name="l00168"></a>00168 
<a name="l00169"></a>00169             add         esi, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l00170"></a>00170             add         esi, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l00171"></a>00171             sub         ecx, LSCount
<a name="l00172"></a>00172             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l00173"></a>00173             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l00174"></a>00174             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l00175"></a>00175             jmp         BlitNonTransLoop
<a name="l00176"></a>00176 
<a name="l00177"></a>00177 LSSkip2:
<a name="l00178"></a>00178             add         esi, ecx                                        <span class="comment">// skip whole run, and start blit with new run</span>
<a name="l00179"></a>00179             add         esi, ecx                                        <span class="comment">// skip whole run, and start blit with new run</span>
<a name="l00180"></a>00180             jmp         BlitLineSetup
<a name="l00181"></a>00181 
<a name="l00182"></a>00182 
<a name="l00183"></a>00183 LSSkip1:
<a name="l00184"></a>00184             add         esi, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l00185"></a>00185             add         esi, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l00186"></a>00186             sub         LSCount, ecx
<a name="l00187"></a>00187             jmp         LeftSkipLoop
<a name="l00188"></a>00188 
<a name="l00189"></a>00189 
<a name="l00190"></a>00190 LSTrans:
<a name="l00191"></a>00191             and         ecx, 07fH
<a name="l00192"></a>00192             cmp         ecx, LSCount
<a name="l00193"></a>00193             je          BlitLineSetup                             <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l00194"></a>00194             jb          LSTrans1                                        <span class="comment">// if less, skip whole thing</span>
<a name="l00195"></a>00195 
<a name="l00196"></a>00196             sub         ecx, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l00197"></a>00197             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l00198"></a>00198             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l00199"></a>00199             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l00200"></a>00200             jmp         BlitTransparent
<a name="l00201"></a>00201 
<a name="l00202"></a>00202 
<a name="l00203"></a>00203 LSTrans1:
<a name="l00204"></a>00204             sub         LSCount, ecx                                          <span class="comment">// skip whole run, continue skipping</span>
<a name="l00205"></a>00205             jmp         LeftSkipLoop
<a name="l00206"></a>00206 
<a name="l00207"></a>00207 
<a name="l00208"></a>00208 BlitLineSetup:                                                    <span class="comment">// Does any actual blitting (trans/non) for the line</span>
<a name="l00209"></a>00209             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l00210"></a>00210             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l00211"></a>00211             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l00212"></a>00212 
<a name="l00213"></a>00213 BlitDispatch:
<a name="l00214"></a>00214 
<a name="l00215"></a>00215             cmp         LSCount, 0                                      <span class="comment">// Check to see if we're done blitting</span>
<a name="l00216"></a>00216             je          RightSkipLoop
<a name="l00217"></a>00217 
<a name="l00218"></a>00218             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l00219"></a>00219             inc         esi
<a name="l00220"></a>00220             or          cl, cl
<a name="l00221"></a>00221             js          BlitTransparent
<a name="l00222"></a>00222 
<a name="l00223"></a>00223 BlitNonTransLoop:                                           <span class="comment">// blit non-transparent pixels</span>
<a name="l00224"></a>00224 
<a name="l00225"></a>00225             cmp         ecx, LSCount
<a name="l00226"></a>00226             jbe         BNTrans1
<a name="l00227"></a>00227 
<a name="l00228"></a>00228             sub         ecx, LSCount
<a name="l00229"></a>00229             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, ecx
<a name="l00230"></a>00230             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, LSCount
<a name="l00231"></a>00231 
<a name="l00232"></a>00232 BNTrans1:
<a name="l00233"></a>00233             sub         LSCount, ecx
<a name="l00234"></a>00234 
<a name="l00235"></a>00235 BlitNTL1:
<a name="l00236"></a>00236 
<a name="l00237"></a>00237             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l00238"></a>00238             cmp         ax, usZValue
<a name="l00239"></a>00239             ja          BlitNTL2
<a name="l00240"></a>00240 
<a name="l00241"></a>00241             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, usZValue
<a name="l00242"></a>00242             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [ebx], ax
<a name="l00243"></a>00243 
<a name="l00244"></a>00244             xor         eax, eax
<a name="l00245"></a>00245 
<a name="l00246"></a>00246             mov         ax, [esi]
<a name="l00247"></a>00247             mov         [edi], ax
<a name="l00248"></a>00248 
<a name="l00249"></a>00249 BlitNTL2:
<a name="l00250"></a>00250             add         esi, 2
<a name="l00251"></a>00251             add         edi, 2
<a name="l00252"></a>00252             add         ebx, 2
<a name="l00253"></a>00253             dec         cl
<a name="l00254"></a>00254             jnz         BlitNTL1
<a name="l00255"></a>00255 
<a name="l00256"></a>00256 <span class="comment">//BlitLineEnd:</span>
<a name="l00257"></a>00257             add         esi, Unblitted
<a name="l00258"></a>00258             add         esi, Unblitted
<a name="l00259"></a>00259             jmp         BlitDispatch
<a name="l00260"></a>00260 
<a name="l00261"></a>00261 BlitTransparent:                                                              <span class="comment">// skip transparent pixels</span>
<a name="l00262"></a>00262 
<a name="l00263"></a>00263             and         ecx, 07fH
<a name="l00264"></a>00264             cmp         ecx, LSCount
<a name="l00265"></a>00265             jbe         BTrans1
<a name="l00266"></a>00266 
<a name="l00267"></a>00267             mov         ecx, LSCount
<a name="l00268"></a>00268 
<a name="l00269"></a>00269 BTrans1:
<a name="l00270"></a>00270 
<a name="l00271"></a>00271             sub         LSCount, ecx
<a name="l00272"></a>00272 <span class="comment">//          shl         ecx, 1</span>
<a name="l00273"></a>00273             add   ecx, ecx
<a name="l00274"></a>00274             add         edi, ecx
<a name="l00275"></a>00275             add         ebx, ecx
<a name="l00276"></a>00276             jmp         BlitDispatch
<a name="l00277"></a>00277 
<a name="l00278"></a>00278 
<a name="l00279"></a>00279 RightSkipLoop:                                                                      <span class="comment">// skip along until we hit and end-of-line marker</span>
<a name="l00280"></a>00280 
<a name="l00281"></a>00281             xor         eax, eax
<a name="l00282"></a>00282 
<a name="l00283"></a>00283 RSLoop1:
<a name="l00284"></a>00284             mov         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l00285"></a>00285             inc         esi
<a name="l00286"></a>00286             or          al, al
<a name="l00287"></a>00287             js          RSLoop1
<a name="l00288"></a>00288             jz          RSEnd
<a name="l00289"></a>00289 
<a name="l00290"></a>00290             add         esi, eax
<a name="l00291"></a>00291             add         esi, eax
<a name="l00292"></a>00292             jmp         RSLoop1
<a name="l00293"></a>00293 
<a name="l00294"></a>00294 RSEnd:
<a name="l00295"></a>00295             dec         BlitHeight
<a name="l00296"></a>00296             jz          BlitDone
<a name="l00297"></a>00297             add         edi, LineSkip
<a name="l00298"></a>00298             add         ebx, LineSkip
<a name="l00299"></a>00299 
<a name="l00300"></a>00300             jmp         LeftSkipSetup
<a name="l00301"></a>00301 
<a name="l00302"></a>00302 
<a name="l00303"></a>00303 BlitDone:
<a name="l00304"></a>00304       }
<a name="l00305"></a>00305 
<a name="l00306"></a>00306       <span class="keywordflow">return</span>(TRUE);
<a name="l00307"></a>00307 
<a name="l00308"></a>00308 }
<a name="l00309"></a>00309 
<a name="l00310"></a>00310 <span class="comment">/**********************************************************************************************</span>
<a name="l00311"></a>00311 <span class="comment"> Blt16BPPDataTo16BPPBufferTransparentClip</span>
<a name="l00312"></a>00312 <span class="comment"></span>
<a name="l00313"></a>00313 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l00314"></a>00314 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l00315"></a>00315 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on, and the Z value is</span>
<a name="l00316"></a>00316 <span class="comment">      updated to the current value, for any non-transparent pixels. The Z-buffer is 16 bit, and</span>
<a name="l00317"></a>00317 <span class="comment">      must be the same dimensions (including Pitch) as the destination.</span>
<a name="l00318"></a>00318 <span class="comment"></span>
<a name="l00319"></a>00319 <span class="comment">**********************************************************************************************/</span>
<a name="l00320"></a><a class="code" href="vobject__blitters_8h.html#66ebc36ad57556456dbc9bd899363676">00320</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#66ebc36ad57556456dbc9bd899363676">Blt16BPPDataTo16BPPBufferTransparentClip</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="structSGPRect.html">SGPRect</a> *clipregion)
<a name="l00321"></a>00321 {
<a name="l00322"></a>00322 <span class="comment">//UINT16          *p16BPPPalette;</span>
<a name="l00323"></a>00323 <span class="comment">//UINT32          uiOffset;</span>
<a name="l00324"></a>00324 <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>            usHeight, usWidth, Unblitted;
<a name="l00325"></a>00325 <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>       *SrcPtr, *DestPtr;
<a name="l00326"></a>00326 <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>            LineSkip;
<a name="l00327"></a>00327 <span class="comment">//ETRLEObject *pTrav;</span>
<a name="l00328"></a>00328 <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>       iTempX, iTempY, LeftSkip, RightSkip, TopSkip, BottomSkip, BlitLength, BlitHeight, LSCount;
<a name="l00329"></a>00329 <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>       ClipX1, ClipY1, ClipX2, ClipY2;
<a name="l00330"></a>00330 <a class="code" href="structSixteenBPPObjectInfo.html">SixteenBPPObjectInfo</a> *  p16BPPObject;
<a name="l00331"></a>00331 
<a name="l00332"></a>00332       <span class="comment">// Assertions</span>
<a name="l00333"></a>00333       Assert( hSrcVObject != NULL );
<a name="l00334"></a>00334       Assert( pBuffer != NULL );
<a name="l00335"></a>00335 
<a name="l00336"></a>00336       p16BPPObject=&amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#544a526e4b498cdc5947a18a999500d0">p16BPPObject</a>[usIndex]);
<a name="l00337"></a>00337 
<a name="l00338"></a>00338       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l00339"></a>00339       usHeight                      = p16BPPObject-&gt;<a class="code" href="structSixteenBPPObjectInfo.html#79b723c68c82a93aae7e85222c31909f">usHeight</a>;
<a name="l00340"></a>00340       usWidth                             = p16BPPObject-&gt;<a class="code" href="structSixteenBPPObjectInfo.html#e920abe3d250a13b47be759477924f5a">usWidth</a>;
<a name="l00341"></a>00341 
<a name="l00342"></a>00342       <span class="comment">// Add to start position of dest buffer</span>
<a name="l00343"></a>00343       iTempX = iX + p16BPPObject-&gt;<a class="code" href="structSixteenBPPObjectInfo.html#036e6ed152758624499064ed60437db7">sOffsetX</a>;
<a name="l00344"></a>00344       iTempY = iY + p16BPPObject-&gt;<a class="code" href="structSixteenBPPObjectInfo.html#42575b48584565febf402d336d5a15fb">sOffsetY</a>;
<a name="l00345"></a>00345 
<a name="l00346"></a>00346       <span class="keywordflow">if</span>(clipregion==NULL)
<a name="l00347"></a>00347       {
<a name="l00348"></a>00348             ClipX1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l00349"></a>00349             ClipY1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l00350"></a>00350             ClipX2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l00351"></a>00351             ClipY2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l00352"></a>00352       }
<a name="l00353"></a>00353       <span class="keywordflow">else</span>
<a name="l00354"></a>00354       {
<a name="l00355"></a>00355             ClipX1=clipregion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l00356"></a>00356             ClipY1=clipregion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l00357"></a>00357             ClipX2=clipregion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l00358"></a>00358             ClipY2=clipregion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l00359"></a>00359       }
<a name="l00360"></a>00360 
<a name="l00361"></a>00361       <span class="keywordflow">if</span> ( <a class="code" href="vobject__blitters_8cpp.html#a8801855d8661dd550fee4f76752746f">gfUsePreCalcSkips</a> )
<a name="l00362"></a>00362       {
<a name="l00363"></a>00363             LeftSkip= <a class="code" href="vobject__blitters_8cpp.html#76a2f0aadb5a7f4e9d9e9df1d6bdea0b">gLeftSkip</a>;
<a name="l00364"></a>00364             RightSkip= <a class="code" href="vobject__blitters_8cpp.html#032002a0b234e0864f34fff123d5da8a">gRightSkip</a>;
<a name="l00365"></a>00365             TopSkip= <a class="code" href="vobject__blitters_8cpp.html#6962546a67abac08ad7524bb6b172f5c">gTopSkip</a>;
<a name="l00366"></a>00366             BottomSkip= <a class="code" href="vobject__blitters_8cpp.html#3e6c3b744060355ea9244b358f00c109">gBottomSkip</a>;
<a name="l00367"></a>00367             <a class="code" href="vobject__blitters_8cpp.html#a8801855d8661dd550fee4f76752746f">gfUsePreCalcSkips</a> = FALSE;
<a name="l00368"></a>00368 
<a name="l00369"></a>00369       }
<a name="l00370"></a>00370       <span class="keywordflow">else</span>
<a name="l00371"></a>00371       {
<a name="l00372"></a>00372             <span class="comment">// Calculate rows hanging off each side of the screen</span>
<a name="l00373"></a>00373             LeftSkip=__min(ClipX1 - min(ClipX1, iTempX), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l00374"></a>00374             RightSkip=__min(max(ClipX2, (iTempX+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth)) - ClipX2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l00375"></a>00375             TopSkip=__min(ClipY1 - __min(ClipY1, iTempY), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l00376"></a>00376             BottomSkip=__min(__max(ClipY2, (iTempY+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight)) - ClipY2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l00377"></a>00377       }
<a name="l00378"></a>00378 
<a name="l00379"></a>00379       <span class="comment">// calculate the remaining rows and columns to blit</span>
<a name="l00380"></a>00380       BlitLength=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth-LeftSkip-RightSkip);
<a name="l00381"></a>00381       BlitHeight=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight-TopSkip-BottomSkip);
<a name="l00382"></a>00382 
<a name="l00383"></a>00383       <span class="comment">// check if whole thing is clipped</span>
<a name="l00384"></a>00384       <span class="keywordflow">if</span>((LeftSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth) || (RightSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth))
<a name="l00385"></a>00385             <span class="keywordflow">return</span>(TRUE);
<a name="l00386"></a>00386 
<a name="l00387"></a>00387       <span class="comment">// check if whole thing is clipped</span>
<a name="l00388"></a>00388       <span class="keywordflow">if</span>((TopSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight) || (BottomSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight))
<a name="l00389"></a>00389             <span class="keywordflow">return</span>(TRUE);
<a name="l00390"></a>00390 
<a name="l00391"></a>00391       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)p16BPPObject-&gt;<a class="code" href="structSixteenBPPObjectInfo.html#64bfb7d7153bbbc2dec38de77581c2b4">p16BPPData</a>;
<a name="l00392"></a>00392       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l00393"></a>00393       LineSkip=(uiDestPitchBYTES-(BlitLength*2));
<a name="l00394"></a>00394 
<a name="l00395"></a>00395       __asm {
<a name="l00396"></a>00396 
<a name="l00397"></a>00397             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l00398"></a>00398             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l00399"></a>00399 <span class="comment">//          mov         edx, p16BPPPalette</span>
<a name="l00400"></a>00400             xor         eax, eax
<a name="l00401"></a>00401 <span class="comment">//          mov         ebx, ZPtr</span>
<a name="l00402"></a>00402             xor         ecx, ecx
<a name="l00403"></a>00403 
<a name="l00404"></a>00404             cmp         TopSkip, 0                                      <span class="comment">// check for nothing clipped on top</span>
<a name="l00405"></a>00405             je          LeftSkipSetup
<a name="l00406"></a>00406 
<a name="l00407"></a>00407 TopSkipLoop:                                                            <span class="comment">// Skips the number of lines clipped at the top</span>
<a name="l00408"></a>00408 
<a name="l00409"></a>00409             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l00410"></a>00410             inc         esi
<a name="l00411"></a>00411             or          cl, cl
<a name="l00412"></a>00412             js          TopSkipLoop
<a name="l00413"></a>00413             jz          TSEndLine
<a name="l00414"></a>00414 
<a name="l00415"></a>00415             add         esi, ecx
<a name="l00416"></a>00416             add         esi, ecx
<a name="l00417"></a>00417             jmp         TopSkipLoop
<a name="l00418"></a>00418 
<a name="l00419"></a>00419 TSEndLine:
<a name="l00420"></a>00420             dec         TopSkip
<a name="l00421"></a>00421             jnz         TopSkipLoop
<a name="l00422"></a>00422 
<a name="l00423"></a>00423 LeftSkipSetup:
<a name="l00424"></a>00424 
<a name="l00425"></a>00425             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l00426"></a>00426             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, LeftSkip
<a name="l00427"></a>00427             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l00428"></a>00428             or          eax, eax
<a name="l00429"></a>00429             jz          BlitLineSetup
<a name="l00430"></a>00430 
<a name="l00431"></a>00431 LeftSkipLoop:
<a name="l00432"></a>00432 
<a name="l00433"></a>00433             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l00434"></a>00434             inc         esi
<a name="l00435"></a>00435 
<a name="l00436"></a>00436             or          cl, cl
<a name="l00437"></a>00437             js          LSTrans
<a name="l00438"></a>00438 
<a name="l00439"></a>00439             cmp         ecx, LSCount
<a name="l00440"></a>00440             je          LSSkip2                                               <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l00441"></a>00441             jb          LSSkip1                                               <span class="comment">// if less, skip whole thing</span>
<a name="l00442"></a>00442 
<a name="l00443"></a>00443             add         esi, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l00444"></a>00444             add         esi, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l00445"></a>00445             sub         ecx, LSCount
<a name="l00446"></a>00446             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l00447"></a>00447             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l00448"></a>00448             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l00449"></a>00449             jmp         BlitNonTransLoop
<a name="l00450"></a>00450 
<a name="l00451"></a>00451 LSSkip2:
<a name="l00452"></a>00452             add         esi, ecx                                        <span class="comment">// skip whole run, and start blit with new run</span>
<a name="l00453"></a>00453             add         esi, ecx                                        <span class="comment">// skip whole run, and start blit with new run</span>
<a name="l00454"></a>00454             jmp         BlitLineSetup
<a name="l00455"></a>00455 
<a name="l00456"></a>00456 
<a name="l00457"></a>00457 LSSkip1:
<a name="l00458"></a>00458             add         esi, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l00459"></a>00459             add         esi, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l00460"></a>00460             sub         LSCount, ecx
<a name="l00461"></a>00461             jmp         LeftSkipLoop
<a name="l00462"></a>00462 
<a name="l00463"></a>00463 
<a name="l00464"></a>00464 LSTrans:
<a name="l00465"></a>00465             and         ecx, 07fH
<a name="l00466"></a>00466             cmp         ecx, LSCount
<a name="l00467"></a>00467             je          BlitLineSetup                             <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l00468"></a>00468             jb          LSTrans1                                        <span class="comment">// if less, skip whole thing</span>
<a name="l00469"></a>00469 
<a name="l00470"></a>00470             sub         ecx, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l00471"></a>00471             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l00472"></a>00472             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l00473"></a>00473             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l00474"></a>00474             jmp         BlitTransparent
<a name="l00475"></a>00475 
<a name="l00476"></a>00476 
<a name="l00477"></a>00477 LSTrans1:
<a name="l00478"></a>00478             sub         LSCount, ecx                                          <span class="comment">// skip whole run, continue skipping</span>
<a name="l00479"></a>00479             jmp         LeftSkipLoop
<a name="l00480"></a>00480 
<a name="l00481"></a>00481 
<a name="l00482"></a>00482 BlitLineSetup:                                                    <span class="comment">// Does any actual blitting (trans/non) for the line</span>
<a name="l00483"></a>00483             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l00484"></a>00484             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l00485"></a>00485             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l00486"></a>00486 
<a name="l00487"></a>00487 BlitDispatch:
<a name="l00488"></a>00488 
<a name="l00489"></a>00489             cmp         LSCount, 0                                      <span class="comment">// Check to see if we're done blitting</span>
<a name="l00490"></a>00490             je          RightSkipLoop
<a name="l00491"></a>00491 
<a name="l00492"></a>00492             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l00493"></a>00493             inc         esi
<a name="l00494"></a>00494             or          cl, cl
<a name="l00495"></a>00495             js          BlitTransparent
<a name="l00496"></a>00496 
<a name="l00497"></a>00497 BlitNonTransLoop:                                           <span class="comment">// blit non-transparent pixels</span>
<a name="l00498"></a>00498 
<a name="l00499"></a>00499             cmp         ecx, LSCount
<a name="l00500"></a>00500             jbe         BNTrans1
<a name="l00501"></a>00501 
<a name="l00502"></a>00502             sub         ecx, LSCount
<a name="l00503"></a>00503             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, ecx
<a name="l00504"></a>00504             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, LSCount
<a name="l00505"></a>00505 
<a name="l00506"></a>00506 BNTrans1:
<a name="l00507"></a>00507             sub         LSCount, ecx
<a name="l00508"></a>00508 
<a name="l00509"></a>00509 <span class="comment">//BlitNTL1:</span>
<a name="l00510"></a>00510 
<a name="l00511"></a>00511             rep         movsw
<a name="l00512"></a>00512 
<a name="l00513"></a>00513 <span class="comment">//BlitNTL2:</span>
<a name="l00514"></a>00514 
<a name="l00515"></a>00515 <span class="comment">//BlitLineEnd:</span>
<a name="l00516"></a>00516             add         esi, Unblitted
<a name="l00517"></a>00517             add         esi, Unblitted
<a name="l00518"></a>00518             jmp         BlitDispatch
<a name="l00519"></a>00519 
<a name="l00520"></a>00520 BlitTransparent:                                                              <span class="comment">// skip transparent pixels</span>
<a name="l00521"></a>00521 
<a name="l00522"></a>00522             and         ecx, 07fH
<a name="l00523"></a>00523             cmp         ecx, LSCount
<a name="l00524"></a>00524             jbe         BTrans1
<a name="l00525"></a>00525 
<a name="l00526"></a>00526             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, LSCount
<a name="l00527"></a>00527 
<a name="l00528"></a>00528 BTrans1:
<a name="l00529"></a>00529 
<a name="l00530"></a>00530             sub         LSCount, ecx
<a name="l00531"></a>00531 <span class="comment">//          shl         ecx, 1</span>
<a name="l00532"></a>00532             add   ecx, ecx
<a name="l00533"></a>00533             add         edi, ecx
<a name="l00534"></a>00534             add         ebx, ecx
<a name="l00535"></a>00535             jmp         BlitDispatch
<a name="l00536"></a>00536 
<a name="l00537"></a>00537 
<a name="l00538"></a>00538 RightSkipLoop:                                                                      <span class="comment">// skip along until we hit and end-of-line marker</span>
<a name="l00539"></a>00539 
<a name="l00540"></a>00540             xor         eax, eax
<a name="l00541"></a>00541 
<a name="l00542"></a>00542 RSLoop1:
<a name="l00543"></a>00543             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l00544"></a>00544             inc         esi
<a name="l00545"></a>00545             or          al, al
<a name="l00546"></a>00546             js          RSLoop1
<a name="l00547"></a>00547             jz          RSEnd
<a name="l00548"></a>00548 
<a name="l00549"></a>00549             add         esi, eax
<a name="l00550"></a>00550             add         esi, eax
<a name="l00551"></a>00551             jmp         RSLoop1
<a name="l00552"></a>00552 
<a name="l00553"></a>00553 RSEnd:
<a name="l00554"></a>00554             dec         BlitHeight
<a name="l00555"></a>00555             jz          BlitDone
<a name="l00556"></a>00556             add         edi, LineSkip
<a name="l00557"></a>00557             add         ebx, LineSkip
<a name="l00558"></a>00558 
<a name="l00559"></a>00559             jmp         LeftSkipSetup
<a name="l00560"></a>00560 
<a name="l00561"></a>00561 
<a name="l00562"></a>00562 BlitDone:
<a name="l00563"></a>00563       }
<a name="l00564"></a>00564 
<a name="l00565"></a>00565       <span class="keywordflow">return</span>(TRUE);
<a name="l00566"></a>00566 
<a name="l00567"></a>00567 }
<a name="l00568"></a>00568 
<a name="l00569"></a>00569 <span class="comment">/***********************************************************************************/</span>
<a name="l00570"></a>00570 
<a name="l00571"></a>00571 <span class="comment">/**********************************************************************************************</span>
<a name="l00572"></a>00572 <span class="comment"> Blt8BPPDataTo16BPPBufferTransZNBClipTranslucent</span>
<a name="l00573"></a>00573 <span class="comment"></span>
<a name="l00574"></a>00574 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l00575"></a>00575 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l00576"></a>00576 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on, and the Z value is</span>
<a name="l00577"></a>00577 <span class="comment">      NOT updated to the current value,   for any non-transparent pixels. The Z-buffer is 16 bit, and</span>
<a name="l00578"></a>00578 <span class="comment">      must be the same dimensions (including Pitch) as the destination.</span>
<a name="l00579"></a>00579 <span class="comment"></span>
<a name="l00580"></a>00580 <span class="comment">      Blits every second pixel ("Translucents").</span>
<a name="l00581"></a>00581 <span class="comment"></span>
<a name="l00582"></a>00582 <span class="comment">**********************************************************************************************/</span>
<a name="l00583"></a><a class="code" href="vobject__blitters_8h.html#f353f2135cb25bb9a706523148487e21">00583</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#f353f2135cb25bb9a706523148487e21">Blt8BPPDataTo16BPPBufferTransZNBClipTranslucent</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="structSGPRect.html">SGPRect</a> *clipregion)
<a name="l00584"></a>00584 {
<a name="l00585"></a>00585 <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l00586"></a>00586 <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset, uiLineFlag;
<a name="l00587"></a>00587 <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth, Unblitted;
<a name="l00588"></a>00588 <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l00589"></a>00589 <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l00590"></a>00590 <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l00591"></a>00591 <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY, LeftSkip, RightSkip, TopSkip, BottomSkip, BlitLength, BlitHeight, LSCount;
<a name="l00592"></a>00592 <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  ClipX1, ClipY1, ClipX2, ClipY2;
<a name="l00593"></a>00593 
<a name="l00594"></a>00594       <span class="comment">// Assertions</span>
<a name="l00595"></a>00595       Assert( hSrcVObject != NULL );
<a name="l00596"></a>00596       Assert( pBuffer != NULL );
<a name="l00597"></a>00597 
<a name="l00598"></a>00598       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l00599"></a>00599       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l00600"></a>00600       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l00601"></a>00601       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l00602"></a>00602       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l00603"></a>00603 
<a name="l00604"></a>00604       <span class="comment">// Add to start position of dest buffer</span>
<a name="l00605"></a>00605       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l00606"></a>00606       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l00607"></a>00607 
<a name="l00608"></a>00608       <span class="keywordflow">if</span>(clipregion==NULL)
<a name="l00609"></a>00609       {
<a name="l00610"></a>00610             ClipX1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l00611"></a>00611             ClipY1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l00612"></a>00612             ClipX2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l00613"></a>00613             ClipY2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l00614"></a>00614       }
<a name="l00615"></a>00615       <span class="keywordflow">else</span>
<a name="l00616"></a>00616       {
<a name="l00617"></a>00617             ClipX1=clipregion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l00618"></a>00618             ClipY1=clipregion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l00619"></a>00619             ClipX2=clipregion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l00620"></a>00620             ClipY2=clipregion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l00621"></a>00621       }
<a name="l00622"></a>00622 
<a name="l00623"></a>00623       <span class="comment">// Calculate rows hanging off each side of the screen</span>
<a name="l00624"></a>00624       LeftSkip=__min(ClipX1 - min(ClipX1, iTempX), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l00625"></a>00625       RightSkip=__min(max(ClipX2, (iTempX+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth)) - ClipX2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l00626"></a>00626       TopSkip=__min(ClipY1 - __min(ClipY1, iTempY), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l00627"></a>00627       BottomSkip=__min(__max(ClipY2, (iTempY+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight)) - ClipY2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l00628"></a>00628 
<a name="l00629"></a>00629       <span class="comment">// calculate the remaining rows and columns to blit</span>
<a name="l00630"></a>00630       BlitLength=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth-LeftSkip-RightSkip);
<a name="l00631"></a>00631       BlitHeight=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight-TopSkip-BottomSkip);
<a name="l00632"></a>00632 
<a name="l00633"></a>00633       <span class="comment">// check if whole thing is clipped</span>
<a name="l00634"></a>00634       <span class="keywordflow">if</span>((LeftSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth) || (RightSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth))
<a name="l00635"></a>00635             <span class="keywordflow">return</span>(TRUE);
<a name="l00636"></a>00636 
<a name="l00637"></a>00637       <span class="comment">// check if whole thing is clipped</span>
<a name="l00638"></a>00638       <span class="keywordflow">if</span>((TopSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight) || (BottomSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight))
<a name="l00639"></a>00639             <span class="keywordflow">return</span>(TRUE);
<a name="l00640"></a>00640 
<a name="l00641"></a>00641       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l00642"></a>00642       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l00643"></a>00643       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l00644"></a>00644       p16BPPPalette = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#930609ad8d5cdbb05449df70bd83cfcd">pShadeCurrent</a>;
<a name="l00645"></a>00645       LineSkip=(uiDestPitchBYTES-(BlitLength*2));
<a name="l00646"></a>00646       uiLineFlag=(iTempY&amp;1);
<a name="l00647"></a>00647 
<a name="l00648"></a>00648       __asm {
<a name="l00649"></a>00649 
<a name="l00650"></a>00650             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l00651"></a>00651             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l00652"></a>00652             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, p16BPPPalette
<a name="l00653"></a>00653             xor         eax, eax
<a name="l00654"></a>00654             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l00655"></a>00655             xor         ecx, ecx
<a name="l00656"></a>00656 
<a name="l00657"></a>00657             cmp         TopSkip, 0                                      <span class="comment">// check for nothing clipped on top</span>
<a name="l00658"></a>00658             je          LeftSkipSetup
<a name="l00659"></a>00659 
<a name="l00660"></a>00660 TopSkipLoop:                                                            <span class="comment">// Skips the number of lines clipped at the top</span>
<a name="l00661"></a>00661 
<a name="l00662"></a>00662             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l00663"></a>00663             inc         esi
<a name="l00664"></a>00664             or          cl, cl
<a name="l00665"></a>00665             js          TopSkipLoop
<a name="l00666"></a>00666             jz          TSEndLine
<a name="l00667"></a>00667 
<a name="l00668"></a>00668             add         esi, ecx
<a name="l00669"></a>00669             jmp         TopSkipLoop
<a name="l00670"></a>00670 
<a name="l00671"></a>00671 TSEndLine:
<a name="l00672"></a>00672             dec         TopSkip
<a name="l00673"></a>00673             jnz         TopSkipLoop
<a name="l00674"></a>00674 
<a name="l00675"></a>00675 LeftSkipSetup:
<a name="l00676"></a>00676 
<a name="l00677"></a>00677             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l00678"></a>00678             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, LeftSkip
<a name="l00679"></a>00679             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l00680"></a>00680             or          eax, eax
<a name="l00681"></a>00681             jz          BlitLineSetup
<a name="l00682"></a>00682 
<a name="l00683"></a>00683 LeftSkipLoop:
<a name="l00684"></a>00684 
<a name="l00685"></a>00685             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l00686"></a>00686             inc         esi
<a name="l00687"></a>00687 
<a name="l00688"></a>00688             or          cl, cl
<a name="l00689"></a>00689             js          LSTrans
<a name="l00690"></a>00690 
<a name="l00691"></a>00691             cmp         ecx, LSCount
<a name="l00692"></a>00692             je          LSSkip2                                               <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l00693"></a>00693             jb          LSSkip1                                               <span class="comment">// if less, skip whole thing</span>
<a name="l00694"></a>00694 
<a name="l00695"></a>00695             add         esi, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l00696"></a>00696             sub         ecx, LSCount
<a name="l00697"></a>00697             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l00698"></a>00698             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l00699"></a>00699             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l00700"></a>00700             jmp         BlitNonTransLoop
<a name="l00701"></a>00701 
<a name="l00702"></a>00702 LSSkip2:
<a name="l00703"></a>00703             add         esi, ecx                                        <span class="comment">// skip whole run, and start blit with new run</span>
<a name="l00704"></a>00704             jmp         BlitLineSetup
<a name="l00705"></a>00705 
<a name="l00706"></a>00706 
<a name="l00707"></a>00707 LSSkip1:
<a name="l00708"></a>00708             add         esi, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l00709"></a>00709             sub         LSCount, ecx
<a name="l00710"></a>00710             jmp         LeftSkipLoop
<a name="l00711"></a>00711 
<a name="l00712"></a>00712 
<a name="l00713"></a>00713 LSTrans:
<a name="l00714"></a>00714             and         ecx, 07fH
<a name="l00715"></a>00715             cmp         ecx, LSCount
<a name="l00716"></a>00716             je          BlitLineSetup                             <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l00717"></a>00717             jb          LSTrans1                                        <span class="comment">// if less, skip whole thing</span>
<a name="l00718"></a>00718 
<a name="l00719"></a>00719             sub         ecx, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l00720"></a>00720             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l00721"></a>00721             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l00722"></a>00722             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l00723"></a>00723             jmp         BlitTransparent
<a name="l00724"></a>00724 
<a name="l00725"></a>00725 
<a name="l00726"></a>00726 LSTrans1:
<a name="l00727"></a>00727             sub         LSCount, ecx                                          <span class="comment">// skip whole run, continue skipping</span>
<a name="l00728"></a>00728             jmp         LeftSkipLoop
<a name="l00729"></a>00729 
<a name="l00730"></a>00730 
<a name="l00731"></a>00731 BlitLineSetup:                                                    <span class="comment">// Does any actual blitting (trans/non) for the line</span>
<a name="l00732"></a>00732             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l00733"></a>00733             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l00734"></a>00734             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l00735"></a>00735 
<a name="l00736"></a>00736 BlitDispatch:
<a name="l00737"></a>00737 
<a name="l00738"></a>00738             cmp         LSCount, 0                                      <span class="comment">// Check to see if we're done blitting</span>
<a name="l00739"></a>00739             je          RightSkipLoop
<a name="l00740"></a>00740 
<a name="l00741"></a>00741             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l00742"></a>00742             inc         esi
<a name="l00743"></a>00743             or          cl, cl
<a name="l00744"></a>00744             js          BlitTransparent
<a name="l00745"></a>00745 
<a name="l00746"></a>00746 BlitNonTransLoop:                                           <span class="comment">// blit non-transparent pixels</span>
<a name="l00747"></a>00747 
<a name="l00748"></a>00748             cmp         ecx, LSCount
<a name="l00749"></a>00749             jbe         BNTrans1
<a name="l00750"></a>00750 
<a name="l00751"></a>00751             sub         ecx, LSCount
<a name="l00752"></a>00752             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, ecx
<a name="l00753"></a>00753             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, LSCount
<a name="l00754"></a>00754 
<a name="l00755"></a>00755 BNTrans1:
<a name="l00756"></a>00756             sub         LSCount, ecx
<a name="l00757"></a>00757 
<a name="l00758"></a>00758 BlitNTL1:
<a name="l00759"></a>00759             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l00760"></a>00760             cmp         ax, usZValue
<a name="l00761"></a>00761             ja          BlitNTL2
<a name="l00762"></a>00762 
<a name="l00763"></a>00763             xor         eax, eax
<a name="l00764"></a>00764             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, p16BPPPalette
<a name="l00765"></a>00765             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l00766"></a>00766             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, [edx+eax*2]
<a name="l00767"></a>00767             shr         eax, 1
<a name="l00768"></a>00768             and         eax, [<a class="code" href="vobject__blitters_8cpp.html#bf24fc3348d453dcdc6063f5c62b2468">guiTranslucentMask</a>]
<a name="l00769"></a>00769 
<a name="l00770"></a>00770             xor         edx, edx
<a name="l00771"></a>00771             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         dx, [edi]
<a name="l00772"></a>00772             shr         edx, 1
<a name="l00773"></a>00773             and         edx, [<a class="code" href="vobject__blitters_8cpp.html#bf24fc3348d453dcdc6063f5c62b2468">guiTranslucentMask</a>]
<a name="l00774"></a>00774 
<a name="l00775"></a>00775             add         eax, edx
<a name="l00776"></a>00776 
<a name="l00777"></a>00777             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax
<a name="l00778"></a>00778 
<a name="l00779"></a>00779 BlitNTL2:
<a name="l00780"></a>00780             inc         esi
<a name="l00781"></a>00781             add         edi, 2
<a name="l00782"></a>00782             add         ebx, 2
<a name="l00783"></a>00783             dec         cl
<a name="l00784"></a>00784             jnz         BlitNTL1
<a name="l00785"></a>00785 
<a name="l00786"></a>00786 <span class="comment">//BlitLineEnd:</span>
<a name="l00787"></a>00787             add         esi, Unblitted
<a name="l00788"></a>00788             jmp         BlitDispatch
<a name="l00789"></a>00789 
<a name="l00790"></a>00790 BlitTransparent:                                                              <span class="comment">// skip transparent pixels</span>
<a name="l00791"></a>00791 
<a name="l00792"></a>00792             and         ecx, 07fH
<a name="l00793"></a>00793             cmp         ecx, LSCount
<a name="l00794"></a>00794             jbe         BTrans1
<a name="l00795"></a>00795 
<a name="l00796"></a>00796             mov         ecx, LSCount
<a name="l00797"></a>00797 
<a name="l00798"></a>00798 BTrans1:
<a name="l00799"></a>00799 
<a name="l00800"></a>00800             sub         LSCount, ecx
<a name="l00801"></a>00801 <span class="comment">//          shl         ecx, 1</span>
<a name="l00802"></a>00802             add   ecx, ecx
<a name="l00803"></a>00803             add         edi, ecx
<a name="l00804"></a>00804             add         ebx, ecx
<a name="l00805"></a>00805             jmp         BlitDispatch
<a name="l00806"></a>00806 
<a name="l00807"></a>00807 
<a name="l00808"></a>00808 RightSkipLoop:                                                                      <span class="comment">// skip along until we hit and end-of-line marker</span>
<a name="l00809"></a>00809 
<a name="l00810"></a>00810 
<a name="l00811"></a>00811 RSLoop1:
<a name="l00812"></a>00812             mov         al, [esi]
<a name="l00813"></a>00813             inc         esi
<a name="l00814"></a>00814             or          al, al
<a name="l00815"></a>00815             jnz         RSLoop1
<a name="l00816"></a>00816 
<a name="l00817"></a>00817             dec         BlitHeight
<a name="l00818"></a>00818             jz          BlitDone
<a name="l00819"></a>00819             add         edi, LineSkip
<a name="l00820"></a>00820             add         ebx, LineSkip
<a name="l00821"></a>00821 
<a name="l00822"></a>00822             jmp         LeftSkipSetup
<a name="l00823"></a>00823 
<a name="l00824"></a>00824 
<a name="l00825"></a>00825 BlitDone:
<a name="l00826"></a>00826       }
<a name="l00827"></a>00827 
<a name="l00828"></a>00828       <span class="keywordflow">return</span>(TRUE);
<a name="l00829"></a>00829 
<a name="l00830"></a>00830 }
<a name="l00831"></a>00831 
<a name="l00832"></a>00832 
<a name="l00833"></a>00833 <span class="comment">/**********************************************************************************************</span>
<a name="l00834"></a>00834 <span class="comment"> Blt8BPPDataTo16BPPBufferTransZTranslucent</span>
<a name="l00835"></a>00835 <span class="comment"></span>
<a name="l00836"></a>00836 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l00837"></a>00837 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l00838"></a>00838 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on, and the Z value is</span>
<a name="l00839"></a>00839 <span class="comment">      updated to the current value, for any non-transparent pixels. The Z-buffer is 16 bit, and</span>
<a name="l00840"></a>00840 <span class="comment">      must be the same dimensions (including Pitch) as the destination.</span>
<a name="l00841"></a>00841 <span class="comment"></span>
<a name="l00842"></a>00842 <span class="comment">      Blits every second pixel ("Translucents").</span>
<a name="l00843"></a>00843 <span class="comment"></span>
<a name="l00844"></a>00844 <span class="comment">**********************************************************************************************/</span>
<a name="l00845"></a><a class="code" href="vobject__blitters_8h.html#c3a9aba9eb0e5b8dd1f6134878f40816">00845</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#c3a9aba9eb0e5b8dd1f6134878f40816">Blt8BPPDataTo16BPPBufferTransZTranslucent</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex )
<a name="l00846"></a>00846 {
<a name="l00847"></a>00847 <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth, uiOffset, LineSkip;
<a name="l00848"></a>00848 <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l00849"></a>00849 <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l00850"></a>00850 <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l00851"></a>00851 <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiLineFlag;
<a name="l00852"></a>00852 <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l00853"></a>00853 
<a name="l00854"></a>00854 
<a name="l00855"></a>00855       <span class="comment">// Assertions</span>
<a name="l00856"></a>00856       Assert( hSrcVObject != NULL );
<a name="l00857"></a>00857       Assert( pBuffer != NULL );
<a name="l00858"></a>00858 
<a name="l00859"></a>00859       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l00860"></a>00860       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l00861"></a>00861       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l00862"></a>00862       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l00863"></a>00863       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l00864"></a>00864 
<a name="l00865"></a>00865       <span class="comment">// Add to start position of dest buffer</span>
<a name="l00866"></a>00866       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l00867"></a>00867       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l00868"></a>00868 
<a name="l00869"></a>00869       <span class="comment">// Validations</span>
<a name="l00870"></a>00870       CHECKF( iTempX &gt;= 0 );
<a name="l00871"></a>00871       CHECKF( iTempY &gt;= 0 );
<a name="l00872"></a>00872 
<a name="l00873"></a>00873 
<a name="l00874"></a>00874       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l00875"></a>00875       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l00876"></a>00876       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l00877"></a>00877       p16BPPPalette = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#930609ad8d5cdbb05449df70bd83cfcd">pShadeCurrent</a>;
<a name="l00878"></a>00878       LineSkip=(uiDestPitchBYTES-(usWidth*2));
<a name="l00879"></a>00879       uiLineFlag=(iTempY&amp;1);
<a name="l00880"></a>00880 
<a name="l00881"></a>00881       __asm {
<a name="l00882"></a>00882 
<a name="l00883"></a>00883             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l00884"></a>00884             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l00885"></a>00885             xor         eax, eax
<a name="l00886"></a>00886             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l00887"></a>00887             xor         ecx, ecx
<a name="l00888"></a>00888 <span class="comment">//          mov         edx, p16BPPPalette</span>
<a name="l00889"></a>00889 
<a name="l00890"></a>00890 BlitDispatch:
<a name="l00891"></a>00891 
<a name="l00892"></a>00892             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l00893"></a>00893             inc         esi
<a name="l00894"></a>00894             or          cl, cl
<a name="l00895"></a>00895             js          BlitTransparent
<a name="l00896"></a>00896             jz          BlitDoneLine
<a name="l00897"></a>00897 
<a name="l00898"></a>00898 <span class="comment">//BlitNonTransLoop:</span>
<a name="l00899"></a>00899 
<a name="l00900"></a>00900 BlitNTL4:
<a name="l00901"></a>00901             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l00902"></a>00902             cmp         ax, usZValue
<a name="l00903"></a>00903             ja          BlitNTL5
<a name="l00904"></a>00904 
<a name="l00905"></a>00905             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, usZValue
<a name="l00906"></a>00906             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [ebx], ax
<a name="l00907"></a>00907 
<a name="l00908"></a>00908             xor         eax, eax
<a name="l00909"></a>00909             mov         edx, p16BPPPalette
<a name="l00910"></a>00910             mov         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l00911"></a>00911             mov         ax, [edx+eax*2]
<a name="l00912"></a>00912             shr         eax, 1
<a name="l00913"></a>00913             and         eax, <a class="code" href="vobject__blitters_8cpp.html#bf24fc3348d453dcdc6063f5c62b2468">guiTranslucentMask</a>
<a name="l00914"></a>00914 
<a name="l00915"></a>00915             xor         edx, edx
<a name="l00916"></a>00916             mov         dx, [edi]
<a name="l00917"></a>00917             shr         edx, 1
<a name="l00918"></a>00918             and         edx, <a class="code" href="vobject__blitters_8cpp.html#bf24fc3348d453dcdc6063f5c62b2468">guiTranslucentMask</a>
<a name="l00919"></a>00919 
<a name="l00920"></a>00920             add         eax, edx
<a name="l00921"></a>00921             mov         [edi], ax
<a name="l00922"></a>00922 
<a name="l00923"></a>00923 BlitNTL5:
<a name="l00924"></a>00924             inc         esi
<a name="l00925"></a>00925             add         edi, 2
<a name="l00926"></a>00926             add         ebx, 2
<a name="l00927"></a>00927             dec         cl
<a name="l00928"></a>00928             jnz         BlitNTL4
<a name="l00929"></a>00929 
<a name="l00930"></a>00930             jmp         BlitDispatch
<a name="l00931"></a>00931 
<a name="l00932"></a>00932 
<a name="l00933"></a>00933 BlitTransparent:
<a name="l00934"></a>00934 
<a name="l00935"></a>00935             and         ecx, 07fH
<a name="l00936"></a>00936 <span class="comment">//          shl         ecx, 1</span>
<a name="l00937"></a>00937             add   ecx, ecx
<a name="l00938"></a>00938             add         edi, ecx
<a name="l00939"></a>00939             add         ebx, ecx
<a name="l00940"></a>00940             jmp         BlitDispatch
<a name="l00941"></a>00941 
<a name="l00942"></a>00942 
<a name="l00943"></a>00943 BlitDoneLine:
<a name="l00944"></a>00944 
<a name="l00945"></a>00945             dec         usHeight
<a name="l00946"></a>00946             jz          BlitDone
<a name="l00947"></a>00947             add         edi, LineSkip
<a name="l00948"></a>00948             add         ebx, LineSkip
<a name="l00949"></a>00949             xor         uiLineFlag, 1
<a name="l00950"></a>00950             jmp         BlitDispatch
<a name="l00951"></a>00951 
<a name="l00952"></a>00952 
<a name="l00953"></a>00953 BlitDone:
<a name="l00954"></a>00954       }
<a name="l00955"></a>00955 
<a name="l00956"></a>00956       <span class="keywordflow">return</span>(TRUE);
<a name="l00957"></a>00957 
<a name="l00958"></a>00958 }
<a name="l00959"></a>00959 
<a name="l00960"></a>00960 <span class="comment">/**********************************************************************************************</span>
<a name="l00961"></a>00961 <span class="comment"> Blt8BPPDataTo16BPPBufferTransZClipTranslucent</span>
<a name="l00962"></a>00962 <span class="comment"></span>
<a name="l00963"></a>00963 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l00964"></a>00964 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l00965"></a>00965 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on, and the Z value is</span>
<a name="l00966"></a>00966 <span class="comment">      updated to the current value, for any non-transparent pixels. The Z-buffer is 16 bit, and</span>
<a name="l00967"></a>00967 <span class="comment">      must be the same dimensions (including Pitch) as the destination.</span>
<a name="l00968"></a>00968 <span class="comment"></span>
<a name="l00969"></a>00969 <span class="comment">      Blits every second pixel ("Translucents").</span>
<a name="l00970"></a>00970 <span class="comment"></span>
<a name="l00971"></a>00971 <span class="comment">**********************************************************************************************/</span>
<a name="l00972"></a><a class="code" href="vobject__blitters_8h.html#3178a2f94977633bad1de86fc34f4e0e">00972</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#3178a2f94977633bad1de86fc34f4e0e">Blt8BPPDataTo16BPPBufferTransZClipTranslucent</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="structSGPRect.html">SGPRect</a> *clipregion)
<a name="l00973"></a>00973 {
<a name="l00974"></a>00974 <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l00975"></a>00975 <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset, uiLineFlag;
<a name="l00976"></a>00976 <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth, Unblitted;
<a name="l00977"></a>00977 <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l00978"></a>00978 <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l00979"></a>00979 <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l00980"></a>00980 <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY, LeftSkip, RightSkip, TopSkip, BottomSkip, BlitLength, BlitHeight, LSCount;
<a name="l00981"></a>00981 <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  ClipX1, ClipY1, ClipX2, ClipY2;
<a name="l00982"></a>00982 
<a name="l00983"></a>00983       <span class="comment">// Assertions</span>
<a name="l00984"></a>00984       Assert( hSrcVObject != NULL );
<a name="l00985"></a>00985       Assert( pBuffer != NULL );
<a name="l00986"></a>00986 
<a name="l00987"></a>00987       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l00988"></a>00988       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l00989"></a>00989       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l00990"></a>00990       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l00991"></a>00991       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l00992"></a>00992 
<a name="l00993"></a>00993       <span class="comment">// Add to start position of dest buffer</span>
<a name="l00994"></a>00994       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l00995"></a>00995       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l00996"></a>00996 
<a name="l00997"></a>00997       <span class="keywordflow">if</span>(clipregion==NULL)
<a name="l00998"></a>00998       {
<a name="l00999"></a>00999             ClipX1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l01000"></a>01000             ClipY1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l01001"></a>01001             ClipX2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l01002"></a>01002             ClipY2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l01003"></a>01003       }
<a name="l01004"></a>01004       <span class="keywordflow">else</span>
<a name="l01005"></a>01005       {
<a name="l01006"></a>01006             ClipX1=clipregion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l01007"></a>01007             ClipY1=clipregion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l01008"></a>01008             ClipX2=clipregion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l01009"></a>01009             ClipY2=clipregion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l01010"></a>01010       }
<a name="l01011"></a>01011 
<a name="l01012"></a>01012       <span class="comment">// Calculate rows hanging off each side of the screen</span>
<a name="l01013"></a>01013       LeftSkip=__min(ClipX1 - min(ClipX1, iTempX), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l01014"></a>01014       RightSkip=__min(max(ClipX2, (iTempX+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth)) - ClipX2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l01015"></a>01015       TopSkip=__min(ClipY1 - __min(ClipY1, iTempY), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l01016"></a>01016       BottomSkip=__min(__max(ClipY2, (iTempY+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight)) - ClipY2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l01017"></a>01017 
<a name="l01018"></a>01018       <span class="comment">// calculate the remaining rows and columns to blit</span>
<a name="l01019"></a>01019       BlitLength=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth-LeftSkip-RightSkip);
<a name="l01020"></a>01020       BlitHeight=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight-TopSkip-BottomSkip);
<a name="l01021"></a>01021 
<a name="l01022"></a>01022       <span class="comment">// check if whole thing is clipped</span>
<a name="l01023"></a>01023       <span class="keywordflow">if</span>((LeftSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth) || (RightSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth))
<a name="l01024"></a>01024             <span class="keywordflow">return</span>(TRUE);
<a name="l01025"></a>01025 
<a name="l01026"></a>01026       <span class="comment">// check if whole thing is clipped</span>
<a name="l01027"></a>01027       <span class="keywordflow">if</span>((TopSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight) || (BottomSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight))
<a name="l01028"></a>01028             <span class="keywordflow">return</span>(TRUE);
<a name="l01029"></a>01029 
<a name="l01030"></a>01030       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l01031"></a>01031       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l01032"></a>01032       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l01033"></a>01033       p16BPPPalette = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#930609ad8d5cdbb05449df70bd83cfcd">pShadeCurrent</a>;
<a name="l01034"></a>01034       LineSkip=(uiDestPitchBYTES-(BlitLength*2));
<a name="l01035"></a>01035       uiLineFlag=(iTempY&amp;1);
<a name="l01036"></a>01036 
<a name="l01037"></a>01037       __asm {
<a name="l01038"></a>01038 
<a name="l01039"></a>01039             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l01040"></a>01040             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l01041"></a>01041             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, p16BPPPalette
<a name="l01042"></a>01042             xor         eax, eax
<a name="l01043"></a>01043             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l01044"></a>01044             xor         ecx, ecx
<a name="l01045"></a>01045 
<a name="l01046"></a>01046             cmp         TopSkip, 0                                      <span class="comment">// check for nothing clipped on top</span>
<a name="l01047"></a>01047             je          LeftSkipSetup
<a name="l01048"></a>01048 
<a name="l01049"></a>01049 TopSkipLoop:                                                            <span class="comment">// Skips the number of lines clipped at the top</span>
<a name="l01050"></a>01050 
<a name="l01051"></a>01051             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l01052"></a>01052             inc         esi
<a name="l01053"></a>01053             or          cl, cl
<a name="l01054"></a>01054             js          TopSkipLoop
<a name="l01055"></a>01055             jz          TSEndLine
<a name="l01056"></a>01056 
<a name="l01057"></a>01057             add         esi, ecx
<a name="l01058"></a>01058             jmp         TopSkipLoop
<a name="l01059"></a>01059 
<a name="l01060"></a>01060 TSEndLine:
<a name="l01061"></a>01061             dec         TopSkip
<a name="l01062"></a>01062             jnz         TopSkipLoop
<a name="l01063"></a>01063 
<a name="l01064"></a>01064 LeftSkipSetup:
<a name="l01065"></a>01065 
<a name="l01066"></a>01066             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l01067"></a>01067             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, LeftSkip
<a name="l01068"></a>01068             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l01069"></a>01069             or          eax, eax
<a name="l01070"></a>01070             jz          BlitLineSetup
<a name="l01071"></a>01071 
<a name="l01072"></a>01072 LeftSkipLoop:
<a name="l01073"></a>01073 
<a name="l01074"></a>01074             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l01075"></a>01075             inc         esi
<a name="l01076"></a>01076 
<a name="l01077"></a>01077             or          cl, cl
<a name="l01078"></a>01078             js          LSTrans
<a name="l01079"></a>01079 
<a name="l01080"></a>01080             cmp         ecx, LSCount
<a name="l01081"></a>01081             je          LSSkip2                                               <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l01082"></a>01082             jb          LSSkip1                                               <span class="comment">// if less, skip whole thing</span>
<a name="l01083"></a>01083 
<a name="l01084"></a>01084             add         esi, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l01085"></a>01085             sub         ecx, LSCount
<a name="l01086"></a>01086             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l01087"></a>01087             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l01088"></a>01088             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l01089"></a>01089             jmp         BlitNonTransLoop
<a name="l01090"></a>01090 
<a name="l01091"></a>01091 LSSkip2:
<a name="l01092"></a>01092             add         esi, ecx                                        <span class="comment">// skip whole run, and start blit with new run</span>
<a name="l01093"></a>01093             jmp         BlitLineSetup
<a name="l01094"></a>01094 
<a name="l01095"></a>01095 
<a name="l01096"></a>01096 LSSkip1:
<a name="l01097"></a>01097             add         esi, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l01098"></a>01098             sub         LSCount, ecx
<a name="l01099"></a>01099             jmp         LeftSkipLoop
<a name="l01100"></a>01100 
<a name="l01101"></a>01101 
<a name="l01102"></a>01102 LSTrans:
<a name="l01103"></a>01103             and         ecx, 07fH
<a name="l01104"></a>01104             cmp         ecx, LSCount
<a name="l01105"></a>01105             je          BlitLineSetup                             <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l01106"></a>01106             jb          LSTrans1                                        <span class="comment">// if less, skip whole thing</span>
<a name="l01107"></a>01107 
<a name="l01108"></a>01108             sub         ecx, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l01109"></a>01109             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l01110"></a>01110             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l01111"></a>01111             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l01112"></a>01112             jmp         BlitTransparent
<a name="l01113"></a>01113 
<a name="l01114"></a>01114 
<a name="l01115"></a>01115 LSTrans1:
<a name="l01116"></a>01116             sub         LSCount, ecx                                          <span class="comment">// skip whole run, continue skipping</span>
<a name="l01117"></a>01117             jmp         LeftSkipLoop
<a name="l01118"></a>01118 
<a name="l01119"></a>01119 
<a name="l01120"></a>01120 BlitLineSetup:                                                    <span class="comment">// Does any actual blitting (trans/non) for the line</span>
<a name="l01121"></a>01121             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l01122"></a>01122             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l01123"></a>01123             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l01124"></a>01124 
<a name="l01125"></a>01125 BlitDispatch:
<a name="l01126"></a>01126 
<a name="l01127"></a>01127             cmp         LSCount, 0                                      <span class="comment">// Check to see if we're done blitting</span>
<a name="l01128"></a>01128             je          RightSkipLoop
<a name="l01129"></a>01129 
<a name="l01130"></a>01130             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l01131"></a>01131             inc         esi
<a name="l01132"></a>01132             or          cl, cl
<a name="l01133"></a>01133             js          BlitTransparent
<a name="l01134"></a>01134 
<a name="l01135"></a>01135 BlitNonTransLoop:                                           <span class="comment">// blit non-transparent pixels</span>
<a name="l01136"></a>01136 
<a name="l01137"></a>01137             cmp         ecx, LSCount
<a name="l01138"></a>01138             jbe         BNTrans1
<a name="l01139"></a>01139 
<a name="l01140"></a>01140             sub         ecx, LSCount
<a name="l01141"></a>01141             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, ecx
<a name="l01142"></a>01142             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, LSCount
<a name="l01143"></a>01143 
<a name="l01144"></a>01144 BNTrans1:
<a name="l01145"></a>01145             sub         LSCount, ecx
<a name="l01146"></a>01146 
<a name="l01147"></a>01147 BlitNTL1:
<a name="l01148"></a>01148             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l01149"></a>01149             cmp         ax, usZValue
<a name="l01150"></a>01150             ja          BlitNTL2
<a name="l01151"></a>01151 
<a name="l01152"></a>01152             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, usZValue
<a name="l01153"></a>01153             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [ebx], ax
<a name="l01154"></a>01154 
<a name="l01155"></a>01155             xor         eax, eax
<a name="l01156"></a>01156             mov         edx, p16BPPPalette
<a name="l01157"></a>01157             mov         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l01158"></a>01158             mov         ax, [edx+eax*2]
<a name="l01159"></a>01159             xor         edx, edx
<a name="l01160"></a>01160             shr         eax, 1
<a name="l01161"></a>01161             mov         dx, [edi]
<a name="l01162"></a>01162             and         eax, [<a class="code" href="vobject__blitters_8cpp.html#bf24fc3348d453dcdc6063f5c62b2468">guiTranslucentMask</a>]
<a name="l01163"></a>01163             shr         edx, 1
<a name="l01164"></a>01164             and         edx, [<a class="code" href="vobject__blitters_8cpp.html#bf24fc3348d453dcdc6063f5c62b2468">guiTranslucentMask</a>]
<a name="l01165"></a>01165 
<a name="l01166"></a>01166             add         eax, edx
<a name="l01167"></a>01167 
<a name="l01168"></a>01168             mov         [edi], ax
<a name="l01169"></a>01169 
<a name="l01170"></a>01170 BlitNTL2:
<a name="l01171"></a>01171             inc         esi
<a name="l01172"></a>01172             add         edi, 2
<a name="l01173"></a>01173             add         ebx, 2
<a name="l01174"></a>01174             dec         cl
<a name="l01175"></a>01175             jnz         BlitNTL1
<a name="l01176"></a>01176 
<a name="l01177"></a>01177 <span class="comment">//BlitLineEnd:</span>
<a name="l01178"></a>01178             add         esi, Unblitted
<a name="l01179"></a>01179             jmp         BlitDispatch
<a name="l01180"></a>01180 
<a name="l01181"></a>01181 BlitTransparent:                                                              <span class="comment">// skip transparent pixels</span>
<a name="l01182"></a>01182 
<a name="l01183"></a>01183             and         ecx, 07fH
<a name="l01184"></a>01184             cmp         ecx, LSCount
<a name="l01185"></a>01185             jbe         BTrans1
<a name="l01186"></a>01186 
<a name="l01187"></a>01187             mov         ecx, LSCount
<a name="l01188"></a>01188 
<a name="l01189"></a>01189 BTrans1:
<a name="l01190"></a>01190 
<a name="l01191"></a>01191             sub         LSCount, ecx
<a name="l01192"></a>01192 <span class="comment">//          shl         ecx, 1</span>
<a name="l01193"></a>01193             add   ecx, ecx
<a name="l01194"></a>01194             add         edi, ecx
<a name="l01195"></a>01195             add         ebx, ecx
<a name="l01196"></a>01196             jmp         BlitDispatch
<a name="l01197"></a>01197 
<a name="l01198"></a>01198 
<a name="l01199"></a>01199 RightSkipLoop:                                                                      <span class="comment">// skip along until we hit and end-of-line marker</span>
<a name="l01200"></a>01200 
<a name="l01201"></a>01201 
<a name="l01202"></a>01202 RSLoop1:
<a name="l01203"></a>01203             mov         al, [esi]
<a name="l01204"></a>01204             inc         esi
<a name="l01205"></a>01205             or          al, al
<a name="l01206"></a>01206             jnz         RSLoop1
<a name="l01207"></a>01207 
<a name="l01208"></a>01208             xor         uiLineFlag, 1
<a name="l01209"></a>01209             dec         BlitHeight
<a name="l01210"></a>01210             jz          BlitDone
<a name="l01211"></a>01211             add         edi, LineSkip
<a name="l01212"></a>01212             add         ebx, LineSkip
<a name="l01213"></a>01213 
<a name="l01214"></a>01214             jmp         LeftSkipSetup
<a name="l01215"></a>01215 
<a name="l01216"></a>01216 
<a name="l01217"></a>01217 BlitDone:
<a name="l01218"></a>01218       }
<a name="l01219"></a>01219 
<a name="l01220"></a>01220       <span class="keywordflow">return</span>(TRUE);
<a name="l01221"></a>01221 
<a name="l01222"></a>01222 }
<a name="l01223"></a>01223 
<a name="l01224"></a>01224 <span class="comment">/**********************************************************************************************</span>
<a name="l01225"></a>01225 <span class="comment"> Blt8BPPDataTo16BPPBufferTransZNBTranslucent</span>
<a name="l01226"></a>01226 <span class="comment"></span>
<a name="l01227"></a>01227 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l01228"></a>01228 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l01229"></a>01229 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on, and the Z value is</span>
<a name="l01230"></a>01230 <span class="comment">      NOT updated to the current value,   for any non-transparent pixels. The Z-buffer is 16 bit, and</span>
<a name="l01231"></a>01231 <span class="comment">      must be the same dimensions (including Pitch) as the destination.</span>
<a name="l01232"></a>01232 <span class="comment"></span>
<a name="l01233"></a>01233 <span class="comment">      Blits every second pixel ("Translucents").</span>
<a name="l01234"></a>01234 <span class="comment"></span>
<a name="l01235"></a>01235 <span class="comment">**********************************************************************************************/</span>
<a name="l01236"></a><a class="code" href="vobject__blitters_8h.html#fc8bbccbd15546234b24639f861fcc9e">01236</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#fc8bbccbd15546234b24639f861fcc9e">Blt8BPPDataTo16BPPBufferTransZNBTranslucent</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex )
<a name="l01237"></a>01237 {
<a name="l01238"></a>01238 <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth, uiOffset, LineSkip;
<a name="l01239"></a>01239 <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l01240"></a>01240 <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l01241"></a>01241 <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l01242"></a>01242 <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiLineFlag;
<a name="l01243"></a>01243 <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l01244"></a>01244 
<a name="l01245"></a>01245 
<a name="l01246"></a>01246       <span class="comment">// Assertions</span>
<a name="l01247"></a>01247       Assert( hSrcVObject != NULL );
<a name="l01248"></a>01248       Assert( pBuffer != NULL );
<a name="l01249"></a>01249 
<a name="l01250"></a>01250       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l01251"></a>01251       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l01252"></a>01252       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l01253"></a>01253       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l01254"></a>01254       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l01255"></a>01255 
<a name="l01256"></a>01256       <span class="comment">// Add to start position of dest buffer</span>
<a name="l01257"></a>01257       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l01258"></a>01258       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l01259"></a>01259 
<a name="l01260"></a>01260       <span class="comment">// Validations</span>
<a name="l01261"></a>01261       CHECKF( iTempX &gt;= 0 );
<a name="l01262"></a>01262       CHECKF( iTempY &gt;= 0 );
<a name="l01263"></a>01263 
<a name="l01264"></a>01264 
<a name="l01265"></a>01265       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l01266"></a>01266       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l01267"></a>01267       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l01268"></a>01268       p16BPPPalette = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#930609ad8d5cdbb05449df70bd83cfcd">pShadeCurrent</a>;
<a name="l01269"></a>01269       LineSkip=(uiDestPitchBYTES-(usWidth*2));
<a name="l01270"></a>01270       uiLineFlag=(iTempY&amp;1);
<a name="l01271"></a>01271 
<a name="l01272"></a>01272       __asm {
<a name="l01273"></a>01273 
<a name="l01274"></a>01274             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l01275"></a>01275             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l01276"></a>01276             xor         eax, eax
<a name="l01277"></a>01277             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l01278"></a>01278             xor         ecx, ecx
<a name="l01279"></a>01279             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, p16BPPPalette
<a name="l01280"></a>01280 
<a name="l01281"></a>01281 BlitDispatch:
<a name="l01282"></a>01282 
<a name="l01283"></a>01283             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l01284"></a>01284             inc         esi
<a name="l01285"></a>01285             or          cl, cl
<a name="l01286"></a>01286             js          BlitTransparent
<a name="l01287"></a>01287             jz          BlitDoneLine
<a name="l01288"></a>01288 
<a name="l01289"></a>01289 <span class="comment">//BlitNonTransLoop:</span>
<a name="l01290"></a>01290 
<a name="l01291"></a>01291 BlitNTL4:
<a name="l01292"></a>01292             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l01293"></a>01293             cmp         ax, usZValue
<a name="l01294"></a>01294             ja          BlitNTL5
<a name="l01295"></a>01295 
<a name="l01296"></a>01296             xor         edx, edx
<a name="l01297"></a>01297             xor         eax, eax
<a name="l01298"></a>01298             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, p16BPPPalette
<a name="l01299"></a>01299             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l01300"></a>01300             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, [edx+eax*2]
<a name="l01301"></a>01301             shr         eax, 1
<a name="l01302"></a>01302             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         dx, [edi]
<a name="l01303"></a>01303             and         eax, [<a class="code" href="vobject__blitters_8cpp.html#bf24fc3348d453dcdc6063f5c62b2468">guiTranslucentMask</a>]
<a name="l01304"></a>01304 
<a name="l01305"></a>01305             shr         edx, 1
<a name="l01306"></a>01306             and         edx, [<a class="code" href="vobject__blitters_8cpp.html#bf24fc3348d453dcdc6063f5c62b2468">guiTranslucentMask</a>]
<a name="l01307"></a>01307 
<a name="l01308"></a>01308             add         eax, edx
<a name="l01309"></a>01309             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax
<a name="l01310"></a>01310 
<a name="l01311"></a>01311 BlitNTL5:
<a name="l01312"></a>01312             inc         esi
<a name="l01313"></a>01313             add         edi, 2
<a name="l01314"></a>01314             add         ebx, 2
<a name="l01315"></a>01315             dec         cl
<a name="l01316"></a>01316             jnz         BlitNTL4
<a name="l01317"></a>01317 
<a name="l01318"></a>01318             jmp         BlitDispatch
<a name="l01319"></a>01319 
<a name="l01320"></a>01320 
<a name="l01321"></a>01321 BlitTransparent:
<a name="l01322"></a>01322 
<a name="l01323"></a>01323             and         ecx, 07fH
<a name="l01324"></a>01324 <span class="comment">//          shl         ecx, 1</span>
<a name="l01325"></a>01325             add   ecx, ecx
<a name="l01326"></a>01326             add         edi, ecx
<a name="l01327"></a>01327             add         ebx, ecx
<a name="l01328"></a>01328             jmp         BlitDispatch
<a name="l01329"></a>01329 
<a name="l01330"></a>01330 
<a name="l01331"></a>01331 BlitDoneLine:
<a name="l01332"></a>01332 
<a name="l01333"></a>01333             dec         usHeight
<a name="l01334"></a>01334             jz          BlitDone
<a name="l01335"></a>01335             add         edi, LineSkip
<a name="l01336"></a>01336             add         ebx, LineSkip
<a name="l01337"></a>01337             xor         uiLineFlag, 1
<a name="l01338"></a>01338             jmp         BlitDispatch
<a name="l01339"></a>01339 
<a name="l01340"></a>01340 
<a name="l01341"></a>01341 BlitDone:
<a name="l01342"></a>01342       }
<a name="l01343"></a>01343 
<a name="l01344"></a>01344       <span class="keywordflow">return</span>(TRUE);
<a name="l01345"></a>01345 
<a name="l01346"></a>01346 }
<a name="l01347"></a>01347 
<a name="l01348"></a>01348 
<a name="l01349"></a>01349 
<a name="l01350"></a>01350 
<a name="l01351"></a>01351 
<a name="l01352"></a>01352 
<a name="l01353"></a>01353 
<a name="l01354"></a>01354 
<a name="l01355"></a>01355 
<a name="l01356"></a>01356 
<a name="l01357"></a>01357 
<a name="l01358"></a>01358 
<a name="l01359"></a>01359 
<a name="l01360"></a>01360 
<a name="l01361"></a>01361 
<a name="l01362"></a>01362 <span class="comment">/**********************************************************************************************</span>
<a name="l01363"></a>01363 <span class="comment"> Blt8BPPDataTo8BPPBufferTransZIncClip</span>
<a name="l01364"></a>01364 <span class="comment"></span>
<a name="l01365"></a>01365 <span class="comment">      Used for large brushes (larger vertically than a single tile). Increments the Z</span>
<a name="l01366"></a>01366 <span class="comment">      value by Z_SUBLAYERS for every WORLD_TILE_Y lines of pixels blitted.</span>
<a name="l01367"></a>01367 <span class="comment"></span>
<a name="l01368"></a>01368 <span class="comment">**********************************************************************************************/</span>
<a name="l01369"></a><a class="code" href="vobject__blitters_8cpp.html#0a7f431e6945fb5e741311ae3f5fe06c">01369</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#0a7f431e6945fb5e741311ae3f5fe06c">Blt8BPPDataTo8BPPBufferTransZIncClip</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="structSGPRect.html">SGPRect</a> *clipregion)
<a name="l01370"></a>01370 {
<a name="l01371"></a>01371       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l01372"></a>01372       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth, Unblitted;
<a name="l01373"></a>01373       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l01374"></a>01374       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip, LineSkipZ;
<a name="l01375"></a>01375   <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l01376"></a>01376       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY, LeftSkip, RightSkip, TopSkip, BottomSkip, BlitLength, BlitHeight, LSCount;
<a name="l01377"></a>01377       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  ClipX1, ClipY1, ClipX2, ClipY2;
<a name="l01378"></a>01378       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *pPal8BPP;
<a name="l01379"></a>01379       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZLevel, usZLinesToGo;
<a name="l01380"></a>01380 
<a name="l01381"></a>01381       <span class="comment">// Assertions</span>
<a name="l01382"></a>01382       Assert( hSrcVObject != NULL );
<a name="l01383"></a>01383       Assert( pBuffer != NULL );
<a name="l01384"></a>01384 
<a name="l01385"></a>01385       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l01386"></a>01386       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l01387"></a>01387       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l01388"></a>01388       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l01389"></a>01389       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l01390"></a>01390 
<a name="l01391"></a>01391       <span class="comment">// Add to start position of dest buffer</span>
<a name="l01392"></a>01392       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l01393"></a>01393       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l01394"></a>01394 
<a name="l01395"></a>01395       <span class="keywordflow">if</span>(clipregion==NULL)
<a name="l01396"></a>01396       {
<a name="l01397"></a>01397             ClipX1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l01398"></a>01398             ClipY1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l01399"></a>01399             ClipX2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l01400"></a>01400             ClipY2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l01401"></a>01401       }
<a name="l01402"></a>01402       <span class="keywordflow">else</span>
<a name="l01403"></a>01403       {
<a name="l01404"></a>01404             ClipX1=clipregion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l01405"></a>01405             ClipY1=clipregion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l01406"></a>01406             ClipX2=clipregion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l01407"></a>01407             ClipY2=clipregion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l01408"></a>01408       }
<a name="l01409"></a>01409 
<a name="l01410"></a>01410       <span class="comment">// Calculate rows hanging off each side of the screen</span>
<a name="l01411"></a>01411       LeftSkip=__min(ClipX1 - min(ClipX1, iTempX), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l01412"></a>01412       RightSkip=__min(max(ClipX2, (iTempX+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth)) - ClipX2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l01413"></a>01413       TopSkip=__min(ClipY1 - __min(ClipY1, iTempY), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l01414"></a>01414       BottomSkip=__min(__max(ClipY2, (iTempY+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight)) - ClipY2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l01415"></a>01415 
<a name="l01416"></a>01416       <span class="comment">// calculate the remaining rows and columns to blit</span>
<a name="l01417"></a>01417       BlitLength=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth-LeftSkip-RightSkip);
<a name="l01418"></a>01418       BlitHeight=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight-TopSkip-BottomSkip);
<a name="l01419"></a>01419 
<a name="l01420"></a>01420       <span class="comment">// check if whole thing is clipped</span>
<a name="l01421"></a>01421       <span class="keywordflow">if</span>((LeftSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth) || (RightSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth))
<a name="l01422"></a>01422             <span class="keywordflow">return</span>(TRUE);
<a name="l01423"></a>01423 
<a name="l01424"></a>01424       <span class="comment">// check if whole thing is clipped</span>
<a name="l01425"></a>01425       <span class="keywordflow">if</span>((TopSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight) || (BottomSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight))
<a name="l01426"></a>01426             <span class="keywordflow">return</span>(TRUE);
<a name="l01427"></a>01427 
<a name="l01428"></a>01428       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l01429"></a>01429       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip));
<a name="l01430"></a>01430       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*2*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l01431"></a>01431       pPal8BPP = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#152256552f959a5d90dbd886d22fb679">pShade8</a>;
<a name="l01432"></a>01432       LineSkip=(uiDestPitchBYTES-(BlitLength));
<a name="l01433"></a>01433       LineSkipZ=LineSkip*2;
<a name="l01434"></a>01434 
<a name="l01435"></a>01435       usZLevel=usZValue;
<a name="l01436"></a>01436 <span class="comment">//    usZLinesToGo=WORLD_TILE_Y;</span>
<a name="l01437"></a>01437 
<a name="l01438"></a>01438       __asm {
<a name="l01439"></a>01439 
<a name="l01440"></a>01440             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l01441"></a>01441             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l01442"></a>01442             xor         eax, eax
<a name="l01443"></a>01443             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l01444"></a>01444             xor         ecx, ecx
<a name="l01445"></a>01445             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, pPal8BPP
<a name="l01446"></a>01446 
<a name="l01447"></a>01447             cmp         TopSkip, 0                                      <span class="comment">// check for nothing clipped on top</span>
<a name="l01448"></a>01448             je          LeftSkipSetup
<a name="l01449"></a>01449 
<a name="l01450"></a>01450 TopSkipLoop:                                                            <span class="comment">// Skips the number of lines clipped at the top</span>
<a name="l01451"></a>01451 
<a name="l01452"></a>01452             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l01453"></a>01453             inc         esi
<a name="l01454"></a>01454             or          cl, cl
<a name="l01455"></a>01455             js          TopSkipLoop
<a name="l01456"></a>01456             jz          TSEndLine
<a name="l01457"></a>01457 
<a name="l01458"></a>01458             add         esi, ecx
<a name="l01459"></a>01459             jmp         TopSkipLoop
<a name="l01460"></a>01460 
<a name="l01461"></a>01461 TSEndLine:
<a name="l01462"></a>01462             dec         TopSkip
<a name="l01463"></a>01463             jnz         TopSkipLoop
<a name="l01464"></a>01464 
<a name="l01465"></a>01465 LeftSkipSetup:
<a name="l01466"></a>01466 
<a name="l01467"></a>01467             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l01468"></a>01468             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, LeftSkip
<a name="l01469"></a>01469             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l01470"></a>01470             or          eax, eax
<a name="l01471"></a>01471             jz          BlitLineSetup
<a name="l01472"></a>01472 
<a name="l01473"></a>01473 LeftSkipLoop:
<a name="l01474"></a>01474 
<a name="l01475"></a>01475             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l01476"></a>01476             inc         esi
<a name="l01477"></a>01477 
<a name="l01478"></a>01478             or          cl, cl
<a name="l01479"></a>01479             js          LSTrans
<a name="l01480"></a>01480 
<a name="l01481"></a>01481             cmp         ecx, LSCount
<a name="l01482"></a>01482             je          LSSkip2                                               <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l01483"></a>01483             jb          LSSkip1                                               <span class="comment">// if less, skip whole thing</span>
<a name="l01484"></a>01484 
<a name="l01485"></a>01485             add         esi, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l01486"></a>01486             sub         ecx, LSCount
<a name="l01487"></a>01487             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l01488"></a>01488             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l01489"></a>01489             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l01490"></a>01490             jmp         BlitNonTransLoop
<a name="l01491"></a>01491 
<a name="l01492"></a>01492 LSSkip2:
<a name="l01493"></a>01493             add         esi, ecx                                        <span class="comment">// skip whole run, and start blit with new run</span>
<a name="l01494"></a>01494             jmp         BlitLineSetup
<a name="l01495"></a>01495 
<a name="l01496"></a>01496 
<a name="l01497"></a>01497 LSSkip1:
<a name="l01498"></a>01498             add         esi, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l01499"></a>01499             sub         LSCount, ecx
<a name="l01500"></a>01500             jmp         LeftSkipLoop
<a name="l01501"></a>01501 
<a name="l01502"></a>01502 
<a name="l01503"></a>01503 LSTrans:
<a name="l01504"></a>01504             and         ecx, 07fH
<a name="l01505"></a>01505             cmp         ecx, LSCount
<a name="l01506"></a>01506             je          BlitLineSetup                             <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l01507"></a>01507             jb          LSTrans1                                        <span class="comment">// if less, skip whole thing</span>
<a name="l01508"></a>01508 
<a name="l01509"></a>01509             sub         ecx, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l01510"></a>01510             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l01511"></a>01511             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l01512"></a>01512             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l01513"></a>01513             jmp         BlitTransparent
<a name="l01514"></a>01514 
<a name="l01515"></a>01515 
<a name="l01516"></a>01516 LSTrans1:
<a name="l01517"></a>01517             sub         LSCount, ecx                                          <span class="comment">// skip whole run, continue skipping</span>
<a name="l01518"></a>01518             jmp         LeftSkipLoop
<a name="l01519"></a>01519 
<a name="l01520"></a>01520 
<a name="l01521"></a>01521 BlitLineSetup:                                                    <span class="comment">// Does any actual blitting (trans/non) for the line</span>
<a name="l01522"></a>01522             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l01523"></a>01523             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l01524"></a>01524             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l01525"></a>01525 
<a name="l01526"></a>01526 BlitDispatch:
<a name="l01527"></a>01527 
<a name="l01528"></a>01528             cmp         LSCount, 0                                      <span class="comment">// Check to see if we're done blitting</span>
<a name="l01529"></a>01529             je          RightSkipLoop
<a name="l01530"></a>01530 
<a name="l01531"></a>01531             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l01532"></a>01532             inc         esi
<a name="l01533"></a>01533             or          cl, cl
<a name="l01534"></a>01534             js          BlitTransparent
<a name="l01535"></a>01535 
<a name="l01536"></a>01536 BlitNonTransLoop:                                           <span class="comment">// blit non-transparent pixels</span>
<a name="l01537"></a>01537 
<a name="l01538"></a>01538             cmp         ecx, LSCount
<a name="l01539"></a>01539             jbe         BNTrans1
<a name="l01540"></a>01540 
<a name="l01541"></a>01541             sub         ecx, LSCount
<a name="l01542"></a>01542             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, ecx
<a name="l01543"></a>01543             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, LSCount
<a name="l01544"></a>01544 
<a name="l01545"></a>01545 BNTrans1:
<a name="l01546"></a>01546             sub         LSCount, ecx
<a name="l01547"></a>01547 
<a name="l01548"></a>01548 BlitNTL1:
<a name="l01549"></a>01549 
<a name="l01550"></a>01550             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l01551"></a>01551             cmp         ax, usZLevel
<a name="l01552"></a>01552             ja          BlitNTL2
<a name="l01553"></a>01553 
<a name="l01554"></a>01554             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, usZLevel
<a name="l01555"></a>01555             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [ebx], ax
<a name="l01556"></a>01556 
<a name="l01557"></a>01557             xor         eax, eax
<a name="l01558"></a>01558 
<a name="l01559"></a>01559             mov         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l01560"></a>01560             mov         al, [edx+eax]
<a name="l01561"></a>01561             mov         [edi], al
<a name="l01562"></a>01562 
<a name="l01563"></a>01563 BlitNTL2:
<a name="l01564"></a>01564             inc         esi
<a name="l01565"></a>01565             inc         edi
<a name="l01566"></a>01566             add         ebx, 2
<a name="l01567"></a>01567             dec         cl
<a name="l01568"></a>01568             jnz         BlitNTL1
<a name="l01569"></a>01569 
<a name="l01570"></a>01570 <span class="comment">//BlitLineEnd:</span>
<a name="l01571"></a>01571             add         esi, Unblitted
<a name="l01572"></a>01572             jmp         BlitDispatch
<a name="l01573"></a>01573 
<a name="l01574"></a>01574 BlitTransparent:                                                              <span class="comment">// skip transparent pixels</span>
<a name="l01575"></a>01575 
<a name="l01576"></a>01576             and         ecx, 07fH
<a name="l01577"></a>01577             cmp         ecx, LSCount
<a name="l01578"></a>01578             jbe         BTrans1
<a name="l01579"></a>01579 
<a name="l01580"></a>01580             mov         ecx, LSCount
<a name="l01581"></a>01581 
<a name="l01582"></a>01582 BTrans1:
<a name="l01583"></a>01583 
<a name="l01584"></a>01584             sub         LSCount, ecx
<a name="l01585"></a>01585             add         edi, ecx
<a name="l01586"></a>01586 <span class="comment">//          shl         ecx, 1</span>
<a name="l01587"></a>01587             add   ecx, ecx
<a name="l01588"></a>01588             add         ebx, ecx
<a name="l01589"></a>01589             jmp         BlitDispatch
<a name="l01590"></a>01590 
<a name="l01591"></a>01591 
<a name="l01592"></a>01592 RightSkipLoop:                                                                      <span class="comment">// skip along until we hit and end-of-line marker</span>
<a name="l01593"></a>01593 
<a name="l01594"></a>01594 
<a name="l01595"></a>01595 RSLoop1:
<a name="l01596"></a>01596             mov         al, [esi]
<a name="l01597"></a>01597             inc         esi
<a name="l01598"></a>01598             or          al, al
<a name="l01599"></a>01599             jnz         RSLoop1
<a name="l01600"></a>01600 
<a name="l01601"></a>01601             <span class="comment">// check for incrementing of z level</span>
<a name="l01602"></a>01602             dec         usZLinesToGo
<a name="l01603"></a>01603             jnz         RSLoop2
<a name="l01604"></a>01604 
<a name="l01605"></a>01605 <span class="comment">//          mov         ax, usZLevel</span>
<a name="l01606"></a>01606 <span class="comment">//          add         ax, Z_SUBLEVELS</span>
<a name="l01607"></a>01607 <span class="comment">//          mov         usZLevel, ax</span>
<a name="l01608"></a>01608 
<a name="l01609"></a>01609 <span class="comment">//          mov         ax, WORLD_TILE_Y</span>
<a name="l01610"></a>01610 <span class="comment">//          mov         usZLinesToGo, ax</span>
<a name="l01611"></a>01611 
<a name="l01612"></a>01612 RSLoop2:
<a name="l01613"></a>01613             dec         BlitHeight
<a name="l01614"></a>01614             jz          BlitDone
<a name="l01615"></a>01615             add         edi, LineSkip
<a name="l01616"></a>01616             add         ebx, LineSkipZ
<a name="l01617"></a>01617 
<a name="l01618"></a>01618             jmp         LeftSkipSetup
<a name="l01619"></a>01619 
<a name="l01620"></a>01620 
<a name="l01621"></a>01621 BlitDone:
<a name="l01622"></a>01622       }
<a name="l01623"></a>01623 
<a name="l01624"></a>01624       <span class="keywordflow">return</span>(TRUE);
<a name="l01625"></a>01625 
<a name="l01626"></a>01626 }
<a name="l01627"></a>01627 
<a name="l01628"></a>01628 
<a name="l01629"></a>01629 <span class="comment">/**********************************************************************************************</span>
<a name="l01630"></a>01630 <span class="comment"> InitZBuffer</span>
<a name="l01631"></a>01631 <span class="comment"></span>
<a name="l01632"></a>01632 <span class="comment">      Allocates and initializes a Z buffer for use with the Z buffer blitters. Doesn't really do</span>
<a name="l01633"></a>01633 <span class="comment">      much except allocate a chunk of memory, and zero it.</span>
<a name="l01634"></a>01634 <span class="comment"></span>
<a name="l01635"></a>01635 <span class="comment">**********************************************************************************************/</span>
<a name="l01636"></a><a class="code" href="vobject__blitters_8h.html#9cdde10a94c70290dfd6ba757ed5ecb7">01636</a> <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *<a class="code" href="vobject__blitters_8cpp.html#9cdde10a94c70290dfd6ba757ed5ecb7">InitZBuffer</a>(<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiPitch, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiHeight)
<a name="l01637"></a>01637 {
<a name="l01638"></a>01638 <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer;
<a name="l01639"></a>01639       <span class="comment">/*</span>
<a name="l01640"></a>01640 <span class="comment">       *    ClippingRect was declared first with SCREEN_WIDTH and HEIGHT but now they are not</span>
<a name="l01641"></a>01641 <span class="comment">       *  constant so i will initialize it here </span>
<a name="l01642"></a>01642 <span class="comment">       *  any questions? joker</span>
<a name="l01643"></a>01643 <span class="comment">       */</span>
<a name="l01644"></a>01644       
<a name="l01645"></a>01645 
<a name="l01646"></a>01646       <a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>            = 0;
<a name="l01647"></a>01647       <a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>       = 0;
<a name="l01648"></a>01648       <a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>           = <a class="code" href="local_8h.html#599adbe412c60e0cc5abb86be7ee4507">SCREEN_WIDTH</a>;
<a name="l01649"></a>01649       <a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>    = <a class="code" href="local_8h.html#f1c710caf1e3a9e81829078054e83799">SCREEN_HEIGHT</a>;
<a name="l01650"></a>01650 
<a name="l01651"></a>01651       <span class="keywordflow">if</span>((pBuffer = (<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *) MemAlloc(uiPitch*uiHeight))==NULL)
<a name="l01652"></a>01652             <span class="keywordflow">return</span>(NULL);
<a name="l01653"></a>01653 
<a name="l01654"></a>01654       memset(pBuffer, 0, (uiPitch*uiHeight));
<a name="l01655"></a>01655       <span class="keywordflow">return</span>(pBuffer);
<a name="l01656"></a>01656 }
<a name="l01657"></a>01657 
<a name="l01658"></a>01658 <span class="comment">/**********************************************************************************************</span>
<a name="l01659"></a>01659 <span class="comment"> ShutdownZBuffer</span>
<a name="l01660"></a>01660 <span class="comment"></span>
<a name="l01661"></a>01661 <span class="comment">      Frees up the memory allocated for the Z buffer.</span>
<a name="l01662"></a>01662 <span class="comment"></span>
<a name="l01663"></a>01663 <span class="comment">**********************************************************************************************/</span>
<a name="l01664"></a><a class="code" href="vobject__blitters_8h.html#c5fb570675c1a74432aa210800639d81">01664</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#c5fb570675c1a74432aa210800639d81">ShutdownZBuffer</a>(<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer)
<a name="l01665"></a>01665 {
<a name="l01666"></a>01666       MemFree(pBuffer);
<a name="l01667"></a>01667       <span class="keywordflow">return</span>(TRUE);
<a name="l01668"></a>01668 }
<a name="l01669"></a>01669 
<a name="l01670"></a>01670 
<a name="l01671"></a><a class="code" href="vobject__blitters_8h.html#c1411e2498e9c9877391efcd3869a057">01671</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#c1411e2498e9c9877391efcd3869a057">BlitZRect</a>(<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiPitch, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sLeft, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sTop, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sRight, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sBottom, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue)
<a name="l01672"></a>01672 {
<a name="l01673"></a>01673 <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> sLeftClip, sTopClip, sRightClip, sBottomClip;
<a name="l01674"></a>01674 <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *pZPtr;
<a name="l01675"></a>01675 <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiLineSkip, usWidth, usHeight;
<a name="l01676"></a>01676 
<a name="l01677"></a>01677       sLeftClip=__max(<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>, sLeft);
<a name="l01678"></a>01678       sRightClip=__min(<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>, sRight);
<a name="l01679"></a>01679       sTopClip=__max(<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>, sTop);
<a name="l01680"></a>01680       sBottomClip=__min(<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>, sBottom);
<a name="l01681"></a>01681 
<a name="l01682"></a>01682       usHeight=sBottomClip-sTopClip;
<a name="l01683"></a>01683       usWidth=sRightClip-sLeftClip;
<a name="l01684"></a>01684       pZPtr=(<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer+(sTopClip*uiPitch)+(sLeftClip*2);
<a name="l01685"></a>01685       uiLineSkip=(uiPitch-(usWidth*2));
<a name="l01686"></a>01686 
<a name="l01687"></a>01687       <span class="keywordflow">if</span>((usHeight==0) || (usWidth==0))
<a name="l01688"></a>01688             <span class="keywordflow">return</span>(FALSE);
<a name="l01689"></a>01689 
<a name="l01690"></a>01690       __asm {
<a name="l01691"></a>01691             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, pZPtr
<a name="l01692"></a>01692             xor         eax, eax
<a name="l01693"></a>01693             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, usZValue
<a name="l01694"></a>01694             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, usWidth
<a name="l01695"></a>01695             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, usHeight
<a name="l01696"></a>01696 
<a name="l01697"></a>01697 BZR1:
<a name="l01698"></a>01698             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, ebx
<a name="l01699"></a>01699             rep         stosw
<a name="l01700"></a>01700             add         edi, uiLineSkip
<a name="l01701"></a>01701 
<a name="l01702"></a>01702             dec         edx
<a name="l01703"></a>01703             jnz         BZR1
<a name="l01704"></a>01704       }
<a name="l01705"></a>01705 
<a name="l01706"></a>01706       <span class="keywordflow">return</span>(TRUE);
<a name="l01707"></a>01707 }
<a name="l01708"></a>01708 
<a name="l01709"></a>01709 
<a name="l01710"></a>01710 
<a name="l01711"></a>01711 
<a name="l01712"></a>01712 
<a name="l01713"></a>01713 
<a name="l01714"></a>01714 <span class="comment">//*****************************************************************************</span>
<a name="l01715"></a>01715 <span class="comment">//** 8 Bit Blitters</span>
<a name="l01716"></a>01716 <span class="comment">//**</span>
<a name="l01717"></a>01717 <span class="comment">//*****************************************************************************</span>
<a name="l01718"></a>01718 
<a name="l01719"></a>01719 
<a name="l01720"></a>01720 <span class="comment">/**********************************************************************************************</span>
<a name="l01721"></a>01721 <span class="comment"> Blt8BPPDataTo8BPPBuffer</span>
<a name="l01722"></a>01722 <span class="comment"></span>
<a name="l01723"></a>01723 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l01724"></a>01724 <span class="comment">      buffer as a destination.</span>
<a name="l01725"></a>01725 <span class="comment"></span>
<a name="l01726"></a>01726 <span class="comment">**********************************************************************************************/</span>
<a name="l01727"></a><a class="code" href="vobject__blitters_8h.html#ac71fa07c747f10f105ba93d669d99c5">01727</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#ac71fa07c747f10f105ba93d669d99c5">Blt8BPPDataTo8BPPBuffer</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex )
<a name="l01728"></a>01728 {
<a name="l01729"></a>01729       <span class="keyword">static</span> <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l01730"></a>01730       <span class="keyword">static</span> <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth;
<a name="l01731"></a>01731       <span class="keyword">static</span> <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>       *SrcPtr, *DestPtr;
<a name="l01732"></a>01732       <span class="keyword">static</span> <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l01733"></a>01733       <span class="keyword">static</span> <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l01734"></a>01734       <span class="keyword">static</span> <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>       iTempX, iTempY;
<a name="l01735"></a>01735 
<a name="l01736"></a>01736 
<a name="l01737"></a>01737       <span class="comment">// Assertions</span>
<a name="l01738"></a>01738       Assert( hSrcVObject != NULL );
<a name="l01739"></a>01739       Assert( pBuffer != NULL );
<a name="l01740"></a>01740 
<a name="l01741"></a>01741       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l01742"></a>01742       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l01743"></a>01743       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l01744"></a>01744       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l01745"></a>01745       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l01746"></a>01746 
<a name="l01747"></a>01747       <span class="comment">// Add to start position of dest buffer</span>
<a name="l01748"></a>01748       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l01749"></a>01749       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l01750"></a>01750 
<a name="l01751"></a>01751       <span class="comment">// Validations</span>
<a name="l01752"></a>01752       CHECKF( iTempX &gt;= 0 );
<a name="l01753"></a>01753       CHECKF( iTempY &gt;= 0 );
<a name="l01754"></a>01754 
<a name="l01755"></a>01755 
<a name="l01756"></a>01756       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l01757"></a>01757       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*iTempY) + (iTempX);
<a name="l01758"></a>01758       LineSkip=(uiDestPitchBYTES-(usWidth));
<a name="l01759"></a>01759 
<a name="l01760"></a>01760       __asm {
<a name="l01761"></a>01761 
<a name="l01762"></a>01762             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l01763"></a>01763             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l01764"></a>01764             xor         eax, eax
<a name="l01765"></a>01765             xor         ebx, ebx
<a name="l01766"></a>01766             xor         ecx, ecx
<a name="l01767"></a>01767 
<a name="l01768"></a>01768 BlitDispatch:
<a name="l01769"></a>01769 
<a name="l01770"></a>01770             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l01771"></a>01771             inc         esi
<a name="l01772"></a>01772             or          cl, cl
<a name="l01773"></a>01773             js          BlitTransparent
<a name="l01774"></a>01774             jz          BlitDoneLine
<a name="l01775"></a>01775 
<a name="l01776"></a>01776 <span class="comment">//BlitNonTransLoop:</span>
<a name="l01777"></a>01777 
<a name="l01778"></a>01778             clc
<a name="l01779"></a>01779             rcr         cl, 1
<a name="l01780"></a>01780             jnc         BlitNTL2
<a name="l01781"></a>01781 
<a name="l01782"></a>01782             movsb
<a name="l01783"></a>01783 
<a name="l01784"></a>01784 BlitNTL2:
<a name="l01785"></a>01785             clc
<a name="l01786"></a>01786             rcr         cl, 1
<a name="l01787"></a>01787             jnc         BlitNTL3
<a name="l01788"></a>01788 
<a name="l01789"></a>01789             movsw
<a name="l01790"></a>01790 
<a name="l01791"></a>01791 BlitNTL3:
<a name="l01792"></a>01792 
<a name="l01793"></a>01793             or          cl, cl
<a name="l01794"></a>01794             jz          BlitDispatch
<a name="l01795"></a>01795 
<a name="l01796"></a>01796             xor         ebx, ebx
<a name="l01797"></a>01797 
<a name="l01798"></a>01798 <span class="comment">//BlitNTL4:</span>
<a name="l01799"></a>01799 
<a name="l01800"></a>01800             rep         movsd
<a name="l01801"></a>01801 
<a name="l01802"></a>01802             jmp         BlitDispatch
<a name="l01803"></a>01803 
<a name="l01804"></a>01804 BlitTransparent:
<a name="l01805"></a>01805 
<a name="l01806"></a>01806             and         ecx, 07fH
<a name="l01807"></a>01807             xor         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, al
<a name="l01808"></a>01808             rep         stosb
<a name="l01809"></a>01809 
<a name="l01810"></a>01810             jmp         BlitDispatch
<a name="l01811"></a>01811 
<a name="l01812"></a>01812 
<a name="l01813"></a>01813 BlitDoneLine:
<a name="l01814"></a>01814 
<a name="l01815"></a>01815             dec         usHeight
<a name="l01816"></a>01816             jz          BlitDone
<a name="l01817"></a>01817             add         edi, LineSkip
<a name="l01818"></a>01818             jmp         BlitDispatch
<a name="l01819"></a>01819 
<a name="l01820"></a>01820 
<a name="l01821"></a>01821 BlitDone:
<a name="l01822"></a>01822       }
<a name="l01823"></a>01823 
<a name="l01824"></a>01824       <span class="keywordflow">return</span>(TRUE);
<a name="l01825"></a>01825 
<a name="l01826"></a>01826 }
<a name="l01827"></a>01827 
<a name="l01828"></a>01828 <span class="comment">/**********************************************************************************************</span>
<a name="l01829"></a>01829 <span class="comment"> Blt8BPPDataTo8BPPBufferMonoShadow</span>
<a name="l01830"></a>01830 <span class="comment"></span>
<a name="l01831"></a>01831 <span class="comment">      Uses a bitmap an 8BPP template for blitting. Anywhere a 1 appears in the bitmap, a shadow</span>
<a name="l01832"></a>01832 <span class="comment">      is blitted to the destination (a black pixel). Any other value above zero is considered a</span>
<a name="l01833"></a>01833 <span class="comment">      forground color, and zero is background. If the parameter for the background color is zero,</span>
<a name="l01834"></a>01834 <span class="comment">      transparency is used for the background.</span>
<a name="l01835"></a>01835 <span class="comment"></span>
<a name="l01836"></a>01836 <span class="comment">**********************************************************************************************/</span>
<a name="l01837"></a><a class="code" href="vobject__blitters_8cpp.html#1a91a90e7a756f91b8e791303f863db0">01837</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#1a91a90e7a756f91b8e791303f863db0">Blt8BPPDataTo8BPPBufferMonoShadow</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubForeground, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubBackground)
<a name="l01838"></a>01838 {
<a name="l01839"></a>01839       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l01840"></a>01840       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth;
<a name="l01841"></a>01841       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l01842"></a>01842       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip, LineSkipZ;
<a name="l01843"></a>01843       <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l01844"></a>01844       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l01845"></a>01845       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *pPal8BPP;
<a name="l01846"></a>01846 
<a name="l01847"></a>01847 
<a name="l01848"></a>01848       <span class="comment">// Assertions</span>
<a name="l01849"></a>01849       Assert( hSrcVObject != NULL );
<a name="l01850"></a>01850       Assert( pBuffer != NULL );
<a name="l01851"></a>01851 
<a name="l01852"></a>01852       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l01853"></a>01853       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l01854"></a>01854       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l01855"></a>01855       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l01856"></a>01856       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l01857"></a>01857 
<a name="l01858"></a>01858       <span class="comment">// Add to start position of dest buffer</span>
<a name="l01859"></a>01859       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l01860"></a>01860       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l01861"></a>01861 
<a name="l01862"></a>01862       <span class="comment">// Validations</span>
<a name="l01863"></a>01863       CHECKF( iTempX &gt;= 0 );
<a name="l01864"></a>01864       CHECKF( iTempY &gt;= 0 );
<a name="l01865"></a>01865 
<a name="l01866"></a>01866 
<a name="l01867"></a>01867       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l01868"></a>01868       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*iTempY) + (iTempX);
<a name="l01869"></a>01869       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*2*iTempY) + (iTempX*2);
<a name="l01870"></a>01870       LineSkip=(uiDestPitchBYTES-(usWidth));
<a name="l01871"></a>01871       LineSkipZ=LineSkip*2;
<a name="l01872"></a>01872       pPal8BPP=hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#152256552f959a5d90dbd886d22fb679">pShade8</a>;
<a name="l01873"></a>01873 
<a name="l01874"></a>01874       __asm {
<a name="l01875"></a>01875 
<a name="l01876"></a>01876             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l01877"></a>01877             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l01878"></a>01878             xor         eax, eax
<a name="l01879"></a>01879             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l01880"></a>01880             xor         ecx, ecx
<a name="l01881"></a>01881             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, pPal8BPP
<a name="l01882"></a>01882 
<a name="l01883"></a>01883 BlitDispatch:
<a name="l01884"></a>01884 
<a name="l01885"></a>01885             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l01886"></a>01886             inc         esi
<a name="l01887"></a>01887             or          cl, cl
<a name="l01888"></a>01888             js          BlitTransparent
<a name="l01889"></a>01889             jz          BlitDoneLine
<a name="l01890"></a>01890 
<a name="l01891"></a>01891 <span class="comment">//BlitNonTransLoop:</span>
<a name="l01892"></a>01892 
<a name="l01893"></a>01893 BlitNTL4:
<a name="l01894"></a>01894 
<a name="l01895"></a>01895             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l01896"></a>01896             cmp         al, 1
<a name="l01897"></a>01897             jne         <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>
<a name="l01898"></a>01898 
<a name="l01899"></a>01899             xor         al, al
<a name="l01900"></a>01900             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], al
<a name="l01901"></a>01901             jmp         BlitNTL5
<a name="l01902"></a>01902 
<a name="l01903"></a>01903 <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>:
<a name="l01904"></a>01904             or          al, al
<a name="l01905"></a>01905             jz          <a class="code" href="vobject__blitters_8cpp.html#d660d2ba340c8ef5d2d80c6365ad838f">BlitNTL7</a>
<a name="l01906"></a>01906 
<a name="l01907"></a>01907             mov         al, ubForeground
<a name="l01908"></a>01908             mov         [edi], al
<a name="l01909"></a>01909             jmp         BlitNTL5
<a name="l01910"></a>01910 
<a name="l01911"></a>01911 <a class="code" href="vobject__blitters_8cpp.html#d660d2ba340c8ef5d2d80c6365ad838f">BlitNTL7</a>:
<a name="l01912"></a>01912             cmp         ubBackground, 0
<a name="l01913"></a>01913             je          BlitNTL5
<a name="l01914"></a>01914 
<a name="l01915"></a>01915             mov         al, ubBackground
<a name="l01916"></a>01916             mov         [edi], al
<a name="l01917"></a>01917 
<a name="l01918"></a>01918 BlitNTL5:
<a name="l01919"></a>01919             inc         esi
<a name="l01920"></a>01920             inc         edi
<a name="l01921"></a>01921             add         ebx, 2
<a name="l01922"></a>01922             dec         cl
<a name="l01923"></a>01923             jnz         BlitNTL4
<a name="l01924"></a>01924 
<a name="l01925"></a>01925             jmp         BlitDispatch
<a name="l01926"></a>01926 
<a name="l01927"></a>01927 
<a name="l01928"></a>01928 BlitTransparent:
<a name="l01929"></a>01929             and         ecx, 07fH
<a name="l01930"></a>01930 
<a name="l01931"></a>01931             mov         al, ubBackground
<a name="l01932"></a>01932             or          al, al
<a name="l01933"></a>01933             jz          BlitTrans1
<a name="l01934"></a>01934 
<a name="l01935"></a>01935             rep         stosb
<a name="l01936"></a>01936             jmp         BlitDispatch
<a name="l01937"></a>01937 
<a name="l01938"></a>01938 
<a name="l01939"></a>01939 BlitTrans1:
<a name="l01940"></a>01940             add         edi, ecx
<a name="l01941"></a>01941             jmp         BlitDispatch
<a name="l01942"></a>01942 
<a name="l01943"></a>01943 
<a name="l01944"></a>01944 BlitDoneLine:
<a name="l01945"></a>01945 
<a name="l01946"></a>01946             dec         usHeight
<a name="l01947"></a>01947             jz          BlitDone
<a name="l01948"></a>01948             add         edi, LineSkip
<a name="l01949"></a>01949             add         ebx, LineSkipZ
<a name="l01950"></a>01950             jmp         BlitDispatch
<a name="l01951"></a>01951 
<a name="l01952"></a>01952 
<a name="l01953"></a>01953 BlitDone:
<a name="l01954"></a>01954       }
<a name="l01955"></a>01955 
<a name="l01956"></a>01956       <span class="keywordflow">return</span>(TRUE);
<a name="l01957"></a>01957 
<a name="l01958"></a>01958 }
<a name="l01959"></a>01959 
<a name="l01960"></a>01960 
<a name="l01961"></a>01961 <span class="comment">/**********************************************************************************************</span>
<a name="l01962"></a>01962 <span class="comment"> Blt8BPPDataTo8BPPBufferMonoShadowClip</span>
<a name="l01963"></a>01963 <span class="comment"></span>
<a name="l01964"></a>01964 <span class="comment">      Uses a bitmap an 8BPP template for blitting. Anywhere a 1 appears in the bitmap, a shadow</span>
<a name="l01965"></a>01965 <span class="comment">      is blitted to the destination (a black pixel). Any other value above zero is considered a</span>
<a name="l01966"></a>01966 <span class="comment">      forground color, and zero is background. If the parameter for the background color is zero,</span>
<a name="l01967"></a>01967 <span class="comment">      transparency is used for the background.</span>
<a name="l01968"></a>01968 <span class="comment"></span>
<a name="l01969"></a>01969 <span class="comment">      **********************************************************************************************/</span>
<a name="l01970"></a><a class="code" href="vobject__blitters_8h.html#a4dd6918113e1030457f2e5afcb0fb5f">01970</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#a4dd6918113e1030457f2e5afcb0fb5f">Blt8BPPDataTo8BPPBufferMonoShadowClip</a>( <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="structSGPRect.html">SGPRect</a> *clipregion, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubForeground, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubBackground)
<a name="l01971"></a>01971 {
<a name="l01972"></a>01972       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l01973"></a>01973       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth, Unblitted;
<a name="l01974"></a>01974       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr;
<a name="l01975"></a>01975       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip, LineSkipZ;
<a name="l01976"></a>01976   <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l01977"></a>01977       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY, LeftSkip, RightSkip, TopSkip, BottomSkip, BlitLength, BlitHeight, LSCount;
<a name="l01978"></a>01978       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  ClipX1, ClipY1, ClipX2, ClipY2;
<a name="l01979"></a>01979       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *pPal8BPP;
<a name="l01980"></a>01980 
<a name="l01981"></a>01981       <span class="comment">// Assertions</span>
<a name="l01982"></a>01982       Assert( hSrcVObject != NULL );
<a name="l01983"></a>01983       Assert( pBuffer != NULL );
<a name="l01984"></a>01984 
<a name="l01985"></a>01985       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l01986"></a>01986       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l01987"></a>01987       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l01988"></a>01988       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l01989"></a>01989       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l01990"></a>01990 
<a name="l01991"></a>01991       <span class="comment">// Add to start position of dest buffer</span>
<a name="l01992"></a>01992       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l01993"></a>01993       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l01994"></a>01994 
<a name="l01995"></a>01995       <span class="keywordflow">if</span>(clipregion==NULL)
<a name="l01996"></a>01996       {
<a name="l01997"></a>01997             ClipX1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l01998"></a>01998             ClipY1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l01999"></a>01999             ClipX2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l02000"></a>02000             ClipY2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l02001"></a>02001       }
<a name="l02002"></a>02002       <span class="keywordflow">else</span>
<a name="l02003"></a>02003       {
<a name="l02004"></a>02004             ClipX1=clipregion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l02005"></a>02005             ClipY1=clipregion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l02006"></a>02006             ClipX2=clipregion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l02007"></a>02007             ClipY2=clipregion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l02008"></a>02008       }
<a name="l02009"></a>02009 
<a name="l02010"></a>02010       <span class="comment">// Calculate rows hanging off each side of the screen</span>
<a name="l02011"></a>02011       LeftSkip=__min(ClipX1 - min(ClipX1, iTempX), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l02012"></a>02012       RightSkip=__min(max(ClipX2, (iTempX+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth)) - ClipX2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l02013"></a>02013       TopSkip=__min(ClipY1 - __min(ClipY1, iTempY), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l02014"></a>02014       BottomSkip=__min(__max(ClipY2, (iTempY+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight)) - ClipY2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l02015"></a>02015 
<a name="l02016"></a>02016       <span class="comment">// calculate the remaining rows and columns to blit</span>
<a name="l02017"></a>02017       BlitLength=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth-LeftSkip-RightSkip);
<a name="l02018"></a>02018       BlitHeight=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight-TopSkip-BottomSkip);
<a name="l02019"></a>02019 
<a name="l02020"></a>02020       <span class="comment">// check if whole thing is clipped</span>
<a name="l02021"></a>02021       <span class="keywordflow">if</span>((LeftSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth) || (RightSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth))
<a name="l02022"></a>02022             <span class="keywordflow">return</span>(TRUE);
<a name="l02023"></a>02023 
<a name="l02024"></a>02024       <span class="comment">// check if whole thing is clipped</span>
<a name="l02025"></a>02025       <span class="keywordflow">if</span>((TopSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight) || (BottomSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight))
<a name="l02026"></a>02026             <span class="keywordflow">return</span>(TRUE);
<a name="l02027"></a>02027 
<a name="l02028"></a>02028       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l02029"></a>02029       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip));
<a name="l02030"></a>02030       LineSkip=(uiDestPitchBYTES-(BlitLength));
<a name="l02031"></a>02031       LineSkipZ=LineSkip*2;
<a name="l02032"></a>02032       pPal8BPP=hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#152256552f959a5d90dbd886d22fb679">pShade8</a>;
<a name="l02033"></a>02033 
<a name="l02034"></a>02034       __asm {
<a name="l02035"></a>02035 
<a name="l02036"></a>02036             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l02037"></a>02037             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l02038"></a>02038             xor         eax, eax
<a name="l02039"></a>02039             xor         ecx, ecx
<a name="l02040"></a>02040             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, pPal8BPP
<a name="l02041"></a>02041 
<a name="l02042"></a>02042             cmp         TopSkip, 0                                      <span class="comment">// check for nothing clipped on top</span>
<a name="l02043"></a>02043             je          LeftSkipSetup
<a name="l02044"></a>02044 
<a name="l02045"></a>02045 TopSkipLoop:                                                            <span class="comment">// Skips the number of lines clipped at the top</span>
<a name="l02046"></a>02046 
<a name="l02047"></a>02047             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l02048"></a>02048             inc         esi
<a name="l02049"></a>02049             or          cl, cl
<a name="l02050"></a>02050             js          TopSkipLoop
<a name="l02051"></a>02051             jz          TSEndLine
<a name="l02052"></a>02052 
<a name="l02053"></a>02053             add         esi, ecx
<a name="l02054"></a>02054             jmp         TopSkipLoop
<a name="l02055"></a>02055 
<a name="l02056"></a>02056 TSEndLine:
<a name="l02057"></a>02057             dec         TopSkip
<a name="l02058"></a>02058             jnz         TopSkipLoop
<a name="l02059"></a>02059 
<a name="l02060"></a>02060 LeftSkipSetup:
<a name="l02061"></a>02061 
<a name="l02062"></a>02062             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l02063"></a>02063             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, LeftSkip
<a name="l02064"></a>02064             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l02065"></a>02065             or          eax, eax
<a name="l02066"></a>02066             jz          BlitLineSetup
<a name="l02067"></a>02067 
<a name="l02068"></a>02068 LeftSkipLoop:
<a name="l02069"></a>02069 
<a name="l02070"></a>02070             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l02071"></a>02071             inc         esi
<a name="l02072"></a>02072 
<a name="l02073"></a>02073             or          cl, cl
<a name="l02074"></a>02074             js          LSTrans
<a name="l02075"></a>02075 
<a name="l02076"></a>02076             cmp         ecx, LSCount
<a name="l02077"></a>02077             je          LSSkip2                                               <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l02078"></a>02078             jb          LSSkip1                                               <span class="comment">// if less, skip whole thing</span>
<a name="l02079"></a>02079 
<a name="l02080"></a>02080             add         esi, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l02081"></a>02081             sub         ecx, LSCount
<a name="l02082"></a>02082             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l02083"></a>02083             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l02084"></a>02084             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l02085"></a>02085             jmp         BlitNonTransLoop
<a name="l02086"></a>02086 
<a name="l02087"></a>02087 LSSkip2:
<a name="l02088"></a>02088             add         esi, ecx                                        <span class="comment">// skip whole run, and start blit with new run</span>
<a name="l02089"></a>02089             jmp         BlitLineSetup
<a name="l02090"></a>02090 
<a name="l02091"></a>02091 
<a name="l02092"></a>02092 LSSkip1:
<a name="l02093"></a>02093             add         esi, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l02094"></a>02094             sub         LSCount, ecx
<a name="l02095"></a>02095             jmp         LeftSkipLoop
<a name="l02096"></a>02096 
<a name="l02097"></a>02097 
<a name="l02098"></a>02098 LSTrans:
<a name="l02099"></a>02099             and         ecx, 07fH
<a name="l02100"></a>02100             cmp         ecx, LSCount
<a name="l02101"></a>02101             je          BlitLineSetup                             <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l02102"></a>02102             jb          LSTrans1                                        <span class="comment">// if less, skip whole thing</span>
<a name="l02103"></a>02103 
<a name="l02104"></a>02104             sub         ecx, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l02105"></a>02105             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l02106"></a>02106             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l02107"></a>02107             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l02108"></a>02108             jmp         BlitTransparent
<a name="l02109"></a>02109 
<a name="l02110"></a>02110 
<a name="l02111"></a>02111 LSTrans1:
<a name="l02112"></a>02112             sub         LSCount, ecx                                          <span class="comment">// skip whole run, continue skipping</span>
<a name="l02113"></a>02113             jmp         LeftSkipLoop
<a name="l02114"></a>02114 
<a name="l02115"></a>02115 
<a name="l02116"></a>02116 BlitLineSetup:                                                    <span class="comment">// Does any actual blitting (trans/non) for the line</span>
<a name="l02117"></a>02117             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l02118"></a>02118             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l02119"></a>02119             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l02120"></a>02120 
<a name="l02121"></a>02121 BlitDispatch:
<a name="l02122"></a>02122 
<a name="l02123"></a>02123             cmp         LSCount, 0                                      <span class="comment">// Check to see if we're done blitting</span>
<a name="l02124"></a>02124             je          RightSkipLoop
<a name="l02125"></a>02125 
<a name="l02126"></a>02126             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l02127"></a>02127             inc         esi
<a name="l02128"></a>02128             or          cl, cl
<a name="l02129"></a>02129             js          BlitTransparent
<a name="l02130"></a>02130 
<a name="l02131"></a>02131 BlitNonTransLoop:                                           <span class="comment">// blit non-transparent pixels</span>
<a name="l02132"></a>02132 
<a name="l02133"></a>02133             cmp         ecx, LSCount
<a name="l02134"></a>02134             jbe         BNTrans1
<a name="l02135"></a>02135 
<a name="l02136"></a>02136             sub         ecx, LSCount
<a name="l02137"></a>02137             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, ecx
<a name="l02138"></a>02138             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, LSCount
<a name="l02139"></a>02139 
<a name="l02140"></a>02140 BNTrans1:
<a name="l02141"></a>02141             sub         LSCount, ecx
<a name="l02142"></a>02142 
<a name="l02143"></a>02143 BlitNTL1:
<a name="l02144"></a>02144             xor         eax, eax
<a name="l02145"></a>02145             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l02146"></a>02146             cmp         al, 1
<a name="l02147"></a>02147             jne         BlitNTL3
<a name="l02148"></a>02148 
<a name="l02149"></a>02149             <span class="comment">// write shadow pixel</span>
<a name="l02150"></a>02150             xor         al, al
<a name="l02151"></a>02151             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], al
<a name="l02152"></a>02152             jmp         BlitNTL2
<a name="l02153"></a>02153 
<a name="l02154"></a>02154 BlitNTL3:
<a name="l02155"></a>02155             or          al, al
<a name="l02156"></a>02156             jz          BlitNTL4
<a name="l02157"></a>02157 
<a name="l02158"></a>02158             <span class="comment">// write foreground pixel</span>
<a name="l02159"></a>02159             mov         al, ubForeground
<a name="l02160"></a>02160             mov         [edi], al
<a name="l02161"></a>02161             jmp         BlitNTL2
<a name="l02162"></a>02162 
<a name="l02163"></a>02163 BlitNTL4:
<a name="l02164"></a>02164             cmp         ubBackground, 0
<a name="l02165"></a>02165             je          BlitNTL2
<a name="l02166"></a>02166 
<a name="l02167"></a>02167             <span class="comment">//write background pixel</span>
<a name="l02168"></a>02168             mov         al, ubBackground
<a name="l02169"></a>02169             mov         [edi], al
<a name="l02170"></a>02170 
<a name="l02171"></a>02171 BlitNTL2:
<a name="l02172"></a>02172             inc         esi
<a name="l02173"></a>02173             inc         edi
<a name="l02174"></a>02174             dec         cl
<a name="l02175"></a>02175             jnz         BlitNTL1
<a name="l02176"></a>02176 
<a name="l02177"></a>02177 <span class="comment">//BlitLineEnd:</span>
<a name="l02178"></a>02178             add         esi, Unblitted
<a name="l02179"></a>02179             jmp         BlitDispatch
<a name="l02180"></a>02180 
<a name="l02181"></a>02181 BlitTransparent:                                                              <span class="comment">// skip transparent pixels</span>
<a name="l02182"></a>02182             and         ecx, 07fH
<a name="l02183"></a>02183             cmp         ecx, LSCount
<a name="l02184"></a>02184             jbe         BTrans1
<a name="l02185"></a>02185 
<a name="l02186"></a>02186             mov         ecx, LSCount
<a name="l02187"></a>02187 
<a name="l02188"></a>02188 BTrans1:
<a name="l02189"></a>02189             sub         LSCount, ecx
<a name="l02190"></a>02190 
<a name="l02191"></a>02191             mov         al, ubBackground
<a name="l02192"></a>02192             or          al, al
<a name="l02193"></a>02193             jz          BTrans2
<a name="l02194"></a>02194 
<a name="l02195"></a>02195             rep         stosb
<a name="l02196"></a>02196             jmp         BlitDispatch
<a name="l02197"></a>02197 
<a name="l02198"></a>02198 BTrans2:
<a name="l02199"></a>02199             add         edi, ecx
<a name="l02200"></a>02200             jmp         BlitDispatch
<a name="l02201"></a>02201 
<a name="l02202"></a>02202 
<a name="l02203"></a>02203 RightSkipLoop:                                                                      <span class="comment">// skip along until we hit and end-of-line marker</span>
<a name="l02204"></a>02204 
<a name="l02205"></a>02205 
<a name="l02206"></a>02206 RSLoop1:
<a name="l02207"></a>02207             mov         al, [esi]
<a name="l02208"></a>02208             inc         esi
<a name="l02209"></a>02209             or          al, al
<a name="l02210"></a>02210             jnz         RSLoop1
<a name="l02211"></a>02211 
<a name="l02212"></a>02212             dec         BlitHeight
<a name="l02213"></a>02213             jz          BlitDone
<a name="l02214"></a>02214             add         edi, LineSkip
<a name="l02215"></a>02215 
<a name="l02216"></a>02216             jmp         LeftSkipSetup
<a name="l02217"></a>02217 
<a name="l02218"></a>02218 
<a name="l02219"></a>02219 BlitDone:
<a name="l02220"></a>02220       }
<a name="l02221"></a>02221 
<a name="l02222"></a>02222       <span class="keywordflow">return</span>(TRUE);
<a name="l02223"></a>02223 
<a name="l02224"></a>02224 }
<a name="l02225"></a>02225 
<a name="l02226"></a>02226 <span class="comment">/**********************************************************************************************</span>
<a name="l02227"></a>02227 <span class="comment"> Blt8BPPDataTo8BPPBufferTransZPixelate</span>
<a name="l02228"></a>02228 <span class="comment"></span>
<a name="l02229"></a>02229 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l02230"></a>02230 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l02231"></a>02231 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on, and the Z value is</span>
<a name="l02232"></a>02232 <span class="comment">      updated to the current value, for any non-transparent pixels. The Z-buffer is 16 bit, and</span>
<a name="l02233"></a>02233 <span class="comment">      must be the same dimensions (including Pitch) as the destination.</span>
<a name="l02234"></a>02234 <span class="comment"></span>
<a name="l02235"></a>02235 <span class="comment">**********************************************************************************************/</span>
<a name="l02236"></a><a class="code" href="vobject__blitters_8h.html#7f2a52a21029039e874dccd24a02ef43">02236</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#7f2a52a21029039e874dccd24a02ef43">Blt8BPPDataTo8BPPBufferTransZPixelate</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex )
<a name="l02237"></a>02237 {
<a name="l02238"></a>02238       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l02239"></a>02239       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth;
<a name="l02240"></a>02240       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l02241"></a>02241       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip, LineSkipZ;
<a name="l02242"></a>02242       <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l02243"></a>02243       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l02244"></a>02244       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiLineFlag;
<a name="l02245"></a>02245       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *pPal8BPP;
<a name="l02246"></a>02246 
<a name="l02247"></a>02247       <span class="comment">// Assertions</span>
<a name="l02248"></a>02248       Assert( hSrcVObject != NULL );
<a name="l02249"></a>02249       Assert( pBuffer != NULL );
<a name="l02250"></a>02250 
<a name="l02251"></a>02251       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l02252"></a>02252       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l02253"></a>02253       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l02254"></a>02254       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l02255"></a>02255       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l02256"></a>02256 
<a name="l02257"></a>02257       <span class="comment">// Add to start position of dest buffer</span>
<a name="l02258"></a>02258       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l02259"></a>02259       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l02260"></a>02260 
<a name="l02261"></a>02261       <span class="comment">// Validations</span>
<a name="l02262"></a>02262       CHECKF( iTempX &gt;= 0 );
<a name="l02263"></a>02263       CHECKF( iTempY &gt;= 0 );
<a name="l02264"></a>02264 
<a name="l02265"></a>02265 
<a name="l02266"></a>02266       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l02267"></a>02267       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*iTempY) + (iTempX);
<a name="l02268"></a>02268       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*2*iTempY) + (iTempX*2);
<a name="l02269"></a>02269       pPal8BPP = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#152256552f959a5d90dbd886d22fb679">pShade8</a>;
<a name="l02270"></a>02270       LineSkip=(uiDestPitchBYTES-(usWidth));
<a name="l02271"></a>02271       LineSkipZ=LineSkip*2;
<a name="l02272"></a>02272       uiLineFlag=(iTempY&amp;1);
<a name="l02273"></a>02273 
<a name="l02274"></a>02274 
<a name="l02275"></a>02275       __asm {
<a name="l02276"></a>02276 
<a name="l02277"></a>02277             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l02278"></a>02278             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l02279"></a>02279             xor         eax, eax
<a name="l02280"></a>02280             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l02281"></a>02281             xor         ecx, ecx
<a name="l02282"></a>02282             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, pPal8BPP
<a name="l02283"></a>02283 
<a name="l02284"></a>02284 BlitDispatch:
<a name="l02285"></a>02285 
<a name="l02286"></a>02286             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l02287"></a>02287             inc         esi
<a name="l02288"></a>02288             or          cl, cl
<a name="l02289"></a>02289             js          BlitTransparent
<a name="l02290"></a>02290             jz          BlitDoneLine
<a name="l02291"></a>02291 
<a name="l02292"></a>02292 <span class="comment">//BlitNonTransLoop:</span>
<a name="l02293"></a>02293 
<a name="l02294"></a>02294 BlitNTL4:
<a name="l02295"></a>02295             <a class="code" href="structtest.html">test</a>  uiLineFlag, 1
<a name="l02296"></a>02296             jz          <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>
<a name="l02297"></a>02297 
<a name="l02298"></a>02298             <a class="code" href="structtest.html">test</a>  edi, 2
<a name="l02299"></a>02299             jz          BlitNTL5
<a name="l02300"></a>02300             jmp         <a class="code" href="vobject__blitters_8cpp.html#d660d2ba340c8ef5d2d80c6365ad838f">BlitNTL7</a>
<a name="l02301"></a>02301 
<a name="l02302"></a>02302 <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>:
<a name="l02303"></a>02303             <a class="code" href="structtest.html">test</a>  edi, 2
<a name="l02304"></a>02304             jnz         BlitNTL5
<a name="l02305"></a>02305 
<a name="l02306"></a>02306 <a class="code" href="vobject__blitters_8cpp.html#d660d2ba340c8ef5d2d80c6365ad838f">BlitNTL7</a>:
<a name="l02307"></a>02307 
<a name="l02308"></a>02308             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l02309"></a>02309             cmp         ax, usZValue
<a name="l02310"></a>02310             ja          BlitNTL5
<a name="l02311"></a>02311 
<a name="l02312"></a>02312             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, usZValue
<a name="l02313"></a>02313             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [ebx], ax
<a name="l02314"></a>02314 
<a name="l02315"></a>02315             mov         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l02316"></a>02316             mov         al, [edx+eax]
<a name="l02317"></a>02317             mov         [<a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>], al
<a name="l02318"></a>02318 
<a name="l02319"></a>02319 BlitNTL5:
<a name="l02320"></a>02320             inc         esi
<a name="l02321"></a>02321             inc         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>
<a name="l02322"></a>02322             add         ebx, 2
<a name="l02323"></a>02323             dec         cl
<a name="l02324"></a>02324             jnz         BlitNTL4
<a name="l02325"></a>02325 
<a name="l02326"></a>02326             jmp         BlitDispatch
<a name="l02327"></a>02327 
<a name="l02328"></a>02328 
<a name="l02329"></a>02329 BlitTransparent:
<a name="l02330"></a>02330 
<a name="l02331"></a>02331             and         ecx, 07fH
<a name="l02332"></a>02332             add         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, ecx
<a name="l02333"></a>02333 <span class="comment">//          shl         ecx, 1</span>
<a name="l02334"></a>02334             add   ecx, ecx
<a name="l02335"></a>02335             add         ebx, ecx
<a name="l02336"></a>02336             jmp         BlitDispatch
<a name="l02337"></a>02337 
<a name="l02338"></a>02338 
<a name="l02339"></a>02339 BlitDoneLine:
<a name="l02340"></a>02340 
<a name="l02341"></a>02341             dec         usHeight
<a name="l02342"></a>02342             jz          BlitDone
<a name="l02343"></a>02343             xor         uiLineFlag, 1
<a name="l02344"></a>02344             add         edi, LineSkip
<a name="l02345"></a>02345             add         ebx, LineSkipZ
<a name="l02346"></a>02346             jmp         BlitDispatch
<a name="l02347"></a>02347 
<a name="l02348"></a>02348 
<a name="l02349"></a>02349 BlitDone:
<a name="l02350"></a>02350       }
<a name="l02351"></a>02351 
<a name="l02352"></a>02352       <span class="keywordflow">return</span>(TRUE);
<a name="l02353"></a>02353 
<a name="l02354"></a>02354 }
<a name="l02355"></a>02355 
<a name="l02356"></a>02356 <span class="comment">/**********************************************************************************************</span>
<a name="l02357"></a>02357 <span class="comment"> Blt8BPPDataTo8BPPBufferTransZNBPixelate</span>
<a name="l02358"></a>02358 <span class="comment"></span>
<a name="l02359"></a>02359 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l02360"></a>02360 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l02361"></a>02361 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on. The Z value is</span>
<a name="l02362"></a>02362 <span class="comment">      not updated,      for any non-transparent pixels. The Z-buffer is 16 bit, and</span>
<a name="l02363"></a>02363 <span class="comment">      must be the same dimensions as the destination.</span>
<a name="l02364"></a>02364 <span class="comment"></span>
<a name="l02365"></a>02365 <span class="comment">**********************************************************************************************/</span>
<a name="l02366"></a><a class="code" href="vobject__blitters_8h.html#f4af7d44a4b7fd77a9951bf05be00725">02366</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#f4af7d44a4b7fd77a9951bf05be00725">Blt8BPPDataTo8BPPBufferTransZNBPixelate</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex )
<a name="l02367"></a>02367 {
<a name="l02368"></a>02368       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l02369"></a>02369       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth;
<a name="l02370"></a>02370       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l02371"></a>02371       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip, LineSkipZ;
<a name="l02372"></a>02372       <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l02373"></a>02373       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l02374"></a>02374       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiLineFlag;
<a name="l02375"></a>02375       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *pPal8BPP;
<a name="l02376"></a>02376 
<a name="l02377"></a>02377       <span class="comment">// Assertions</span>
<a name="l02378"></a>02378       Assert( hSrcVObject != NULL );
<a name="l02379"></a>02379       Assert( pBuffer != NULL );
<a name="l02380"></a>02380 
<a name="l02381"></a>02381       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l02382"></a>02382       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l02383"></a>02383       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l02384"></a>02384       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l02385"></a>02385       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l02386"></a>02386 
<a name="l02387"></a>02387       <span class="comment">// Add to start position of dest buffer</span>
<a name="l02388"></a>02388       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l02389"></a>02389       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l02390"></a>02390 
<a name="l02391"></a>02391       <span class="comment">// Validations</span>
<a name="l02392"></a>02392       CHECKF( iTempX &gt;= 0 );
<a name="l02393"></a>02393       CHECKF( iTempY &gt;= 0 );
<a name="l02394"></a>02394 
<a name="l02395"></a>02395 
<a name="l02396"></a>02396       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l02397"></a>02397       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*iTempY) + (iTempX);
<a name="l02398"></a>02398       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*2*iTempY) + (iTempX*2);
<a name="l02399"></a>02399       pPal8BPP = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#152256552f959a5d90dbd886d22fb679">pShade8</a>;
<a name="l02400"></a>02400       LineSkip=(uiDestPitchBYTES-(usWidth));
<a name="l02401"></a>02401       LineSkipZ=LineSkip*2;
<a name="l02402"></a>02402 
<a name="l02403"></a>02403       uiLineFlag=(iTempY&amp;1);
<a name="l02404"></a>02404 
<a name="l02405"></a>02405       __asm {
<a name="l02406"></a>02406 
<a name="l02407"></a>02407             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l02408"></a>02408             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l02409"></a>02409             xor         eax, eax
<a name="l02410"></a>02410             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l02411"></a>02411             xor         ecx, ecx
<a name="l02412"></a>02412             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, pPal8BPP
<a name="l02413"></a>02413 
<a name="l02414"></a>02414 BlitDispatch:
<a name="l02415"></a>02415 
<a name="l02416"></a>02416             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l02417"></a>02417             inc         esi
<a name="l02418"></a>02418             or          cl, cl
<a name="l02419"></a>02419             js          BlitTransparent
<a name="l02420"></a>02420             jz          BlitDoneLine
<a name="l02421"></a>02421 
<a name="l02422"></a>02422 <span class="comment">//BlitNonTransLoop:</span>
<a name="l02423"></a>02423 
<a name="l02424"></a>02424 BlitNTL4:
<a name="l02425"></a>02425             <a class="code" href="structtest.html">test</a>  uiLineFlag, 1
<a name="l02426"></a>02426             jz          <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>
<a name="l02427"></a>02427 
<a name="l02428"></a>02428             <a class="code" href="structtest.html">test</a>  edi, 2
<a name="l02429"></a>02429             jz          BlitNTL5
<a name="l02430"></a>02430             jmp         <a class="code" href="vobject__blitters_8cpp.html#d660d2ba340c8ef5d2d80c6365ad838f">BlitNTL7</a>
<a name="l02431"></a>02431 
<a name="l02432"></a>02432 <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>:
<a name="l02433"></a>02433             <a class="code" href="structtest.html">test</a>  edi, 2
<a name="l02434"></a>02434             jnz         BlitNTL5
<a name="l02435"></a>02435 
<a name="l02436"></a>02436 <a class="code" href="vobject__blitters_8cpp.html#d660d2ba340c8ef5d2d80c6365ad838f">BlitNTL7</a>:
<a name="l02437"></a>02437 
<a name="l02438"></a>02438             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l02439"></a>02439             cmp         ax, usZValue
<a name="l02440"></a>02440             ja          BlitNTL5
<a name="l02441"></a>02441 
<a name="l02442"></a>02442             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l02443"></a>02443             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         al, [edx+eax]
<a name="l02444"></a>02444             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [<a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>], al
<a name="l02445"></a>02445 
<a name="l02446"></a>02446 BlitNTL5:
<a name="l02447"></a>02447             inc         esi
<a name="l02448"></a>02448             inc         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>
<a name="l02449"></a>02449             add         ebx, 2
<a name="l02450"></a>02450             dec         cl
<a name="l02451"></a>02451             jnz         BlitNTL4
<a name="l02452"></a>02452 
<a name="l02453"></a>02453             jmp         BlitDispatch
<a name="l02454"></a>02454 
<a name="l02455"></a>02455 
<a name="l02456"></a>02456 BlitTransparent:
<a name="l02457"></a>02457 
<a name="l02458"></a>02458             and         ecx, 07fH
<a name="l02459"></a>02459             add         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, ecx
<a name="l02460"></a>02460 <span class="comment">//          shl         ecx, 1</span>
<a name="l02461"></a>02461             add   ecx, ecx
<a name="l02462"></a>02462             add         ebx, ecx
<a name="l02463"></a>02463             jmp         BlitDispatch
<a name="l02464"></a>02464 
<a name="l02465"></a>02465 
<a name="l02466"></a>02466 BlitDoneLine:
<a name="l02467"></a>02467 
<a name="l02468"></a>02468             dec         usHeight
<a name="l02469"></a>02469             jz          BlitDone
<a name="l02470"></a>02470             add         edi, LineSkip
<a name="l02471"></a>02471             add         ebx, LineSkipZ
<a name="l02472"></a>02472             jmp         BlitDispatch
<a name="l02473"></a>02473 
<a name="l02474"></a>02474 
<a name="l02475"></a>02475 BlitDone:
<a name="l02476"></a>02476       }
<a name="l02477"></a>02477 
<a name="l02478"></a>02478       <span class="keywordflow">return</span>(TRUE);
<a name="l02479"></a>02479 
<a name="l02480"></a>02480 }
<a name="l02481"></a>02481 
<a name="l02482"></a>02482 <span class="comment">/**********************************************************************************************</span>
<a name="l02483"></a>02483 <span class="comment"> Blt8BPPDataTo8BPPBufferTransZClipPixelate</span>
<a name="l02484"></a>02484 <span class="comment"></span>
<a name="l02485"></a>02485 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l02486"></a>02486 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l02487"></a>02487 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on, and the Z value is</span>
<a name="l02488"></a>02488 <span class="comment">      updated to the current value, for any non-transparent pixels. The Z-buffer is 16 bit, and</span>
<a name="l02489"></a>02489 <span class="comment">      must be the same dimensions (including Pitch) as the destination.</span>
<a name="l02490"></a>02490 <span class="comment"></span>
<a name="l02491"></a>02491 <span class="comment">**********************************************************************************************/</span>
<a name="l02492"></a><a class="code" href="vobject__blitters_8h.html#55cdbba33eee916d44f37ceb47c4b15a">02492</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#55cdbba33eee916d44f37ceb47c4b15a">Blt8BPPDataTo8BPPBufferTransZClipPixelate</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="structSGPRect.html">SGPRect</a> *clipregion)
<a name="l02493"></a>02493 {
<a name="l02494"></a>02494       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l02495"></a>02495       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth, Unblitted;
<a name="l02496"></a>02496       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l02497"></a>02497       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip, LineSkipZ;
<a name="l02498"></a>02498   <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l02499"></a>02499       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY, LeftSkip, RightSkip, TopSkip, BottomSkip, BlitLength, BlitHeight, LSCount;
<a name="l02500"></a>02500       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  ClipX1, ClipY1, ClipX2, ClipY2;
<a name="l02501"></a>02501       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiLineFlag;
<a name="l02502"></a>02502       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *pPal8BPP;
<a name="l02503"></a>02503 
<a name="l02504"></a>02504       <span class="comment">// Assertions</span>
<a name="l02505"></a>02505       Assert( hSrcVObject != NULL );
<a name="l02506"></a>02506       Assert( pBuffer != NULL );
<a name="l02507"></a>02507 
<a name="l02508"></a>02508       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l02509"></a>02509       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l02510"></a>02510       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l02511"></a>02511       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l02512"></a>02512       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l02513"></a>02513 
<a name="l02514"></a>02514       <span class="comment">// Add to start position of dest buffer</span>
<a name="l02515"></a>02515       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l02516"></a>02516       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l02517"></a>02517 
<a name="l02518"></a>02518       <span class="keywordflow">if</span>(clipregion==NULL)
<a name="l02519"></a>02519       {
<a name="l02520"></a>02520             ClipX1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l02521"></a>02521             ClipY1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l02522"></a>02522             ClipX2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l02523"></a>02523             ClipY2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l02524"></a>02524       }
<a name="l02525"></a>02525       <span class="keywordflow">else</span>
<a name="l02526"></a>02526       {
<a name="l02527"></a>02527             ClipX1=clipregion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l02528"></a>02528             ClipY1=clipregion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l02529"></a>02529             ClipX2=clipregion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l02530"></a>02530             ClipY2=clipregion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l02531"></a>02531       }
<a name="l02532"></a>02532 
<a name="l02533"></a>02533       <span class="comment">// Calculate rows hanging off each side of the screen</span>
<a name="l02534"></a>02534       LeftSkip=__min(ClipX1 - min(ClipX1, iTempX), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l02535"></a>02535       RightSkip=__min(max(ClipX2, (iTempX+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth)) - ClipX2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l02536"></a>02536       TopSkip=__min(ClipY1 - __min(ClipY1, iTempY), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l02537"></a>02537       BottomSkip=__min(__max(ClipY2, (iTempY+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight)) - ClipY2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l02538"></a>02538 
<a name="l02539"></a>02539       <span class="comment">// calculate the remaining rows and columns to blit</span>
<a name="l02540"></a>02540       BlitLength=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth-LeftSkip-RightSkip);
<a name="l02541"></a>02541       BlitHeight=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight-TopSkip-BottomSkip);
<a name="l02542"></a>02542 
<a name="l02543"></a>02543       <span class="comment">// check if whole thing is clipped</span>
<a name="l02544"></a>02544       <span class="keywordflow">if</span>((LeftSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth) || (RightSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth))
<a name="l02545"></a>02545             <span class="keywordflow">return</span>(TRUE);
<a name="l02546"></a>02546 
<a name="l02547"></a>02547       <span class="comment">// check if whole thing is clipped</span>
<a name="l02548"></a>02548       <span class="keywordflow">if</span>((TopSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight) || (BottomSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight))
<a name="l02549"></a>02549             <span class="keywordflow">return</span>(TRUE);
<a name="l02550"></a>02550 
<a name="l02551"></a>02551       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l02552"></a>02552       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip));
<a name="l02553"></a>02553       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*2*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l02554"></a>02554       pPal8BPP = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#152256552f959a5d90dbd886d22fb679">pShade8</a>;
<a name="l02555"></a>02555       LineSkip=(uiDestPitchBYTES-(BlitLength));
<a name="l02556"></a>02556       LineSkipZ=LineSkip*2;
<a name="l02557"></a>02557 
<a name="l02558"></a>02558       uiLineFlag=(iTempY&amp;1);
<a name="l02559"></a>02559 
<a name="l02560"></a>02560       __asm {
<a name="l02561"></a>02561 
<a name="l02562"></a>02562             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l02563"></a>02563             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l02564"></a>02564             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, pPal8BPP
<a name="l02565"></a>02565             xor         eax, eax
<a name="l02566"></a>02566             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l02567"></a>02567             xor         ecx, ecx
<a name="l02568"></a>02568 
<a name="l02569"></a>02569             cmp         TopSkip, 0                                      <span class="comment">// check for nothing clipped on top</span>
<a name="l02570"></a>02570             je          LeftSkipSetup
<a name="l02571"></a>02571 
<a name="l02572"></a>02572 TopSkipLoop:                                                            <span class="comment">// Skips the number of lines clipped at the top</span>
<a name="l02573"></a>02573 
<a name="l02574"></a>02574             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l02575"></a>02575             inc         esi
<a name="l02576"></a>02576             or          cl, cl
<a name="l02577"></a>02577             js          TopSkipLoop
<a name="l02578"></a>02578             jz          TSEndLine
<a name="l02579"></a>02579 
<a name="l02580"></a>02580             add         esi, ecx
<a name="l02581"></a>02581             jmp         TopSkipLoop
<a name="l02582"></a>02582 
<a name="l02583"></a>02583 TSEndLine:
<a name="l02584"></a>02584             dec         TopSkip
<a name="l02585"></a>02585             jnz         TopSkipLoop
<a name="l02586"></a>02586 
<a name="l02587"></a>02587 LeftSkipSetup:
<a name="l02588"></a>02588 
<a name="l02589"></a>02589             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l02590"></a>02590             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, LeftSkip
<a name="l02591"></a>02591             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l02592"></a>02592             or          eax, eax
<a name="l02593"></a>02593             jz          BlitLineSetup
<a name="l02594"></a>02594 
<a name="l02595"></a>02595 LeftSkipLoop:
<a name="l02596"></a>02596 
<a name="l02597"></a>02597             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l02598"></a>02598             inc         esi
<a name="l02599"></a>02599 
<a name="l02600"></a>02600             or          cl, cl
<a name="l02601"></a>02601             js          LSTrans
<a name="l02602"></a>02602 
<a name="l02603"></a>02603             cmp         ecx, LSCount
<a name="l02604"></a>02604             je          LSSkip2                                               <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l02605"></a>02605             jb          LSSkip1                                               <span class="comment">// if less, skip whole thing</span>
<a name="l02606"></a>02606 
<a name="l02607"></a>02607             add         esi, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l02608"></a>02608             sub         ecx, LSCount
<a name="l02609"></a>02609             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l02610"></a>02610             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l02611"></a>02611             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l02612"></a>02612             jmp         BlitNonTransLoop
<a name="l02613"></a>02613 
<a name="l02614"></a>02614 LSSkip2:
<a name="l02615"></a>02615             add         esi, ecx                                        <span class="comment">// skip whole run, and start blit with new run</span>
<a name="l02616"></a>02616             jmp         BlitLineSetup
<a name="l02617"></a>02617 
<a name="l02618"></a>02618 
<a name="l02619"></a>02619 LSSkip1:
<a name="l02620"></a>02620             add         esi, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l02621"></a>02621             sub         LSCount, ecx
<a name="l02622"></a>02622             jmp         LeftSkipLoop
<a name="l02623"></a>02623 
<a name="l02624"></a>02624 
<a name="l02625"></a>02625 LSTrans:
<a name="l02626"></a>02626             and         ecx, 07fH
<a name="l02627"></a>02627             cmp         ecx, LSCount
<a name="l02628"></a>02628             je          BlitLineSetup                             <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l02629"></a>02629             jb          LSTrans1                                        <span class="comment">// if less, skip whole thing</span>
<a name="l02630"></a>02630 
<a name="l02631"></a>02631             sub         ecx, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l02632"></a>02632             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l02633"></a>02633             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l02634"></a>02634             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l02635"></a>02635             jmp         BlitTransparent
<a name="l02636"></a>02636 
<a name="l02637"></a>02637 
<a name="l02638"></a>02638 LSTrans1:
<a name="l02639"></a>02639             sub         LSCount, ecx                                          <span class="comment">// skip whole run, continue skipping</span>
<a name="l02640"></a>02640             jmp         LeftSkipLoop
<a name="l02641"></a>02641 
<a name="l02642"></a>02642 
<a name="l02643"></a>02643 BlitLineSetup:                                                    <span class="comment">// Does any actual blitting (trans/non) for the line</span>
<a name="l02644"></a>02644             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l02645"></a>02645             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l02646"></a>02646             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l02647"></a>02647 
<a name="l02648"></a>02648 BlitDispatch:
<a name="l02649"></a>02649 
<a name="l02650"></a>02650             cmp         LSCount, 0                                      <span class="comment">// Check to see if we're done blitting</span>
<a name="l02651"></a>02651             je          RightSkipLoop
<a name="l02652"></a>02652 
<a name="l02653"></a>02653             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l02654"></a>02654             inc         esi
<a name="l02655"></a>02655             or          cl, cl
<a name="l02656"></a>02656             js          BlitTransparent
<a name="l02657"></a>02657 
<a name="l02658"></a>02658 BlitNonTransLoop:                                           <span class="comment">// blit non-transparent pixels</span>
<a name="l02659"></a>02659 
<a name="l02660"></a>02660             cmp         ecx, LSCount
<a name="l02661"></a>02661             jbe         BNTrans1
<a name="l02662"></a>02662 
<a name="l02663"></a>02663             sub         ecx, LSCount
<a name="l02664"></a>02664             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, ecx
<a name="l02665"></a>02665             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, LSCount
<a name="l02666"></a>02666 
<a name="l02667"></a>02667 BNTrans1:
<a name="l02668"></a>02668             sub         LSCount, ecx
<a name="l02669"></a>02669 
<a name="l02670"></a>02670 BlitNTL1:
<a name="l02671"></a>02671 
<a name="l02672"></a>02672             <a class="code" href="structtest.html">test</a>  uiLineFlag, 1
<a name="l02673"></a>02673             jz          <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>
<a name="l02674"></a>02674 
<a name="l02675"></a>02675             <a class="code" href="structtest.html">test</a>  edi, 2
<a name="l02676"></a>02676             jz          BlitNTL2
<a name="l02677"></a>02677             jmp         <a class="code" href="vobject__blitters_8cpp.html#d660d2ba340c8ef5d2d80c6365ad838f">BlitNTL7</a>
<a name="l02678"></a>02678 
<a name="l02679"></a>02679 <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>:
<a name="l02680"></a>02680             <a class="code" href="structtest.html">test</a>  edi, 2
<a name="l02681"></a>02681             jnz         BlitNTL2
<a name="l02682"></a>02682 
<a name="l02683"></a>02683 <a class="code" href="vobject__blitters_8cpp.html#d660d2ba340c8ef5d2d80c6365ad838f">BlitNTL7</a>:
<a name="l02684"></a>02684 
<a name="l02685"></a>02685             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l02686"></a>02686             cmp         ax, usZValue
<a name="l02687"></a>02687             ja          BlitNTL2
<a name="l02688"></a>02688 
<a name="l02689"></a>02689             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, usZValue
<a name="l02690"></a>02690             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [ebx], ax
<a name="l02691"></a>02691 
<a name="l02692"></a>02692             xor         eax, eax
<a name="l02693"></a>02693 
<a name="l02694"></a>02694             mov         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l02695"></a>02695             mov         al, [edx+eax]
<a name="l02696"></a>02696             mov         [<a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>], al
<a name="l02697"></a>02697 
<a name="l02698"></a>02698 BlitNTL2:
<a name="l02699"></a>02699             inc         esi
<a name="l02700"></a>02700             inc         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>
<a name="l02701"></a>02701             add         ebx, 2
<a name="l02702"></a>02702             dec         cl
<a name="l02703"></a>02703             jnz         BlitNTL1
<a name="l02704"></a>02704 
<a name="l02705"></a>02705 <span class="comment">//BlitLineEnd:</span>
<a name="l02706"></a>02706             add         esi, Unblitted
<a name="l02707"></a>02707             jmp         BlitDispatch
<a name="l02708"></a>02708 
<a name="l02709"></a>02709 BlitTransparent:                                                              <span class="comment">// skip transparent pixels</span>
<a name="l02710"></a>02710 
<a name="l02711"></a>02711             and         ecx, 07fH
<a name="l02712"></a>02712             cmp         ecx, LSCount
<a name="l02713"></a>02713             jbe         BTrans1
<a name="l02714"></a>02714 
<a name="l02715"></a>02715             mov         ecx, LSCount
<a name="l02716"></a>02716 
<a name="l02717"></a>02717 BTrans1:
<a name="l02718"></a>02718 
<a name="l02719"></a>02719             sub         LSCount, ecx
<a name="l02720"></a>02720             add         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, ecx
<a name="l02721"></a>02721 <span class="comment">//          shl         ecx, 1</span>
<a name="l02722"></a>02722             add   ecx, ecx
<a name="l02723"></a>02723             add         ebx, ecx
<a name="l02724"></a>02724             jmp         BlitDispatch
<a name="l02725"></a>02725 
<a name="l02726"></a>02726 
<a name="l02727"></a>02727 RightSkipLoop:                                                                      <span class="comment">// skip along until we hit and end-of-line marker</span>
<a name="l02728"></a>02728 
<a name="l02729"></a>02729 
<a name="l02730"></a>02730 RSLoop1:
<a name="l02731"></a>02731             mov         al, [esi]
<a name="l02732"></a>02732             inc         esi
<a name="l02733"></a>02733             or          al, al
<a name="l02734"></a>02734             jnz         RSLoop1
<a name="l02735"></a>02735 
<a name="l02736"></a>02736             dec         BlitHeight
<a name="l02737"></a>02737             jz          BlitDone
<a name="l02738"></a>02738             xor         uiLineFlag, 1
<a name="l02739"></a>02739             add         edi, LineSkip
<a name="l02740"></a>02740             add         ebx, LineSkipZ
<a name="l02741"></a>02741 
<a name="l02742"></a>02742             jmp         LeftSkipSetup
<a name="l02743"></a>02743 
<a name="l02744"></a>02744 
<a name="l02745"></a>02745 BlitDone:
<a name="l02746"></a>02746       }
<a name="l02747"></a>02747 
<a name="l02748"></a>02748       <span class="keywordflow">return</span>(TRUE);
<a name="l02749"></a>02749 
<a name="l02750"></a>02750 }
<a name="l02751"></a>02751 
<a name="l02752"></a>02752 <span class="comment">/**********************************************************************************************</span>
<a name="l02753"></a>02753 <span class="comment"> Blt8BPPDataTo8BPPBufferTransZNBClipPixelate</span>
<a name="l02754"></a>02754 <span class="comment"></span>
<a name="l02755"></a>02755 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l02756"></a>02756 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l02757"></a>02757 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on, the Z value is</span>
<a name="l02758"></a>02758 <span class="comment">      not updated,      for any non-transparent pixels. The Z-buffer is 16 bit, and must be the same</span>
<a name="l02759"></a>02759 <span class="comment">      dimensions as the destination.</span>
<a name="l02760"></a>02760 <span class="comment"></span>
<a name="l02761"></a>02761 <span class="comment">**********************************************************************************************/</span>
<a name="l02762"></a><a class="code" href="vobject__blitters_8h.html#7189fcd9eac87ecb8430f0b0c744edc6">02762</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#7189fcd9eac87ecb8430f0b0c744edc6">Blt8BPPDataTo8BPPBufferTransZNBClipPixelate</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="structSGPRect.html">SGPRect</a> *clipregion)
<a name="l02763"></a>02763 {
<a name="l02764"></a>02764       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l02765"></a>02765       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth, Unblitted;
<a name="l02766"></a>02766       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l02767"></a>02767       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip, LineSkipZ;
<a name="l02768"></a>02768   <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l02769"></a>02769       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY, LeftSkip, RightSkip, TopSkip, BottomSkip, BlitLength, BlitHeight, LSCount;
<a name="l02770"></a>02770       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  ClipX1, ClipY1, ClipX2, ClipY2;
<a name="l02771"></a>02771       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiLineFlag;
<a name="l02772"></a>02772       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *pPal8BPP;
<a name="l02773"></a>02773 
<a name="l02774"></a>02774       <span class="comment">// Assertions</span>
<a name="l02775"></a>02775       Assert( hSrcVObject != NULL );
<a name="l02776"></a>02776       Assert( pBuffer != NULL );
<a name="l02777"></a>02777 
<a name="l02778"></a>02778       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l02779"></a>02779       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l02780"></a>02780       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l02781"></a>02781       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l02782"></a>02782       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l02783"></a>02783 
<a name="l02784"></a>02784       <span class="comment">// Add to start position of dest buffer</span>
<a name="l02785"></a>02785       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l02786"></a>02786       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l02787"></a>02787 
<a name="l02788"></a>02788       <span class="keywordflow">if</span>(clipregion==NULL)
<a name="l02789"></a>02789       {
<a name="l02790"></a>02790             ClipX1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l02791"></a>02791             ClipY1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l02792"></a>02792             ClipX2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l02793"></a>02793             ClipY2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l02794"></a>02794       }
<a name="l02795"></a>02795       <span class="keywordflow">else</span>
<a name="l02796"></a>02796       {
<a name="l02797"></a>02797             ClipX1=clipregion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l02798"></a>02798             ClipY1=clipregion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l02799"></a>02799             ClipX2=clipregion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l02800"></a>02800             ClipY2=clipregion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l02801"></a>02801       }
<a name="l02802"></a>02802 
<a name="l02803"></a>02803       <span class="comment">// Calculate rows hanging off each side of the screen</span>
<a name="l02804"></a>02804       LeftSkip=__min(ClipX1 - min(ClipX1, iTempX), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l02805"></a>02805       RightSkip=__min(max(ClipX2, (iTempX+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth)) - ClipX2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l02806"></a>02806       TopSkip=__min(ClipY1 - __min(ClipY1, iTempY), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l02807"></a>02807       BottomSkip=__min(__max(ClipY2, (iTempY+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight)) - ClipY2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l02808"></a>02808 
<a name="l02809"></a>02809       <span class="comment">// calculate the remaining rows and columns to blit</span>
<a name="l02810"></a>02810       BlitLength=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth-LeftSkip-RightSkip);
<a name="l02811"></a>02811       BlitHeight=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight-TopSkip-BottomSkip);
<a name="l02812"></a>02812 
<a name="l02813"></a>02813       <span class="comment">// check if whole thing is clipped</span>
<a name="l02814"></a>02814       <span class="keywordflow">if</span>((LeftSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth) || (RightSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth))
<a name="l02815"></a>02815             <span class="keywordflow">return</span>(TRUE);
<a name="l02816"></a>02816 
<a name="l02817"></a>02817       <span class="comment">// check if whole thing is clipped</span>
<a name="l02818"></a>02818       <span class="keywordflow">if</span>((TopSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight) || (BottomSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight))
<a name="l02819"></a>02819             <span class="keywordflow">return</span>(TRUE);
<a name="l02820"></a>02820 
<a name="l02821"></a>02821       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l02822"></a>02822       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip));
<a name="l02823"></a>02823       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*2*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l02824"></a>02824       pPal8BPP=hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#152256552f959a5d90dbd886d22fb679">pShade8</a>;
<a name="l02825"></a>02825       LineSkip=(uiDestPitchBYTES-(BlitLength));
<a name="l02826"></a>02826       LineSkipZ=LineSkip*2;
<a name="l02827"></a>02827 
<a name="l02828"></a>02828       uiLineFlag=(iTempY&amp;1);
<a name="l02829"></a>02829 
<a name="l02830"></a>02830       __asm {
<a name="l02831"></a>02831 
<a name="l02832"></a>02832             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l02833"></a>02833             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l02834"></a>02834             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, pPal8BPP
<a name="l02835"></a>02835             xor         eax, eax
<a name="l02836"></a>02836             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l02837"></a>02837             xor         ecx, ecx
<a name="l02838"></a>02838 
<a name="l02839"></a>02839             cmp         TopSkip, 0                                      <span class="comment">// check for nothing clipped on top</span>
<a name="l02840"></a>02840             je          LeftSkipSetup
<a name="l02841"></a>02841 
<a name="l02842"></a>02842 TopSkipLoop:                                                            <span class="comment">// Skips the number of lines clipped at the top</span>
<a name="l02843"></a>02843 
<a name="l02844"></a>02844             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l02845"></a>02845             inc         esi
<a name="l02846"></a>02846             or          cl, cl
<a name="l02847"></a>02847             js          TopSkipLoop
<a name="l02848"></a>02848             jz          TSEndLine
<a name="l02849"></a>02849 
<a name="l02850"></a>02850             add         esi, ecx
<a name="l02851"></a>02851             jmp         TopSkipLoop
<a name="l02852"></a>02852 
<a name="l02853"></a>02853 TSEndLine:
<a name="l02854"></a>02854             dec         TopSkip
<a name="l02855"></a>02855             jnz         TopSkipLoop
<a name="l02856"></a>02856 
<a name="l02857"></a>02857 LeftSkipSetup:
<a name="l02858"></a>02858 
<a name="l02859"></a>02859             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l02860"></a>02860             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, LeftSkip
<a name="l02861"></a>02861             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l02862"></a>02862             or          eax, eax
<a name="l02863"></a>02863             jz          BlitLineSetup
<a name="l02864"></a>02864 
<a name="l02865"></a>02865 LeftSkipLoop:
<a name="l02866"></a>02866 
<a name="l02867"></a>02867             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l02868"></a>02868             inc         esi
<a name="l02869"></a>02869 
<a name="l02870"></a>02870             or          cl, cl
<a name="l02871"></a>02871             js          LSTrans
<a name="l02872"></a>02872 
<a name="l02873"></a>02873             cmp         ecx, LSCount
<a name="l02874"></a>02874             je          LSSkip2                                               <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l02875"></a>02875             jb          LSSkip1                                               <span class="comment">// if less, skip whole thing</span>
<a name="l02876"></a>02876 
<a name="l02877"></a>02877             add         esi, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l02878"></a>02878             sub         ecx, LSCount
<a name="l02879"></a>02879             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l02880"></a>02880             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l02881"></a>02881             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l02882"></a>02882             jmp         BlitNonTransLoop
<a name="l02883"></a>02883 
<a name="l02884"></a>02884 LSSkip2:
<a name="l02885"></a>02885             add         esi, ecx                                        <span class="comment">// skip whole run, and start blit with new run</span>
<a name="l02886"></a>02886             jmp         BlitLineSetup
<a name="l02887"></a>02887 
<a name="l02888"></a>02888 
<a name="l02889"></a>02889 LSSkip1:
<a name="l02890"></a>02890             add         esi, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l02891"></a>02891             sub         LSCount, ecx
<a name="l02892"></a>02892             jmp         LeftSkipLoop
<a name="l02893"></a>02893 
<a name="l02894"></a>02894 
<a name="l02895"></a>02895 LSTrans:
<a name="l02896"></a>02896             and         ecx, 07fH
<a name="l02897"></a>02897             cmp         ecx, LSCount
<a name="l02898"></a>02898             je          BlitLineSetup                             <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l02899"></a>02899             jb          LSTrans1                                        <span class="comment">// if less, skip whole thing</span>
<a name="l02900"></a>02900 
<a name="l02901"></a>02901             sub         ecx, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l02902"></a>02902             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l02903"></a>02903             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l02904"></a>02904             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l02905"></a>02905             jmp         BlitTransparent
<a name="l02906"></a>02906 
<a name="l02907"></a>02907 
<a name="l02908"></a>02908 LSTrans1:
<a name="l02909"></a>02909             sub         LSCount, ecx                                          <span class="comment">// skip whole run, continue skipping</span>
<a name="l02910"></a>02910             jmp         LeftSkipLoop
<a name="l02911"></a>02911 
<a name="l02912"></a>02912 
<a name="l02913"></a>02913 BlitLineSetup:                                                    <span class="comment">// Does any actual blitting (trans/non) for the line</span>
<a name="l02914"></a>02914             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l02915"></a>02915             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l02916"></a>02916             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l02917"></a>02917 
<a name="l02918"></a>02918 BlitDispatch:
<a name="l02919"></a>02919 
<a name="l02920"></a>02920             cmp         LSCount, 0                                      <span class="comment">// Check to see if we're done blitting</span>
<a name="l02921"></a>02921             je          RightSkipLoop
<a name="l02922"></a>02922 
<a name="l02923"></a>02923             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l02924"></a>02924             inc         esi
<a name="l02925"></a>02925             or          cl, cl
<a name="l02926"></a>02926             js          BlitTransparent
<a name="l02927"></a>02927 
<a name="l02928"></a>02928 BlitNonTransLoop:                                           <span class="comment">// blit non-transparent pixels</span>
<a name="l02929"></a>02929 
<a name="l02930"></a>02930             cmp         ecx, LSCount
<a name="l02931"></a>02931             jbe         BNTrans1
<a name="l02932"></a>02932 
<a name="l02933"></a>02933             sub         ecx, LSCount
<a name="l02934"></a>02934             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, ecx
<a name="l02935"></a>02935             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, LSCount
<a name="l02936"></a>02936 
<a name="l02937"></a>02937 BNTrans1:
<a name="l02938"></a>02938             sub         LSCount, ecx
<a name="l02939"></a>02939 
<a name="l02940"></a>02940 BlitNTL1:
<a name="l02941"></a>02941 
<a name="l02942"></a>02942             <a class="code" href="structtest.html">test</a>  uiLineFlag, 1
<a name="l02943"></a>02943             jz          <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>
<a name="l02944"></a>02944 
<a name="l02945"></a>02945             <a class="code" href="structtest.html">test</a>  edi, 2
<a name="l02946"></a>02946             jz          BlitNTL2
<a name="l02947"></a>02947             jmp         <a class="code" href="vobject__blitters_8cpp.html#d660d2ba340c8ef5d2d80c6365ad838f">BlitNTL7</a>
<a name="l02948"></a>02948 
<a name="l02949"></a>02949 <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>:
<a name="l02950"></a>02950             <a class="code" href="structtest.html">test</a>  edi, 2
<a name="l02951"></a>02951             jnz         BlitNTL2
<a name="l02952"></a>02952 
<a name="l02953"></a>02953 <a class="code" href="vobject__blitters_8cpp.html#d660d2ba340c8ef5d2d80c6365ad838f">BlitNTL7</a>:
<a name="l02954"></a>02954 
<a name="l02955"></a>02955             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l02956"></a>02956             cmp         ax, usZValue
<a name="l02957"></a>02957             ja          BlitNTL2
<a name="l02958"></a>02958 
<a name="l02959"></a>02959             xor         eax, eax
<a name="l02960"></a>02960 
<a name="l02961"></a>02961             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l02962"></a>02962             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         al, [edx+eax]
<a name="l02963"></a>02963             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [<a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>], al
<a name="l02964"></a>02964 
<a name="l02965"></a>02965 BlitNTL2:
<a name="l02966"></a>02966             inc         esi
<a name="l02967"></a>02967             inc         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>
<a name="l02968"></a>02968             add         ebx, 2
<a name="l02969"></a>02969             dec         cl
<a name="l02970"></a>02970             jnz         BlitNTL1
<a name="l02971"></a>02971 
<a name="l02972"></a>02972 <span class="comment">//BlitLineEnd:</span>
<a name="l02973"></a>02973             add         esi, Unblitted
<a name="l02974"></a>02974             jmp         BlitDispatch
<a name="l02975"></a>02975 
<a name="l02976"></a>02976 BlitTransparent:                                                              <span class="comment">// skip transparent pixels</span>
<a name="l02977"></a>02977 
<a name="l02978"></a>02978             and         ecx, 07fH
<a name="l02979"></a>02979             cmp         ecx, LSCount
<a name="l02980"></a>02980             jbe         BTrans1
<a name="l02981"></a>02981 
<a name="l02982"></a>02982             mov         ecx, LSCount
<a name="l02983"></a>02983 
<a name="l02984"></a>02984 BTrans1:
<a name="l02985"></a>02985 
<a name="l02986"></a>02986             sub         LSCount, ecx
<a name="l02987"></a>02987             add         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, ecx
<a name="l02988"></a>02988 <span class="comment">//          shl         ecx, 1</span>
<a name="l02989"></a>02989             add   ecx, ecx
<a name="l02990"></a>02990             add         ebx, ecx
<a name="l02991"></a>02991             jmp         BlitDispatch
<a name="l02992"></a>02992 
<a name="l02993"></a>02993 
<a name="l02994"></a>02994 RightSkipLoop:                                                                      <span class="comment">// skip along until we hit and end-of-line marker</span>
<a name="l02995"></a>02995 
<a name="l02996"></a>02996 
<a name="l02997"></a>02997 RSLoop1:
<a name="l02998"></a>02998             mov         al, [esi]
<a name="l02999"></a>02999             inc         esi
<a name="l03000"></a>03000             or          al, al
<a name="l03001"></a>03001             jnz         RSLoop1
<a name="l03002"></a>03002 
<a name="l03003"></a>03003             dec         BlitHeight
<a name="l03004"></a>03004             jz          BlitDone
<a name="l03005"></a>03005             xor         uiLineFlag, 1
<a name="l03006"></a>03006             add         edi, LineSkip
<a name="l03007"></a>03007             add         ebx, LineSkipZ
<a name="l03008"></a>03008 
<a name="l03009"></a>03009             jmp         LeftSkipSetup
<a name="l03010"></a>03010 
<a name="l03011"></a>03011 
<a name="l03012"></a>03012 BlitDone:
<a name="l03013"></a>03013       }
<a name="l03014"></a>03014 
<a name="l03015"></a>03015       <span class="keywordflow">return</span>(TRUE);
<a name="l03016"></a>03016 
<a name="l03017"></a>03017 }
<a name="l03018"></a>03018 
<a name="l03019"></a>03019 
<a name="l03020"></a>03020 
<a name="l03021"></a>03021 
<a name="l03022"></a>03022 
<a name="l03023"></a>03023 
<a name="l03024"></a>03024 
<a name="l03025"></a>03025 
<a name="l03026"></a>03026 
<a name="l03027"></a>03027 
<a name="l03028"></a>03028 
<a name="l03029"></a>03029 
<a name="l03030"></a>03030 
<a name="l03031"></a>03031 
<a name="l03032"></a>03032 
<a name="l03033"></a>03033 
<a name="l03034"></a>03034 
<a name="l03035"></a>03035 <span class="comment">/******************************************************************************</span>
<a name="l03036"></a>03036 <span class="comment"> Blt8BPPDataTo8BPPBufferTransparentClip</span>
<a name="l03037"></a>03037 <span class="comment"></span>
<a name="l03038"></a>03038 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l03039"></a>03039 <span class="comment">      buffer as a destination. Clips the brush.</span>
<a name="l03040"></a>03040 <span class="comment"></span>
<a name="l03041"></a>03041 <span class="comment">*******************************************************************************/</span>
<a name="l03042"></a><a class="code" href="vobject__blitters_8h.html#a8e98bc154f955a31a06ece3aba8aa28">03042</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#a8e98bc154f955a31a06ece3aba8aa28">Blt8BPPDataTo8BPPBufferTransparentClip</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="structSGPRect.html">SGPRect</a> *clipregion)
<a name="l03043"></a>03043 {
<a name="l03044"></a>03044       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l03045"></a>03045       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth, Unblitted;
<a name="l03046"></a>03046       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr;
<a name="l03047"></a>03047       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l03048"></a>03048   <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l03049"></a>03049       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY, LeftSkip, RightSkip, TopSkip, BottomSkip, BlitLength, BlitHeight;
<a name="l03050"></a>03050       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  ClipX1, ClipY1, ClipX2, ClipY2;
<a name="l03051"></a>03051       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *pPal8BPP;
<a name="l03052"></a>03052 
<a name="l03053"></a>03053       <span class="comment">// Assertions</span>
<a name="l03054"></a>03054       Assert( hSrcVObject != NULL );
<a name="l03055"></a>03055       Assert( pBuffer != NULL );
<a name="l03056"></a>03056 
<a name="l03057"></a>03057       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l03058"></a>03058       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l03059"></a>03059       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l03060"></a>03060       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l03061"></a>03061       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l03062"></a>03062 
<a name="l03063"></a>03063       <span class="comment">// Add to start position of dest buffer</span>
<a name="l03064"></a>03064       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l03065"></a>03065       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l03066"></a>03066 
<a name="l03067"></a>03067       <span class="keywordflow">if</span>(clipregion==NULL)
<a name="l03068"></a>03068       {
<a name="l03069"></a>03069             ClipX1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l03070"></a>03070             ClipY1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l03071"></a>03071             ClipX2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l03072"></a>03072             ClipY2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l03073"></a>03073       }
<a name="l03074"></a>03074       <span class="keywordflow">else</span>
<a name="l03075"></a>03075       {
<a name="l03076"></a>03076             ClipX1=clipregion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l03077"></a>03077             ClipY1=clipregion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l03078"></a>03078             ClipX2=clipregion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l03079"></a>03079             ClipY2=clipregion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l03080"></a>03080       }
<a name="l03081"></a>03081 
<a name="l03082"></a>03082       <span class="comment">// Calculate rows hanging off each side of the screen</span>
<a name="l03083"></a>03083       LeftSkip=__min(ClipX1 - min(ClipX1, iTempX), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l03084"></a>03084       RightSkip=__min(max(ClipX2, (iTempX+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth)) - ClipX2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l03085"></a>03085       TopSkip=__min(ClipY1 - __min(ClipY1, iTempY), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l03086"></a>03086       BottomSkip=__min(__max(ClipY2, (iTempY+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight)) - ClipY2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l03087"></a>03087 
<a name="l03088"></a>03088       <span class="comment">// calculate the remaining rows and columns to blit</span>
<a name="l03089"></a>03089       BlitLength=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth-LeftSkip-RightSkip);
<a name="l03090"></a>03090       BlitHeight=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight-TopSkip-BottomSkip);
<a name="l03091"></a>03091 
<a name="l03092"></a>03092       <span class="comment">// check if whole thing is clipped</span>
<a name="l03093"></a>03093       <span class="keywordflow">if</span>((LeftSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth) || (RightSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth))
<a name="l03094"></a>03094             <span class="keywordflow">return</span>(TRUE);
<a name="l03095"></a>03095 
<a name="l03096"></a>03096       <span class="comment">// check if whole thing is clipped</span>
<a name="l03097"></a>03097       <span class="keywordflow">if</span>((TopSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight) || (BottomSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight))
<a name="l03098"></a>03098             <span class="keywordflow">return</span>(TRUE);
<a name="l03099"></a>03099 
<a name="l03100"></a>03100       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l03101"></a>03101       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip));
<a name="l03102"></a>03102       LineSkip=(uiDestPitchBYTES-(BlitLength));
<a name="l03103"></a>03103       pPal8BPP=hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#152256552f959a5d90dbd886d22fb679">pShade8</a>;
<a name="l03104"></a>03104 
<a name="l03105"></a>03105       __asm {
<a name="l03106"></a>03106 
<a name="l03107"></a>03107             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l03108"></a>03108             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l03109"></a>03109             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, pPal8BPP
<a name="l03110"></a>03110 <span class="comment">//          mov         edx, pointer to shade table here</span>
<a name="l03111"></a>03111             xor         eax, eax
<a name="l03112"></a>03112             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, TopSkip
<a name="l03113"></a>03113             xor         ecx, ecx
<a name="l03114"></a>03114 
<a name="l03115"></a>03115             or          ebx, ebx                                        <span class="comment">// check for nothing clipped on top</span>
<a name="l03116"></a>03116             jz          LeftSkipSetup
<a name="l03117"></a>03117 
<a name="l03118"></a>03118 TopSkipLoop:                                                            <span class="comment">// Skips the number of lines clipped at the top</span>
<a name="l03119"></a>03119 
<a name="l03120"></a>03120             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l03121"></a>03121             inc         esi
<a name="l03122"></a>03122             or          cl, cl
<a name="l03123"></a>03123             js          TopSkipLoop
<a name="l03124"></a>03124             jz          TSEndLine
<a name="l03125"></a>03125 
<a name="l03126"></a>03126             add         esi, ecx
<a name="l03127"></a>03127             jmp         TopSkipLoop
<a name="l03128"></a>03128 
<a name="l03129"></a>03129 TSEndLine:
<a name="l03130"></a>03130             dec         ebx
<a name="l03131"></a>03131             jnz         TopSkipLoop
<a name="l03132"></a>03132 
<a name="l03133"></a>03133 
<a name="l03134"></a>03134 
<a name="l03135"></a>03135 
<a name="l03136"></a>03136 LeftSkipSetup:
<a name="l03137"></a>03137 
<a name="l03138"></a>03138             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l03139"></a>03139             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, LeftSkip                             <span class="comment">// check for nothing clipped on the left</span>
<a name="l03140"></a>03140             or          ebx, ebx
<a name="l03141"></a>03141             jz          BlitLineSetup
<a name="l03142"></a>03142 
<a name="l03143"></a>03143 LeftSkipLoop:
<a name="l03144"></a>03144 
<a name="l03145"></a>03145             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l03146"></a>03146             inc         esi
<a name="l03147"></a>03147 
<a name="l03148"></a>03148             or          cl, cl
<a name="l03149"></a>03149             js          LSTrans
<a name="l03150"></a>03150 
<a name="l03151"></a>03151             cmp         ecx, ebx
<a name="l03152"></a>03152             je          LSSkip2                                               <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l03153"></a>03153             jb          LSSkip1                                               <span class="comment">// if less, skip whole thing</span>
<a name="l03154"></a>03154 
<a name="l03155"></a>03155             add         esi, ebx                                        <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l03156"></a>03156             sub         ecx, ebx
<a name="l03157"></a>03157             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, BlitLength
<a name="l03158"></a>03158             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l03159"></a>03159             jmp         BlitNonTransLoop
<a name="l03160"></a>03160 
<a name="l03161"></a>03161 LSSkip2:
<a name="l03162"></a>03162             add         esi, ecx                                        <span class="comment">// skip whole run, and start blit with new run</span>
<a name="l03163"></a>03163             jmp         BlitLineSetup
<a name="l03164"></a>03164 
<a name="l03165"></a>03165 
<a name="l03166"></a>03166 LSSkip1:
<a name="l03167"></a>03167             add         esi, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l03168"></a>03168             sub         ebx, ecx
<a name="l03169"></a>03169             jmp         LeftSkipLoop
<a name="l03170"></a>03170 
<a name="l03171"></a>03171 
<a name="l03172"></a>03172 LSTrans:
<a name="l03173"></a>03173             and         ecx, 07fH
<a name="l03174"></a>03174             cmp         ecx, ebx
<a name="l03175"></a>03175             je          BlitLineSetup                             <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l03176"></a>03176             jb          LSTrans1                                        <span class="comment">// if less, skip whole thing</span>
<a name="l03177"></a>03177 
<a name="l03178"></a>03178             sub         ecx, ebx                                        <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l03179"></a>03179             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, BlitLength
<a name="l03180"></a>03180             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l03181"></a>03181             jmp         BlitTransparent
<a name="l03182"></a>03182 
<a name="l03183"></a>03183 
<a name="l03184"></a>03184 LSTrans1:
<a name="l03185"></a>03185             sub         ebx, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l03186"></a>03186             jmp         LeftSkipLoop
<a name="l03187"></a>03187 
<a name="l03188"></a>03188 
<a name="l03189"></a>03189 
<a name="l03190"></a>03190 
<a name="l03191"></a>03191 BlitLineSetup:                                                    <span class="comment">// Does any actual blitting (trans/non) for the line</span>
<a name="l03192"></a>03192             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, BlitLength
<a name="l03193"></a>03193             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l03194"></a>03194 
<a name="l03195"></a>03195 BlitDispatch:
<a name="l03196"></a>03196 
<a name="l03197"></a>03197             or          ebx, ebx                                        <span class="comment">// Check to see if we're done blitting</span>
<a name="l03198"></a>03198             jz          RightSkipLoop
<a name="l03199"></a>03199 
<a name="l03200"></a>03200             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l03201"></a>03201             inc         esi
<a name="l03202"></a>03202             or          cl, cl
<a name="l03203"></a>03203             js          BlitTransparent
<a name="l03204"></a>03204 
<a name="l03205"></a>03205 BlitNonTransLoop:                                           <span class="comment">// blit non-transparent pixels</span>
<a name="l03206"></a>03206 
<a name="l03207"></a>03207             cmp         ecx, ebx
<a name="l03208"></a>03208             jbe         BNTrans1
<a name="l03209"></a>03209 
<a name="l03210"></a>03210             sub         ecx, ebx
<a name="l03211"></a>03211             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, ecx
<a name="l03212"></a>03212             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, ebx
<a name="l03213"></a>03213 
<a name="l03214"></a>03214 BNTrans1:
<a name="l03215"></a>03215             sub         ebx, ecx
<a name="l03216"></a>03216 
<a name="l03217"></a>03217             clc
<a name="l03218"></a>03218             rcr         cl, 1
<a name="l03219"></a>03219             jnc         BlitNTL2
<a name="l03220"></a>03220 
<a name="l03221"></a>03221             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l03222"></a>03222             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         al, [edx+eax]
<a name="l03223"></a>03223             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], al
<a name="l03224"></a>03224             inc         esi
<a name="l03225"></a>03225             inc         edi
<a name="l03226"></a>03226 
<a name="l03227"></a>03227 BlitNTL2:
<a name="l03228"></a>03228             clc
<a name="l03229"></a>03229             rcr         cl, 1
<a name="l03230"></a>03230             jnc         BlitNTL3
<a name="l03231"></a>03231 
<a name="l03232"></a>03232             mov         al, [esi]
<a name="l03233"></a>03233             mov         al, [edx+eax]
<a name="l03234"></a>03234             mov         [edi], al
<a name="l03235"></a>03235 
<a name="l03236"></a>03236             mov         al, [esi+1]
<a name="l03237"></a>03237             mov         al, [edx+eax]
<a name="l03238"></a>03238             mov         [edi+1], al
<a name="l03239"></a>03239 
<a name="l03240"></a>03240             add         esi, 2
<a name="l03241"></a>03241             add         edi, 2
<a name="l03242"></a>03242 
<a name="l03243"></a>03243 BlitNTL3:
<a name="l03244"></a>03244 
<a name="l03245"></a>03245             or          cl, cl
<a name="l03246"></a>03246             jz          BlitLineEnd
<a name="l03247"></a>03247 
<a name="l03248"></a>03248 BlitNTL4:
<a name="l03249"></a>03249 
<a name="l03250"></a>03250             mov         al, [esi]
<a name="l03251"></a>03251             mov         al, [edx+eax]
<a name="l03252"></a>03252             mov         [edi], al
<a name="l03253"></a>03253 
<a name="l03254"></a>03254             mov         al, [esi+1]
<a name="l03255"></a>03255             mov         al, [edx+eax]
<a name="l03256"></a>03256             mov         [edi+1], al
<a name="l03257"></a>03257 
<a name="l03258"></a>03258             mov         al, [esi+2]
<a name="l03259"></a>03259             mov         al, [edx+eax]
<a name="l03260"></a>03260             mov         [edi+2], al
<a name="l03261"></a>03261 
<a name="l03262"></a>03262             mov         al, [esi+3]
<a name="l03263"></a>03263             mov         al, [edx+eax]
<a name="l03264"></a>03264             mov         [edi+3], al
<a name="l03265"></a>03265 
<a name="l03266"></a>03266             add         esi, 4
<a name="l03267"></a>03267             add         edi, 4
<a name="l03268"></a>03268 
<a name="l03269"></a>03269             dec         cl
<a name="l03270"></a>03270             jnz         BlitNTL4
<a name="l03271"></a>03271 
<a name="l03272"></a>03272 BlitLineEnd:
<a name="l03273"></a>03273             add         esi, Unblitted
<a name="l03274"></a>03274             jmp         BlitDispatch
<a name="l03275"></a>03275 
<a name="l03276"></a>03276 BlitTransparent:                                                              <span class="comment">// skip transparent pixels</span>
<a name="l03277"></a>03277 
<a name="l03278"></a>03278             and         ecx, 07fH
<a name="l03279"></a>03279             cmp         ecx, ebx
<a name="l03280"></a>03280             jbe         BTrans1
<a name="l03281"></a>03281 
<a name="l03282"></a>03282             mov         ecx, ebx
<a name="l03283"></a>03283 
<a name="l03284"></a>03284 BTrans1:
<a name="l03285"></a>03285 
<a name="l03286"></a>03286             sub         ebx, ecx
<a name="l03287"></a>03287             add         edi, ecx
<a name="l03288"></a>03288             jmp         BlitDispatch
<a name="l03289"></a>03289 
<a name="l03290"></a>03290 
<a name="l03291"></a>03291 RightSkipLoop:                                                                      <span class="comment">// skip along until we hit and end-of-line marker</span>
<a name="l03292"></a>03292 
<a name="l03293"></a>03293 
<a name="l03294"></a>03294 RSLoop1:
<a name="l03295"></a>03295             mov         al, [esi]
<a name="l03296"></a>03296             inc         esi
<a name="l03297"></a>03297             or          al, al
<a name="l03298"></a>03298             jnz         RSLoop1
<a name="l03299"></a>03299 
<a name="l03300"></a>03300             dec         BlitHeight
<a name="l03301"></a>03301             jz          BlitDone
<a name="l03302"></a>03302             add         edi, LineSkip
<a name="l03303"></a>03303 
<a name="l03304"></a>03304             jmp         LeftSkipSetup
<a name="l03305"></a>03305 
<a name="l03306"></a>03306 
<a name="l03307"></a>03307 BlitDone:
<a name="l03308"></a>03308       }
<a name="l03309"></a>03309 
<a name="l03310"></a>03310       <span class="keywordflow">return</span>(TRUE);
<a name="l03311"></a>03311 
<a name="l03312"></a>03312 }
<a name="l03313"></a>03313 
<a name="l03314"></a>03314 
<a name="l03315"></a>03315 <span class="comment">/**********************************************************************************************</span>
<a name="l03316"></a>03316 <span class="comment"> Blt8BPPDataTo8BPPBufferTransparent</span>
<a name="l03317"></a>03317 <span class="comment"></span>
<a name="l03318"></a>03318 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l03319"></a>03319 <span class="comment">      buffer as a destination.</span>
<a name="l03320"></a>03320 <span class="comment"></span>
<a name="l03321"></a>03321 <span class="comment">**********************************************************************************************/</span>
<a name="l03322"></a><a class="code" href="vobject__blitters_8h.html#966118648653cbdc3b5b469c93e58278">03322</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#966118648653cbdc3b5b469c93e58278">Blt8BPPDataTo8BPPBufferTransparent</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex )
<a name="l03323"></a>03323 {
<a name="l03324"></a>03324       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l03325"></a>03325       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth;
<a name="l03326"></a>03326       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *pPal8BPP;
<a name="l03327"></a>03327       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l03328"></a>03328       <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l03329"></a>03329       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l03330"></a>03330 
<a name="l03331"></a>03331 
<a name="l03332"></a>03332       <span class="comment">// Assertions</span>
<a name="l03333"></a>03333       Assert( hSrcVObject != NULL );
<a name="l03334"></a>03334       Assert( pBuffer != NULL );
<a name="l03335"></a>03335 
<a name="l03336"></a>03336       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l03337"></a>03337       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l03338"></a>03338       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l03339"></a>03339       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l03340"></a>03340       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l03341"></a>03341 
<a name="l03342"></a>03342       <span class="comment">// Add to start position of dest buffer</span>
<a name="l03343"></a>03343       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l03344"></a>03344       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l03345"></a>03345 
<a name="l03346"></a>03346       <span class="comment">// Validations</span>
<a name="l03347"></a>03347       CHECKF( iTempX &gt;= 0 );
<a name="l03348"></a>03348       CHECKF( iTempY &gt;= 0 );
<a name="l03349"></a>03349 
<a name="l03350"></a>03350 
<a name="l03351"></a>03351       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l03352"></a>03352       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*iTempY) + (iTempX);
<a name="l03353"></a>03353       LineSkip=(uiDestPitchBYTES-(usWidth));
<a name="l03354"></a>03354       pPal8BPP=hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#152256552f959a5d90dbd886d22fb679">pShade8</a>;
<a name="l03355"></a>03355 
<a name="l03356"></a>03356       __asm {
<a name="l03357"></a>03357 
<a name="l03358"></a>03358             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l03359"></a>03359             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l03360"></a>03360             xor         eax, eax
<a name="l03361"></a>03361             xor         ebx, ebx
<a name="l03362"></a>03362             xor         ecx, ecx
<a name="l03363"></a>03363             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, pPal8BPP
<a name="l03364"></a>03364 
<a name="l03365"></a>03365 BlitDispatch:
<a name="l03366"></a>03366 
<a name="l03367"></a>03367             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l03368"></a>03368             inc         esi
<a name="l03369"></a>03369             or          cl, cl
<a name="l03370"></a>03370             js          BlitTransparent
<a name="l03371"></a>03371             jz          BlitDoneLine
<a name="l03372"></a>03372 
<a name="l03373"></a>03373 <span class="comment">//BlitNonTransLoop:</span>
<a name="l03374"></a>03374 
<a name="l03375"></a>03375             clc
<a name="l03376"></a>03376             rcr         cl, 1
<a name="l03377"></a>03377             jnc         BlitNTL2
<a name="l03378"></a>03378 
<a name="l03379"></a>03379 <span class="comment">//          movsb</span>
<a name="l03380"></a>03380 
<a name="l03381"></a>03381             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l03382"></a>03382             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         al, [edx+eax]
<a name="l03383"></a>03383             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], al
<a name="l03384"></a>03384             inc         esi
<a name="l03385"></a>03385             inc         edi
<a name="l03386"></a>03386 
<a name="l03387"></a>03387 BlitNTL2:
<a name="l03388"></a>03388             clc
<a name="l03389"></a>03389             rcr         cl, 1
<a name="l03390"></a>03390             jnc         BlitNTL3
<a name="l03391"></a>03391 
<a name="l03392"></a>03392 <span class="comment">//          movsw</span>
<a name="l03393"></a>03393 
<a name="l03394"></a>03394             mov         al, [esi]
<a name="l03395"></a>03395             mov         al, [edx+eax]
<a name="l03396"></a>03396             mov         [edi], al
<a name="l03397"></a>03397 
<a name="l03398"></a>03398             mov         al, [esi+1]
<a name="l03399"></a>03399             mov         al, [edx+eax]
<a name="l03400"></a>03400             mov         [edi+1], al
<a name="l03401"></a>03401 
<a name="l03402"></a>03402             add         esi, 2
<a name="l03403"></a>03403             add         edi, 2
<a name="l03404"></a>03404 
<a name="l03405"></a>03405 BlitNTL3:
<a name="l03406"></a>03406 
<a name="l03407"></a>03407             or          cl, cl
<a name="l03408"></a>03408             jz          BlitDispatch
<a name="l03409"></a>03409 
<a name="l03410"></a>03410 BlitNTL4:
<a name="l03411"></a>03411 
<a name="l03412"></a>03412 <span class="comment">//          rep         movsd</span>
<a name="l03413"></a>03413 
<a name="l03414"></a>03414             mov         al, [esi]
<a name="l03415"></a>03415             mov         al, [edx+eax]
<a name="l03416"></a>03416             mov         [edi], al
<a name="l03417"></a>03417 
<a name="l03418"></a>03418             mov         al, [esi+1]
<a name="l03419"></a>03419             mov         al, [edx+eax]
<a name="l03420"></a>03420             mov         [edi+1], al
<a name="l03421"></a>03421 
<a name="l03422"></a>03422             mov         al, [esi+2]
<a name="l03423"></a>03423             mov         al, [edx+eax]
<a name="l03424"></a>03424             mov         [edi+2], al
<a name="l03425"></a>03425 
<a name="l03426"></a>03426             mov         al, [esi+3]
<a name="l03427"></a>03427             mov         al, [edx+eax]
<a name="l03428"></a>03428             mov         [edi+3], al
<a name="l03429"></a>03429 
<a name="l03430"></a>03430             add         esi, 4
<a name="l03431"></a>03431             add         edi, 4
<a name="l03432"></a>03432 
<a name="l03433"></a>03433             dec         cl
<a name="l03434"></a>03434             jnz         BlitNTL4
<a name="l03435"></a>03435 
<a name="l03436"></a>03436             jmp         BlitDispatch
<a name="l03437"></a>03437 
<a name="l03438"></a>03438 BlitTransparent:
<a name="l03439"></a>03439 
<a name="l03440"></a>03440             and         ecx, 07fH
<a name="l03441"></a>03441             add         edi, ecx
<a name="l03442"></a>03442             jmp         BlitDispatch
<a name="l03443"></a>03443 
<a name="l03444"></a>03444 
<a name="l03445"></a>03445 BlitDoneLine:
<a name="l03446"></a>03446 
<a name="l03447"></a>03447             dec         usHeight
<a name="l03448"></a>03448             jz          BlitDone
<a name="l03449"></a>03449             add         edi, LineSkip
<a name="l03450"></a>03450             jmp         BlitDispatch
<a name="l03451"></a>03451 
<a name="l03452"></a>03452 
<a name="l03453"></a>03453 BlitDone:
<a name="l03454"></a>03454       }
<a name="l03455"></a>03455 
<a name="l03456"></a>03456       <span class="keywordflow">return</span>(TRUE);
<a name="l03457"></a>03457 
<a name="l03458"></a>03458 }
<a name="l03459"></a>03459 
<a name="l03460"></a>03460 
<a name="l03461"></a>03461 
<a name="l03462"></a>03462 <span class="comment">/**********************************************************************************************</span>
<a name="l03463"></a>03463 <span class="comment"> Blt8BPPDataTo8BPPBufferTransZ</span>
<a name="l03464"></a>03464 <span class="comment"></span>
<a name="l03465"></a>03465 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l03466"></a>03466 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l03467"></a>03467 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on, and the Z value is</span>
<a name="l03468"></a>03468 <span class="comment">      updated to the current value, for any non-transparent pixels. The Z-buffer is 16 bit, and</span>
<a name="l03469"></a>03469 <span class="comment">      must be the same dimensions (including Pitch) as the destination.</span>
<a name="l03470"></a>03470 <span class="comment"></span>
<a name="l03471"></a>03471 <span class="comment">**********************************************************************************************/</span>
<a name="l03472"></a><a class="code" href="vobject__blitters_8h.html#1ac73379815999e811e5236472be7c6a">03472</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#1ac73379815999e811e5236472be7c6a">Blt8BPPDataTo8BPPBufferTransZ</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex )
<a name="l03473"></a>03473 {
<a name="l03474"></a>03474       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l03475"></a>03475       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth;
<a name="l03476"></a>03476       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l03477"></a>03477       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip, LineSkipZ, uiZComp;
<a name="l03478"></a>03478       <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l03479"></a>03479       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l03480"></a>03480       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *pPal8BPP;
<a name="l03481"></a>03481 
<a name="l03482"></a>03482 
<a name="l03483"></a>03483       <span class="comment">// Assertions</span>
<a name="l03484"></a>03484       Assert( hSrcVObject != NULL );
<a name="l03485"></a>03485       Assert( pBuffer != NULL );
<a name="l03486"></a>03486 
<a name="l03487"></a>03487       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l03488"></a>03488       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l03489"></a>03489       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l03490"></a>03490       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l03491"></a>03491       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l03492"></a>03492 
<a name="l03493"></a>03493       <span class="comment">// Add to start position of dest buffer</span>
<a name="l03494"></a>03494       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l03495"></a>03495       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l03496"></a>03496 
<a name="l03497"></a>03497       <span class="comment">// Validations</span>
<a name="l03498"></a>03498       CHECKF( iTempX &gt;= 0 );
<a name="l03499"></a>03499       CHECKF( iTempY &gt;= 0 );
<a name="l03500"></a>03500 
<a name="l03501"></a>03501 
<a name="l03502"></a>03502       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l03503"></a>03503       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*iTempY) + (iTempX);
<a name="l03504"></a>03504       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*2*iTempY) + (iTempX*2);
<a name="l03505"></a>03505       pPal8BPP = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#152256552f959a5d90dbd886d22fb679">pShade8</a>;
<a name="l03506"></a>03506       LineSkip=(uiDestPitchBYTES-(usWidth));
<a name="l03507"></a>03507       LineSkipZ=LineSkip*2;
<a name="l03508"></a>03508       uiZComp=(<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)usZValue;
<a name="l03509"></a>03509 
<a name="l03510"></a>03510       __asm {
<a name="l03511"></a>03511 
<a name="l03512"></a>03512             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l03513"></a>03513             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l03514"></a>03514             xor         eax, eax
<a name="l03515"></a>03515             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l03516"></a>03516             xor         ecx, ecx
<a name="l03517"></a>03517             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, pPal8BPP
<a name="l03518"></a>03518 
<a name="l03519"></a>03519 BlitDispatch:
<a name="l03520"></a>03520 
<a name="l03521"></a>03521             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l03522"></a>03522             inc         esi
<a name="l03523"></a>03523             or          cl, cl
<a name="l03524"></a>03524             js          BlitTransparent
<a name="l03525"></a>03525             jz          BlitDoneLine
<a name="l03526"></a>03526 
<a name="l03527"></a>03527 <span class="comment">//BlitNonTransLoop:</span>
<a name="l03528"></a>03528 
<a name="l03529"></a>03529             clc
<a name="l03530"></a>03530             rcr         cl, 1
<a name="l03531"></a>03531             jnc         BlitNTL2
<a name="l03532"></a>03532 
<a name="l03533"></a>03533 <span class="comment">// do a byte</span>
<a name="l03534"></a>03534             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l03535"></a>03535             cmp         eax, uiZComp
<a name="l03536"></a>03536             ja          BlitNTL4
<a name="l03537"></a>03537 
<a name="l03538"></a>03538             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, uiZComp
<a name="l03539"></a>03539             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [ebx], ax
<a name="l03540"></a>03540 
<a name="l03541"></a>03541             xor         eax, eax
<a name="l03542"></a>03542             mov         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l03543"></a>03543             mov         al, [edx+eax]
<a name="l03544"></a>03544             mov         [edi], al
<a name="l03545"></a>03545 
<a name="l03546"></a>03546 
<a name="l03547"></a>03547 BlitNTL4:
<a name="l03548"></a>03548             inc         esi
<a name="l03549"></a>03549             inc         ebx
<a name="l03550"></a>03550             inc         edi
<a name="l03551"></a>03551             inc         ebx
<a name="l03552"></a>03552 
<a name="l03553"></a>03553 <span class="comment">// do a word</span>
<a name="l03554"></a>03554 BlitNTL2:
<a name="l03555"></a>03555             clc
<a name="l03556"></a>03556             rcr         cl, 1
<a name="l03557"></a>03557             jnc         <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>
<a name="l03558"></a>03558 
<a name="l03559"></a>03559 <span class="comment">// word - first pixel</span>
<a name="l03560"></a>03560             mov         ax, [ebx]
<a name="l03561"></a>03561             cmp         eax, uiZComp
<a name="l03562"></a>03562             ja          BlitNTL3
<a name="l03563"></a>03563 
<a name="l03564"></a>03564             mov         eax, uiZComp
<a name="l03565"></a>03565             mov         [ebx], ax
<a name="l03566"></a>03566 
<a name="l03567"></a>03567             xor         eax, eax
<a name="l03568"></a>03568             mov         al, [esi]
<a name="l03569"></a>03569             mov         al, [edx+eax]
<a name="l03570"></a>03570             mov         [edi], al
<a name="l03571"></a>03571 
<a name="l03572"></a>03572 <span class="comment">// word - second</span>
<a name="l03573"></a>03573 BlitNTL3:
<a name="l03574"></a>03574             mov         ax, [ebx+2]
<a name="l03575"></a>03575             cmp         eax, uiZComp
<a name="l03576"></a>03576             ja          BlitNTL12
<a name="l03577"></a>03577 
<a name="l03578"></a>03578             mov         eax, uiZComp
<a name="l03579"></a>03579             mov         [ebx+2], ax
<a name="l03580"></a>03580 
<a name="l03581"></a>03581             xor         eax, eax
<a name="l03582"></a>03582             mov         al, [esi+1]
<a name="l03583"></a>03583             mov         al, [edx+eax]
<a name="l03584"></a>03584             mov         [edi+1], al
<a name="l03585"></a>03585 
<a name="l03586"></a>03586 BlitNTL12:
<a name="l03587"></a>03587 
<a name="l03588"></a>03588             inc         esi
<a name="l03589"></a>03589             inc         edi
<a name="l03590"></a>03590             inc         esi
<a name="l03591"></a>03591             inc         edi
<a name="l03592"></a>03592             add         ebx, 4
<a name="l03593"></a>03593 
<a name="l03594"></a>03594 <span class="comment">// do a dword</span>
<a name="l03595"></a>03595 <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>:
<a name="l03596"></a>03596             or          cl, cl
<a name="l03597"></a>03597             jz          BlitDispatch
<a name="l03598"></a>03598 
<a name="l03599"></a>03599 <a class="code" href="vobject__blitters_8cpp.html#d660d2ba340c8ef5d2d80c6365ad838f">BlitNTL7</a>:
<a name="l03600"></a>03600 
<a name="l03601"></a>03601 <span class="comment">// dword - first pixel</span>
<a name="l03602"></a>03602             mov         ax, [ebx]
<a name="l03603"></a>03603             cmp         eax, uiZComp
<a name="l03604"></a>03604             ja          <a class="code" href="vobject__blitters_8cpp.html#abf905a085ab39598c9c71ca8e8a0a0e">BlitNTL8</a>
<a name="l03605"></a>03605 
<a name="l03606"></a>03606             mov         eax, uiZComp
<a name="l03607"></a>03607             mov         [ebx], ax
<a name="l03608"></a>03608 
<a name="l03609"></a>03609             xor         eax, eax
<a name="l03610"></a>03610             mov         al, [esi]
<a name="l03611"></a>03611             mov         al, [edx+eax]
<a name="l03612"></a>03612             mov         [edi], al
<a name="l03613"></a>03613 
<a name="l03614"></a>03614 <span class="comment">// dword - second</span>
<a name="l03615"></a>03615 <a class="code" href="vobject__blitters_8cpp.html#abf905a085ab39598c9c71ca8e8a0a0e">BlitNTL8</a>:
<a name="l03616"></a>03616             mov         ax, [ebx+2]
<a name="l03617"></a>03617             cmp         eax, uiZComp
<a name="l03618"></a>03618             ja          <a class="code" href="vobject__blitters_8cpp.html#0e7ffd1e4d81460c5ee051765cc57418">BlitNTL9</a>
<a name="l03619"></a>03619 
<a name="l03620"></a>03620             mov         eax, uiZComp
<a name="l03621"></a>03621             mov         [ebx+2], ax
<a name="l03622"></a>03622 
<a name="l03623"></a>03623             xor         eax, eax
<a name="l03624"></a>03624             mov         al, [esi+1]
<a name="l03625"></a>03625             mov         al, [edx+eax]
<a name="l03626"></a>03626             mov         [edi+1], al
<a name="l03627"></a>03627 
<a name="l03628"></a>03628 <a class="code" href="vobject__blitters_8cpp.html#0e7ffd1e4d81460c5ee051765cc57418">BlitNTL9</a>:
<a name="l03629"></a>03629 <span class="comment">// dword - third pixel</span>
<a name="l03630"></a>03630             mov         ax, [ebx+4]
<a name="l03631"></a>03631             cmp         eax, uiZComp
<a name="l03632"></a>03632             ja          <a class="code" href="vobject__blitters_8cpp.html#945e5d61e3207454e74973a0fec418fd">BlitNTL10</a>
<a name="l03633"></a>03633 
<a name="l03634"></a>03634             mov         eax, uiZComp
<a name="l03635"></a>03635             mov         [ebx+4], ax
<a name="l03636"></a>03636 
<a name="l03637"></a>03637             xor         eax, eax
<a name="l03638"></a>03638             mov         al, [esi+2]
<a name="l03639"></a>03639             mov         al, [edx+eax]
<a name="l03640"></a>03640             mov         [edi+2], al
<a name="l03641"></a>03641 
<a name="l03642"></a>03642 <span class="comment">// dword - fourth</span>
<a name="l03643"></a>03643 <a class="code" href="vobject__blitters_8cpp.html#945e5d61e3207454e74973a0fec418fd">BlitNTL10</a>:
<a name="l03644"></a>03644             mov         ax, [ebx+6]
<a name="l03645"></a>03645             cmp         eax, uiZComp
<a name="l03646"></a>03646             ja          BlitNTL11
<a name="l03647"></a>03647 
<a name="l03648"></a>03648             mov         eax, uiZComp
<a name="l03649"></a>03649             mov         [ebx+6], ax
<a name="l03650"></a>03650 
<a name="l03651"></a>03651             xor         eax, eax
<a name="l03652"></a>03652             mov         al, [esi+3]
<a name="l03653"></a>03653             mov         al, [edx+eax]
<a name="l03654"></a>03654             mov         [edi+3], al
<a name="l03655"></a>03655 
<a name="l03656"></a>03656 
<a name="l03657"></a>03657 BlitNTL11:
<a name="l03658"></a>03658             add         esi, 4
<a name="l03659"></a>03659             add         edi, 4
<a name="l03660"></a>03660             add         ebx, 8
<a name="l03661"></a>03661             dec         cl
<a name="l03662"></a>03662             jnz         <a class="code" href="vobject__blitters_8cpp.html#d660d2ba340c8ef5d2d80c6365ad838f">BlitNTL7</a>
<a name="l03663"></a>03663 
<a name="l03664"></a>03664             jmp         BlitDispatch
<a name="l03665"></a>03665 
<a name="l03666"></a>03666 BlitTransparent:
<a name="l03667"></a>03667 
<a name="l03668"></a>03668             and         ecx, 07fH
<a name="l03669"></a>03669             add         edi, ecx
<a name="l03670"></a>03670 <span class="comment">//          shl         ecx, 1</span>
<a name="l03671"></a>03671             add   ecx, ecx
<a name="l03672"></a>03672             add         ebx, ecx
<a name="l03673"></a>03673             jmp         BlitDispatch
<a name="l03674"></a>03674 
<a name="l03675"></a>03675 
<a name="l03676"></a>03676 BlitDoneLine:
<a name="l03677"></a>03677 
<a name="l03678"></a>03678             dec         usHeight
<a name="l03679"></a>03679             jz          BlitDone
<a name="l03680"></a>03680             add         edi, LineSkip
<a name="l03681"></a>03681             add         ebx, LineSkipZ
<a name="l03682"></a>03682             jmp         BlitDispatch
<a name="l03683"></a>03683 
<a name="l03684"></a>03684 
<a name="l03685"></a>03685 BlitDone:
<a name="l03686"></a>03686       }
<a name="l03687"></a>03687 
<a name="l03688"></a>03688       <span class="keywordflow">return</span>(TRUE);
<a name="l03689"></a>03689 
<a name="l03690"></a>03690 }
<a name="l03691"></a>03691 
<a name="l03692"></a>03692 <span class="comment">/**********************************************************************************************</span>
<a name="l03693"></a>03693 <span class="comment"> Blt8BPPDataTo8BPPBufferTransZNB</span>
<a name="l03694"></a>03694 <span class="comment"></span>
<a name="l03695"></a>03695 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l03696"></a>03696 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l03697"></a>03697 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on. The Z value is</span>
<a name="l03698"></a>03698 <span class="comment">      not updated,      for any non-transparent pixels. The Z-buffer is 16 bit, and</span>
<a name="l03699"></a>03699 <span class="comment">      must be the same dimensions as the destination.</span>
<a name="l03700"></a>03700 <span class="comment"></span>
<a name="l03701"></a>03701 <span class="comment">**********************************************************************************************/</span>
<a name="l03702"></a><a class="code" href="vobject__blitters_8h.html#7244a991ad8cc211690e885ef82add61">03702</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#7244a991ad8cc211690e885ef82add61">Blt8BPPDataTo8BPPBufferTransZNB</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex )
<a name="l03703"></a>03703 {
<a name="l03704"></a>03704       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l03705"></a>03705       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth;
<a name="l03706"></a>03706       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l03707"></a>03707       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip, LineSkipZ;
<a name="l03708"></a>03708       <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l03709"></a>03709       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l03710"></a>03710       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *pPal8BPP;
<a name="l03711"></a>03711 
<a name="l03712"></a>03712 
<a name="l03713"></a>03713       <span class="comment">// Assertions</span>
<a name="l03714"></a>03714       Assert( hSrcVObject != NULL );
<a name="l03715"></a>03715       Assert( pBuffer != NULL );
<a name="l03716"></a>03716 
<a name="l03717"></a>03717       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l03718"></a>03718       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l03719"></a>03719       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l03720"></a>03720       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l03721"></a>03721       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l03722"></a>03722 
<a name="l03723"></a>03723       <span class="comment">// Add to start position of dest buffer</span>
<a name="l03724"></a>03724       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l03725"></a>03725       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l03726"></a>03726 
<a name="l03727"></a>03727       <span class="comment">// Validations</span>
<a name="l03728"></a>03728       CHECKF( iTempX &gt;= 0 );
<a name="l03729"></a>03729       CHECKF( iTempY &gt;= 0 );
<a name="l03730"></a>03730 
<a name="l03731"></a>03731 
<a name="l03732"></a>03732       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l03733"></a>03733       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*iTempY) + (iTempX);
<a name="l03734"></a>03734       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*2*iTempY) + (iTempX*2);
<a name="l03735"></a>03735       pPal8BPP = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#152256552f959a5d90dbd886d22fb679">pShade8</a>;
<a name="l03736"></a>03736       LineSkip=(uiDestPitchBYTES-(usWidth));
<a name="l03737"></a>03737       LineSkipZ=LineSkip*2;
<a name="l03738"></a>03738 
<a name="l03739"></a>03739       __asm {
<a name="l03740"></a>03740 
<a name="l03741"></a>03741             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l03742"></a>03742             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l03743"></a>03743             xor         eax, eax
<a name="l03744"></a>03744             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l03745"></a>03745             xor         ecx, ecx
<a name="l03746"></a>03746             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, pPal8BPP
<a name="l03747"></a>03747 
<a name="l03748"></a>03748 BlitDispatch:
<a name="l03749"></a>03749 
<a name="l03750"></a>03750             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l03751"></a>03751             inc         esi
<a name="l03752"></a>03752             or          cl, cl
<a name="l03753"></a>03753             js          BlitTransparent
<a name="l03754"></a>03754             jz          BlitDoneLine
<a name="l03755"></a>03755 
<a name="l03756"></a>03756 <span class="comment">//BlitNonTransLoop:</span>
<a name="l03757"></a>03757 
<a name="l03758"></a>03758             xor         eax, eax
<a name="l03759"></a>03759 
<a name="l03760"></a>03760 BlitNTL4:
<a name="l03761"></a>03761 
<a name="l03762"></a>03762             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l03763"></a>03763             cmp         ax, usZValue
<a name="l03764"></a>03764             ja          BlitNTL5
<a name="l03765"></a>03765 
<a name="l03766"></a>03766             xor         ah, ah
<a name="l03767"></a>03767             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l03768"></a>03768             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         al, [edx+eax]
<a name="l03769"></a>03769             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], al
<a name="l03770"></a>03770 
<a name="l03771"></a>03771 BlitNTL5:
<a name="l03772"></a>03772             inc         esi
<a name="l03773"></a>03773             inc         edi
<a name="l03774"></a>03774             add         ebx, 2
<a name="l03775"></a>03775             dec         cl
<a name="l03776"></a>03776             jnz         BlitNTL4
<a name="l03777"></a>03777 
<a name="l03778"></a>03778             jmp         BlitDispatch
<a name="l03779"></a>03779 
<a name="l03780"></a>03780 
<a name="l03781"></a>03781 BlitTransparent:
<a name="l03782"></a>03782 
<a name="l03783"></a>03783             and         ecx, 07fH
<a name="l03784"></a>03784             add         edi, ecx
<a name="l03785"></a>03785 <span class="comment">//          shl         ecx, 1</span>
<a name="l03786"></a>03786             add   ecx, ecx
<a name="l03787"></a>03787             add         ebx, ecx
<a name="l03788"></a>03788             jmp         BlitDispatch
<a name="l03789"></a>03789 
<a name="l03790"></a>03790 
<a name="l03791"></a>03791 BlitDoneLine:
<a name="l03792"></a>03792 
<a name="l03793"></a>03793             dec         usHeight
<a name="l03794"></a>03794             jz          BlitDone
<a name="l03795"></a>03795             add         edi, LineSkip
<a name="l03796"></a>03796             add         ebx, LineSkipZ
<a name="l03797"></a>03797             jmp         BlitDispatch
<a name="l03798"></a>03798 
<a name="l03799"></a>03799 
<a name="l03800"></a>03800 BlitDone:
<a name="l03801"></a>03801       }
<a name="l03802"></a>03802 
<a name="l03803"></a>03803       <span class="keywordflow">return</span>(TRUE);
<a name="l03804"></a>03804 
<a name="l03805"></a>03805 }
<a name="l03806"></a>03806 
<a name="l03807"></a>03807 <span class="comment">/**********************************************************************************************</span>
<a name="l03808"></a>03808 <span class="comment"> Blt8BPPDataTo8BPPBufferTransZNBColor</span>
<a name="l03809"></a>03809 <span class="comment"></span>
<a name="l03810"></a>03810 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l03811"></a>03811 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l03812"></a>03812 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on. The Z value is</span>
<a name="l03813"></a>03813 <span class="comment">      not updated,      for any non-transparent pixels. The Z-buffer is 16 bit, and</span>
<a name="l03814"></a>03814 <span class="comment">      must be the same dimensions as the destination. Any pixels that fail the Z test</span>
<a name="l03815"></a>03815 <span class="comment">      are written to with the specified color.</span>
<a name="l03816"></a>03816 <span class="comment"></span>
<a name="l03817"></a>03817 <span class="comment">**********************************************************************************************/</span>
<a name="l03818"></a><a class="code" href="vobject__blitters_8h.html#de2435b9e9b2c669ef48dba24e05fffd">03818</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#de2435b9e9b2c669ef48dba24e05fffd">Blt8BPPDataTo8BPPBufferTransZNBColor</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubColor)
<a name="l03819"></a>03819 {
<a name="l03820"></a>03820       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l03821"></a>03821       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth;
<a name="l03822"></a>03822       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l03823"></a>03823       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip, LineSkipZ;
<a name="l03824"></a>03824       <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l03825"></a>03825       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l03826"></a>03826       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *pPal8BPP;
<a name="l03827"></a>03827 
<a name="l03828"></a>03828 
<a name="l03829"></a>03829       <span class="comment">// Assertions</span>
<a name="l03830"></a>03830       Assert( hSrcVObject != NULL );
<a name="l03831"></a>03831       Assert( pBuffer != NULL );
<a name="l03832"></a>03832 
<a name="l03833"></a>03833       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l03834"></a>03834       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l03835"></a>03835       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l03836"></a>03836       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l03837"></a>03837       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l03838"></a>03838 
<a name="l03839"></a>03839       <span class="comment">// Add to start position of dest buffer</span>
<a name="l03840"></a>03840       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l03841"></a>03841       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l03842"></a>03842 
<a name="l03843"></a>03843       <span class="comment">// Validations</span>
<a name="l03844"></a>03844       CHECKF( iTempX &gt;= 0 );
<a name="l03845"></a>03845       CHECKF( iTempY &gt;= 0 );
<a name="l03846"></a>03846 
<a name="l03847"></a>03847 
<a name="l03848"></a>03848       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l03849"></a>03849       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*iTempY) + (iTempX);
<a name="l03850"></a>03850       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*2*iTempY) + (iTempX*2);
<a name="l03851"></a>03851       pPal8BPP = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#152256552f959a5d90dbd886d22fb679">pShade8</a>;
<a name="l03852"></a>03852       LineSkip=(uiDestPitchBYTES-(usWidth));
<a name="l03853"></a>03853       LineSkipZ=LineSkip*2;
<a name="l03854"></a>03854 
<a name="l03855"></a>03855       __asm {
<a name="l03856"></a>03856 
<a name="l03857"></a>03857             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l03858"></a>03858             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l03859"></a>03859             xor         eax, eax
<a name="l03860"></a>03860             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l03861"></a>03861             xor         ecx, ecx
<a name="l03862"></a>03862             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, pPal8BPP
<a name="l03863"></a>03863 
<a name="l03864"></a>03864 BlitDispatch:
<a name="l03865"></a>03865 
<a name="l03866"></a>03866             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l03867"></a>03867             inc         esi
<a name="l03868"></a>03868             or          cl, cl
<a name="l03869"></a>03869             js          BlitTransparent
<a name="l03870"></a>03870             jz          BlitDoneLine
<a name="l03871"></a>03871 
<a name="l03872"></a>03872 <span class="comment">//BlitNonTransLoop:</span>
<a name="l03873"></a>03873 
<a name="l03874"></a>03874             xor         eax, eax
<a name="l03875"></a>03875 
<a name="l03876"></a>03876 BlitNTL4:
<a name="l03877"></a>03877 
<a name="l03878"></a>03878             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l03879"></a>03879             cmp         ax, usZValue
<a name="l03880"></a>03880             ja          BlitNTL5
<a name="l03881"></a>03881 
<a name="l03882"></a>03882             xor         ah, ah
<a name="l03883"></a>03883             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l03884"></a>03884             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         al, [edx+eax]
<a name="l03885"></a>03885             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], al
<a name="l03886"></a>03886             jmp         <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>
<a name="l03887"></a>03887 
<a name="l03888"></a>03888 BlitNTL5:
<a name="l03889"></a>03889             xor         ah, ah
<a name="l03890"></a>03890             mov         al, ubColor
<a name="l03891"></a>03891             mov         al, [edx+eax]
<a name="l03892"></a>03892             mov         [edi], al
<a name="l03893"></a>03893 
<a name="l03894"></a>03894 <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>:
<a name="l03895"></a>03895             inc         esi
<a name="l03896"></a>03896             inc         edi
<a name="l03897"></a>03897             add         ebx, 2
<a name="l03898"></a>03898             dec         cl
<a name="l03899"></a>03899             jnz         BlitNTL4
<a name="l03900"></a>03900 
<a name="l03901"></a>03901             jmp         BlitDispatch
<a name="l03902"></a>03902 
<a name="l03903"></a>03903 
<a name="l03904"></a>03904 BlitTransparent:
<a name="l03905"></a>03905 
<a name="l03906"></a>03906             and         ecx, 07fH
<a name="l03907"></a>03907             add         edi, ecx
<a name="l03908"></a>03908 <span class="comment">//          shl         ecx, 1</span>
<a name="l03909"></a>03909             add   ecx, ecx
<a name="l03910"></a>03910             add         ebx, ecx
<a name="l03911"></a>03911             jmp         BlitDispatch
<a name="l03912"></a>03912 
<a name="l03913"></a>03913 
<a name="l03914"></a>03914 BlitDoneLine:
<a name="l03915"></a>03915 
<a name="l03916"></a>03916             dec         usHeight
<a name="l03917"></a>03917             jz          BlitDone
<a name="l03918"></a>03918             add         edi, LineSkip
<a name="l03919"></a>03919             add         ebx, LineSkipZ
<a name="l03920"></a>03920             jmp         BlitDispatch
<a name="l03921"></a>03921 
<a name="l03922"></a>03922 
<a name="l03923"></a>03923 BlitDone:
<a name="l03924"></a>03924       }
<a name="l03925"></a>03925 
<a name="l03926"></a>03926       <span class="keywordflow">return</span>(TRUE);
<a name="l03927"></a>03927 
<a name="l03928"></a>03928 }
<a name="l03929"></a>03929 
<a name="l03930"></a>03930 <span class="comment">/**********************************************************************************************</span>
<a name="l03931"></a>03931 <span class="comment"> Blt8BPPDataTo8BPPBufferTransZClip</span>
<a name="l03932"></a>03932 <span class="comment"></span>
<a name="l03933"></a>03933 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l03934"></a>03934 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l03935"></a>03935 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on, and the Z value is</span>
<a name="l03936"></a>03936 <span class="comment">      updated to the current value, for any non-transparent pixels. The Z-buffer is 16 bit, and</span>
<a name="l03937"></a>03937 <span class="comment">      must be the same dimensions (including Pitch) as the destination.</span>
<a name="l03938"></a>03938 <span class="comment"></span>
<a name="l03939"></a>03939 <span class="comment">**********************************************************************************************/</span>
<a name="l03940"></a><a class="code" href="vobject__blitters_8h.html#ef771627dee0ec5eb50eb2b3a7d1d027">03940</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#ef771627dee0ec5eb50eb2b3a7d1d027">Blt8BPPDataTo8BPPBufferTransZClip</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="structSGPRect.html">SGPRect</a> *clipregion)
<a name="l03941"></a>03941 {
<a name="l03942"></a>03942       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l03943"></a>03943       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth, Unblitted;
<a name="l03944"></a>03944       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l03945"></a>03945       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip, LineSkipZ;
<a name="l03946"></a>03946   <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l03947"></a>03947       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY, LeftSkip, RightSkip, TopSkip, BottomSkip, BlitLength, BlitHeight, LSCount;
<a name="l03948"></a>03948       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  ClipX1, ClipY1, ClipX2, ClipY2;
<a name="l03949"></a>03949       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *pPal8BPP;
<a name="l03950"></a>03950 
<a name="l03951"></a>03951       <span class="comment">// Assertions</span>
<a name="l03952"></a>03952       Assert( hSrcVObject != NULL );
<a name="l03953"></a>03953       Assert( pBuffer != NULL );
<a name="l03954"></a>03954 
<a name="l03955"></a>03955       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l03956"></a>03956       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l03957"></a>03957       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l03958"></a>03958       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l03959"></a>03959       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l03960"></a>03960 
<a name="l03961"></a>03961       <span class="comment">// Add to start position of dest buffer</span>
<a name="l03962"></a>03962       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l03963"></a>03963       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l03964"></a>03964 
<a name="l03965"></a>03965       <span class="keywordflow">if</span>(clipregion==NULL)
<a name="l03966"></a>03966       {
<a name="l03967"></a>03967             ClipX1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l03968"></a>03968             ClipY1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l03969"></a>03969             ClipX2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l03970"></a>03970             ClipY2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l03971"></a>03971       }
<a name="l03972"></a>03972       <span class="keywordflow">else</span>
<a name="l03973"></a>03973       {
<a name="l03974"></a>03974             ClipX1=clipregion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l03975"></a>03975             ClipY1=clipregion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l03976"></a>03976             ClipX2=clipregion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l03977"></a>03977             ClipY2=clipregion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l03978"></a>03978       }
<a name="l03979"></a>03979 
<a name="l03980"></a>03980       <span class="comment">// Calculate rows hanging off each side of the screen</span>
<a name="l03981"></a>03981       LeftSkip=__min(ClipX1 - min(ClipX1, iTempX), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l03982"></a>03982       RightSkip=__min(max(ClipX2, (iTempX+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth)) - ClipX2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l03983"></a>03983       TopSkip=__min(ClipY1 - __min(ClipY1, iTempY), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l03984"></a>03984       BottomSkip=__min(__max(ClipY2, (iTempY+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight)) - ClipY2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l03985"></a>03985 
<a name="l03986"></a>03986       <span class="comment">// calculate the remaining rows and columns to blit</span>
<a name="l03987"></a>03987       BlitLength=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth-LeftSkip-RightSkip);
<a name="l03988"></a>03988       BlitHeight=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight-TopSkip-BottomSkip);
<a name="l03989"></a>03989 
<a name="l03990"></a>03990       <span class="comment">// check if whole thing is clipped</span>
<a name="l03991"></a>03991       <span class="keywordflow">if</span>((LeftSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth) || (RightSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth))
<a name="l03992"></a>03992             <span class="keywordflow">return</span>(TRUE);
<a name="l03993"></a>03993 
<a name="l03994"></a>03994       <span class="comment">// check if whole thing is clipped</span>
<a name="l03995"></a>03995       <span class="keywordflow">if</span>((TopSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight) || (BottomSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight))
<a name="l03996"></a>03996             <span class="keywordflow">return</span>(TRUE);
<a name="l03997"></a>03997 
<a name="l03998"></a>03998       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l03999"></a>03999       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip));
<a name="l04000"></a>04000       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*2*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l04001"></a>04001       pPal8BPP = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#152256552f959a5d90dbd886d22fb679">pShade8</a>;
<a name="l04002"></a>04002       LineSkip=(uiDestPitchBYTES-(BlitLength));
<a name="l04003"></a>04003       LineSkipZ=LineSkip*2;
<a name="l04004"></a>04004 
<a name="l04005"></a>04005       __asm {
<a name="l04006"></a>04006 
<a name="l04007"></a>04007             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l04008"></a>04008             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l04009"></a>04009             xor         eax, eax
<a name="l04010"></a>04010             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l04011"></a>04011             xor         ecx, ecx
<a name="l04012"></a>04012             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, pPal8BPP
<a name="l04013"></a>04013 
<a name="l04014"></a>04014             cmp         TopSkip, 0                                      <span class="comment">// check for nothing clipped on top</span>
<a name="l04015"></a>04015             je          LeftSkipSetup
<a name="l04016"></a>04016 
<a name="l04017"></a>04017 TopSkipLoop:                                                            <span class="comment">// Skips the number of lines clipped at the top</span>
<a name="l04018"></a>04018 
<a name="l04019"></a>04019             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l04020"></a>04020             inc         esi
<a name="l04021"></a>04021             or          cl, cl
<a name="l04022"></a>04022             js          TopSkipLoop
<a name="l04023"></a>04023             jz          TSEndLine
<a name="l04024"></a>04024 
<a name="l04025"></a>04025             add         esi, ecx
<a name="l04026"></a>04026             jmp         TopSkipLoop
<a name="l04027"></a>04027 
<a name="l04028"></a>04028 TSEndLine:
<a name="l04029"></a>04029             dec         TopSkip
<a name="l04030"></a>04030             jnz         TopSkipLoop
<a name="l04031"></a>04031 
<a name="l04032"></a>04032 LeftSkipSetup:
<a name="l04033"></a>04033 
<a name="l04034"></a>04034             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l04035"></a>04035             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, LeftSkip
<a name="l04036"></a>04036             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l04037"></a>04037             or          eax, eax
<a name="l04038"></a>04038             jz          BlitLineSetup
<a name="l04039"></a>04039 
<a name="l04040"></a>04040 LeftSkipLoop:
<a name="l04041"></a>04041 
<a name="l04042"></a>04042             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l04043"></a>04043             inc         esi
<a name="l04044"></a>04044 
<a name="l04045"></a>04045             or          cl, cl
<a name="l04046"></a>04046             js          LSTrans
<a name="l04047"></a>04047 
<a name="l04048"></a>04048             cmp         ecx, LSCount
<a name="l04049"></a>04049             je          LSSkip2                                               <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l04050"></a>04050             jb          LSSkip1                                               <span class="comment">// if less, skip whole thing</span>
<a name="l04051"></a>04051 
<a name="l04052"></a>04052             add         esi, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l04053"></a>04053             sub         ecx, LSCount
<a name="l04054"></a>04054             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l04055"></a>04055             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l04056"></a>04056             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l04057"></a>04057             jmp         BlitNonTransLoop
<a name="l04058"></a>04058 
<a name="l04059"></a>04059 LSSkip2:
<a name="l04060"></a>04060             add         esi, ecx                                        <span class="comment">// skip whole run, and start blit with new run</span>
<a name="l04061"></a>04061             jmp         BlitLineSetup
<a name="l04062"></a>04062 
<a name="l04063"></a>04063 
<a name="l04064"></a>04064 LSSkip1:
<a name="l04065"></a>04065             add         esi, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l04066"></a>04066             sub         LSCount, ecx
<a name="l04067"></a>04067             jmp         LeftSkipLoop
<a name="l04068"></a>04068 
<a name="l04069"></a>04069 
<a name="l04070"></a>04070 LSTrans:
<a name="l04071"></a>04071             and         ecx, 07fH
<a name="l04072"></a>04072             cmp         ecx, LSCount
<a name="l04073"></a>04073             je          BlitLineSetup                             <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l04074"></a>04074             jb          LSTrans1                                        <span class="comment">// if less, skip whole thing</span>
<a name="l04075"></a>04075 
<a name="l04076"></a>04076             sub         ecx, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l04077"></a>04077             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l04078"></a>04078             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l04079"></a>04079             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l04080"></a>04080             jmp         BlitTransparent
<a name="l04081"></a>04081 
<a name="l04082"></a>04082 
<a name="l04083"></a>04083 LSTrans1:
<a name="l04084"></a>04084             sub         LSCount, ecx                                          <span class="comment">// skip whole run, continue skipping</span>
<a name="l04085"></a>04085             jmp         LeftSkipLoop
<a name="l04086"></a>04086 
<a name="l04087"></a>04087 
<a name="l04088"></a>04088 BlitLineSetup:                                                    <span class="comment">// Does any actual blitting (trans/non) for the line</span>
<a name="l04089"></a>04089             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l04090"></a>04090             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l04091"></a>04091             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l04092"></a>04092 
<a name="l04093"></a>04093 BlitDispatch:
<a name="l04094"></a>04094 
<a name="l04095"></a>04095             cmp         LSCount, 0                                      <span class="comment">// Check to see if we're done blitting</span>
<a name="l04096"></a>04096             je          RightSkipLoop
<a name="l04097"></a>04097 
<a name="l04098"></a>04098             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l04099"></a>04099             inc         esi
<a name="l04100"></a>04100             or          cl, cl
<a name="l04101"></a>04101             js          BlitTransparent
<a name="l04102"></a>04102 
<a name="l04103"></a>04103 BlitNonTransLoop:                                           <span class="comment">// blit non-transparent pixels</span>
<a name="l04104"></a>04104 
<a name="l04105"></a>04105             cmp         ecx, LSCount
<a name="l04106"></a>04106             jbe         BNTrans1
<a name="l04107"></a>04107 
<a name="l04108"></a>04108             sub         ecx, LSCount
<a name="l04109"></a>04109             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, ecx
<a name="l04110"></a>04110             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, LSCount
<a name="l04111"></a>04111 
<a name="l04112"></a>04112 BNTrans1:
<a name="l04113"></a>04113             sub         LSCount, ecx
<a name="l04114"></a>04114 
<a name="l04115"></a>04115 BlitNTL1:
<a name="l04116"></a>04116 
<a name="l04117"></a>04117             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l04118"></a>04118             cmp         ax, usZValue
<a name="l04119"></a>04119             ja          BlitNTL2
<a name="l04120"></a>04120 
<a name="l04121"></a>04121             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, usZValue
<a name="l04122"></a>04122             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [ebx], ax
<a name="l04123"></a>04123 
<a name="l04124"></a>04124             xor         eax, eax
<a name="l04125"></a>04125 
<a name="l04126"></a>04126             mov         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l04127"></a>04127             mov         al, [edx+eax]
<a name="l04128"></a>04128             mov         [edi], al
<a name="l04129"></a>04129 
<a name="l04130"></a>04130 BlitNTL2:
<a name="l04131"></a>04131             inc         esi
<a name="l04132"></a>04132             inc         edi
<a name="l04133"></a>04133             add         ebx, 2
<a name="l04134"></a>04134             dec         cl
<a name="l04135"></a>04135             jnz         BlitNTL1
<a name="l04136"></a>04136 
<a name="l04137"></a>04137 <span class="comment">//BlitLineEnd:</span>
<a name="l04138"></a>04138             add         esi, Unblitted
<a name="l04139"></a>04139             jmp         BlitDispatch
<a name="l04140"></a>04140 
<a name="l04141"></a>04141 BlitTransparent:                                                              <span class="comment">// skip transparent pixels</span>
<a name="l04142"></a>04142 
<a name="l04143"></a>04143             and         ecx, 07fH
<a name="l04144"></a>04144             cmp         ecx, LSCount
<a name="l04145"></a>04145             jbe         BTrans1
<a name="l04146"></a>04146 
<a name="l04147"></a>04147             mov         ecx, LSCount
<a name="l04148"></a>04148 
<a name="l04149"></a>04149 BTrans1:
<a name="l04150"></a>04150 
<a name="l04151"></a>04151             sub         LSCount, ecx
<a name="l04152"></a>04152             add         edi, ecx
<a name="l04153"></a>04153 <span class="comment">//          shl         ecx, 1</span>
<a name="l04154"></a>04154             add   ecx, ecx
<a name="l04155"></a>04155             add         ebx, ecx
<a name="l04156"></a>04156             jmp         BlitDispatch
<a name="l04157"></a>04157 
<a name="l04158"></a>04158 
<a name="l04159"></a>04159 RightSkipLoop:                                                                      <span class="comment">// skip along until we hit and end-of-line marker</span>
<a name="l04160"></a>04160 
<a name="l04161"></a>04161 
<a name="l04162"></a>04162 RSLoop1:
<a name="l04163"></a>04163             mov         al, [esi]
<a name="l04164"></a>04164             inc         esi
<a name="l04165"></a>04165             or          al, al
<a name="l04166"></a>04166             jnz         RSLoop1
<a name="l04167"></a>04167 
<a name="l04168"></a>04168             dec         BlitHeight
<a name="l04169"></a>04169             jz          BlitDone
<a name="l04170"></a>04170             add         edi, LineSkip
<a name="l04171"></a>04171             add         ebx, LineSkipZ
<a name="l04172"></a>04172 
<a name="l04173"></a>04173             jmp         LeftSkipSetup
<a name="l04174"></a>04174 
<a name="l04175"></a>04175 
<a name="l04176"></a>04176 BlitDone:
<a name="l04177"></a>04177       }
<a name="l04178"></a>04178 
<a name="l04179"></a>04179       <span class="keywordflow">return</span>(TRUE);
<a name="l04180"></a>04180 
<a name="l04181"></a>04181 }
<a name="l04182"></a>04182 
<a name="l04183"></a>04183 <span class="comment">/**********************************************************************************************</span>
<a name="l04184"></a>04184 <span class="comment"> Blt8BPPDataTo8BPPBufferTransZNBClip</span>
<a name="l04185"></a>04185 <span class="comment"></span>
<a name="l04186"></a>04186 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l04187"></a>04187 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l04188"></a>04188 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on, the Z value is</span>
<a name="l04189"></a>04189 <span class="comment">      not updated,      for any non-transparent pixels. The Z-buffer is 16 bit, and must be the same</span>
<a name="l04190"></a>04190 <span class="comment">      dimensions as the destination.</span>
<a name="l04191"></a>04191 <span class="comment"></span>
<a name="l04192"></a>04192 <span class="comment">**********************************************************************************************/</span>
<a name="l04193"></a><a class="code" href="vobject__blitters_8h.html#108a611239ab096e538c313bc831b881">04193</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#108a611239ab096e538c313bc831b881">Blt8BPPDataTo8BPPBufferTransZNBClip</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="structSGPRect.html">SGPRect</a> *clipregion)
<a name="l04194"></a>04194 {
<a name="l04195"></a>04195       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l04196"></a>04196       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth, Unblitted;
<a name="l04197"></a>04197       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l04198"></a>04198       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip, LineSkipZ;
<a name="l04199"></a>04199   <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l04200"></a>04200       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY, LeftSkip, RightSkip, TopSkip, BottomSkip, BlitLength, BlitHeight, LSCount;
<a name="l04201"></a>04201       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  ClipX1, ClipY1, ClipX2, ClipY2;
<a name="l04202"></a>04202       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *pPal8BPP;
<a name="l04203"></a>04203 
<a name="l04204"></a>04204       <span class="comment">// Assertions</span>
<a name="l04205"></a>04205       Assert( hSrcVObject != NULL );
<a name="l04206"></a>04206       Assert( pBuffer != NULL );
<a name="l04207"></a>04207 
<a name="l04208"></a>04208       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l04209"></a>04209       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l04210"></a>04210       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l04211"></a>04211       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l04212"></a>04212       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l04213"></a>04213 
<a name="l04214"></a>04214       <span class="comment">// Add to start position of dest buffer</span>
<a name="l04215"></a>04215       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l04216"></a>04216       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l04217"></a>04217 
<a name="l04218"></a>04218       <span class="keywordflow">if</span>(clipregion==NULL)
<a name="l04219"></a>04219       {
<a name="l04220"></a>04220             ClipX1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l04221"></a>04221             ClipY1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l04222"></a>04222             ClipX2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l04223"></a>04223             ClipY2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l04224"></a>04224       }
<a name="l04225"></a>04225       <span class="keywordflow">else</span>
<a name="l04226"></a>04226       {
<a name="l04227"></a>04227             ClipX1=clipregion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l04228"></a>04228             ClipY1=clipregion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l04229"></a>04229             ClipX2=clipregion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l04230"></a>04230             ClipY2=clipregion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l04231"></a>04231       }
<a name="l04232"></a>04232 
<a name="l04233"></a>04233       <span class="comment">// Calculate rows hanging off each side of the screen</span>
<a name="l04234"></a>04234       LeftSkip=__min(ClipX1 - min(ClipX1, iTempX), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l04235"></a>04235       RightSkip=__min(max(ClipX2, (iTempX+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth)) - ClipX2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l04236"></a>04236       TopSkip=__min(ClipY1 - __min(ClipY1, iTempY), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l04237"></a>04237       BottomSkip=__min(__max(ClipY2, (iTempY+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight)) - ClipY2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l04238"></a>04238 
<a name="l04239"></a>04239       <span class="comment">// calculate the remaining rows and columns to blit</span>
<a name="l04240"></a>04240       BlitLength=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth-LeftSkip-RightSkip);
<a name="l04241"></a>04241       BlitHeight=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight-TopSkip-BottomSkip);
<a name="l04242"></a>04242 
<a name="l04243"></a>04243       <span class="comment">// check if whole thing is clipped</span>
<a name="l04244"></a>04244       <span class="keywordflow">if</span>((LeftSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth) || (RightSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth))
<a name="l04245"></a>04245             <span class="keywordflow">return</span>(TRUE);
<a name="l04246"></a>04246 
<a name="l04247"></a>04247       <span class="comment">// check if whole thing is clipped</span>
<a name="l04248"></a>04248       <span class="keywordflow">if</span>((TopSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight) || (BottomSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight))
<a name="l04249"></a>04249             <span class="keywordflow">return</span>(TRUE);
<a name="l04250"></a>04250 
<a name="l04251"></a>04251       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l04252"></a>04252       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip));
<a name="l04253"></a>04253       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*2*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l04254"></a>04254       pPal8BPP = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#152256552f959a5d90dbd886d22fb679">pShade8</a>;
<a name="l04255"></a>04255       LineSkip=(uiDestPitchBYTES-(BlitLength));
<a name="l04256"></a>04256       LineSkipZ=LineSkip*2;
<a name="l04257"></a>04257 
<a name="l04258"></a>04258       __asm {
<a name="l04259"></a>04259 
<a name="l04260"></a>04260             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l04261"></a>04261             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l04262"></a>04262             xor         eax, eax
<a name="l04263"></a>04263             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l04264"></a>04264             xor         ecx, ecx
<a name="l04265"></a>04265             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, pPal8BPP
<a name="l04266"></a>04266 
<a name="l04267"></a>04267             cmp         TopSkip, 0                                      <span class="comment">// check for nothing clipped on top</span>
<a name="l04268"></a>04268             je          LeftSkipSetup
<a name="l04269"></a>04269 
<a name="l04270"></a>04270 TopSkipLoop:                                                            <span class="comment">// Skips the number of lines clipped at the top</span>
<a name="l04271"></a>04271 
<a name="l04272"></a>04272             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l04273"></a>04273             inc         esi
<a name="l04274"></a>04274             or          cl, cl
<a name="l04275"></a>04275             js          TopSkipLoop
<a name="l04276"></a>04276             jz          TSEndLine
<a name="l04277"></a>04277 
<a name="l04278"></a>04278             add         esi, ecx
<a name="l04279"></a>04279             jmp         TopSkipLoop
<a name="l04280"></a>04280 
<a name="l04281"></a>04281 TSEndLine:
<a name="l04282"></a>04282             dec         TopSkip
<a name="l04283"></a>04283             jnz         TopSkipLoop
<a name="l04284"></a>04284 
<a name="l04285"></a>04285 LeftSkipSetup:
<a name="l04286"></a>04286 
<a name="l04287"></a>04287             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l04288"></a>04288             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, LeftSkip
<a name="l04289"></a>04289             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l04290"></a>04290             or          eax, eax
<a name="l04291"></a>04291             jz          BlitLineSetup
<a name="l04292"></a>04292 
<a name="l04293"></a>04293 LeftSkipLoop:
<a name="l04294"></a>04294 
<a name="l04295"></a>04295             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l04296"></a>04296             inc         esi
<a name="l04297"></a>04297 
<a name="l04298"></a>04298             or          cl, cl
<a name="l04299"></a>04299             js          LSTrans
<a name="l04300"></a>04300 
<a name="l04301"></a>04301             cmp         ecx, LSCount
<a name="l04302"></a>04302             je          LSSkip2                                               <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l04303"></a>04303             jb          LSSkip1                                               <span class="comment">// if less, skip whole thing</span>
<a name="l04304"></a>04304 
<a name="l04305"></a>04305             add         esi, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l04306"></a>04306             sub         ecx, LSCount
<a name="l04307"></a>04307             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l04308"></a>04308             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l04309"></a>04309             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l04310"></a>04310             jmp         BlitNonTransLoop
<a name="l04311"></a>04311 
<a name="l04312"></a>04312 LSSkip2:
<a name="l04313"></a>04313             add         esi, ecx                                        <span class="comment">// skip whole run, and start blit with new run</span>
<a name="l04314"></a>04314             jmp         BlitLineSetup
<a name="l04315"></a>04315 
<a name="l04316"></a>04316 
<a name="l04317"></a>04317 LSSkip1:
<a name="l04318"></a>04318             add         esi, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l04319"></a>04319             sub         LSCount, ecx
<a name="l04320"></a>04320             jmp         LeftSkipLoop
<a name="l04321"></a>04321 
<a name="l04322"></a>04322 
<a name="l04323"></a>04323 LSTrans:
<a name="l04324"></a>04324             and         ecx, 07fH
<a name="l04325"></a>04325             cmp         ecx, LSCount
<a name="l04326"></a>04326             je          BlitLineSetup                             <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l04327"></a>04327             jb          LSTrans1                                        <span class="comment">// if less, skip whole thing</span>
<a name="l04328"></a>04328 
<a name="l04329"></a>04329             sub         ecx, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l04330"></a>04330             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l04331"></a>04331             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l04332"></a>04332             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l04333"></a>04333             jmp         BlitTransparent
<a name="l04334"></a>04334 
<a name="l04335"></a>04335 
<a name="l04336"></a>04336 LSTrans1:
<a name="l04337"></a>04337             sub         LSCount, ecx                                          <span class="comment">// skip whole run, continue skipping</span>
<a name="l04338"></a>04338             jmp         LeftSkipLoop
<a name="l04339"></a>04339 
<a name="l04340"></a>04340 
<a name="l04341"></a>04341 BlitLineSetup:                                                    <span class="comment">// Does any actual blitting (trans/non) for the line</span>
<a name="l04342"></a>04342             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l04343"></a>04343             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l04344"></a>04344             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l04345"></a>04345 
<a name="l04346"></a>04346 BlitDispatch:
<a name="l04347"></a>04347 
<a name="l04348"></a>04348             cmp         LSCount, 0                                      <span class="comment">// Check to see if we're done blitting</span>
<a name="l04349"></a>04349             je          RightSkipLoop
<a name="l04350"></a>04350 
<a name="l04351"></a>04351             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l04352"></a>04352             inc         esi
<a name="l04353"></a>04353             or          cl, cl
<a name="l04354"></a>04354             js          BlitTransparent
<a name="l04355"></a>04355 
<a name="l04356"></a>04356 BlitNonTransLoop:                                           <span class="comment">// blit non-transparent pixels</span>
<a name="l04357"></a>04357 
<a name="l04358"></a>04358             cmp         ecx, LSCount
<a name="l04359"></a>04359             jbe         BNTrans1
<a name="l04360"></a>04360 
<a name="l04361"></a>04361             sub         ecx, LSCount
<a name="l04362"></a>04362             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, ecx
<a name="l04363"></a>04363             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, LSCount
<a name="l04364"></a>04364 
<a name="l04365"></a>04365 BNTrans1:
<a name="l04366"></a>04366             sub         LSCount, ecx
<a name="l04367"></a>04367 
<a name="l04368"></a>04368 BlitNTL1:
<a name="l04369"></a>04369 
<a name="l04370"></a>04370             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l04371"></a>04371             cmp         ax, usZValue
<a name="l04372"></a>04372             ja          BlitNTL2
<a name="l04373"></a>04373 
<a name="l04374"></a>04374             xor         eax, eax
<a name="l04375"></a>04375 
<a name="l04376"></a>04376             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l04377"></a>04377             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         al, [edx+eax]
<a name="l04378"></a>04378             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], al
<a name="l04379"></a>04379 
<a name="l04380"></a>04380 BlitNTL2:
<a name="l04381"></a>04381             inc         esi
<a name="l04382"></a>04382             inc         edi
<a name="l04383"></a>04383             add         ebx, 2
<a name="l04384"></a>04384             dec         cl
<a name="l04385"></a>04385             jnz         BlitNTL1
<a name="l04386"></a>04386 
<a name="l04387"></a>04387 <span class="comment">//BlitLineEnd:</span>
<a name="l04388"></a>04388             add         esi, Unblitted
<a name="l04389"></a>04389             jmp         BlitDispatch
<a name="l04390"></a>04390 
<a name="l04391"></a>04391 BlitTransparent:                                                              <span class="comment">// skip transparent pixels</span>
<a name="l04392"></a>04392 
<a name="l04393"></a>04393             and         ecx, 07fH
<a name="l04394"></a>04394             cmp         ecx, LSCount
<a name="l04395"></a>04395             jbe         BTrans1
<a name="l04396"></a>04396 
<a name="l04397"></a>04397             mov         ecx, LSCount
<a name="l04398"></a>04398 
<a name="l04399"></a>04399 BTrans1:
<a name="l04400"></a>04400 
<a name="l04401"></a>04401             sub         LSCount, ecx
<a name="l04402"></a>04402             add         edi, ecx
<a name="l04403"></a>04403 <span class="comment">//          shl         ecx, 1</span>
<a name="l04404"></a>04404             add   ecx, ecx
<a name="l04405"></a>04405             add         ebx, ecx
<a name="l04406"></a>04406             jmp         BlitDispatch
<a name="l04407"></a>04407 
<a name="l04408"></a>04408 
<a name="l04409"></a>04409 RightSkipLoop:                                                                      <span class="comment">// skip along until we hit and end-of-line marker</span>
<a name="l04410"></a>04410 
<a name="l04411"></a>04411 
<a name="l04412"></a>04412 RSLoop1:
<a name="l04413"></a>04413             mov         al, [esi]
<a name="l04414"></a>04414             inc         esi
<a name="l04415"></a>04415             or          al, al
<a name="l04416"></a>04416             jnz         RSLoop1
<a name="l04417"></a>04417 
<a name="l04418"></a>04418             dec         BlitHeight
<a name="l04419"></a>04419             jz          BlitDone
<a name="l04420"></a>04420             add         edi, LineSkip
<a name="l04421"></a>04421             add         ebx, LineSkipZ
<a name="l04422"></a>04422 
<a name="l04423"></a>04423             jmp         LeftSkipSetup
<a name="l04424"></a>04424 
<a name="l04425"></a>04425 
<a name="l04426"></a>04426 BlitDone:
<a name="l04427"></a>04427       }
<a name="l04428"></a>04428 
<a name="l04429"></a>04429       <span class="keywordflow">return</span>(TRUE);
<a name="l04430"></a>04430 
<a name="l04431"></a>04431 }
<a name="l04432"></a>04432 
<a name="l04433"></a>04433 <span class="comment">/**********************************************************************************************</span>
<a name="l04434"></a>04434 <span class="comment"> Blt8BPPDataTo8BPPBufferTransZNBClipColor</span>
<a name="l04435"></a>04435 <span class="comment"></span>
<a name="l04436"></a>04436 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l04437"></a>04437 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l04438"></a>04438 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on, the Z value is</span>
<a name="l04439"></a>04439 <span class="comment">      not updated,      for any non-transparent pixels. The Z-buffer is 16 bit, and must be the same</span>
<a name="l04440"></a>04440 <span class="comment">      dimensions as the destination.</span>
<a name="l04441"></a>04441 <span class="comment"></span>
<a name="l04442"></a>04442 <span class="comment">**********************************************************************************************/</span>
<a name="l04443"></a><a class="code" href="vobject__blitters_8h.html#97dc590c27c57bcfefc4d40e887eb5e4">04443</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#97dc590c27c57bcfefc4d40e887eb5e4">Blt8BPPDataTo8BPPBufferTransZNBClipColor</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="structSGPRect.html">SGPRect</a> *clipregion, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> ubColor)
<a name="l04444"></a>04444 {
<a name="l04445"></a>04445       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l04446"></a>04446       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth, Unblitted;
<a name="l04447"></a>04447       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l04448"></a>04448       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip, LineSkipZ;
<a name="l04449"></a>04449   <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l04450"></a>04450       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY, LeftSkip, RightSkip, TopSkip, BottomSkip, BlitLength, BlitHeight, LSCount;
<a name="l04451"></a>04451       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  ClipX1, ClipY1, ClipX2, ClipY2;
<a name="l04452"></a>04452       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *pPal8BPP;
<a name="l04453"></a>04453 
<a name="l04454"></a>04454       <span class="comment">// Assertions</span>
<a name="l04455"></a>04455       Assert( hSrcVObject != NULL );
<a name="l04456"></a>04456       Assert( pBuffer != NULL );
<a name="l04457"></a>04457 
<a name="l04458"></a>04458       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l04459"></a>04459       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l04460"></a>04460       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l04461"></a>04461       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l04462"></a>04462       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l04463"></a>04463 
<a name="l04464"></a>04464       <span class="comment">// Add to start position of dest buffer</span>
<a name="l04465"></a>04465       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l04466"></a>04466       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l04467"></a>04467 
<a name="l04468"></a>04468       <span class="keywordflow">if</span>(clipregion==NULL)
<a name="l04469"></a>04469       {
<a name="l04470"></a>04470             ClipX1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l04471"></a>04471             ClipY1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l04472"></a>04472             ClipX2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l04473"></a>04473             ClipY2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l04474"></a>04474       }
<a name="l04475"></a>04475       <span class="keywordflow">else</span>
<a name="l04476"></a>04476       {
<a name="l04477"></a>04477             ClipX1=clipregion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l04478"></a>04478             ClipY1=clipregion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l04479"></a>04479             ClipX2=clipregion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l04480"></a>04480             ClipY2=clipregion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l04481"></a>04481       }
<a name="l04482"></a>04482 
<a name="l04483"></a>04483       <span class="comment">// Calculate rows hanging off each side of the screen</span>
<a name="l04484"></a>04484       LeftSkip=__min(ClipX1 - min(ClipX1, iTempX), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l04485"></a>04485       RightSkip=__min(max(ClipX2, (iTempX+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth)) - ClipX2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l04486"></a>04486       TopSkip=__min(ClipY1 - __min(ClipY1, iTempY), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l04487"></a>04487       BottomSkip=__min(__max(ClipY2, (iTempY+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight)) - ClipY2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l04488"></a>04488 
<a name="l04489"></a>04489       <span class="comment">// calculate the remaining rows and columns to blit</span>
<a name="l04490"></a>04490       BlitLength=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth-LeftSkip-RightSkip);
<a name="l04491"></a>04491       BlitHeight=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight-TopSkip-BottomSkip);
<a name="l04492"></a>04492 
<a name="l04493"></a>04493       <span class="comment">// check if whole thing is clipped</span>
<a name="l04494"></a>04494       <span class="keywordflow">if</span>((LeftSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth) || (RightSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth))
<a name="l04495"></a>04495             <span class="keywordflow">return</span>(TRUE);
<a name="l04496"></a>04496 
<a name="l04497"></a>04497       <span class="comment">// check if whole thing is clipped</span>
<a name="l04498"></a>04498       <span class="keywordflow">if</span>((TopSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight) || (BottomSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight))
<a name="l04499"></a>04499             <span class="keywordflow">return</span>(TRUE);
<a name="l04500"></a>04500 
<a name="l04501"></a>04501       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l04502"></a>04502       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip));
<a name="l04503"></a>04503       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*2*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l04504"></a>04504       pPal8BPP = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#152256552f959a5d90dbd886d22fb679">pShade8</a>;
<a name="l04505"></a>04505       LineSkip=(uiDestPitchBYTES-(BlitLength));
<a name="l04506"></a>04506       LineSkipZ=LineSkip*2;
<a name="l04507"></a>04507 
<a name="l04508"></a>04508       __asm {
<a name="l04509"></a>04509 
<a name="l04510"></a>04510             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l04511"></a>04511             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l04512"></a>04512             xor         eax, eax
<a name="l04513"></a>04513             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l04514"></a>04514             xor         ecx, ecx
<a name="l04515"></a>04515             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, pPal8BPP
<a name="l04516"></a>04516 
<a name="l04517"></a>04517             cmp         TopSkip, 0                                      <span class="comment">// check for nothing clipped on top</span>
<a name="l04518"></a>04518             je          LeftSkipSetup
<a name="l04519"></a>04519 
<a name="l04520"></a>04520 TopSkipLoop:                                                            <span class="comment">// Skips the number of lines clipped at the top</span>
<a name="l04521"></a>04521 
<a name="l04522"></a>04522             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l04523"></a>04523             inc         esi
<a name="l04524"></a>04524             or          cl, cl
<a name="l04525"></a>04525             js          TopSkipLoop
<a name="l04526"></a>04526             jz          TSEndLine
<a name="l04527"></a>04527 
<a name="l04528"></a>04528             add         esi, ecx
<a name="l04529"></a>04529             jmp         TopSkipLoop
<a name="l04530"></a>04530 
<a name="l04531"></a>04531 TSEndLine:
<a name="l04532"></a>04532             dec         TopSkip
<a name="l04533"></a>04533             jnz         TopSkipLoop
<a name="l04534"></a>04534 
<a name="l04535"></a>04535 LeftSkipSetup:
<a name="l04536"></a>04536 
<a name="l04537"></a>04537             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l04538"></a>04538             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, LeftSkip
<a name="l04539"></a>04539             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l04540"></a>04540             or          eax, eax
<a name="l04541"></a>04541             jz          BlitLineSetup
<a name="l04542"></a>04542 
<a name="l04543"></a>04543 LeftSkipLoop:
<a name="l04544"></a>04544 
<a name="l04545"></a>04545             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l04546"></a>04546             inc         esi
<a name="l04547"></a>04547 
<a name="l04548"></a>04548             or          cl, cl
<a name="l04549"></a>04549             js          LSTrans
<a name="l04550"></a>04550 
<a name="l04551"></a>04551             cmp         ecx, LSCount
<a name="l04552"></a>04552             je          LSSkip2                                               <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l04553"></a>04553             jb          LSSkip1                                               <span class="comment">// if less, skip whole thing</span>
<a name="l04554"></a>04554 
<a name="l04555"></a>04555             add         esi, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l04556"></a>04556             sub         ecx, LSCount
<a name="l04557"></a>04557             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l04558"></a>04558             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l04559"></a>04559             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l04560"></a>04560             jmp         BlitNonTransLoop
<a name="l04561"></a>04561 
<a name="l04562"></a>04562 LSSkip2:
<a name="l04563"></a>04563             add         esi, ecx                                        <span class="comment">// skip whole run, and start blit with new run</span>
<a name="l04564"></a>04564             jmp         BlitLineSetup
<a name="l04565"></a>04565 
<a name="l04566"></a>04566 
<a name="l04567"></a>04567 LSSkip1:
<a name="l04568"></a>04568             add         esi, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l04569"></a>04569             sub         LSCount, ecx
<a name="l04570"></a>04570             jmp         LeftSkipLoop
<a name="l04571"></a>04571 
<a name="l04572"></a>04572 
<a name="l04573"></a>04573 LSTrans:
<a name="l04574"></a>04574             and         ecx, 07fH
<a name="l04575"></a>04575             cmp         ecx, LSCount
<a name="l04576"></a>04576             je          BlitLineSetup                             <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l04577"></a>04577             jb          LSTrans1                                        <span class="comment">// if less, skip whole thing</span>
<a name="l04578"></a>04578 
<a name="l04579"></a>04579             sub         ecx, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l04580"></a>04580             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l04581"></a>04581             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l04582"></a>04582             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l04583"></a>04583             jmp         BlitTransparent
<a name="l04584"></a>04584 
<a name="l04585"></a>04585 
<a name="l04586"></a>04586 LSTrans1:
<a name="l04587"></a>04587             sub         LSCount, ecx                                          <span class="comment">// skip whole run, continue skipping</span>
<a name="l04588"></a>04588             jmp         LeftSkipLoop
<a name="l04589"></a>04589 
<a name="l04590"></a>04590 
<a name="l04591"></a>04591 BlitLineSetup:                                                    <span class="comment">// Does any actual blitting (trans/non) for the line</span>
<a name="l04592"></a>04592             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l04593"></a>04593             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l04594"></a>04594             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l04595"></a>04595 
<a name="l04596"></a>04596 BlitDispatch:
<a name="l04597"></a>04597 
<a name="l04598"></a>04598             cmp         LSCount, 0                                      <span class="comment">// Check to see if we're done blitting</span>
<a name="l04599"></a>04599             je          RightSkipLoop
<a name="l04600"></a>04600 
<a name="l04601"></a>04601             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l04602"></a>04602             inc         esi
<a name="l04603"></a>04603             or          cl, cl
<a name="l04604"></a>04604             js          BlitTransparent
<a name="l04605"></a>04605 
<a name="l04606"></a>04606 BlitNonTransLoop:                                           <span class="comment">// blit non-transparent pixels</span>
<a name="l04607"></a>04607 
<a name="l04608"></a>04608             cmp         ecx, LSCount
<a name="l04609"></a>04609             jbe         BNTrans1
<a name="l04610"></a>04610 
<a name="l04611"></a>04611             sub         ecx, LSCount
<a name="l04612"></a>04612             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, ecx
<a name="l04613"></a>04613             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, LSCount
<a name="l04614"></a>04614 
<a name="l04615"></a>04615 BNTrans1:
<a name="l04616"></a>04616             sub         LSCount, ecx
<a name="l04617"></a>04617             xor         eax, eax
<a name="l04618"></a>04618 
<a name="l04619"></a>04619 BlitNTL1:
<a name="l04620"></a>04620 
<a name="l04621"></a>04621             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l04622"></a>04622             cmp         ax, usZValue
<a name="l04623"></a>04623             ja          BlitNTL2
<a name="l04624"></a>04624 
<a name="l04625"></a>04625             xor         ah, ah
<a name="l04626"></a>04626             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l04627"></a>04627             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         al, [edx+eax]
<a name="l04628"></a>04628             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], al
<a name="l04629"></a>04629             jmp         BlitNTL3
<a name="l04630"></a>04630 
<a name="l04631"></a>04631 BlitNTL2:
<a name="l04632"></a>04632 
<a name="l04633"></a>04633             xor         ah, ah
<a name="l04634"></a>04634             mov         al, ubColor
<a name="l04635"></a>04635             mov         al, [edx+eax]
<a name="l04636"></a>04636             mov         [edi], al
<a name="l04637"></a>04637 
<a name="l04638"></a>04638 BlitNTL3:
<a name="l04639"></a>04639             inc         esi
<a name="l04640"></a>04640             inc         edi
<a name="l04641"></a>04641             add         ebx, 2
<a name="l04642"></a>04642             dec         cl
<a name="l04643"></a>04643             jnz         BlitNTL1
<a name="l04644"></a>04644 
<a name="l04645"></a>04645 <span class="comment">//BlitLineEnd:</span>
<a name="l04646"></a>04646             add         esi, Unblitted
<a name="l04647"></a>04647             jmp         BlitDispatch
<a name="l04648"></a>04648 
<a name="l04649"></a>04649 BlitTransparent:                                                              <span class="comment">// skip transparent pixels</span>
<a name="l04650"></a>04650 
<a name="l04651"></a>04651             and         ecx, 07fH
<a name="l04652"></a>04652             cmp         ecx, LSCount
<a name="l04653"></a>04653             jbe         BTrans1
<a name="l04654"></a>04654 
<a name="l04655"></a>04655             mov         ecx, LSCount
<a name="l04656"></a>04656 
<a name="l04657"></a>04657 BTrans1:
<a name="l04658"></a>04658 
<a name="l04659"></a>04659             sub         LSCount, ecx
<a name="l04660"></a>04660             add         edi, ecx
<a name="l04661"></a>04661 <span class="comment">//          shl         ecx, 1</span>
<a name="l04662"></a>04662             add   ecx, ecx
<a name="l04663"></a>04663             add         ebx, ecx
<a name="l04664"></a>04664             jmp         BlitDispatch
<a name="l04665"></a>04665 
<a name="l04666"></a>04666 
<a name="l04667"></a>04667 RightSkipLoop:                                                                      <span class="comment">// skip along until we hit and end-of-line marker</span>
<a name="l04668"></a>04668 
<a name="l04669"></a>04669 
<a name="l04670"></a>04670 RSLoop1:
<a name="l04671"></a>04671             mov         al, [esi]
<a name="l04672"></a>04672             inc         esi
<a name="l04673"></a>04673             or          al, al
<a name="l04674"></a>04674             jnz         RSLoop1
<a name="l04675"></a>04675 
<a name="l04676"></a>04676             dec         BlitHeight
<a name="l04677"></a>04677             jz          BlitDone
<a name="l04678"></a>04678             add         edi, LineSkip
<a name="l04679"></a>04679             add         ebx, LineSkipZ
<a name="l04680"></a>04680 
<a name="l04681"></a>04681             jmp         LeftSkipSetup
<a name="l04682"></a>04682 
<a name="l04683"></a>04683 
<a name="l04684"></a>04684 BlitDone:
<a name="l04685"></a>04685       }
<a name="l04686"></a>04686 
<a name="l04687"></a>04687       <span class="keywordflow">return</span>(TRUE);
<a name="l04688"></a>04688 
<a name="l04689"></a>04689 }
<a name="l04690"></a>04690 
<a name="l04691"></a>04691 <span class="comment">/**********************************************************************************************</span>
<a name="l04692"></a>04692 <span class="comment"> Blt8BPPDataTo8BPPBufferShadowZ</span>
<a name="l04693"></a>04693 <span class="comment"></span>
<a name="l04694"></a>04694 <span class="comment">      Creates a shadow using a brush, but modifies the destination buffer only if the current</span>
<a name="l04695"></a>04695 <span class="comment">      Z level is equal to higher than what's in the Z buffer at that pixel location. It</span>
<a name="l04696"></a>04696 <span class="comment">      updates the Z buffer with the new Z level.</span>
<a name="l04697"></a>04697 <span class="comment"></span>
<a name="l04698"></a>04698 <span class="comment">**********************************************************************************************/</span>
<a name="l04699"></a><a class="code" href="vobject__blitters_8h.html#eed4d2ee27364383a98ee7f3a3dbc4dc">04699</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#eed4d2ee27364383a98ee7f3a3dbc4dc">Blt8BPPDataTo8BPPBufferShadowZ</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex )
<a name="l04700"></a>04700 {
<a name="l04701"></a>04701       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l04702"></a>04702       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth;
<a name="l04703"></a>04703       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l04704"></a>04704       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip, LineSkipZ;
<a name="l04705"></a>04705       <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l04706"></a>04706       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l04707"></a>04707       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *pPal8BPP;
<a name="l04708"></a>04708 
<a name="l04709"></a>04709 
<a name="l04710"></a>04710       <span class="comment">// Assertions</span>
<a name="l04711"></a>04711       Assert( hSrcVObject != NULL );
<a name="l04712"></a>04712       Assert( pBuffer != NULL );
<a name="l04713"></a>04713 
<a name="l04714"></a>04714       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l04715"></a>04715       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l04716"></a>04716       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l04717"></a>04717       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l04718"></a>04718       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l04719"></a>04719 
<a name="l04720"></a>04720       <span class="comment">// Add to start position of dest buffer</span>
<a name="l04721"></a>04721       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l04722"></a>04722       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l04723"></a>04723 
<a name="l04724"></a>04724       <span class="comment">// Validations</span>
<a name="l04725"></a>04725       CHECKF( iTempX &gt;= 0 );
<a name="l04726"></a>04726       CHECKF( iTempY &gt;= 0 );
<a name="l04727"></a>04727 
<a name="l04728"></a>04728 
<a name="l04729"></a>04729       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l04730"></a>04730       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*iTempY) + (iTempX);
<a name="l04731"></a>04731       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*2*iTempY) + (iTempX*2);
<a name="l04732"></a>04732       pPal8BPP = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#152256552f959a5d90dbd886d22fb679">pShade8</a>;
<a name="l04733"></a>04733       LineSkip=(uiDestPitchBYTES-(usWidth));
<a name="l04734"></a>04734       LineSkipZ=LineSkip*2;
<a name="l04735"></a>04735 
<a name="l04736"></a>04736       __asm {
<a name="l04737"></a>04737 
<a name="l04738"></a>04738             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l04739"></a>04739             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l04740"></a>04740             xor         eax, eax
<a name="l04741"></a>04741             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l04742"></a>04742             xor         ecx, ecx
<a name="l04743"></a>04743             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, pPal8BPP
<a name="l04744"></a>04744 
<a name="l04745"></a>04745 BlitDispatch:
<a name="l04746"></a>04746 
<a name="l04747"></a>04747             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l04748"></a>04748             inc         esi
<a name="l04749"></a>04749             or          cl, cl
<a name="l04750"></a>04750             js          BlitTransparent
<a name="l04751"></a>04751             jz          BlitDoneLine
<a name="l04752"></a>04752 
<a name="l04753"></a>04753 <span class="comment">//BlitNonTransLoop:</span>
<a name="l04754"></a>04754 
<a name="l04755"></a>04755 BlitNTL4:
<a name="l04756"></a>04756 
<a name="l04757"></a>04757             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l04758"></a>04758             cmp         ax, usZValue
<a name="l04759"></a>04759             jae         BlitNTL5
<a name="l04760"></a>04760 
<a name="l04761"></a>04761             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, usZValue
<a name="l04762"></a>04762             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [ebx], ax
<a name="l04763"></a>04763 
<a name="l04764"></a>04764             xor         eax, eax
<a name="l04765"></a>04765             mov         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [edi]
<a name="l04766"></a>04766             mov         al, [edx+eax]
<a name="l04767"></a>04767             mov         [edi], al
<a name="l04768"></a>04768 
<a name="l04769"></a>04769 BlitNTL5:
<a name="l04770"></a>04770             inc         esi
<a name="l04771"></a>04771             inc         edi
<a name="l04772"></a>04772             add         ebx, 2
<a name="l04773"></a>04773             dec         cl
<a name="l04774"></a>04774             jnz         BlitNTL4
<a name="l04775"></a>04775 
<a name="l04776"></a>04776             jmp         BlitDispatch
<a name="l04777"></a>04777 
<a name="l04778"></a>04778 
<a name="l04779"></a>04779 BlitTransparent:
<a name="l04780"></a>04780 
<a name="l04781"></a>04781             and         ecx, 07fH
<a name="l04782"></a>04782             add         edi, ecx
<a name="l04783"></a>04783 <span class="comment">//          shl         ecx, 1</span>
<a name="l04784"></a>04784             add   ecx, ecx
<a name="l04785"></a>04785             add         ebx, ecx
<a name="l04786"></a>04786             jmp         BlitDispatch
<a name="l04787"></a>04787 
<a name="l04788"></a>04788 
<a name="l04789"></a>04789 BlitDoneLine:
<a name="l04790"></a>04790 
<a name="l04791"></a>04791             dec         usHeight
<a name="l04792"></a>04792             jz          BlitDone
<a name="l04793"></a>04793             add         edi, LineSkip
<a name="l04794"></a>04794             add         ebx, LineSkipZ
<a name="l04795"></a>04795             jmp         BlitDispatch
<a name="l04796"></a>04796 
<a name="l04797"></a>04797 
<a name="l04798"></a>04798 BlitDone:
<a name="l04799"></a>04799       }
<a name="l04800"></a>04800 
<a name="l04801"></a>04801       <span class="keywordflow">return</span>(TRUE);
<a name="l04802"></a>04802 
<a name="l04803"></a>04803 }
<a name="l04804"></a>04804 
<a name="l04805"></a>04805 <span class="comment">/**********************************************************************************************</span>
<a name="l04806"></a>04806 <span class="comment"> Blt8BPPDataTo8BPPBufferShadowZNB</span>
<a name="l04807"></a>04807 <span class="comment"></span>
<a name="l04808"></a>04808 <span class="comment">      Creates a shadow using a brush, but modifies the destination buffer only if the current</span>
<a name="l04809"></a>04809 <span class="comment">      Z level is equal to higher than what's in the Z buffer at that pixel location.</span>
<a name="l04810"></a>04810 <span class="comment">      The Z buffer is NOT updated with the new information.</span>
<a name="l04811"></a>04811 <span class="comment"></span>
<a name="l04812"></a>04812 <span class="comment">**********************************************************************************************/</span>
<a name="l04813"></a><a class="code" href="vobject__blitters_8h.html#029079c2635b99e8bdc96931da8c4257">04813</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#029079c2635b99e8bdc96931da8c4257">Blt8BPPDataTo8BPPBufferShadowZNB</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex )
<a name="l04814"></a>04814 {
<a name="l04815"></a>04815       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l04816"></a>04816       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth;
<a name="l04817"></a>04817       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l04818"></a>04818       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip, LineSkipZ;
<a name="l04819"></a>04819       <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l04820"></a>04820       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l04821"></a>04821       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *pPal8BPP;
<a name="l04822"></a>04822 
<a name="l04823"></a>04823 
<a name="l04824"></a>04824       <span class="comment">// Assertions</span>
<a name="l04825"></a>04825       Assert( hSrcVObject != NULL );
<a name="l04826"></a>04826       Assert( pBuffer != NULL );
<a name="l04827"></a>04827 
<a name="l04828"></a>04828       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l04829"></a>04829       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l04830"></a>04830       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l04831"></a>04831       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l04832"></a>04832       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l04833"></a>04833 
<a name="l04834"></a>04834       <span class="comment">// Add to start position of dest buffer</span>
<a name="l04835"></a>04835       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l04836"></a>04836       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l04837"></a>04837 
<a name="l04838"></a>04838       <span class="comment">// Validations</span>
<a name="l04839"></a>04839       CHECKF( iTempX &gt;= 0 );
<a name="l04840"></a>04840       CHECKF( iTempY &gt;= 0 );
<a name="l04841"></a>04841 
<a name="l04842"></a>04842 
<a name="l04843"></a>04843       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l04844"></a>04844       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*iTempY) + (iTempX);
<a name="l04845"></a>04845       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*2*iTempY) + (iTempX*2);
<a name="l04846"></a>04846       pPal8BPP = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#152256552f959a5d90dbd886d22fb679">pShade8</a>;
<a name="l04847"></a>04847       LineSkip=(uiDestPitchBYTES-(usWidth));
<a name="l04848"></a>04848       LineSkipZ=LineSkip*2;
<a name="l04849"></a>04849 
<a name="l04850"></a>04850       __asm {
<a name="l04851"></a>04851 
<a name="l04852"></a>04852             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l04853"></a>04853             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l04854"></a>04854             xor         eax, eax
<a name="l04855"></a>04855             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l04856"></a>04856             xor         ecx, ecx
<a name="l04857"></a>04857             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, pPal8BPP
<a name="l04858"></a>04858 
<a name="l04859"></a>04859 BlitDispatch:
<a name="l04860"></a>04860 
<a name="l04861"></a>04861             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l04862"></a>04862             inc         esi
<a name="l04863"></a>04863             or          cl, cl
<a name="l04864"></a>04864             js          BlitTransparent
<a name="l04865"></a>04865             jz          BlitDoneLine
<a name="l04866"></a>04866 
<a name="l04867"></a>04867 <span class="comment">//BlitNonTransLoop:</span>
<a name="l04868"></a>04868 
<a name="l04869"></a>04869 BlitNTL4:
<a name="l04870"></a>04870 
<a name="l04871"></a>04871             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l04872"></a>04872             cmp         ax, usZValue
<a name="l04873"></a>04873             jae         BlitNTL5
<a name="l04874"></a>04874 
<a name="l04875"></a>04875             xor         eax, eax
<a name="l04876"></a>04876             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [edi]
<a name="l04877"></a>04877             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         al, [edx+eax]
<a name="l04878"></a>04878             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], al
<a name="l04879"></a>04879 
<a name="l04880"></a>04880 BlitNTL5:
<a name="l04881"></a>04881             inc         esi
<a name="l04882"></a>04882             inc         edi
<a name="l04883"></a>04883             add         ebx, 2
<a name="l04884"></a>04884             dec         cl
<a name="l04885"></a>04885             jnz         BlitNTL4
<a name="l04886"></a>04886 
<a name="l04887"></a>04887             jmp         BlitDispatch
<a name="l04888"></a>04888 
<a name="l04889"></a>04889 
<a name="l04890"></a>04890 BlitTransparent:
<a name="l04891"></a>04891 
<a name="l04892"></a>04892             and         ecx, 07fH
<a name="l04893"></a>04893             add         edi, ecx
<a name="l04894"></a>04894 <span class="comment">//          shl         ecx, 1</span>
<a name="l04895"></a>04895             add   ecx, ecx
<a name="l04896"></a>04896             add         ebx, ecx
<a name="l04897"></a>04897             jmp         BlitDispatch
<a name="l04898"></a>04898 
<a name="l04899"></a>04899 
<a name="l04900"></a>04900 BlitDoneLine:
<a name="l04901"></a>04901 
<a name="l04902"></a>04902             dec         usHeight
<a name="l04903"></a>04903             jz          BlitDone
<a name="l04904"></a>04904             add         edi, LineSkip
<a name="l04905"></a>04905             add         ebx, LineSkipZ
<a name="l04906"></a>04906             jmp         BlitDispatch
<a name="l04907"></a>04907 
<a name="l04908"></a>04908 
<a name="l04909"></a>04909 BlitDone:
<a name="l04910"></a>04910       }
<a name="l04911"></a>04911 
<a name="l04912"></a>04912       <span class="keywordflow">return</span>(TRUE);
<a name="l04913"></a>04913 
<a name="l04914"></a>04914 }
<a name="l04915"></a>04915 
<a name="l04916"></a>04916 <span class="comment">/**********************************************************************************************</span>
<a name="l04917"></a>04917 <span class="comment"> Blt8BPPDataTo8BPPBufferShadowZClip</span>
<a name="l04918"></a>04918 <span class="comment"></span>
<a name="l04919"></a>04919 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l04920"></a>04920 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l04921"></a>04921 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on, the Z value is</span>
<a name="l04922"></a>04922 <span class="comment">      updated, for any non-transparent pixels. The Z-buffer is 16 bit, and</span>
<a name="l04923"></a>04923 <span class="comment">      must be the same dimensions as the destination.</span>
<a name="l04924"></a>04924 <span class="comment"></span>
<a name="l04925"></a>04925 <span class="comment">**********************************************************************************************/</span>
<a name="l04926"></a><a class="code" href="vobject__blitters_8h.html#5daa4cc1db8cbb3ac0c13ae942f31c3e">04926</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#5daa4cc1db8cbb3ac0c13ae942f31c3e">Blt8BPPDataTo8BPPBufferShadowZClip</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="structSGPRect.html">SGPRect</a> *clipregion)
<a name="l04927"></a>04927 {
<a name="l04928"></a>04928       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l04929"></a>04929       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth, Unblitted;
<a name="l04930"></a>04930       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l04931"></a>04931       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip, LineSkipZ;
<a name="l04932"></a>04932   <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l04933"></a>04933       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY, LeftSkip, RightSkip, TopSkip, BottomSkip, BlitLength, BlitHeight, LSCount;
<a name="l04934"></a>04934       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  ClipX1, ClipY1, ClipX2, ClipY2;
<a name="l04935"></a>04935       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *pPal8BPP;
<a name="l04936"></a>04936 
<a name="l04937"></a>04937       <span class="comment">// Assertions</span>
<a name="l04938"></a>04938       Assert( hSrcVObject != NULL );
<a name="l04939"></a>04939       Assert( pBuffer != NULL );
<a name="l04940"></a>04940 
<a name="l04941"></a>04941       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l04942"></a>04942       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l04943"></a>04943       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l04944"></a>04944       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l04945"></a>04945       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l04946"></a>04946 
<a name="l04947"></a>04947       <span class="comment">// Add to start position of dest buffer</span>
<a name="l04948"></a>04948       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l04949"></a>04949       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l04950"></a>04950 
<a name="l04951"></a>04951       <span class="keywordflow">if</span>(clipregion==NULL)
<a name="l04952"></a>04952       {
<a name="l04953"></a>04953             ClipX1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l04954"></a>04954             ClipY1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l04955"></a>04955             ClipX2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l04956"></a>04956             ClipY2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l04957"></a>04957       }
<a name="l04958"></a>04958       <span class="keywordflow">else</span>
<a name="l04959"></a>04959       {
<a name="l04960"></a>04960             ClipX1=clipregion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l04961"></a>04961             ClipY1=clipregion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l04962"></a>04962             ClipX2=clipregion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l04963"></a>04963             ClipY2=clipregion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l04964"></a>04964       }
<a name="l04965"></a>04965 
<a name="l04966"></a>04966       <span class="comment">// Calculate rows hanging off each side of the screen</span>
<a name="l04967"></a>04967       LeftSkip=__min(ClipX1 - min(ClipX1, iTempX), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l04968"></a>04968       RightSkip=__min(max(ClipX2, (iTempX+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth)) - ClipX2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l04969"></a>04969       TopSkip=__min(ClipY1 - __min(ClipY1, iTempY), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l04970"></a>04970       BottomSkip=__min(__max(ClipY2, (iTempY+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight)) - ClipY2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l04971"></a>04971 
<a name="l04972"></a>04972       <span class="comment">// calculate the remaining rows and columns to blit</span>
<a name="l04973"></a>04973       BlitLength=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth-LeftSkip-RightSkip);
<a name="l04974"></a>04974       BlitHeight=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight-TopSkip-BottomSkip);
<a name="l04975"></a>04975 
<a name="l04976"></a>04976       <span class="comment">// check if whole thing is clipped</span>
<a name="l04977"></a>04977       <span class="keywordflow">if</span>((LeftSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth) || (RightSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth))
<a name="l04978"></a>04978             <span class="keywordflow">return</span>(TRUE);
<a name="l04979"></a>04979 
<a name="l04980"></a>04980       <span class="comment">// check if whole thing is clipped</span>
<a name="l04981"></a>04981       <span class="keywordflow">if</span>((TopSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight) || (BottomSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight))
<a name="l04982"></a>04982             <span class="keywordflow">return</span>(TRUE);
<a name="l04983"></a>04983 
<a name="l04984"></a>04984       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l04985"></a>04985       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip));
<a name="l04986"></a>04986       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*2*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l04987"></a>04987       pPal8BPP = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#152256552f959a5d90dbd886d22fb679">pShade8</a>;
<a name="l04988"></a>04988       LineSkip=(uiDestPitchBYTES-(BlitLength));
<a name="l04989"></a>04989       LineSkipZ=LineSkip*2;
<a name="l04990"></a>04990 
<a name="l04991"></a>04991       __asm {
<a name="l04992"></a>04992 
<a name="l04993"></a>04993             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l04994"></a>04994             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l04995"></a>04995             xor         eax, eax
<a name="l04996"></a>04996             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l04997"></a>04997             xor         ecx, ecx
<a name="l04998"></a>04998             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, pPal8BPP
<a name="l04999"></a>04999 
<a name="l05000"></a>05000             cmp         TopSkip, 0                                      <span class="comment">// check for nothing clipped on top</span>
<a name="l05001"></a>05001             je          LeftSkipSetup
<a name="l05002"></a>05002 
<a name="l05003"></a>05003 TopSkipLoop:                                                            <span class="comment">// Skips the number of lines clipped at the top</span>
<a name="l05004"></a>05004 
<a name="l05005"></a>05005             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l05006"></a>05006             inc         esi
<a name="l05007"></a>05007             or          cl, cl
<a name="l05008"></a>05008             js          TopSkipLoop
<a name="l05009"></a>05009             jz          TSEndLine
<a name="l05010"></a>05010 
<a name="l05011"></a>05011             add         esi, ecx
<a name="l05012"></a>05012             jmp         TopSkipLoop
<a name="l05013"></a>05013 
<a name="l05014"></a>05014 TSEndLine:
<a name="l05015"></a>05015             dec         TopSkip
<a name="l05016"></a>05016             jnz         TopSkipLoop
<a name="l05017"></a>05017 
<a name="l05018"></a>05018 LeftSkipSetup:
<a name="l05019"></a>05019 
<a name="l05020"></a>05020             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l05021"></a>05021             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, LeftSkip
<a name="l05022"></a>05022             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l05023"></a>05023             or          eax, eax
<a name="l05024"></a>05024             jz          BlitLineSetup
<a name="l05025"></a>05025 
<a name="l05026"></a>05026 LeftSkipLoop:
<a name="l05027"></a>05027 
<a name="l05028"></a>05028             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l05029"></a>05029             inc         esi
<a name="l05030"></a>05030 
<a name="l05031"></a>05031             or          cl, cl
<a name="l05032"></a>05032             js          LSTrans
<a name="l05033"></a>05033 
<a name="l05034"></a>05034             cmp         ecx, LSCount
<a name="l05035"></a>05035             je          LSSkip2                                               <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l05036"></a>05036             jb          LSSkip1                                               <span class="comment">// if less, skip whole thing</span>
<a name="l05037"></a>05037 
<a name="l05038"></a>05038             add         esi, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l05039"></a>05039             sub         ecx, LSCount
<a name="l05040"></a>05040             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l05041"></a>05041             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l05042"></a>05042             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l05043"></a>05043             jmp         BlitNonTransLoop
<a name="l05044"></a>05044 
<a name="l05045"></a>05045 LSSkip2:
<a name="l05046"></a>05046             add         esi, ecx                                        <span class="comment">// skip whole run, and start blit with new run</span>
<a name="l05047"></a>05047             jmp         BlitLineSetup
<a name="l05048"></a>05048 
<a name="l05049"></a>05049 
<a name="l05050"></a>05050 LSSkip1:
<a name="l05051"></a>05051             add         esi, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l05052"></a>05052             sub         LSCount, ecx
<a name="l05053"></a>05053             jmp         LeftSkipLoop
<a name="l05054"></a>05054 
<a name="l05055"></a>05055 
<a name="l05056"></a>05056 LSTrans:
<a name="l05057"></a>05057             and         ecx, 07fH
<a name="l05058"></a>05058             cmp         ecx, LSCount
<a name="l05059"></a>05059             je          BlitLineSetup                             <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l05060"></a>05060             jb          LSTrans1                                        <span class="comment">// if less, skip whole thing</span>
<a name="l05061"></a>05061 
<a name="l05062"></a>05062             sub         ecx, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l05063"></a>05063             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l05064"></a>05064             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l05065"></a>05065             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l05066"></a>05066             jmp         BlitTransparent
<a name="l05067"></a>05067 
<a name="l05068"></a>05068 
<a name="l05069"></a>05069 LSTrans1:
<a name="l05070"></a>05070             sub         LSCount, ecx                                          <span class="comment">// skip whole run, continue skipping</span>
<a name="l05071"></a>05071             jmp         LeftSkipLoop
<a name="l05072"></a>05072 
<a name="l05073"></a>05073 
<a name="l05074"></a>05074 BlitLineSetup:                                                    <span class="comment">// Does any actual blitting (trans/non) for the line</span>
<a name="l05075"></a>05075             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l05076"></a>05076             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l05077"></a>05077             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l05078"></a>05078 
<a name="l05079"></a>05079 BlitDispatch:
<a name="l05080"></a>05080 
<a name="l05081"></a>05081             cmp         LSCount, 0                                      <span class="comment">// Check to see if we're done blitting</span>
<a name="l05082"></a>05082             je          RightSkipLoop
<a name="l05083"></a>05083 
<a name="l05084"></a>05084             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l05085"></a>05085             inc         esi
<a name="l05086"></a>05086             or          cl, cl
<a name="l05087"></a>05087             js          BlitTransparent
<a name="l05088"></a>05088 
<a name="l05089"></a>05089 BlitNonTransLoop:                                           <span class="comment">// blit non-transparent pixels</span>
<a name="l05090"></a>05090 
<a name="l05091"></a>05091             cmp         ecx, LSCount
<a name="l05092"></a>05092             jbe         BNTrans1
<a name="l05093"></a>05093 
<a name="l05094"></a>05094             sub         ecx, LSCount
<a name="l05095"></a>05095             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, ecx
<a name="l05096"></a>05096             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, LSCount
<a name="l05097"></a>05097 
<a name="l05098"></a>05098 BNTrans1:
<a name="l05099"></a>05099             sub         LSCount, ecx
<a name="l05100"></a>05100 
<a name="l05101"></a>05101 BlitNTL1:
<a name="l05102"></a>05102 
<a name="l05103"></a>05103             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l05104"></a>05104             cmp         ax, usZValue
<a name="l05105"></a>05105             jae         BlitNTL2
<a name="l05106"></a>05106 
<a name="l05107"></a>05107             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, usZValue
<a name="l05108"></a>05108             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [ebx], ax
<a name="l05109"></a>05109 
<a name="l05110"></a>05110             xor         eax, eax
<a name="l05111"></a>05111             mov         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [edi]
<a name="l05112"></a>05112             mov         al, [edx+eax]
<a name="l05113"></a>05113             mov         [edi], al
<a name="l05114"></a>05114 
<a name="l05115"></a>05115 BlitNTL2:
<a name="l05116"></a>05116             inc         esi
<a name="l05117"></a>05117             inc         edi
<a name="l05118"></a>05118             add         ebx, 2
<a name="l05119"></a>05119             dec         cl
<a name="l05120"></a>05120             jnz         BlitNTL1
<a name="l05121"></a>05121 
<a name="l05122"></a>05122 <span class="comment">//BlitLineEnd:</span>
<a name="l05123"></a>05123             add         esi, Unblitted
<a name="l05124"></a>05124             jmp         BlitDispatch
<a name="l05125"></a>05125 
<a name="l05126"></a>05126 BlitTransparent:                                                              <span class="comment">// skip transparent pixels</span>
<a name="l05127"></a>05127 
<a name="l05128"></a>05128             and         ecx, 07fH
<a name="l05129"></a>05129             cmp         ecx, LSCount
<a name="l05130"></a>05130             jbe         BTrans1
<a name="l05131"></a>05131 
<a name="l05132"></a>05132             mov         ecx, LSCount
<a name="l05133"></a>05133 
<a name="l05134"></a>05134 BTrans1:
<a name="l05135"></a>05135 
<a name="l05136"></a>05136             sub         LSCount, ecx
<a name="l05137"></a>05137             add         edi, ecx
<a name="l05138"></a>05138 <span class="comment">//          shl         ecx, 1</span>
<a name="l05139"></a>05139             add   ecx, ecx
<a name="l05140"></a>05140             add         ebx, ecx
<a name="l05141"></a>05141             jmp         BlitDispatch
<a name="l05142"></a>05142 
<a name="l05143"></a>05143 
<a name="l05144"></a>05144 RightSkipLoop:                                                                      <span class="comment">// skip along until we hit and end-of-line marker</span>
<a name="l05145"></a>05145 
<a name="l05146"></a>05146 
<a name="l05147"></a>05147 RSLoop1:
<a name="l05148"></a>05148             mov         al, [esi]
<a name="l05149"></a>05149             inc         esi
<a name="l05150"></a>05150             or          al, al
<a name="l05151"></a>05151             jnz         RSLoop1
<a name="l05152"></a>05152 
<a name="l05153"></a>05153             dec         BlitHeight
<a name="l05154"></a>05154             jz          BlitDone
<a name="l05155"></a>05155             add         edi, LineSkip
<a name="l05156"></a>05156             add         ebx, LineSkipZ
<a name="l05157"></a>05157 
<a name="l05158"></a>05158             jmp         LeftSkipSetup
<a name="l05159"></a>05159 
<a name="l05160"></a>05160 
<a name="l05161"></a>05161 BlitDone:
<a name="l05162"></a>05162       }
<a name="l05163"></a>05163 
<a name="l05164"></a>05164       <span class="keywordflow">return</span>(TRUE);
<a name="l05165"></a>05165 
<a name="l05166"></a>05166 }
<a name="l05167"></a>05167 
<a name="l05168"></a>05168 <span class="comment">/**********************************************************************************************</span>
<a name="l05169"></a>05169 <span class="comment"> Blt8BPPDataTo8BPPBufferShadowZNBClip</span>
<a name="l05170"></a>05170 <span class="comment"></span>
<a name="l05171"></a>05171 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l05172"></a>05172 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l05173"></a>05173 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on, the Z value is</span>
<a name="l05174"></a>05174 <span class="comment">      NOT updated, for any non-transparent pixels. The Z-buffer is 16 bit, and</span>
<a name="l05175"></a>05175 <span class="comment">      must be the same dimensions as the destination.</span>
<a name="l05176"></a>05176 <span class="comment"></span>
<a name="l05177"></a>05177 <span class="comment">**********************************************************************************************/</span>
<a name="l05178"></a><a class="code" href="vobject__blitters_8h.html#5621784b0b0b355a4781e5a0ce799f46">05178</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#5621784b0b0b355a4781e5a0ce799f46">Blt8BPPDataTo8BPPBufferShadowZNBClip</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="structSGPRect.html">SGPRect</a> *clipregion)
<a name="l05179"></a>05179 {
<a name="l05180"></a>05180       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l05181"></a>05181       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth, Unblitted;
<a name="l05182"></a>05182       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l05183"></a>05183       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip, LineSkipZ;
<a name="l05184"></a>05184   <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l05185"></a>05185       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY, LeftSkip, RightSkip, TopSkip, BottomSkip, BlitLength, BlitHeight, LSCount;
<a name="l05186"></a>05186       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  ClipX1, ClipY1, ClipX2, ClipY2;
<a name="l05187"></a>05187       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *pPal8BPP;
<a name="l05188"></a>05188 
<a name="l05189"></a>05189       <span class="comment">// Assertions</span>
<a name="l05190"></a>05190       Assert( hSrcVObject != NULL );
<a name="l05191"></a>05191       Assert( pBuffer != NULL );
<a name="l05192"></a>05192 
<a name="l05193"></a>05193       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l05194"></a>05194       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l05195"></a>05195       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l05196"></a>05196       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l05197"></a>05197       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l05198"></a>05198 
<a name="l05199"></a>05199       <span class="comment">// Add to start position of dest buffer</span>
<a name="l05200"></a>05200       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l05201"></a>05201       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l05202"></a>05202 
<a name="l05203"></a>05203       <span class="keywordflow">if</span>(clipregion==NULL)
<a name="l05204"></a>05204       {
<a name="l05205"></a>05205             ClipX1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l05206"></a>05206             ClipY1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l05207"></a>05207             ClipX2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l05208"></a>05208             ClipY2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l05209"></a>05209       }
<a name="l05210"></a>05210       <span class="keywordflow">else</span>
<a name="l05211"></a>05211       {
<a name="l05212"></a>05212             ClipX1=clipregion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l05213"></a>05213             ClipY1=clipregion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l05214"></a>05214             ClipX2=clipregion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l05215"></a>05215             ClipY2=clipregion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l05216"></a>05216       }
<a name="l05217"></a>05217 
<a name="l05218"></a>05218       <span class="comment">// Calculate rows hanging off each side of the screen</span>
<a name="l05219"></a>05219       LeftSkip=__min(ClipX1 - min(ClipX1, iTempX), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l05220"></a>05220       RightSkip=__min(max(ClipX2, (iTempX+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth)) - ClipX2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l05221"></a>05221       TopSkip=__min(ClipY1 - __min(ClipY1, iTempY), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l05222"></a>05222       BottomSkip=__min(__max(ClipY2, (iTempY+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight)) - ClipY2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l05223"></a>05223 
<a name="l05224"></a>05224       <span class="comment">// calculate the remaining rows and columns to blit</span>
<a name="l05225"></a>05225       BlitLength=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth-LeftSkip-RightSkip);
<a name="l05226"></a>05226       BlitHeight=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight-TopSkip-BottomSkip);
<a name="l05227"></a>05227 
<a name="l05228"></a>05228       <span class="comment">// check if whole thing is clipped</span>
<a name="l05229"></a>05229       <span class="keywordflow">if</span>((LeftSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth) || (RightSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth))
<a name="l05230"></a>05230             <span class="keywordflow">return</span>(TRUE);
<a name="l05231"></a>05231 
<a name="l05232"></a>05232       <span class="comment">// check if whole thing is clipped</span>
<a name="l05233"></a>05233       <span class="keywordflow">if</span>((TopSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight) || (BottomSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight))
<a name="l05234"></a>05234             <span class="keywordflow">return</span>(TRUE);
<a name="l05235"></a>05235 
<a name="l05236"></a>05236       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l05237"></a>05237       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip));
<a name="l05238"></a>05238       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*2*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l05239"></a>05239       pPal8BPP = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#152256552f959a5d90dbd886d22fb679">pShade8</a>;
<a name="l05240"></a>05240       LineSkip=(uiDestPitchBYTES-(BlitLength));
<a name="l05241"></a>05241       LineSkipZ=LineSkip*2;
<a name="l05242"></a>05242 
<a name="l05243"></a>05243       __asm {
<a name="l05244"></a>05244 
<a name="l05245"></a>05245             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l05246"></a>05246             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l05247"></a>05247             xor         eax, eax
<a name="l05248"></a>05248             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l05249"></a>05249             xor         ecx, ecx
<a name="l05250"></a>05250             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, pPal8BPP
<a name="l05251"></a>05251 
<a name="l05252"></a>05252             cmp         TopSkip, 0                                      <span class="comment">// check for nothing clipped on top</span>
<a name="l05253"></a>05253             je          LeftSkipSetup
<a name="l05254"></a>05254 
<a name="l05255"></a>05255 TopSkipLoop:                                                            <span class="comment">// Skips the number of lines clipped at the top</span>
<a name="l05256"></a>05256 
<a name="l05257"></a>05257             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l05258"></a>05258             inc         esi
<a name="l05259"></a>05259             or          cl, cl
<a name="l05260"></a>05260             js          TopSkipLoop
<a name="l05261"></a>05261             jz          TSEndLine
<a name="l05262"></a>05262 
<a name="l05263"></a>05263             add         esi, ecx
<a name="l05264"></a>05264             jmp         TopSkipLoop
<a name="l05265"></a>05265 
<a name="l05266"></a>05266 TSEndLine:
<a name="l05267"></a>05267             dec         TopSkip
<a name="l05268"></a>05268             jnz         TopSkipLoop
<a name="l05269"></a>05269 
<a name="l05270"></a>05270 LeftSkipSetup:
<a name="l05271"></a>05271 
<a name="l05272"></a>05272             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l05273"></a>05273             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, LeftSkip
<a name="l05274"></a>05274             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l05275"></a>05275             or          eax, eax
<a name="l05276"></a>05276             jz          BlitLineSetup
<a name="l05277"></a>05277 
<a name="l05278"></a>05278 LeftSkipLoop:
<a name="l05279"></a>05279 
<a name="l05280"></a>05280             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l05281"></a>05281             inc         esi
<a name="l05282"></a>05282 
<a name="l05283"></a>05283             or          cl, cl
<a name="l05284"></a>05284             js          LSTrans
<a name="l05285"></a>05285 
<a name="l05286"></a>05286             cmp         ecx, LSCount
<a name="l05287"></a>05287             je          LSSkip2                                               <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l05288"></a>05288             jb          LSSkip1                                               <span class="comment">// if less, skip whole thing</span>
<a name="l05289"></a>05289 
<a name="l05290"></a>05290             add         esi, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l05291"></a>05291             sub         ecx, LSCount
<a name="l05292"></a>05292             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l05293"></a>05293             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l05294"></a>05294             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l05295"></a>05295             jmp         BlitNonTransLoop
<a name="l05296"></a>05296 
<a name="l05297"></a>05297 LSSkip2:
<a name="l05298"></a>05298             add         esi, ecx                                        <span class="comment">// skip whole run, and start blit with new run</span>
<a name="l05299"></a>05299             jmp         BlitLineSetup
<a name="l05300"></a>05300 
<a name="l05301"></a>05301 
<a name="l05302"></a>05302 LSSkip1:
<a name="l05303"></a>05303             add         esi, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l05304"></a>05304             sub         LSCount, ecx
<a name="l05305"></a>05305             jmp         LeftSkipLoop
<a name="l05306"></a>05306 
<a name="l05307"></a>05307 
<a name="l05308"></a>05308 LSTrans:
<a name="l05309"></a>05309             and         ecx, 07fH
<a name="l05310"></a>05310             cmp         ecx, LSCount
<a name="l05311"></a>05311             je          BlitLineSetup                             <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l05312"></a>05312             jb          LSTrans1                                        <span class="comment">// if less, skip whole thing</span>
<a name="l05313"></a>05313 
<a name="l05314"></a>05314             sub         ecx, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l05315"></a>05315             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l05316"></a>05316             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l05317"></a>05317             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l05318"></a>05318             jmp         BlitTransparent
<a name="l05319"></a>05319 
<a name="l05320"></a>05320 
<a name="l05321"></a>05321 LSTrans1:
<a name="l05322"></a>05322             sub         LSCount, ecx                                          <span class="comment">// skip whole run, continue skipping</span>
<a name="l05323"></a>05323             jmp         LeftSkipLoop
<a name="l05324"></a>05324 
<a name="l05325"></a>05325 
<a name="l05326"></a>05326 BlitLineSetup:                                                    <span class="comment">// Does any actual blitting (trans/non) for the line</span>
<a name="l05327"></a>05327             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l05328"></a>05328             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l05329"></a>05329             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l05330"></a>05330 
<a name="l05331"></a>05331 BlitDispatch:
<a name="l05332"></a>05332 
<a name="l05333"></a>05333             cmp         LSCount, 0                                      <span class="comment">// Check to see if we're done blitting</span>
<a name="l05334"></a>05334             je          RightSkipLoop
<a name="l05335"></a>05335 
<a name="l05336"></a>05336             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l05337"></a>05337             inc         esi
<a name="l05338"></a>05338             or          cl, cl
<a name="l05339"></a>05339             js          BlitTransparent
<a name="l05340"></a>05340 
<a name="l05341"></a>05341 BlitNonTransLoop:                                           <span class="comment">// blit non-transparent pixels</span>
<a name="l05342"></a>05342 
<a name="l05343"></a>05343             cmp         ecx, LSCount
<a name="l05344"></a>05344             jbe         BNTrans1
<a name="l05345"></a>05345 
<a name="l05346"></a>05346             sub         ecx, LSCount
<a name="l05347"></a>05347             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, ecx
<a name="l05348"></a>05348             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, LSCount
<a name="l05349"></a>05349 
<a name="l05350"></a>05350 BNTrans1:
<a name="l05351"></a>05351             sub         LSCount, ecx
<a name="l05352"></a>05352 
<a name="l05353"></a>05353 BlitNTL1:
<a name="l05354"></a>05354 
<a name="l05355"></a>05355             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l05356"></a>05356             cmp         ax, usZValue
<a name="l05357"></a>05357             jae         BlitNTL2
<a name="l05358"></a>05358 
<a name="l05359"></a>05359             xor         eax, eax
<a name="l05360"></a>05360             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [edi]
<a name="l05361"></a>05361             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         al, [edx+eax]
<a name="l05362"></a>05362             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], al
<a name="l05363"></a>05363 
<a name="l05364"></a>05364 BlitNTL2:
<a name="l05365"></a>05365             inc         esi
<a name="l05366"></a>05366             inc         edi
<a name="l05367"></a>05367             add         ebx, 2
<a name="l05368"></a>05368             dec         cl
<a name="l05369"></a>05369             jnz         BlitNTL1
<a name="l05370"></a>05370 
<a name="l05371"></a>05371 <span class="comment">//BlitLineEnd:</span>
<a name="l05372"></a>05372             add         esi, Unblitted
<a name="l05373"></a>05373             jmp         BlitDispatch
<a name="l05374"></a>05374 
<a name="l05375"></a>05375 BlitTransparent:                                                              <span class="comment">// skip transparent pixels</span>
<a name="l05376"></a>05376 
<a name="l05377"></a>05377             and         ecx, 07fH
<a name="l05378"></a>05378             cmp         ecx, LSCount
<a name="l05379"></a>05379             jbe         BTrans1
<a name="l05380"></a>05380 
<a name="l05381"></a>05381             mov         ecx, LSCount
<a name="l05382"></a>05382 
<a name="l05383"></a>05383 BTrans1:
<a name="l05384"></a>05384 
<a name="l05385"></a>05385             sub         LSCount, ecx
<a name="l05386"></a>05386             add         edi, ecx
<a name="l05387"></a>05387 <span class="comment">//          shl         ecx, 1</span>
<a name="l05388"></a>05388             add   ecx, ecx
<a name="l05389"></a>05389             add         ebx, ecx
<a name="l05390"></a>05390             jmp         BlitDispatch
<a name="l05391"></a>05391 
<a name="l05392"></a>05392 
<a name="l05393"></a>05393 RightSkipLoop:                                                                      <span class="comment">// skip along until we hit and end-of-line marker</span>
<a name="l05394"></a>05394 
<a name="l05395"></a>05395 
<a name="l05396"></a>05396 RSLoop1:
<a name="l05397"></a>05397             mov         al, [esi]
<a name="l05398"></a>05398             inc         esi
<a name="l05399"></a>05399             or          al, al
<a name="l05400"></a>05400             jnz         RSLoop1
<a name="l05401"></a>05401 
<a name="l05402"></a>05402             dec         BlitHeight
<a name="l05403"></a>05403             jz          BlitDone
<a name="l05404"></a>05404             add         edi, LineSkip
<a name="l05405"></a>05405             add         ebx, LineSkipZ
<a name="l05406"></a>05406 
<a name="l05407"></a>05407             jmp         LeftSkipSetup
<a name="l05408"></a>05408 
<a name="l05409"></a>05409 
<a name="l05410"></a>05410 BlitDone:
<a name="l05411"></a>05411       }
<a name="l05412"></a>05412 
<a name="l05413"></a>05413       <span class="keywordflow">return</span>(TRUE);
<a name="l05414"></a>05414 
<a name="l05415"></a>05415 }
<a name="l05416"></a>05416 
<a name="l05417"></a>05417 <span class="comment">/**********************************************************************************************</span>
<a name="l05418"></a>05418 <span class="comment"> Blt8BPPDataTo8BPPBufferTransShadowZ</span>
<a name="l05419"></a>05419 <span class="comment"></span>
<a name="l05420"></a>05420 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l05421"></a>05421 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l05422"></a>05422 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on, and the Z value is</span>
<a name="l05423"></a>05423 <span class="comment">      updated to the current value, for any non-transparent pixels. If the source pixel is 254,</span>
<a name="l05424"></a>05424 <span class="comment">      it is considered a shadow, and the destination buffer is darkened rather than blitted on.</span>
<a name="l05425"></a>05425 <span class="comment">      The Z-buffer is 16 bit, and   must be the same dimensions (including Pitch) as the destination.</span>
<a name="l05426"></a>05426 <span class="comment"></span>
<a name="l05427"></a>05427 <span class="comment">**********************************************************************************************/</span>
<a name="l05428"></a><a class="code" href="vobject__blitters_8h.html#b14eeaf3506c61f3b20388e47cd16f54">05428</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#b14eeaf3506c61f3b20388e47cd16f54">Blt8BPPDataTo8BPPBufferTransShadowZ</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette )
<a name="l05429"></a>05429 {
<a name="l05430"></a>05430       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l05431"></a>05431       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth;
<a name="l05432"></a>05432       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l05433"></a>05433       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip, LineSkipZ;
<a name="l05434"></a>05434       <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l05435"></a>05435       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l05436"></a>05436       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *pPal8BPP;
<a name="l05437"></a>05437 
<a name="l05438"></a>05438 
<a name="l05439"></a>05439       <span class="comment">// Assertions</span>
<a name="l05440"></a>05440       Assert( hSrcVObject != NULL );
<a name="l05441"></a>05441       Assert( pBuffer != NULL );
<a name="l05442"></a>05442 
<a name="l05443"></a>05443       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l05444"></a>05444       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l05445"></a>05445       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l05446"></a>05446       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l05447"></a>05447       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l05448"></a>05448 
<a name="l05449"></a>05449       <span class="comment">// Add to start position of dest buffer</span>
<a name="l05450"></a>05450       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l05451"></a>05451       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l05452"></a>05452 
<a name="l05453"></a>05453       <span class="comment">// Validations</span>
<a name="l05454"></a>05454       CHECKF( iTempX &gt;= 0 );
<a name="l05455"></a>05455       CHECKF( iTempY &gt;= 0 );
<a name="l05456"></a>05456 
<a name="l05457"></a>05457 
<a name="l05458"></a>05458       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l05459"></a>05459       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*iTempY) + (iTempX);
<a name="l05460"></a>05460       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*2*iTempY) + (iTempX*2);
<a name="l05461"></a>05461       LineSkip=(uiDestPitchBYTES-(usWidth));
<a name="l05462"></a>05462       LineSkipZ=LineSkip*2;
<a name="l05463"></a>05463       pPal8BPP=hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#152256552f959a5d90dbd886d22fb679">pShade8</a>;
<a name="l05464"></a>05464 
<a name="l05465"></a>05465       __asm {
<a name="l05466"></a>05466 
<a name="l05467"></a>05467             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l05468"></a>05468             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l05469"></a>05469             xor         eax, eax
<a name="l05470"></a>05470             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l05471"></a>05471             xor         ecx, ecx
<a name="l05472"></a>05472             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, pPal8BPP
<a name="l05473"></a>05473 
<a name="l05474"></a>05474 BlitDispatch:
<a name="l05475"></a>05475 
<a name="l05476"></a>05476             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l05477"></a>05477             inc         esi
<a name="l05478"></a>05478             or          cl, cl
<a name="l05479"></a>05479             js          BlitTransparent
<a name="l05480"></a>05480             jz          BlitDoneLine
<a name="l05481"></a>05481 
<a name="l05482"></a>05482 <span class="comment">//BlitNonTransLoop:</span>
<a name="l05483"></a>05483 
<a name="l05484"></a>05484 BlitNTL4:
<a name="l05485"></a>05485 
<a name="l05486"></a>05486             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l05487"></a>05487             cmp         ax, usZValue
<a name="l05488"></a>05488             jae         BlitNTL5
<a name="l05489"></a>05489 
<a name="l05490"></a>05490             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, usZValue
<a name="l05491"></a>05491             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [ebx], ax
<a name="l05492"></a>05492 
<a name="l05493"></a>05493             xor         eax, eax
<a name="l05494"></a>05494             mov         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l05495"></a>05495             cmp         al, 254
<a name="l05496"></a>05496             jne         <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>
<a name="l05497"></a>05497 
<a name="l05498"></a>05498             mov         al, [edi]
<a name="l05499"></a>05499 <span class="comment">//          mov         al, ColorTable[eax] *********************************************</span>
<a name="l05500"></a>05500             mov         [edi], al
<a name="l05501"></a>05501             jmp         BlitNTL5
<a name="l05502"></a>05502 
<a name="l05503"></a>05503 
<a name="l05504"></a>05504 <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>:
<a name="l05505"></a>05505             mov         al, [edx+eax]
<a name="l05506"></a>05506             mov         [edi], al
<a name="l05507"></a>05507 
<a name="l05508"></a>05508 BlitNTL5:
<a name="l05509"></a>05509             inc         esi
<a name="l05510"></a>05510             inc         edi
<a name="l05511"></a>05511             add         ebx, 2
<a name="l05512"></a>05512             dec         cl
<a name="l05513"></a>05513             jnz         BlitNTL4
<a name="l05514"></a>05514 
<a name="l05515"></a>05515             jmp         BlitDispatch
<a name="l05516"></a>05516 
<a name="l05517"></a>05517 
<a name="l05518"></a>05518 BlitTransparent:
<a name="l05519"></a>05519 
<a name="l05520"></a>05520             and         ecx, 07fH
<a name="l05521"></a>05521             add         edi, ecx
<a name="l05522"></a>05522 <span class="comment">//          shl         ecx, 1</span>
<a name="l05523"></a>05523             add   ecx, ecx
<a name="l05524"></a>05524             add         ebx, ecx
<a name="l05525"></a>05525             jmp         BlitDispatch
<a name="l05526"></a>05526 
<a name="l05527"></a>05527 
<a name="l05528"></a>05528 BlitDoneLine:
<a name="l05529"></a>05529 
<a name="l05530"></a>05530             dec         usHeight
<a name="l05531"></a>05531             jz          BlitDone
<a name="l05532"></a>05532             add         edi, LineSkip
<a name="l05533"></a>05533             add         ebx, LineSkipZ
<a name="l05534"></a>05534             jmp         BlitDispatch
<a name="l05535"></a>05535 
<a name="l05536"></a>05536 
<a name="l05537"></a>05537 BlitDone:
<a name="l05538"></a>05538       }
<a name="l05539"></a>05539 
<a name="l05540"></a>05540       <span class="keywordflow">return</span>(TRUE);
<a name="l05541"></a>05541 
<a name="l05542"></a>05542 }
<a name="l05543"></a>05543 
<a name="l05544"></a>05544 <span class="comment">/**********************************************************************************************</span>
<a name="l05545"></a>05545 <span class="comment"> Blt8BPPDataTo8BPPBufferTransShadowZNB</span>
<a name="l05546"></a>05546 <span class="comment"></span>
<a name="l05547"></a>05547 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l05548"></a>05548 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l05549"></a>05549 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on, and the Z value is</span>
<a name="l05550"></a>05550 <span class="comment">      NOT updated,      for any non-transparent pixels. If the source pixel is 254,</span>
<a name="l05551"></a>05551 <span class="comment">      it is considered a shadow, and the destination buffer is darkened rather than blitted on.</span>
<a name="l05552"></a>05552 <span class="comment">      The Z-buffer is 16 bit, and   must be the same dimensions (including Pitch) as the destination.</span>
<a name="l05553"></a>05553 <span class="comment"></span>
<a name="l05554"></a>05554 <span class="comment">**********************************************************************************************/</span>
<a name="l05555"></a><a class="code" href="vobject__blitters_8h.html#39d9e812283851c4c5a29ddca2cfe9e9">05555</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#39d9e812283851c4c5a29ddca2cfe9e9">Blt8BPPDataTo8BPPBufferTransShadowZNB</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette )
<a name="l05556"></a>05556 {
<a name="l05557"></a>05557       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l05558"></a>05558       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth;
<a name="l05559"></a>05559       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l05560"></a>05560       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip, LineSkipZ;
<a name="l05561"></a>05561       <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l05562"></a>05562       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l05563"></a>05563       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *pPal8BPP;
<a name="l05564"></a>05564 
<a name="l05565"></a>05565 
<a name="l05566"></a>05566       <span class="comment">// Assertions</span>
<a name="l05567"></a>05567       Assert( hSrcVObject != NULL );
<a name="l05568"></a>05568       Assert( pBuffer != NULL );
<a name="l05569"></a>05569 
<a name="l05570"></a>05570       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l05571"></a>05571       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l05572"></a>05572       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l05573"></a>05573       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l05574"></a>05574       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l05575"></a>05575 
<a name="l05576"></a>05576       <span class="comment">// Add to start position of dest buffer</span>
<a name="l05577"></a>05577       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l05578"></a>05578       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l05579"></a>05579 
<a name="l05580"></a>05580       <span class="comment">// Validations</span>
<a name="l05581"></a>05581       CHECKF( iTempX &gt;= 0 );
<a name="l05582"></a>05582       CHECKF( iTempY &gt;= 0 );
<a name="l05583"></a>05583 
<a name="l05584"></a>05584 
<a name="l05585"></a>05585       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l05586"></a>05586       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*iTempY) + (iTempX);
<a name="l05587"></a>05587       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*2*iTempY) + (iTempX*2);
<a name="l05588"></a>05588       LineSkip=(uiDestPitchBYTES-(usWidth));
<a name="l05589"></a>05589       LineSkipZ=LineSkip*2;
<a name="l05590"></a>05590       pPal8BPP=hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#152256552f959a5d90dbd886d22fb679">pShade8</a>;
<a name="l05591"></a>05591 
<a name="l05592"></a>05592       __asm {
<a name="l05593"></a>05593 
<a name="l05594"></a>05594             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l05595"></a>05595             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l05596"></a>05596             xor         eax, eax
<a name="l05597"></a>05597             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l05598"></a>05598             xor         ecx, ecx
<a name="l05599"></a>05599             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, pPal8BPP
<a name="l05600"></a>05600 
<a name="l05601"></a>05601 BlitDispatch:
<a name="l05602"></a>05602 
<a name="l05603"></a>05603             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l05604"></a>05604             inc         esi
<a name="l05605"></a>05605             or          cl, cl
<a name="l05606"></a>05606             js          BlitTransparent
<a name="l05607"></a>05607             jz          BlitDoneLine
<a name="l05608"></a>05608 
<a name="l05609"></a>05609 <span class="comment">//BlitNonTransLoop:</span>
<a name="l05610"></a>05610 
<a name="l05611"></a>05611 BlitNTL4:
<a name="l05612"></a>05612 
<a name="l05613"></a>05613             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l05614"></a>05614             cmp         ax, usZValue
<a name="l05615"></a>05615             jae         BlitNTL5
<a name="l05616"></a>05616 
<a name="l05617"></a>05617             xor         eax, eax
<a name="l05618"></a>05618             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l05619"></a>05619             cmp         al, 254
<a name="l05620"></a>05620             jne         <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>
<a name="l05621"></a>05621 
<a name="l05622"></a>05622 <span class="comment">//          mov         al, [edi]</span>
<a name="l05623"></a>05623 <span class="comment">//          mov         al, ColorTable[eax] *********************************************</span>
<a name="l05624"></a>05624 <span class="comment">//          mov         [edi], al</span>
<a name="l05625"></a>05625             jmp         BlitNTL5
<a name="l05626"></a>05626 
<a name="l05627"></a>05627 
<a name="l05628"></a>05628 <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>:
<a name="l05629"></a>05629             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         al, [edx+eax]
<a name="l05630"></a>05630             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], al
<a name="l05631"></a>05631 
<a name="l05632"></a>05632 BlitNTL5:
<a name="l05633"></a>05633             inc         esi
<a name="l05634"></a>05634             inc         edi
<a name="l05635"></a>05635             add         ebx, 2
<a name="l05636"></a>05636             dec         cl
<a name="l05637"></a>05637             jnz         BlitNTL4
<a name="l05638"></a>05638 
<a name="l05639"></a>05639             jmp         BlitDispatch
<a name="l05640"></a>05640 
<a name="l05641"></a>05641 
<a name="l05642"></a>05642 BlitTransparent:
<a name="l05643"></a>05643 
<a name="l05644"></a>05644             and         ecx, 07fH
<a name="l05645"></a>05645             add         edi, ecx
<a name="l05646"></a>05646 <span class="comment">//          shl         ecx, 1</span>
<a name="l05647"></a>05647             add   ecx, ecx
<a name="l05648"></a>05648             add         ebx, ecx
<a name="l05649"></a>05649             jmp         BlitDispatch
<a name="l05650"></a>05650 
<a name="l05651"></a>05651 
<a name="l05652"></a>05652 BlitDoneLine:
<a name="l05653"></a>05653 
<a name="l05654"></a>05654             dec         usHeight
<a name="l05655"></a>05655             jz          BlitDone
<a name="l05656"></a>05656             add         edi, LineSkip
<a name="l05657"></a>05657             add         ebx, LineSkipZ
<a name="l05658"></a>05658             jmp         BlitDispatch
<a name="l05659"></a>05659 
<a name="l05660"></a>05660 
<a name="l05661"></a>05661 BlitDone:
<a name="l05662"></a>05662       }
<a name="l05663"></a>05663 
<a name="l05664"></a>05664       <span class="keywordflow">return</span>(TRUE);
<a name="l05665"></a>05665 
<a name="l05666"></a>05666 }
<a name="l05667"></a>05667 
<a name="l05668"></a>05668 
<a name="l05669"></a>05669 <span class="comment">/**********************************************************************************************</span>
<a name="l05670"></a>05670 <span class="comment"> Blt8BPPDataTo8BPPBufferTransShadowZClip</span>
<a name="l05671"></a>05671 <span class="comment"></span>
<a name="l05672"></a>05672 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l05673"></a>05673 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l05674"></a>05674 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on, and the Z value is</span>
<a name="l05675"></a>05675 <span class="comment">      updated to the current value, for any non-transparent pixels. The Z-buffer is 16 bit, and</span>
<a name="l05676"></a>05676 <span class="comment">      must be the same dimensions as the destination. Pixels with a value of</span>
<a name="l05677"></a>05677 <span class="comment">      254 are shaded instead of blitted.</span>
<a name="l05678"></a>05678 <span class="comment"></span>
<a name="l05679"></a>05679 <span class="comment">**********************************************************************************************/</span>
<a name="l05680"></a><a class="code" href="vobject__blitters_8h.html#c906f760d4e3198ac4022fc0138a5ca2">05680</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#c906f760d4e3198ac4022fc0138a5ca2">Blt8BPPDataTo8BPPBufferTransShadowZClip</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="structSGPRect.html">SGPRect</a> *clipregion, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette )
<a name="l05681"></a>05681 {
<a name="l05682"></a>05682       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l05683"></a>05683       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth, Unblitted;
<a name="l05684"></a>05684       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l05685"></a>05685       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip, LineSkipZ;
<a name="l05686"></a>05686   <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l05687"></a>05687       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY, LeftSkip, RightSkip, TopSkip, BottomSkip, BlitLength, BlitHeight, LSCount;
<a name="l05688"></a>05688       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  ClipX1, ClipY1, ClipX2, ClipY2;
<a name="l05689"></a>05689       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *pPal8BPP;
<a name="l05690"></a>05690 
<a name="l05691"></a>05691       <span class="comment">// Assertions</span>
<a name="l05692"></a>05692       Assert( hSrcVObject != NULL );
<a name="l05693"></a>05693       Assert( pBuffer != NULL );
<a name="l05694"></a>05694 
<a name="l05695"></a>05695       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l05696"></a>05696       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l05697"></a>05697       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l05698"></a>05698       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l05699"></a>05699       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l05700"></a>05700 
<a name="l05701"></a>05701       <span class="comment">// Add to start position of dest buffer</span>
<a name="l05702"></a>05702       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l05703"></a>05703       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l05704"></a>05704 
<a name="l05705"></a>05705       <span class="keywordflow">if</span>(clipregion==NULL)
<a name="l05706"></a>05706       {
<a name="l05707"></a>05707             ClipX1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l05708"></a>05708             ClipY1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l05709"></a>05709             ClipX2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l05710"></a>05710             ClipY2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l05711"></a>05711       }
<a name="l05712"></a>05712       <span class="keywordflow">else</span>
<a name="l05713"></a>05713       {
<a name="l05714"></a>05714             ClipX1=clipregion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l05715"></a>05715             ClipY1=clipregion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l05716"></a>05716             ClipX2=clipregion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l05717"></a>05717             ClipY2=clipregion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l05718"></a>05718       }
<a name="l05719"></a>05719 
<a name="l05720"></a>05720       <span class="comment">// Calculate rows hanging off each side of the screen</span>
<a name="l05721"></a>05721       LeftSkip=__min(ClipX1 - min(ClipX1, iTempX), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l05722"></a>05722       RightSkip=__min(max(ClipX2, (iTempX+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth)) - ClipX2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l05723"></a>05723       TopSkip=__min(ClipY1 - __min(ClipY1, iTempY), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l05724"></a>05724       BottomSkip=__min(__max(ClipY2, (iTempY+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight)) - ClipY2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l05725"></a>05725 
<a name="l05726"></a>05726       <span class="comment">// calculate the remaining rows and columns to blit</span>
<a name="l05727"></a>05727       BlitLength=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth-LeftSkip-RightSkip);
<a name="l05728"></a>05728       BlitHeight=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight-TopSkip-BottomSkip);
<a name="l05729"></a>05729 
<a name="l05730"></a>05730       <span class="comment">// check if whole thing is clipped</span>
<a name="l05731"></a>05731       <span class="keywordflow">if</span>((LeftSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth) || (RightSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth))
<a name="l05732"></a>05732             <span class="keywordflow">return</span>(TRUE);
<a name="l05733"></a>05733 
<a name="l05734"></a>05734       <span class="comment">// check if whole thing is clipped</span>
<a name="l05735"></a>05735       <span class="keywordflow">if</span>((TopSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight) || (BottomSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight))
<a name="l05736"></a>05736             <span class="keywordflow">return</span>(TRUE);
<a name="l05737"></a>05737 
<a name="l05738"></a>05738       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l05739"></a>05739       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip));
<a name="l05740"></a>05740       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*2*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l05741"></a>05741       LineSkip=(uiDestPitchBYTES-(BlitLength));
<a name="l05742"></a>05742       LineSkipZ=LineSkip*2;
<a name="l05743"></a>05743       pPal8BPP=hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#152256552f959a5d90dbd886d22fb679">pShade8</a>;
<a name="l05744"></a>05744 
<a name="l05745"></a>05745       __asm {
<a name="l05746"></a>05746 
<a name="l05747"></a>05747             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l05748"></a>05748             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l05749"></a>05749             xor         eax, eax
<a name="l05750"></a>05750             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l05751"></a>05751             xor         ecx, ecx
<a name="l05752"></a>05752             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, pPal8BPP
<a name="l05753"></a>05753 
<a name="l05754"></a>05754             cmp         TopSkip, 0                                      <span class="comment">// check for nothing clipped on top</span>
<a name="l05755"></a>05755             je          LeftSkipSetup
<a name="l05756"></a>05756 
<a name="l05757"></a>05757 TopSkipLoop:                                                            <span class="comment">// Skips the number of lines clipped at the top</span>
<a name="l05758"></a>05758 
<a name="l05759"></a>05759             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l05760"></a>05760             inc         esi
<a name="l05761"></a>05761             or          cl, cl
<a name="l05762"></a>05762             js          TopSkipLoop
<a name="l05763"></a>05763             jz          TSEndLine
<a name="l05764"></a>05764 
<a name="l05765"></a>05765             add         esi, ecx
<a name="l05766"></a>05766             jmp         TopSkipLoop
<a name="l05767"></a>05767 
<a name="l05768"></a>05768 TSEndLine:
<a name="l05769"></a>05769             dec         TopSkip
<a name="l05770"></a>05770             jnz         TopSkipLoop
<a name="l05771"></a>05771 
<a name="l05772"></a>05772 LeftSkipSetup:
<a name="l05773"></a>05773 
<a name="l05774"></a>05774             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l05775"></a>05775             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, LeftSkip
<a name="l05776"></a>05776             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l05777"></a>05777             or          eax, eax
<a name="l05778"></a>05778             jz          BlitLineSetup
<a name="l05779"></a>05779 
<a name="l05780"></a>05780 LeftSkipLoop:
<a name="l05781"></a>05781 
<a name="l05782"></a>05782             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l05783"></a>05783             inc         esi
<a name="l05784"></a>05784 
<a name="l05785"></a>05785             or          cl, cl
<a name="l05786"></a>05786             js          LSTrans
<a name="l05787"></a>05787 
<a name="l05788"></a>05788             cmp         ecx, LSCount
<a name="l05789"></a>05789             je          LSSkip2                                               <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l05790"></a>05790             jb          LSSkip1                                               <span class="comment">// if less, skip whole thing</span>
<a name="l05791"></a>05791 
<a name="l05792"></a>05792             add         esi, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l05793"></a>05793             sub         ecx, LSCount
<a name="l05794"></a>05794             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l05795"></a>05795             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l05796"></a>05796             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l05797"></a>05797             jmp         BlitNonTransLoop
<a name="l05798"></a>05798 
<a name="l05799"></a>05799 LSSkip2:
<a name="l05800"></a>05800             add         esi, ecx                                        <span class="comment">// skip whole run, and start blit with new run</span>
<a name="l05801"></a>05801             jmp         BlitLineSetup
<a name="l05802"></a>05802 
<a name="l05803"></a>05803 
<a name="l05804"></a>05804 LSSkip1:
<a name="l05805"></a>05805             add         esi, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l05806"></a>05806             sub         LSCount, ecx
<a name="l05807"></a>05807             jmp         LeftSkipLoop
<a name="l05808"></a>05808 
<a name="l05809"></a>05809 
<a name="l05810"></a>05810 LSTrans:
<a name="l05811"></a>05811             and         ecx, 07fH
<a name="l05812"></a>05812             cmp         ecx, LSCount
<a name="l05813"></a>05813             je          BlitLineSetup                             <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l05814"></a>05814             jb          LSTrans1                                        <span class="comment">// if less, skip whole thing</span>
<a name="l05815"></a>05815 
<a name="l05816"></a>05816             sub         ecx, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l05817"></a>05817             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l05818"></a>05818             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l05819"></a>05819             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l05820"></a>05820             jmp         BlitTransparent
<a name="l05821"></a>05821 
<a name="l05822"></a>05822 
<a name="l05823"></a>05823 LSTrans1:
<a name="l05824"></a>05824             sub         LSCount, ecx                                          <span class="comment">// skip whole run, continue skipping</span>
<a name="l05825"></a>05825             jmp         LeftSkipLoop
<a name="l05826"></a>05826 
<a name="l05827"></a>05827 
<a name="l05828"></a>05828 BlitLineSetup:                                                    <span class="comment">// Does any actual blitting (trans/non) for the line</span>
<a name="l05829"></a>05829             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l05830"></a>05830             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l05831"></a>05831             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l05832"></a>05832 
<a name="l05833"></a>05833 BlitDispatch:
<a name="l05834"></a>05834 
<a name="l05835"></a>05835             cmp         LSCount, 0                                      <span class="comment">// Check to see if we're done blitting</span>
<a name="l05836"></a>05836             je          RightSkipLoop
<a name="l05837"></a>05837 
<a name="l05838"></a>05838             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l05839"></a>05839             inc         esi
<a name="l05840"></a>05840             or          cl, cl
<a name="l05841"></a>05841             js          BlitTransparent
<a name="l05842"></a>05842 
<a name="l05843"></a>05843 BlitNonTransLoop:                                           <span class="comment">// blit non-transparent pixels</span>
<a name="l05844"></a>05844 
<a name="l05845"></a>05845             cmp         ecx, LSCount
<a name="l05846"></a>05846             jbe         BNTrans1
<a name="l05847"></a>05847 
<a name="l05848"></a>05848             sub         ecx, LSCount
<a name="l05849"></a>05849             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, ecx
<a name="l05850"></a>05850             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, LSCount
<a name="l05851"></a>05851 
<a name="l05852"></a>05852 BNTrans1:
<a name="l05853"></a>05853             sub         LSCount, ecx
<a name="l05854"></a>05854 
<a name="l05855"></a>05855 BlitNTL1:
<a name="l05856"></a>05856 
<a name="l05857"></a>05857             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l05858"></a>05858             cmp         ax, usZValue
<a name="l05859"></a>05859             jae         BlitNTL2
<a name="l05860"></a>05860 
<a name="l05861"></a>05861             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, usZValue
<a name="l05862"></a>05862             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [ebx], ax
<a name="l05863"></a>05863 
<a name="l05864"></a>05864             xor         eax, eax
<a name="l05865"></a>05865             mov         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l05866"></a>05866             cmp         al, 254
<a name="l05867"></a>05867             jne         BlitNTL3
<a name="l05868"></a>05868 
<a name="l05869"></a>05869             mov         al, [edi]
<a name="l05870"></a>05870 <span class="comment">//          mov         ax, ColorTable[eax] ************************************************</span>
<a name="l05871"></a>05871             mov         [edi], al
<a name="l05872"></a>05872             jmp         BlitNTL2
<a name="l05873"></a>05873 
<a name="l05874"></a>05874 BlitNTL3:
<a name="l05875"></a>05875             mov         al, [edx+eax]
<a name="l05876"></a>05876             mov         [edi], al
<a name="l05877"></a>05877 
<a name="l05878"></a>05878 BlitNTL2:
<a name="l05879"></a>05879             inc         esi
<a name="l05880"></a>05880             inc         edi
<a name="l05881"></a>05881             add         ebx, 2
<a name="l05882"></a>05882             dec         cl
<a name="l05883"></a>05883             jnz         BlitNTL1
<a name="l05884"></a>05884 
<a name="l05885"></a>05885 <span class="comment">//BlitLineEnd:</span>
<a name="l05886"></a>05886             add         esi, Unblitted
<a name="l05887"></a>05887             jmp         BlitDispatch
<a name="l05888"></a>05888 
<a name="l05889"></a>05889 BlitTransparent:                                                              <span class="comment">// skip transparent pixels</span>
<a name="l05890"></a>05890 
<a name="l05891"></a>05891             and         ecx, 07fH
<a name="l05892"></a>05892             cmp         ecx, LSCount
<a name="l05893"></a>05893             jbe         BTrans1
<a name="l05894"></a>05894 
<a name="l05895"></a>05895             mov         ecx, LSCount
<a name="l05896"></a>05896 
<a name="l05897"></a>05897 BTrans1:
<a name="l05898"></a>05898 
<a name="l05899"></a>05899             sub         LSCount, ecx
<a name="l05900"></a>05900             add         edi, ecx
<a name="l05901"></a>05901 <span class="comment">//          shl         ecx, 1</span>
<a name="l05902"></a>05902             add   ecx, ecx
<a name="l05903"></a>05903             add         ebx, ecx
<a name="l05904"></a>05904             jmp         BlitDispatch
<a name="l05905"></a>05905 
<a name="l05906"></a>05906 
<a name="l05907"></a>05907 RightSkipLoop:                                                                      <span class="comment">// skip along until we hit and end-of-line marker</span>
<a name="l05908"></a>05908 
<a name="l05909"></a>05909 
<a name="l05910"></a>05910 RSLoop1:
<a name="l05911"></a>05911             mov         al, [esi]
<a name="l05912"></a>05912             inc         esi
<a name="l05913"></a>05913             or          al, al
<a name="l05914"></a>05914             jnz         RSLoop1
<a name="l05915"></a>05915 
<a name="l05916"></a>05916             dec         BlitHeight
<a name="l05917"></a>05917             jz          BlitDone
<a name="l05918"></a>05918             add         edi, LineSkip
<a name="l05919"></a>05919             add         ebx, LineSkipZ
<a name="l05920"></a>05920 
<a name="l05921"></a>05921             jmp         LeftSkipSetup
<a name="l05922"></a>05922 
<a name="l05923"></a>05923 
<a name="l05924"></a>05924 BlitDone:
<a name="l05925"></a>05925       }
<a name="l05926"></a>05926 
<a name="l05927"></a>05927       <span class="keywordflow">return</span>(TRUE);
<a name="l05928"></a>05928 
<a name="l05929"></a>05929 }
<a name="l05930"></a>05930 
<a name="l05931"></a>05931 <span class="comment">/**********************************************************************************************</span>
<a name="l05932"></a>05932 <span class="comment"> Blt8BPPDataTo8BPPBufferTransShadowZNBClip</span>
<a name="l05933"></a>05933 <span class="comment"></span>
<a name="l05934"></a>05934 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l05935"></a>05935 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l05936"></a>05936 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on, and the Z value is</span>
<a name="l05937"></a>05937 <span class="comment">      NOT updated,      for any non-transparent pixels. The Z-buffer is 16 bit, and</span>
<a name="l05938"></a>05938 <span class="comment">      must be the same dimensions as the destination. Pixels with a value of</span>
<a name="l05939"></a>05939 <span class="comment">      254 are shaded instead of blitted.</span>
<a name="l05940"></a>05940 <span class="comment"></span>
<a name="l05941"></a>05941 <span class="comment">**********************************************************************************************/</span>
<a name="l05942"></a><a class="code" href="vobject__blitters_8h.html#a48e70bbd4c3adddaf3164b384231328">05942</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#a48e70bbd4c3adddaf3164b384231328">Blt8BPPDataTo8BPPBufferTransShadowZNBClip</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="structSGPRect.html">SGPRect</a> *clipregion, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette )
<a name="l05943"></a>05943 {
<a name="l05944"></a>05944       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l05945"></a>05945       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth, Unblitted;
<a name="l05946"></a>05946       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l05947"></a>05947       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip, LineSkipZ;
<a name="l05948"></a>05948   <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l05949"></a>05949       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY, LeftSkip, RightSkip, TopSkip, BottomSkip, BlitLength, BlitHeight, LSCount;
<a name="l05950"></a>05950       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  ClipX1, ClipY1, ClipX2, ClipY2;
<a name="l05951"></a>05951       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *pPal8BPP;
<a name="l05952"></a>05952 
<a name="l05953"></a>05953       <span class="comment">// Assertions</span>
<a name="l05954"></a>05954       Assert( hSrcVObject != NULL );
<a name="l05955"></a>05955       Assert( pBuffer != NULL );
<a name="l05956"></a>05956 
<a name="l05957"></a>05957       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l05958"></a>05958       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l05959"></a>05959       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l05960"></a>05960       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l05961"></a>05961       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l05962"></a>05962 
<a name="l05963"></a>05963       <span class="comment">// Add to start position of dest buffer</span>
<a name="l05964"></a>05964       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l05965"></a>05965       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l05966"></a>05966 
<a name="l05967"></a>05967       <span class="keywordflow">if</span>(clipregion==NULL)
<a name="l05968"></a>05968       {
<a name="l05969"></a>05969             ClipX1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l05970"></a>05970             ClipY1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l05971"></a>05971             ClipX2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l05972"></a>05972             ClipY2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l05973"></a>05973       }
<a name="l05974"></a>05974       <span class="keywordflow">else</span>
<a name="l05975"></a>05975       {
<a name="l05976"></a>05976             ClipX1=clipregion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l05977"></a>05977             ClipY1=clipregion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l05978"></a>05978             ClipX2=clipregion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l05979"></a>05979             ClipY2=clipregion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l05980"></a>05980       }
<a name="l05981"></a>05981 
<a name="l05982"></a>05982       <span class="comment">// Calculate rows hanging off each side of the screen</span>
<a name="l05983"></a>05983       LeftSkip=__min(ClipX1 - min(ClipX1, iTempX), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l05984"></a>05984       RightSkip=__min(max(ClipX2, (iTempX+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth)) - ClipX2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l05985"></a>05985       TopSkip=__min(ClipY1 - __min(ClipY1, iTempY), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l05986"></a>05986       BottomSkip=__min(__max(ClipY2, (iTempY+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight)) - ClipY2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l05987"></a>05987 
<a name="l05988"></a>05988       <span class="comment">// calculate the remaining rows and columns to blit</span>
<a name="l05989"></a>05989       BlitLength=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth-LeftSkip-RightSkip);
<a name="l05990"></a>05990       BlitHeight=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight-TopSkip-BottomSkip);
<a name="l05991"></a>05991 
<a name="l05992"></a>05992       <span class="comment">// check if whole thing is clipped</span>
<a name="l05993"></a>05993       <span class="keywordflow">if</span>((LeftSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth) || (RightSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth))
<a name="l05994"></a>05994             <span class="keywordflow">return</span>(TRUE);
<a name="l05995"></a>05995 
<a name="l05996"></a>05996       <span class="comment">// check if whole thing is clipped</span>
<a name="l05997"></a>05997       <span class="keywordflow">if</span>((TopSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight) || (BottomSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight))
<a name="l05998"></a>05998             <span class="keywordflow">return</span>(TRUE);
<a name="l05999"></a>05999 
<a name="l06000"></a>06000       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l06001"></a>06001       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip));
<a name="l06002"></a>06002       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*2*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l06003"></a>06003       LineSkip=(uiDestPitchBYTES-(BlitLength));
<a name="l06004"></a>06004       LineSkipZ=LineSkip*2;
<a name="l06005"></a>06005       pPal8BPP=hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#152256552f959a5d90dbd886d22fb679">pShade8</a>;
<a name="l06006"></a>06006 
<a name="l06007"></a>06007       __asm {
<a name="l06008"></a>06008 
<a name="l06009"></a>06009             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l06010"></a>06010             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l06011"></a>06011             xor         eax, eax
<a name="l06012"></a>06012             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l06013"></a>06013             xor         ecx, ecx
<a name="l06014"></a>06014             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, pPal8BPP
<a name="l06015"></a>06015 
<a name="l06016"></a>06016             cmp         TopSkip, 0                                      <span class="comment">// check for nothing clipped on top</span>
<a name="l06017"></a>06017             je          LeftSkipSetup
<a name="l06018"></a>06018 
<a name="l06019"></a>06019 TopSkipLoop:                                                            <span class="comment">// Skips the number of lines clipped at the top</span>
<a name="l06020"></a>06020 
<a name="l06021"></a>06021             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l06022"></a>06022             inc         esi
<a name="l06023"></a>06023             or          cl, cl
<a name="l06024"></a>06024             js          TopSkipLoop
<a name="l06025"></a>06025             jz          TSEndLine
<a name="l06026"></a>06026 
<a name="l06027"></a>06027             add         esi, ecx
<a name="l06028"></a>06028             jmp         TopSkipLoop
<a name="l06029"></a>06029 
<a name="l06030"></a>06030 TSEndLine:
<a name="l06031"></a>06031             dec         TopSkip
<a name="l06032"></a>06032             jnz         TopSkipLoop
<a name="l06033"></a>06033 
<a name="l06034"></a>06034 LeftSkipSetup:
<a name="l06035"></a>06035 
<a name="l06036"></a>06036             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l06037"></a>06037             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, LeftSkip
<a name="l06038"></a>06038             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l06039"></a>06039             or          eax, eax
<a name="l06040"></a>06040             jz          BlitLineSetup
<a name="l06041"></a>06041 
<a name="l06042"></a>06042 LeftSkipLoop:
<a name="l06043"></a>06043 
<a name="l06044"></a>06044             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l06045"></a>06045             inc         esi
<a name="l06046"></a>06046 
<a name="l06047"></a>06047             or          cl, cl
<a name="l06048"></a>06048             js          LSTrans
<a name="l06049"></a>06049 
<a name="l06050"></a>06050             cmp         ecx, LSCount
<a name="l06051"></a>06051             je          LSSkip2                                               <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l06052"></a>06052             jb          LSSkip1                                               <span class="comment">// if less, skip whole thing</span>
<a name="l06053"></a>06053 
<a name="l06054"></a>06054             add         esi, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l06055"></a>06055             sub         ecx, LSCount
<a name="l06056"></a>06056             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l06057"></a>06057             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l06058"></a>06058             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l06059"></a>06059             jmp         BlitNonTransLoop
<a name="l06060"></a>06060 
<a name="l06061"></a>06061 LSSkip2:
<a name="l06062"></a>06062             add         esi, ecx                                        <span class="comment">// skip whole run, and start blit with new run</span>
<a name="l06063"></a>06063             jmp         BlitLineSetup
<a name="l06064"></a>06064 
<a name="l06065"></a>06065 
<a name="l06066"></a>06066 LSSkip1:
<a name="l06067"></a>06067             add         esi, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l06068"></a>06068             sub         LSCount, ecx
<a name="l06069"></a>06069             jmp         LeftSkipLoop
<a name="l06070"></a>06070 
<a name="l06071"></a>06071 
<a name="l06072"></a>06072 LSTrans:
<a name="l06073"></a>06073             and         ecx, 07fH
<a name="l06074"></a>06074             cmp         ecx, LSCount
<a name="l06075"></a>06075             je          BlitLineSetup                             <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l06076"></a>06076             jb          LSTrans1                                        <span class="comment">// if less, skip whole thing</span>
<a name="l06077"></a>06077 
<a name="l06078"></a>06078             sub         ecx, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l06079"></a>06079             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l06080"></a>06080             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l06081"></a>06081             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l06082"></a>06082             jmp         BlitTransparent
<a name="l06083"></a>06083 
<a name="l06084"></a>06084 
<a name="l06085"></a>06085 LSTrans1:
<a name="l06086"></a>06086             sub         LSCount, ecx                                          <span class="comment">// skip whole run, continue skipping</span>
<a name="l06087"></a>06087             jmp         LeftSkipLoop
<a name="l06088"></a>06088 
<a name="l06089"></a>06089 
<a name="l06090"></a>06090 BlitLineSetup:                                                    <span class="comment">// Does any actual blitting (trans/non) for the line</span>
<a name="l06091"></a>06091             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l06092"></a>06092             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l06093"></a>06093             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l06094"></a>06094 
<a name="l06095"></a>06095 BlitDispatch:
<a name="l06096"></a>06096 
<a name="l06097"></a>06097             cmp         LSCount, 0                                      <span class="comment">// Check to see if we're done blitting</span>
<a name="l06098"></a>06098             je          RightSkipLoop
<a name="l06099"></a>06099 
<a name="l06100"></a>06100             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l06101"></a>06101             inc         esi
<a name="l06102"></a>06102             or          cl, cl
<a name="l06103"></a>06103             js          BlitTransparent
<a name="l06104"></a>06104 
<a name="l06105"></a>06105 BlitNonTransLoop:                                           <span class="comment">// blit non-transparent pixels</span>
<a name="l06106"></a>06106 
<a name="l06107"></a>06107             cmp         ecx, LSCount
<a name="l06108"></a>06108             jbe         BNTrans1
<a name="l06109"></a>06109 
<a name="l06110"></a>06110             sub         ecx, LSCount
<a name="l06111"></a>06111             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, ecx
<a name="l06112"></a>06112             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, LSCount
<a name="l06113"></a>06113 
<a name="l06114"></a>06114 BNTrans1:
<a name="l06115"></a>06115             sub         LSCount, ecx
<a name="l06116"></a>06116 
<a name="l06117"></a>06117 BlitNTL1:
<a name="l06118"></a>06118 
<a name="l06119"></a>06119             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l06120"></a>06120             cmp         ax, usZValue
<a name="l06121"></a>06121             jae         BlitNTL2
<a name="l06122"></a>06122 
<a name="l06123"></a>06123             xor         eax, eax
<a name="l06124"></a>06124             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l06125"></a>06125             cmp         al, 254
<a name="l06126"></a>06126             jne         BlitNTL3
<a name="l06127"></a>06127 
<a name="l06128"></a>06128 <span class="comment">//          mov         al, [edi]</span>
<a name="l06129"></a>06129 <span class="comment">//          mov         ax, ColorTable[eax] ************************************************</span>
<a name="l06130"></a>06130 <span class="comment">//          mov         [edi], al</span>
<a name="l06131"></a>06131             jmp         BlitNTL2
<a name="l06132"></a>06132 
<a name="l06133"></a>06133 BlitNTL3:
<a name="l06134"></a>06134             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         al, [edx+eax]
<a name="l06135"></a>06135             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], al
<a name="l06136"></a>06136 
<a name="l06137"></a>06137 BlitNTL2:
<a name="l06138"></a>06138             inc         esi
<a name="l06139"></a>06139             inc         edi
<a name="l06140"></a>06140             add         ebx, 2
<a name="l06141"></a>06141             dec         cl
<a name="l06142"></a>06142             jnz         BlitNTL1
<a name="l06143"></a>06143 
<a name="l06144"></a>06144 <span class="comment">//BlitLineEnd:</span>
<a name="l06145"></a>06145             add         esi, Unblitted
<a name="l06146"></a>06146             jmp         BlitDispatch
<a name="l06147"></a>06147 
<a name="l06148"></a>06148 BlitTransparent:                                                              <span class="comment">// skip transparent pixels</span>
<a name="l06149"></a>06149 
<a name="l06150"></a>06150             and         ecx, 07fH
<a name="l06151"></a>06151             cmp         ecx, LSCount
<a name="l06152"></a>06152             jbe         BTrans1
<a name="l06153"></a>06153 
<a name="l06154"></a>06154             mov         ecx, LSCount
<a name="l06155"></a>06155 
<a name="l06156"></a>06156 BTrans1:
<a name="l06157"></a>06157 
<a name="l06158"></a>06158             sub         LSCount, ecx
<a name="l06159"></a>06159             add         edi, ecx
<a name="l06160"></a>06160 <span class="comment">//          shl         ecx, 1</span>
<a name="l06161"></a>06161             add   ecx, ecx
<a name="l06162"></a>06162             add         ebx, ecx
<a name="l06163"></a>06163             jmp         BlitDispatch
<a name="l06164"></a>06164 
<a name="l06165"></a>06165 
<a name="l06166"></a>06166 RightSkipLoop:                                                                      <span class="comment">// skip along until we hit and end-of-line marker</span>
<a name="l06167"></a>06167 
<a name="l06168"></a>06168 
<a name="l06169"></a>06169 RSLoop1:
<a name="l06170"></a>06170             mov         al, [esi]
<a name="l06171"></a>06171             inc         esi
<a name="l06172"></a>06172             or          al, al
<a name="l06173"></a>06173             jnz         RSLoop1
<a name="l06174"></a>06174 
<a name="l06175"></a>06175             dec         BlitHeight
<a name="l06176"></a>06176             jz          BlitDone
<a name="l06177"></a>06177             add         edi, LineSkip
<a name="l06178"></a>06178             add         ebx, LineSkipZ
<a name="l06179"></a>06179 
<a name="l06180"></a>06180             jmp         LeftSkipSetup
<a name="l06181"></a>06181 
<a name="l06182"></a>06182 
<a name="l06183"></a>06183 BlitDone:
<a name="l06184"></a>06184       }
<a name="l06185"></a>06185 
<a name="l06186"></a>06186       <span class="keywordflow">return</span>(TRUE);
<a name="l06187"></a>06187 
<a name="l06188"></a>06188 }
<a name="l06189"></a>06189 
<a name="l06190"></a>06190 <span class="comment">/**********************************************************************************************</span>
<a name="l06191"></a>06191 <span class="comment"> Blt8BPPDataTo8BPPBufferShadow</span>
<a name="l06192"></a>06192 <span class="comment"></span>
<a name="l06193"></a>06193 <span class="comment">      Modifies the destination buffer. Darkens the destination pixels by 25%, using the source</span>
<a name="l06194"></a>06194 <span class="comment">      image as a mask. Any Non-zero index pixels are used to darken destination pixels.</span>
<a name="l06195"></a>06195 <span class="comment"></span>
<a name="l06196"></a>06196 <span class="comment">**********************************************************************************************/</span>
<a name="l06197"></a><a class="code" href="vobject__blitters_8h.html#e3649328f2cfa7fcf2ebf6127056831c">06197</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#e3649328f2cfa7fcf2ebf6127056831c">Blt8BPPDataTo8BPPBufferShadow</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex)
<a name="l06198"></a>06198 {
<a name="l06199"></a>06199       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *pPal8BPP;
<a name="l06200"></a>06200       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l06201"></a>06201       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth;
<a name="l06202"></a>06202       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr;
<a name="l06203"></a>06203       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l06204"></a>06204   <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l06205"></a>06205       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l06206"></a>06206 
<a name="l06207"></a>06207       <span class="comment">// Assertions</span>
<a name="l06208"></a>06208       Assert( hSrcVObject != NULL );
<a name="l06209"></a>06209       Assert( pBuffer != NULL );
<a name="l06210"></a>06210 
<a name="l06211"></a>06211       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l06212"></a>06212       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l06213"></a>06213       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l06214"></a>06214       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l06215"></a>06215       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l06216"></a>06216 
<a name="l06217"></a>06217       <span class="comment">// Add to start position of dest buffer</span>
<a name="l06218"></a>06218       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l06219"></a>06219       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l06220"></a>06220 
<a name="l06221"></a>06221       <span class="comment">// Validations</span>
<a name="l06222"></a>06222       CHECKF( iTempX &gt;= 0 );
<a name="l06223"></a>06223       CHECKF( iTempY &gt;= 0 );
<a name="l06224"></a>06224 
<a name="l06225"></a>06225 
<a name="l06226"></a>06226       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l06227"></a>06227       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*iTempY) + (iTempX);
<a name="l06228"></a>06228       pPal8BPP = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#152256552f959a5d90dbd886d22fb679">pShade8</a>;
<a name="l06229"></a>06229       LineSkip=(uiDestPitchBYTES-(usWidth));
<a name="l06230"></a>06230 
<a name="l06231"></a>06231       __asm {
<a name="l06232"></a>06232 
<a name="l06233"></a>06233             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l06234"></a>06234             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l06235"></a>06235             xor         eax, eax
<a name="l06236"></a>06236             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, usHeight
<a name="l06237"></a>06237             xor         ecx, ecx
<a name="l06238"></a>06238             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, OFFSET <a class="code" href="shading_8cpp.html#fd38e38bdd68f0da44ac96abacf3b2a6">ShadeTable</a>
<a name="l06239"></a>06239 
<a name="l06240"></a>06240 BlitDispatch:
<a name="l06241"></a>06241 
<a name="l06242"></a>06242 
<a name="l06243"></a>06243             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l06244"></a>06244             inc         esi
<a name="l06245"></a>06245             or          cl, cl
<a name="l06246"></a>06246             js          BlitTransparent
<a name="l06247"></a>06247             jz          BlitDoneLine
<a name="l06248"></a>06248 
<a name="l06249"></a>06249 <span class="comment">//BlitNonTransLoop:</span>
<a name="l06250"></a>06250 
<a name="l06251"></a>06251             xor         eax, eax
<a name="l06252"></a>06252 
<a name="l06253"></a>06253             add         esi, ecx
<a name="l06254"></a>06254 
<a name="l06255"></a>06255             clc
<a name="l06256"></a>06256             rcr         cl, 1
<a name="l06257"></a>06257             jnc         BlitNTL2
<a name="l06258"></a>06258 
<a name="l06259"></a>06259             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [edi]
<a name="l06260"></a>06260             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, [edx+eax*2]
<a name="l06261"></a>06261             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax
<a name="l06262"></a>06262 
<a name="l06263"></a>06263             add         edi, 2
<a name="l06264"></a>06264 
<a name="l06265"></a>06265 BlitNTL2:
<a name="l06266"></a>06266             clc
<a name="l06267"></a>06267             rcr         cl, 1
<a name="l06268"></a>06268             jnc         BlitNTL3
<a name="l06269"></a>06269 
<a name="l06270"></a>06270             mov         ax, [edi]
<a name="l06271"></a>06271             mov         ax, [edx+eax*2]
<a name="l06272"></a>06272             mov         [edi], ax
<a name="l06273"></a>06273 
<a name="l06274"></a>06274             mov         ax, [edi+2]
<a name="l06275"></a>06275             mov         ax, [edx+eax*2]
<a name="l06276"></a>06276             mov         [edi+2], ax
<a name="l06277"></a>06277 
<a name="l06278"></a>06278             add         edi, 4
<a name="l06279"></a>06279 
<a name="l06280"></a>06280 BlitNTL3:
<a name="l06281"></a>06281 
<a name="l06282"></a>06282             or          cl, cl
<a name="l06283"></a>06283             jz          BlitDispatch
<a name="l06284"></a>06284 
<a name="l06285"></a>06285 BlitNTL4:
<a name="l06286"></a>06286 
<a name="l06287"></a>06287             mov         ax, [edi]
<a name="l06288"></a>06288             mov         ax, [edx+eax*2]
<a name="l06289"></a>06289             mov         [edi], ax
<a name="l06290"></a>06290 
<a name="l06291"></a>06291             mov         ax, [edi+2]
<a name="l06292"></a>06292             mov         ax, [edx+eax*2]
<a name="l06293"></a>06293             mov         [edi+2], ax
<a name="l06294"></a>06294 
<a name="l06295"></a>06295             mov         ax, [edi+4]
<a name="l06296"></a>06296             mov         ax, [edx+eax*2]
<a name="l06297"></a>06297             mov         [edi+4], ax
<a name="l06298"></a>06298 
<a name="l06299"></a>06299             mov         ax, [edi+6]
<a name="l06300"></a>06300             mov         ax, [edx+eax*2]
<a name="l06301"></a>06301             mov         [edi+6], ax
<a name="l06302"></a>06302 
<a name="l06303"></a>06303             add         edi, 8
<a name="l06304"></a>06304             dec         cl
<a name="l06305"></a>06305             jnz         BlitNTL4
<a name="l06306"></a>06306 
<a name="l06307"></a>06307             jmp         BlitDispatch
<a name="l06308"></a>06308 
<a name="l06309"></a>06309 BlitTransparent:
<a name="l06310"></a>06310 
<a name="l06311"></a>06311             and         ecx, 07fH
<a name="l06312"></a>06312 <span class="comment">//          shl         ecx, 1</span>
<a name="l06313"></a>06313             add   ecx, ecx
<a name="l06314"></a>06314             add         edi, ecx
<a name="l06315"></a>06315             jmp         BlitDispatch
<a name="l06316"></a>06316 
<a name="l06317"></a>06317 
<a name="l06318"></a>06318 BlitDoneLine:
<a name="l06319"></a>06319 
<a name="l06320"></a>06320             dec         ebx
<a name="l06321"></a>06321             jz          BlitDone
<a name="l06322"></a>06322             add         edi, LineSkip
<a name="l06323"></a>06323             jmp         BlitDispatch
<a name="l06324"></a>06324 
<a name="l06325"></a>06325 
<a name="l06326"></a>06326 BlitDone:
<a name="l06327"></a>06327       }
<a name="l06328"></a>06328 
<a name="l06329"></a>06329       <span class="keywordflow">return</span>(TRUE);
<a name="l06330"></a>06330 
<a name="l06331"></a>06331 }
<a name="l06332"></a>06332 
<a name="l06333"></a>06333 <span class="comment">/**********************************************************************************************</span>
<a name="l06334"></a>06334 <span class="comment"> Blt8BPPDataTo8BPPBufferShadowClip</span>
<a name="l06335"></a>06335 <span class="comment"></span>
<a name="l06336"></a>06336 <span class="comment">      Modifies the destination buffer. Darkens the destination pixels by 25%, using the source</span>
<a name="l06337"></a>06337 <span class="comment">      image as a mask. Any Non-zero index pixels are used to darken destination pixels. Blitter</span>
<a name="l06338"></a>06338 <span class="comment">      clips brush if it doesn't fit on the viewport.</span>
<a name="l06339"></a>06339 <span class="comment"></span>
<a name="l06340"></a>06340 <span class="comment">**********************************************************************************************/</span>
<a name="l06341"></a><a class="code" href="vobject__blitters_8h.html#b514643cb0c1f12728ecde2650c258f3">06341</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#b514643cb0c1f12728ecde2650c258f3">Blt8BPPDataTo8BPPBufferShadowClip</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="structSGPRect.html">SGPRect</a> *clipregion)
<a name="l06342"></a>06342 {
<a name="l06343"></a>06343       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *pPal8BPP;
<a name="l06344"></a>06344       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l06345"></a>06345       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth, Unblitted;
<a name="l06346"></a>06346       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr;
<a name="l06347"></a>06347       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l06348"></a>06348   <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l06349"></a>06349       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY, LeftSkip, RightSkip, TopSkip, BottomSkip, BlitLength, BlitHeight;
<a name="l06350"></a>06350       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  ClipX1, ClipY1, ClipX2, ClipY2;
<a name="l06351"></a>06351 
<a name="l06352"></a>06352       <span class="comment">// Assertions</span>
<a name="l06353"></a>06353       Assert( hSrcVObject != NULL );
<a name="l06354"></a>06354       Assert( pBuffer != NULL );
<a name="l06355"></a>06355 
<a name="l06356"></a>06356       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l06357"></a>06357       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l06358"></a>06358       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l06359"></a>06359       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l06360"></a>06360       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l06361"></a>06361 
<a name="l06362"></a>06362       <span class="comment">// Add to start position of dest buffer</span>
<a name="l06363"></a>06363       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l06364"></a>06364       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l06365"></a>06365 
<a name="l06366"></a>06366       <span class="keywordflow">if</span>(clipregion==NULL)
<a name="l06367"></a>06367       {
<a name="l06368"></a>06368             ClipX1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l06369"></a>06369             ClipY1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l06370"></a>06370             ClipX2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l06371"></a>06371             ClipY2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l06372"></a>06372       }
<a name="l06373"></a>06373       <span class="keywordflow">else</span>
<a name="l06374"></a>06374       {
<a name="l06375"></a>06375             ClipX1=clipregion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l06376"></a>06376             ClipY1=clipregion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l06377"></a>06377             ClipX2=clipregion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l06378"></a>06378             ClipY2=clipregion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l06379"></a>06379       }
<a name="l06380"></a>06380 
<a name="l06381"></a>06381       <span class="comment">// Calculate rows hanging off each side of the screen</span>
<a name="l06382"></a>06382       LeftSkip=__min(ClipX1 - min(ClipX1, iTempX), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l06383"></a>06383       RightSkip=__min(max(ClipX2, (iTempX+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth)) - ClipX2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l06384"></a>06384       TopSkip=__min(ClipY1 - __min(ClipY1, iTempY), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l06385"></a>06385       BottomSkip=__min(__max(ClipY2, (iTempY+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight)) - ClipY2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l06386"></a>06386 
<a name="l06387"></a>06387       <span class="comment">// calculate the remaining rows and columns to blit</span>
<a name="l06388"></a>06388       BlitLength=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth-LeftSkip-RightSkip);
<a name="l06389"></a>06389       BlitHeight=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight-TopSkip-BottomSkip);
<a name="l06390"></a>06390 
<a name="l06391"></a>06391       <span class="comment">// whole thing is clipped</span>
<a name="l06392"></a>06392       <span class="keywordflow">if</span>((LeftSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth) || (RightSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth))
<a name="l06393"></a>06393             <span class="keywordflow">return</span>(TRUE);
<a name="l06394"></a>06394 
<a name="l06395"></a>06395       <span class="comment">// whole thing is clipped</span>
<a name="l06396"></a>06396       <span class="keywordflow">if</span>((TopSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight) || (BottomSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight))
<a name="l06397"></a>06397             <span class="keywordflow">return</span>(TRUE);
<a name="l06398"></a>06398 
<a name="l06399"></a>06399       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l06400"></a>06400       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip));
<a name="l06401"></a>06401       pPal8BPP = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#152256552f959a5d90dbd886d22fb679">pShade8</a>;
<a name="l06402"></a>06402       LineSkip=(uiDestPitchBYTES-(BlitLength));
<a name="l06403"></a>06403 
<a name="l06404"></a>06404 
<a name="l06405"></a>06405       __asm {
<a name="l06406"></a>06406 
<a name="l06407"></a>06407             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l06408"></a>06408             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l06409"></a>06409             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, pPal8BPP
<a name="l06410"></a>06410             xor         eax, eax
<a name="l06411"></a>06411             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, TopSkip
<a name="l06412"></a>06412             xor         ecx, ecx
<a name="l06413"></a>06413 
<a name="l06414"></a>06414             or          ebx, ebx                                        <span class="comment">// check for nothing clipped on top</span>
<a name="l06415"></a>06415             jz          LeftSkipSetup
<a name="l06416"></a>06416 
<a name="l06417"></a>06417 TopSkipLoop:                                                            <span class="comment">// Skips the number of lines clipped at the top</span>
<a name="l06418"></a>06418 
<a name="l06419"></a>06419             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l06420"></a>06420             inc         esi
<a name="l06421"></a>06421             or          cl, cl
<a name="l06422"></a>06422             js          TopSkipLoop
<a name="l06423"></a>06423             jz          TSEndLine
<a name="l06424"></a>06424 
<a name="l06425"></a>06425             add         esi, ecx
<a name="l06426"></a>06426             jmp         TopSkipLoop
<a name="l06427"></a>06427 
<a name="l06428"></a>06428 TSEndLine:
<a name="l06429"></a>06429             dec         ebx
<a name="l06430"></a>06430             jnz         TopSkipLoop
<a name="l06431"></a>06431 
<a name="l06432"></a>06432 
<a name="l06433"></a>06433 
<a name="l06434"></a>06434 
<a name="l06435"></a>06435 LeftSkipSetup:
<a name="l06436"></a>06436 
<a name="l06437"></a>06437             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l06438"></a>06438             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, LeftSkip                             <span class="comment">// check for nothing clipped on the left</span>
<a name="l06439"></a>06439             or          ebx, ebx
<a name="l06440"></a>06440             jz          BlitLineSetup
<a name="l06441"></a>06441 
<a name="l06442"></a>06442 LeftSkipLoop:
<a name="l06443"></a>06443 
<a name="l06444"></a>06444             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l06445"></a>06445             inc         esi
<a name="l06446"></a>06446 
<a name="l06447"></a>06447             or          cl, cl
<a name="l06448"></a>06448             js          LSTrans
<a name="l06449"></a>06449 
<a name="l06450"></a>06450             cmp         ecx, ebx
<a name="l06451"></a>06451             je          LSSkip2                                               <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l06452"></a>06452             jb          LSSkip1                                               <span class="comment">// if less, skip whole thing</span>
<a name="l06453"></a>06453 
<a name="l06454"></a>06454             add         esi, ebx                                        <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l06455"></a>06455             sub         ecx, ebx
<a name="l06456"></a>06456             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, BlitLength
<a name="l06457"></a>06457             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l06458"></a>06458             jmp         BlitNonTransLoop
<a name="l06459"></a>06459 
<a name="l06460"></a>06460 LSSkip2:
<a name="l06461"></a>06461             add         esi, ecx                                        <span class="comment">// skip whole run, and start blit with new run</span>
<a name="l06462"></a>06462             jmp         BlitLineSetup
<a name="l06463"></a>06463 
<a name="l06464"></a>06464 
<a name="l06465"></a>06465 LSSkip1:
<a name="l06466"></a>06466             add         esi, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l06467"></a>06467             sub         ebx, ecx
<a name="l06468"></a>06468             jmp         LeftSkipLoop
<a name="l06469"></a>06469 
<a name="l06470"></a>06470 
<a name="l06471"></a>06471 LSTrans:
<a name="l06472"></a>06472             and         ecx, 07fH
<a name="l06473"></a>06473             cmp         ecx, ebx
<a name="l06474"></a>06474             je          BlitLineSetup                             <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l06475"></a>06475             jb          LSTrans1                                        <span class="comment">// if less, skip whole thing</span>
<a name="l06476"></a>06476 
<a name="l06477"></a>06477             sub         ecx, ebx                                        <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l06478"></a>06478             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, BlitLength
<a name="l06479"></a>06479             jmp         BlitTransparent
<a name="l06480"></a>06480 
<a name="l06481"></a>06481 
<a name="l06482"></a>06482 LSTrans1:
<a name="l06483"></a>06483             sub         ebx, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l06484"></a>06484             jmp         LeftSkipLoop
<a name="l06485"></a>06485 
<a name="l06486"></a>06486 
<a name="l06487"></a>06487 
<a name="l06488"></a>06488 
<a name="l06489"></a>06489 BlitLineSetup:                                                    <span class="comment">// Does any actual blitting (trans/non) for the line</span>
<a name="l06490"></a>06490             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, BlitLength
<a name="l06491"></a>06491             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l06492"></a>06492 
<a name="l06493"></a>06493 BlitDispatch:
<a name="l06494"></a>06494 
<a name="l06495"></a>06495             or          ebx, ebx                                        <span class="comment">// Check to see if we're done blitting</span>
<a name="l06496"></a>06496             jz          RightSkipLoop
<a name="l06497"></a>06497 
<a name="l06498"></a>06498             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l06499"></a>06499             inc         esi
<a name="l06500"></a>06500             or          cl, cl
<a name="l06501"></a>06501             js          BlitTransparent
<a name="l06502"></a>06502 
<a name="l06503"></a>06503 BlitNonTransLoop:
<a name="l06504"></a>06504 
<a name="l06505"></a>06505             cmp         ecx, ebx
<a name="l06506"></a>06506             jbe         BNTrans1
<a name="l06507"></a>06507 
<a name="l06508"></a>06508             sub         ecx, ebx
<a name="l06509"></a>06509             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, ecx
<a name="l06510"></a>06510             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, ebx
<a name="l06511"></a>06511 
<a name="l06512"></a>06512 BNTrans1:
<a name="l06513"></a>06513             sub         ebx, ecx
<a name="l06514"></a>06514 
<a name="l06515"></a>06515             clc
<a name="l06516"></a>06516             rcr         cl, 1
<a name="l06517"></a>06517             jnc         BlitNTL2
<a name="l06518"></a>06518 
<a name="l06519"></a>06519             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [edi]
<a name="l06520"></a>06520             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, [edx+eax]
<a name="l06521"></a>06521             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax
<a name="l06522"></a>06522 
<a name="l06523"></a>06523             inc         esi
<a name="l06524"></a>06524             add         edi, 2
<a name="l06525"></a>06525 
<a name="l06526"></a>06526 BlitNTL2:
<a name="l06527"></a>06527             clc
<a name="l06528"></a>06528             rcr         cl, 1
<a name="l06529"></a>06529             jnc         BlitNTL3
<a name="l06530"></a>06530 
<a name="l06531"></a>06531             mov         ax, [edi]
<a name="l06532"></a>06532             mov         ax, [edx+eax]
<a name="l06533"></a>06533             mov         [edi], ax
<a name="l06534"></a>06534 
<a name="l06535"></a>06535             mov         ax, [edi+2]
<a name="l06536"></a>06536             mov         ax, [edx+eax]
<a name="l06537"></a>06537             mov         [edi+2], ax
<a name="l06538"></a>06538 
<a name="l06539"></a>06539             add         esi, 2
<a name="l06540"></a>06540             add         edi, 4
<a name="l06541"></a>06541 
<a name="l06542"></a>06542 BlitNTL3:
<a name="l06543"></a>06543 
<a name="l06544"></a>06544             or          cl, cl
<a name="l06545"></a>06545             jz          BlitLineEnd
<a name="l06546"></a>06546 
<a name="l06547"></a>06547 BlitNTL4:
<a name="l06548"></a>06548 
<a name="l06549"></a>06549             mov         ax, [edi]
<a name="l06550"></a>06550             mov         ax, [edx+eax]
<a name="l06551"></a>06551             mov         [edi], ax
<a name="l06552"></a>06552 
<a name="l06553"></a>06553             mov         ax, [edi+2]
<a name="l06554"></a>06554             mov         ax, [edx+eax]
<a name="l06555"></a>06555             mov         [edi+2], ax
<a name="l06556"></a>06556 
<a name="l06557"></a>06557             mov         ax, [edi+4]
<a name="l06558"></a>06558             mov         ax, [edx+eax]
<a name="l06559"></a>06559             mov         [edi+4], ax
<a name="l06560"></a>06560 
<a name="l06561"></a>06561             mov         ax, [edi+6]
<a name="l06562"></a>06562             mov         ax, [edx+eax]
<a name="l06563"></a>06563             mov         [edi+6], ax
<a name="l06564"></a>06564 
<a name="l06565"></a>06565             add         esi, 4
<a name="l06566"></a>06566             add         edi, 8
<a name="l06567"></a>06567             dec         cl
<a name="l06568"></a>06568             jnz         BlitNTL4
<a name="l06569"></a>06569 
<a name="l06570"></a>06570 BlitLineEnd:
<a name="l06571"></a>06571             add         esi, Unblitted
<a name="l06572"></a>06572             jmp         BlitDispatch
<a name="l06573"></a>06573 
<a name="l06574"></a>06574 BlitTransparent:
<a name="l06575"></a>06575 
<a name="l06576"></a>06576             and         ecx, 07fH
<a name="l06577"></a>06577             cmp         ecx, ebx
<a name="l06578"></a>06578             jbe         BTrans1
<a name="l06579"></a>06579 
<a name="l06580"></a>06580             mov         ecx, ebx
<a name="l06581"></a>06581 
<a name="l06582"></a>06582 BTrans1:
<a name="l06583"></a>06583 
<a name="l06584"></a>06584             sub         ebx, ecx
<a name="l06585"></a>06585 <span class="comment">//          shl         ecx, 1</span>
<a name="l06586"></a>06586             add   ecx, ecx
<a name="l06587"></a>06587             add         edi, ecx
<a name="l06588"></a>06588             jmp         BlitDispatch
<a name="l06589"></a>06589 
<a name="l06590"></a>06590 
<a name="l06591"></a>06591 RightSkipLoop:
<a name="l06592"></a>06592 
<a name="l06593"></a>06593 
<a name="l06594"></a>06594 RSLoop1:
<a name="l06595"></a>06595             mov         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l06596"></a>06596             inc         esi
<a name="l06597"></a>06597             or          al, al
<a name="l06598"></a>06598             jnz         RSLoop1
<a name="l06599"></a>06599 
<a name="l06600"></a>06600             dec         BlitHeight
<a name="l06601"></a>06601             jz          BlitDone
<a name="l06602"></a>06602             add         edi, LineSkip
<a name="l06603"></a>06603 
<a name="l06604"></a>06604             jmp         LeftSkipSetup
<a name="l06605"></a>06605 
<a name="l06606"></a>06606 
<a name="l06607"></a>06607 BlitDone:
<a name="l06608"></a>06608       }
<a name="l06609"></a>06609 
<a name="l06610"></a>06610       <span class="keywordflow">return</span>(TRUE);
<a name="l06611"></a>06611 
<a name="l06612"></a>06612 }
<a name="l06613"></a>06613 
<a name="l06614"></a>06614 
<a name="l06615"></a>06615 
<a name="l06616"></a>06616 
<a name="l06617"></a>06617 <span class="comment">//*****************************************************************************</span>
<a name="l06618"></a>06618 <span class="comment">//** 16 Bit Blitters</span>
<a name="l06619"></a>06619 <span class="comment">//**</span>
<a name="l06620"></a>06620 <span class="comment">//*****************************************************************************</span>
<a name="l06621"></a>06621 
<a name="l06622"></a>06622 <span class="comment">/**********************************************************************************************</span>
<a name="l06623"></a>06623 <span class="comment"> Blt8BPPDataTo16BPPBufferMonoShadowClip</span>
<a name="l06624"></a>06624 <span class="comment"></span>
<a name="l06625"></a>06625 <span class="comment">      Uses a bitmap an 8BPP template for blitting. Anywhere a 1 appears in the bitmap, a shadow</span>
<a name="l06626"></a>06626 <span class="comment">      is blitted to the destination (a black pixel). Any other value above zero is considered a</span>
<a name="l06627"></a>06627 <span class="comment">      forground color, and zero is background. If the parameter for the background color is zero,</span>
<a name="l06628"></a>06628 <span class="comment">      transparency is used for the background.</span>
<a name="l06629"></a>06629 <span class="comment"></span>
<a name="l06630"></a>06630 <span class="comment">**********************************************************************************************/</span>
<a name="l06631"></a><a class="code" href="vobject__blitters_8h.html#32d7c249071c3414716a4b0947c6200e">06631</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#32d7c249071c3414716a4b0947c6200e">Blt8BPPDataTo16BPPBufferMonoShadowClip</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="structSGPRect.html">SGPRect</a> *clipregion, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usForeground, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usBackground, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usShadow )
<a name="l06632"></a>06632 {
<a name="l06633"></a>06633       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l06634"></a>06634       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth, Unblitted;
<a name="l06635"></a>06635       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr;
<a name="l06636"></a>06636       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l06637"></a>06637   <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l06638"></a>06638       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY, LeftSkip, RightSkip, TopSkip, BottomSkip, BlitLength, BlitHeight, LSCount;
<a name="l06639"></a>06639       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  ClipX1, ClipY1, ClipX2, ClipY2;
<a name="l06640"></a>06640 
<a name="l06641"></a>06641       <span class="comment">// Assertions</span>
<a name="l06642"></a>06642       Assert( hSrcVObject != NULL );
<a name="l06643"></a>06643       Assert( pBuffer != NULL );
<a name="l06644"></a>06644 
<a name="l06645"></a>06645       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l06646"></a>06646       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l06647"></a>06647       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l06648"></a>06648       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l06649"></a>06649       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l06650"></a>06650 
<a name="l06651"></a>06651       <span class="comment">// Add to start position of dest buffer</span>
<a name="l06652"></a>06652       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l06653"></a>06653       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l06654"></a>06654 
<a name="l06655"></a>06655       <span class="keywordflow">if</span>(clipregion==NULL)
<a name="l06656"></a>06656       {
<a name="l06657"></a>06657             ClipX1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l06658"></a>06658             ClipY1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l06659"></a>06659             ClipX2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l06660"></a>06660             ClipY2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l06661"></a>06661       }
<a name="l06662"></a>06662       <span class="keywordflow">else</span>
<a name="l06663"></a>06663       {
<a name="l06664"></a>06664             ClipX1=clipregion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l06665"></a>06665             ClipY1=clipregion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l06666"></a>06666             ClipX2=clipregion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l06667"></a>06667             ClipY2=clipregion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l06668"></a>06668       }
<a name="l06669"></a>06669 
<a name="l06670"></a>06670       <span class="comment">// Calculate rows hanging off each side of the screen</span>
<a name="l06671"></a>06671       LeftSkip=__min(ClipX1 - min(ClipX1, iTempX), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l06672"></a>06672       RightSkip=__min(max(ClipX2, (iTempX+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth)) - ClipX2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l06673"></a>06673       TopSkip=__min(ClipY1 - __min(ClipY1, iTempY), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l06674"></a>06674       BottomSkip=__min(__max(ClipY2, (iTempY+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight)) - ClipY2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l06675"></a>06675 
<a name="l06676"></a>06676       <span class="comment">// calculate the remaining rows and columns to blit</span>
<a name="l06677"></a>06677       BlitLength=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth-LeftSkip-RightSkip);
<a name="l06678"></a>06678       BlitHeight=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight-TopSkip-BottomSkip);
<a name="l06679"></a>06679 
<a name="l06680"></a>06680       <span class="comment">// check if whole thing is clipped</span>
<a name="l06681"></a>06681       <span class="keywordflow">if</span>((LeftSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth) || (RightSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth))
<a name="l06682"></a>06682             <span class="keywordflow">return</span>(TRUE);
<a name="l06683"></a>06683 
<a name="l06684"></a>06684       <span class="comment">// check if whole thing is clipped</span>
<a name="l06685"></a>06685       <span class="keywordflow">if</span>((TopSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight) || (BottomSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight))
<a name="l06686"></a>06686             <span class="keywordflow">return</span>(TRUE);
<a name="l06687"></a>06687 
<a name="l06688"></a>06688       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l06689"></a>06689       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l06690"></a>06690       LineSkip=(uiDestPitchBYTES-(BlitLength*2));
<a name="l06691"></a>06691 
<a name="l06692"></a>06692       __asm {
<a name="l06693"></a>06693 
<a name="l06694"></a>06694             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l06695"></a>06695             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l06696"></a>06696             xor         eax, eax
<a name="l06697"></a>06697             xor         ecx, ecx
<a name="l06698"></a>06698 
<a name="l06699"></a>06699             cmp         TopSkip, 0                                      <span class="comment">// check for nothing clipped on top</span>
<a name="l06700"></a>06700             je          LeftSkipSetup
<a name="l06701"></a>06701 
<a name="l06702"></a>06702 TopSkipLoop:                                                            <span class="comment">// Skips the number of lines clipped at the top</span>
<a name="l06703"></a>06703 
<a name="l06704"></a>06704             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l06705"></a>06705             inc         esi
<a name="l06706"></a>06706             or          cl, cl
<a name="l06707"></a>06707             js          TopSkipLoop
<a name="l06708"></a>06708             jz          TSEndLine
<a name="l06709"></a>06709 
<a name="l06710"></a>06710             add         esi, ecx
<a name="l06711"></a>06711             jmp         TopSkipLoop
<a name="l06712"></a>06712 
<a name="l06713"></a>06713 TSEndLine:
<a name="l06714"></a>06714             dec         TopSkip
<a name="l06715"></a>06715             jnz         TopSkipLoop
<a name="l06716"></a>06716 
<a name="l06717"></a>06717 LeftSkipSetup:
<a name="l06718"></a>06718 
<a name="l06719"></a>06719             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l06720"></a>06720             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, LeftSkip
<a name="l06721"></a>06721             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l06722"></a>06722             or          eax, eax
<a name="l06723"></a>06723             jz          BlitLineSetup
<a name="l06724"></a>06724 
<a name="l06725"></a>06725 LeftSkipLoop:
<a name="l06726"></a>06726 
<a name="l06727"></a>06727             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l06728"></a>06728             inc         esi
<a name="l06729"></a>06729 
<a name="l06730"></a>06730             or          cl, cl
<a name="l06731"></a>06731             js          LSTrans
<a name="l06732"></a>06732 
<a name="l06733"></a>06733             cmp         ecx, LSCount
<a name="l06734"></a>06734             je          LSSkip2                                               <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l06735"></a>06735             jb          LSSkip1                                               <span class="comment">// if less, skip whole thing</span>
<a name="l06736"></a>06736 
<a name="l06737"></a>06737             add         esi, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l06738"></a>06738             sub         ecx, LSCount
<a name="l06739"></a>06739             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l06740"></a>06740             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l06741"></a>06741             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l06742"></a>06742             jmp         BlitNonTransLoop
<a name="l06743"></a>06743 
<a name="l06744"></a>06744 LSSkip2:
<a name="l06745"></a>06745             add         esi, ecx                                        <span class="comment">// skip whole run, and start blit with new run</span>
<a name="l06746"></a>06746             jmp         BlitLineSetup
<a name="l06747"></a>06747 
<a name="l06748"></a>06748 
<a name="l06749"></a>06749 LSSkip1:
<a name="l06750"></a>06750             add         esi, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l06751"></a>06751             sub         LSCount, ecx
<a name="l06752"></a>06752             jmp         LeftSkipLoop
<a name="l06753"></a>06753 
<a name="l06754"></a>06754 
<a name="l06755"></a>06755 LSTrans:
<a name="l06756"></a>06756             and         ecx, 07fH
<a name="l06757"></a>06757             cmp         ecx, LSCount
<a name="l06758"></a>06758             je          BlitLineSetup                             <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l06759"></a>06759             jb          LSTrans1                                        <span class="comment">// if less, skip whole thing</span>
<a name="l06760"></a>06760 
<a name="l06761"></a>06761             sub         ecx, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l06762"></a>06762             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l06763"></a>06763             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l06764"></a>06764             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l06765"></a>06765             jmp         BlitTransparent
<a name="l06766"></a>06766 
<a name="l06767"></a>06767 
<a name="l06768"></a>06768 LSTrans1:
<a name="l06769"></a>06769             sub         LSCount, ecx                                          <span class="comment">// skip whole run, continue skipping</span>
<a name="l06770"></a>06770             jmp         LeftSkipLoop
<a name="l06771"></a>06771 
<a name="l06772"></a>06772 
<a name="l06773"></a>06773 BlitLineSetup:                                                    <span class="comment">// Does any actual blitting (trans/non) for the line</span>
<a name="l06774"></a>06774             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l06775"></a>06775             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l06776"></a>06776             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l06777"></a>06777 
<a name="l06778"></a>06778 BlitDispatch:
<a name="l06779"></a>06779 
<a name="l06780"></a>06780             cmp         LSCount, 0                                      <span class="comment">// Check to see if we're done blitting</span>
<a name="l06781"></a>06781             je          RightSkipLoop
<a name="l06782"></a>06782 
<a name="l06783"></a>06783             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l06784"></a>06784             inc         esi
<a name="l06785"></a>06785             or          cl, cl
<a name="l06786"></a>06786             js          BlitTransparent
<a name="l06787"></a>06787 
<a name="l06788"></a>06788 BlitNonTransLoop:                                           <span class="comment">// blit non-transparent pixels</span>
<a name="l06789"></a>06789 
<a name="l06790"></a>06790             cmp         ecx, LSCount
<a name="l06791"></a>06791             jbe         BNTrans1
<a name="l06792"></a>06792 
<a name="l06793"></a>06793             sub         ecx, LSCount
<a name="l06794"></a>06794             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, ecx
<a name="l06795"></a>06795             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, LSCount
<a name="l06796"></a>06796 
<a name="l06797"></a>06797 BNTrans1:
<a name="l06798"></a>06798             sub         LSCount, ecx
<a name="l06799"></a>06799 
<a name="l06800"></a>06800 BlitNTL1:
<a name="l06801"></a>06801             xor         eax, eax
<a name="l06802"></a>06802             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l06803"></a>06803             cmp         al, 1
<a name="l06804"></a>06804             jne         BlitNTL3
<a name="l06805"></a>06805 
<a name="l06806"></a>06806             <span class="comment">// write shadow pixel</span>
<a name="l06807"></a>06807             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, usShadow
<a name="l06808"></a>06808 
<a name="l06809"></a>06809             <span class="comment">// only write if not zero</span>
<a name="l06810"></a>06810             cmp         ax, 0
<a name="l06811"></a>06811             je          BlitNTL2
<a name="l06812"></a>06812 
<a name="l06813"></a>06813             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax
<a name="l06814"></a>06814             jmp         BlitNTL2
<a name="l06815"></a>06815 
<a name="l06816"></a>06816 BlitNTL3:
<a name="l06817"></a>06817             or          al, al
<a name="l06818"></a>06818             jz          BlitNTL4
<a name="l06819"></a>06819 
<a name="l06820"></a>06820             <span class="comment">// write foreground pixel</span>
<a name="l06821"></a>06821             mov         ax, usForeground
<a name="l06822"></a>06822             mov         [edi], ax
<a name="l06823"></a>06823             jmp         BlitNTL2
<a name="l06824"></a>06824 
<a name="l06825"></a>06825 BlitNTL4:
<a name="l06826"></a>06826             cmp         usBackground, 0
<a name="l06827"></a>06827             je          BlitNTL2
<a name="l06828"></a>06828 
<a name="l06829"></a>06829             mov         ax, usBackground
<a name="l06830"></a>06830             mov         [edi], ax
<a name="l06831"></a>06831 
<a name="l06832"></a>06832 BlitNTL2:
<a name="l06833"></a>06833             inc         esi
<a name="l06834"></a>06834             add         edi, 2
<a name="l06835"></a>06835             dec         cl
<a name="l06836"></a>06836             jnz         BlitNTL1
<a name="l06837"></a>06837 
<a name="l06838"></a>06838 <span class="comment">//BlitLineEnd:</span>
<a name="l06839"></a>06839             add         esi, Unblitted
<a name="l06840"></a>06840             jmp         BlitDispatch
<a name="l06841"></a>06841 
<a name="l06842"></a>06842 BlitTransparent:                                                              <span class="comment">// skip transparent pixels</span>
<a name="l06843"></a>06843 
<a name="l06844"></a>06844             and         ecx, 07fH
<a name="l06845"></a>06845             cmp         ecx, LSCount
<a name="l06846"></a>06846             jbe         BTrans1
<a name="l06847"></a>06847 
<a name="l06848"></a>06848             mov         ecx, LSCount
<a name="l06849"></a>06849 
<a name="l06850"></a>06850 BTrans1:
<a name="l06851"></a>06851             sub         LSCount, ecx
<a name="l06852"></a>06852 
<a name="l06853"></a>06853             mov         ax, usBackground
<a name="l06854"></a>06854             or          ax, ax
<a name="l06855"></a>06855             jz          BTrans2
<a name="l06856"></a>06856 
<a name="l06857"></a>06857             rep         stosw
<a name="l06858"></a>06858             jmp         BlitDispatch
<a name="l06859"></a>06859 
<a name="l06860"></a>06860 BTrans2:
<a name="l06861"></a>06861 <span class="comment">//          shl         ecx, 1</span>
<a name="l06862"></a>06862             add   ecx, ecx
<a name="l06863"></a>06863             add         edi, ecx
<a name="l06864"></a>06864             jmp         BlitDispatch
<a name="l06865"></a>06865 
<a name="l06866"></a>06866 
<a name="l06867"></a>06867 RightSkipLoop:                                                                      <span class="comment">// skip along until we hit and end-of-line marker</span>
<a name="l06868"></a>06868 
<a name="l06869"></a>06869 
<a name="l06870"></a>06870 RSLoop1:
<a name="l06871"></a>06871             mov         al, [esi]
<a name="l06872"></a>06872             inc         esi
<a name="l06873"></a>06873             or          al, al
<a name="l06874"></a>06874             jnz         RSLoop1
<a name="l06875"></a>06875 
<a name="l06876"></a>06876             dec         BlitHeight
<a name="l06877"></a>06877             jz          BlitDone
<a name="l06878"></a>06878             add         edi, LineSkip
<a name="l06879"></a>06879 
<a name="l06880"></a>06880             jmp         LeftSkipSetup
<a name="l06881"></a>06881 
<a name="l06882"></a>06882 
<a name="l06883"></a>06883 BlitDone:
<a name="l06884"></a>06884       }
<a name="l06885"></a>06885 
<a name="l06886"></a>06886       <span class="keywordflow">return</span>(TRUE);
<a name="l06887"></a>06887 
<a name="l06888"></a>06888 }
<a name="l06889"></a>06889 
<a name="l06890"></a>06890 
<a name="l06891"></a>06891 
<a name="l06892"></a>06892 
<a name="l06893"></a>06893 
<a name="l06894"></a>06894 <span class="comment">/**********************************************************************************************</span>
<a name="l06895"></a>06895 <span class="comment">      Blt16BPPTo16BPP</span>
<a name="l06896"></a>06896 <span class="comment"></span>
<a name="l06897"></a>06897 <span class="comment">      Copies a rect of 16 bit data from a video buffer to a buffer position of the brush</span>
<a name="l06898"></a>06898 <span class="comment">      in the data area, for later blitting. Used to copy background information for mercs</span>
<a name="l06899"></a>06899 <span class="comment">      etc. to their unblit buffer, for later reblitting. Does NOT clip.</span>
<a name="l06900"></a>06900 <span class="comment"></span>
<a name="l06901"></a>06901 <span class="comment">**********************************************************************************************/</span>
<a name="l06902"></a><a class="code" href="vobject__blitters_8h.html#2926b96655ed8ba950bd0330847110f7">06902</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#2926b96655ed8ba950bd0330847110f7">Blt16BPPTo16BPP</a>(<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pDest, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitch, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pSrc, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiSrcPitch, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iDestXPos, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iDestYPos, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iSrcXPos, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iSrcYPos, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiWidth, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiHeight)
<a name="l06903"></a>06903 {
<a name="l06904"></a>06904 <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pSrcPtr, *pDestPtr;
<a name="l06905"></a>06905 <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiLineSkipDest, uiLineSkipSrc;
<a name="l06906"></a>06906 
<a name="l06907"></a>06907       Assert(pDest!=NULL);
<a name="l06908"></a>06908       Assert(pSrc!=NULL);
<a name="l06909"></a>06909 
<a name="l06910"></a>06910       pSrcPtr=(<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *)((<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pSrc+(iSrcYPos*uiSrcPitch)+(iSrcXPos*2));
<a name="l06911"></a>06911       pDestPtr=(<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *)((<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pDest+(iDestYPos*uiDestPitch)+(iDestXPos*2));
<a name="l06912"></a>06912       uiLineSkipDest=uiDestPitch-(uiWidth*2);
<a name="l06913"></a>06913       uiLineSkipSrc=uiSrcPitch-(uiWidth*2);
<a name="l06914"></a>06914 
<a name="l06915"></a>06915 __asm {
<a name="l06916"></a>06916       <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, pSrcPtr
<a name="l06917"></a>06917       <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, pDestPtr
<a name="l06918"></a>06918       <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, uiHeight
<a name="l06919"></a>06919       cld
<a name="l06920"></a>06920 
<a name="l06921"></a>06921       <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, uiWidth
<a name="l06922"></a>06922       <a class="code" href="structtest.html">test</a>  ecx, 1
<a name="l06923"></a>06923       jz          BlitDwords
<a name="l06924"></a>06924 
<a name="l06925"></a>06925 BlitNewLine:
<a name="l06926"></a>06926 
<a name="l06927"></a>06927       <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, uiWidth
<a name="l06928"></a>06928       shr         ecx, 1
<a name="l06929"></a>06929       movsw
<a name="l06930"></a>06930 
<a name="l06931"></a>06931 <span class="comment">//BlitNL2:</span>
<a name="l06932"></a>06932 
<a name="l06933"></a>06933       rep         movsd
<a name="l06934"></a>06934 
<a name="l06935"></a>06935       add         edi, uiLineSkipDest
<a name="l06936"></a>06936       add         esi, uiLineSkipSrc
<a name="l06937"></a>06937       dec         ebx
<a name="l06938"></a>06938       jnz         BlitNewLine
<a name="l06939"></a>06939 
<a name="l06940"></a>06940       jmp         BlitDone
<a name="l06941"></a>06941 
<a name="l06942"></a>06942 
<a name="l06943"></a>06943 BlitDwords:
<a name="l06944"></a>06944       <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, uiWidth
<a name="l06945"></a>06945       shr         ecx, 1
<a name="l06946"></a>06946       rep         movsd
<a name="l06947"></a>06947 
<a name="l06948"></a>06948       add         edi, uiLineSkipDest
<a name="l06949"></a>06949       add         esi, uiLineSkipSrc
<a name="l06950"></a>06950       dec         ebx
<a name="l06951"></a>06951       jnz         BlitDwords
<a name="l06952"></a>06952 
<a name="l06953"></a>06953 BlitDone:
<a name="l06954"></a>06954 
<a name="l06955"></a>06955       }
<a name="l06956"></a>06956 
<a name="l06957"></a>06957       <span class="keywordflow">return</span>(TRUE);
<a name="l06958"></a>06958 }
<a name="l06959"></a>06959 
<a name="l06960"></a>06960 <span class="comment">/**********************************************************************************************</span>
<a name="l06961"></a>06961 <span class="comment">      Blt16BPPTo16BPPTrans</span>
<a name="l06962"></a>06962 <span class="comment"></span>
<a name="l06963"></a>06963 <span class="comment">      Copies a rect of 16 bit data from a video buffer to a buffer position of the brush</span>
<a name="l06964"></a>06964 <span class="comment">      in the data area, for later blitting. Used to copy background information for mercs</span>
<a name="l06965"></a>06965 <span class="comment">      etc. to their unblit buffer, for later reblitting. Does NOT clip. Transparent color is</span>
<a name="l06966"></a>06966 <span class="comment">      not copied.</span>
<a name="l06967"></a>06967 <span class="comment"></span>
<a name="l06968"></a>06968 <span class="comment">**********************************************************************************************/</span>
<a name="l06969"></a><a class="code" href="vobject__blitters_8h.html#8408590c36321c7b2f3648b8fb5f1ab8">06969</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#8408590c36321c7b2f3648b8fb5f1ab8">Blt16BPPTo16BPPTrans</a>(<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pDest, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitch, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pSrc, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiSrcPitch, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iDestXPos, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iDestYPos, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iSrcXPos, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iSrcYPos, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiWidth, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiHeight, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usTrans)
<a name="l06970"></a>06970 {
<a name="l06971"></a>06971 <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pSrcPtr, *pDestPtr;
<a name="l06972"></a>06972 <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiLineSkipDest, uiLineSkipSrc;
<a name="l06973"></a>06973 
<a name="l06974"></a>06974       Assert(pDest!=NULL);
<a name="l06975"></a>06975       Assert(pSrc!=NULL);
<a name="l06976"></a>06976 
<a name="l06977"></a>06977       pSrcPtr=(<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *)((<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pSrc+(iSrcYPos*uiSrcPitch)+(iSrcXPos*2));
<a name="l06978"></a>06978       pDestPtr=(<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *)((<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pDest+(iDestYPos*uiDestPitch)+(iDestXPos*2));
<a name="l06979"></a>06979       uiLineSkipDest=uiDestPitch-(uiWidth*2);
<a name="l06980"></a>06980       uiLineSkipSrc=uiSrcPitch-(uiWidth*2);
<a name="l06981"></a>06981 
<a name="l06982"></a>06982 __asm {
<a name="l06983"></a>06983       <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, pSrcPtr
<a name="l06984"></a>06984       <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, pDestPtr
<a name="l06985"></a>06985       <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, uiHeight
<a name="l06986"></a>06986       <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         dx, usTrans
<a name="l06987"></a>06987 
<a name="l06988"></a>06988 BlitNewLine:
<a name="l06989"></a>06989       <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, uiWidth
<a name="l06990"></a>06990 
<a name="l06991"></a>06991 Blit2:
<a name="l06992"></a>06992       <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [esi]
<a name="l06993"></a>06993       cmp         ax, dx
<a name="l06994"></a>06994       je          Blit3
<a name="l06995"></a>06995 
<a name="l06996"></a>06996       <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax
<a name="l06997"></a>06997 
<a name="l06998"></a>06998 Blit3:
<a name="l06999"></a>06999       add         esi, 2
<a name="l07000"></a>07000       add         edi, 2
<a name="l07001"></a>07001       dec         ecx
<a name="l07002"></a>07002       jnz         Blit2
<a name="l07003"></a>07003 
<a name="l07004"></a>07004       add         edi, uiLineSkipDest
<a name="l07005"></a>07005       add         esi, uiLineSkipSrc
<a name="l07006"></a>07006       dec         ebx
<a name="l07007"></a>07007       jnz         BlitNewLine
<a name="l07008"></a>07008 
<a name="l07009"></a>07009       }
<a name="l07010"></a>07010 
<a name="l07011"></a>07011       <span class="keywordflow">return</span>(TRUE);
<a name="l07012"></a>07012 }
<a name="l07013"></a>07013 
<a name="l07014"></a>07014 <span class="comment">/**********************************************************************************************</span>
<a name="l07015"></a>07015 <span class="comment">      Blt16BPPTo16BPPMirror</span>
<a name="l07016"></a>07016 <span class="comment"></span>
<a name="l07017"></a>07017 <span class="comment">      Copies a rect of 16 bit data from a video buffer to a buffer position of the brush</span>
<a name="l07018"></a>07018 <span class="comment">      in the data area, for later blitting. Used to copy background information for mercs</span>
<a name="l07019"></a>07019 <span class="comment">      etc. to their unblit buffer, for later reblitting. Does NOT clip.</span>
<a name="l07020"></a>07020 <span class="comment"></span>
<a name="l07021"></a>07021 <span class="comment">**********************************************************************************************/</span>
<a name="l07022"></a><a class="code" href="vobject__blitters_8h.html#06318b144746e339edd25deb4c28bf03">07022</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#06318b144746e339edd25deb4c28bf03">Blt16BPPTo16BPPMirror</a>(<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pDest, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitch, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pSrc, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiSrcPitch, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iDestXPos, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iDestYPos, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iSrcXPos, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iSrcYPos, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiWidth, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiHeight)
<a name="l07023"></a>07023 {
<a name="l07024"></a>07024 <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pSrcPtr, *pDestPtr;
<a name="l07025"></a>07025 <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiLineSkipDest, uiLineSkipSrc;
<a name="l07026"></a>07026 <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> RightSkip, LeftSkip, TopSkip, BottomSkip, BlitLength, BlitHeight;
<a name="l07027"></a>07027 <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iTempX, iTempY, ClipX1, ClipY1, ClipX2, ClipY2;
<a name="l07028"></a>07028 <a class="code" href="structSGPRect.html">SGPRect</a> *clipregion=NULL;
<a name="l07029"></a>07029 
<a name="l07030"></a>07030       Assert(pDest!=NULL);
<a name="l07031"></a>07031       Assert(pSrc!=NULL);
<a name="l07032"></a>07032 
<a name="l07033"></a>07033       <span class="comment">// Add to start position of dest buffer</span>
<a name="l07034"></a>07034       iTempX = iDestXPos;
<a name="l07035"></a>07035       iTempY = iDestYPos;
<a name="l07036"></a>07036 
<a name="l07037"></a>07037       <span class="keywordflow">if</span>(clipregion==NULL)
<a name="l07038"></a>07038       {
<a name="l07039"></a>07039             ClipX1= <a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;   <span class="comment">//0; it was changed, why??? joker//;</span>
<a name="l07040"></a>07040             ClipY1= <a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;    <span class="comment">//0; //;</span>
<a name="l07041"></a>07041             ClipX2= <a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;  <span class="comment">//SCREEN_WIDTH; //;</span>
<a name="l07042"></a>07042             ClipY2= <a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>; <span class="comment">//SCREEN_HEIGHT;  //;</span>
<a name="l07043"></a>07043       }
<a name="l07044"></a>07044       <span class="keywordflow">else</span>
<a name="l07045"></a>07045       {
<a name="l07046"></a>07046             ClipX1=clipregion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l07047"></a>07047             ClipY1=clipregion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l07048"></a>07048             ClipX2=clipregion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l07049"></a>07049             ClipY2=clipregion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l07050"></a>07050       }
<a name="l07051"></a>07051 
<a name="l07052"></a>07052       <span class="comment">// Calculate rows hanging off each side of the screen</span>
<a name="l07053"></a>07053       LeftSkip=__min(ClipX1 - __min(ClipX1, iTempX), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)uiWidth);
<a name="l07054"></a>07054       RightSkip=__min(__max(ClipX2, (iTempX+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)uiWidth)) - ClipX2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)uiWidth);
<a name="l07055"></a>07055       TopSkip=__min(ClipY1 - __min(ClipY1, iTempY), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)uiHeight);
<a name="l07056"></a>07056       BottomSkip=__min(__max(ClipY2, (iTempY+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)uiHeight)) - ClipY2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)uiHeight);
<a name="l07057"></a>07057 
<a name="l07058"></a>07058       iTempX=__max(ClipX1, iDestXPos);
<a name="l07059"></a>07059       iTempY=__max(ClipY1, iDestYPos);
<a name="l07060"></a>07060 
<a name="l07061"></a>07061       <span class="comment">// calculate the remaining rows and columns to blit</span>
<a name="l07062"></a>07062       BlitLength=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)uiWidth-LeftSkip-RightSkip);
<a name="l07063"></a>07063       BlitHeight=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)uiHeight-TopSkip-BottomSkip);
<a name="l07064"></a>07064 
<a name="l07065"></a>07065       <span class="comment">// check if whole thing is clipped</span>
<a name="l07066"></a>07066       <span class="keywordflow">if</span>((LeftSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)uiWidth) || (RightSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)uiWidth))
<a name="l07067"></a>07067             <span class="keywordflow">return</span>(TRUE);
<a name="l07068"></a>07068 
<a name="l07069"></a>07069       <span class="comment">// check if whole thing is clipped</span>
<a name="l07070"></a>07070       <span class="keywordflow">if</span>((TopSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)uiHeight) || (BottomSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)uiHeight))
<a name="l07071"></a>07071             <span class="keywordflow">return</span>(TRUE);
<a name="l07072"></a>07072 
<a name="l07073"></a>07073       pSrcPtr=(<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *)((<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pSrc+(TopSkip*uiSrcPitch)+(RightSkip*2));
<a name="l07074"></a>07074       pDestPtr=(<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *)((<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pDest+(iTempY*uiDestPitch)+(iTempX*2)+((BlitLength-1)*2));
<a name="l07075"></a>07075       uiLineSkipDest=uiDestPitch;<span class="comment">//+((BlitLength-1)*2);</span>
<a name="l07076"></a>07076       uiLineSkipSrc=uiSrcPitch-(BlitLength*2);
<a name="l07077"></a>07077 
<a name="l07078"></a>07078 __asm {
<a name="l07079"></a>07079       <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, pSrcPtr
<a name="l07080"></a>07080       <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, pDestPtr
<a name="l07081"></a>07081       <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, BlitHeight
<a name="l07082"></a>07082 
<a name="l07083"></a>07083 BlitNewLine:
<a name="l07084"></a>07084 
<a name="l07085"></a>07085       <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, BlitLength
<a name="l07086"></a>07086   <span class="comment">//add   edi, ecx</span>
<a name="l07087"></a>07087   <span class="comment">//add   edi, ecx</span>
<a name="l07088"></a>07088 
<a name="l07089"></a>07089 BlitNTL2:
<a name="l07090"></a>07090 
<a name="l07091"></a>07091       <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [esi]
<a name="l07092"></a>07092       <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax
<a name="l07093"></a>07093       inc         esi
<a name="l07094"></a>07094       dec         edi
<a name="l07095"></a>07095       inc         esi
<a name="l07096"></a>07096       dec         edi
<a name="l07097"></a>07097       dec         ecx
<a name="l07098"></a>07098       jnz         BlitNTL2
<a name="l07099"></a>07099 
<a name="l07100"></a>07100       add         edi, BlitLength
<a name="l07101"></a>07101       add         esi, uiLineSkipSrc
<a name="l07102"></a>07102       add         edi, BlitLength
<a name="l07103"></a>07103       add         edi, uiLineSkipDest
<a name="l07104"></a>07104       dec         ebx
<a name="l07105"></a>07105       jnz         BlitNewLine
<a name="l07106"></a>07106 
<a name="l07107"></a>07107       }
<a name="l07108"></a>07108 
<a name="l07109"></a>07109       <span class="keywordflow">return</span>(TRUE);
<a name="l07110"></a>07110 }
<a name="l07111"></a>07111 
<a name="l07112"></a>07112 <span class="comment">/***********************************************************************************************</span>
<a name="l07113"></a>07113 <span class="comment">      Blt8BPPTo8BPP</span>
<a name="l07114"></a>07114 <span class="comment"></span>
<a name="l07115"></a>07115 <span class="comment">      Copies a rect of an 8 bit data from a video buffer to a buffer position of the brush</span>
<a name="l07116"></a>07116 <span class="comment">      in the data area, for later blitting. Used to copy background information for mercs</span>
<a name="l07117"></a>07117 <span class="comment">      etc. to their unblit buffer, for later reblitting. Does NOT clip.</span>
<a name="l07118"></a>07118 <span class="comment"></span>
<a name="l07119"></a>07119 <span class="comment">**********************************************************************************************/</span>
<a name="l07120"></a><a class="code" href="vobject__blitters_8h.html#06883f0ba8f5a8044833fd068127de22">07120</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#06883f0ba8f5a8044833fd068127de22">Blt8BPPTo8BPP</a>(<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *pDest, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitch, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *pSrc, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiSrcPitch, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iDestXPos, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iDestYPos, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iSrcXPos, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iSrcYPos, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiWidth, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiHeight)
<a name="l07121"></a>07121 {
<a name="l07122"></a>07122 <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *pSrcPtr, *pDestPtr;
<a name="l07123"></a>07123 <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiLineSkipDest, uiLineSkipSrc;
<a name="l07124"></a>07124 
<a name="l07125"></a>07125       Assert(pDest!=NULL);
<a name="l07126"></a>07126       Assert(pSrc!=NULL);
<a name="l07127"></a>07127 
<a name="l07128"></a>07128       pSrcPtr=pSrc+(iSrcYPos*uiSrcPitch)+(iSrcXPos);
<a name="l07129"></a>07129       pDestPtr=pDest+(iDestYPos*uiDestPitch)+(iDestXPos);
<a name="l07130"></a>07130       uiLineSkipDest=uiDestPitch-(uiWidth);
<a name="l07131"></a>07131       uiLineSkipSrc=uiSrcPitch-(uiWidth);
<a name="l07132"></a>07132 
<a name="l07133"></a>07133 __asm {
<a name="l07134"></a>07134       <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, pSrcPtr
<a name="l07135"></a>07135       <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, pDestPtr
<a name="l07136"></a>07136       <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, uiHeight
<a name="l07137"></a>07137       cld
<a name="l07138"></a>07138 
<a name="l07139"></a>07139 BlitNewLine:
<a name="l07140"></a>07140       <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, uiWidth
<a name="l07141"></a>07141 
<a name="l07142"></a>07142       clc
<a name="l07143"></a>07143       rcr         ecx, 1
<a name="l07144"></a>07144       jnc         Blit2
<a name="l07145"></a>07145       movsb
<a name="l07146"></a>07146 
<a name="l07147"></a>07147 Blit2:
<a name="l07148"></a>07148       clc
<a name="l07149"></a>07149       rcr         ecx, 1
<a name="l07150"></a>07150       jnc         Blit3
<a name="l07151"></a>07151 
<a name="l07152"></a>07152       movsw
<a name="l07153"></a>07153 
<a name="l07154"></a>07154 Blit3:
<a name="l07155"></a>07155       or          ecx, ecx
<a name="l07156"></a>07156       jz          BlitLineDone
<a name="l07157"></a>07157 
<a name="l07158"></a>07158       rep         movsd
<a name="l07159"></a>07159 
<a name="l07160"></a>07160 BlitLineDone:
<a name="l07161"></a>07161 
<a name="l07162"></a>07162       add         edi, uiLineSkipDest
<a name="l07163"></a>07163       add         esi, uiLineSkipSrc
<a name="l07164"></a>07164       dec         ebx
<a name="l07165"></a>07165       jnz         BlitNewLine
<a name="l07166"></a>07166 
<a name="l07167"></a>07167       }
<a name="l07168"></a>07168 
<a name="l07169"></a>07169       <span class="keywordflow">return</span>(TRUE);
<a name="l07170"></a>07170 }
<a name="l07171"></a>07171 
<a name="l07172"></a>07172 <span class="comment">/**********************************************************************************************</span>
<a name="l07173"></a>07173 <span class="comment"> Blt8BPPDataTo16BPPBufferTransZPixelate</span>
<a name="l07174"></a>07174 <span class="comment"></span>
<a name="l07175"></a>07175 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l07176"></a>07176 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l07177"></a>07177 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on, and the Z value is</span>
<a name="l07178"></a>07178 <span class="comment">      updated to the current value, for any non-transparent pixels. The Z-buffer is 16 bit, and</span>
<a name="l07179"></a>07179 <span class="comment">      must be the same dimensions (including Pitch) as the destination.</span>
<a name="l07180"></a>07180 <span class="comment"></span>
<a name="l07181"></a>07181 <span class="comment">      Blits every second pixel ("pixelates").</span>
<a name="l07182"></a>07182 <span class="comment"></span>
<a name="l07183"></a>07183 <span class="comment">**********************************************************************************************/</span>
<a name="l07184"></a><a class="code" href="vobject__blitters_8h.html#1216fc40deac8e49c4d03f74971fdaee">07184</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#1216fc40deac8e49c4d03f74971fdaee">Blt8BPPDataTo16BPPBufferTransZPixelate</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex )
<a name="l07185"></a>07185 {
<a name="l07186"></a>07186 <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth, uiOffset, LineSkip;
<a name="l07187"></a>07187 <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l07188"></a>07188 <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l07189"></a>07189 <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l07190"></a>07190 <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiLineFlag;
<a name="l07191"></a>07191 <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l07192"></a>07192 
<a name="l07193"></a>07193 
<a name="l07194"></a>07194       <span class="comment">// Assertions</span>
<a name="l07195"></a>07195       Assert( hSrcVObject != NULL );
<a name="l07196"></a>07196       Assert( pBuffer != NULL );
<a name="l07197"></a>07197 
<a name="l07198"></a>07198       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l07199"></a>07199       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l07200"></a>07200       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l07201"></a>07201       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l07202"></a>07202       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l07203"></a>07203 
<a name="l07204"></a>07204       <span class="comment">// Add to start position of dest buffer</span>
<a name="l07205"></a>07205       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l07206"></a>07206       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l07207"></a>07207 
<a name="l07208"></a>07208       <span class="comment">// Validations</span>
<a name="l07209"></a>07209       CHECKF( iTempX &gt;= 0 );
<a name="l07210"></a>07210       CHECKF( iTempY &gt;= 0 );
<a name="l07211"></a>07211 
<a name="l07212"></a>07212 
<a name="l07213"></a>07213       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l07214"></a>07214       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l07215"></a>07215       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l07216"></a>07216       p16BPPPalette = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#930609ad8d5cdbb05449df70bd83cfcd">pShadeCurrent</a>;
<a name="l07217"></a>07217       LineSkip=(uiDestPitchBYTES-(usWidth*2));
<a name="l07218"></a>07218       uiLineFlag=(iTempY&amp;1);
<a name="l07219"></a>07219 
<a name="l07220"></a>07220       __asm {
<a name="l07221"></a>07221 
<a name="l07222"></a>07222             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l07223"></a>07223             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l07224"></a>07224             xor         eax, eax
<a name="l07225"></a>07225             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l07226"></a>07226             xor         ecx, ecx
<a name="l07227"></a>07227             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, p16BPPPalette
<a name="l07228"></a>07228 
<a name="l07229"></a>07229 BlitDispatch:
<a name="l07230"></a>07230 
<a name="l07231"></a>07231             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l07232"></a>07232             inc         esi
<a name="l07233"></a>07233             or          cl, cl
<a name="l07234"></a>07234             js          BlitTransparent
<a name="l07235"></a>07235             jz          BlitDoneLine
<a name="l07236"></a>07236 
<a name="l07237"></a>07237 <span class="comment">//BlitNonTransLoop:</span>
<a name="l07238"></a>07238 
<a name="l07239"></a>07239 BlitNTL4:
<a name="l07240"></a>07240 
<a name="l07241"></a>07241             <a class="code" href="structtest.html">test</a>  uiLineFlag, 1
<a name="l07242"></a>07242             jz          <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>
<a name="l07243"></a>07243 
<a name="l07244"></a>07244             <a class="code" href="structtest.html">test</a>  edi, 2
<a name="l07245"></a>07245             jz          BlitNTL5
<a name="l07246"></a>07246             jmp         <a class="code" href="vobject__blitters_8cpp.html#d660d2ba340c8ef5d2d80c6365ad838f">BlitNTL7</a>
<a name="l07247"></a>07247 
<a name="l07248"></a>07248 <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>:
<a name="l07249"></a>07249             <a class="code" href="structtest.html">test</a>  edi, 2
<a name="l07250"></a>07250             jnz         BlitNTL5
<a name="l07251"></a>07251 
<a name="l07252"></a>07252 <a class="code" href="vobject__blitters_8cpp.html#d660d2ba340c8ef5d2d80c6365ad838f">BlitNTL7</a>:
<a name="l07253"></a>07253             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l07254"></a>07254             cmp         ax, usZValue
<a name="l07255"></a>07255             ja          BlitNTL5
<a name="l07256"></a>07256 
<a name="l07257"></a>07257             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, usZValue
<a name="l07258"></a>07258             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [ebx], ax
<a name="l07259"></a>07259 
<a name="l07260"></a>07260             xor         eax, eax
<a name="l07261"></a>07261             mov         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l07262"></a>07262             mov         ax, [edx+eax*2]
<a name="l07263"></a>07263             mov         [<a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>], ax
<a name="l07264"></a>07264 
<a name="l07265"></a>07265 BlitNTL5:
<a name="l07266"></a>07266             inc         esi
<a name="l07267"></a>07267             add         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, 2
<a name="l07268"></a>07268             add         ebx, 2
<a name="l07269"></a>07269             dec         cl
<a name="l07270"></a>07270             jnz         BlitNTL4
<a name="l07271"></a>07271 
<a name="l07272"></a>07272             jmp         BlitDispatch
<a name="l07273"></a>07273 
<a name="l07274"></a>07274 
<a name="l07275"></a>07275 BlitTransparent:
<a name="l07276"></a>07276 
<a name="l07277"></a>07277             and         ecx, 07fH
<a name="l07278"></a>07278 <span class="comment">//          shl         ecx, 1</span>
<a name="l07279"></a>07279             add   ecx, ecx
<a name="l07280"></a>07280             add         edi, ecx
<a name="l07281"></a>07281             add         ebx, ecx
<a name="l07282"></a>07282             jmp         BlitDispatch
<a name="l07283"></a>07283 
<a name="l07284"></a>07284 
<a name="l07285"></a>07285 BlitDoneLine:
<a name="l07286"></a>07286 
<a name="l07287"></a>07287             dec         usHeight
<a name="l07288"></a>07288             jz          BlitDone
<a name="l07289"></a>07289             add         edi, LineSkip
<a name="l07290"></a>07290             add         ebx, LineSkip
<a name="l07291"></a>07291             xor         uiLineFlag, 1
<a name="l07292"></a>07292             jmp         BlitDispatch
<a name="l07293"></a>07293 
<a name="l07294"></a>07294 
<a name="l07295"></a>07295 BlitDone:
<a name="l07296"></a>07296       }
<a name="l07297"></a>07297 
<a name="l07298"></a>07298       <span class="keywordflow">return</span>(TRUE);
<a name="l07299"></a>07299 
<a name="l07300"></a>07300 }
<a name="l07301"></a>07301 
<a name="l07302"></a>07302 
<a name="l07303"></a>07303 <span class="comment">/**********************************************************************************************</span>
<a name="l07304"></a>07304 <span class="comment"> Blt8BPPDataTo16BPPBufferTransZPixelateObscured</span>
<a name="l07305"></a>07305 <span class="comment"></span>
<a name="l07306"></a>07306 <span class="comment">      // OK LIKE NORMAL PIXELATE BUT ONLY PIXELATES STUFF BELOW Z level</span>
<a name="l07307"></a>07307 <span class="comment"></span>
<a name="l07308"></a>07308 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l07309"></a>07309 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l07310"></a>07310 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on, and the Z value is</span>
<a name="l07311"></a>07311 <span class="comment">      updated to the current value, for any non-transparent pixels. The Z-buffer is 16 bit, and</span>
<a name="l07312"></a>07312 <span class="comment">      must be the same dimensions (including Pitch) as the destination.</span>
<a name="l07313"></a>07313 <span class="comment"></span>
<a name="l07314"></a>07314 <span class="comment">      Blits every second pixel ("pixelates").</span>
<a name="l07315"></a>07315 <span class="comment"></span>
<a name="l07316"></a>07316 <span class="comment">**********************************************************************************************/</span>
<a name="l07317"></a><a class="code" href="vobject__blitters_8h.html#8aea3cf4b1283a8fb2d453032ca17634">07317</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#8aea3cf4b1283a8fb2d453032ca17634">Blt8BPPDataTo16BPPBufferTransZPixelateObscured</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex )
<a name="l07318"></a>07318 {
<a name="l07319"></a>07319 <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth, uiOffset, LineSkip;
<a name="l07320"></a>07320 <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l07321"></a>07321 <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l07322"></a>07322 <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l07323"></a>07323 <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiLineFlag;
<a name="l07324"></a>07324 <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l07325"></a>07325 
<a name="l07326"></a>07326 
<a name="l07327"></a>07327       <span class="comment">// Assertions</span>
<a name="l07328"></a>07328       Assert( hSrcVObject != NULL );
<a name="l07329"></a>07329       Assert( pBuffer != NULL );
<a name="l07330"></a>07330 
<a name="l07331"></a>07331       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l07332"></a>07332       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l07333"></a>07333       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l07334"></a>07334       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l07335"></a>07335       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l07336"></a>07336 
<a name="l07337"></a>07337       <span class="comment">// Add to start position of dest buffer</span>
<a name="l07338"></a>07338       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l07339"></a>07339       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l07340"></a>07340 
<a name="l07341"></a>07341       <span class="comment">// Validations</span>
<a name="l07342"></a>07342       CHECKF( iTempX &gt;= 0 );
<a name="l07343"></a>07343       CHECKF( iTempY &gt;= 0 );
<a name="l07344"></a>07344 
<a name="l07345"></a>07345 
<a name="l07346"></a>07346       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l07347"></a>07347       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l07348"></a>07348       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l07349"></a>07349       p16BPPPalette = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#930609ad8d5cdbb05449df70bd83cfcd">pShadeCurrent</a>;
<a name="l07350"></a>07350       LineSkip=(uiDestPitchBYTES-(usWidth*2));
<a name="l07351"></a>07351       uiLineFlag=(iTempY&amp;1);
<a name="l07352"></a>07352 
<a name="l07353"></a>07353       __asm {
<a name="l07354"></a>07354 
<a name="l07355"></a>07355             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l07356"></a>07356             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l07357"></a>07357             xor         eax, eax
<a name="l07358"></a>07358             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l07359"></a>07359             xor         ecx, ecx
<a name="l07360"></a>07360             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, p16BPPPalette
<a name="l07361"></a>07361 
<a name="l07362"></a>07362 BlitDispatch:
<a name="l07363"></a>07363 
<a name="l07364"></a>07364             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l07365"></a>07365             inc         esi
<a name="l07366"></a>07366             or          cl, cl
<a name="l07367"></a>07367             js          BlitTransparent
<a name="l07368"></a>07368             jz          BlitDoneLine
<a name="l07369"></a>07369 
<a name="l07370"></a>07370 <span class="comment">//BlitNonTransLoop:</span>
<a name="l07371"></a>07371 
<a name="l07372"></a>07372 BlitNTL4:
<a name="l07373"></a>07373 
<a name="l07374"></a>07374             <span class="comment">// TEST FOR Z FIRST!</span>
<a name="l07375"></a>07375             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l07376"></a>07376             cmp         ax, usZValue
<a name="l07377"></a>07377             jae         <a class="code" href="vobject__blitters_8cpp.html#abf905a085ab39598c9c71ca8e8a0a0e">BlitNTL8</a>
<a name="l07378"></a>07378 
<a name="l07379"></a>07379             <span class="comment">// Write it NOW!</span>
<a name="l07380"></a>07380             jmp         <a class="code" href="vobject__blitters_8cpp.html#d660d2ba340c8ef5d2d80c6365ad838f">BlitNTL7</a>
<a name="l07381"></a>07381 
<a name="l07382"></a>07382 <a class="code" href="vobject__blitters_8cpp.html#abf905a085ab39598c9c71ca8e8a0a0e">BlitNTL8</a>:
<a name="l07383"></a>07383 
<a name="l07384"></a>07384             <a class="code" href="structtest.html">test</a>  uiLineFlag, 1
<a name="l07385"></a>07385             jz          <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>
<a name="l07386"></a>07386 
<a name="l07387"></a>07387             <a class="code" href="structtest.html">test</a>  edi, 2
<a name="l07388"></a>07388             jz          BlitNTL5
<a name="l07389"></a>07389             jmp         <a class="code" href="vobject__blitters_8cpp.html#0e7ffd1e4d81460c5ee051765cc57418">BlitNTL9</a>
<a name="l07390"></a>07390 
<a name="l07391"></a>07391 <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>:
<a name="l07392"></a>07392             <a class="code" href="structtest.html">test</a>  edi, 2
<a name="l07393"></a>07393             jnz         BlitNTL5
<a name="l07394"></a>07394 
<a name="l07395"></a>07395 <a class="code" href="vobject__blitters_8cpp.html#d660d2ba340c8ef5d2d80c6365ad838f">BlitNTL7</a>:
<a name="l07396"></a>07396 
<a name="l07397"></a>07397             <span class="comment">// Write normal z value</span>
<a name="l07398"></a>07398             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, usZValue
<a name="l07399"></a>07399             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [ebx], ax
<a name="l07400"></a>07400             <span class="comment">//jmp   BlitNTL10</span>
<a name="l07401"></a>07401 
<a name="l07402"></a>07402 <a class="code" href="vobject__blitters_8cpp.html#0e7ffd1e4d81460c5ee051765cc57418">BlitNTL9</a>:
<a name="l07403"></a>07403 
<a name="l07404"></a>07404             <span class="comment">// Write no z</span>
<a name="l07405"></a>07405             <span class="comment">//mov       ax, 32767</span>
<a name="l07406"></a>07406             <span class="comment">//mov       [ebx], ax</span>
<a name="l07407"></a>07407 
<a name="l07408"></a>07408 <span class="comment">//BlitNTL10:</span>
<a name="l07409"></a>07409 
<a name="l07410"></a>07410             xor         eax, eax
<a name="l07411"></a>07411             mov         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l07412"></a>07412             mov         ax, [edx+eax*2]
<a name="l07413"></a>07413             mov         [<a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>], ax
<a name="l07414"></a>07414 
<a name="l07415"></a>07415 BlitNTL5:
<a name="l07416"></a>07416             inc         esi
<a name="l07417"></a>07417             add         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, 2
<a name="l07418"></a>07418             add         ebx, 2
<a name="l07419"></a>07419             dec         cl
<a name="l07420"></a>07420             jnz         BlitNTL4
<a name="l07421"></a>07421 
<a name="l07422"></a>07422             jmp         BlitDispatch
<a name="l07423"></a>07423 
<a name="l07424"></a>07424 
<a name="l07425"></a>07425 BlitTransparent:
<a name="l07426"></a>07426 
<a name="l07427"></a>07427             and         ecx, 07fH
<a name="l07428"></a>07428 <span class="comment">//          shl         ecx, 1</span>
<a name="l07429"></a>07429             add   ecx, ecx
<a name="l07430"></a>07430             add         edi, ecx
<a name="l07431"></a>07431             add         ebx, ecx
<a name="l07432"></a>07432             jmp         BlitDispatch
<a name="l07433"></a>07433 
<a name="l07434"></a>07434 
<a name="l07435"></a>07435 BlitDoneLine:
<a name="l07436"></a>07436 
<a name="l07437"></a>07437             dec         usHeight
<a name="l07438"></a>07438             jz          BlitDone
<a name="l07439"></a>07439             add         edi, LineSkip
<a name="l07440"></a>07440             add         ebx, LineSkip
<a name="l07441"></a>07441             xor         uiLineFlag, 1
<a name="l07442"></a>07442             jmp         BlitDispatch
<a name="l07443"></a>07443 
<a name="l07444"></a>07444 
<a name="l07445"></a>07445 BlitDone:
<a name="l07446"></a>07446       }
<a name="l07447"></a>07447 
<a name="l07448"></a>07448       <span class="keywordflow">return</span>(TRUE);
<a name="l07449"></a>07449 
<a name="l07450"></a>07450 }
<a name="l07451"></a>07451 
<a name="l07452"></a>07452 
<a name="l07453"></a>07453 <span class="comment">/**********************************************************************************************</span>
<a name="l07454"></a>07454 <span class="comment"> Blt8BPPDataTo16BPPBufferTransZClipPixelate</span>
<a name="l07455"></a>07455 <span class="comment"></span>
<a name="l07456"></a>07456 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l07457"></a>07457 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l07458"></a>07458 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on, and the Z value is</span>
<a name="l07459"></a>07459 <span class="comment">      updated to the current value, for any non-transparent pixels. The Z-buffer is 16 bit, and</span>
<a name="l07460"></a>07460 <span class="comment">      must be the same dimensions (including Pitch) as the destination.</span>
<a name="l07461"></a>07461 <span class="comment"></span>
<a name="l07462"></a>07462 <span class="comment">      Blits every second pixel ("pixelates").</span>
<a name="l07463"></a>07463 <span class="comment"></span>
<a name="l07464"></a>07464 <span class="comment">**********************************************************************************************/</span>
<a name="l07465"></a><a class="code" href="vobject__blitters_8h.html#40ec5f2c0b5ad70926f1ae928b12745b">07465</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#40ec5f2c0b5ad70926f1ae928b12745b">Blt8BPPDataTo16BPPBufferTransZClipPixelate</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="structSGPRect.html">SGPRect</a> *clipregion)
<a name="l07466"></a>07466 {
<a name="l07467"></a>07467 <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l07468"></a>07468 <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset, uiLineFlag;
<a name="l07469"></a>07469 <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth, Unblitted;
<a name="l07470"></a>07470 <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l07471"></a>07471 <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l07472"></a>07472 <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l07473"></a>07473 <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY, LeftSkip, RightSkip, TopSkip, BottomSkip, BlitLength, BlitHeight, LSCount;
<a name="l07474"></a>07474 <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  ClipX1, ClipY1, ClipX2, ClipY2;
<a name="l07475"></a>07475 
<a name="l07476"></a>07476       <span class="comment">// Assertions</span>
<a name="l07477"></a>07477       Assert( hSrcVObject != NULL );
<a name="l07478"></a>07478       Assert( pBuffer != NULL );
<a name="l07479"></a>07479 
<a name="l07480"></a>07480       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l07481"></a>07481       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l07482"></a>07482       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l07483"></a>07483       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l07484"></a>07484       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l07485"></a>07485 
<a name="l07486"></a>07486       <span class="comment">// Add to start position of dest buffer</span>
<a name="l07487"></a>07487       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l07488"></a>07488       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l07489"></a>07489 
<a name="l07490"></a>07490       <span class="keywordflow">if</span>(clipregion==NULL)
<a name="l07491"></a>07491       {
<a name="l07492"></a>07492             ClipX1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l07493"></a>07493             ClipY1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l07494"></a>07494             ClipX2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l07495"></a>07495             ClipY2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l07496"></a>07496       }
<a name="l07497"></a>07497       <span class="keywordflow">else</span>
<a name="l07498"></a>07498       {
<a name="l07499"></a>07499             ClipX1=clipregion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l07500"></a>07500             ClipY1=clipregion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l07501"></a>07501             ClipX2=clipregion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l07502"></a>07502             ClipY2=clipregion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l07503"></a>07503       }
<a name="l07504"></a>07504 
<a name="l07505"></a>07505       <span class="comment">// Calculate rows hanging off each side of the screen</span>
<a name="l07506"></a>07506       LeftSkip=__min(ClipX1 - min(ClipX1, iTempX), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l07507"></a>07507       RightSkip=__min(max(ClipX2, (iTempX+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth)) - ClipX2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l07508"></a>07508       TopSkip=__min(ClipY1 - __min(ClipY1, iTempY), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l07509"></a>07509       BottomSkip=__min(__max(ClipY2, (iTempY+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight)) - ClipY2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l07510"></a>07510 
<a name="l07511"></a>07511       <span class="comment">// calculate the remaining rows and columns to blit</span>
<a name="l07512"></a>07512       BlitLength=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth-LeftSkip-RightSkip);
<a name="l07513"></a>07513       BlitHeight=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight-TopSkip-BottomSkip);
<a name="l07514"></a>07514 
<a name="l07515"></a>07515       <span class="comment">// check if whole thing is clipped</span>
<a name="l07516"></a>07516       <span class="keywordflow">if</span>((LeftSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth) || (RightSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth))
<a name="l07517"></a>07517             <span class="keywordflow">return</span>(TRUE);
<a name="l07518"></a>07518 
<a name="l07519"></a>07519       <span class="comment">// check if whole thing is clipped</span>
<a name="l07520"></a>07520       <span class="keywordflow">if</span>((TopSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight) || (BottomSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight))
<a name="l07521"></a>07521             <span class="keywordflow">return</span>(TRUE);
<a name="l07522"></a>07522 
<a name="l07523"></a>07523       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l07524"></a>07524       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l07525"></a>07525       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l07526"></a>07526       p16BPPPalette = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#930609ad8d5cdbb05449df70bd83cfcd">pShadeCurrent</a>;
<a name="l07527"></a>07527       LineSkip=(uiDestPitchBYTES-(BlitLength*2));
<a name="l07528"></a>07528       uiLineFlag=(iTempY&amp;1);
<a name="l07529"></a>07529 
<a name="l07530"></a>07530       __asm {
<a name="l07531"></a>07531 
<a name="l07532"></a>07532             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l07533"></a>07533             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l07534"></a>07534             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, p16BPPPalette
<a name="l07535"></a>07535             xor         eax, eax
<a name="l07536"></a>07536             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l07537"></a>07537             xor         ecx, ecx
<a name="l07538"></a>07538 
<a name="l07539"></a>07539             cmp         TopSkip, 0                                      <span class="comment">// check for nothing clipped on top</span>
<a name="l07540"></a>07540             je          LeftSkipSetup
<a name="l07541"></a>07541 
<a name="l07542"></a>07542 TopSkipLoop:                                                            <span class="comment">// Skips the number of lines clipped at the top</span>
<a name="l07543"></a>07543 
<a name="l07544"></a>07544             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l07545"></a>07545             inc         esi
<a name="l07546"></a>07546             or          cl, cl
<a name="l07547"></a>07547             js          TopSkipLoop
<a name="l07548"></a>07548             jz          TSEndLine
<a name="l07549"></a>07549 
<a name="l07550"></a>07550             add         esi, ecx
<a name="l07551"></a>07551             jmp         TopSkipLoop
<a name="l07552"></a>07552 
<a name="l07553"></a>07553 TSEndLine:
<a name="l07554"></a>07554             dec         TopSkip
<a name="l07555"></a>07555             jnz         TopSkipLoop
<a name="l07556"></a>07556 
<a name="l07557"></a>07557 LeftSkipSetup:
<a name="l07558"></a>07558 
<a name="l07559"></a>07559             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l07560"></a>07560             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, LeftSkip
<a name="l07561"></a>07561             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l07562"></a>07562             or          eax, eax
<a name="l07563"></a>07563             jz          BlitLineSetup
<a name="l07564"></a>07564 
<a name="l07565"></a>07565 LeftSkipLoop:
<a name="l07566"></a>07566 
<a name="l07567"></a>07567             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l07568"></a>07568             inc         esi
<a name="l07569"></a>07569 
<a name="l07570"></a>07570             or          cl, cl
<a name="l07571"></a>07571             js          LSTrans
<a name="l07572"></a>07572 
<a name="l07573"></a>07573             cmp         ecx, LSCount
<a name="l07574"></a>07574             je          LSSkip2                                               <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l07575"></a>07575             jb          LSSkip1                                               <span class="comment">// if less, skip whole thing</span>
<a name="l07576"></a>07576 
<a name="l07577"></a>07577             add         esi, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l07578"></a>07578             sub         ecx, LSCount
<a name="l07579"></a>07579             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l07580"></a>07580             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l07581"></a>07581             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l07582"></a>07582             jmp         BlitNonTransLoop
<a name="l07583"></a>07583 
<a name="l07584"></a>07584 LSSkip2:
<a name="l07585"></a>07585             add         esi, ecx                                        <span class="comment">// skip whole run, and start blit with new run</span>
<a name="l07586"></a>07586             jmp         BlitLineSetup
<a name="l07587"></a>07587 
<a name="l07588"></a>07588 
<a name="l07589"></a>07589 LSSkip1:
<a name="l07590"></a>07590             add         esi, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l07591"></a>07591             sub         LSCount, ecx
<a name="l07592"></a>07592             jmp         LeftSkipLoop
<a name="l07593"></a>07593 
<a name="l07594"></a>07594 
<a name="l07595"></a>07595 LSTrans:
<a name="l07596"></a>07596             and         ecx, 07fH
<a name="l07597"></a>07597             cmp         ecx, LSCount
<a name="l07598"></a>07598             je          BlitLineSetup                             <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l07599"></a>07599             jb          LSTrans1                                        <span class="comment">// if less, skip whole thing</span>
<a name="l07600"></a>07600 
<a name="l07601"></a>07601             sub         ecx, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l07602"></a>07602             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l07603"></a>07603             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l07604"></a>07604             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l07605"></a>07605             jmp         BlitTransparent
<a name="l07606"></a>07606 
<a name="l07607"></a>07607 
<a name="l07608"></a>07608 LSTrans1:
<a name="l07609"></a>07609             sub         LSCount, ecx                                          <span class="comment">// skip whole run, continue skipping</span>
<a name="l07610"></a>07610             jmp         LeftSkipLoop
<a name="l07611"></a>07611 
<a name="l07612"></a>07612 
<a name="l07613"></a>07613 BlitLineSetup:                                                    <span class="comment">// Does any actual blitting (trans/non) for the line</span>
<a name="l07614"></a>07614             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l07615"></a>07615             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l07616"></a>07616             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l07617"></a>07617 
<a name="l07618"></a>07618 BlitDispatch:
<a name="l07619"></a>07619 
<a name="l07620"></a>07620             cmp         LSCount, 0                                      <span class="comment">// Check to see if we're done blitting</span>
<a name="l07621"></a>07621             je          RightSkipLoop
<a name="l07622"></a>07622 
<a name="l07623"></a>07623             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l07624"></a>07624             inc         esi
<a name="l07625"></a>07625             or          cl, cl
<a name="l07626"></a>07626             js          BlitTransparent
<a name="l07627"></a>07627 
<a name="l07628"></a>07628 BlitNonTransLoop:                                           <span class="comment">// blit non-transparent pixels</span>
<a name="l07629"></a>07629 
<a name="l07630"></a>07630             cmp         ecx, LSCount
<a name="l07631"></a>07631             jbe         BNTrans1
<a name="l07632"></a>07632 
<a name="l07633"></a>07633             sub         ecx, LSCount
<a name="l07634"></a>07634             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, ecx
<a name="l07635"></a>07635             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, LSCount
<a name="l07636"></a>07636 
<a name="l07637"></a>07637 BNTrans1:
<a name="l07638"></a>07638             sub         LSCount, ecx
<a name="l07639"></a>07639 
<a name="l07640"></a>07640 BlitNTL1:
<a name="l07641"></a>07641 
<a name="l07642"></a>07642             <a class="code" href="structtest.html">test</a>  uiLineFlag, 1
<a name="l07643"></a>07643             jz          <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>
<a name="l07644"></a>07644 
<a name="l07645"></a>07645             <a class="code" href="structtest.html">test</a>  edi, 2
<a name="l07646"></a>07646             jz          BlitNTL2
<a name="l07647"></a>07647             jmp         <a class="code" href="vobject__blitters_8cpp.html#d660d2ba340c8ef5d2d80c6365ad838f">BlitNTL7</a>
<a name="l07648"></a>07648 
<a name="l07649"></a>07649 <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>:
<a name="l07650"></a>07650             <a class="code" href="structtest.html">test</a>  edi, 2
<a name="l07651"></a>07651             jnz         BlitNTL2
<a name="l07652"></a>07652 
<a name="l07653"></a>07653 <a class="code" href="vobject__blitters_8cpp.html#d660d2ba340c8ef5d2d80c6365ad838f">BlitNTL7</a>:
<a name="l07654"></a>07654             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l07655"></a>07655             cmp         ax, usZValue
<a name="l07656"></a>07656             ja          BlitNTL2
<a name="l07657"></a>07657 
<a name="l07658"></a>07658             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, usZValue
<a name="l07659"></a>07659             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [ebx], ax
<a name="l07660"></a>07660 
<a name="l07661"></a>07661             xor         eax, eax
<a name="l07662"></a>07662 
<a name="l07663"></a>07663             mov         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l07664"></a>07664             mov         ax, [edx+eax*2]
<a name="l07665"></a>07665             mov         [<a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>], ax
<a name="l07666"></a>07666 
<a name="l07667"></a>07667 BlitNTL2:
<a name="l07668"></a>07668             inc         esi
<a name="l07669"></a>07669             add         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, 2
<a name="l07670"></a>07670             add         ebx, 2
<a name="l07671"></a>07671             dec         cl
<a name="l07672"></a>07672             jnz         BlitNTL1
<a name="l07673"></a>07673 
<a name="l07674"></a>07674 <span class="comment">//BlitLineEnd:</span>
<a name="l07675"></a>07675             add         esi, Unblitted
<a name="l07676"></a>07676             jmp         BlitDispatch
<a name="l07677"></a>07677 
<a name="l07678"></a>07678 BlitTransparent:                                                              <span class="comment">// skip transparent pixels</span>
<a name="l07679"></a>07679 
<a name="l07680"></a>07680             and         ecx, 07fH
<a name="l07681"></a>07681             cmp         ecx, LSCount
<a name="l07682"></a>07682             jbe         BTrans1
<a name="l07683"></a>07683 
<a name="l07684"></a>07684             mov         ecx, LSCount
<a name="l07685"></a>07685 
<a name="l07686"></a>07686 BTrans1:
<a name="l07687"></a>07687 
<a name="l07688"></a>07688             sub         LSCount, ecx
<a name="l07689"></a>07689 <span class="comment">//          shl         ecx, 1</span>
<a name="l07690"></a>07690             add   ecx, ecx
<a name="l07691"></a>07691             add         edi, ecx
<a name="l07692"></a>07692             add         ebx, ecx
<a name="l07693"></a>07693             jmp         BlitDispatch
<a name="l07694"></a>07694 
<a name="l07695"></a>07695 
<a name="l07696"></a>07696 RightSkipLoop:                                                                      <span class="comment">// skip along until we hit and end-of-line marker</span>
<a name="l07697"></a>07697 
<a name="l07698"></a>07698 
<a name="l07699"></a>07699 RSLoop1:
<a name="l07700"></a>07700             mov         al, [esi]
<a name="l07701"></a>07701             inc         esi
<a name="l07702"></a>07702             or          al, al
<a name="l07703"></a>07703             jnz         RSLoop1
<a name="l07704"></a>07704 
<a name="l07705"></a>07705             xor         uiLineFlag, 1
<a name="l07706"></a>07706             dec         BlitHeight
<a name="l07707"></a>07707             jz          BlitDone
<a name="l07708"></a>07708             add         edi, LineSkip
<a name="l07709"></a>07709             add         ebx, LineSkip
<a name="l07710"></a>07710 
<a name="l07711"></a>07711             jmp         LeftSkipSetup
<a name="l07712"></a>07712 
<a name="l07713"></a>07713 
<a name="l07714"></a>07714 BlitDone:
<a name="l07715"></a>07715       }
<a name="l07716"></a>07716 
<a name="l07717"></a>07717       <span class="keywordflow">return</span>(TRUE);
<a name="l07718"></a>07718 
<a name="l07719"></a>07719 }
<a name="l07720"></a>07720 
<a name="l07721"></a>07721 <span class="comment">/**********************************************************************************************</span>
<a name="l07722"></a>07722 <span class="comment"> Blt8BPPDataTo16BPPBufferTransZNBPixelate</span>
<a name="l07723"></a>07723 <span class="comment"></span>
<a name="l07724"></a>07724 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l07725"></a>07725 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l07726"></a>07726 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on, and the Z value is</span>
<a name="l07727"></a>07727 <span class="comment">      NOT updated to the current value,   for any non-transparent pixels. The Z-buffer is 16 bit, and</span>
<a name="l07728"></a>07728 <span class="comment">      must be the same dimensions (including Pitch) as the destination.</span>
<a name="l07729"></a>07729 <span class="comment"></span>
<a name="l07730"></a>07730 <span class="comment">      Blits every second pixel ("pixelates").</span>
<a name="l07731"></a>07731 <span class="comment"></span>
<a name="l07732"></a>07732 <span class="comment">**********************************************************************************************/</span>
<a name="l07733"></a><a class="code" href="vobject__blitters_8h.html#ff6db6e60ab139a928f17a332562782e">07733</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#ff6db6e60ab139a928f17a332562782e">Blt8BPPDataTo16BPPBufferTransZNBPixelate</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex )
<a name="l07734"></a>07734 {
<a name="l07735"></a>07735 <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth, uiOffset, LineSkip;
<a name="l07736"></a>07736 <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l07737"></a>07737 <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l07738"></a>07738 <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l07739"></a>07739 <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiLineFlag;
<a name="l07740"></a>07740 <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l07741"></a>07741 
<a name="l07742"></a>07742 
<a name="l07743"></a>07743       <span class="comment">// Assertions</span>
<a name="l07744"></a>07744       Assert( hSrcVObject != NULL );
<a name="l07745"></a>07745       Assert( pBuffer != NULL );
<a name="l07746"></a>07746 
<a name="l07747"></a>07747       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l07748"></a>07748       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l07749"></a>07749       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l07750"></a>07750       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l07751"></a>07751       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l07752"></a>07752 
<a name="l07753"></a>07753       <span class="comment">// Add to start position of dest buffer</span>
<a name="l07754"></a>07754       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l07755"></a>07755       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l07756"></a>07756 
<a name="l07757"></a>07757       <span class="comment">// Validations</span>
<a name="l07758"></a>07758       CHECKF( iTempX &gt;= 0 );
<a name="l07759"></a>07759       CHECKF( iTempY &gt;= 0 );
<a name="l07760"></a>07760 
<a name="l07761"></a>07761 
<a name="l07762"></a>07762       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l07763"></a>07763       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l07764"></a>07764       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l07765"></a>07765       p16BPPPalette = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#930609ad8d5cdbb05449df70bd83cfcd">pShadeCurrent</a>;
<a name="l07766"></a>07766       LineSkip=(uiDestPitchBYTES-(usWidth*2));
<a name="l07767"></a>07767       uiLineFlag=(iTempY&amp;1);
<a name="l07768"></a>07768 
<a name="l07769"></a>07769       __asm {
<a name="l07770"></a>07770 
<a name="l07771"></a>07771             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l07772"></a>07772             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l07773"></a>07773             xor         eax, eax
<a name="l07774"></a>07774             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l07775"></a>07775             xor         ecx, ecx
<a name="l07776"></a>07776             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, p16BPPPalette
<a name="l07777"></a>07777 
<a name="l07778"></a>07778 BlitDispatch:
<a name="l07779"></a>07779 
<a name="l07780"></a>07780             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l07781"></a>07781             inc         esi
<a name="l07782"></a>07782             or          cl, cl
<a name="l07783"></a>07783             js          BlitTransparent
<a name="l07784"></a>07784             jz          BlitDoneLine
<a name="l07785"></a>07785 
<a name="l07786"></a>07786 <span class="comment">//BlitNonTransLoop:</span>
<a name="l07787"></a>07787 
<a name="l07788"></a>07788 BlitNTL4:
<a name="l07789"></a>07789 
<a name="l07790"></a>07790             <a class="code" href="structtest.html">test</a>  uiLineFlag, 1
<a name="l07791"></a>07791             jz          <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>
<a name="l07792"></a>07792 
<a name="l07793"></a>07793             <a class="code" href="structtest.html">test</a>  edi, 2
<a name="l07794"></a>07794             jz          BlitNTL5
<a name="l07795"></a>07795             jmp         <a class="code" href="vobject__blitters_8cpp.html#d660d2ba340c8ef5d2d80c6365ad838f">BlitNTL7</a>
<a name="l07796"></a>07796 
<a name="l07797"></a>07797 <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>:
<a name="l07798"></a>07798             <a class="code" href="structtest.html">test</a>  edi, 2
<a name="l07799"></a>07799             jnz         BlitNTL5
<a name="l07800"></a>07800 
<a name="l07801"></a>07801 <a class="code" href="vobject__blitters_8cpp.html#d660d2ba340c8ef5d2d80c6365ad838f">BlitNTL7</a>:
<a name="l07802"></a>07802             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l07803"></a>07803             cmp         ax, usZValue
<a name="l07804"></a>07804             ja          BlitNTL5
<a name="l07805"></a>07805 
<a name="l07806"></a>07806             <span class="comment">// ATE: DONOT WRITE Z VALUE</span>
<a name="l07807"></a>07807             <span class="comment">//mov       ax, usZValue</span>
<a name="l07808"></a>07808             <span class="comment">//mov       [ebx], ax</span>
<a name="l07809"></a>07809 
<a name="l07810"></a>07810             xor         eax, eax
<a name="l07811"></a>07811             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l07812"></a>07812             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, [edx+eax*2]
<a name="l07813"></a>07813             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [<a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>], ax
<a name="l07814"></a>07814 
<a name="l07815"></a>07815 BlitNTL5:
<a name="l07816"></a>07816             inc         esi
<a name="l07817"></a>07817             add         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, 2
<a name="l07818"></a>07818             add         ebx, 2
<a name="l07819"></a>07819             dec         cl
<a name="l07820"></a>07820             jnz         BlitNTL4
<a name="l07821"></a>07821 
<a name="l07822"></a>07822             jmp         BlitDispatch
<a name="l07823"></a>07823 
<a name="l07824"></a>07824 
<a name="l07825"></a>07825 BlitTransparent:
<a name="l07826"></a>07826 
<a name="l07827"></a>07827             and         ecx, 07fH
<a name="l07828"></a>07828 <span class="comment">//          shl         ecx, 1</span>
<a name="l07829"></a>07829             add   ecx, ecx
<a name="l07830"></a>07830             add         edi, ecx
<a name="l07831"></a>07831             add         ebx, ecx
<a name="l07832"></a>07832             jmp         BlitDispatch
<a name="l07833"></a>07833 
<a name="l07834"></a>07834 
<a name="l07835"></a>07835 BlitDoneLine:
<a name="l07836"></a>07836 
<a name="l07837"></a>07837             dec         usHeight
<a name="l07838"></a>07838             jz          BlitDone
<a name="l07839"></a>07839             add         edi, LineSkip
<a name="l07840"></a>07840             add         ebx, LineSkip
<a name="l07841"></a>07841             xor         uiLineFlag, 1
<a name="l07842"></a>07842             jmp         BlitDispatch
<a name="l07843"></a>07843 
<a name="l07844"></a>07844 
<a name="l07845"></a>07845 BlitDone:
<a name="l07846"></a>07846       }
<a name="l07847"></a>07847 
<a name="l07848"></a>07848       <span class="keywordflow">return</span>(TRUE);
<a name="l07849"></a>07849 
<a name="l07850"></a>07850 }
<a name="l07851"></a>07851 
<a name="l07852"></a>07852 <span class="comment">/**********************************************************************************************</span>
<a name="l07853"></a>07853 <span class="comment"> Blt8BPPDataTo16BPPBufferTransZNBClipPixelate</span>
<a name="l07854"></a>07854 <span class="comment"></span>
<a name="l07855"></a>07855 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l07856"></a>07856 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l07857"></a>07857 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on, and the Z value is</span>
<a name="l07858"></a>07858 <span class="comment">      NOT updated to the current value,   for any non-transparent pixels. The Z-buffer is 16 bit, and</span>
<a name="l07859"></a>07859 <span class="comment">      must be the same dimensions (including Pitch) as the destination.</span>
<a name="l07860"></a>07860 <span class="comment"></span>
<a name="l07861"></a>07861 <span class="comment">      Blits every second pixel ("pixelates").</span>
<a name="l07862"></a>07862 <span class="comment"></span>
<a name="l07863"></a>07863 <span class="comment">**********************************************************************************************/</span>
<a name="l07864"></a><a class="code" href="vobject__blitters_8h.html#e61428986b7ca1b7bb63c5b8b6d4f607">07864</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#e61428986b7ca1b7bb63c5b8b6d4f607">Blt8BPPDataTo16BPPBufferTransZNBClipPixelate</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="structSGPRect.html">SGPRect</a> *clipregion)
<a name="l07865"></a>07865 {
<a name="l07866"></a>07866 <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l07867"></a>07867 <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset, uiLineFlag;
<a name="l07868"></a>07868 <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth, Unblitted;
<a name="l07869"></a>07869 <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l07870"></a>07870 <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l07871"></a>07871 <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l07872"></a>07872 <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY, LeftSkip, RightSkip, TopSkip, BottomSkip, BlitLength, BlitHeight, LSCount;
<a name="l07873"></a>07873 <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  ClipX1, ClipY1, ClipX2, ClipY2;
<a name="l07874"></a>07874 
<a name="l07875"></a>07875       <span class="comment">// Assertions</span>
<a name="l07876"></a>07876       Assert( hSrcVObject != NULL );
<a name="l07877"></a>07877       Assert( pBuffer != NULL );
<a name="l07878"></a>07878 
<a name="l07879"></a>07879       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l07880"></a>07880       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l07881"></a>07881       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l07882"></a>07882       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l07883"></a>07883       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l07884"></a>07884 
<a name="l07885"></a>07885       <span class="comment">// Add to start position of dest buffer</span>
<a name="l07886"></a>07886       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l07887"></a>07887       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l07888"></a>07888 
<a name="l07889"></a>07889       <span class="keywordflow">if</span>(clipregion==NULL)
<a name="l07890"></a>07890       {
<a name="l07891"></a>07891             ClipX1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l07892"></a>07892             ClipY1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l07893"></a>07893             ClipX2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l07894"></a>07894             ClipY2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l07895"></a>07895       }
<a name="l07896"></a>07896       <span class="keywordflow">else</span>
<a name="l07897"></a>07897       {
<a name="l07898"></a>07898             ClipX1=clipregion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l07899"></a>07899             ClipY1=clipregion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l07900"></a>07900             ClipX2=clipregion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l07901"></a>07901             ClipY2=clipregion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l07902"></a>07902       }
<a name="l07903"></a>07903 
<a name="l07904"></a>07904       <span class="comment">// Calculate rows hanging off each side of the screen</span>
<a name="l07905"></a>07905       LeftSkip=__min(ClipX1 - min(ClipX1, iTempX), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l07906"></a>07906       RightSkip=__min(max(ClipX2, (iTempX+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth)) - ClipX2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l07907"></a>07907       TopSkip=__min(ClipY1 - __min(ClipY1, iTempY), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l07908"></a>07908       BottomSkip=__min(__max(ClipY2, (iTempY+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight)) - ClipY2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l07909"></a>07909 
<a name="l07910"></a>07910       <span class="comment">// calculate the remaining rows and columns to blit</span>
<a name="l07911"></a>07911       BlitLength=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth-LeftSkip-RightSkip);
<a name="l07912"></a>07912       BlitHeight=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight-TopSkip-BottomSkip);
<a name="l07913"></a>07913 
<a name="l07914"></a>07914       <span class="comment">// check if whole thing is clipped</span>
<a name="l07915"></a>07915       <span class="keywordflow">if</span>((LeftSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth) || (RightSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth))
<a name="l07916"></a>07916             <span class="keywordflow">return</span>(TRUE);
<a name="l07917"></a>07917 
<a name="l07918"></a>07918       <span class="comment">// check if whole thing is clipped</span>
<a name="l07919"></a>07919       <span class="keywordflow">if</span>((TopSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight) || (BottomSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight))
<a name="l07920"></a>07920             <span class="keywordflow">return</span>(TRUE);
<a name="l07921"></a>07921 
<a name="l07922"></a>07922       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l07923"></a>07923       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l07924"></a>07924       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l07925"></a>07925       p16BPPPalette = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#930609ad8d5cdbb05449df70bd83cfcd">pShadeCurrent</a>;
<a name="l07926"></a>07926       LineSkip=(uiDestPitchBYTES-(BlitLength*2));
<a name="l07927"></a>07927       uiLineFlag=(iTempY&amp;1);
<a name="l07928"></a>07928 
<a name="l07929"></a>07929       __asm {
<a name="l07930"></a>07930 
<a name="l07931"></a>07931             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l07932"></a>07932             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l07933"></a>07933             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, p16BPPPalette
<a name="l07934"></a>07934             xor         eax, eax
<a name="l07935"></a>07935             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l07936"></a>07936             xor         ecx, ecx
<a name="l07937"></a>07937 
<a name="l07938"></a>07938             cmp         TopSkip, 0                                      <span class="comment">// check for nothing clipped on top</span>
<a name="l07939"></a>07939             je          LeftSkipSetup
<a name="l07940"></a>07940 
<a name="l07941"></a>07941 TopSkipLoop:                                                            <span class="comment">// Skips the number of lines clipped at the top</span>
<a name="l07942"></a>07942 
<a name="l07943"></a>07943             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l07944"></a>07944             inc         esi
<a name="l07945"></a>07945             or          cl, cl
<a name="l07946"></a>07946             js          TopSkipLoop
<a name="l07947"></a>07947             jz          TSEndLine
<a name="l07948"></a>07948 
<a name="l07949"></a>07949             add         esi, ecx
<a name="l07950"></a>07950             jmp         TopSkipLoop
<a name="l07951"></a>07951 
<a name="l07952"></a>07952 TSEndLine:
<a name="l07953"></a>07953             dec         TopSkip
<a name="l07954"></a>07954             jnz         TopSkipLoop
<a name="l07955"></a>07955 
<a name="l07956"></a>07956 LeftSkipSetup:
<a name="l07957"></a>07957 
<a name="l07958"></a>07958             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l07959"></a>07959             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, LeftSkip
<a name="l07960"></a>07960             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l07961"></a>07961             or          eax, eax
<a name="l07962"></a>07962             jz          BlitLineSetup
<a name="l07963"></a>07963 
<a name="l07964"></a>07964 LeftSkipLoop:
<a name="l07965"></a>07965 
<a name="l07966"></a>07966             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l07967"></a>07967             inc         esi
<a name="l07968"></a>07968 
<a name="l07969"></a>07969             or          cl, cl
<a name="l07970"></a>07970             js          LSTrans
<a name="l07971"></a>07971 
<a name="l07972"></a>07972             cmp         ecx, LSCount
<a name="l07973"></a>07973             je          LSSkip2                                               <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l07974"></a>07974             jb          LSSkip1                                               <span class="comment">// if less, skip whole thing</span>
<a name="l07975"></a>07975 
<a name="l07976"></a>07976             add         esi, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l07977"></a>07977             sub         ecx, LSCount
<a name="l07978"></a>07978             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l07979"></a>07979             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l07980"></a>07980             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l07981"></a>07981             jmp         BlitNonTransLoop
<a name="l07982"></a>07982 
<a name="l07983"></a>07983 LSSkip2:
<a name="l07984"></a>07984             add         esi, ecx                                        <span class="comment">// skip whole run, and start blit with new run</span>
<a name="l07985"></a>07985             jmp         BlitLineSetup
<a name="l07986"></a>07986 
<a name="l07987"></a>07987 
<a name="l07988"></a>07988 LSSkip1:
<a name="l07989"></a>07989             add         esi, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l07990"></a>07990             sub         LSCount, ecx
<a name="l07991"></a>07991             jmp         LeftSkipLoop
<a name="l07992"></a>07992 
<a name="l07993"></a>07993 
<a name="l07994"></a>07994 LSTrans:
<a name="l07995"></a>07995             and         ecx, 07fH
<a name="l07996"></a>07996             cmp         ecx, LSCount
<a name="l07997"></a>07997             je          BlitLineSetup                             <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l07998"></a>07998             jb          LSTrans1                                        <span class="comment">// if less, skip whole thing</span>
<a name="l07999"></a>07999 
<a name="l08000"></a>08000             sub         ecx, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l08001"></a>08001             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l08002"></a>08002             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l08003"></a>08003             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l08004"></a>08004             jmp         BlitTransparent
<a name="l08005"></a>08005 
<a name="l08006"></a>08006 
<a name="l08007"></a>08007 LSTrans1:
<a name="l08008"></a>08008             sub         LSCount, ecx                                          <span class="comment">// skip whole run, continue skipping</span>
<a name="l08009"></a>08009             jmp         LeftSkipLoop
<a name="l08010"></a>08010 
<a name="l08011"></a>08011 
<a name="l08012"></a>08012 BlitLineSetup:                                                    <span class="comment">// Does any actual blitting (trans/non) for the line</span>
<a name="l08013"></a>08013             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l08014"></a>08014             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l08015"></a>08015             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l08016"></a>08016 
<a name="l08017"></a>08017 BlitDispatch:
<a name="l08018"></a>08018 
<a name="l08019"></a>08019             cmp         LSCount, 0                                      <span class="comment">// Check to see if we're done blitting</span>
<a name="l08020"></a>08020             je          RightSkipLoop
<a name="l08021"></a>08021 
<a name="l08022"></a>08022             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l08023"></a>08023             inc         esi
<a name="l08024"></a>08024             or          cl, cl
<a name="l08025"></a>08025             js          BlitTransparent
<a name="l08026"></a>08026 
<a name="l08027"></a>08027 BlitNonTransLoop:                                           <span class="comment">// blit non-transparent pixels</span>
<a name="l08028"></a>08028 
<a name="l08029"></a>08029             cmp         ecx, LSCount
<a name="l08030"></a>08030             jbe         BNTrans1
<a name="l08031"></a>08031 
<a name="l08032"></a>08032             sub         ecx, LSCount
<a name="l08033"></a>08033             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, ecx
<a name="l08034"></a>08034             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, LSCount
<a name="l08035"></a>08035 
<a name="l08036"></a>08036 BNTrans1:
<a name="l08037"></a>08037             sub         LSCount, ecx
<a name="l08038"></a>08038 
<a name="l08039"></a>08039 BlitNTL1:
<a name="l08040"></a>08040 
<a name="l08041"></a>08041             <a class="code" href="structtest.html">test</a>  uiLineFlag, 1
<a name="l08042"></a>08042             jz          <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>
<a name="l08043"></a>08043 
<a name="l08044"></a>08044             <a class="code" href="structtest.html">test</a>  edi, 2
<a name="l08045"></a>08045             jz          BlitNTL2
<a name="l08046"></a>08046             jmp         <a class="code" href="vobject__blitters_8cpp.html#d660d2ba340c8ef5d2d80c6365ad838f">BlitNTL7</a>
<a name="l08047"></a>08047 
<a name="l08048"></a>08048 <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>:
<a name="l08049"></a>08049             <a class="code" href="structtest.html">test</a>  edi, 2
<a name="l08050"></a>08050             jnz         BlitNTL2
<a name="l08051"></a>08051 
<a name="l08052"></a>08052 <a class="code" href="vobject__blitters_8cpp.html#d660d2ba340c8ef5d2d80c6365ad838f">BlitNTL7</a>:
<a name="l08053"></a>08053             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l08054"></a>08054             cmp         ax, usZValue
<a name="l08055"></a>08055             ja          BlitNTL2
<a name="l08056"></a>08056 
<a name="l08057"></a>08057             <span class="comment">//mov       ax, usZValue</span>
<a name="l08058"></a>08058             <span class="comment">//mov       [ebx], ax</span>
<a name="l08059"></a>08059 
<a name="l08060"></a>08060             xor         eax, eax
<a name="l08061"></a>08061 
<a name="l08062"></a>08062             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l08063"></a>08063             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, [edx+eax*2]
<a name="l08064"></a>08064             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [<a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>], ax
<a name="l08065"></a>08065 
<a name="l08066"></a>08066 BlitNTL2:
<a name="l08067"></a>08067             inc         esi
<a name="l08068"></a>08068             add         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, 2
<a name="l08069"></a>08069             add         ebx, 2
<a name="l08070"></a>08070             dec         cl
<a name="l08071"></a>08071             jnz         BlitNTL1
<a name="l08072"></a>08072 
<a name="l08073"></a>08073 <span class="comment">//BlitLineEnd:</span>
<a name="l08074"></a>08074             add         esi, Unblitted
<a name="l08075"></a>08075             jmp         BlitDispatch
<a name="l08076"></a>08076 
<a name="l08077"></a>08077 BlitTransparent:                                                              <span class="comment">// skip transparent pixels</span>
<a name="l08078"></a>08078 
<a name="l08079"></a>08079             and         ecx, 07fH
<a name="l08080"></a>08080             cmp         ecx, LSCount
<a name="l08081"></a>08081             jbe         BTrans1
<a name="l08082"></a>08082 
<a name="l08083"></a>08083             mov         ecx, LSCount
<a name="l08084"></a>08084 
<a name="l08085"></a>08085 BTrans1:
<a name="l08086"></a>08086 
<a name="l08087"></a>08087             sub         LSCount, ecx
<a name="l08088"></a>08088 <span class="comment">//          shl         ecx, 1</span>
<a name="l08089"></a>08089             add   ecx, ecx
<a name="l08090"></a>08090             add         edi, ecx
<a name="l08091"></a>08091             add         ebx, ecx
<a name="l08092"></a>08092             jmp         BlitDispatch
<a name="l08093"></a>08093 
<a name="l08094"></a>08094 
<a name="l08095"></a>08095 RightSkipLoop:                                                                      <span class="comment">// skip along until we hit and end-of-line marker</span>
<a name="l08096"></a>08096 
<a name="l08097"></a>08097 
<a name="l08098"></a>08098 RSLoop1:
<a name="l08099"></a>08099             mov         al, [esi]
<a name="l08100"></a>08100             inc         esi
<a name="l08101"></a>08101             or          al, al
<a name="l08102"></a>08102             jnz         RSLoop1
<a name="l08103"></a>08103 
<a name="l08104"></a>08104             xor         uiLineFlag, 1
<a name="l08105"></a>08105             dec         BlitHeight
<a name="l08106"></a>08106             jz          BlitDone
<a name="l08107"></a>08107             add         edi, LineSkip
<a name="l08108"></a>08108             add         ebx, LineSkip
<a name="l08109"></a>08109 
<a name="l08110"></a>08110             jmp         LeftSkipSetup
<a name="l08111"></a>08111 
<a name="l08112"></a>08112 
<a name="l08113"></a>08113 BlitDone:
<a name="l08114"></a>08114       }
<a name="l08115"></a>08115 
<a name="l08116"></a>08116       <span class="keywordflow">return</span>(TRUE);
<a name="l08117"></a>08117 
<a name="l08118"></a>08118 }
<a name="l08119"></a>08119 
<a name="l08120"></a>08120 <span class="comment">/**********************************************************************************************</span>
<a name="l08121"></a>08121 <span class="comment"> Blt8BPPDataTo16BPPBufferTransZ</span>
<a name="l08122"></a>08122 <span class="comment"></span>
<a name="l08123"></a>08123 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l08124"></a>08124 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l08125"></a>08125 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on, and the Z value is</span>
<a name="l08126"></a>08126 <span class="comment">      updated to the current value, for any non-transparent pixels. The Z-buffer is 16 bit, and</span>
<a name="l08127"></a>08127 <span class="comment">      must be the same dimensions (including Pitch) as the destination.</span>
<a name="l08128"></a>08128 <span class="comment"></span>
<a name="l08129"></a>08129 <span class="comment">**********************************************************************************************/</span>
<a name="l08130"></a><a class="code" href="vobject__blitters_8h.html#a860f39409761253c6f0acac7f9b9a3d">08130</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#a860f39409761253c6f0acac7f9b9a3d">Blt8BPPDataTo16BPPBufferTransZ</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex )
<a name="l08131"></a>08131 {
<a name="l08132"></a>08132       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l08133"></a>08133       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l08134"></a>08134       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth;
<a name="l08135"></a>08135       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l08136"></a>08136       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l08137"></a>08137       <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l08138"></a>08138       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l08139"></a>08139 
<a name="l08140"></a>08140 
<a name="l08141"></a>08141       <span class="comment">// Assertions</span>
<a name="l08142"></a>08142       Assert( hSrcVObject != NULL );
<a name="l08143"></a>08143       Assert( pBuffer != NULL );
<a name="l08144"></a>08144 
<a name="l08145"></a>08145       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l08146"></a>08146       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l08147"></a>08147       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l08148"></a>08148       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l08149"></a>08149       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l08150"></a>08150 
<a name="l08151"></a>08151       <span class="comment">// Add to start position of dest buffer</span>
<a name="l08152"></a>08152       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l08153"></a>08153       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l08154"></a>08154 
<a name="l08155"></a>08155       <span class="comment">// Validations</span>
<a name="l08156"></a>08156       CHECKF( iTempX &gt;= 0 );
<a name="l08157"></a>08157       CHECKF( iTempY &gt;= 0 );
<a name="l08158"></a>08158 
<a name="l08159"></a>08159 
<a name="l08160"></a>08160       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l08161"></a>08161       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l08162"></a>08162       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l08163"></a>08163       p16BPPPalette = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#930609ad8d5cdbb05449df70bd83cfcd">pShadeCurrent</a>;
<a name="l08164"></a>08164       LineSkip=(uiDestPitchBYTES-(usWidth*2));
<a name="l08165"></a>08165 
<a name="l08166"></a>08166       __asm {
<a name="l08167"></a>08167 
<a name="l08168"></a>08168             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l08169"></a>08169             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l08170"></a>08170             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, p16BPPPalette
<a name="l08171"></a>08171             xor         eax, eax
<a name="l08172"></a>08172             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l08173"></a>08173             xor         ecx, ecx
<a name="l08174"></a>08174 
<a name="l08175"></a>08175 BlitDispatch:
<a name="l08176"></a>08176 
<a name="l08177"></a>08177             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l08178"></a>08178             inc         esi
<a name="l08179"></a>08179             or          cl, cl
<a name="l08180"></a>08180             js          BlitTransparent
<a name="l08181"></a>08181             jz          BlitDoneLine
<a name="l08182"></a>08182 
<a name="l08183"></a>08183 <span class="comment">//BlitNonTransLoop:</span>
<a name="l08184"></a>08184 
<a name="l08185"></a>08185             xor         eax, eax
<a name="l08186"></a>08186 
<a name="l08187"></a>08187 BlitNTL4:
<a name="l08188"></a>08188 
<a name="l08189"></a>08189             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, usZValue
<a name="l08190"></a>08190             cmp         ax, [ebx]
<a name="l08191"></a>08191             jb          BlitNTL5
<a name="l08192"></a>08192 
<a name="l08193"></a>08193             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [ebx], ax
<a name="l08194"></a>08194 
<a name="l08195"></a>08195             xor         ah, ah
<a name="l08196"></a>08196             mov         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l08197"></a>08197             mov         ax, [edx+eax*2]
<a name="l08198"></a>08198             mov         [edi], ax
<a name="l08199"></a>08199 
<a name="l08200"></a>08200 BlitNTL5:
<a name="l08201"></a>08201             inc         esi
<a name="l08202"></a>08202             inc         edi
<a name="l08203"></a>08203             inc         ebx
<a name="l08204"></a>08204             inc         edi
<a name="l08205"></a>08205             inc         ebx
<a name="l08206"></a>08206 
<a name="l08207"></a>08207             dec         cl
<a name="l08208"></a>08208             jnz         BlitNTL4
<a name="l08209"></a>08209 
<a name="l08210"></a>08210             jmp         BlitDispatch
<a name="l08211"></a>08211 
<a name="l08212"></a>08212 
<a name="l08213"></a>08213 BlitTransparent:
<a name="l08214"></a>08214 
<a name="l08215"></a>08215             and         ecx, 07fH
<a name="l08216"></a>08216 <span class="comment">//          shl         ecx, 1</span>
<a name="l08217"></a>08217             add   ecx, ecx
<a name="l08218"></a>08218             add         edi, ecx
<a name="l08219"></a>08219             add         ebx, ecx
<a name="l08220"></a>08220             jmp         BlitDispatch
<a name="l08221"></a>08221 
<a name="l08222"></a>08222 
<a name="l08223"></a>08223 BlitDoneLine:
<a name="l08224"></a>08224 
<a name="l08225"></a>08225             dec         usHeight
<a name="l08226"></a>08226             jz          BlitDone
<a name="l08227"></a>08227             add         edi, LineSkip
<a name="l08228"></a>08228             add         ebx, LineSkip
<a name="l08229"></a>08229             jmp         BlitDispatch
<a name="l08230"></a>08230 
<a name="l08231"></a>08231 
<a name="l08232"></a>08232 BlitDone:
<a name="l08233"></a>08233       }
<a name="l08234"></a>08234 
<a name="l08235"></a>08235       <span class="keywordflow">return</span>(TRUE);
<a name="l08236"></a>08236 
<a name="l08237"></a>08237 }
<a name="l08238"></a>08238 
<a name="l08239"></a>08239 <span class="comment">/**********************************************************************************************</span>
<a name="l08240"></a>08240 <span class="comment"> Blt8BPPDataTo16BPPBufferTransZNB</span>
<a name="l08241"></a>08241 <span class="comment"></span>
<a name="l08242"></a>08242 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l08243"></a>08243 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l08244"></a>08244 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on. The Z value is</span>
<a name="l08245"></a>08245 <span class="comment">      NOT updated by this version. The Z-buffer is 16 bit, and    must be the same dimensions</span>
<a name="l08246"></a>08246 <span class="comment">      (including Pitch) as the destination.</span>
<a name="l08247"></a>08247 <span class="comment"></span>
<a name="l08248"></a>08248 <span class="comment">**********************************************************************************************/</span>
<a name="l08249"></a><a class="code" href="vobject__blitters_8h.html#512546f58c2d0bc443ab5f81920ffbe9">08249</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#512546f58c2d0bc443ab5f81920ffbe9">Blt8BPPDataTo16BPPBufferTransZNB</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex )
<a name="l08250"></a>08250 {
<a name="l08251"></a>08251       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l08252"></a>08252       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l08253"></a>08253       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth;
<a name="l08254"></a>08254       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l08255"></a>08255       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l08256"></a>08256       <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l08257"></a>08257       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l08258"></a>08258 
<a name="l08259"></a>08259 
<a name="l08260"></a>08260       <span class="comment">// Assertions</span>
<a name="l08261"></a>08261       Assert( hSrcVObject != NULL );
<a name="l08262"></a>08262       Assert( pBuffer != NULL );
<a name="l08263"></a>08263 
<a name="l08264"></a>08264       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l08265"></a>08265       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l08266"></a>08266       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l08267"></a>08267       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l08268"></a>08268       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l08269"></a>08269 
<a name="l08270"></a>08270       <span class="comment">// Add to start position of dest buffer</span>
<a name="l08271"></a>08271       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l08272"></a>08272       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l08273"></a>08273 
<a name="l08274"></a>08274       <span class="comment">// Validations</span>
<a name="l08275"></a>08275       CHECKF( iTempX &gt;= 0 );
<a name="l08276"></a>08276       CHECKF( iTempY &gt;= 0 );
<a name="l08277"></a>08277 
<a name="l08278"></a>08278 
<a name="l08279"></a>08279       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l08280"></a>08280       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l08281"></a>08281       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l08282"></a>08282       p16BPPPalette = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#930609ad8d5cdbb05449df70bd83cfcd">pShadeCurrent</a>;
<a name="l08283"></a>08283       LineSkip=(uiDestPitchBYTES-(usWidth*2));
<a name="l08284"></a>08284 
<a name="l08285"></a>08285       __asm {
<a name="l08286"></a>08286 
<a name="l08287"></a>08287             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l08288"></a>08288             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l08289"></a>08289             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, p16BPPPalette
<a name="l08290"></a>08290             xor         eax, eax
<a name="l08291"></a>08291             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l08292"></a>08292             xor         ecx, ecx
<a name="l08293"></a>08293 
<a name="l08294"></a>08294 BlitDispatch:
<a name="l08295"></a>08295 
<a name="l08296"></a>08296             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l08297"></a>08297             inc         esi
<a name="l08298"></a>08298             or          cl, cl
<a name="l08299"></a>08299             js          BlitTransparent
<a name="l08300"></a>08300             jz          BlitDoneLine
<a name="l08301"></a>08301 
<a name="l08302"></a>08302 <span class="comment">//BlitNonTransLoop:</span>
<a name="l08303"></a>08303 
<a name="l08304"></a>08304             xor         eax, eax
<a name="l08305"></a>08305 
<a name="l08306"></a>08306 BlitNTL4:
<a name="l08307"></a>08307 
<a name="l08308"></a>08308             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l08309"></a>08309             cmp         ax, usZValue
<a name="l08310"></a>08310             ja          BlitNTL5
<a name="l08311"></a>08311 
<a name="l08312"></a>08312             xor         ah, ah
<a name="l08313"></a>08313             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l08314"></a>08314             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, [edx+eax*2]
<a name="l08315"></a>08315             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax
<a name="l08316"></a>08316 
<a name="l08317"></a>08317 BlitNTL5:
<a name="l08318"></a>08318             inc         esi
<a name="l08319"></a>08319             inc         edi
<a name="l08320"></a>08320             inc         ebx
<a name="l08321"></a>08321             inc         edi
<a name="l08322"></a>08322             inc         ebx
<a name="l08323"></a>08323             dec         cl
<a name="l08324"></a>08324             jnz         BlitNTL4
<a name="l08325"></a>08325 
<a name="l08326"></a>08326             jmp         BlitDispatch
<a name="l08327"></a>08327 
<a name="l08328"></a>08328 
<a name="l08329"></a>08329 BlitTransparent:
<a name="l08330"></a>08330 
<a name="l08331"></a>08331             and         ecx, 07fH
<a name="l08332"></a>08332 <span class="comment">//          shl         ecx, 1</span>
<a name="l08333"></a>08333             add   ecx, ecx
<a name="l08334"></a>08334             add         edi, ecx
<a name="l08335"></a>08335             add         ebx, ecx
<a name="l08336"></a>08336             jmp         BlitDispatch
<a name="l08337"></a>08337 
<a name="l08338"></a>08338 
<a name="l08339"></a>08339 BlitDoneLine:
<a name="l08340"></a>08340 
<a name="l08341"></a>08341             dec         usHeight
<a name="l08342"></a>08342             jz          BlitDone
<a name="l08343"></a>08343             add         edi, LineSkip
<a name="l08344"></a>08344             add         ebx, LineSkip
<a name="l08345"></a>08345             jmp         BlitDispatch
<a name="l08346"></a>08346 
<a name="l08347"></a>08347 
<a name="l08348"></a>08348 BlitDone:
<a name="l08349"></a>08349       }
<a name="l08350"></a>08350 
<a name="l08351"></a>08351       <span class="keywordflow">return</span>(TRUE);
<a name="l08352"></a>08352 
<a name="l08353"></a>08353 }
<a name="l08354"></a>08354 
<a name="l08355"></a>08355 <span class="comment">/**********************************************************************************************</span>
<a name="l08356"></a>08356 <span class="comment"> Blt8BPPDataTo16BPPBufferTransZNBColor</span>
<a name="l08357"></a>08357 <span class="comment"></span>
<a name="l08358"></a>08358 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l08359"></a>08359 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l08360"></a>08360 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on. The Z value is</span>
<a name="l08361"></a>08361 <span class="comment">      NOT updated by this version. The Z-buffer is 16 bit, and    must be the same dimensions</span>
<a name="l08362"></a>08362 <span class="comment">      (including Pitch) as the destination. Any pixels that fail the Z test, are written</span>
<a name="l08363"></a>08363 <span class="comment">      to with the specified color value.</span>
<a name="l08364"></a>08364 <span class="comment"></span>
<a name="l08365"></a>08365 <span class="comment">**********************************************************************************************/</span>
<a name="l08366"></a><a class="code" href="vobject__blitters_8h.html#e95b2cf77f00a3db914e4d440632ffa6">08366</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#e95b2cf77f00a3db914e4d440632ffa6">Blt8BPPDataTo16BPPBufferTransZNBColor</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usColor)
<a name="l08367"></a>08367 {
<a name="l08368"></a>08368       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l08369"></a>08369       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l08370"></a>08370       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth;
<a name="l08371"></a>08371       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l08372"></a>08372       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l08373"></a>08373       <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l08374"></a>08374       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l08375"></a>08375 
<a name="l08376"></a>08376 
<a name="l08377"></a>08377       <span class="comment">// Assertions</span>
<a name="l08378"></a>08378       Assert( hSrcVObject != NULL );
<a name="l08379"></a>08379       Assert( pBuffer != NULL );
<a name="l08380"></a>08380 
<a name="l08381"></a>08381       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l08382"></a>08382       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l08383"></a>08383       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l08384"></a>08384       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l08385"></a>08385       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l08386"></a>08386 
<a name="l08387"></a>08387       <span class="comment">// Add to start position of dest buffer</span>
<a name="l08388"></a>08388       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l08389"></a>08389       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l08390"></a>08390 
<a name="l08391"></a>08391       <span class="comment">// Validations</span>
<a name="l08392"></a>08392       CHECKF( iTempX &gt;= 0 );
<a name="l08393"></a>08393       CHECKF( iTempY &gt;= 0 );
<a name="l08394"></a>08394 
<a name="l08395"></a>08395 
<a name="l08396"></a>08396       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l08397"></a>08397       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l08398"></a>08398       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l08399"></a>08399       p16BPPPalette = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#930609ad8d5cdbb05449df70bd83cfcd">pShadeCurrent</a>;
<a name="l08400"></a>08400       LineSkip=(uiDestPitchBYTES-(usWidth*2));
<a name="l08401"></a>08401 
<a name="l08402"></a>08402       __asm {
<a name="l08403"></a>08403 
<a name="l08404"></a>08404             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l08405"></a>08405             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l08406"></a>08406             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, p16BPPPalette
<a name="l08407"></a>08407             xor         eax, eax
<a name="l08408"></a>08408             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l08409"></a>08409             xor         ecx, ecx
<a name="l08410"></a>08410 
<a name="l08411"></a>08411 BlitDispatch:
<a name="l08412"></a>08412 
<a name="l08413"></a>08413             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l08414"></a>08414             inc         esi
<a name="l08415"></a>08415             or          cl, cl
<a name="l08416"></a>08416             js          BlitTransparent
<a name="l08417"></a>08417             jz          BlitDoneLine
<a name="l08418"></a>08418 
<a name="l08419"></a>08419 <span class="comment">//BlitNonTransLoop:</span>
<a name="l08420"></a>08420 
<a name="l08421"></a>08421             xor         eax, eax
<a name="l08422"></a>08422 
<a name="l08423"></a>08423 BlitNTL4:
<a name="l08424"></a>08424 
<a name="l08425"></a>08425             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l08426"></a>08426             cmp         ax, usZValue
<a name="l08427"></a>08427             ja          BlitNTL5
<a name="l08428"></a>08428 
<a name="l08429"></a>08429             xor         ah, ah
<a name="l08430"></a>08430             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l08431"></a>08431             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, [edx+eax*2]
<a name="l08432"></a>08432             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax
<a name="l08433"></a>08433             jmp         <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>
<a name="l08434"></a>08434 
<a name="l08435"></a>08435 BlitNTL5:
<a name="l08436"></a>08436             mov         ax, usColor
<a name="l08437"></a>08437             mov         [edi], ax
<a name="l08438"></a>08438 
<a name="l08439"></a>08439 <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>:
<a name="l08440"></a>08440             inc         esi
<a name="l08441"></a>08441             inc         edi
<a name="l08442"></a>08442             inc         ebx
<a name="l08443"></a>08443             inc         edi
<a name="l08444"></a>08444             inc         ebx
<a name="l08445"></a>08445             dec         cl
<a name="l08446"></a>08446             jnz         BlitNTL4
<a name="l08447"></a>08447 
<a name="l08448"></a>08448             jmp         BlitDispatch
<a name="l08449"></a>08449 
<a name="l08450"></a>08450 
<a name="l08451"></a>08451 BlitTransparent:
<a name="l08452"></a>08452 
<a name="l08453"></a>08453             and         ecx, 07fH
<a name="l08454"></a>08454 <span class="comment">//          shl         ecx, 1</span>
<a name="l08455"></a>08455             add   ecx, ecx
<a name="l08456"></a>08456             add         edi, ecx
<a name="l08457"></a>08457             add         ebx, ecx
<a name="l08458"></a>08458             jmp         BlitDispatch
<a name="l08459"></a>08459 
<a name="l08460"></a>08460 
<a name="l08461"></a>08461 BlitDoneLine:
<a name="l08462"></a>08462 
<a name="l08463"></a>08463             dec         usHeight
<a name="l08464"></a>08464             jz          BlitDone
<a name="l08465"></a>08465             add         edi, LineSkip
<a name="l08466"></a>08466             add         ebx, LineSkip
<a name="l08467"></a>08467             jmp         BlitDispatch
<a name="l08468"></a>08468 
<a name="l08469"></a>08469 
<a name="l08470"></a>08470 BlitDone:
<a name="l08471"></a>08471       }
<a name="l08472"></a>08472 
<a name="l08473"></a>08473       <span class="keywordflow">return</span>(TRUE);
<a name="l08474"></a>08474 
<a name="l08475"></a>08475 }
<a name="l08476"></a>08476 
<a name="l08477"></a>08477 <span class="comment">/**********************************************************************************************</span>
<a name="l08478"></a>08478 <span class="comment"> Blt8BPPDataTo16BPPBufferTransShadow</span>
<a name="l08479"></a>08479 <span class="comment"></span>
<a name="l08480"></a>08480 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l08481"></a>08481 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l08482"></a>08482 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on, and the Z value is</span>
<a name="l08483"></a>08483 <span class="comment">      updated to the current value, for any non-transparent pixels. If the source pixel is 254,</span>
<a name="l08484"></a>08484 <span class="comment">      it is considered a shadow, and the destination buffer is darkened rather than blitted on.</span>
<a name="l08485"></a>08485 <span class="comment">      The Z-buffer is 16 bit, and   must be the same dimensions (including Pitch) as the destination.</span>
<a name="l08486"></a>08486 <span class="comment"></span>
<a name="l08487"></a>08487 <span class="comment">**********************************************************************************************/</span>
<a name="l08488"></a><a class="code" href="vobject__blitters_8h.html#f8a9964706491618a754ec4ec18032c6">08488</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#f8a9964706491618a754ec4ec18032c6">Blt8BPPDataTo16BPPBufferTransShadow</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette )
<a name="l08489"></a>08489 {
<a name="l08490"></a>08490       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l08491"></a>08491       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth;
<a name="l08492"></a>08492       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr;
<a name="l08493"></a>08493       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l08494"></a>08494       <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l08495"></a>08495       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l08496"></a>08496 
<a name="l08497"></a>08497 
<a name="l08498"></a>08498       <span class="comment">// Assertions</span>
<a name="l08499"></a>08499       Assert( hSrcVObject != NULL );
<a name="l08500"></a>08500       Assert( pBuffer != NULL );
<a name="l08501"></a>08501 
<a name="l08502"></a>08502       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l08503"></a>08503       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l08504"></a>08504       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l08505"></a>08505       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l08506"></a>08506       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l08507"></a>08507 
<a name="l08508"></a>08508       <span class="comment">// Add to start position of dest buffer</span>
<a name="l08509"></a>08509       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l08510"></a>08510       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l08511"></a>08511 
<a name="l08512"></a>08512       <span class="comment">// Validations</span>
<a name="l08513"></a>08513       CHECKF( iTempX &gt;= 0 );
<a name="l08514"></a>08514       CHECKF( iTempY &gt;= 0 );
<a name="l08515"></a>08515 
<a name="l08516"></a>08516 
<a name="l08517"></a>08517       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l08518"></a>08518       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l08519"></a>08519       LineSkip=(uiDestPitchBYTES-(usWidth*2));
<a name="l08520"></a>08520 
<a name="l08521"></a>08521       __asm {
<a name="l08522"></a>08522 
<a name="l08523"></a>08523             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l08524"></a>08524             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l08525"></a>08525             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, p16BPPPalette
<a name="l08526"></a>08526             xor         eax, eax
<a name="l08527"></a>08527             xor         ecx, ecx
<a name="l08528"></a>08528 
<a name="l08529"></a>08529 BlitDispatch:
<a name="l08530"></a>08530 
<a name="l08531"></a>08531             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l08532"></a>08532             inc         esi
<a name="l08533"></a>08533             or          cl, cl
<a name="l08534"></a>08534             js          BlitTransparent
<a name="l08535"></a>08535             jz          BlitDoneLine
<a name="l08536"></a>08536 
<a name="l08537"></a>08537 <span class="comment">//BlitNonTransLoop:</span>
<a name="l08538"></a>08538 
<a name="l08539"></a>08539 BlitNTL4:
<a name="l08540"></a>08540 
<a name="l08541"></a>08541             xor         eax, eax
<a name="l08542"></a>08542             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l08543"></a>08543             cmp         al, 254
<a name="l08544"></a>08544             jne         <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>
<a name="l08545"></a>08545 
<a name="l08546"></a>08546             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [edi]
<a name="l08547"></a>08547             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, <a class="code" href="shading_8cpp.html#fd38e38bdd68f0da44ac96abacf3b2a6">ShadeTable</a>[eax*2]
<a name="l08548"></a>08548             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax
<a name="l08549"></a>08549             jmp         BlitNTL5
<a name="l08550"></a>08550 
<a name="l08551"></a>08551 
<a name="l08552"></a>08552 <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>:
<a name="l08553"></a>08553             mov         ax, [edx+eax*2]
<a name="l08554"></a>08554             mov         [edi], ax
<a name="l08555"></a>08555 
<a name="l08556"></a>08556 BlitNTL5:
<a name="l08557"></a>08557             inc         esi
<a name="l08558"></a>08558             add         edi, 2
<a name="l08559"></a>08559             dec         cl
<a name="l08560"></a>08560             jnz         BlitNTL4
<a name="l08561"></a>08561 
<a name="l08562"></a>08562             jmp         BlitDispatch
<a name="l08563"></a>08563 
<a name="l08564"></a>08564 
<a name="l08565"></a>08565 BlitTransparent:
<a name="l08566"></a>08566 
<a name="l08567"></a>08567             and         ecx, 07fH
<a name="l08568"></a>08568 <span class="comment">//          shl         ecx, 1</span>
<a name="l08569"></a>08569             add   ecx, ecx
<a name="l08570"></a>08570             add         edi, ecx
<a name="l08571"></a>08571             jmp         BlitDispatch
<a name="l08572"></a>08572 
<a name="l08573"></a>08573 
<a name="l08574"></a>08574 BlitDoneLine:
<a name="l08575"></a>08575 
<a name="l08576"></a>08576             dec         usHeight
<a name="l08577"></a>08577             jz          BlitDone
<a name="l08578"></a>08578             add         edi, LineSkip
<a name="l08579"></a>08579             jmp         BlitDispatch
<a name="l08580"></a>08580 
<a name="l08581"></a>08581 
<a name="l08582"></a>08582 BlitDone:
<a name="l08583"></a>08583       }
<a name="l08584"></a>08584 
<a name="l08585"></a>08585       <span class="keywordflow">return</span>(TRUE);
<a name="l08586"></a>08586 
<a name="l08587"></a>08587 }
<a name="l08588"></a>08588 
<a name="l08589"></a>08589 <span class="comment">/**********************************************************************************************</span>
<a name="l08590"></a>08590 <span class="comment"> Blt8BPPDataTo16BPPBufferTransShadowZ</span>
<a name="l08591"></a>08591 <span class="comment"></span>
<a name="l08592"></a>08592 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l08593"></a>08593 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l08594"></a>08594 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on, and the Z value is</span>
<a name="l08595"></a>08595 <span class="comment">      updated to the current value, for any non-transparent pixels. If the source pixel is 254,</span>
<a name="l08596"></a>08596 <span class="comment">      it is considered a shadow, and the destination buffer is darkened rather than blitted on.</span>
<a name="l08597"></a>08597 <span class="comment">      The Z-buffer is 16 bit, and   must be the same dimensions (including Pitch) as the destination.</span>
<a name="l08598"></a>08598 <span class="comment"></span>
<a name="l08599"></a>08599 <span class="comment">**********************************************************************************************/</span>
<a name="l08600"></a><a class="code" href="vobject__blitters_8h.html#047157bf00d2b7742ec317e269e97b28">08600</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#047157bf00d2b7742ec317e269e97b28">Blt8BPPDataTo16BPPBufferTransShadowZ</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette )
<a name="l08601"></a>08601 {
<a name="l08602"></a>08602       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l08603"></a>08603       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth;
<a name="l08604"></a>08604       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l08605"></a>08605       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l08606"></a>08606       <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l08607"></a>08607       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l08608"></a>08608 
<a name="l08609"></a>08609 
<a name="l08610"></a>08610       <span class="comment">// Assertions</span>
<a name="l08611"></a>08611       Assert( hSrcVObject != NULL );
<a name="l08612"></a>08612       Assert( pBuffer != NULL );
<a name="l08613"></a>08613 
<a name="l08614"></a>08614       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l08615"></a>08615       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l08616"></a>08616       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l08617"></a>08617       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l08618"></a>08618       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l08619"></a>08619 
<a name="l08620"></a>08620       <span class="comment">// Add to start position of dest buffer</span>
<a name="l08621"></a>08621       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l08622"></a>08622       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l08623"></a>08623 
<a name="l08624"></a>08624       <span class="comment">// Validations</span>
<a name="l08625"></a>08625       CHECKF( iTempX &gt;= 0 );
<a name="l08626"></a>08626       CHECKF( iTempY &gt;= 0 );
<a name="l08627"></a>08627 
<a name="l08628"></a>08628 
<a name="l08629"></a>08629       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l08630"></a>08630       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l08631"></a>08631       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l08632"></a>08632       LineSkip=(uiDestPitchBYTES-(usWidth*2));
<a name="l08633"></a>08633 
<a name="l08634"></a>08634       __asm {
<a name="l08635"></a>08635 
<a name="l08636"></a>08636             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l08637"></a>08637             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l08638"></a>08638             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, p16BPPPalette
<a name="l08639"></a>08639             xor         eax, eax
<a name="l08640"></a>08640             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l08641"></a>08641             xor         ecx, ecx
<a name="l08642"></a>08642 
<a name="l08643"></a>08643 BlitDispatch:
<a name="l08644"></a>08644 
<a name="l08645"></a>08645             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l08646"></a>08646             inc         esi
<a name="l08647"></a>08647             or          cl, cl
<a name="l08648"></a>08648             js          BlitTransparent
<a name="l08649"></a>08649             jz          BlitDoneLine
<a name="l08650"></a>08650 
<a name="l08651"></a>08651 <span class="comment">//BlitNonTransLoop:</span>
<a name="l08652"></a>08652 
<a name="l08653"></a>08653 BlitNTL4:
<a name="l08654"></a>08654 
<a name="l08655"></a>08655             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l08656"></a>08656             cmp         ax, usZValue
<a name="l08657"></a>08657             jae         BlitNTL5
<a name="l08658"></a>08658 
<a name="l08659"></a>08659             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, usZValue
<a name="l08660"></a>08660             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [ebx], ax
<a name="l08661"></a>08661 
<a name="l08662"></a>08662             xor         eax, eax
<a name="l08663"></a>08663             mov         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l08664"></a>08664             cmp         al, 254
<a name="l08665"></a>08665             jne         <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>
<a name="l08666"></a>08666 
<a name="l08667"></a>08667             mov         ax, [edi]
<a name="l08668"></a>08668             mov         ax, <a class="code" href="shading_8cpp.html#fd38e38bdd68f0da44ac96abacf3b2a6">ShadeTable</a>[eax*2]
<a name="l08669"></a>08669             mov         [edi], ax
<a name="l08670"></a>08670             jmp         BlitNTL5
<a name="l08671"></a>08671 
<a name="l08672"></a>08672 
<a name="l08673"></a>08673 <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>:
<a name="l08674"></a>08674             mov         ax, [edx+eax*2]
<a name="l08675"></a>08675             mov         [edi], ax
<a name="l08676"></a>08676 
<a name="l08677"></a>08677 BlitNTL5:
<a name="l08678"></a>08678             inc         esi
<a name="l08679"></a>08679             add         edi, 2
<a name="l08680"></a>08680             add         ebx, 2
<a name="l08681"></a>08681             dec         cl
<a name="l08682"></a>08682             jnz         BlitNTL4
<a name="l08683"></a>08683 
<a name="l08684"></a>08684             jmp         BlitDispatch
<a name="l08685"></a>08685 
<a name="l08686"></a>08686 
<a name="l08687"></a>08687 BlitTransparent:
<a name="l08688"></a>08688 
<a name="l08689"></a>08689             and         ecx, 07fH
<a name="l08690"></a>08690 <span class="comment">//          shl         ecx, 1</span>
<a name="l08691"></a>08691             add   ecx, ecx
<a name="l08692"></a>08692             add         edi, ecx
<a name="l08693"></a>08693             add         ebx, ecx
<a name="l08694"></a>08694             jmp         BlitDispatch
<a name="l08695"></a>08695 
<a name="l08696"></a>08696 
<a name="l08697"></a>08697 BlitDoneLine:
<a name="l08698"></a>08698 
<a name="l08699"></a>08699             dec         usHeight
<a name="l08700"></a>08700             jz          BlitDone
<a name="l08701"></a>08701             add         edi, LineSkip
<a name="l08702"></a>08702             add         ebx, LineSkip
<a name="l08703"></a>08703             jmp         BlitDispatch
<a name="l08704"></a>08704 
<a name="l08705"></a>08705 
<a name="l08706"></a>08706 BlitDone:
<a name="l08707"></a>08707       }
<a name="l08708"></a>08708 
<a name="l08709"></a>08709       <span class="keywordflow">return</span>(TRUE);
<a name="l08710"></a>08710 
<a name="l08711"></a>08711 }
<a name="l08712"></a>08712 
<a name="l08713"></a>08713 <span class="comment">/**********************************************************************************************</span>
<a name="l08714"></a>08714 <span class="comment"> Blt8BPPDataTo16BPPBufferTransShadowZNB</span>
<a name="l08715"></a>08715 <span class="comment"></span>
<a name="l08716"></a>08716 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l08717"></a>08717 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l08718"></a>08718 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on. The Z value is NOT</span>
<a name="l08719"></a>08719 <span class="comment">      updated. If the source pixel is 254, it is considered a shadow, and the destination</span>
<a name="l08720"></a>08720 <span class="comment">      buffer is darkened rather than blitted on. The Z-buffer is 16 bit, and must be the same</span>
<a name="l08721"></a>08721 <span class="comment">      dimensions (including Pitch) as the destination.</span>
<a name="l08722"></a>08722 <span class="comment"></span>
<a name="l08723"></a>08723 <span class="comment">**********************************************************************************************/</span>
<a name="l08724"></a><a class="code" href="vobject__blitters_8h.html#bbbc96bf47833f310f33284ebe521574">08724</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#bbbc96bf47833f310f33284ebe521574">Blt8BPPDataTo16BPPBufferTransShadowZNB</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette )
<a name="l08725"></a>08725 {
<a name="l08726"></a>08726       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l08727"></a>08727       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth;
<a name="l08728"></a>08728       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l08729"></a>08729       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l08730"></a>08730       <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l08731"></a>08731       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l08732"></a>08732 
<a name="l08733"></a>08733 
<a name="l08734"></a>08734       <span class="comment">// Assertions</span>
<a name="l08735"></a>08735       Assert( hSrcVObject != NULL );
<a name="l08736"></a>08736       Assert( pBuffer != NULL );
<a name="l08737"></a>08737 
<a name="l08738"></a>08738       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l08739"></a>08739       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l08740"></a>08740       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l08741"></a>08741       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l08742"></a>08742       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l08743"></a>08743 
<a name="l08744"></a>08744       <span class="comment">// Add to start position of dest buffer</span>
<a name="l08745"></a>08745       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l08746"></a>08746       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l08747"></a>08747 
<a name="l08748"></a>08748       <span class="comment">// Validations</span>
<a name="l08749"></a>08749       CHECKF( iTempX &gt;= 0 );
<a name="l08750"></a>08750       CHECKF( iTempY &gt;= 0 );
<a name="l08751"></a>08751 
<a name="l08752"></a>08752 
<a name="l08753"></a>08753       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l08754"></a>08754       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l08755"></a>08755       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l08756"></a>08756       LineSkip=(uiDestPitchBYTES-(usWidth*2));
<a name="l08757"></a>08757 
<a name="l08758"></a>08758       __asm {
<a name="l08759"></a>08759 
<a name="l08760"></a>08760             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l08761"></a>08761             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l08762"></a>08762             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, p16BPPPalette
<a name="l08763"></a>08763             xor         eax, eax
<a name="l08764"></a>08764             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l08765"></a>08765             xor         ecx, ecx
<a name="l08766"></a>08766 
<a name="l08767"></a>08767 BlitDispatch:
<a name="l08768"></a>08768 
<a name="l08769"></a>08769             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l08770"></a>08770             inc         esi
<a name="l08771"></a>08771             or          cl, cl
<a name="l08772"></a>08772             js          BlitTransparent
<a name="l08773"></a>08773             jz          BlitDoneLine
<a name="l08774"></a>08774 
<a name="l08775"></a>08775 <span class="comment">//BlitNonTransLoop:</span>
<a name="l08776"></a>08776 
<a name="l08777"></a>08777 BlitNTL4:
<a name="l08778"></a>08778 
<a name="l08779"></a>08779             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l08780"></a>08780             cmp         ax, usZValue
<a name="l08781"></a>08781             ja          BlitNTL5
<a name="l08782"></a>08782 
<a name="l08783"></a>08783             xor         eax, eax
<a name="l08784"></a>08784             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l08785"></a>08785             cmp         al, 254
<a name="l08786"></a>08786             jne         <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>
<a name="l08787"></a>08787 
<a name="l08788"></a>08788             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, [ebx]
<a name="l08789"></a>08789             cmp         ax, usZValue
<a name="l08790"></a>08790             jae         BlitNTL5
<a name="l08791"></a>08791 
<a name="l08792"></a>08792             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, [edi]
<a name="l08793"></a>08793             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, <a class="code" href="shading_8cpp.html#fd38e38bdd68f0da44ac96abacf3b2a6">ShadeTable</a>[eax*2]
<a name="l08794"></a>08794             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax
<a name="l08795"></a>08795             jmp         BlitNTL5
<a name="l08796"></a>08796 
<a name="l08797"></a>08797 
<a name="l08798"></a>08798 <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>:
<a name="l08799"></a>08799             mov         ax, [edx+eax*2]
<a name="l08800"></a>08800             mov         [edi], ax
<a name="l08801"></a>08801 
<a name="l08802"></a>08802 BlitNTL5:
<a name="l08803"></a>08803             inc         esi
<a name="l08804"></a>08804             add         edi, 2
<a name="l08805"></a>08805             add         ebx, 2
<a name="l08806"></a>08806             dec         cl
<a name="l08807"></a>08807             jnz         BlitNTL4
<a name="l08808"></a>08808 
<a name="l08809"></a>08809             jmp         BlitDispatch
<a name="l08810"></a>08810 
<a name="l08811"></a>08811 
<a name="l08812"></a>08812 BlitTransparent:
<a name="l08813"></a>08813 
<a name="l08814"></a>08814             and         ecx, 07fH
<a name="l08815"></a>08815 <span class="comment">//          shl         ecx, 1</span>
<a name="l08816"></a>08816             add   ecx, ecx
<a name="l08817"></a>08817             add         edi, ecx
<a name="l08818"></a>08818             add         ebx, ecx
<a name="l08819"></a>08819             jmp         BlitDispatch
<a name="l08820"></a>08820 
<a name="l08821"></a>08821 
<a name="l08822"></a>08822 BlitDoneLine:
<a name="l08823"></a>08823 
<a name="l08824"></a>08824             dec         usHeight
<a name="l08825"></a>08825             jz          BlitDone
<a name="l08826"></a>08826             add         edi, LineSkip
<a name="l08827"></a>08827             add         ebx, LineSkip
<a name="l08828"></a>08828             jmp         BlitDispatch
<a name="l08829"></a>08829 
<a name="l08830"></a>08830 
<a name="l08831"></a>08831 BlitDone:
<a name="l08832"></a>08832       }
<a name="l08833"></a>08833 
<a name="l08834"></a>08834       <span class="keywordflow">return</span>(TRUE);
<a name="l08835"></a>08835 
<a name="l08836"></a>08836 }
<a name="l08837"></a>08837 
<a name="l08838"></a>08838 
<a name="l08839"></a>08839 <span class="preprocessor">#if 0</span>
<a name="l08840"></a>08840 <span class="preprocessor"></span>
<a name="l08841"></a>08841 BlitNTL4:
<a name="l08842"></a>08842 
<a name="l08843"></a>08843             <span class="comment">// TEST FOR Z FIRST!</span>
<a name="l08844"></a><a class="code" href="vobject__blitters_8cpp.html#c79ed78d33a0fc310d759368b558527c">08844</a>             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l08845"></a>08845             cmp         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, usZValue
<a name="l08846"></a>08846             ja          <a class="code" href="vobject__blitters_8cpp.html#abf905a085ab39598c9c71ca8e8a0a0e">BlitNTL8</a>
<a name="l08847"></a>08847 
<a name="l08848"></a>08848             <span class="comment">// Write it NOW!</span>
<a name="l08849"></a>08849             jmp         <a class="code" href="vobject__blitters_8cpp.html#d660d2ba340c8ef5d2d80c6365ad838f">BlitNTL7</a>
<a name="l08850"></a>08850 
<a name="l08851"></a>08851 <a class="code" href="vobject__blitters_8cpp.html#abf905a085ab39598c9c71ca8e8a0a0e">BlitNTL8</a>:
<a name="l08852"></a>08852 
<a name="l08853"></a>08853             <a class="code" href="structtest.html">test</a>  uiLineFlag, 1
<a name="l08854"></a>08854             jz          <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>
<a name="l08855"></a>08855 
<a name="l08856"></a>08856             <a class="code" href="structtest.html">test</a>  <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, 2
<a name="l08857"></a>08857             jz          BlitNTL5
<a name="l08858"></a>08858             jmp         <a class="code" href="vobject__blitters_8cpp.html#0e7ffd1e4d81460c5ee051765cc57418">BlitNTL9</a>
<a name="l08859"></a>08859 
<a name="l08860"></a>08860 <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>:
<a name="l08861"></a>08861             <a class="code" href="structtest.html">test</a>  <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, 2
<a name="l08862"></a>08862             jnz         BlitNTL5
<a name="l08863"></a>08863 
<a name="l08864"></a>08864 <a class="code" href="vobject__blitters_8cpp.html#d660d2ba340c8ef5d2d80c6365ad838f">BlitNTL7</a>:
<a name="l08865"></a>08865 
<a name="l08866"></a>08866             <span class="comment">// Write normal z value</span>
<a name="l08867"></a>08867             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, usZValue
<a name="l08868"></a>08868             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [ebx], <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>
<a name="l08869"></a>08869             jmp   <a class="code" href="vobject__blitters_8cpp.html#945e5d61e3207454e74973a0fec418fd">BlitNTL10</a>
<a name="l08870"></a>08870 
<a name="l08871"></a>08871 <a class="code" href="vobject__blitters_8cpp.html#0e7ffd1e4d81460c5ee051765cc57418">BlitNTL9</a>:
<a name="l08872"></a>08872 
<a name="l08873"></a>08873             <span class="comment">// Write high z</span>
<a name="l08874"></a>08874             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, 32767
<a name="l08875"></a>08875             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [ebx], <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>
<a name="l08876"></a>08876 
<a name="l08877"></a>08877 <a class="code" href="vobject__blitters_8cpp.html#945e5d61e3207454e74973a0fec418fd">BlitNTL10</a>:
<a name="l08878"></a>08878 
<a name="l08879"></a>08879             xor         eax, eax
<a name="l08880"></a>08880             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l08881"></a>08881             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [edx+eax*2]
<a name="l08882"></a>08882             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [<a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>], <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>
<a name="l08883"></a>08883 <span class="preprocessor">#endif</span>
<a name="l08884"></a>08884 <span class="preprocessor"></span>
<a name="l08885"></a>08885 
<a name="l08886"></a>08886 <span class="comment">/**********************************************************************************************</span>
<a name="l08887"></a>08887 <span class="comment"> Blt8BPPDataTo16BPPBufferTransShadowZNBObscured</span>
<a name="l08888"></a>08888 <span class="comment"></span>
<a name="l08889"></a>08889 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l08890"></a>08890 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l08891"></a>08891 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on. The Z value is NOT</span>
<a name="l08892"></a>08892 <span class="comment">      updated. If the source pixel is 254, it is considered a shadow, and the destination</span>
<a name="l08893"></a>08893 <span class="comment">      buffer is darkened rather than blitted on. The Z-buffer is 16 bit, and must be the same</span>
<a name="l08894"></a>08894 <span class="comment">      dimensions (including Pitch) as the destination.</span>
<a name="l08895"></a>08895 <span class="comment"></span>
<a name="l08896"></a>08896 <span class="comment">**********************************************************************************************/</span>
<a name="l08897"></a><a class="code" href="vobject__blitters_8h.html#78226b13d42d068c29dab429952a0b5f">08897</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#e0579455ccf78d863ef604a443938dad">Blt8BPPDataTo16BPPBufferTransShadowZNBObscured</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette )
<a name="l08898"></a>08898 {
<a name="l08899"></a>08899       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l08900"></a>08900       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth;
<a name="l08901"></a>08901       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l08902"></a>08902       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l08903"></a>08903       <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l08904"></a>08904       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l08905"></a>08905       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiLineFlag;
<a name="l08906"></a>08906 
<a name="l08907"></a>08907 
<a name="l08908"></a>08908 
<a name="l08909"></a>08909       <span class="comment">// Assertions</span>
<a name="l08910"></a>08910       Assert( hSrcVObject != NULL );
<a name="l08911"></a>08911       Assert( pBuffer != NULL );
<a name="l08912"></a>08912 
<a name="l08913"></a>08913       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l08914"></a>08914       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l08915"></a>08915       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l08916"></a>08916       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l08917"></a>08917       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l08918"></a>08918 
<a name="l08919"></a>08919       <span class="comment">// Add to start position of dest buffer</span>
<a name="l08920"></a>08920       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l08921"></a>08921       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l08922"></a>08922 
<a name="l08923"></a>08923       <span class="comment">// Validations</span>
<a name="l08924"></a>08924       CHECKF( iTempX &gt;= 0 );
<a name="l08925"></a>08925       CHECKF( iTempY &gt;= 0 );
<a name="l08926"></a>08926 
<a name="l08927"></a>08927 
<a name="l08928"></a>08928       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l08929"></a>08929       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l08930"></a>08930       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l08931"></a>08931       LineSkip=(uiDestPitchBYTES-(usWidth*2));
<a name="l08932"></a>08932       uiLineFlag=(iTempY&amp;1);
<a name="l08933"></a>08933 
<a name="l08934"></a>08934 
<a name="l08935"></a>08935       __asm {
<a name="l08936"></a>08936 
<a name="l08937"></a>08937             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l08938"></a>08938             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l08939"></a>08939             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, p16BPPPalette
<a name="l08940"></a>08940             xor         eax, eax
<a name="l08941"></a>08941             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l08942"></a>08942             xor         ecx, ecx
<a name="l08943"></a>08943 
<a name="l08944"></a>08944 BlitDispatch:
<a name="l08945"></a>08945 
<a name="l08946"></a>08946             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l08947"></a>08947             inc         esi
<a name="l08948"></a>08948             or          cl, cl
<a name="l08949"></a>08949             js          BlitTransparent
<a name="l08950"></a>08950             jz          BlitDoneLine
<a name="l08951"></a>08951 
<a name="l08952"></a>08952 <span class="comment">//BlitNonTransLoop:</span>
<a name="l08953"></a>08953 
<a name="l08954"></a>08954 BlitNTL4:
<a name="l08955"></a>08955 
<a name="l08956"></a>08956 
<a name="l08957"></a>08957             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l08958"></a>08958             cmp         ax, usZValue
<a name="l08959"></a>08959             ja          <a class="code" href="vobject__blitters_8cpp.html#abf905a085ab39598c9c71ca8e8a0a0e">BlitNTL8</a>
<a name="l08960"></a>08960 
<a name="l08961"></a>08961             xor         eax, eax
<a name="l08962"></a>08962             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l08963"></a>08963             cmp         al, 254
<a name="l08964"></a>08964             jne         <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>
<a name="l08965"></a>08965 
<a name="l08966"></a>08966             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, [ebx]
<a name="l08967"></a>08967             cmp         ax, usZValue
<a name="l08968"></a>08968             jae         BlitNTL5
<a name="l08969"></a>08969 
<a name="l08970"></a>08970             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, [edi]
<a name="l08971"></a>08971             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, <a class="code" href="shading_8cpp.html#fd38e38bdd68f0da44ac96abacf3b2a6">ShadeTable</a>[eax*2]
<a name="l08972"></a>08972             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax
<a name="l08973"></a>08973             jmp         BlitNTL5
<a name="l08974"></a>08974 
<a name="l08975"></a>08975 
<a name="l08976"></a>08976 <a class="code" href="vobject__blitters_8cpp.html#abf905a085ab39598c9c71ca8e8a0a0e">BlitNTL8</a>:
<a name="l08977"></a>08977 
<a name="l08978"></a>08978             xor         eax, eax
<a name="l08979"></a>08979             mov         al, [esi]
<a name="l08980"></a>08980             cmp         al, 254
<a name="l08981"></a>08981             je          BlitNTL5
<a name="l08982"></a>08982 
<a name="l08983"></a>08983             <a class="code" href="structtest.html">test</a>  uiLineFlag, 1
<a name="l08984"></a>08984             jz          <a class="code" href="vobject__blitters_8cpp.html#0e7ffd1e4d81460c5ee051765cc57418">BlitNTL9</a>
<a name="l08985"></a>08985 
<a name="l08986"></a>08986             <a class="code" href="structtest.html">test</a>  edi, 2
<a name="l08987"></a>08987             jz          BlitNTL5
<a name="l08988"></a>08988 
<a name="l08989"></a>08989             jmp         <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>
<a name="l08990"></a>08990 
<a name="l08991"></a>08991 <a class="code" href="vobject__blitters_8cpp.html#0e7ffd1e4d81460c5ee051765cc57418">BlitNTL9</a>:
<a name="l08992"></a>08992             <a class="code" href="structtest.html">test</a>  edi, 2
<a name="l08993"></a>08993             jnz         BlitNTL5
<a name="l08994"></a>08994 
<a name="l08995"></a>08995 
<a name="l08996"></a>08996 <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>:
<a name="l08997"></a>08997 
<a name="l08998"></a>08998             xor         eax, eax
<a name="l08999"></a>08999             mov         al, [esi]
<a name="l09000"></a>09000             mov         ax, [edx+eax*2]
<a name="l09001"></a>09001             mov         [<a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>], ax
<a name="l09002"></a>09002 
<a name="l09003"></a>09003 BlitNTL5:
<a name="l09004"></a>09004             inc         esi
<a name="l09005"></a>09005             add         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, 2
<a name="l09006"></a>09006             add         ebx, 2
<a name="l09007"></a>09007             dec         cl
<a name="l09008"></a>09008             jnz         BlitNTL4
<a name="l09009"></a>09009 
<a name="l09010"></a>09010             jmp         BlitDispatch
<a name="l09011"></a>09011 
<a name="l09012"></a>09012 
<a name="l09013"></a>09013 BlitTransparent:
<a name="l09014"></a>09014 
<a name="l09015"></a>09015             and         ecx, 07fH
<a name="l09016"></a>09016 <span class="comment">//          shl         ecx, 1</span>
<a name="l09017"></a>09017             add   ecx, ecx
<a name="l09018"></a>09018             add         edi, ecx
<a name="l09019"></a>09019             add         ebx, ecx
<a name="l09020"></a>09020             jmp         BlitDispatch
<a name="l09021"></a>09021 
<a name="l09022"></a>09022 
<a name="l09023"></a>09023 BlitDoneLine:
<a name="l09024"></a>09024 
<a name="l09025"></a>09025             dec         usHeight
<a name="l09026"></a>09026             jz          BlitDone
<a name="l09027"></a>09027             add         edi, LineSkip
<a name="l09028"></a>09028             add         ebx, LineSkip
<a name="l09029"></a>09029             xor         uiLineFlag, 1
<a name="l09030"></a>09030             jmp         BlitDispatch
<a name="l09031"></a>09031 
<a name="l09032"></a>09032 
<a name="l09033"></a>09033 BlitDone:
<a name="l09034"></a>09034       }
<a name="l09035"></a>09035 
<a name="l09036"></a>09036       <span class="keywordflow">return</span>(TRUE);
<a name="l09037"></a>09037 
<a name="l09038"></a>09038 }
<a name="l09039"></a>09039 
<a name="l09040"></a>09040 
<a name="l09041"></a>09041 <span class="comment">/**********************************************************************************************</span>
<a name="l09042"></a>09042 <span class="comment"> Blt8BPPDataTo16BPPBufferTransShadowZClip</span>
<a name="l09043"></a>09043 <span class="comment"></span>
<a name="l09044"></a>09044 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l09045"></a>09045 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l09046"></a>09046 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on, and the Z value is</span>
<a name="l09047"></a>09047 <span class="comment">      updated to the current value, for any non-transparent pixels. The Z-buffer is 16 bit, and</span>
<a name="l09048"></a>09048 <span class="comment">      must be the same dimensions (including Pitch) as the destination. Pixels with a value of</span>
<a name="l09049"></a>09049 <span class="comment">      254 are shaded instead of blitted.</span>
<a name="l09050"></a>09050 <span class="comment"></span>
<a name="l09051"></a>09051 <span class="comment">**********************************************************************************************/</span>
<a name="l09052"></a><a class="code" href="vobject__blitters_8h.html#853b8bf52a7c0e57d068c2defad78679">09052</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#853b8bf52a7c0e57d068c2defad78679">Blt8BPPDataTo16BPPBufferTransShadowZClip</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="structSGPRect.html">SGPRect</a> *clipregion, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette )
<a name="l09053"></a>09053 {
<a name="l09054"></a>09054       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l09055"></a>09055       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth, Unblitted;
<a name="l09056"></a>09056       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l09057"></a>09057       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l09058"></a>09058   <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l09059"></a>09059       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY, LeftSkip, RightSkip, TopSkip, BottomSkip, BlitLength, BlitHeight, LSCount;
<a name="l09060"></a>09060       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  ClipX1, ClipY1, ClipX2, ClipY2;
<a name="l09061"></a>09061 
<a name="l09062"></a>09062       <span class="comment">// Assertions</span>
<a name="l09063"></a>09063       Assert( hSrcVObject != NULL );
<a name="l09064"></a>09064       Assert( pBuffer != NULL );
<a name="l09065"></a>09065 
<a name="l09066"></a>09066       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l09067"></a>09067       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l09068"></a>09068       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l09069"></a>09069       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l09070"></a>09070       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l09071"></a>09071 
<a name="l09072"></a>09072       <span class="comment">// Add to start position of dest buffer</span>
<a name="l09073"></a>09073       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l09074"></a>09074       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l09075"></a>09075 
<a name="l09076"></a>09076       <span class="keywordflow">if</span>(clipregion==NULL)
<a name="l09077"></a>09077       {
<a name="l09078"></a>09078             ClipX1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l09079"></a>09079             ClipY1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l09080"></a>09080             ClipX2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l09081"></a>09081             ClipY2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l09082"></a>09082       }
<a name="l09083"></a>09083       <span class="keywordflow">else</span>
<a name="l09084"></a>09084       {
<a name="l09085"></a>09085             ClipX1=clipregion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l09086"></a>09086             ClipY1=clipregion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l09087"></a>09087             ClipX2=clipregion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l09088"></a>09088             ClipY2=clipregion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l09089"></a>09089       }
<a name="l09090"></a>09090 
<a name="l09091"></a>09091       <span class="comment">// Calculate rows hanging off each side of the screen</span>
<a name="l09092"></a>09092       LeftSkip=__min(ClipX1 - min(ClipX1, iTempX), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l09093"></a>09093       RightSkip=__min(max(ClipX2, (iTempX+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth)) - ClipX2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l09094"></a>09094       TopSkip=__min(ClipY1 - __min(ClipY1, iTempY), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l09095"></a>09095       BottomSkip=__min(__max(ClipY2, (iTempY+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight)) - ClipY2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l09096"></a>09096 
<a name="l09097"></a>09097       <span class="comment">// calculate the remaining rows and columns to blit</span>
<a name="l09098"></a>09098       BlitLength=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth-LeftSkip-RightSkip);
<a name="l09099"></a>09099       BlitHeight=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight-TopSkip-BottomSkip);
<a name="l09100"></a>09100 
<a name="l09101"></a>09101       <span class="comment">// check if whole thing is clipped</span>
<a name="l09102"></a>09102       <span class="keywordflow">if</span>((LeftSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth) || (RightSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth))
<a name="l09103"></a>09103             <span class="keywordflow">return</span>(TRUE);
<a name="l09104"></a>09104 
<a name="l09105"></a>09105       <span class="comment">// check if whole thing is clipped</span>
<a name="l09106"></a>09106       <span class="keywordflow">if</span>((TopSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight) || (BottomSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight))
<a name="l09107"></a>09107             <span class="keywordflow">return</span>(TRUE);
<a name="l09108"></a>09108 
<a name="l09109"></a>09109       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l09110"></a>09110       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l09111"></a>09111       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l09112"></a>09112       LineSkip=(uiDestPitchBYTES-(BlitLength*2));
<a name="l09113"></a>09113 
<a name="l09114"></a>09114       __asm {
<a name="l09115"></a>09115 
<a name="l09116"></a>09116             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l09117"></a>09117             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l09118"></a>09118             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, p16BPPPalette
<a name="l09119"></a>09119             xor         eax, eax
<a name="l09120"></a>09120             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l09121"></a>09121             xor         ecx, ecx
<a name="l09122"></a>09122 
<a name="l09123"></a>09123             cmp         TopSkip, 0                                      <span class="comment">// check for nothing clipped on top</span>
<a name="l09124"></a>09124             je          LeftSkipSetup
<a name="l09125"></a>09125 
<a name="l09126"></a>09126 TopSkipLoop:                                                            <span class="comment">// Skips the number of lines clipped at the top</span>
<a name="l09127"></a>09127 
<a name="l09128"></a>09128             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l09129"></a>09129             inc         esi
<a name="l09130"></a>09130             or          cl, cl
<a name="l09131"></a>09131             js          TopSkipLoop
<a name="l09132"></a>09132             jz          TSEndLine
<a name="l09133"></a>09133 
<a name="l09134"></a>09134             add         esi, ecx
<a name="l09135"></a>09135             jmp         TopSkipLoop
<a name="l09136"></a>09136 
<a name="l09137"></a>09137 TSEndLine:
<a name="l09138"></a>09138             dec         TopSkip
<a name="l09139"></a>09139             jnz         TopSkipLoop
<a name="l09140"></a>09140 
<a name="l09141"></a>09141 LeftSkipSetup:
<a name="l09142"></a>09142 
<a name="l09143"></a>09143             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l09144"></a>09144             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, LeftSkip
<a name="l09145"></a>09145             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l09146"></a>09146             or          eax, eax
<a name="l09147"></a>09147             jz          BlitLineSetup
<a name="l09148"></a>09148 
<a name="l09149"></a>09149 LeftSkipLoop:
<a name="l09150"></a>09150 
<a name="l09151"></a>09151             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l09152"></a>09152             inc         esi
<a name="l09153"></a>09153 
<a name="l09154"></a>09154             or          cl, cl
<a name="l09155"></a>09155             js          LSTrans
<a name="l09156"></a>09156 
<a name="l09157"></a>09157             cmp         ecx, LSCount
<a name="l09158"></a>09158             je          LSSkip2                                               <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l09159"></a>09159             jb          LSSkip1                                               <span class="comment">// if less, skip whole thing</span>
<a name="l09160"></a>09160 
<a name="l09161"></a>09161             add         esi, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l09162"></a>09162             sub         ecx, LSCount
<a name="l09163"></a>09163             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l09164"></a>09164             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l09165"></a>09165             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l09166"></a>09166             jmp         BlitNonTransLoop
<a name="l09167"></a>09167 
<a name="l09168"></a>09168 LSSkip2:
<a name="l09169"></a>09169             add         esi, ecx                                        <span class="comment">// skip whole run, and start blit with new run</span>
<a name="l09170"></a>09170             jmp         BlitLineSetup
<a name="l09171"></a>09171 
<a name="l09172"></a>09172 
<a name="l09173"></a>09173 LSSkip1:
<a name="l09174"></a>09174             add         esi, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l09175"></a>09175             sub         LSCount, ecx
<a name="l09176"></a>09176             jmp         LeftSkipLoop
<a name="l09177"></a>09177 
<a name="l09178"></a>09178 
<a name="l09179"></a>09179 LSTrans:
<a name="l09180"></a>09180             and         ecx, 07fH
<a name="l09181"></a>09181             cmp         ecx, LSCount
<a name="l09182"></a>09182             je          BlitLineSetup                             <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l09183"></a>09183             jb          LSTrans1                                        <span class="comment">// if less, skip whole thing</span>
<a name="l09184"></a>09184 
<a name="l09185"></a>09185             sub         ecx, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l09186"></a>09186             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l09187"></a>09187             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l09188"></a>09188             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l09189"></a>09189             jmp         BlitTransparent
<a name="l09190"></a>09190 
<a name="l09191"></a>09191 
<a name="l09192"></a>09192 LSTrans1:
<a name="l09193"></a>09193             sub         LSCount, ecx                                          <span class="comment">// skip whole run, continue skipping</span>
<a name="l09194"></a>09194             jmp         LeftSkipLoop
<a name="l09195"></a>09195 
<a name="l09196"></a>09196 
<a name="l09197"></a>09197 BlitLineSetup:                                                    <span class="comment">// Does any actual blitting (trans/non) for the line</span>
<a name="l09198"></a>09198             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l09199"></a>09199             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l09200"></a>09200             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l09201"></a>09201 
<a name="l09202"></a>09202 BlitDispatch:
<a name="l09203"></a>09203 
<a name="l09204"></a>09204             cmp         LSCount, 0                                      <span class="comment">// Check to see if we're done blitting</span>
<a name="l09205"></a>09205             je          RightSkipLoop
<a name="l09206"></a>09206 
<a name="l09207"></a>09207             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l09208"></a>09208             inc         esi
<a name="l09209"></a>09209             or          cl, cl
<a name="l09210"></a>09210             js          BlitTransparent
<a name="l09211"></a>09211 
<a name="l09212"></a>09212 BlitNonTransLoop:                                           <span class="comment">// blit non-transparent pixels</span>
<a name="l09213"></a>09213 
<a name="l09214"></a>09214             cmp         ecx, LSCount
<a name="l09215"></a>09215             jbe         BNTrans1
<a name="l09216"></a>09216 
<a name="l09217"></a>09217             sub         ecx, LSCount
<a name="l09218"></a>09218             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, ecx
<a name="l09219"></a>09219             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, LSCount
<a name="l09220"></a>09220 
<a name="l09221"></a>09221 BNTrans1:
<a name="l09222"></a>09222             sub         LSCount, ecx
<a name="l09223"></a>09223 
<a name="l09224"></a>09224 BlitNTL1:
<a name="l09225"></a>09225 
<a name="l09226"></a>09226             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l09227"></a>09227             cmp         ax, usZValue
<a name="l09228"></a>09228             jae         BlitNTL2
<a name="l09229"></a>09229 
<a name="l09230"></a>09230             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, usZValue
<a name="l09231"></a>09231             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [ebx], ax
<a name="l09232"></a>09232 
<a name="l09233"></a>09233             xor         eax, eax
<a name="l09234"></a>09234 
<a name="l09235"></a>09235             mov         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l09236"></a>09236             cmp         al, 254
<a name="l09237"></a>09237             jne         BlitNTL3
<a name="l09238"></a>09238 
<a name="l09239"></a>09239             mov         ax, [edi]
<a name="l09240"></a>09240             mov         ax, <a class="code" href="shading_8cpp.html#fd38e38bdd68f0da44ac96abacf3b2a6">ShadeTable</a>[eax*2]
<a name="l09241"></a>09241             mov         [edi], ax
<a name="l09242"></a>09242             jmp         BlitNTL2
<a name="l09243"></a>09243 
<a name="l09244"></a>09244 BlitNTL3:
<a name="l09245"></a>09245             mov         ax, [edx+eax*2]
<a name="l09246"></a>09246             mov         [edi], ax
<a name="l09247"></a>09247 
<a name="l09248"></a>09248 BlitNTL2:
<a name="l09249"></a>09249             inc         esi
<a name="l09250"></a>09250             add         edi, 2
<a name="l09251"></a>09251             add         ebx, 2
<a name="l09252"></a>09252             dec         cl
<a name="l09253"></a>09253             jnz         BlitNTL1
<a name="l09254"></a>09254 
<a name="l09255"></a>09255 <span class="comment">//BlitLineEnd:</span>
<a name="l09256"></a>09256             add         esi, Unblitted
<a name="l09257"></a>09257             jmp         BlitDispatch
<a name="l09258"></a>09258 
<a name="l09259"></a>09259 BlitTransparent:                                                              <span class="comment">// skip transparent pixels</span>
<a name="l09260"></a>09260 
<a name="l09261"></a>09261             and         ecx, 07fH
<a name="l09262"></a>09262             cmp         ecx, LSCount
<a name="l09263"></a>09263             jbe         BTrans1
<a name="l09264"></a>09264 
<a name="l09265"></a>09265             mov         ecx, LSCount
<a name="l09266"></a>09266 
<a name="l09267"></a>09267 BTrans1:
<a name="l09268"></a>09268 
<a name="l09269"></a>09269             sub         LSCount, ecx
<a name="l09270"></a>09270 <span class="comment">//          shl         ecx, 1</span>
<a name="l09271"></a>09271             add   ecx, ecx
<a name="l09272"></a>09272             add         edi, ecx
<a name="l09273"></a>09273             add         ebx, ecx
<a name="l09274"></a>09274             jmp         BlitDispatch
<a name="l09275"></a>09275 
<a name="l09276"></a>09276 
<a name="l09277"></a>09277 RightSkipLoop:                                                                      <span class="comment">// skip along until we hit and end-of-line marker</span>
<a name="l09278"></a>09278 
<a name="l09279"></a>09279 
<a name="l09280"></a>09280 RSLoop1:
<a name="l09281"></a>09281             mov         al, [esi]
<a name="l09282"></a>09282             inc         esi
<a name="l09283"></a>09283             or          al, al
<a name="l09284"></a>09284             jnz         RSLoop1
<a name="l09285"></a>09285 
<a name="l09286"></a>09286             dec         BlitHeight
<a name="l09287"></a>09287             jz          BlitDone
<a name="l09288"></a>09288             add         edi, LineSkip
<a name="l09289"></a>09289             add         ebx, LineSkip
<a name="l09290"></a>09290 
<a name="l09291"></a>09291             jmp         LeftSkipSetup
<a name="l09292"></a>09292 
<a name="l09293"></a>09293 
<a name="l09294"></a>09294 BlitDone:
<a name="l09295"></a>09295       }
<a name="l09296"></a>09296 
<a name="l09297"></a>09297       <span class="keywordflow">return</span>(TRUE);
<a name="l09298"></a>09298 
<a name="l09299"></a>09299 }
<a name="l09300"></a>09300 
<a name="l09301"></a>09301 
<a name="l09302"></a>09302 <span class="comment">/**********************************************************************************************</span>
<a name="l09303"></a>09303 <span class="comment"> Blt8BPPDataTo16BPPBufferTransShadowClip</span>
<a name="l09304"></a>09304 <span class="comment"></span>
<a name="l09305"></a>09305 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l09306"></a>09306 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l09307"></a>09307 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on, and the Z value is</span>
<a name="l09308"></a>09308 <span class="comment">      updated to the current value, for any non-transparent pixels. The Z-buffer is 16 bit, and</span>
<a name="l09309"></a>09309 <span class="comment">      must be the same dimensions (including Pitch) as the destination. Pixels with a value of</span>
<a name="l09310"></a>09310 <span class="comment">      254 are shaded instead of blitted.</span>
<a name="l09311"></a>09311 <span class="comment"></span>
<a name="l09312"></a>09312 <span class="comment">**********************************************************************************************/</span>
<a name="l09313"></a><a class="code" href="vobject__blitters_8h.html#697046f43bc0e6807f58055e9968b9bc">09313</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#697046f43bc0e6807f58055e9968b9bc">Blt8BPPDataTo16BPPBufferTransShadowClip</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="structSGPRect.html">SGPRect</a> *clipregion, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette )
<a name="l09314"></a>09314 {
<a name="l09315"></a>09315       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l09316"></a>09316       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth, Unblitted;
<a name="l09317"></a>09317       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr;
<a name="l09318"></a>09318       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l09319"></a>09319   <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l09320"></a>09320       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY, LeftSkip, RightSkip, TopSkip, BottomSkip, BlitLength, BlitHeight, LSCount;
<a name="l09321"></a>09321       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  ClipX1, ClipY1, ClipX2, ClipY2;
<a name="l09322"></a>09322 
<a name="l09323"></a>09323       <span class="comment">// Assertions</span>
<a name="l09324"></a>09324       Assert( hSrcVObject != NULL );
<a name="l09325"></a>09325       Assert( pBuffer != NULL );
<a name="l09326"></a>09326 
<a name="l09327"></a>09327       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l09328"></a>09328       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l09329"></a>09329       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l09330"></a>09330       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l09331"></a>09331       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l09332"></a>09332 
<a name="l09333"></a>09333       <span class="comment">// Add to start position of dest buffer</span>
<a name="l09334"></a>09334       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l09335"></a>09335       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l09336"></a>09336 
<a name="l09337"></a>09337       <span class="keywordflow">if</span>(clipregion==NULL)
<a name="l09338"></a>09338       {
<a name="l09339"></a>09339             ClipX1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l09340"></a>09340             ClipY1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l09341"></a>09341             ClipX2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l09342"></a>09342             ClipY2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l09343"></a>09343       }
<a name="l09344"></a>09344       <span class="keywordflow">else</span>
<a name="l09345"></a>09345       {
<a name="l09346"></a>09346             ClipX1=clipregion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l09347"></a>09347             ClipY1=clipregion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l09348"></a>09348             ClipX2=clipregion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l09349"></a>09349             ClipY2=clipregion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l09350"></a>09350       }
<a name="l09351"></a>09351 
<a name="l09352"></a>09352       <span class="comment">// Calculate rows hanging off each side of the screen</span>
<a name="l09353"></a>09353       LeftSkip=__min(ClipX1 - min(ClipX1, iTempX), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l09354"></a>09354       RightSkip=__min(max(ClipX2, (iTempX+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth)) - ClipX2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l09355"></a>09355       TopSkip=__min(ClipY1 - __min(ClipY1, iTempY), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l09356"></a>09356       BottomSkip=__min(__max(ClipY2, (iTempY+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight)) - ClipY2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l09357"></a>09357 
<a name="l09358"></a>09358       <span class="comment">// calculate the remaining rows and columns to blit</span>
<a name="l09359"></a>09359       BlitLength=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth-LeftSkip-RightSkip);
<a name="l09360"></a>09360       BlitHeight=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight-TopSkip-BottomSkip);
<a name="l09361"></a>09361 
<a name="l09362"></a>09362       <span class="comment">// check if whole thing is clipped</span>
<a name="l09363"></a>09363       <span class="keywordflow">if</span>((LeftSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth) || (RightSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth))
<a name="l09364"></a>09364             <span class="keywordflow">return</span>(TRUE);
<a name="l09365"></a>09365 
<a name="l09366"></a>09366       <span class="comment">// check if whole thing is clipped</span>
<a name="l09367"></a>09367       <span class="keywordflow">if</span>((TopSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight) || (BottomSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight))
<a name="l09368"></a>09368             <span class="keywordflow">return</span>(TRUE);
<a name="l09369"></a>09369 
<a name="l09370"></a>09370       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l09371"></a>09371       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l09372"></a>09372       LineSkip=(uiDestPitchBYTES-(BlitLength*2));
<a name="l09373"></a>09373 
<a name="l09374"></a>09374       __asm {
<a name="l09375"></a>09375 
<a name="l09376"></a>09376             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l09377"></a>09377             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l09378"></a>09378             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, p16BPPPalette
<a name="l09379"></a>09379             xor         eax, eax
<a name="l09380"></a>09380             xor         ecx, ecx
<a name="l09381"></a>09381 
<a name="l09382"></a>09382             cmp         TopSkip, 0                                      <span class="comment">// check for nothing clipped on top</span>
<a name="l09383"></a>09383             je          LeftSkipSetup
<a name="l09384"></a>09384 
<a name="l09385"></a>09385 TopSkipLoop:                                                            <span class="comment">// Skips the number of lines clipped at the top</span>
<a name="l09386"></a>09386 
<a name="l09387"></a>09387             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l09388"></a>09388             inc         esi
<a name="l09389"></a>09389             or          cl, cl
<a name="l09390"></a>09390             js          TopSkipLoop
<a name="l09391"></a>09391             jz          TSEndLine
<a name="l09392"></a>09392 
<a name="l09393"></a>09393             add         esi, ecx
<a name="l09394"></a>09394             jmp         TopSkipLoop
<a name="l09395"></a>09395 
<a name="l09396"></a>09396 TSEndLine:
<a name="l09397"></a>09397             dec         TopSkip
<a name="l09398"></a>09398             jnz         TopSkipLoop
<a name="l09399"></a>09399 
<a name="l09400"></a>09400 LeftSkipSetup:
<a name="l09401"></a>09401 
<a name="l09402"></a>09402             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l09403"></a>09403             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, LeftSkip
<a name="l09404"></a>09404             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l09405"></a>09405             or          eax, eax
<a name="l09406"></a>09406             jz          BlitLineSetup
<a name="l09407"></a>09407 
<a name="l09408"></a>09408 LeftSkipLoop:
<a name="l09409"></a>09409 
<a name="l09410"></a>09410             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l09411"></a>09411             inc         esi
<a name="l09412"></a>09412 
<a name="l09413"></a>09413             or          cl, cl
<a name="l09414"></a>09414             js          LSTrans
<a name="l09415"></a>09415 
<a name="l09416"></a>09416             cmp         ecx, LSCount
<a name="l09417"></a>09417             je          LSSkip2                                               <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l09418"></a>09418             jb          LSSkip1                                               <span class="comment">// if less, skip whole thing</span>
<a name="l09419"></a>09419 
<a name="l09420"></a>09420             add         esi, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l09421"></a>09421             sub         ecx, LSCount
<a name="l09422"></a>09422             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l09423"></a>09423             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l09424"></a>09424             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l09425"></a>09425             jmp         BlitNonTransLoop
<a name="l09426"></a>09426 
<a name="l09427"></a>09427 LSSkip2:
<a name="l09428"></a>09428             add         esi, ecx                                        <span class="comment">// skip whole run, and start blit with new run</span>
<a name="l09429"></a>09429             jmp         BlitLineSetup
<a name="l09430"></a>09430 
<a name="l09431"></a>09431 
<a name="l09432"></a>09432 LSSkip1:
<a name="l09433"></a>09433             add         esi, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l09434"></a>09434             sub         LSCount, ecx
<a name="l09435"></a>09435             jmp         LeftSkipLoop
<a name="l09436"></a>09436 
<a name="l09437"></a>09437 
<a name="l09438"></a>09438 LSTrans:
<a name="l09439"></a>09439             and         ecx, 07fH
<a name="l09440"></a>09440             cmp         ecx, LSCount
<a name="l09441"></a>09441             je          BlitLineSetup                             <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l09442"></a>09442             jb          LSTrans1                                        <span class="comment">// if less, skip whole thing</span>
<a name="l09443"></a>09443 
<a name="l09444"></a>09444             sub         ecx, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l09445"></a>09445             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l09446"></a>09446             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l09447"></a>09447             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l09448"></a>09448             jmp         BlitTransparent
<a name="l09449"></a>09449 
<a name="l09450"></a>09450 
<a name="l09451"></a>09451 LSTrans1:
<a name="l09452"></a>09452             sub         LSCount, ecx                                          <span class="comment">// skip whole run, continue skipping</span>
<a name="l09453"></a>09453             jmp         LeftSkipLoop
<a name="l09454"></a>09454 
<a name="l09455"></a>09455 
<a name="l09456"></a>09456 BlitLineSetup:                                                    <span class="comment">// Does any actual blitting (trans/non) for the line</span>
<a name="l09457"></a>09457             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l09458"></a>09458             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l09459"></a>09459             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l09460"></a>09460 
<a name="l09461"></a>09461 BlitDispatch:
<a name="l09462"></a>09462 
<a name="l09463"></a>09463             cmp         LSCount, 0                                      <span class="comment">// Check to see if we're done blitting</span>
<a name="l09464"></a>09464             je          RightSkipLoop
<a name="l09465"></a>09465 
<a name="l09466"></a>09466             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l09467"></a>09467             inc         esi
<a name="l09468"></a>09468             or          cl, cl
<a name="l09469"></a>09469             js          BlitTransparent
<a name="l09470"></a>09470 
<a name="l09471"></a>09471 BlitNonTransLoop:                                           <span class="comment">// blit non-transparent pixels</span>
<a name="l09472"></a>09472 
<a name="l09473"></a>09473             cmp         ecx, LSCount
<a name="l09474"></a>09474             jbe         BNTrans1
<a name="l09475"></a>09475 
<a name="l09476"></a>09476             sub         ecx, LSCount
<a name="l09477"></a>09477             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, ecx
<a name="l09478"></a>09478             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, LSCount
<a name="l09479"></a>09479 
<a name="l09480"></a>09480 BNTrans1:
<a name="l09481"></a>09481             sub         LSCount, ecx
<a name="l09482"></a>09482 
<a name="l09483"></a>09483 BlitNTL1:
<a name="l09484"></a>09484             xor         eax, eax
<a name="l09485"></a>09485 
<a name="l09486"></a>09486             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l09487"></a>09487             cmp         al, 254
<a name="l09488"></a>09488             jne         BlitNTL3
<a name="l09489"></a>09489 
<a name="l09490"></a>09490             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [edi]
<a name="l09491"></a>09491             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, <a class="code" href="shading_8cpp.html#fd38e38bdd68f0da44ac96abacf3b2a6">ShadeTable</a>[eax*2]
<a name="l09492"></a>09492             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax
<a name="l09493"></a>09493             jmp         BlitNTL2
<a name="l09494"></a>09494 
<a name="l09495"></a>09495 BlitNTL3:
<a name="l09496"></a>09496             mov         ax, [edx+eax*2]
<a name="l09497"></a>09497             mov         [edi], ax
<a name="l09498"></a>09498 
<a name="l09499"></a>09499 BlitNTL2:
<a name="l09500"></a>09500             inc         esi
<a name="l09501"></a>09501             add         edi, 2
<a name="l09502"></a>09502             dec         cl
<a name="l09503"></a>09503             jnz         BlitNTL1
<a name="l09504"></a>09504 
<a name="l09505"></a>09505 <span class="comment">//BlitLineEnd:</span>
<a name="l09506"></a>09506             add         esi, Unblitted
<a name="l09507"></a>09507             jmp         BlitDispatch
<a name="l09508"></a>09508 
<a name="l09509"></a>09509 BlitTransparent:                                                              <span class="comment">// skip transparent pixels</span>
<a name="l09510"></a>09510 
<a name="l09511"></a>09511             and         ecx, 07fH
<a name="l09512"></a>09512             cmp         ecx, LSCount
<a name="l09513"></a>09513             jbe         BTrans1
<a name="l09514"></a>09514 
<a name="l09515"></a>09515             mov         ecx, LSCount
<a name="l09516"></a>09516 
<a name="l09517"></a>09517 BTrans1:
<a name="l09518"></a>09518 
<a name="l09519"></a>09519             sub         LSCount, ecx
<a name="l09520"></a>09520 <span class="comment">//          shl         ecx, 1</span>
<a name="l09521"></a>09521             add   ecx, ecx
<a name="l09522"></a>09522             add         edi, ecx
<a name="l09523"></a>09523             jmp         BlitDispatch
<a name="l09524"></a>09524 
<a name="l09525"></a>09525 
<a name="l09526"></a>09526 RightSkipLoop:                                                                      <span class="comment">// skip along until we hit and end-of-line marker</span>
<a name="l09527"></a>09527 
<a name="l09528"></a>09528 
<a name="l09529"></a>09529 RSLoop1:
<a name="l09530"></a>09530             mov         al, [esi]
<a name="l09531"></a>09531             inc         esi
<a name="l09532"></a>09532             or          al, al
<a name="l09533"></a>09533             jnz         RSLoop1
<a name="l09534"></a>09534 
<a name="l09535"></a>09535             dec         BlitHeight
<a name="l09536"></a>09536             jz          BlitDone
<a name="l09537"></a>09537             add         edi, LineSkip
<a name="l09538"></a>09538 
<a name="l09539"></a>09539             jmp         LeftSkipSetup
<a name="l09540"></a>09540 
<a name="l09541"></a>09541 
<a name="l09542"></a>09542 BlitDone:
<a name="l09543"></a>09543       }
<a name="l09544"></a>09544 
<a name="l09545"></a>09545       <span class="keywordflow">return</span>(TRUE);
<a name="l09546"></a>09546 
<a name="l09547"></a>09547 }
<a name="l09548"></a>09548 
<a name="l09549"></a>09549 <span class="comment">/**********************************************************************************************</span>
<a name="l09550"></a>09550 <span class="comment"> Blt8BPPDataTo16BPPBufferTransShadowZNBClip</span>
<a name="l09551"></a>09551 <span class="comment"></span>
<a name="l09552"></a>09552 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l09553"></a>09553 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l09554"></a>09554 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on.</span>
<a name="l09555"></a>09555 <span class="comment">      The Z-buffer is 16 bit, and   must be the same dimensions (including Pitch) as the</span>
<a name="l09556"></a>09556 <span class="comment">      destination. Pixels with a value of 254 are shaded instead of blitted. The Z buffer is</span>
<a name="l09557"></a>09557 <span class="comment">      NOT updated.</span>
<a name="l09558"></a>09558 <span class="comment"></span>
<a name="l09559"></a>09559 <span class="comment">**********************************************************************************************/</span>
<a name="l09560"></a><a class="code" href="vobject__blitters_8h.html#a356017a5b3a559f36c77c48999ba244">09560</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#a356017a5b3a559f36c77c48999ba244">Blt8BPPDataTo16BPPBufferTransShadowZNBClip</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="structSGPRect.html">SGPRect</a> *clipregion, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette )
<a name="l09561"></a>09561 {
<a name="l09562"></a>09562       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l09563"></a>09563       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth, Unblitted;
<a name="l09564"></a>09564       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l09565"></a>09565       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l09566"></a>09566   <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l09567"></a>09567       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY, LeftSkip, RightSkip, TopSkip, BottomSkip, BlitLength, BlitHeight, LSCount;
<a name="l09568"></a>09568       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  ClipX1, ClipY1, ClipX2, ClipY2;
<a name="l09569"></a>09569 
<a name="l09570"></a>09570       <span class="comment">// Assertions</span>
<a name="l09571"></a>09571       Assert( hSrcVObject != NULL );
<a name="l09572"></a>09572       Assert( pBuffer != NULL );
<a name="l09573"></a>09573 
<a name="l09574"></a>09574       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l09575"></a>09575       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l09576"></a>09576       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l09577"></a>09577       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l09578"></a>09578       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l09579"></a>09579 
<a name="l09580"></a>09580       <span class="comment">// Add to start position of dest buffer</span>
<a name="l09581"></a>09581       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l09582"></a>09582       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l09583"></a>09583 
<a name="l09584"></a>09584       <span class="keywordflow">if</span>(clipregion==NULL)
<a name="l09585"></a>09585       {
<a name="l09586"></a>09586             ClipX1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l09587"></a>09587             ClipY1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l09588"></a>09588             ClipX2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l09589"></a>09589             ClipY2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l09590"></a>09590       }
<a name="l09591"></a>09591       <span class="keywordflow">else</span>
<a name="l09592"></a>09592       {
<a name="l09593"></a>09593             ClipX1=clipregion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l09594"></a>09594             ClipY1=clipregion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l09595"></a>09595             ClipX2=clipregion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l09596"></a>09596             ClipY2=clipregion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l09597"></a>09597       }
<a name="l09598"></a>09598 
<a name="l09599"></a>09599       <span class="comment">// Calculate rows hanging off each side of the screen</span>
<a name="l09600"></a>09600       LeftSkip=__min(ClipX1 - min(ClipX1, iTempX), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l09601"></a>09601       RightSkip=__min(max(ClipX2, (iTempX+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth)) - ClipX2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l09602"></a>09602       TopSkip=__min(ClipY1 - __min(ClipY1, iTempY), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l09603"></a>09603       BottomSkip=__min(__max(ClipY2, (iTempY+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight)) - ClipY2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l09604"></a>09604 
<a name="l09605"></a>09605       <span class="comment">// calculate the remaining rows and columns to blit</span>
<a name="l09606"></a>09606       BlitLength=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth-LeftSkip-RightSkip);
<a name="l09607"></a>09607       BlitHeight=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight-TopSkip-BottomSkip);
<a name="l09608"></a>09608 
<a name="l09609"></a>09609       <span class="comment">// check if whole thing is clipped</span>
<a name="l09610"></a>09610       <span class="keywordflow">if</span>((LeftSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth) || (RightSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth))
<a name="l09611"></a>09611             <span class="keywordflow">return</span>(TRUE);
<a name="l09612"></a>09612 
<a name="l09613"></a>09613       <span class="comment">// check if whole thing is clipped</span>
<a name="l09614"></a>09614       <span class="keywordflow">if</span>((TopSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight) || (BottomSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight))
<a name="l09615"></a>09615             <span class="keywordflow">return</span>(TRUE);
<a name="l09616"></a>09616 
<a name="l09617"></a>09617       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l09618"></a>09618       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l09619"></a>09619       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l09620"></a>09620       LineSkip=(uiDestPitchBYTES-(BlitLength*2));
<a name="l09621"></a>09621 
<a name="l09622"></a>09622       __asm {
<a name="l09623"></a>09623 
<a name="l09624"></a>09624             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l09625"></a>09625             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l09626"></a>09626             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, p16BPPPalette
<a name="l09627"></a>09627             xor         eax, eax
<a name="l09628"></a>09628             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l09629"></a>09629             xor         ecx, ecx
<a name="l09630"></a>09630 
<a name="l09631"></a>09631             cmp         TopSkip, 0                                      <span class="comment">// check for nothing clipped on top</span>
<a name="l09632"></a>09632             je          LeftSkipSetup
<a name="l09633"></a>09633 
<a name="l09634"></a>09634 TopSkipLoop:                                                            <span class="comment">// Skips the number of lines clipped at the top</span>
<a name="l09635"></a>09635 
<a name="l09636"></a>09636             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l09637"></a>09637             inc         esi
<a name="l09638"></a>09638             or          cl, cl
<a name="l09639"></a>09639             js          TopSkipLoop
<a name="l09640"></a>09640             jz          TSEndLine
<a name="l09641"></a>09641 
<a name="l09642"></a>09642             add         esi, ecx
<a name="l09643"></a>09643             jmp         TopSkipLoop
<a name="l09644"></a>09644 
<a name="l09645"></a>09645 TSEndLine:
<a name="l09646"></a>09646             dec         TopSkip
<a name="l09647"></a>09647             jnz         TopSkipLoop
<a name="l09648"></a>09648 
<a name="l09649"></a>09649 LeftSkipSetup:
<a name="l09650"></a>09650 
<a name="l09651"></a>09651             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l09652"></a>09652             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, LeftSkip
<a name="l09653"></a>09653             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l09654"></a>09654             or          eax, eax
<a name="l09655"></a>09655             jz          BlitLineSetup
<a name="l09656"></a>09656 
<a name="l09657"></a>09657 LeftSkipLoop:
<a name="l09658"></a>09658 
<a name="l09659"></a>09659             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l09660"></a>09660             inc         esi
<a name="l09661"></a>09661 
<a name="l09662"></a>09662             or          cl, cl
<a name="l09663"></a>09663             js          LSTrans
<a name="l09664"></a>09664 
<a name="l09665"></a>09665             cmp         ecx, LSCount
<a name="l09666"></a>09666             je          LSSkip2                                               <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l09667"></a>09667             jb          LSSkip1                                               <span class="comment">// if less, skip whole thing</span>
<a name="l09668"></a>09668 
<a name="l09669"></a>09669             add         esi, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l09670"></a>09670             sub         ecx, LSCount
<a name="l09671"></a>09671             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l09672"></a>09672             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l09673"></a>09673             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l09674"></a>09674             jmp         BlitNonTransLoop
<a name="l09675"></a>09675 
<a name="l09676"></a>09676 LSSkip2:
<a name="l09677"></a>09677             add         esi, ecx                                        <span class="comment">// skip whole run, and start blit with new run</span>
<a name="l09678"></a>09678             jmp         BlitLineSetup
<a name="l09679"></a>09679 
<a name="l09680"></a>09680 
<a name="l09681"></a>09681 LSSkip1:
<a name="l09682"></a>09682             add         esi, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l09683"></a>09683             sub         LSCount, ecx
<a name="l09684"></a>09684             jmp         LeftSkipLoop
<a name="l09685"></a>09685 
<a name="l09686"></a>09686 
<a name="l09687"></a>09687 LSTrans:
<a name="l09688"></a>09688             and         ecx, 07fH
<a name="l09689"></a>09689             cmp         ecx, LSCount
<a name="l09690"></a>09690             je          BlitLineSetup                             <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l09691"></a>09691             jb          LSTrans1                                        <span class="comment">// if less, skip whole thing</span>
<a name="l09692"></a>09692 
<a name="l09693"></a>09693             sub         ecx, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l09694"></a>09694             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l09695"></a>09695             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l09696"></a>09696             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l09697"></a>09697             jmp         BlitTransparent
<a name="l09698"></a>09698 
<a name="l09699"></a>09699 
<a name="l09700"></a>09700 LSTrans1:
<a name="l09701"></a>09701             sub         LSCount, ecx                                          <span class="comment">// skip whole run, continue skipping</span>
<a name="l09702"></a>09702             jmp         LeftSkipLoop
<a name="l09703"></a>09703 
<a name="l09704"></a>09704 
<a name="l09705"></a>09705 BlitLineSetup:                                                    <span class="comment">// Does any actual blitting (trans/non) for the line</span>
<a name="l09706"></a>09706             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l09707"></a>09707             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l09708"></a>09708             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l09709"></a>09709 
<a name="l09710"></a>09710 BlitDispatch:
<a name="l09711"></a>09711 
<a name="l09712"></a>09712             cmp         LSCount, 0                                      <span class="comment">// Check to see if we're done blitting</span>
<a name="l09713"></a>09713             je          RightSkipLoop
<a name="l09714"></a>09714 
<a name="l09715"></a>09715             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l09716"></a>09716             inc         esi
<a name="l09717"></a>09717             or          cl, cl
<a name="l09718"></a>09718             js          BlitTransparent
<a name="l09719"></a>09719 
<a name="l09720"></a>09720 BlitNonTransLoop:                                           <span class="comment">// blit non-transparent pixels</span>
<a name="l09721"></a>09721 
<a name="l09722"></a>09722             cmp         ecx, LSCount
<a name="l09723"></a>09723             jbe         BNTrans1
<a name="l09724"></a>09724 
<a name="l09725"></a>09725             sub         ecx, LSCount
<a name="l09726"></a>09726             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, ecx
<a name="l09727"></a>09727             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, LSCount
<a name="l09728"></a>09728 
<a name="l09729"></a>09729 BNTrans1:
<a name="l09730"></a>09730             sub         LSCount, ecx
<a name="l09731"></a>09731 
<a name="l09732"></a>09732 BlitNTL1:
<a name="l09733"></a>09733 
<a name="l09734"></a>09734             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l09735"></a>09735             cmp         ax, usZValue
<a name="l09736"></a>09736             ja          BlitNTL2
<a name="l09737"></a>09737 
<a name="l09738"></a>09738             xor         eax, eax
<a name="l09739"></a>09739 
<a name="l09740"></a>09740             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l09741"></a>09741             cmp         al, 254
<a name="l09742"></a>09742             jne         BlitNTL3
<a name="l09743"></a>09743 
<a name="l09744"></a>09744             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, [ebx]
<a name="l09745"></a>09745             cmp         ax, usZValue
<a name="l09746"></a>09746             jae         BlitNTL2
<a name="l09747"></a>09747 
<a name="l09748"></a>09748             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, [edi]
<a name="l09749"></a>09749             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, <a class="code" href="shading_8cpp.html#fd38e38bdd68f0da44ac96abacf3b2a6">ShadeTable</a>[eax*2]
<a name="l09750"></a>09750             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax
<a name="l09751"></a>09751             jmp         BlitNTL2
<a name="l09752"></a>09752 
<a name="l09753"></a>09753 BlitNTL3:
<a name="l09754"></a>09754             mov         ax, [edx+eax*2]
<a name="l09755"></a>09755             mov         [edi], ax
<a name="l09756"></a>09756 
<a name="l09757"></a>09757 BlitNTL2:
<a name="l09758"></a>09758             inc         esi
<a name="l09759"></a>09759             add         edi, 2
<a name="l09760"></a>09760             add         ebx, 2
<a name="l09761"></a>09761             dec         cl
<a name="l09762"></a>09762             jnz         BlitNTL1
<a name="l09763"></a>09763 
<a name="l09764"></a>09764 <span class="comment">//BlitLineEnd:</span>
<a name="l09765"></a>09765             add         esi, Unblitted
<a name="l09766"></a>09766             jmp         BlitDispatch
<a name="l09767"></a>09767 
<a name="l09768"></a>09768 BlitTransparent:                                                              <span class="comment">// skip transparent pixels</span>
<a name="l09769"></a>09769 
<a name="l09770"></a>09770             and         ecx, 07fH
<a name="l09771"></a>09771             cmp         ecx, LSCount
<a name="l09772"></a>09772             jbe         BTrans1
<a name="l09773"></a>09773 
<a name="l09774"></a>09774             mov         ecx, LSCount
<a name="l09775"></a>09775 
<a name="l09776"></a>09776 BTrans1:
<a name="l09777"></a>09777 
<a name="l09778"></a>09778             sub         LSCount, ecx
<a name="l09779"></a>09779 <span class="comment">//          shl         ecx, 1</span>
<a name="l09780"></a>09780             add   ecx, ecx
<a name="l09781"></a>09781             add         edi, ecx
<a name="l09782"></a>09782             add         ebx, ecx
<a name="l09783"></a>09783             jmp         BlitDispatch
<a name="l09784"></a>09784 
<a name="l09785"></a>09785 
<a name="l09786"></a>09786 RightSkipLoop:                                                                      <span class="comment">// skip along until we hit and end-of-line marker</span>
<a name="l09787"></a>09787 
<a name="l09788"></a>09788 
<a name="l09789"></a>09789 RSLoop1:
<a name="l09790"></a>09790             mov         al, [esi]
<a name="l09791"></a>09791             inc         esi
<a name="l09792"></a>09792             or          al, al
<a name="l09793"></a>09793             jnz         RSLoop1
<a name="l09794"></a>09794 
<a name="l09795"></a>09795             dec         BlitHeight
<a name="l09796"></a>09796             jz          BlitDone
<a name="l09797"></a>09797             add         edi, LineSkip
<a name="l09798"></a>09798             add         ebx, LineSkip
<a name="l09799"></a>09799 
<a name="l09800"></a>09800             jmp         LeftSkipSetup
<a name="l09801"></a>09801 
<a name="l09802"></a>09802 
<a name="l09803"></a>09803 BlitDone:
<a name="l09804"></a>09804       }
<a name="l09805"></a>09805 
<a name="l09806"></a>09806       <span class="keywordflow">return</span>(TRUE);
<a name="l09807"></a>09807 
<a name="l09808"></a>09808 }
<a name="l09809"></a>09809 
<a name="l09810"></a>09810 
<a name="l09811"></a>09811 <span class="comment">/**********************************************************************************************</span>
<a name="l09812"></a>09812 <span class="comment"> Blt8BPPDataTo16BPPBufferTransShadowZNBClip</span>
<a name="l09813"></a>09813 <span class="comment"></span>
<a name="l09814"></a>09814 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l09815"></a>09815 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l09816"></a>09816 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on.</span>
<a name="l09817"></a>09817 <span class="comment">      The Z-buffer is 16 bit, and   must be the same dimensions (including Pitch) as the</span>
<a name="l09818"></a>09818 <span class="comment">      destination. Pixels with a value of 254 are shaded instead of blitted. The Z buffer is</span>
<a name="l09819"></a>09819 <span class="comment">      NOT updated.</span>
<a name="l09820"></a>09820 <span class="comment"></span>
<a name="l09821"></a>09821 <span class="comment">**********************************************************************************************/</span>
<a name="l09822"></a><a class="code" href="vobject__blitters_8h.html#33ec3f4fb480172c7a03d0ca695076a8">09822</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#33ec3f4fb480172c7a03d0ca695076a8">Blt8BPPDataTo16BPPBufferTransShadowZNBObscuredClip</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="structSGPRect.html">SGPRect</a> *clipregion, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette )
<a name="l09823"></a>09823 {
<a name="l09824"></a>09824       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l09825"></a>09825       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth, Unblitted, uiLineFlag;
<a name="l09826"></a>09826       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l09827"></a>09827       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l09828"></a>09828   <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l09829"></a>09829       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY, LeftSkip, RightSkip, TopSkip, BottomSkip, BlitLength, BlitHeight, LSCount;
<a name="l09830"></a>09830       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  ClipX1, ClipY1, ClipX2, ClipY2;
<a name="l09831"></a>09831 
<a name="l09832"></a>09832       <span class="comment">// Assertions</span>
<a name="l09833"></a>09833       Assert( hSrcVObject != NULL );
<a name="l09834"></a>09834       Assert( pBuffer != NULL );
<a name="l09835"></a>09835 
<a name="l09836"></a>09836       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l09837"></a>09837       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l09838"></a>09838       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l09839"></a>09839       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l09840"></a>09840       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l09841"></a>09841 
<a name="l09842"></a>09842       <span class="comment">// Add to start position of dest buffer</span>
<a name="l09843"></a>09843       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l09844"></a>09844       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l09845"></a>09845 
<a name="l09846"></a>09846       <span class="keywordflow">if</span>(clipregion==NULL)
<a name="l09847"></a>09847       {
<a name="l09848"></a>09848             ClipX1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l09849"></a>09849             ClipY1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l09850"></a>09850             ClipX2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l09851"></a>09851             ClipY2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l09852"></a>09852       }
<a name="l09853"></a>09853       <span class="keywordflow">else</span>
<a name="l09854"></a>09854       {
<a name="l09855"></a>09855             ClipX1=clipregion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l09856"></a>09856             ClipY1=clipregion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l09857"></a>09857             ClipX2=clipregion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l09858"></a>09858             ClipY2=clipregion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l09859"></a>09859       }
<a name="l09860"></a>09860 
<a name="l09861"></a>09861       <span class="comment">// Calculate rows hanging off each side of the screen</span>
<a name="l09862"></a>09862       LeftSkip=__min(ClipX1 - min(ClipX1, iTempX), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l09863"></a>09863       RightSkip=__min(max(ClipX2, (iTempX+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth)) - ClipX2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l09864"></a>09864       TopSkip=__min(ClipY1 - __min(ClipY1, iTempY), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l09865"></a>09865       BottomSkip=__min(__max(ClipY2, (iTempY+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight)) - ClipY2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l09866"></a>09866 
<a name="l09867"></a>09867       <span class="comment">// calculate the remaining rows and columns to blit</span>
<a name="l09868"></a>09868       BlitLength=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth-LeftSkip-RightSkip);
<a name="l09869"></a>09869       BlitHeight=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight-TopSkip-BottomSkip);
<a name="l09870"></a>09870 
<a name="l09871"></a>09871       <span class="comment">// check if whole thing is clipped</span>
<a name="l09872"></a>09872       <span class="keywordflow">if</span>((LeftSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth) || (RightSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth))
<a name="l09873"></a>09873             <span class="keywordflow">return</span>(TRUE);
<a name="l09874"></a>09874 
<a name="l09875"></a>09875       <span class="comment">// check if whole thing is clipped</span>
<a name="l09876"></a>09876       <span class="keywordflow">if</span>((TopSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight) || (BottomSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight))
<a name="l09877"></a>09877             <span class="keywordflow">return</span>(TRUE);
<a name="l09878"></a>09878 
<a name="l09879"></a>09879       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l09880"></a>09880       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l09881"></a>09881       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l09882"></a>09882       LineSkip=(uiDestPitchBYTES-(BlitLength*2));
<a name="l09883"></a>09883 
<a name="l09884"></a>09884       __asm {
<a name="l09885"></a>09885 
<a name="l09886"></a>09886             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l09887"></a>09887             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l09888"></a>09888             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, p16BPPPalette
<a name="l09889"></a>09889             xor         eax, eax
<a name="l09890"></a>09890             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l09891"></a>09891             xor         ecx, ecx
<a name="l09892"></a>09892 
<a name="l09893"></a>09893             cmp         TopSkip, 0                                      <span class="comment">// check for nothing clipped on top</span>
<a name="l09894"></a>09894             je          LeftSkipSetup
<a name="l09895"></a>09895 
<a name="l09896"></a>09896 TopSkipLoop:                                                            <span class="comment">// Skips the number of lines clipped at the top</span>
<a name="l09897"></a>09897 
<a name="l09898"></a>09898             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l09899"></a>09899             inc         esi
<a name="l09900"></a>09900             or          cl, cl
<a name="l09901"></a>09901             js          TopSkipLoop
<a name="l09902"></a>09902             jz          TSEndLine
<a name="l09903"></a>09903 
<a name="l09904"></a>09904             add         esi, ecx
<a name="l09905"></a>09905             jmp         TopSkipLoop
<a name="l09906"></a>09906 
<a name="l09907"></a>09907 TSEndLine:
<a name="l09908"></a>09908 
<a name="l09909"></a>09909             xor         uiLineFlag, 1
<a name="l09910"></a>09910             dec         TopSkip
<a name="l09911"></a>09911             jnz         TopSkipLoop
<a name="l09912"></a>09912 
<a name="l09913"></a>09913 LeftSkipSetup:
<a name="l09914"></a>09914 
<a name="l09915"></a>09915             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l09916"></a>09916             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, LeftSkip
<a name="l09917"></a>09917             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l09918"></a>09918             or          eax, eax
<a name="l09919"></a>09919             jz          BlitLineSetup
<a name="l09920"></a>09920 
<a name="l09921"></a>09921 LeftSkipLoop:
<a name="l09922"></a>09922 
<a name="l09923"></a>09923             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l09924"></a>09924             inc         esi
<a name="l09925"></a>09925 
<a name="l09926"></a>09926             or          cl, cl
<a name="l09927"></a>09927             js          LSTrans
<a name="l09928"></a>09928 
<a name="l09929"></a>09929             cmp         ecx, LSCount
<a name="l09930"></a>09930             je          LSSkip2                                               <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l09931"></a>09931             jb          LSSkip1                                               <span class="comment">// if less, skip whole thing</span>
<a name="l09932"></a>09932 
<a name="l09933"></a>09933             add         esi, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l09934"></a>09934             sub         ecx, LSCount
<a name="l09935"></a>09935             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l09936"></a>09936             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l09937"></a>09937             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l09938"></a>09938             jmp         BlitNonTransLoop
<a name="l09939"></a>09939 
<a name="l09940"></a>09940 LSSkip2:
<a name="l09941"></a>09941             add         esi, ecx                                        <span class="comment">// skip whole run, and start blit with new run</span>
<a name="l09942"></a>09942             jmp         BlitLineSetup
<a name="l09943"></a>09943 
<a name="l09944"></a>09944 
<a name="l09945"></a>09945 LSSkip1:
<a name="l09946"></a>09946             add         esi, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l09947"></a>09947             sub         LSCount, ecx
<a name="l09948"></a>09948             jmp         LeftSkipLoop
<a name="l09949"></a>09949 
<a name="l09950"></a>09950 
<a name="l09951"></a>09951 LSTrans:
<a name="l09952"></a>09952             and         ecx, 07fH
<a name="l09953"></a>09953             cmp         ecx, LSCount
<a name="l09954"></a>09954             je          BlitLineSetup                             <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l09955"></a>09955             jb          LSTrans1                                        <span class="comment">// if less, skip whole thing</span>
<a name="l09956"></a>09956 
<a name="l09957"></a>09957             sub         ecx, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l09958"></a>09958             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l09959"></a>09959             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l09960"></a>09960             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l09961"></a>09961             jmp         BlitTransparent
<a name="l09962"></a>09962 
<a name="l09963"></a>09963 
<a name="l09964"></a>09964 LSTrans1:
<a name="l09965"></a>09965             sub         LSCount, ecx                                          <span class="comment">// skip whole run, continue skipping</span>
<a name="l09966"></a>09966             jmp         LeftSkipLoop
<a name="l09967"></a>09967 
<a name="l09968"></a>09968 
<a name="l09969"></a>09969 BlitLineSetup:                                                    <span class="comment">// Does any actual blitting (trans/non) for the line</span>
<a name="l09970"></a>09970             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l09971"></a>09971             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l09972"></a>09972             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l09973"></a>09973 
<a name="l09974"></a>09974 BlitDispatch:
<a name="l09975"></a>09975 
<a name="l09976"></a>09976             cmp         LSCount, 0                                      <span class="comment">// Check to see if we're done blitting</span>
<a name="l09977"></a>09977             je          RightSkipLoop
<a name="l09978"></a>09978 
<a name="l09979"></a>09979             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l09980"></a>09980             inc         esi
<a name="l09981"></a>09981             or          cl, cl
<a name="l09982"></a>09982             js          BlitTransparent
<a name="l09983"></a>09983 
<a name="l09984"></a>09984 BlitNonTransLoop:                                           <span class="comment">// blit non-transparent pixels</span>
<a name="l09985"></a>09985 
<a name="l09986"></a>09986             cmp         ecx, LSCount
<a name="l09987"></a>09987             jbe         BNTrans1
<a name="l09988"></a>09988 
<a name="l09989"></a>09989             sub         ecx, LSCount
<a name="l09990"></a>09990             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, ecx
<a name="l09991"></a>09991             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, LSCount
<a name="l09992"></a>09992 
<a name="l09993"></a>09993 BNTrans1:
<a name="l09994"></a>09994             sub         LSCount, ecx
<a name="l09995"></a>09995 
<a name="l09996"></a>09996 BlitNTL1:
<a name="l09997"></a>09997 
<a name="l09998"></a>09998             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l09999"></a>09999             cmp         ax, usZValue
<a name="l10000"></a>10000             ja          BlitPixellate
<a name="l10001"></a>10001 
<a name="l10002"></a>10002             xor         eax, eax
<a name="l10003"></a>10003             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l10004"></a>10004             cmp         al, 254
<a name="l10005"></a>10005             jne         BlitNTL3
<a name="l10006"></a>10006 
<a name="l10007"></a>10007             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, [ebx]
<a name="l10008"></a>10008             cmp         ax, usZValue
<a name="l10009"></a>10009             jae         BlitNTL2
<a name="l10010"></a>10010 
<a name="l10011"></a>10011             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, [edi]
<a name="l10012"></a>10012             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, <a class="code" href="shading_8cpp.html#fd38e38bdd68f0da44ac96abacf3b2a6">ShadeTable</a>[eax*2]
<a name="l10013"></a>10013             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax
<a name="l10014"></a>10014             jmp         BlitNTL2
<a name="l10015"></a>10015 
<a name="l10016"></a>10016 BlitPixellate:
<a name="l10017"></a>10017 
<a name="l10018"></a>10018             xor         eax, eax
<a name="l10019"></a>10019             mov         al, [esi]
<a name="l10020"></a>10020             cmp         al, 254
<a name="l10021"></a>10021             je          BlitNTL2
<a name="l10022"></a>10022 
<a name="l10023"></a>10023             <a class="code" href="structtest.html">test</a>  uiLineFlag, 1
<a name="l10024"></a>10024             jz          <a class="code" href="vobject__blitters_8cpp.html#0e7ffd1e4d81460c5ee051765cc57418">BlitNTL9</a>
<a name="l10025"></a>10025 
<a name="l10026"></a>10026             <a class="code" href="structtest.html">test</a>  edi, 2
<a name="l10027"></a>10027             jz          BlitNTL2
<a name="l10028"></a>10028             jmp         BlitNTL3
<a name="l10029"></a>10029 
<a name="l10030"></a>10030 <a class="code" href="vobject__blitters_8cpp.html#0e7ffd1e4d81460c5ee051765cc57418">BlitNTL9</a>:
<a name="l10031"></a>10031             <a class="code" href="structtest.html">test</a>  edi, 2
<a name="l10032"></a>10032             jnz         BlitNTL2
<a name="l10033"></a>10033 
<a name="l10034"></a>10034 
<a name="l10035"></a>10035 BlitNTL3:
<a name="l10036"></a>10036 
<a name="l10037"></a>10037             xor         eax, eax
<a name="l10038"></a>10038             mov         al, [esi]
<a name="l10039"></a>10039             mov         ax, [edx+eax*2]
<a name="l10040"></a>10040             mov         [<a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>], ax
<a name="l10041"></a>10041 
<a name="l10042"></a>10042 BlitNTL2:
<a name="l10043"></a>10043             inc         esi
<a name="l10044"></a>10044             add         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, 2
<a name="l10045"></a>10045             add         ebx, 2
<a name="l10046"></a>10046             dec         cl
<a name="l10047"></a>10047             jnz         BlitNTL1
<a name="l10048"></a>10048 
<a name="l10049"></a>10049 <span class="comment">//BlitLineEnd:</span>
<a name="l10050"></a>10050             add         esi, Unblitted
<a name="l10051"></a>10051             jmp         BlitDispatch
<a name="l10052"></a>10052 
<a name="l10053"></a>10053 BlitTransparent:                                                              <span class="comment">// skip transparent pixels</span>
<a name="l10054"></a>10054 
<a name="l10055"></a>10055             and         ecx, 07fH
<a name="l10056"></a>10056             cmp         ecx, LSCount
<a name="l10057"></a>10057             jbe         BTrans1
<a name="l10058"></a>10058 
<a name="l10059"></a>10059             mov         ecx, LSCount
<a name="l10060"></a>10060 
<a name="l10061"></a>10061 BTrans1:
<a name="l10062"></a>10062 
<a name="l10063"></a>10063             sub         LSCount, ecx
<a name="l10064"></a>10064 <span class="comment">//          shl         ecx, 1</span>
<a name="l10065"></a>10065             add   ecx, ecx
<a name="l10066"></a>10066             add         edi, ecx
<a name="l10067"></a>10067             add         ebx, ecx
<a name="l10068"></a>10068             jmp         BlitDispatch
<a name="l10069"></a>10069 
<a name="l10070"></a>10070 
<a name="l10071"></a>10071 RightSkipLoop:                                                                      <span class="comment">// skip along until we hit and end-of-line marker</span>
<a name="l10072"></a>10072 
<a name="l10073"></a>10073 
<a name="l10074"></a>10074 RSLoop1:
<a name="l10075"></a>10075             mov         al, [esi]
<a name="l10076"></a>10076             inc         esi
<a name="l10077"></a>10077             or          al, al
<a name="l10078"></a>10078             jnz         RSLoop1
<a name="l10079"></a>10079 
<a name="l10080"></a>10080             xor         uiLineFlag, 1
<a name="l10081"></a>10081             dec         BlitHeight
<a name="l10082"></a>10082             jz          BlitDone
<a name="l10083"></a>10083             add         edi, LineSkip
<a name="l10084"></a>10084             add         ebx, LineSkip
<a name="l10085"></a>10085 
<a name="l10086"></a>10086             jmp         LeftSkipSetup
<a name="l10087"></a>10087 
<a name="l10088"></a>10088 
<a name="l10089"></a>10089 BlitDone:
<a name="l10090"></a>10090       }
<a name="l10091"></a>10091 
<a name="l10092"></a>10092       <span class="keywordflow">return</span>(TRUE);
<a name="l10093"></a>10093 
<a name="l10094"></a>10094 }
<a name="l10095"></a>10095 
<a name="l10096"></a>10096 
<a name="l10097"></a>10097 
<a name="l10098"></a>10098 <span class="comment">/**********************************************************************************************</span>
<a name="l10099"></a>10099 <span class="comment"> Blt8BPPDataTo16BPPBufferTransShadowZNBClip</span>
<a name="l10100"></a>10100 <span class="comment"></span>
<a name="l10101"></a>10101 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l10102"></a>10102 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l10103"></a>10103 <span class="comment">      pixel's Z level is below OR EQUAL! that of the current pixel, it is written on.</span>
<a name="l10104"></a>10104 <span class="comment">      The Z-buffer is 16 bit, and   must be the same dimensions (including Pitch) as the</span>
<a name="l10105"></a>10105 <span class="comment">      destination. Pixels with a value of 254 are shaded instead of blitted. The Z buffer is</span>
<a name="l10106"></a>10106 <span class="comment">      NOT updated.</span>
<a name="l10107"></a>10107 <span class="comment"></span>
<a name="l10108"></a>10108 <span class="comment">**********************************************************************************************/</span>
<a name="l10109"></a><a class="code" href="vobject__blitters_8cpp.html#edf15a648950f419dbd6424aa3962242">10109</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#edf15a648950f419dbd6424aa3962242">Blt8BPPDataTo16BPPBufferTransShadowBelowOrEqualZNBClip</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="structSGPRect.html">SGPRect</a> *clipregion, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette )
<a name="l10110"></a>10110 {
<a name="l10111"></a>10111       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l10112"></a>10112       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth, Unblitted;
<a name="l10113"></a>10113       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l10114"></a>10114       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l10115"></a>10115   <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l10116"></a>10116       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY, LeftSkip, RightSkip, TopSkip, BottomSkip, BlitLength, BlitHeight, LSCount;
<a name="l10117"></a>10117       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  ClipX1, ClipY1, ClipX2, ClipY2;
<a name="l10118"></a>10118 
<a name="l10119"></a>10119       <span class="comment">// Assertions</span>
<a name="l10120"></a>10120       Assert( hSrcVObject != NULL );
<a name="l10121"></a>10121       Assert( pBuffer != NULL );
<a name="l10122"></a>10122 
<a name="l10123"></a>10123       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l10124"></a>10124       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l10125"></a>10125       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l10126"></a>10126       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l10127"></a>10127       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l10128"></a>10128 
<a name="l10129"></a>10129       <span class="comment">// Add to start position of dest buffer</span>
<a name="l10130"></a>10130       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l10131"></a>10131       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l10132"></a>10132 
<a name="l10133"></a>10133       <span class="keywordflow">if</span>(clipregion==NULL)
<a name="l10134"></a>10134       {
<a name="l10135"></a>10135             ClipX1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l10136"></a>10136             ClipY1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l10137"></a>10137             ClipX2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l10138"></a>10138             ClipY2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l10139"></a>10139       }
<a name="l10140"></a>10140       <span class="keywordflow">else</span>
<a name="l10141"></a>10141       {
<a name="l10142"></a>10142             ClipX1=clipregion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l10143"></a>10143             ClipY1=clipregion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l10144"></a>10144             ClipX2=clipregion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l10145"></a>10145             ClipY2=clipregion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l10146"></a>10146       }
<a name="l10147"></a>10147 
<a name="l10148"></a>10148       <span class="comment">// Calculate rows hanging off each side of the screen</span>
<a name="l10149"></a>10149       LeftSkip=__min(ClipX1 - min(ClipX1, iTempX), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l10150"></a>10150       RightSkip=__min(max(ClipX2, (iTempX+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth)) - ClipX2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l10151"></a>10151       TopSkip=__min(ClipY1 - __min(ClipY1, iTempY), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l10152"></a>10152       BottomSkip=__min(__max(ClipY2, (iTempY+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight)) - ClipY2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l10153"></a>10153 
<a name="l10154"></a>10154       <span class="comment">// calculate the remaining rows and columns to blit</span>
<a name="l10155"></a>10155       BlitLength=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth-LeftSkip-RightSkip);
<a name="l10156"></a>10156       BlitHeight=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight-TopSkip-BottomSkip);
<a name="l10157"></a>10157 
<a name="l10158"></a>10158       <span class="comment">// check if whole thing is clipped</span>
<a name="l10159"></a>10159       <span class="keywordflow">if</span>((LeftSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth) || (RightSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth))
<a name="l10160"></a>10160             <span class="keywordflow">return</span>(TRUE);
<a name="l10161"></a>10161 
<a name="l10162"></a>10162       <span class="comment">// check if whole thing is clipped</span>
<a name="l10163"></a>10163       <span class="keywordflow">if</span>((TopSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight) || (BottomSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight))
<a name="l10164"></a>10164             <span class="keywordflow">return</span>(TRUE);
<a name="l10165"></a>10165 
<a name="l10166"></a>10166       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l10167"></a>10167       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l10168"></a>10168       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l10169"></a>10169       LineSkip=(uiDestPitchBYTES-(BlitLength*2));
<a name="l10170"></a>10170 
<a name="l10171"></a>10171       __asm {
<a name="l10172"></a>10172 
<a name="l10173"></a>10173             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l10174"></a>10174             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l10175"></a>10175             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, p16BPPPalette
<a name="l10176"></a>10176             xor         eax, eax
<a name="l10177"></a>10177             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l10178"></a>10178             xor         ecx, ecx
<a name="l10179"></a>10179 
<a name="l10180"></a>10180             cmp         TopSkip, 0                                      <span class="comment">// check for nothing clipped on top</span>
<a name="l10181"></a>10181             je          LeftSkipSetup
<a name="l10182"></a>10182 
<a name="l10183"></a>10183 TopSkipLoop:                                                            <span class="comment">// Skips the number of lines clipped at the top</span>
<a name="l10184"></a>10184 
<a name="l10185"></a>10185             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l10186"></a>10186             inc         esi
<a name="l10187"></a>10187             or          cl, cl
<a name="l10188"></a>10188             js          TopSkipLoop
<a name="l10189"></a>10189             jz          TSEndLine
<a name="l10190"></a>10190 
<a name="l10191"></a>10191             add         esi, ecx
<a name="l10192"></a>10192             jmp         TopSkipLoop
<a name="l10193"></a>10193 
<a name="l10194"></a>10194 TSEndLine:
<a name="l10195"></a>10195             dec         TopSkip
<a name="l10196"></a>10196             jnz         TopSkipLoop
<a name="l10197"></a>10197 
<a name="l10198"></a>10198 LeftSkipSetup:
<a name="l10199"></a>10199 
<a name="l10200"></a>10200             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l10201"></a>10201             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, LeftSkip
<a name="l10202"></a>10202             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l10203"></a>10203             or          eax, eax
<a name="l10204"></a>10204             jz          BlitLineSetup
<a name="l10205"></a>10205 
<a name="l10206"></a>10206 LeftSkipLoop:
<a name="l10207"></a>10207 
<a name="l10208"></a>10208             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l10209"></a>10209             inc         esi
<a name="l10210"></a>10210 
<a name="l10211"></a>10211             or          cl, cl
<a name="l10212"></a>10212             js          LSTrans
<a name="l10213"></a>10213 
<a name="l10214"></a>10214             cmp         ecx, LSCount
<a name="l10215"></a>10215             je          LSSkip2                                               <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l10216"></a>10216             jb          LSSkip1                                               <span class="comment">// if less, skip whole thing</span>
<a name="l10217"></a>10217 
<a name="l10218"></a>10218             add         esi, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l10219"></a>10219             sub         ecx, LSCount
<a name="l10220"></a>10220             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l10221"></a>10221             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l10222"></a>10222             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l10223"></a>10223             jmp         BlitNonTransLoop
<a name="l10224"></a>10224 
<a name="l10225"></a>10225 LSSkip2:
<a name="l10226"></a>10226             add         esi, ecx                                        <span class="comment">// skip whole run, and start blit with new run</span>
<a name="l10227"></a>10227             jmp         BlitLineSetup
<a name="l10228"></a>10228 
<a name="l10229"></a>10229 
<a name="l10230"></a>10230 LSSkip1:
<a name="l10231"></a>10231             add         esi, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l10232"></a>10232             sub         LSCount, ecx
<a name="l10233"></a>10233             jmp         LeftSkipLoop
<a name="l10234"></a>10234 
<a name="l10235"></a>10235 
<a name="l10236"></a>10236 LSTrans:
<a name="l10237"></a>10237             and         ecx, 07fH
<a name="l10238"></a>10238             cmp         ecx, LSCount
<a name="l10239"></a>10239             je          BlitLineSetup                             <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l10240"></a>10240             jb          LSTrans1                                        <span class="comment">// if less, skip whole thing</span>
<a name="l10241"></a>10241 
<a name="l10242"></a>10242             sub         ecx, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l10243"></a>10243             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l10244"></a>10244             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l10245"></a>10245             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l10246"></a>10246             jmp         BlitTransparent
<a name="l10247"></a>10247 
<a name="l10248"></a>10248 
<a name="l10249"></a>10249 LSTrans1:
<a name="l10250"></a>10250             sub         LSCount, ecx                                          <span class="comment">// skip whole run, continue skipping</span>
<a name="l10251"></a>10251             jmp         LeftSkipLoop
<a name="l10252"></a>10252 
<a name="l10253"></a>10253 
<a name="l10254"></a>10254 BlitLineSetup:                                                    <span class="comment">// Does any actual blitting (trans/non) for the line</span>
<a name="l10255"></a>10255             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l10256"></a>10256             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l10257"></a>10257             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l10258"></a>10258 
<a name="l10259"></a>10259 BlitDispatch:
<a name="l10260"></a>10260 
<a name="l10261"></a>10261             cmp         LSCount, 0                                      <span class="comment">// Check to see if we're done blitting</span>
<a name="l10262"></a>10262             je          RightSkipLoop
<a name="l10263"></a>10263 
<a name="l10264"></a>10264             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l10265"></a>10265             inc         esi
<a name="l10266"></a>10266             or          cl, cl
<a name="l10267"></a>10267             js          BlitTransparent
<a name="l10268"></a>10268 
<a name="l10269"></a>10269 BlitNonTransLoop:                                           <span class="comment">// blit non-transparent pixels</span>
<a name="l10270"></a>10270 
<a name="l10271"></a>10271             cmp         ecx, LSCount
<a name="l10272"></a>10272             jbe         BNTrans1
<a name="l10273"></a>10273 
<a name="l10274"></a>10274             sub         ecx, LSCount
<a name="l10275"></a>10275             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, ecx
<a name="l10276"></a>10276             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, LSCount
<a name="l10277"></a>10277 
<a name="l10278"></a>10278 BNTrans1:
<a name="l10279"></a>10279             sub         LSCount, ecx
<a name="l10280"></a>10280 
<a name="l10281"></a>10281 BlitNTL1:
<a name="l10282"></a>10282 
<a name="l10283"></a>10283             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l10284"></a>10284             cmp         ax, usZValue
<a name="l10285"></a>10285             ja          BlitNTL2
<a name="l10286"></a>10286 
<a name="l10287"></a>10287             xor         eax, eax
<a name="l10288"></a>10288 
<a name="l10289"></a>10289             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l10290"></a>10290             cmp         al, 254
<a name="l10291"></a>10291             jne         BlitNTL3
<a name="l10292"></a>10292 
<a name="l10293"></a>10293             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, [ebx]
<a name="l10294"></a>10294             cmp         ax, usZValue
<a name="l10295"></a>10295             jae         BlitNTL2
<a name="l10296"></a>10296 
<a name="l10297"></a>10297             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, [edi]
<a name="l10298"></a>10298             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, <a class="code" href="shading_8cpp.html#fd38e38bdd68f0da44ac96abacf3b2a6">ShadeTable</a>[eax*2]
<a name="l10299"></a>10299             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax
<a name="l10300"></a>10300             jmp         BlitNTL2
<a name="l10301"></a>10301 
<a name="l10302"></a>10302 BlitNTL3:
<a name="l10303"></a>10303             mov         ax, [edx+eax*2]
<a name="l10304"></a>10304             mov         [edi], ax
<a name="l10305"></a>10305 
<a name="l10306"></a>10306 BlitNTL2:
<a name="l10307"></a>10307             inc         esi
<a name="l10308"></a>10308             add         edi, 2
<a name="l10309"></a>10309             add         ebx, 2
<a name="l10310"></a>10310             dec         cl
<a name="l10311"></a>10311             jnz         BlitNTL1
<a name="l10312"></a>10312 
<a name="l10313"></a>10313 <span class="comment">//BlitLineEnd:</span>
<a name="l10314"></a>10314             add         esi, Unblitted
<a name="l10315"></a>10315             jmp         BlitDispatch
<a name="l10316"></a>10316 
<a name="l10317"></a>10317 BlitTransparent:                                                              <span class="comment">// skip transparent pixels</span>
<a name="l10318"></a>10318 
<a name="l10319"></a>10319             and         ecx, 07fH
<a name="l10320"></a>10320             cmp         ecx, LSCount
<a name="l10321"></a>10321             jbe         BTrans1
<a name="l10322"></a>10322 
<a name="l10323"></a>10323             mov         ecx, LSCount
<a name="l10324"></a>10324 
<a name="l10325"></a>10325 BTrans1:
<a name="l10326"></a>10326 
<a name="l10327"></a>10327             sub         LSCount, ecx
<a name="l10328"></a>10328 <span class="comment">//          shl         ecx, 1</span>
<a name="l10329"></a>10329             add   ecx, ecx
<a name="l10330"></a>10330             add         edi, ecx
<a name="l10331"></a>10331             add         ebx, ecx
<a name="l10332"></a>10332             jmp         BlitDispatch
<a name="l10333"></a>10333 
<a name="l10334"></a>10334 
<a name="l10335"></a>10335 RightSkipLoop:                                                                      <span class="comment">// skip along until we hit and end-of-line marker</span>
<a name="l10336"></a>10336 
<a name="l10337"></a>10337 
<a name="l10338"></a>10338 RSLoop1:
<a name="l10339"></a>10339             mov         al, [esi]
<a name="l10340"></a>10340             inc         esi
<a name="l10341"></a>10341             or          al, al
<a name="l10342"></a>10342             jnz         RSLoop1
<a name="l10343"></a>10343 
<a name="l10344"></a>10344             dec         BlitHeight
<a name="l10345"></a>10345             jz          BlitDone
<a name="l10346"></a>10346             add         edi, LineSkip
<a name="l10347"></a>10347             add         ebx, LineSkip
<a name="l10348"></a>10348 
<a name="l10349"></a>10349             jmp         LeftSkipSetup
<a name="l10350"></a>10350 
<a name="l10351"></a>10351 
<a name="l10352"></a>10352 BlitDone:
<a name="l10353"></a>10353       }
<a name="l10354"></a>10354 
<a name="l10355"></a>10355       <span class="keywordflow">return</span>(TRUE);
<a name="l10356"></a>10356 
<a name="l10357"></a>10357 }
<a name="l10358"></a>10358 
<a name="l10359"></a>10359 
<a name="l10360"></a>10360 <span class="comment">/**********************************************************************************************</span>
<a name="l10361"></a>10361 <span class="comment"> Blt8BPPDataTo16BPPBufferShadowZ</span>
<a name="l10362"></a>10362 <span class="comment"></span>
<a name="l10363"></a>10363 <span class="comment">      Creates a shadow using a brush, but modifies the destination buffer only if the current</span>
<a name="l10364"></a>10364 <span class="comment">      Z level is equal to higher than what's in the Z buffer at that pixel location. It</span>
<a name="l10365"></a>10365 <span class="comment">      updates the Z buffer with the new Z level.</span>
<a name="l10366"></a>10366 <span class="comment"></span>
<a name="l10367"></a>10367 <span class="comment">**********************************************************************************************/</span>
<a name="l10368"></a><a class="code" href="vobject__blitters_8h.html#351825f71bd9dfb6c7f17e574e31a3d3">10368</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#351825f71bd9dfb6c7f17e574e31a3d3">Blt8BPPDataTo16BPPBufferShadowZ</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex )
<a name="l10369"></a>10369 {
<a name="l10370"></a>10370       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l10371"></a>10371       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l10372"></a>10372       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth;
<a name="l10373"></a>10373       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l10374"></a>10374       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l10375"></a>10375       <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l10376"></a>10376       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l10377"></a>10377 
<a name="l10378"></a>10378 
<a name="l10379"></a>10379       <span class="comment">// Assertions</span>
<a name="l10380"></a>10380       Assert( hSrcVObject != NULL );
<a name="l10381"></a>10381       Assert( pBuffer != NULL );
<a name="l10382"></a>10382 
<a name="l10383"></a>10383       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l10384"></a>10384       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l10385"></a>10385       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l10386"></a>10386       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l10387"></a>10387       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l10388"></a>10388 
<a name="l10389"></a>10389       <span class="comment">// Add to start position of dest buffer</span>
<a name="l10390"></a>10390       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l10391"></a>10391       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l10392"></a>10392 
<a name="l10393"></a>10393       <span class="comment">// Validations</span>
<a name="l10394"></a>10394       CHECKF( iTempX &gt;= 0 );
<a name="l10395"></a>10395       CHECKF( iTempY &gt;= 0 );
<a name="l10396"></a>10396 
<a name="l10397"></a>10397 
<a name="l10398"></a>10398       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l10399"></a>10399       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l10400"></a>10400       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l10401"></a>10401       p16BPPPalette = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#930609ad8d5cdbb05449df70bd83cfcd">pShadeCurrent</a>;
<a name="l10402"></a>10402       LineSkip=(uiDestPitchBYTES-(usWidth*2));
<a name="l10403"></a>10403 
<a name="l10404"></a>10404       __asm {
<a name="l10405"></a>10405 
<a name="l10406"></a>10406             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l10407"></a>10407             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l10408"></a>10408             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, OFFSET <a class="code" href="shading_8cpp.html#fd38e38bdd68f0da44ac96abacf3b2a6">ShadeTable</a>
<a name="l10409"></a>10409             xor         eax, eax
<a name="l10410"></a>10410             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l10411"></a>10411             xor         ecx, ecx
<a name="l10412"></a>10412 
<a name="l10413"></a>10413 BlitDispatch:
<a name="l10414"></a>10414 
<a name="l10415"></a>10415             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l10416"></a>10416             inc         esi
<a name="l10417"></a>10417             or          cl, cl
<a name="l10418"></a>10418             js          BlitTransparent
<a name="l10419"></a>10419             jz          BlitDoneLine
<a name="l10420"></a>10420 
<a name="l10421"></a>10421 <span class="comment">//BlitNonTransLoop:</span>
<a name="l10422"></a>10422 
<a name="l10423"></a>10423 BlitNTL4:
<a name="l10424"></a>10424 
<a name="l10425"></a>10425             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l10426"></a>10426             cmp         ax, usZValue
<a name="l10427"></a>10427             jae         BlitNTL5
<a name="l10428"></a>10428 
<a name="l10429"></a>10429             xor         eax, eax
<a name="l10430"></a>10430             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, [edi]
<a name="l10431"></a>10431             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, [edx+eax*2]
<a name="l10432"></a>10432             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax
<a name="l10433"></a>10433             mov         ax, usZValue
<a name="l10434"></a>10434             mov         [ebx], ax
<a name="l10435"></a>10435 
<a name="l10436"></a>10436 BlitNTL5:
<a name="l10437"></a>10437             inc         esi
<a name="l10438"></a>10438             add         edi, 2
<a name="l10439"></a>10439             add         ebx, 2
<a name="l10440"></a>10440             dec         cl
<a name="l10441"></a>10441             jnz         BlitNTL4
<a name="l10442"></a>10442 
<a name="l10443"></a>10443             jmp         BlitDispatch
<a name="l10444"></a>10444 
<a name="l10445"></a>10445 
<a name="l10446"></a>10446 BlitTransparent:
<a name="l10447"></a>10447 
<a name="l10448"></a>10448             and         ecx, 07fH
<a name="l10449"></a>10449 <span class="comment">//          shl         ecx, 1</span>
<a name="l10450"></a>10450             add   ecx, ecx
<a name="l10451"></a>10451             add         edi, ecx
<a name="l10452"></a>10452             add         ebx, ecx
<a name="l10453"></a>10453             jmp         BlitDispatch
<a name="l10454"></a>10454 
<a name="l10455"></a>10455 
<a name="l10456"></a>10456 BlitDoneLine:
<a name="l10457"></a>10457 
<a name="l10458"></a>10458             dec         usHeight
<a name="l10459"></a>10459             jz          BlitDone
<a name="l10460"></a>10460             add         edi, LineSkip
<a name="l10461"></a>10461             add         ebx, LineSkip
<a name="l10462"></a>10462             jmp         BlitDispatch
<a name="l10463"></a>10463 
<a name="l10464"></a>10464 
<a name="l10465"></a>10465 BlitDone:
<a name="l10466"></a>10466       }
<a name="l10467"></a>10467 
<a name="l10468"></a>10468       <span class="keywordflow">return</span>(TRUE);
<a name="l10469"></a>10469 
<a name="l10470"></a>10470 }
<a name="l10471"></a>10471 
<a name="l10472"></a>10472 <span class="comment">/**********************************************************************************************</span>
<a name="l10473"></a>10473 <span class="comment"> Blt8BPPDataTo16BPPBufferShadowZClip</span>
<a name="l10474"></a>10474 <span class="comment"></span>
<a name="l10475"></a>10475 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l10476"></a>10476 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l10477"></a>10477 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on, and the Z value is</span>
<a name="l10478"></a>10478 <span class="comment">      updated to the current value, for any non-transparent pixels. The Z-buffer is 16 bit, and</span>
<a name="l10479"></a>10479 <span class="comment">      must be the same dimensions (including Pitch) as the destination.</span>
<a name="l10480"></a>10480 <span class="comment"></span>
<a name="l10481"></a>10481 <span class="comment">**********************************************************************************************/</span>
<a name="l10482"></a><a class="code" href="vobject__blitters_8h.html#c17e5417be1d26273c83e1b30f9ac1de">10482</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#c17e5417be1d26273c83e1b30f9ac1de">Blt8BPPDataTo16BPPBufferShadowZClip</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="structSGPRect.html">SGPRect</a> *clipregion)
<a name="l10483"></a>10483 {
<a name="l10484"></a>10484       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l10485"></a>10485       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l10486"></a>10486       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth, Unblitted;
<a name="l10487"></a>10487       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l10488"></a>10488       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l10489"></a>10489   <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l10490"></a>10490       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY, LeftSkip, RightSkip, TopSkip, BottomSkip, BlitLength, BlitHeight, LSCount;
<a name="l10491"></a>10491       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  ClipX1, ClipY1, ClipX2, ClipY2;
<a name="l10492"></a>10492 
<a name="l10493"></a>10493       <span class="comment">// Assertions</span>
<a name="l10494"></a>10494       Assert( hSrcVObject != NULL );
<a name="l10495"></a>10495       Assert( pBuffer != NULL );
<a name="l10496"></a>10496 
<a name="l10497"></a>10497       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l10498"></a>10498       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l10499"></a>10499       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l10500"></a>10500       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l10501"></a>10501       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l10502"></a>10502 
<a name="l10503"></a>10503       <span class="comment">// Add to start position of dest buffer</span>
<a name="l10504"></a>10504       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l10505"></a>10505       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l10506"></a>10506 
<a name="l10507"></a>10507       <span class="keywordflow">if</span>(clipregion==NULL)
<a name="l10508"></a>10508       {
<a name="l10509"></a>10509             ClipX1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l10510"></a>10510             ClipY1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l10511"></a>10511             ClipX2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l10512"></a>10512             ClipY2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l10513"></a>10513       }
<a name="l10514"></a>10514       <span class="keywordflow">else</span>
<a name="l10515"></a>10515       {
<a name="l10516"></a>10516             ClipX1=clipregion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l10517"></a>10517             ClipY1=clipregion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l10518"></a>10518             ClipX2=clipregion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l10519"></a>10519             ClipY2=clipregion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l10520"></a>10520       }
<a name="l10521"></a>10521 
<a name="l10522"></a>10522       <span class="comment">// Calculate rows hanging off each side of the screen</span>
<a name="l10523"></a>10523       LeftSkip=__min(ClipX1 - min(ClipX1, iTempX), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l10524"></a>10524       RightSkip=__min(max(ClipX2, (iTempX+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth)) - ClipX2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l10525"></a>10525       TopSkip=__min(ClipY1 - __min(ClipY1, iTempY), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l10526"></a>10526       BottomSkip=__min(__max(ClipY2, (iTempY+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight)) - ClipY2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l10527"></a>10527 
<a name="l10528"></a>10528       <span class="comment">// calculate the remaining rows and columns to blit</span>
<a name="l10529"></a>10529       BlitLength=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth-LeftSkip-RightSkip);
<a name="l10530"></a>10530       BlitHeight=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight-TopSkip-BottomSkip);
<a name="l10531"></a>10531 
<a name="l10532"></a>10532       <span class="comment">// check if whole thing is clipped</span>
<a name="l10533"></a>10533       <span class="keywordflow">if</span>((LeftSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth) || (RightSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth))
<a name="l10534"></a>10534             <span class="keywordflow">return</span>(TRUE);
<a name="l10535"></a>10535 
<a name="l10536"></a>10536       <span class="comment">// check if whole thing is clipped</span>
<a name="l10537"></a>10537       <span class="keywordflow">if</span>((TopSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight) || (BottomSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight))
<a name="l10538"></a>10538             <span class="keywordflow">return</span>(TRUE);
<a name="l10539"></a>10539 
<a name="l10540"></a>10540       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l10541"></a>10541       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l10542"></a>10542       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l10543"></a>10543       p16BPPPalette = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#930609ad8d5cdbb05449df70bd83cfcd">pShadeCurrent</a>;
<a name="l10544"></a>10544       LineSkip=(uiDestPitchBYTES-(BlitLength*2));
<a name="l10545"></a>10545 
<a name="l10546"></a>10546       __asm {
<a name="l10547"></a>10547 
<a name="l10548"></a>10548             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l10549"></a>10549             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l10550"></a>10550             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, OFFSET <a class="code" href="shading_8cpp.html#fd38e38bdd68f0da44ac96abacf3b2a6">ShadeTable</a>
<a name="l10551"></a>10551             xor         eax, eax
<a name="l10552"></a>10552             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l10553"></a>10553             xor         ecx, ecx
<a name="l10554"></a>10554 
<a name="l10555"></a>10555             cmp         TopSkip, 0                                      <span class="comment">// check for nothing clipped on top</span>
<a name="l10556"></a>10556             je          LeftSkipSetup
<a name="l10557"></a>10557 
<a name="l10558"></a>10558 TopSkipLoop:                                                            <span class="comment">// Skips the number of lines clipped at the top</span>
<a name="l10559"></a>10559 
<a name="l10560"></a>10560             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l10561"></a>10561             inc         esi
<a name="l10562"></a>10562             or          cl, cl
<a name="l10563"></a>10563             js          TopSkipLoop
<a name="l10564"></a>10564             jz          TSEndLine
<a name="l10565"></a>10565 
<a name="l10566"></a>10566             add         esi, ecx
<a name="l10567"></a>10567             jmp         TopSkipLoop
<a name="l10568"></a>10568 
<a name="l10569"></a>10569 TSEndLine:
<a name="l10570"></a>10570             dec         TopSkip
<a name="l10571"></a>10571             jnz         TopSkipLoop
<a name="l10572"></a>10572 
<a name="l10573"></a>10573 LeftSkipSetup:
<a name="l10574"></a>10574 
<a name="l10575"></a>10575             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l10576"></a>10576             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, LeftSkip
<a name="l10577"></a>10577             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l10578"></a>10578             or          eax, eax
<a name="l10579"></a>10579             jz          BlitLineSetup
<a name="l10580"></a>10580 
<a name="l10581"></a>10581 LeftSkipLoop:
<a name="l10582"></a>10582 
<a name="l10583"></a>10583             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l10584"></a>10584             inc         esi
<a name="l10585"></a>10585 
<a name="l10586"></a>10586             or          cl, cl
<a name="l10587"></a>10587             js          LSTrans
<a name="l10588"></a>10588 
<a name="l10589"></a>10589             cmp         ecx, LSCount
<a name="l10590"></a>10590             je          LSSkip2                                               <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l10591"></a>10591             jb          LSSkip1                                               <span class="comment">// if less, skip whole thing</span>
<a name="l10592"></a>10592 
<a name="l10593"></a>10593             add         esi, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l10594"></a>10594             sub         ecx, LSCount
<a name="l10595"></a>10595             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l10596"></a>10596             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l10597"></a>10597             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l10598"></a>10598             jmp         BlitNonTransLoop
<a name="l10599"></a>10599 
<a name="l10600"></a>10600 LSSkip2:
<a name="l10601"></a>10601             add         esi, ecx                                        <span class="comment">// skip whole run, and start blit with new run</span>
<a name="l10602"></a>10602             jmp         BlitLineSetup
<a name="l10603"></a>10603 
<a name="l10604"></a>10604 
<a name="l10605"></a>10605 LSSkip1:
<a name="l10606"></a>10606             add         esi, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l10607"></a>10607             sub         LSCount, ecx
<a name="l10608"></a>10608             jmp         LeftSkipLoop
<a name="l10609"></a>10609 
<a name="l10610"></a>10610 
<a name="l10611"></a>10611 LSTrans:
<a name="l10612"></a>10612             and         ecx, 07fH
<a name="l10613"></a>10613             cmp         ecx, LSCount
<a name="l10614"></a>10614             je          BlitLineSetup                             <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l10615"></a>10615             jb          LSTrans1                                        <span class="comment">// if less, skip whole thing</span>
<a name="l10616"></a>10616 
<a name="l10617"></a>10617             sub         ecx, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l10618"></a>10618             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l10619"></a>10619             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l10620"></a>10620             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l10621"></a>10621             jmp         BlitTransparent
<a name="l10622"></a>10622 
<a name="l10623"></a>10623 
<a name="l10624"></a>10624 LSTrans1:
<a name="l10625"></a>10625             sub         LSCount, ecx                                          <span class="comment">// skip whole run, continue skipping</span>
<a name="l10626"></a>10626             jmp         LeftSkipLoop
<a name="l10627"></a>10627 
<a name="l10628"></a>10628 
<a name="l10629"></a>10629 BlitLineSetup:                                                    <span class="comment">// Does any actual blitting (trans/non) for the line</span>
<a name="l10630"></a>10630             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l10631"></a>10631             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l10632"></a>10632             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l10633"></a>10633 
<a name="l10634"></a>10634 BlitDispatch:
<a name="l10635"></a>10635 
<a name="l10636"></a>10636             cmp         LSCount, 0                                      <span class="comment">// Check to see if we're done blitting</span>
<a name="l10637"></a>10637             je          RightSkipLoop
<a name="l10638"></a>10638 
<a name="l10639"></a>10639             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l10640"></a>10640             inc         esi
<a name="l10641"></a>10641             or          cl, cl
<a name="l10642"></a>10642             js          BlitTransparent
<a name="l10643"></a>10643 
<a name="l10644"></a>10644 BlitNonTransLoop:                                           <span class="comment">// blit non-transparent pixels</span>
<a name="l10645"></a>10645 
<a name="l10646"></a>10646             cmp         ecx, LSCount
<a name="l10647"></a>10647             jbe         BNTrans1
<a name="l10648"></a>10648 
<a name="l10649"></a>10649             sub         ecx, LSCount
<a name="l10650"></a>10650             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, ecx
<a name="l10651"></a>10651             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, LSCount
<a name="l10652"></a>10652 
<a name="l10653"></a>10653 BNTrans1:
<a name="l10654"></a>10654             sub         LSCount, ecx
<a name="l10655"></a>10655 
<a name="l10656"></a>10656 BlitNTL1:
<a name="l10657"></a>10657 
<a name="l10658"></a>10658             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l10659"></a>10659             cmp         ax, usZValue
<a name="l10660"></a>10660             jae         BlitNTL2
<a name="l10661"></a>10661 
<a name="l10662"></a>10662             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, usZValue
<a name="l10663"></a>10663             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [ebx], ax
<a name="l10664"></a>10664 
<a name="l10665"></a>10665             xor         eax, eax
<a name="l10666"></a>10666 
<a name="l10667"></a>10667             mov         ax, [edi]
<a name="l10668"></a>10668             mov         ax, [edx+eax*2]
<a name="l10669"></a>10669             mov         [edi], ax
<a name="l10670"></a>10670 
<a name="l10671"></a>10671 BlitNTL2:
<a name="l10672"></a>10672             inc         esi
<a name="l10673"></a>10673             add         edi, 2
<a name="l10674"></a>10674             add         ebx, 2
<a name="l10675"></a>10675             dec         cl
<a name="l10676"></a>10676             jnz         BlitNTL1
<a name="l10677"></a>10677 
<a name="l10678"></a>10678 <span class="comment">//BlitLineEnd:</span>
<a name="l10679"></a>10679             add         esi, Unblitted
<a name="l10680"></a>10680             jmp         BlitDispatch
<a name="l10681"></a>10681 
<a name="l10682"></a>10682 BlitTransparent:                                                              <span class="comment">// skip transparent pixels</span>
<a name="l10683"></a>10683 
<a name="l10684"></a>10684             and         ecx, 07fH
<a name="l10685"></a>10685             cmp         ecx, LSCount
<a name="l10686"></a>10686             jbe         BTrans1
<a name="l10687"></a>10687 
<a name="l10688"></a>10688             mov         ecx, LSCount
<a name="l10689"></a>10689 
<a name="l10690"></a>10690 BTrans1:
<a name="l10691"></a>10691 
<a name="l10692"></a>10692             sub         LSCount, ecx
<a name="l10693"></a>10693 <span class="comment">//          shl         ecx, 1</span>
<a name="l10694"></a>10694             add   ecx, ecx
<a name="l10695"></a>10695             add         edi, ecx
<a name="l10696"></a>10696             add         ebx, ecx
<a name="l10697"></a>10697             jmp         BlitDispatch
<a name="l10698"></a>10698 
<a name="l10699"></a>10699 
<a name="l10700"></a>10700 RightSkipLoop:                                                                      <span class="comment">// skip along until we hit and end-of-line marker</span>
<a name="l10701"></a>10701 
<a name="l10702"></a>10702 
<a name="l10703"></a>10703 RSLoop1:
<a name="l10704"></a>10704             mov         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l10705"></a>10705             inc         esi
<a name="l10706"></a>10706             or          al, al
<a name="l10707"></a>10707             jnz         RSLoop1
<a name="l10708"></a>10708 
<a name="l10709"></a>10709             dec         BlitHeight
<a name="l10710"></a>10710             jz          BlitDone
<a name="l10711"></a>10711             add         edi, LineSkip
<a name="l10712"></a>10712             add         ebx, LineSkip
<a name="l10713"></a>10713 
<a name="l10714"></a>10714             jmp         LeftSkipSetup
<a name="l10715"></a>10715 
<a name="l10716"></a>10716 
<a name="l10717"></a>10717 BlitDone:
<a name="l10718"></a>10718       }
<a name="l10719"></a>10719 
<a name="l10720"></a>10720       <span class="keywordflow">return</span>(TRUE);
<a name="l10721"></a>10721 
<a name="l10722"></a>10722 }
<a name="l10723"></a>10723 
<a name="l10724"></a>10724 <span class="comment">/**********************************************************************************************</span>
<a name="l10725"></a>10725 <span class="comment"> Blt8BPPDataTo16BPPBufferShadowZNB</span>
<a name="l10726"></a>10726 <span class="comment"></span>
<a name="l10727"></a>10727 <span class="comment">      Creates a shadow using a brush, but modifies the destination buffer only if the current</span>
<a name="l10728"></a>10728 <span class="comment">      Z level is equal to higher than what's in the Z buffer at that pixel location. It does</span>
<a name="l10729"></a>10729 <span class="comment">      NOT update the Z buffer with the new Z value.</span>
<a name="l10730"></a>10730 <span class="comment"></span>
<a name="l10731"></a>10731 <span class="comment">**********************************************************************************************/</span>
<a name="l10732"></a><a class="code" href="vobject__blitters_8h.html#3662b0afe2fd15fff0e0f13b1e0664a4">10732</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#3662b0afe2fd15fff0e0f13b1e0664a4">Blt8BPPDataTo16BPPBufferShadowZNB</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex )
<a name="l10733"></a>10733 {
<a name="l10734"></a>10734       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l10735"></a>10735       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l10736"></a>10736       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth;
<a name="l10737"></a>10737       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l10738"></a>10738       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l10739"></a>10739       <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l10740"></a>10740       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l10741"></a>10741 
<a name="l10742"></a>10742 
<a name="l10743"></a>10743       <span class="comment">// Assertions</span>
<a name="l10744"></a>10744       Assert( hSrcVObject != NULL );
<a name="l10745"></a>10745       Assert( pBuffer != NULL );
<a name="l10746"></a>10746 
<a name="l10747"></a>10747       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l10748"></a>10748       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l10749"></a>10749       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l10750"></a>10750       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l10751"></a>10751       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l10752"></a>10752 
<a name="l10753"></a>10753       <span class="comment">// Add to start position of dest buffer</span>
<a name="l10754"></a>10754       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l10755"></a>10755       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l10756"></a>10756 
<a name="l10757"></a>10757       <span class="comment">// Validations</span>
<a name="l10758"></a>10758       CHECKF( iTempX &gt;= 0 );
<a name="l10759"></a>10759       CHECKF( iTempY &gt;= 0 );
<a name="l10760"></a>10760 
<a name="l10761"></a>10761 
<a name="l10762"></a>10762       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l10763"></a>10763       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l10764"></a>10764       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l10765"></a>10765       p16BPPPalette = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#930609ad8d5cdbb05449df70bd83cfcd">pShadeCurrent</a>;
<a name="l10766"></a>10766       LineSkip=(uiDestPitchBYTES-(usWidth*2));
<a name="l10767"></a>10767 
<a name="l10768"></a>10768       __asm {
<a name="l10769"></a>10769 
<a name="l10770"></a>10770             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l10771"></a>10771             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l10772"></a>10772             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, OFFSET <a class="code" href="shading_8cpp.html#fd38e38bdd68f0da44ac96abacf3b2a6">ShadeTable</a>
<a name="l10773"></a>10773             xor         eax, eax
<a name="l10774"></a>10774             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l10775"></a>10775             xor         ecx, ecx
<a name="l10776"></a>10776 
<a name="l10777"></a>10777 BlitDispatch:
<a name="l10778"></a>10778 
<a name="l10779"></a>10779             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l10780"></a>10780             inc         esi
<a name="l10781"></a>10781             or          cl, cl
<a name="l10782"></a>10782             js          BlitTransparent
<a name="l10783"></a>10783             jz          BlitDoneLine
<a name="l10784"></a>10784 
<a name="l10785"></a>10785 <span class="comment">//BlitNonTransLoop:</span>
<a name="l10786"></a>10786 
<a name="l10787"></a>10787 BlitNTL4:
<a name="l10788"></a>10788 
<a name="l10789"></a>10789             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l10790"></a>10790             cmp         ax, usZValue
<a name="l10791"></a>10791             jae         BlitNTL5
<a name="l10792"></a>10792 
<a name="l10793"></a>10793             xor         eax, eax
<a name="l10794"></a>10794             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, [edi]
<a name="l10795"></a>10795             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, [edx+eax*2]
<a name="l10796"></a>10796             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax
<a name="l10797"></a>10797 
<a name="l10798"></a>10798 BlitNTL5:
<a name="l10799"></a>10799             inc         esi
<a name="l10800"></a>10800             add         edi, 2
<a name="l10801"></a>10801             add         ebx, 2
<a name="l10802"></a>10802             dec         cl
<a name="l10803"></a>10803             jnz         BlitNTL4
<a name="l10804"></a>10804 
<a name="l10805"></a>10805             jmp         BlitDispatch
<a name="l10806"></a>10806 
<a name="l10807"></a>10807 
<a name="l10808"></a>10808 BlitTransparent:
<a name="l10809"></a>10809 
<a name="l10810"></a>10810             and         ecx, 07fH
<a name="l10811"></a>10811 <span class="comment">//          shl         ecx, 1</span>
<a name="l10812"></a>10812             add   ecx, ecx
<a name="l10813"></a>10813             add         edi, ecx
<a name="l10814"></a>10814             add         ebx, ecx
<a name="l10815"></a>10815             jmp         BlitDispatch
<a name="l10816"></a>10816 
<a name="l10817"></a>10817 
<a name="l10818"></a>10818 BlitDoneLine:
<a name="l10819"></a>10819 
<a name="l10820"></a>10820             dec         usHeight
<a name="l10821"></a>10821             jz          BlitDone
<a name="l10822"></a>10822             add         edi, LineSkip
<a name="l10823"></a>10823             add         ebx, LineSkip
<a name="l10824"></a>10824             jmp         BlitDispatch
<a name="l10825"></a>10825 
<a name="l10826"></a>10826 
<a name="l10827"></a>10827 BlitDone:
<a name="l10828"></a>10828       }
<a name="l10829"></a>10829 
<a name="l10830"></a>10830       <span class="keywordflow">return</span>(TRUE);
<a name="l10831"></a>10831 
<a name="l10832"></a>10832 }
<a name="l10833"></a>10833 
<a name="l10834"></a>10834 <span class="comment">/**********************************************************************************************</span>
<a name="l10835"></a>10835 <span class="comment"> Blt8BPPDataTo16BPPBufferShadowZNBClip</span>
<a name="l10836"></a>10836 <span class="comment"></span>
<a name="l10837"></a>10837 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l10838"></a>10838 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l10839"></a>10839 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on, the Z value is</span>
<a name="l10840"></a>10840 <span class="comment">      not updated,      for any non-transparent pixels. The Z-buffer is 16 bit, and must be the</span>
<a name="l10841"></a>10841 <span class="comment">      same dimensions (including Pitch) as the destination.</span>
<a name="l10842"></a>10842 <span class="comment"></span>
<a name="l10843"></a>10843 <span class="comment">**********************************************************************************************/</span>
<a name="l10844"></a><a class="code" href="vobject__blitters_8h.html#8734e320ec20fa4dd0e9bad7f7344d4f">10844</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#8734e320ec20fa4dd0e9bad7f7344d4f">Blt8BPPDataTo16BPPBufferShadowZNBClip</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="structSGPRect.html">SGPRect</a> *clipregion)
<a name="l10845"></a>10845 {
<a name="l10846"></a>10846       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l10847"></a>10847       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l10848"></a>10848       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth, Unblitted;
<a name="l10849"></a>10849       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l10850"></a>10850       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l10851"></a>10851   <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l10852"></a>10852       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY, LeftSkip, RightSkip, TopSkip, BottomSkip, BlitLength, BlitHeight, LSCount;
<a name="l10853"></a>10853       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  ClipX1, ClipY1, ClipX2, ClipY2;
<a name="l10854"></a>10854 
<a name="l10855"></a>10855       <span class="comment">// Assertions</span>
<a name="l10856"></a>10856       Assert( hSrcVObject != NULL );
<a name="l10857"></a>10857       Assert( pBuffer != NULL );
<a name="l10858"></a>10858 
<a name="l10859"></a>10859       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l10860"></a>10860       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l10861"></a>10861       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l10862"></a>10862       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l10863"></a>10863       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l10864"></a>10864 
<a name="l10865"></a>10865       <span class="comment">// Add to start position of dest buffer</span>
<a name="l10866"></a>10866       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l10867"></a>10867       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l10868"></a>10868 
<a name="l10869"></a>10869       <span class="keywordflow">if</span>(clipregion==NULL)
<a name="l10870"></a>10870       {
<a name="l10871"></a>10871             ClipX1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l10872"></a>10872             ClipY1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l10873"></a>10873             ClipX2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l10874"></a>10874             ClipY2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l10875"></a>10875       }
<a name="l10876"></a>10876       <span class="keywordflow">else</span>
<a name="l10877"></a>10877       {
<a name="l10878"></a>10878             ClipX1=clipregion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l10879"></a>10879             ClipY1=clipregion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l10880"></a>10880             ClipX2=clipregion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l10881"></a>10881             ClipY2=clipregion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l10882"></a>10882       }
<a name="l10883"></a>10883 
<a name="l10884"></a>10884       <span class="comment">// Calculate rows hanging off each side of the screen</span>
<a name="l10885"></a>10885       LeftSkip=__min(ClipX1 - min(ClipX1, iTempX), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l10886"></a>10886       RightSkip=__min(max(ClipX2, (iTempX+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth)) - ClipX2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l10887"></a>10887       TopSkip=__min(ClipY1 - __min(ClipY1, iTempY), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l10888"></a>10888       BottomSkip=__min(__max(ClipY2, (iTempY+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight)) - ClipY2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l10889"></a>10889 
<a name="l10890"></a>10890       <span class="comment">// calculate the remaining rows and columns to blit</span>
<a name="l10891"></a>10891       BlitLength=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth-LeftSkip-RightSkip);
<a name="l10892"></a>10892       BlitHeight=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight-TopSkip-BottomSkip);
<a name="l10893"></a>10893 
<a name="l10894"></a>10894       <span class="comment">// check if whole thing is clipped</span>
<a name="l10895"></a>10895       <span class="keywordflow">if</span>((LeftSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth) || (RightSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth))
<a name="l10896"></a>10896             <span class="keywordflow">return</span>(TRUE);
<a name="l10897"></a>10897 
<a name="l10898"></a>10898       <span class="comment">// check if whole thing is clipped</span>
<a name="l10899"></a>10899       <span class="keywordflow">if</span>((TopSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight) || (BottomSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight))
<a name="l10900"></a>10900             <span class="keywordflow">return</span>(TRUE);
<a name="l10901"></a>10901 
<a name="l10902"></a>10902       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l10903"></a>10903       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l10904"></a>10904       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l10905"></a>10905       p16BPPPalette = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#930609ad8d5cdbb05449df70bd83cfcd">pShadeCurrent</a>;
<a name="l10906"></a>10906       LineSkip=(uiDestPitchBYTES-(BlitLength*2));
<a name="l10907"></a>10907 
<a name="l10908"></a>10908       __asm {
<a name="l10909"></a>10909 
<a name="l10910"></a>10910             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l10911"></a>10911             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l10912"></a>10912             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, OFFSET <a class="code" href="shading_8cpp.html#fd38e38bdd68f0da44ac96abacf3b2a6">ShadeTable</a>
<a name="l10913"></a>10913             xor         eax, eax
<a name="l10914"></a>10914             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l10915"></a>10915             xor         ecx, ecx
<a name="l10916"></a>10916 
<a name="l10917"></a>10917             cmp         TopSkip, 0                                      <span class="comment">// check for nothing clipped on top</span>
<a name="l10918"></a>10918             je          LeftSkipSetup
<a name="l10919"></a>10919 
<a name="l10920"></a>10920 TopSkipLoop:                                                            <span class="comment">// Skips the number of lines clipped at the top</span>
<a name="l10921"></a>10921 
<a name="l10922"></a>10922             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l10923"></a>10923             inc         esi
<a name="l10924"></a>10924             or          cl, cl
<a name="l10925"></a>10925             js          TopSkipLoop
<a name="l10926"></a>10926             jz          TSEndLine
<a name="l10927"></a>10927 
<a name="l10928"></a>10928             add         esi, ecx
<a name="l10929"></a>10929             jmp         TopSkipLoop
<a name="l10930"></a>10930 
<a name="l10931"></a>10931 TSEndLine:
<a name="l10932"></a>10932             dec         TopSkip
<a name="l10933"></a>10933             jnz         TopSkipLoop
<a name="l10934"></a>10934 
<a name="l10935"></a>10935 LeftSkipSetup:
<a name="l10936"></a>10936 
<a name="l10937"></a>10937             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l10938"></a>10938             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, LeftSkip
<a name="l10939"></a>10939             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l10940"></a>10940             or          eax, eax
<a name="l10941"></a>10941             jz          BlitLineSetup
<a name="l10942"></a>10942 
<a name="l10943"></a>10943 LeftSkipLoop:
<a name="l10944"></a>10944 
<a name="l10945"></a>10945             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l10946"></a>10946             inc         esi
<a name="l10947"></a>10947 
<a name="l10948"></a>10948             or          cl, cl
<a name="l10949"></a>10949             js          LSTrans
<a name="l10950"></a>10950 
<a name="l10951"></a>10951             cmp         ecx, LSCount
<a name="l10952"></a>10952             je          LSSkip2                                               <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l10953"></a>10953             jb          LSSkip1                                               <span class="comment">// if less, skip whole thing</span>
<a name="l10954"></a>10954 
<a name="l10955"></a>10955             add         esi, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l10956"></a>10956             sub         ecx, LSCount
<a name="l10957"></a>10957             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l10958"></a>10958             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l10959"></a>10959             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l10960"></a>10960             jmp         BlitNonTransLoop
<a name="l10961"></a>10961 
<a name="l10962"></a>10962 LSSkip2:
<a name="l10963"></a>10963             add         esi, ecx                                        <span class="comment">// skip whole run, and start blit with new run</span>
<a name="l10964"></a>10964             jmp         BlitLineSetup
<a name="l10965"></a>10965 
<a name="l10966"></a>10966 
<a name="l10967"></a>10967 LSSkip1:
<a name="l10968"></a>10968             add         esi, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l10969"></a>10969             sub         LSCount, ecx
<a name="l10970"></a>10970             jmp         LeftSkipLoop
<a name="l10971"></a>10971 
<a name="l10972"></a>10972 
<a name="l10973"></a>10973 LSTrans:
<a name="l10974"></a>10974             and         ecx, 07fH
<a name="l10975"></a>10975             cmp         ecx, LSCount
<a name="l10976"></a>10976             je          BlitLineSetup                             <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l10977"></a>10977             jb          LSTrans1                                        <span class="comment">// if less, skip whole thing</span>
<a name="l10978"></a>10978 
<a name="l10979"></a>10979             sub         ecx, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l10980"></a>10980             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l10981"></a>10981             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l10982"></a>10982             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l10983"></a>10983             jmp         BlitTransparent
<a name="l10984"></a>10984 
<a name="l10985"></a>10985 
<a name="l10986"></a>10986 LSTrans1:
<a name="l10987"></a>10987             sub         LSCount, ecx                                          <span class="comment">// skip whole run, continue skipping</span>
<a name="l10988"></a>10988             jmp         LeftSkipLoop
<a name="l10989"></a>10989 
<a name="l10990"></a>10990 
<a name="l10991"></a>10991 BlitLineSetup:                                                    <span class="comment">// Does any actual blitting (trans/non) for the line</span>
<a name="l10992"></a>10992             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l10993"></a>10993             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l10994"></a>10994             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l10995"></a>10995 
<a name="l10996"></a>10996 BlitDispatch:
<a name="l10997"></a>10997 
<a name="l10998"></a>10998             cmp         LSCount, 0                                      <span class="comment">// Check to see if we're done blitting</span>
<a name="l10999"></a>10999             je          RightSkipLoop
<a name="l11000"></a>11000 
<a name="l11001"></a>11001             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l11002"></a>11002             inc         esi
<a name="l11003"></a>11003             or          cl, cl
<a name="l11004"></a>11004             js          BlitTransparent
<a name="l11005"></a>11005 
<a name="l11006"></a>11006 BlitNonTransLoop:                                           <span class="comment">// blit non-transparent pixels</span>
<a name="l11007"></a>11007 
<a name="l11008"></a>11008             cmp         ecx, LSCount
<a name="l11009"></a>11009             jbe         BNTrans1
<a name="l11010"></a>11010 
<a name="l11011"></a>11011             sub         ecx, LSCount
<a name="l11012"></a>11012             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, ecx
<a name="l11013"></a>11013             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, LSCount
<a name="l11014"></a>11014 
<a name="l11015"></a>11015 BNTrans1:
<a name="l11016"></a>11016             sub         LSCount, ecx
<a name="l11017"></a>11017 
<a name="l11018"></a>11018 BlitNTL1:
<a name="l11019"></a>11019 
<a name="l11020"></a>11020             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l11021"></a>11021             cmp         ax, usZValue
<a name="l11022"></a>11022             jae         BlitNTL2
<a name="l11023"></a>11023 
<a name="l11024"></a>11024             xor         eax, eax
<a name="l11025"></a>11025 
<a name="l11026"></a>11026             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, [edi]
<a name="l11027"></a>11027             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, [edx+eax*2]
<a name="l11028"></a>11028             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax
<a name="l11029"></a>11029 
<a name="l11030"></a>11030 BlitNTL2:
<a name="l11031"></a>11031             inc         esi
<a name="l11032"></a>11032             add         edi, 2
<a name="l11033"></a>11033             add         ebx, 2
<a name="l11034"></a>11034             dec         cl
<a name="l11035"></a>11035             jnz         BlitNTL1
<a name="l11036"></a>11036 
<a name="l11037"></a>11037 <span class="comment">//BlitLineEnd:</span>
<a name="l11038"></a>11038             add         esi, Unblitted
<a name="l11039"></a>11039             jmp         BlitDispatch
<a name="l11040"></a>11040 
<a name="l11041"></a>11041 BlitTransparent:                                                              <span class="comment">// skip transparent pixels</span>
<a name="l11042"></a>11042 
<a name="l11043"></a>11043             and         ecx, 07fH
<a name="l11044"></a>11044             cmp         ecx, LSCount
<a name="l11045"></a>11045             jbe         BTrans1
<a name="l11046"></a>11046 
<a name="l11047"></a>11047             mov         ecx, LSCount
<a name="l11048"></a>11048 
<a name="l11049"></a>11049 BTrans1:
<a name="l11050"></a>11050 
<a name="l11051"></a>11051             sub         LSCount, ecx
<a name="l11052"></a>11052 <span class="comment">//          shl         ecx, 1</span>
<a name="l11053"></a>11053             add   ecx, ecx
<a name="l11054"></a>11054             add         edi, ecx
<a name="l11055"></a>11055             add         ebx, ecx
<a name="l11056"></a>11056             jmp         BlitDispatch
<a name="l11057"></a>11057 
<a name="l11058"></a>11058 
<a name="l11059"></a>11059 RightSkipLoop:                                                                      <span class="comment">// skip along until we hit and end-of-line marker</span>
<a name="l11060"></a>11060 
<a name="l11061"></a>11061 
<a name="l11062"></a>11062 RSLoop1:
<a name="l11063"></a>11063             mov         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l11064"></a>11064             inc         esi
<a name="l11065"></a>11065             or          al, al
<a name="l11066"></a>11066             jnz         RSLoop1
<a name="l11067"></a>11067 
<a name="l11068"></a>11068             dec         BlitHeight
<a name="l11069"></a>11069             jz          BlitDone
<a name="l11070"></a>11070             add         edi, LineSkip
<a name="l11071"></a>11071             add         ebx, LineSkip
<a name="l11072"></a>11072 
<a name="l11073"></a>11073             jmp         LeftSkipSetup
<a name="l11074"></a>11074 
<a name="l11075"></a>11075 
<a name="l11076"></a>11076 BlitDone:
<a name="l11077"></a>11077       }
<a name="l11078"></a>11078 
<a name="l11079"></a>11079       <span class="keywordflow">return</span>(TRUE);
<a name="l11080"></a>11080 
<a name="l11081"></a>11081 }
<a name="l11082"></a>11082 
<a name="l11083"></a>11083 <span class="comment">/**********************************************************************************************</span>
<a name="l11084"></a>11084 <span class="comment"> Blt8BPPDataTo16BPPBufferTransZClip</span>
<a name="l11085"></a>11085 <span class="comment"></span>
<a name="l11086"></a>11086 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l11087"></a>11087 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l11088"></a>11088 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on, and the Z value is</span>
<a name="l11089"></a>11089 <span class="comment">      updated to the current value, for any non-transparent pixels. The Z-buffer is 16 bit, and</span>
<a name="l11090"></a>11090 <span class="comment">      must be the same dimensions (including Pitch) as the destination.</span>
<a name="l11091"></a>11091 <span class="comment"></span>
<a name="l11092"></a>11092 <span class="comment">**********************************************************************************************/</span>
<a name="l11093"></a><a class="code" href="vobject__blitters_8h.html#5d6087ac41afcb08eee0d52375de242a">11093</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#5d6087ac41afcb08eee0d52375de242a">Blt8BPPDataTo16BPPBufferTransZClip</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="structSGPRect.html">SGPRect</a> *clipregion)
<a name="l11094"></a>11094 {
<a name="l11095"></a>11095       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l11096"></a>11096       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l11097"></a>11097       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth, Unblitted;
<a name="l11098"></a>11098       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l11099"></a>11099       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l11100"></a>11100   <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l11101"></a>11101       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY, LeftSkip, RightSkip, TopSkip, BottomSkip, BlitLength, BlitHeight, LSCount;
<a name="l11102"></a>11102       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  ClipX1, ClipY1, ClipX2, ClipY2;
<a name="l11103"></a>11103 
<a name="l11104"></a>11104       <span class="comment">// Assertions</span>
<a name="l11105"></a>11105       Assert( hSrcVObject != NULL );
<a name="l11106"></a>11106       Assert( pBuffer != NULL );
<a name="l11107"></a>11107 
<a name="l11108"></a>11108       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l11109"></a>11109       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l11110"></a>11110       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l11111"></a>11111       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l11112"></a>11112       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l11113"></a>11113 
<a name="l11114"></a>11114       <span class="comment">// Add to start position of dest buffer</span>
<a name="l11115"></a>11115       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l11116"></a>11116       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l11117"></a>11117 
<a name="l11118"></a>11118       <span class="keywordflow">if</span>(clipregion==NULL)
<a name="l11119"></a>11119       {
<a name="l11120"></a>11120             ClipX1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l11121"></a>11121             ClipY1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l11122"></a>11122             ClipX2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l11123"></a>11123             ClipY2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l11124"></a>11124       }
<a name="l11125"></a>11125       <span class="keywordflow">else</span>
<a name="l11126"></a>11126       {
<a name="l11127"></a>11127             ClipX1=clipregion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l11128"></a>11128             ClipY1=clipregion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l11129"></a>11129             ClipX2=clipregion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l11130"></a>11130             ClipY2=clipregion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l11131"></a>11131       }
<a name="l11132"></a>11132 
<a name="l11133"></a>11133       <span class="comment">// Calculate rows hanging off each side of the screen</span>
<a name="l11134"></a>11134       LeftSkip=__min(ClipX1 - min(ClipX1, iTempX), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l11135"></a>11135       RightSkip=__min(max(ClipX2, (iTempX+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth)) - ClipX2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l11136"></a>11136       TopSkip=__min(ClipY1 - __min(ClipY1, iTempY), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l11137"></a>11137       BottomSkip=__min(__max(ClipY2, (iTempY+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight)) - ClipY2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l11138"></a>11138 
<a name="l11139"></a>11139       <span class="comment">// calculate the remaining rows and columns to blit</span>
<a name="l11140"></a>11140       BlitLength=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth-LeftSkip-RightSkip);
<a name="l11141"></a>11141       BlitHeight=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight-TopSkip-BottomSkip);
<a name="l11142"></a>11142 
<a name="l11143"></a>11143       <span class="comment">// check if whole thing is clipped</span>
<a name="l11144"></a>11144       <span class="keywordflow">if</span>((LeftSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth) || (RightSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth))
<a name="l11145"></a>11145             <span class="keywordflow">return</span>(TRUE);
<a name="l11146"></a>11146 
<a name="l11147"></a>11147       <span class="comment">// check if whole thing is clipped</span>
<a name="l11148"></a>11148       <span class="keywordflow">if</span>((TopSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight) || (BottomSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight))
<a name="l11149"></a>11149             <span class="keywordflow">return</span>(TRUE);
<a name="l11150"></a>11150 
<a name="l11151"></a>11151       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l11152"></a>11152       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l11153"></a>11153       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l11154"></a>11154       p16BPPPalette = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#930609ad8d5cdbb05449df70bd83cfcd">pShadeCurrent</a>;
<a name="l11155"></a>11155       LineSkip=(uiDestPitchBYTES-(BlitLength*2));
<a name="l11156"></a>11156 
<a name="l11157"></a>11157       __asm {
<a name="l11158"></a>11158 
<a name="l11159"></a>11159             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l11160"></a>11160             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l11161"></a>11161             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, p16BPPPalette
<a name="l11162"></a>11162             xor         eax, eax
<a name="l11163"></a>11163             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l11164"></a>11164             xor         ecx, ecx
<a name="l11165"></a>11165 
<a name="l11166"></a>11166             cmp         TopSkip, 0                                      <span class="comment">// check for nothing clipped on top</span>
<a name="l11167"></a>11167             je          LeftSkipSetup
<a name="l11168"></a>11168 
<a name="l11169"></a>11169 TopSkipLoop:                                                            <span class="comment">// Skips the number of lines clipped at the top</span>
<a name="l11170"></a>11170 
<a name="l11171"></a>11171             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l11172"></a>11172             inc         esi
<a name="l11173"></a>11173             or          cl, cl
<a name="l11174"></a>11174             js          TopSkipLoop
<a name="l11175"></a>11175             jz          TSEndLine
<a name="l11176"></a>11176 
<a name="l11177"></a>11177             add         esi, ecx
<a name="l11178"></a>11178             jmp         TopSkipLoop
<a name="l11179"></a>11179 
<a name="l11180"></a>11180 TSEndLine:
<a name="l11181"></a>11181             dec         TopSkip
<a name="l11182"></a>11182             jnz         TopSkipLoop
<a name="l11183"></a>11183 
<a name="l11184"></a>11184 LeftSkipSetup:
<a name="l11185"></a>11185 
<a name="l11186"></a>11186             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l11187"></a>11187             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, LeftSkip
<a name="l11188"></a>11188             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l11189"></a>11189             or          eax, eax
<a name="l11190"></a>11190             jz          BlitLineSetup
<a name="l11191"></a>11191 
<a name="l11192"></a>11192 LeftSkipLoop:
<a name="l11193"></a>11193 
<a name="l11194"></a>11194             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l11195"></a>11195             inc         esi
<a name="l11196"></a>11196 
<a name="l11197"></a>11197             or          cl, cl
<a name="l11198"></a>11198             js          LSTrans
<a name="l11199"></a>11199 
<a name="l11200"></a>11200             cmp         ecx, LSCount
<a name="l11201"></a>11201             je          LSSkip2                                               <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l11202"></a>11202             jb          LSSkip1                                               <span class="comment">// if less, skip whole thing</span>
<a name="l11203"></a>11203 
<a name="l11204"></a>11204             add         esi, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l11205"></a>11205             sub         ecx, LSCount
<a name="l11206"></a>11206             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l11207"></a>11207             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l11208"></a>11208             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l11209"></a>11209             jmp         BlitNonTransLoop
<a name="l11210"></a>11210 
<a name="l11211"></a>11211 LSSkip2:
<a name="l11212"></a>11212             add         esi, ecx                                        <span class="comment">// skip whole run, and start blit with new run</span>
<a name="l11213"></a>11213             jmp         BlitLineSetup
<a name="l11214"></a>11214 
<a name="l11215"></a>11215 
<a name="l11216"></a>11216 LSSkip1:
<a name="l11217"></a>11217             add         esi, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l11218"></a>11218             sub         LSCount, ecx
<a name="l11219"></a>11219             jmp         LeftSkipLoop
<a name="l11220"></a>11220 
<a name="l11221"></a>11221 
<a name="l11222"></a>11222 LSTrans:
<a name="l11223"></a>11223             and         ecx, 07fH
<a name="l11224"></a>11224             cmp         ecx, LSCount
<a name="l11225"></a>11225             je          BlitLineSetup                             <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l11226"></a>11226             jb          LSTrans1                                        <span class="comment">// if less, skip whole thing</span>
<a name="l11227"></a>11227 
<a name="l11228"></a>11228             sub         ecx, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l11229"></a>11229             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l11230"></a>11230             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l11231"></a>11231             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l11232"></a>11232             jmp         BlitTransparent
<a name="l11233"></a>11233 
<a name="l11234"></a>11234 
<a name="l11235"></a>11235 LSTrans1:
<a name="l11236"></a>11236             sub         LSCount, ecx                                          <span class="comment">// skip whole run, continue skipping</span>
<a name="l11237"></a>11237             jmp         LeftSkipLoop
<a name="l11238"></a>11238 
<a name="l11239"></a>11239 
<a name="l11240"></a>11240 BlitLineSetup:                                                    <span class="comment">// Does any actual blitting (trans/non) for the line</span>
<a name="l11241"></a>11241             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l11242"></a>11242             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l11243"></a>11243             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l11244"></a>11244 
<a name="l11245"></a>11245 BlitDispatch:
<a name="l11246"></a>11246 
<a name="l11247"></a>11247             cmp         LSCount, 0                                      <span class="comment">// Check to see if we're done blitting</span>
<a name="l11248"></a>11248             je          RightSkipLoop
<a name="l11249"></a>11249 
<a name="l11250"></a>11250             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l11251"></a>11251             inc         esi
<a name="l11252"></a>11252             or          cl, cl
<a name="l11253"></a>11253             js          BlitTransparent
<a name="l11254"></a>11254 
<a name="l11255"></a>11255 BlitNonTransLoop:                                           <span class="comment">// blit non-transparent pixels</span>
<a name="l11256"></a>11256 
<a name="l11257"></a>11257             cmp         ecx, LSCount
<a name="l11258"></a>11258             jbe         BNTrans1
<a name="l11259"></a>11259 
<a name="l11260"></a>11260             sub         ecx, LSCount
<a name="l11261"></a>11261             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, ecx
<a name="l11262"></a>11262             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, LSCount
<a name="l11263"></a>11263 
<a name="l11264"></a>11264 BNTrans1:
<a name="l11265"></a>11265             sub         LSCount, ecx
<a name="l11266"></a>11266 
<a name="l11267"></a>11267 BlitNTL1:
<a name="l11268"></a>11268 
<a name="l11269"></a>11269             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l11270"></a>11270             cmp         ax, usZValue
<a name="l11271"></a>11271             ja          BlitNTL2
<a name="l11272"></a>11272 
<a name="l11273"></a>11273             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, usZValue
<a name="l11274"></a>11274             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [ebx], ax
<a name="l11275"></a>11275 
<a name="l11276"></a>11276             xor         eax, eax
<a name="l11277"></a>11277 
<a name="l11278"></a>11278             mov         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l11279"></a>11279             mov         ax, [edx+eax*2]
<a name="l11280"></a>11280             mov         [edi], ax
<a name="l11281"></a>11281 
<a name="l11282"></a>11282 BlitNTL2:
<a name="l11283"></a>11283             inc         esi
<a name="l11284"></a>11284             add         edi, 2
<a name="l11285"></a>11285             add         ebx, 2
<a name="l11286"></a>11286             dec         cl
<a name="l11287"></a>11287             jnz         BlitNTL1
<a name="l11288"></a>11288 
<a name="l11289"></a>11289 <span class="comment">//BlitLineEnd:</span>
<a name="l11290"></a>11290             add         esi, Unblitted
<a name="l11291"></a>11291             jmp         BlitDispatch
<a name="l11292"></a>11292 
<a name="l11293"></a>11293 BlitTransparent:                                                              <span class="comment">// skip transparent pixels</span>
<a name="l11294"></a>11294 
<a name="l11295"></a>11295             and         ecx, 07fH
<a name="l11296"></a>11296             cmp         ecx, LSCount
<a name="l11297"></a>11297             jbe         BTrans1
<a name="l11298"></a>11298 
<a name="l11299"></a>11299             mov         ecx, LSCount
<a name="l11300"></a>11300 
<a name="l11301"></a>11301 BTrans1:
<a name="l11302"></a>11302 
<a name="l11303"></a>11303             sub         LSCount, ecx
<a name="l11304"></a>11304 <span class="comment">//          shl         ecx, 1</span>
<a name="l11305"></a>11305             add   ecx, ecx
<a name="l11306"></a>11306             add         edi, ecx
<a name="l11307"></a>11307             add         ebx, ecx
<a name="l11308"></a>11308             jmp         BlitDispatch
<a name="l11309"></a>11309 
<a name="l11310"></a>11310 
<a name="l11311"></a>11311 RightSkipLoop:                                                                      <span class="comment">// skip along until we hit and end-of-line marker</span>
<a name="l11312"></a>11312 
<a name="l11313"></a>11313 
<a name="l11314"></a>11314 RSLoop1:
<a name="l11315"></a>11315             mov         al, [esi]
<a name="l11316"></a>11316             inc         esi
<a name="l11317"></a>11317             or          al, al
<a name="l11318"></a>11318             jnz         RSLoop1
<a name="l11319"></a>11319 
<a name="l11320"></a>11320             dec         BlitHeight
<a name="l11321"></a>11321             jz          BlitDone
<a name="l11322"></a>11322             add         edi, LineSkip
<a name="l11323"></a>11323             add         ebx, LineSkip
<a name="l11324"></a>11324 
<a name="l11325"></a>11325             jmp         LeftSkipSetup
<a name="l11326"></a>11326 
<a name="l11327"></a>11327 
<a name="l11328"></a>11328 BlitDone:
<a name="l11329"></a>11329       }
<a name="l11330"></a>11330 
<a name="l11331"></a>11331       <span class="keywordflow">return</span>(TRUE);
<a name="l11332"></a>11332 
<a name="l11333"></a>11333 }
<a name="l11334"></a>11334 
<a name="l11335"></a>11335 <span class="comment">/**********************************************************************************************</span>
<a name="l11336"></a>11336 <span class="comment"> Blt8BPPDataTo16BPPBufferTransZNBClip</span>
<a name="l11337"></a>11337 <span class="comment"></span>
<a name="l11338"></a>11338 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l11339"></a>11339 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l11340"></a>11340 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on. The Z value is NOT</span>
<a name="l11341"></a>11341 <span class="comment">      updated in this version. The Z-buffer is 16 bit, and must be the same dimensions (including Pitch) as the destination.</span>
<a name="l11342"></a>11342 <span class="comment"></span>
<a name="l11343"></a>11343 <span class="comment">**********************************************************************************************/</span>
<a name="l11344"></a><a class="code" href="vobject__blitters_8h.html#8787c223d08d37daee36efc85678b095">11344</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#8787c223d08d37daee36efc85678b095">Blt8BPPDataTo16BPPBufferTransZNBClip</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="structSGPRect.html">SGPRect</a> *clipregion)
<a name="l11345"></a>11345 {
<a name="l11346"></a>11346       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l11347"></a>11347       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l11348"></a>11348       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth, Unblitted;
<a name="l11349"></a>11349       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l11350"></a>11350       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l11351"></a>11351   <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l11352"></a>11352       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY, LeftSkip, RightSkip, TopSkip, BottomSkip, BlitLength, BlitHeight, LSCount;
<a name="l11353"></a>11353       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  ClipX1, ClipY1, ClipX2, ClipY2;
<a name="l11354"></a>11354 
<a name="l11355"></a>11355       <span class="comment">// Assertions</span>
<a name="l11356"></a>11356       Assert( hSrcVObject != NULL );
<a name="l11357"></a>11357       Assert( pBuffer != NULL );
<a name="l11358"></a>11358 
<a name="l11359"></a>11359       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l11360"></a>11360       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l11361"></a>11361       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l11362"></a>11362       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l11363"></a>11363       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l11364"></a>11364 
<a name="l11365"></a>11365       <span class="comment">// Add to start position of dest buffer</span>
<a name="l11366"></a>11366       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l11367"></a>11367       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l11368"></a>11368 
<a name="l11369"></a>11369       <span class="keywordflow">if</span>(clipregion==NULL)
<a name="l11370"></a>11370       {
<a name="l11371"></a>11371             ClipX1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l11372"></a>11372             ClipY1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l11373"></a>11373             ClipX2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l11374"></a>11374             ClipY2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l11375"></a>11375       }
<a name="l11376"></a>11376       <span class="keywordflow">else</span>
<a name="l11377"></a>11377       {
<a name="l11378"></a>11378             ClipX1=clipregion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l11379"></a>11379             ClipY1=clipregion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l11380"></a>11380             ClipX2=clipregion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l11381"></a>11381             ClipY2=clipregion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l11382"></a>11382       }
<a name="l11383"></a>11383 
<a name="l11384"></a>11384       <span class="comment">// Calculate rows hanging off each side of the screen</span>
<a name="l11385"></a>11385       LeftSkip=__min(ClipX1 - min(ClipX1, iTempX), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l11386"></a>11386       RightSkip=__min(max(ClipX2, (iTempX+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth)) - ClipX2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l11387"></a>11387       TopSkip=__min(ClipY1 - __min(ClipY1, iTempY), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l11388"></a>11388       BottomSkip=__min(__max(ClipY2, (iTempY+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight)) - ClipY2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l11389"></a>11389 
<a name="l11390"></a>11390       <span class="comment">// calculate the remaining rows and columns to blit</span>
<a name="l11391"></a>11391       BlitLength=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth-LeftSkip-RightSkip);
<a name="l11392"></a>11392       BlitHeight=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight-TopSkip-BottomSkip);
<a name="l11393"></a>11393 
<a name="l11394"></a>11394       <span class="comment">// check if whole thing is clipped</span>
<a name="l11395"></a>11395       <span class="keywordflow">if</span>((LeftSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth) || (RightSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth))
<a name="l11396"></a>11396             <span class="keywordflow">return</span>(TRUE);
<a name="l11397"></a>11397 
<a name="l11398"></a>11398       <span class="comment">// check if whole thing is clipped</span>
<a name="l11399"></a>11399       <span class="keywordflow">if</span>((TopSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight) || (BottomSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight))
<a name="l11400"></a>11400             <span class="keywordflow">return</span>(TRUE);
<a name="l11401"></a>11401 
<a name="l11402"></a>11402       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l11403"></a>11403       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l11404"></a>11404       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l11405"></a>11405       p16BPPPalette = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#930609ad8d5cdbb05449df70bd83cfcd">pShadeCurrent</a>;
<a name="l11406"></a>11406       LineSkip=(uiDestPitchBYTES-(BlitLength*2));
<a name="l11407"></a>11407 
<a name="l11408"></a>11408       __asm {
<a name="l11409"></a>11409 
<a name="l11410"></a>11410             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l11411"></a>11411             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l11412"></a>11412             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, p16BPPPalette
<a name="l11413"></a>11413             xor         eax, eax
<a name="l11414"></a>11414             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l11415"></a>11415             xor         ecx, ecx
<a name="l11416"></a>11416 
<a name="l11417"></a>11417             cmp         TopSkip, 0                                      <span class="comment">// check for nothing clipped on top</span>
<a name="l11418"></a>11418             je          LeftSkipSetup
<a name="l11419"></a>11419 
<a name="l11420"></a>11420 TopSkipLoop:                                                            <span class="comment">// Skips the number of lines clipped at the top</span>
<a name="l11421"></a>11421 
<a name="l11422"></a>11422             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l11423"></a>11423             inc         esi
<a name="l11424"></a>11424             or          cl, cl
<a name="l11425"></a>11425             js          TopSkipLoop
<a name="l11426"></a>11426             jz          TSEndLine
<a name="l11427"></a>11427 
<a name="l11428"></a>11428             add         esi, ecx
<a name="l11429"></a>11429             jmp         TopSkipLoop
<a name="l11430"></a>11430 
<a name="l11431"></a>11431 TSEndLine:
<a name="l11432"></a>11432             dec         TopSkip
<a name="l11433"></a>11433             jnz         TopSkipLoop
<a name="l11434"></a>11434 
<a name="l11435"></a>11435 LeftSkipSetup:
<a name="l11436"></a>11436 
<a name="l11437"></a>11437             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l11438"></a>11438             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, LeftSkip
<a name="l11439"></a>11439             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l11440"></a>11440             or          eax, eax
<a name="l11441"></a>11441             jz          BlitLineSetup
<a name="l11442"></a>11442 
<a name="l11443"></a>11443 LeftSkipLoop:
<a name="l11444"></a>11444 
<a name="l11445"></a>11445             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l11446"></a>11446             inc         esi
<a name="l11447"></a>11447 
<a name="l11448"></a>11448             or          cl, cl
<a name="l11449"></a>11449             js          LSTrans
<a name="l11450"></a>11450 
<a name="l11451"></a>11451             cmp         ecx, LSCount
<a name="l11452"></a>11452             je          LSSkip2                                               <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l11453"></a>11453             jb          LSSkip1                                               <span class="comment">// if less, skip whole thing</span>
<a name="l11454"></a>11454 
<a name="l11455"></a>11455             add         esi, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l11456"></a>11456             sub         ecx, LSCount
<a name="l11457"></a>11457             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l11458"></a>11458             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l11459"></a>11459             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l11460"></a>11460             jmp         BlitNonTransLoop
<a name="l11461"></a>11461 
<a name="l11462"></a>11462 LSSkip2:
<a name="l11463"></a>11463             add         esi, ecx                                        <span class="comment">// skip whole run, and start blit with new run</span>
<a name="l11464"></a>11464             jmp         BlitLineSetup
<a name="l11465"></a>11465 
<a name="l11466"></a>11466 
<a name="l11467"></a>11467 LSSkip1:
<a name="l11468"></a>11468             add         esi, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l11469"></a>11469             sub         LSCount, ecx
<a name="l11470"></a>11470             jmp         LeftSkipLoop
<a name="l11471"></a>11471 
<a name="l11472"></a>11472 
<a name="l11473"></a>11473 LSTrans:
<a name="l11474"></a>11474             and         ecx, 07fH
<a name="l11475"></a>11475             cmp         ecx, LSCount
<a name="l11476"></a>11476             je          BlitLineSetup                             <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l11477"></a>11477             jb          LSTrans1                                        <span class="comment">// if less, skip whole thing</span>
<a name="l11478"></a>11478 
<a name="l11479"></a>11479             sub         ecx, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l11480"></a>11480             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l11481"></a>11481             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l11482"></a>11482             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l11483"></a>11483             jmp         BlitTransparent
<a name="l11484"></a>11484 
<a name="l11485"></a>11485 
<a name="l11486"></a>11486 LSTrans1:
<a name="l11487"></a>11487             sub         LSCount, ecx                                          <span class="comment">// skip whole run, continue skipping</span>
<a name="l11488"></a>11488             jmp         LeftSkipLoop
<a name="l11489"></a>11489 
<a name="l11490"></a>11490 
<a name="l11491"></a>11491 BlitLineSetup:                                                    <span class="comment">// Does any actual blitting (trans/non) for the line</span>
<a name="l11492"></a>11492             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l11493"></a>11493             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l11494"></a>11494             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l11495"></a>11495 
<a name="l11496"></a>11496 BlitDispatch:
<a name="l11497"></a>11497 
<a name="l11498"></a>11498             cmp         LSCount, 0                                      <span class="comment">// Check to see if we're done blitting</span>
<a name="l11499"></a>11499             je          RightSkipLoop
<a name="l11500"></a>11500 
<a name="l11501"></a>11501             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l11502"></a>11502             inc         esi
<a name="l11503"></a>11503             or          cl, cl
<a name="l11504"></a>11504             js          BlitTransparent
<a name="l11505"></a>11505 
<a name="l11506"></a>11506 BlitNonTransLoop:                                           <span class="comment">// blit non-transparent pixels</span>
<a name="l11507"></a>11507 
<a name="l11508"></a>11508             cmp         ecx, LSCount
<a name="l11509"></a>11509             jbe         BNTrans1
<a name="l11510"></a>11510 
<a name="l11511"></a>11511             sub         ecx, LSCount
<a name="l11512"></a>11512             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, ecx
<a name="l11513"></a>11513             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, LSCount
<a name="l11514"></a>11514 
<a name="l11515"></a>11515 BNTrans1:
<a name="l11516"></a>11516             sub         LSCount, ecx
<a name="l11517"></a>11517 
<a name="l11518"></a>11518 BlitNTL1:
<a name="l11519"></a>11519 
<a name="l11520"></a>11520             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l11521"></a>11521             cmp         ax, usZValue
<a name="l11522"></a>11522             ja          BlitNTL2
<a name="l11523"></a>11523 
<a name="l11524"></a>11524             xor         eax, eax
<a name="l11525"></a>11525 
<a name="l11526"></a>11526             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l11527"></a>11527             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, [edx+eax*2]
<a name="l11528"></a>11528             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax
<a name="l11529"></a>11529 
<a name="l11530"></a>11530 BlitNTL2:
<a name="l11531"></a>11531             inc         esi
<a name="l11532"></a>11532             add         edi, 2
<a name="l11533"></a>11533             add         ebx, 2
<a name="l11534"></a>11534             dec         cl
<a name="l11535"></a>11535             jnz         BlitNTL1
<a name="l11536"></a>11536 
<a name="l11537"></a>11537 <span class="comment">//BlitLineEnd:</span>
<a name="l11538"></a>11538             add         esi, Unblitted
<a name="l11539"></a>11539             jmp         BlitDispatch
<a name="l11540"></a>11540 
<a name="l11541"></a>11541 BlitTransparent:                                                              <span class="comment">// skip transparent pixels</span>
<a name="l11542"></a>11542 
<a name="l11543"></a>11543             and         ecx, 07fH
<a name="l11544"></a>11544             cmp         ecx, LSCount
<a name="l11545"></a>11545             jbe         BTrans1
<a name="l11546"></a>11546 
<a name="l11547"></a>11547             mov         ecx, LSCount
<a name="l11548"></a>11548 
<a name="l11549"></a>11549 BTrans1:
<a name="l11550"></a>11550 
<a name="l11551"></a>11551             sub         LSCount, ecx
<a name="l11552"></a>11552 <span class="comment">//          shl         ecx, 1</span>
<a name="l11553"></a>11553             add   ecx, ecx
<a name="l11554"></a>11554             add         edi, ecx
<a name="l11555"></a>11555             add         ebx, ecx
<a name="l11556"></a>11556             jmp         BlitDispatch
<a name="l11557"></a>11557 
<a name="l11558"></a>11558 
<a name="l11559"></a>11559 RightSkipLoop:                                                                      <span class="comment">// skip along until we hit and end-of-line marker</span>
<a name="l11560"></a>11560 
<a name="l11561"></a>11561 
<a name="l11562"></a>11562 RSLoop1:
<a name="l11563"></a>11563             mov         al, [esi]
<a name="l11564"></a>11564             inc         esi
<a name="l11565"></a>11565             or          al, al
<a name="l11566"></a>11566             jnz         RSLoop1
<a name="l11567"></a>11567 
<a name="l11568"></a>11568             dec         BlitHeight
<a name="l11569"></a>11569             jz          BlitDone
<a name="l11570"></a>11570             add         edi, LineSkip
<a name="l11571"></a>11571             add         ebx, LineSkip
<a name="l11572"></a>11572 
<a name="l11573"></a>11573             jmp         LeftSkipSetup
<a name="l11574"></a>11574 
<a name="l11575"></a>11575 
<a name="l11576"></a>11576 BlitDone:
<a name="l11577"></a>11577       }
<a name="l11578"></a>11578 
<a name="l11579"></a>11579       <span class="keywordflow">return</span>(TRUE);
<a name="l11580"></a>11580 
<a name="l11581"></a>11581 }
<a name="l11582"></a>11582 
<a name="l11583"></a>11583 <span class="comment">/**********************************************************************************************</span>
<a name="l11584"></a>11584 <span class="comment"> Blt8BPPDataTo16BPPBufferTransZNBClipColor</span>
<a name="l11585"></a>11585 <span class="comment"></span>
<a name="l11586"></a>11586 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l11587"></a>11587 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l11588"></a>11588 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on. The Z value is NOT</span>
<a name="l11589"></a>11589 <span class="comment">      updated in this version. The Z-buffer is 16 bit, and must be the same dimensions (including</span>
<a name="l11590"></a>11590 <span class="comment">      Pitch) as the destination. Any pixels that fail the Z test are written to with the</span>
<a name="l11591"></a>11591 <span class="comment">      specified pixel value.</span>
<a name="l11592"></a>11592 <span class="comment"></span>
<a name="l11593"></a>11593 <span class="comment">**********************************************************************************************/</span>
<a name="l11594"></a><a class="code" href="vobject__blitters_8h.html#fb1b20ee7965cdc8a33b8f4fc46a4b34">11594</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#fb1b20ee7965cdc8a33b8f4fc46a4b34">Blt8BPPDataTo16BPPBufferTransZNBClipColor</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="structSGPRect.html">SGPRect</a> *clipregion, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usColor)
<a name="l11595"></a>11595 {
<a name="l11596"></a>11596       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l11597"></a>11597       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l11598"></a>11598       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth, Unblitted;
<a name="l11599"></a>11599       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l11600"></a>11600       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l11601"></a>11601   <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l11602"></a>11602       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY, LeftSkip, RightSkip, TopSkip, BottomSkip, BlitLength, BlitHeight, LSCount;
<a name="l11603"></a>11603       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  ClipX1, ClipY1, ClipX2, ClipY2;
<a name="l11604"></a>11604 
<a name="l11605"></a>11605       <span class="comment">// Assertions</span>
<a name="l11606"></a>11606       Assert( hSrcVObject != NULL );
<a name="l11607"></a>11607       Assert( pBuffer != NULL );
<a name="l11608"></a>11608 
<a name="l11609"></a>11609       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l11610"></a>11610       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l11611"></a>11611       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l11612"></a>11612       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l11613"></a>11613       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l11614"></a>11614 
<a name="l11615"></a>11615       <span class="comment">// Add to start position of dest buffer</span>
<a name="l11616"></a>11616       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l11617"></a>11617       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l11618"></a>11618 
<a name="l11619"></a>11619       <span class="keywordflow">if</span>(clipregion==NULL)
<a name="l11620"></a>11620       {
<a name="l11621"></a>11621             ClipX1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l11622"></a>11622             ClipY1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l11623"></a>11623             ClipX2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l11624"></a>11624             ClipY2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l11625"></a>11625       }
<a name="l11626"></a>11626       <span class="keywordflow">else</span>
<a name="l11627"></a>11627       {
<a name="l11628"></a>11628             ClipX1=clipregion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l11629"></a>11629             ClipY1=clipregion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l11630"></a>11630             ClipX2=clipregion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l11631"></a>11631             ClipY2=clipregion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l11632"></a>11632       }
<a name="l11633"></a>11633 
<a name="l11634"></a>11634       <span class="comment">// Calculate rows hanging off each side of the screen</span>
<a name="l11635"></a>11635       LeftSkip=__min(ClipX1 - min(ClipX1, iTempX), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l11636"></a>11636       RightSkip=__min(max(ClipX2, (iTempX+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth)) - ClipX2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l11637"></a>11637       TopSkip=__min(ClipY1 - __min(ClipY1, iTempY), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l11638"></a>11638       BottomSkip=__min(__max(ClipY2, (iTempY+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight)) - ClipY2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l11639"></a>11639 
<a name="l11640"></a>11640       <span class="comment">// calculate the remaining rows and columns to blit</span>
<a name="l11641"></a>11641       BlitLength=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth-LeftSkip-RightSkip);
<a name="l11642"></a>11642       BlitHeight=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight-TopSkip-BottomSkip);
<a name="l11643"></a>11643 
<a name="l11644"></a>11644       <span class="comment">// check if whole thing is clipped</span>
<a name="l11645"></a>11645       <span class="keywordflow">if</span>((LeftSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth) || (RightSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth))
<a name="l11646"></a>11646             <span class="keywordflow">return</span>(TRUE);
<a name="l11647"></a>11647 
<a name="l11648"></a>11648       <span class="comment">// check if whole thing is clipped</span>
<a name="l11649"></a>11649       <span class="keywordflow">if</span>((TopSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight) || (BottomSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight))
<a name="l11650"></a>11650             <span class="keywordflow">return</span>(TRUE);
<a name="l11651"></a>11651 
<a name="l11652"></a>11652       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l11653"></a>11653       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l11654"></a>11654       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l11655"></a>11655       p16BPPPalette = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#930609ad8d5cdbb05449df70bd83cfcd">pShadeCurrent</a>;
<a name="l11656"></a>11656       LineSkip=(uiDestPitchBYTES-(BlitLength*2));
<a name="l11657"></a>11657 
<a name="l11658"></a>11658       __asm {
<a name="l11659"></a>11659 
<a name="l11660"></a>11660             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l11661"></a>11661             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l11662"></a>11662             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, p16BPPPalette
<a name="l11663"></a>11663             xor         eax, eax
<a name="l11664"></a>11664             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l11665"></a>11665             xor         ecx, ecx
<a name="l11666"></a>11666 
<a name="l11667"></a>11667             cmp         TopSkip, 0                                      <span class="comment">// check for nothing clipped on top</span>
<a name="l11668"></a>11668             je          LeftSkipSetup
<a name="l11669"></a>11669 
<a name="l11670"></a>11670 TopSkipLoop:                                                            <span class="comment">// Skips the number of lines clipped at the top</span>
<a name="l11671"></a>11671 
<a name="l11672"></a>11672             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l11673"></a>11673             inc         esi
<a name="l11674"></a>11674             or          cl, cl
<a name="l11675"></a>11675             js          TopSkipLoop
<a name="l11676"></a>11676             jz          TSEndLine
<a name="l11677"></a>11677 
<a name="l11678"></a>11678             add         esi, ecx
<a name="l11679"></a>11679             jmp         TopSkipLoop
<a name="l11680"></a>11680 
<a name="l11681"></a>11681 TSEndLine:
<a name="l11682"></a>11682             dec         TopSkip
<a name="l11683"></a>11683             jnz         TopSkipLoop
<a name="l11684"></a>11684 
<a name="l11685"></a>11685 LeftSkipSetup:
<a name="l11686"></a>11686 
<a name="l11687"></a>11687             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l11688"></a>11688             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, LeftSkip
<a name="l11689"></a>11689             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l11690"></a>11690             or          eax, eax
<a name="l11691"></a>11691             jz          BlitLineSetup
<a name="l11692"></a>11692 
<a name="l11693"></a>11693 LeftSkipLoop:
<a name="l11694"></a>11694 
<a name="l11695"></a>11695             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l11696"></a>11696             inc         esi
<a name="l11697"></a>11697 
<a name="l11698"></a>11698             or          cl, cl
<a name="l11699"></a>11699             js          LSTrans
<a name="l11700"></a>11700 
<a name="l11701"></a>11701             cmp         ecx, LSCount
<a name="l11702"></a>11702             je          LSSkip2                                               <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l11703"></a>11703             jb          LSSkip1                                               <span class="comment">// if less, skip whole thing</span>
<a name="l11704"></a>11704 
<a name="l11705"></a>11705             add         esi, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l11706"></a>11706             sub         ecx, LSCount
<a name="l11707"></a>11707             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l11708"></a>11708             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l11709"></a>11709             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l11710"></a>11710             jmp         BlitNonTransLoop
<a name="l11711"></a>11711 
<a name="l11712"></a>11712 LSSkip2:
<a name="l11713"></a>11713             add         esi, ecx                                        <span class="comment">// skip whole run, and start blit with new run</span>
<a name="l11714"></a>11714             jmp         BlitLineSetup
<a name="l11715"></a>11715 
<a name="l11716"></a>11716 
<a name="l11717"></a>11717 LSSkip1:
<a name="l11718"></a>11718             add         esi, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l11719"></a>11719             sub         LSCount, ecx
<a name="l11720"></a>11720             jmp         LeftSkipLoop
<a name="l11721"></a>11721 
<a name="l11722"></a>11722 
<a name="l11723"></a>11723 LSTrans:
<a name="l11724"></a>11724             and         ecx, 07fH
<a name="l11725"></a>11725             cmp         ecx, LSCount
<a name="l11726"></a>11726             je          BlitLineSetup                             <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l11727"></a>11727             jb          LSTrans1                                        <span class="comment">// if less, skip whole thing</span>
<a name="l11728"></a>11728 
<a name="l11729"></a>11729             sub         ecx, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l11730"></a>11730             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l11731"></a>11731             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l11732"></a>11732             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l11733"></a>11733             jmp         BlitTransparent
<a name="l11734"></a>11734 
<a name="l11735"></a>11735 
<a name="l11736"></a>11736 LSTrans1:
<a name="l11737"></a>11737             sub         LSCount, ecx                                          <span class="comment">// skip whole run, continue skipping</span>
<a name="l11738"></a>11738             jmp         LeftSkipLoop
<a name="l11739"></a>11739 
<a name="l11740"></a>11740 
<a name="l11741"></a>11741 BlitLineSetup:                                                    <span class="comment">// Does any actual blitting (trans/non) for the line</span>
<a name="l11742"></a>11742             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l11743"></a>11743             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l11744"></a>11744             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l11745"></a>11745 
<a name="l11746"></a>11746 BlitDispatch:
<a name="l11747"></a>11747 
<a name="l11748"></a>11748             cmp         LSCount, 0                                      <span class="comment">// Check to see if we're done blitting</span>
<a name="l11749"></a>11749             je          RightSkipLoop
<a name="l11750"></a>11750 
<a name="l11751"></a>11751             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l11752"></a>11752             inc         esi
<a name="l11753"></a>11753             or          cl, cl
<a name="l11754"></a>11754             js          BlitTransparent
<a name="l11755"></a>11755 
<a name="l11756"></a>11756 BlitNonTransLoop:                                           <span class="comment">// blit non-transparent pixels</span>
<a name="l11757"></a>11757 
<a name="l11758"></a>11758             cmp         ecx, LSCount
<a name="l11759"></a>11759             jbe         BNTrans1
<a name="l11760"></a>11760 
<a name="l11761"></a>11761             sub         ecx, LSCount
<a name="l11762"></a>11762             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, ecx
<a name="l11763"></a>11763             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, LSCount
<a name="l11764"></a>11764 
<a name="l11765"></a>11765 BNTrans1:
<a name="l11766"></a>11766             sub         LSCount, ecx
<a name="l11767"></a>11767             xor         eax, eax
<a name="l11768"></a>11768 
<a name="l11769"></a>11769 BlitNTL1:
<a name="l11770"></a>11770 
<a name="l11771"></a>11771             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l11772"></a>11772             cmp         ax, usZValue
<a name="l11773"></a>11773             ja          BlitNTL2
<a name="l11774"></a>11774 
<a name="l11775"></a>11775             xor         ah, ah
<a name="l11776"></a>11776             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l11777"></a>11777             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, [edx+eax*2]
<a name="l11778"></a>11778             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax
<a name="l11779"></a>11779             jmp         BlitNTL3
<a name="l11780"></a>11780 
<a name="l11781"></a>11781 BlitNTL2:
<a name="l11782"></a>11782 
<a name="l11783"></a>11783             mov         ax, usColor
<a name="l11784"></a>11784             mov         [edi], ax
<a name="l11785"></a>11785 
<a name="l11786"></a>11786 BlitNTL3:
<a name="l11787"></a>11787             inc         esi
<a name="l11788"></a>11788             inc         edi
<a name="l11789"></a>11789             inc         ebx
<a name="l11790"></a>11790             inc         edi
<a name="l11791"></a>11791             inc         ebx
<a name="l11792"></a>11792             dec         cl
<a name="l11793"></a>11793             jnz         BlitNTL1
<a name="l11794"></a>11794 
<a name="l11795"></a>11795 <span class="comment">//BlitLineEnd:</span>
<a name="l11796"></a>11796             add         esi, Unblitted
<a name="l11797"></a>11797             jmp         BlitDispatch
<a name="l11798"></a>11798 
<a name="l11799"></a>11799 BlitTransparent:                                                              <span class="comment">// skip transparent pixels</span>
<a name="l11800"></a>11800 
<a name="l11801"></a>11801             and         ecx, 07fH
<a name="l11802"></a>11802             cmp         ecx, LSCount
<a name="l11803"></a>11803             jbe         BTrans1
<a name="l11804"></a>11804 
<a name="l11805"></a>11805             mov         ecx, LSCount
<a name="l11806"></a>11806 
<a name="l11807"></a>11807 BTrans1:
<a name="l11808"></a>11808 
<a name="l11809"></a>11809             sub         LSCount, ecx
<a name="l11810"></a>11810 <span class="comment">//          shl         ecx, 1</span>
<a name="l11811"></a>11811             add   ecx, ecx
<a name="l11812"></a>11812             add         edi, ecx
<a name="l11813"></a>11813             add         ebx, ecx
<a name="l11814"></a>11814             jmp         BlitDispatch
<a name="l11815"></a>11815 
<a name="l11816"></a>11816 
<a name="l11817"></a>11817 RightSkipLoop:                                                                      <span class="comment">// skip along until we hit and end-of-line marker</span>
<a name="l11818"></a>11818 
<a name="l11819"></a>11819 
<a name="l11820"></a>11820 RSLoop1:
<a name="l11821"></a>11821             mov         al, [esi]
<a name="l11822"></a>11822             inc         esi
<a name="l11823"></a>11823             or          al, al
<a name="l11824"></a>11824             jnz         RSLoop1
<a name="l11825"></a>11825 
<a name="l11826"></a>11826             dec         BlitHeight
<a name="l11827"></a>11827             jz          BlitDone
<a name="l11828"></a>11828             add         edi, LineSkip
<a name="l11829"></a>11829             add         ebx, LineSkip
<a name="l11830"></a>11830 
<a name="l11831"></a>11831             jmp         LeftSkipSetup
<a name="l11832"></a>11832 
<a name="l11833"></a>11833 
<a name="l11834"></a>11834 BlitDone:
<a name="l11835"></a>11835       }
<a name="l11836"></a>11836 
<a name="l11837"></a>11837       <span class="keywordflow">return</span>(TRUE);
<a name="l11838"></a>11838 
<a name="l11839"></a>11839 }
<a name="l11840"></a>11840 
<a name="l11841"></a>11841 <span class="comment">/**********************************************************************************************</span>
<a name="l11842"></a>11842 <span class="comment"> Blt8BPPDataSubTo16BPPBuffer</span>
<a name="l11843"></a>11843 <span class="comment"></span>
<a name="l11844"></a>11844 <span class="comment">      Blits a subrect from a flat 8 bit surface to a 16-bit buffer.</span>
<a name="l11845"></a>11845 <span class="comment"></span>
<a name="l11846"></a>11846 <span class="comment">**********************************************************************************************/</span>
<a name="l11847"></a><a class="code" href="vobject__blitters_8h.html#14adcdad104549501be4facd5b469438">11847</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#14adcdad104549501be4facd5b469438">Blt8BPPDataSubTo16BPPBuffer</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="structSGPVSurface.html">HVSURFACE</a> hSrcVSurface, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *pSrcBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiSrcPitch, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="structSGPRect.html">SGPRect</a> *pRect)
<a name="l11848"></a>11848 {
<a name="l11849"></a>11849       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l11850"></a>11850       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth;
<a name="l11851"></a>11851       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr;
<a name="l11852"></a>11852       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip, LeftSkip, RightSkip, TopSkip, BlitLength, SrcSkip, BlitHeight;
<a name="l11853"></a>11853       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l11854"></a>11854 
<a name="l11855"></a>11855       <span class="comment">// Assertions</span>
<a name="l11856"></a>11856       Assert( hSrcVSurface != NULL );
<a name="l11857"></a>11857       Assert( pSrcBuffer != NULL );
<a name="l11858"></a>11858       Assert( pBuffer != NULL );
<a name="l11859"></a>11859 
<a name="l11860"></a>11860       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l11861"></a>11861       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)hSrcVSurface-&gt;<a class="code" href="structSGPVSurface.html#fc10a1ce49a8cefdb4e510d8b910eb0c">usHeight</a>;
<a name="l11862"></a>11862       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)hSrcVSurface-&gt;<a class="code" href="structSGPVSurface.html#95c7973670e82832e7047103d8b3d32a">usWidth</a>;
<a name="l11863"></a>11863 
<a name="l11864"></a>11864       <span class="comment">// Add to start position of dest buffer</span>
<a name="l11865"></a>11865       iTempX = iX;
<a name="l11866"></a>11866       iTempY = iY;
<a name="l11867"></a>11867 
<a name="l11868"></a>11868       <span class="comment">// Validations</span>
<a name="l11869"></a>11869       CHECKF( iTempX &gt;= 0 );
<a name="l11870"></a>11870       CHECKF( iTempY &gt;= 0 );
<a name="l11871"></a>11871 
<a name="l11872"></a>11872       LeftSkip=pRect-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l11873"></a>11873       RightSkip=usWidth-pRect-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l11874"></a>11874       TopSkip=pRect-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>*uiSrcPitch;
<a name="l11875"></a>11875       BlitLength=pRect-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>-pRect-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l11876"></a>11876       BlitHeight=pRect-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>-pRect-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l11877"></a>11877       SrcSkip=uiSrcPitch-BlitLength;
<a name="l11878"></a>11878 
<a name="l11879"></a>11879       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)(pSrcBuffer+TopSkip+LeftSkip);
<a name="l11880"></a>11880       DestPtr = ((<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2));
<a name="l11881"></a>11881       p16BPPPalette = hSrcVSurface-&gt;<a class="code" href="structSGPVSurface.html#040b0e74b7c77c352bc7274c20c27cd2">p16BPPPalette</a>;
<a name="l11882"></a>11882       LineSkip=(uiDestPitchBYTES-(BlitLength*2));
<a name="l11883"></a>11883 
<a name="l11884"></a>11884       __asm {
<a name="l11885"></a>11885 
<a name="l11886"></a>11886             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr                         <span class="comment">// pointer to current line start address in source</span>
<a name="l11887"></a>11887             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr                        <span class="comment">// pointer to current line start address in destination</span>
<a name="l11888"></a>11888             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, BlitHeight               <span class="comment">// line counter (goes top to bottom)</span>
<a name="l11889"></a>11889             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, p16BPPPalette      <span class="comment">// conversion table</span>
<a name="l11890"></a>11890 
<a name="l11891"></a>11891             sub         eax, eax
<a name="l11892"></a>11892             sub         ecx, ecx
<a name="l11893"></a>11893 
<a name="l11894"></a>11894 NewRow:
<a name="l11895"></a>11895             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, BlitLength               <span class="comment">// pixels to blit count</span>
<a name="l11896"></a>11896 
<a name="l11897"></a>11897 BlitLoop:
<a name="l11898"></a>11898             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l11899"></a>11899             xor         ah, ah
<a name="l11900"></a>11900 
<a name="l11901"></a>11901             shl         eax, 1                                          <span class="comment">// make it into a word index</span>
<a name="l11902"></a>11902             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [edx+eax]                       <span class="comment">// get 16-bit version of 8-bit pixel</span>
<a name="l11903"></a>11903             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax                                 <span class="comment">// store it in destination buffer</span>
<a name="l11904"></a>11904 
<a name="l11905"></a>11905             inc         edi
<a name="l11906"></a>11906             inc         esi
<a name="l11907"></a>11907             inc         edi
<a name="l11908"></a>11908             dec         ecx
<a name="l11909"></a>11909             jnz         BlitLoop
<a name="l11910"></a>11910 
<a name="l11911"></a>11911             add         esi, SrcSkip                        <span class="comment">// move line pointers down one line</span>
<a name="l11912"></a>11912             add         edi, LineSkip
<a name="l11913"></a>11913 
<a name="l11914"></a>11914             dec         ebx                                                   <span class="comment">// check line counter</span>
<a name="l11915"></a>11915             jnz         NewRow                                          <span class="comment">// done blitting, exit</span>
<a name="l11916"></a>11916 
<a name="l11917"></a>11917 <span class="comment">//DoneBlit:                                                             // finished blit</span>
<a name="l11918"></a>11918       }
<a name="l11919"></a>11919 
<a name="l11920"></a>11920       <span class="keywordflow">return</span>( TRUE );
<a name="l11921"></a>11921 
<a name="l11922"></a>11922 }
<a name="l11923"></a>11923 
<a name="l11924"></a>11924 
<a name="l11925"></a>11925 <span class="comment">/**********************************************************************************************</span>
<a name="l11926"></a>11926 <span class="comment"> Blt8BPPDataTo16BPPBuffer</span>
<a name="l11927"></a>11927 <span class="comment"></span>
<a name="l11928"></a>11928 <span class="comment">      Blits from a flat surface to a 16-bit buffer.</span>
<a name="l11929"></a>11929 <span class="comment"></span>
<a name="l11930"></a>11930 <span class="comment">**********************************************************************************************/</span>
<a name="l11931"></a><a class="code" href="vobject__blitters_8h.html#e76f482e95adb71c4df9a6ee52f81ac2">11931</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#e76f482e95adb71c4df9a6ee52f81ac2">Blt8BPPDataTo16BPPBuffer</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="structSGPVSurface.html">HVSURFACE</a> hSrcVSurface, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *pSrcBuffer, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY)
<a name="l11932"></a>11932 {
<a name="l11933"></a>11933       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l11934"></a>11934 <span class="comment">//    UINT32 uiOffset;</span>
<a name="l11935"></a>11935       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth;
<a name="l11936"></a>11936       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr;
<a name="l11937"></a>11937       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l11938"></a>11938 <span class="comment">//    ETRLEObject *pTrav;</span>
<a name="l11939"></a>11939       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l11940"></a>11940       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> rows;
<a name="l11941"></a>11941 
<a name="l11942"></a>11942       <span class="comment">// Assertions</span>
<a name="l11943"></a>11943       Assert( hSrcVSurface != NULL );
<a name="l11944"></a>11944       Assert( pSrcBuffer != NULL );
<a name="l11945"></a>11945       Assert( pBuffer != NULL );
<a name="l11946"></a>11946 
<a name="l11947"></a>11947       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l11948"></a>11948       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)hSrcVSurface-&gt;<a class="code" href="structSGPVSurface.html#fc10a1ce49a8cefdb4e510d8b910eb0c">usHeight</a>;
<a name="l11949"></a>11949       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)hSrcVSurface-&gt;<a class="code" href="structSGPVSurface.html#95c7973670e82832e7047103d8b3d32a">usWidth</a>;
<a name="l11950"></a>11950 
<a name="l11951"></a>11951       <span class="comment">// Add to start position of dest buffer</span>
<a name="l11952"></a>11952       iTempX = iX;
<a name="l11953"></a>11953       iTempY = iY;
<a name="l11954"></a>11954 
<a name="l11955"></a>11955       <span class="comment">// Validations</span>
<a name="l11956"></a>11956       CHECKF( iTempX &gt;= 0 );
<a name="l11957"></a>11957       CHECKF( iTempY &gt;= 0 );
<a name="l11958"></a>11958 
<a name="l11959"></a>11959 
<a name="l11960"></a>11960       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pSrcBuffer;
<a name="l11961"></a>11961       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l11962"></a>11962       p16BPPPalette = hSrcVSurface-&gt;<a class="code" href="structSGPVSurface.html#040b0e74b7c77c352bc7274c20c27cd2">p16BPPPalette</a>;
<a name="l11963"></a>11963       LineSkip=(uiDestPitchBYTES-(usWidth*2));
<a name="l11964"></a>11964 
<a name="l11965"></a>11965       __asm {
<a name="l11966"></a>11966 
<a name="l11967"></a>11967             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr                         <span class="comment">// pointer to current line start address in source</span>
<a name="l11968"></a>11968             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr                        <span class="comment">// pointer to current line start address in destination</span>
<a name="l11969"></a>11969             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, usHeight                       <span class="comment">// line counter (goes top to bottom)</span>
<a name="l11970"></a>11970             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         rows, ecx
<a name="l11971"></a>11971             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, p16BPPPalette
<a name="l11972"></a>11972 
<a name="l11973"></a>11973             sub         eax, eax
<a name="l11974"></a>11974             sub         ecx, ecx
<a name="l11975"></a>11975 
<a name="l11976"></a>11976             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, usWidth                        <span class="comment">// column counter (goes right to left)</span>
<a name="l11977"></a>11977             dec         ebx
<a name="l11978"></a>11978 
<a name="l11979"></a>11979 ReadMask:
<a name="l11980"></a>11980             <a class="code" href="structtest.html">test</a>  usWidth, 1
<a name="l11981"></a>11981             jz          BlitWord
<a name="l11982"></a>11982 
<a name="l11983"></a>11983             xor         eax, eax                                  <span class="comment">// clear out the top 24 bits</span>
<a name="l11984"></a>11984             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi+ebx]
<a name="l11985"></a>11985 
<a name="l11986"></a>11986             shl         eax, 1                                          <span class="comment">// make it into a word index</span>
<a name="l11987"></a>11987             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [edx+eax]                       <span class="comment">// get 16-bit version of 8-bit pixel</span>
<a name="l11988"></a>11988             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi+ebx*2], ax               <span class="comment">// store it in destination buffer</span>
<a name="l11989"></a>11989 
<a name="l11990"></a>11990             dec         ebx
<a name="l11991"></a>11991             js          DoneRow
<a name="l11992"></a>11992 
<a name="l11993"></a>11993 BlitWord:
<a name="l11994"></a>11994 
<a name="l11995"></a>11995             <a class="code" href="structtest.html">test</a>  usWidth, 2
<a name="l11996"></a>11996             jz          SetupDwords
<a name="l11997"></a>11997 
<a name="l11998"></a>11998 
<a name="l11999"></a>11999             mov         ax, [esi+ebx-1]
<a name="l12000"></a>12000             mov         cl, ah
<a name="l12001"></a>12001             sub         ah, ah
<a name="l12002"></a>12002             and         ecx, 0ffH
<a name="l12003"></a>12003             shl         eax, 1
<a name="l12004"></a>12004             shl         ecx, 1
<a name="l12005"></a>12005             mov         ax, [edx+eax]
<a name="l12006"></a>12006             mov         cx, [edx+ecx]
<a name="l12007"></a>12007             shl         ecx, 16
<a name="l12008"></a>12008             mov         cx, ax
<a name="l12009"></a>12009             mov         [edi+ebx*2-2], ecx
<a name="l12010"></a>12010 
<a name="l12011"></a>12011             sub         ebx, 2
<a name="l12012"></a>12012             js          DoneRow
<a name="l12013"></a>12013 
<a name="l12014"></a>12014 SetupDwords:
<a name="l12015"></a>12015 
<a name="l12016"></a>12016 
<a name="l12017"></a>12017 BlitDwords:
<a name="l12018"></a>12018 
<a name="l12019"></a>12019             mov         ax, [esi+ebx-1]
<a name="l12020"></a>12020             mov         cl, ah
<a name="l12021"></a>12021             sub         ah, ah
<a name="l12022"></a>12022             and         ecx, 0ffH
<a name="l12023"></a>12023             shl         eax, 1
<a name="l12024"></a>12024             shl         ecx, 1
<a name="l12025"></a>12025             mov         ax, [edx+eax]
<a name="l12026"></a>12026             mov         cx, [edx+ecx]
<a name="l12027"></a>12027             shl         ecx, 16
<a name="l12028"></a>12028             mov         cx, ax
<a name="l12029"></a>12029             mov         [edi+ebx*2-2], ecx
<a name="l12030"></a>12030 
<a name="l12031"></a>12031             mov         ax, [esi+ebx-3]
<a name="l12032"></a>12032             mov         cl, ah
<a name="l12033"></a>12033             sub         ah, ah
<a name="l12034"></a>12034             and         ecx, 0ffH
<a name="l12035"></a>12035             shl         eax, 1
<a name="l12036"></a>12036             shl         ecx, 1
<a name="l12037"></a>12037             mov         ax, [edx+eax]
<a name="l12038"></a>12038             mov         cx, [edx+ecx]
<a name="l12039"></a>12039             shl         ecx, 16
<a name="l12040"></a>12040             mov         cx, ax
<a name="l12041"></a>12041             mov         [edi+ebx*2-6], ecx
<a name="l12042"></a>12042 
<a name="l12043"></a>12043             sub         ebx, 4                                          <span class="comment">// decrement column counter</span>
<a name="l12044"></a>12044             jns         BlitDwords                          <span class="comment">// loop until one line is done</span>
<a name="l12045"></a>12045 
<a name="l12046"></a>12046 DoneRow:
<a name="l12047"></a>12047             dec         rows                                                  <span class="comment">// check line counter</span>
<a name="l12048"></a>12048             jz          DoneBlit                                  <span class="comment">// done blitting, exit</span>
<a name="l12049"></a>12049 
<a name="l12050"></a>12050             add         esi, usWidth                  <span class="comment">// move line pointers down one line</span>
<a name="l12051"></a>12051             add         edi, uiDestPitchBYTES
<a name="l12052"></a>12052             mov         ebx, usWidth                  <span class="comment">// column counter (goes right to left)</span>
<a name="l12053"></a>12053             dec         ebx
<a name="l12054"></a>12054             jmp         ReadMask
<a name="l12055"></a>12055 
<a name="l12056"></a>12056 DoneBlit:                                                               <span class="comment">// finished blit</span>
<a name="l12057"></a>12057       }
<a name="l12058"></a>12058 
<a name="l12059"></a>12059       <span class="keywordflow">return</span>( TRUE );
<a name="l12060"></a>12060 
<a name="l12061"></a>12061 }
<a name="l12062"></a>12062 
<a name="l12063"></a>12063 
<a name="l12064"></a>12064 <span class="comment">/**********************************************************************************************</span>
<a name="l12065"></a>12065 <span class="comment"> Blt8BPPDataTo16BPPBufferHalf</span>
<a name="l12066"></a>12066 <span class="comment"></span>
<a name="l12067"></a>12067 <span class="comment">      Blits from a flat surface to a 16-bit buffer, dividing the source image into</span>
<a name="l12068"></a>12068 <span class="comment">exactly half the size.</span>
<a name="l12069"></a>12069 <span class="comment"></span>
<a name="l12070"></a>12070 <span class="comment">**********************************************************************************************/</span>
<a name="l12071"></a><a class="code" href="vobject__blitters_8h.html#238dbc533f272e61fe01fa327cb52d02">12071</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#238dbc533f272e61fe01fa327cb52d02">Blt8BPPDataTo16BPPBufferHalf</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="structSGPVSurface.html">HVSURFACE</a> hSrcVSurface, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *pSrcBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiSrcPitch, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY)
<a name="l12072"></a>12072 {
<a name="l12073"></a>12073       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l12074"></a>12074       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth;
<a name="l12075"></a>12075       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr;
<a name="l12076"></a>12076       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l12077"></a>12077       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l12078"></a>12078       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiSrcSkip;
<a name="l12079"></a>12079 
<a name="l12080"></a>12080       <span class="comment">// Assertions</span>
<a name="l12081"></a>12081       Assert( hSrcVSurface != NULL );
<a name="l12082"></a>12082       Assert( pSrcBuffer != NULL );
<a name="l12083"></a>12083       Assert( pBuffer != NULL );
<a name="l12084"></a>12084 
<a name="l12085"></a>12085       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l12086"></a>12086       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)hSrcVSurface-&gt;<a class="code" href="structSGPVSurface.html#fc10a1ce49a8cefdb4e510d8b910eb0c">usHeight</a>;
<a name="l12087"></a>12087       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)hSrcVSurface-&gt;<a class="code" href="structSGPVSurface.html#95c7973670e82832e7047103d8b3d32a">usWidth</a>;
<a name="l12088"></a>12088 
<a name="l12089"></a>12089       <span class="comment">// Add to start position of dest buffer</span>
<a name="l12090"></a>12090       iTempX = iX;
<a name="l12091"></a>12091       iTempY = iY;
<a name="l12092"></a>12092 
<a name="l12093"></a>12093       <span class="comment">// Validations</span>
<a name="l12094"></a>12094       CHECKF( iTempX &gt;= 0 );
<a name="l12095"></a>12095       CHECKF( iTempY &gt;= 0 );
<a name="l12096"></a>12096 
<a name="l12097"></a>12097       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pSrcBuffer;
<a name="l12098"></a>12098       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l12099"></a>12099       p16BPPPalette = hSrcVSurface-&gt;<a class="code" href="structSGPVSurface.html#040b0e74b7c77c352bc7274c20c27cd2">p16BPPPalette</a>;
<a name="l12100"></a>12100       LineSkip=(uiDestPitchBYTES-(usWidth&amp;0xfffffffe));
<a name="l12101"></a>12101       uiSrcSkip=(uiSrcPitch*2)-(usWidth&amp;0xfffffffe);
<a name="l12102"></a>12102 
<a name="l12103"></a>12103       __asm {
<a name="l12104"></a>12104 
<a name="l12105"></a>12105             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr                         <span class="comment">// pointer to current line start address in source</span>
<a name="l12106"></a>12106             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr                        <span class="comment">// pointer to current line start address in destination</span>
<a name="l12107"></a>12107             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, usHeight                       <span class="comment">// line counter (goes top to bottom)</span>
<a name="l12108"></a>12108             shr         ebx, 1                                          <span class="comment">// half the rows</span>
<a name="l12109"></a>12109             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, p16BPPPalette
<a name="l12110"></a>12110 
<a name="l12111"></a>12111             xor         eax, eax
<a name="l12112"></a>12112 
<a name="l12113"></a>12113 BlitSetup:
<a name="l12114"></a>12114             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, usWidth
<a name="l12115"></a>12115             shr         ecx, 1                                          <span class="comment">// divide the width by 2</span>
<a name="l12116"></a>12116 
<a name="l12117"></a>12117 ReadMask:
<a name="l12118"></a>12118             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l12119"></a>12119             xor         ah, ah
<a name="l12120"></a>12120             inc         esi                                                   <span class="comment">// skip one source byte</span>
<a name="l12121"></a>12121             inc         esi
<a name="l12122"></a>12122 
<a name="l12123"></a>12123             shl         eax, 1                                          <span class="comment">// make it into a word index</span>
<a name="l12124"></a>12124             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [edx+eax]                       <span class="comment">// get 16-bit version of 8-bit pixel</span>
<a name="l12125"></a>12125             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax                                 <span class="comment">// store it in destination buffer</span>
<a name="l12126"></a>12126             inc         edi                                                   <span class="comment">// next pixel</span>
<a name="l12127"></a>12127             inc         edi
<a name="l12128"></a>12128 
<a name="l12129"></a>12129             dec         ecx
<a name="l12130"></a>12130             jnz         ReadMask
<a name="l12131"></a>12131 
<a name="l12132"></a>12132 
<a name="l12133"></a>12133 <span class="comment">//DoneRow:</span>
<a name="l12134"></a>12134 
<a name="l12135"></a>12135             add         esi, uiSrcSkip                <span class="comment">// move source pointer down one line</span>
<a name="l12136"></a>12136             add         edi, LineSkip
<a name="l12137"></a>12137 
<a name="l12138"></a>12138             dec         ebx                                                   <span class="comment">// check line counter</span>
<a name="l12139"></a>12139             jnz         BlitSetup                                 <span class="comment">// done blitting, exit</span>
<a name="l12140"></a>12140 
<a name="l12141"></a>12141 <span class="comment">//DoneBlit:                                                             // finished blit</span>
<a name="l12142"></a>12142       }
<a name="l12143"></a>12143 
<a name="l12144"></a>12144       <span class="keywordflow">return</span>( TRUE );
<a name="l12145"></a>12145 
<a name="l12146"></a>12146 }
<a name="l12147"></a>12147 
<a name="l12148"></a>12148 
<a name="l12149"></a>12149 <span class="comment">/**********************************************************************************************</span>
<a name="l12150"></a>12150 <span class="comment"> Blt8BPPDataTo16BPPBufferHalfRect</span>
<a name="l12151"></a>12151 <span class="comment"></span>
<a name="l12152"></a>12152 <span class="comment">      Blits from a flat surface to a 16-bit buffer, dividing the source image into</span>
<a name="l12153"></a>12153 <span class="comment">exactly half the size, from a sub-region.</span>
<a name="l12154"></a>12154 <span class="comment">      - Source rect is in source units.</span>
<a name="l12155"></a>12155 <span class="comment">      - In order to make sure the same pixels are skipped, always align the top and</span>
<a name="l12156"></a>12156 <span class="comment">            left coordinates to the same factor of two.</span>
<a name="l12157"></a>12157 <span class="comment">      - A rect specifying an odd number of pixels will divide out to an even</span>
<a name="l12158"></a>12158 <span class="comment">            number of pixels blitted to the destination.</span>
<a name="l12159"></a>12159 <span class="comment"></span>
<a name="l12160"></a>12160 <span class="comment">**********************************************************************************************/</span>
<a name="l12161"></a><a class="code" href="vobject__blitters_8h.html#917e965bc57e33f04c2b52e8a391b1b9">12161</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#917e965bc57e33f04c2b52e8a391b1b9">Blt8BPPDataTo16BPPBufferHalfRect</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="structSGPVSurface.html">HVSURFACE</a> hSrcVSurface, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *pSrcBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiSrcPitch, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="structSGPRect.html">SGPRect</a> *pRect)
<a name="l12162"></a>12162 {
<a name="l12163"></a>12163       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l12164"></a>12164       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth;
<a name="l12165"></a>12165       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr;
<a name="l12166"></a>12166       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l12167"></a>12167       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l12168"></a>12168       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiSrcSkip;
<a name="l12169"></a>12169 
<a name="l12170"></a>12170       <span class="comment">// Assertions</span>
<a name="l12171"></a>12171       Assert( hSrcVSurface != NULL );
<a name="l12172"></a>12172       Assert( pSrcBuffer != NULL );
<a name="l12173"></a>12173       Assert( pBuffer != NULL );
<a name="l12174"></a>12174       Assert( pRect != NULL );
<a name="l12175"></a>12175 
<a name="l12176"></a>12176       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l12177"></a>12177       usWidth           = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)(pRect-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>-pRect-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>);
<a name="l12178"></a>12178       usHeight    = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)(pRect-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>-pRect-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>);
<a name="l12179"></a>12179 
<a name="l12180"></a>12180       <span class="comment">// Add to start position of dest buffer</span>
<a name="l12181"></a>12181       iTempX = iX;
<a name="l12182"></a>12182       iTempY = iY;
<a name="l12183"></a>12183 
<a name="l12184"></a>12184       <span class="comment">// Validations</span>
<a name="l12185"></a>12185       CHECKF( iTempX   &gt;= 0 );
<a name="l12186"></a>12186       CHECKF( iTempY   &gt;= 0 );
<a name="l12187"></a>12187       CHECKF(     usWidth  &gt;  0 );
<a name="l12188"></a>12188       CHECKF(     usHeight &gt;  0 );
<a name="l12189"></a>12189       CHECKF( usHeight &lt;= hSrcVSurface-&gt;usHeight);
<a name="l12190"></a>12190       CHECKF( usWidth &lt;= hSrcVSurface-&gt;usWidth);
<a name="l12191"></a>12191 
<a name="l12192"></a>12192       SrcPtr                        = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pSrcBuffer + (uiSrcPitch*pRect-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>) + (pRect-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>);
<a name="l12193"></a>12193       DestPtr                       = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l12194"></a>12194       p16BPPPalette = hSrcVSurface-&gt;<a class="code" href="structSGPVSurface.html#040b0e74b7c77c352bc7274c20c27cd2">p16BPPPalette</a>;
<a name="l12195"></a>12195       LineSkip                = (uiDestPitchBYTES-(usWidth&amp;0xfffffffe));
<a name="l12196"></a>12196       uiSrcSkip               = (uiSrcPitch*2)-(usWidth&amp;0xfffffffe);
<a name="l12197"></a>12197 
<a name="l12198"></a>12198       __asm {
<a name="l12199"></a>12199 
<a name="l12200"></a>12200             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr                         <span class="comment">// pointer to current line start address in source</span>
<a name="l12201"></a>12201             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr                        <span class="comment">// pointer to current line start address in destination</span>
<a name="l12202"></a>12202             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, usHeight                       <span class="comment">// line counter (goes top to bottom)</span>
<a name="l12203"></a>12203             shr         ebx, 1                                          <span class="comment">// half the rows</span>
<a name="l12204"></a>12204             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, p16BPPPalette
<a name="l12205"></a>12205 
<a name="l12206"></a>12206             xor         eax, eax
<a name="l12207"></a>12207 
<a name="l12208"></a>12208 BlitSetup:
<a name="l12209"></a>12209             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, usWidth
<a name="l12210"></a>12210             shr         ecx, 1                                          <span class="comment">// divide the width by 2</span>
<a name="l12211"></a>12211 
<a name="l12212"></a>12212 ReadMask:
<a name="l12213"></a>12213             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l12214"></a>12214             xor         ah, ah
<a name="l12215"></a>12215             inc         esi                                                   <span class="comment">// skip one source byte</span>
<a name="l12216"></a>12216             inc         esi
<a name="l12217"></a>12217 
<a name="l12218"></a>12218             shl         eax, 1                                          <span class="comment">// make it into a word index</span>
<a name="l12219"></a>12219             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [edx+eax]                       <span class="comment">// get 16-bit version of 8-bit pixel</span>
<a name="l12220"></a>12220             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax                                 <span class="comment">// store it in destination buffer</span>
<a name="l12221"></a>12221             inc         edi                                                   <span class="comment">// next pixel</span>
<a name="l12222"></a>12222             inc         edi
<a name="l12223"></a>12223 
<a name="l12224"></a>12224             dec         ecx
<a name="l12225"></a>12225             jnz         ReadMask
<a name="l12226"></a>12226 
<a name="l12227"></a>12227 
<a name="l12228"></a>12228 <span class="comment">//DoneRow:</span>
<a name="l12229"></a>12229 
<a name="l12230"></a>12230             add         esi, uiSrcSkip                <span class="comment">// move source pointer down one line</span>
<a name="l12231"></a>12231             add         edi, LineSkip
<a name="l12232"></a>12232 
<a name="l12233"></a>12233             dec         ebx                                                   <span class="comment">// check line counter</span>
<a name="l12234"></a>12234             jnz         BlitSetup                                 <span class="comment">// done blitting, exit</span>
<a name="l12235"></a>12235 
<a name="l12236"></a>12236 <span class="comment">//DoneBlit:                                                             // finished blit</span>
<a name="l12237"></a>12237       }
<a name="l12238"></a>12238 
<a name="l12239"></a>12239       <span class="keywordflow">return</span>( TRUE );
<a name="l12240"></a>12240 
<a name="l12241"></a>12241 }
<a name="l12242"></a>12242 
<a name="l12243"></a>12243 <span class="comment">/****************************INCOMPLETE***********************************************/</span>
<a name="l12244"></a>12244 
<a name="l12245"></a>12245 <span class="comment">/**********************************************************************************************</span>
<a name="l12246"></a>12246 <span class="comment"> Blt8BPPDataTo16BPPBufferMask</span>
<a name="l12247"></a>12247 <span class="comment"></span>
<a name="l12248"></a>12248 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, another ETRLE</span>
<a name="l12249"></a>12249 <span class="comment">      for a mask, and a 16-bit buffer as a destination.</span>
<a name="l12250"></a>12250 <span class="comment"></span>
<a name="l12251"></a>12251 <span class="comment">**********************************************************************************************/</span>
<a name="l12252"></a><a class="code" href="vobject__blitters_8cpp.html#ab00316917216c122400bd896754025c">12252</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#ab00316917216c122400bd896754025c">Blt8BPPDataTo16BPPBufferMask</a>(<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hMaskObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iMOX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iMOY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usMask)
<a name="l12253"></a>12253 {
<a name="l12254"></a>12254       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l12255"></a>12255       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l12256"></a>12256       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiMOffset;
<a name="l12257"></a>12257       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth;
<a name="l12258"></a>12258       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usMHeight, usMWidth;
<a name="l12259"></a>12259       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *MaskPtr;
<a name="l12260"></a>12260       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l12261"></a>12261   <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l12262"></a>12262       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l12263"></a>12263 
<a name="l12264"></a>12264       <span class="comment">// Assertions</span>
<a name="l12265"></a>12265       Assert( hSrcVObject != NULL );
<a name="l12266"></a>12266       Assert( pBuffer != NULL );
<a name="l12267"></a>12267 
<a name="l12268"></a>12268       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l12269"></a>12269       pTrav                               = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[usIndex]);
<a name="l12270"></a>12270       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l12271"></a>12271       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l12272"></a>12272       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l12273"></a>12273 
<a name="l12274"></a>12274       <span class="comment">// Get Offsets from Index into structure for mask</span>
<a name="l12275"></a>12275       pTrav                               =     &amp;(hMaskObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[usMask]);
<a name="l12276"></a>12276       usMHeight                     = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l12277"></a>12277       usMWidth                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l12278"></a>12278       uiMOffset                     = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l12279"></a>12279 
<a name="l12280"></a>12280       <span class="comment">// Add to start position of dest buffer</span>
<a name="l12281"></a>12281       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l12282"></a>12282       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l12283"></a>12283 
<a name="l12284"></a>12284       <span class="comment">// Validations</span>
<a name="l12285"></a>12285       CHECKF( iTempX &gt;= 0 );
<a name="l12286"></a>12286       CHECKF( iTempY &gt;= 0 );
<a name="l12287"></a>12287 
<a name="l12288"></a>12288 
<a name="l12289"></a>12289       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l12290"></a>12290       MaskPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hMaskObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiMOffset + (iMOY*usMWidth) + iMOX;
<a name="l12291"></a>12291       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l12292"></a>12292       p16BPPPalette = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#930609ad8d5cdbb05449df70bd83cfcd">pShadeCurrent</a>;
<a name="l12293"></a>12293       LineSkip=(uiDestPitchBYTES-(usWidth*2));
<a name="l12294"></a>12294 
<a name="l12295"></a>12295       __asm {
<a name="l12296"></a>12296 
<a name="l12297"></a>12297             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l12298"></a>12298             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l12299"></a>12299             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, p16BPPPalette
<a name="l12300"></a>12300             xor         eax, eax
<a name="l12301"></a>12301             xor         ebx, ebx
<a name="l12302"></a>12302             xor         ecx, ecx
<a name="l12303"></a>12303 
<a name="l12304"></a>12304 BlitDispatch:
<a name="l12305"></a>12305 
<a name="l12306"></a>12306             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l12307"></a>12307             inc         esi
<a name="l12308"></a>12308             or          cl, cl
<a name="l12309"></a>12309             js          BlitTransparent
<a name="l12310"></a>12310             jz          BlitDoneLine
<a name="l12311"></a>12311 
<a name="l12312"></a>12312 <span class="comment">//BlitNonTransLoop:</span>
<a name="l12313"></a>12313 
<a name="l12314"></a>12314             clc
<a name="l12315"></a>12315             rcr         cl, 1
<a name="l12316"></a>12316             jnc         BlitNTL2
<a name="l12317"></a>12317 
<a name="l12318"></a>12318             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         bl, [esi]
<a name="l12319"></a>12319             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [edx+ebx*2]
<a name="l12320"></a>12320             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax
<a name="l12321"></a>12321 
<a name="l12322"></a>12322             inc         esi
<a name="l12323"></a>12323             add         edi, 2
<a name="l12324"></a>12324 
<a name="l12325"></a>12325 BlitNTL2:
<a name="l12326"></a>12326             clc
<a name="l12327"></a>12327             rcr         cl, 1
<a name="l12328"></a>12328             jnc         BlitNTL3
<a name="l12329"></a>12329 
<a name="l12330"></a>12330             mov         bl, [esi]
<a name="l12331"></a>12331             mov         ax, [edx+ebx*2]
<a name="l12332"></a>12332             mov         [edi], ax
<a name="l12333"></a>12333 
<a name="l12334"></a>12334             mov         bl, [esi+1]
<a name="l12335"></a>12335             mov         ax, [edx+ebx*2]
<a name="l12336"></a>12336             mov         [edi+2], ax
<a name="l12337"></a>12337 
<a name="l12338"></a>12338             add         esi, 2
<a name="l12339"></a>12339             add         edi, 4
<a name="l12340"></a>12340 
<a name="l12341"></a>12341 BlitNTL3:
<a name="l12342"></a>12342 
<a name="l12343"></a>12343             or          cl, cl
<a name="l12344"></a>12344             jz          BlitDispatch
<a name="l12345"></a>12345 
<a name="l12346"></a>12346             xor         ebx, ebx
<a name="l12347"></a>12347 
<a name="l12348"></a>12348 BlitNTL4:
<a name="l12349"></a>12349 
<a name="l12350"></a>12350             mov         bl, [esi]
<a name="l12351"></a>12351             mov         ax, [edx+ebx*2]
<a name="l12352"></a>12352             mov         [edi], ax
<a name="l12353"></a>12353 
<a name="l12354"></a>12354             mov         bl, [esi+1]
<a name="l12355"></a>12355             mov         ax, [edx+ebx*2]
<a name="l12356"></a>12356             mov         [edi+2], ax
<a name="l12357"></a>12357 
<a name="l12358"></a>12358             mov         bl, [esi+2]
<a name="l12359"></a>12359             mov         ax, [edx+ebx*2]
<a name="l12360"></a>12360             mov         [edi+4], ax
<a name="l12361"></a>12361 
<a name="l12362"></a>12362             mov         bl, [esi+3]
<a name="l12363"></a>12363             mov         ax, [edx+ebx*2]
<a name="l12364"></a>12364             mov         [edi+6], ax
<a name="l12365"></a>12365 
<a name="l12366"></a>12366             add         esi, 4
<a name="l12367"></a>12367             add         edi, 8
<a name="l12368"></a>12368             dec         cl
<a name="l12369"></a>12369             jnz         BlitNTL4
<a name="l12370"></a>12370 
<a name="l12371"></a>12371             jmp         BlitDispatch
<a name="l12372"></a>12372 
<a name="l12373"></a>12373 BlitTransparent:
<a name="l12374"></a>12374 
<a name="l12375"></a>12375             and         ecx, 07fH
<a name="l12376"></a>12376 <span class="comment">//          shl         ecx, 1</span>
<a name="l12377"></a>12377             add   ecx, ecx
<a name="l12378"></a>12378             add         edi, ecx
<a name="l12379"></a>12379             jmp         BlitDispatch
<a name="l12380"></a>12380 
<a name="l12381"></a>12381 
<a name="l12382"></a>12382 BlitDoneLine:
<a name="l12383"></a>12383 
<a name="l12384"></a>12384             dec         usHeight
<a name="l12385"></a>12385             jz          BlitDone
<a name="l12386"></a>12386             add         edi, LineSkip
<a name="l12387"></a>12387             jmp         BlitDispatch
<a name="l12388"></a>12388 
<a name="l12389"></a>12389 
<a name="l12390"></a>12390 BlitDone:
<a name="l12391"></a>12391       }
<a name="l12392"></a>12392 
<a name="l12393"></a>12393       <span class="keywordflow">return</span>(TRUE);
<a name="l12394"></a>12394 
<a name="l12395"></a>12395 }
<a name="l12396"></a>12396 
<a name="l12397"></a><a class="code" href="vsurface_8cpp.html#b681c32def934fca6df29dabc0d47947">12397</a> <span class="keywordtype">void</span> <a class="code" href="selectwin_8cpp.html#b681c32def934fca6df29dabc0d47947">SetClippingRect</a>(<a class="code" href="structSGPRect.html">SGPRect</a> *clip)
<a name="l12398"></a>12398 {
<a name="l12399"></a>12399       Assert(clip!=NULL);
<a name="l12400"></a>12400       Assert(clip-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a> &lt; clip-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>);
<a name="l12401"></a>12401       Assert(clip-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a> &lt; clip-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>);
<a name="l12402"></a>12402 
<a name="l12403"></a>12403       memcpy(&amp;<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>, clip, <span class="keyword">sizeof</span>(<a class="code" href="structSGPRect.html">SGPRect</a>));
<a name="l12404"></a>12404 
<a name="l12405"></a>12405 }
<a name="l12406"></a>12406 
<a name="l12407"></a><a class="code" href="vsurface_8cpp.html#ad07150fd372197642aef4308c8dc29d">12407</a> <span class="keywordtype">void</span> <a class="code" href="selectwin_8cpp.html#ad07150fd372197642aef4308c8dc29d">GetClippingRect</a>(<a class="code" href="structSGPRect.html">SGPRect</a> *clip)
<a name="l12408"></a>12408 {
<a name="l12409"></a>12409       Assert(clip!=NULL);
<a name="l12410"></a>12410 
<a name="l12411"></a>12411       memcpy(clip, &amp;<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>, <span class="keyword">sizeof</span>(<a class="code" href="structSGPRect.html">SGPRect</a>));
<a name="l12412"></a>12412 }
<a name="l12413"></a>12413 
<a name="l12414"></a>12414 <span class="comment">/**********************************************************************************************</span>
<a name="l12415"></a>12415 <span class="comment">      Blt16BPPBufferPixelateRectWithColor</span>
<a name="l12416"></a>12416 <span class="comment"></span>
<a name="l12417"></a>12417 <span class="comment">            Given an 8x8 pattern and a color, pixelates an area by repeatedly "applying the color" to pixels whereever there</span>
<a name="l12418"></a>12418 <span class="comment">            is a non-zero value in the pattern.  </span>
<a name="l12419"></a>12419 <span class="comment"></span>
<a name="l12420"></a>12420 <span class="comment">            KM:  Added Nov. 23, 1998</span>
<a name="l12421"></a>12421 <span class="comment">            This is all the code that I moved from Blt16BPPBufferPixelateRect().  </span>
<a name="l12422"></a>12422 <span class="comment">            This function now takes a color field (which previously was</span>
<a name="l12423"></a>12423 <span class="comment">            always black.  The 3rd assembler line in this function:</span>
<a name="l12424"></a>12424 <span class="comment"></span>
<a name="l12425"></a>12425 <span class="comment">                        mov         ax, usColor                   // color of pixel</span>
<a name="l12426"></a>12426 <span class="comment">            </span>
<a name="l12427"></a>12427 <span class="comment">            used to be:</span>
<a name="l12428"></a>12428 <span class="comment"></span>
<a name="l12429"></a>12429 <span class="comment">                        xor   eax, eax                            // color of pixel (black or 0)</span>
<a name="l12430"></a>12430 <span class="comment"></span>
<a name="l12431"></a>12431 <span class="comment">        This was the only internal modification I made other than adding the usColor argument.</span>
<a name="l12432"></a>12432 <span class="comment"></span>
<a name="l12433"></a>12433 <span class="comment">*********************************************************************************************/</span>
<a name="l12434"></a><a class="code" href="vobject__blitters_8h.html#82c2966a3fed0aff1265c3233bc7de66">12434</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#82c2966a3fed0aff1265c3233bc7de66">Blt16BPPBufferPixelateRectWithColor</a>(<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="structSGPRect.html">SGPRect</a> *area, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> Pattern[8][8], <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usColor )
<a name="l12435"></a>12435 {
<a name="l12436"></a>12436       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  width, height;
<a name="l12437"></a>12437       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l12438"></a>12438       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *DestPtr;
<a name="l12439"></a>12439       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iLeft, iTop, iRight, iBottom;
<a name="l12440"></a>12440 
<a name="l12441"></a>12441       <span class="comment">// Assertions</span>
<a name="l12442"></a>12442       Assert( pBuffer != NULL );
<a name="l12443"></a>12443       Assert( Pattern != NULL );
<a name="l12444"></a>12444 
<a name="l12445"></a>12445       iLeft=__max(<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>, area-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>);
<a name="l12446"></a>12446       iTop=__max(<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>, area-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>);
<a name="l12447"></a>12447       iRight=__min(<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>-1, area-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>);
<a name="l12448"></a>12448       iBottom=__min(<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>-1, area-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>);
<a name="l12449"></a>12449 
<a name="l12450"></a>12450       DestPtr=(pBuffer+(iTop*(uiDestPitchBYTES/2))+iLeft);
<a name="l12451"></a>12451       width=iRight-iLeft+1;
<a name="l12452"></a>12452       height=iBottom-iTop+1;
<a name="l12453"></a>12453       LineSkip=(uiDestPitchBYTES-(width*2));
<a name="l12454"></a>12454 
<a name="l12455"></a>12455       CHECKF(width &gt;=1);
<a name="l12456"></a>12456       CHECKF(height &gt;=1);
<a name="l12457"></a>12457 
<a name="l12458"></a>12458       __asm {
<a name="l12459"></a>12459             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, Pattern                        <span class="comment">// Pointer to pixel pattern</span>
<a name="l12460"></a>12460             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr                        <span class="comment">// Pointer to top left of rect area</span>
<a name="l12461"></a>12461             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, usColor                   <span class="comment">// color of pixel</span>
<a name="l12462"></a>12462             xor         ebx, ebx                                  <span class="comment">// pattern column index</span>
<a name="l12463"></a>12463             xor         edx, edx                                  <span class="comment">// pattern row index</span>
<a name="l12464"></a>12464 
<a name="l12465"></a>12465 
<a name="l12466"></a>12466 BlitNewLine:
<a name="l12467"></a>12467             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, width
<a name="l12468"></a>12468 
<a name="l12469"></a>12469 BlitLine:
<a name="l12470"></a>12470             cmp   [esi+ebx], 0
<a name="l12471"></a>12471             je    BlitLine2
<a name="l12472"></a>12472 
<a name="l12473"></a>12473             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax
<a name="l12474"></a>12474 
<a name="l12475"></a>12475 BlitLine2:
<a name="l12476"></a>12476             add         edi, 2
<a name="l12477"></a>12477             inc         ebx
<a name="l12478"></a>12478             and         ebx, 07H
<a name="l12479"></a>12479             or          ebx, edx
<a name="l12480"></a>12480             dec         ecx
<a name="l12481"></a>12481             jnz         BlitLine
<a name="l12482"></a>12482 
<a name="l12483"></a>12483             add         edi, LineSkip
<a name="l12484"></a>12484             xor         ebx, ebx
<a name="l12485"></a>12485             add         edx, 08H
<a name="l12486"></a>12486             and         edx, 38H
<a name="l12487"></a>12487             dec         height
<a name="l12488"></a>12488             jnz         BlitNewLine
<a name="l12489"></a>12489       }
<a name="l12490"></a>12490 
<a name="l12491"></a>12491       <span class="keywordflow">return</span>(TRUE);
<a name="l12492"></a>12492 }
<a name="l12493"></a>12493 
<a name="l12494"></a>12494 <span class="comment">//KM:  Modified Nov. 23, 1998</span>
<a name="l12495"></a>12495 <span class="comment">//Original prototype (this function) didn't have a color field.  I've added the color field to </span>
<a name="l12496"></a>12496 <span class="comment">//Blt16BPPBufferPixelateRectWithColor(), moved the previous implementation of this function there, and added</span>
<a name="l12497"></a>12497 <span class="comment">//the modification to allow a specific color.</span>
<a name="l12498"></a><a class="code" href="vobject__blitters_8h.html#d2a50272a982f08bc2c465aac5d7c089">12498</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#d2a50272a982f08bc2c465aac5d7c089">Blt16BPPBufferPixelateRect</a>(<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="structSGPRect.html">SGPRect</a> *area, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> Pattern[8][8] )
<a name="l12499"></a>12499 { 
<a name="l12500"></a>12500       <span class="keywordflow">return</span> <a class="code" href="vobject__blitters_8cpp.html#82c2966a3fed0aff1265c3233bc7de66">Blt16BPPBufferPixelateRectWithColor</a>( pBuffer, uiDestPitchBYTES, area, Pattern, 0 );
<a name="l12501"></a>12501 }
<a name="l12502"></a>12502 
<a name="l12503"></a>12503 <span class="comment">/**********************************************************************************************</span>
<a name="l12504"></a>12504 <span class="comment">      Blt16BPPBufferHatchRect</span>
<a name="l12505"></a>12505 <span class="comment"></span>
<a name="l12506"></a>12506 <span class="comment">            A wrapper for Blt16BPPBufferPixelateRect(), it automatically sends a hatch pattern to it</span>
<a name="l12507"></a>12507 <span class="comment">            of the specified color</span>
<a name="l12508"></a>12508 <span class="comment"></span>
<a name="l12509"></a>12509 <span class="comment">*********************************************************************************************/</span>
<a name="l12510"></a><a class="code" href="vobject__blitters_8h.html#cc7cfdf8c40c0800395b9f9787f366a0">12510</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#cc7cfdf8c40c0800395b9f9787f366a0">Blt16BPPBufferHatchRectWithColor</a>(<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="structSGPRect.html">SGPRect</a> *area, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usColor )
<a name="l12511"></a>12511 {
<a name="l12512"></a>12512       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> Pattern[8][8] =
<a name="l12513"></a>12513       {
<a name="l12514"></a>12514             1,0,1,0,1,0,1,0,
<a name="l12515"></a>12515             0,1,0,1,0,1,0,1,
<a name="l12516"></a>12516             1,0,1,0,1,0,1,0,
<a name="l12517"></a>12517             0,1,0,1,0,1,0,1,
<a name="l12518"></a>12518             1,0,1,0,1,0,1,0,
<a name="l12519"></a>12519             0,1,0,1,0,1,0,1,
<a name="l12520"></a>12520             1,0,1,0,1,0,1,0,
<a name="l12521"></a>12521             0,1,0,1,0,1,0,1
<a name="l12522"></a>12522       };
<a name="l12523"></a>12523       <span class="keywordflow">return</span> <a class="code" href="vobject__blitters_8cpp.html#82c2966a3fed0aff1265c3233bc7de66">Blt16BPPBufferPixelateRectWithColor</a>( pBuffer, uiDestPitchBYTES, area, Pattern, usColor );
<a name="l12524"></a>12524 }
<a name="l12525"></a>12525 
<a name="l12526"></a>12526 <span class="comment">//Uses black hatch color</span>
<a name="l12527"></a><a class="code" href="vobject__blitters_8h.html#54c0dfeaff9d98af20e5b6368e0ddf5c">12527</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#54c0dfeaff9d98af20e5b6368e0ddf5c">Blt16BPPBufferHatchRect</a>(<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="structSGPRect.html">SGPRect</a> *area )
<a name="l12528"></a>12528 {
<a name="l12529"></a>12529       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> Pattern[8][8] =
<a name="l12530"></a>12530       {
<a name="l12531"></a>12531             1,0,1,0,1,0,1,0,
<a name="l12532"></a>12532             0,1,0,1,0,1,0,1,
<a name="l12533"></a>12533             1,0,1,0,1,0,1,0,
<a name="l12534"></a>12534             0,1,0,1,0,1,0,1,
<a name="l12535"></a>12535             1,0,1,0,1,0,1,0,
<a name="l12536"></a>12536             0,1,0,1,0,1,0,1,
<a name="l12537"></a>12537             1,0,1,0,1,0,1,0,
<a name="l12538"></a>12538             0,1,0,1,0,1,0,1
<a name="l12539"></a>12539       };
<a name="l12540"></a>12540       <span class="keywordflow">return</span> <a class="code" href="vobject__blitters_8cpp.html#82c2966a3fed0aff1265c3233bc7de66">Blt16BPPBufferPixelateRectWithColor</a>( pBuffer, uiDestPitchBYTES, area, Pattern, 0 );
<a name="l12541"></a>12541 }
<a name="l12542"></a>12542 
<a name="l12543"></a><a class="code" href="vobject__blitters_8h.html#1323c3eb1357d35329f6a7b3720659b6">12543</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#1323c3eb1357d35329f6a7b3720659b6">Blt16BPPBufferLooseHatchRectWithColor</a>(<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="structSGPRect.html">SGPRect</a> *area, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usColor )
<a name="l12544"></a>12544 {
<a name="l12545"></a>12545       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> Pattern[8][8] =
<a name="l12546"></a>12546       {
<a name="l12547"></a>12547             1,0,0,0,1,0,0,0,
<a name="l12548"></a>12548             0,0,0,0,0,0,0,0,
<a name="l12549"></a>12549             0,0,1,0,0,0,1,0,
<a name="l12550"></a>12550             0,0,0,0,0,0,0,0,
<a name="l12551"></a>12551             1,0,0,0,1,0,0,0,
<a name="l12552"></a>12552             0,0,0,0,0,0,0,0,
<a name="l12553"></a>12553             0,0,1,0,0,0,1,0,
<a name="l12554"></a>12554             0,0,0,0,0,0,0,0,
<a name="l12555"></a>12555       };
<a name="l12556"></a>12556       <span class="keywordflow">return</span> <a class="code" href="vobject__blitters_8cpp.html#82c2966a3fed0aff1265c3233bc7de66">Blt16BPPBufferPixelateRectWithColor</a>( pBuffer, uiDestPitchBYTES, area, Pattern, usColor );
<a name="l12557"></a>12557 }
<a name="l12558"></a>12558 
<a name="l12559"></a><a class="code" href="vobject__blitters_8h.html#e7ba16a60ad7b16507f40bca2fcffaf5">12559</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#e7ba16a60ad7b16507f40bca2fcffaf5">Blt16BPPBufferLooseHatchRect</a>(<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="structSGPRect.html">SGPRect</a> *area )
<a name="l12560"></a>12560 {
<a name="l12561"></a>12561       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> Pattern[8][8] =
<a name="l12562"></a>12562       {
<a name="l12563"></a>12563             1,0,0,0,1,0,0,0,
<a name="l12564"></a>12564             0,0,0,0,0,0,0,0,
<a name="l12565"></a>12565             0,0,1,0,0,0,1,0,
<a name="l12566"></a>12566             0,0,0,0,0,0,0,0,
<a name="l12567"></a>12567             1,0,0,0,1,0,0,0,
<a name="l12568"></a>12568             0,0,0,0,0,0,0,0,
<a name="l12569"></a>12569             0,0,1,0,0,0,1,0,
<a name="l12570"></a>12570             0,0,0,0,0,0,0,0,
<a name="l12571"></a>12571       };
<a name="l12572"></a>12572       <span class="keywordflow">return</span> <a class="code" href="vobject__blitters_8cpp.html#82c2966a3fed0aff1265c3233bc7de66">Blt16BPPBufferPixelateRectWithColor</a>( pBuffer, uiDestPitchBYTES, area, Pattern, 0 );
<a name="l12573"></a>12573 }
<a name="l12574"></a>12574 
<a name="l12575"></a>12575 <span class="comment">/**********************************************************************************************</span>
<a name="l12576"></a>12576 <span class="comment"> Blt8BPPDataTo16BPPBufferShadow</span>
<a name="l12577"></a>12577 <span class="comment"></span>
<a name="l12578"></a>12578 <span class="comment">      Modifies the destination buffer. Darkens the destination pixels by 25%, using the source</span>
<a name="l12579"></a>12579 <span class="comment">      image as a mask. Any Non-zero index pixels are used to darken destination pixels.</span>
<a name="l12580"></a>12580 <span class="comment"></span>
<a name="l12581"></a>12581 <span class="comment">**********************************************************************************************/</span>
<a name="l12582"></a><a class="code" href="vobject__blitters_8h.html#f7dca4a4719e101987b66c35c14d75ca">12582</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#f7dca4a4719e101987b66c35c14d75ca">Blt8BPPDataTo16BPPBufferShadow</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex)
<a name="l12583"></a>12583 {
<a name="l12584"></a>12584       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l12585"></a>12585       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l12586"></a>12586       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth;
<a name="l12587"></a>12587       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr;
<a name="l12588"></a>12588       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l12589"></a>12589   <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l12590"></a>12590       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l12591"></a>12591 
<a name="l12592"></a>12592       <span class="comment">// Assertions</span>
<a name="l12593"></a>12593       Assert( hSrcVObject != NULL );
<a name="l12594"></a>12594       Assert( pBuffer != NULL );
<a name="l12595"></a>12595 
<a name="l12596"></a>12596       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l12597"></a>12597       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l12598"></a>12598       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l12599"></a>12599       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l12600"></a>12600       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l12601"></a>12601 
<a name="l12602"></a>12602       <span class="comment">// Add to start position of dest buffer</span>
<a name="l12603"></a>12603       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l12604"></a>12604       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l12605"></a>12605 
<a name="l12606"></a>12606       <span class="comment">// Validations</span>
<a name="l12607"></a>12607       CHECKF( iTempX &gt;= 0 );
<a name="l12608"></a>12608       CHECKF( iTempY &gt;= 0 );
<a name="l12609"></a>12609 
<a name="l12610"></a>12610 
<a name="l12611"></a>12611       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l12612"></a>12612       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l12613"></a>12613       p16BPPPalette = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#930609ad8d5cdbb05449df70bd83cfcd">pShadeCurrent</a>;
<a name="l12614"></a>12614       LineSkip=(uiDestPitchBYTES-(usWidth*2));
<a name="l12615"></a>12615 
<a name="l12616"></a>12616       __asm {
<a name="l12617"></a>12617 
<a name="l12618"></a>12618             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l12619"></a>12619             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l12620"></a>12620             xor         eax, eax
<a name="l12621"></a>12621             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, usHeight
<a name="l12622"></a>12622             xor         ecx, ecx
<a name="l12623"></a>12623             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, OFFSET <a class="code" href="shading_8cpp.html#fd38e38bdd68f0da44ac96abacf3b2a6">ShadeTable</a>
<a name="l12624"></a>12624 
<a name="l12625"></a>12625 BlitDispatch:
<a name="l12626"></a>12626 
<a name="l12627"></a>12627 
<a name="l12628"></a>12628             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l12629"></a>12629             inc         esi
<a name="l12630"></a>12630             or          cl, cl
<a name="l12631"></a>12631             js          BlitTransparent
<a name="l12632"></a>12632             jz          BlitDoneLine
<a name="l12633"></a>12633 
<a name="l12634"></a>12634 <span class="comment">//BlitNonTransLoop:</span>
<a name="l12635"></a>12635 
<a name="l12636"></a>12636             xor         eax, eax
<a name="l12637"></a>12637 
<a name="l12638"></a>12638             add         esi, ecx
<a name="l12639"></a>12639 
<a name="l12640"></a>12640             clc
<a name="l12641"></a>12641             rcr         cl, 1
<a name="l12642"></a>12642             jnc         BlitNTL2
<a name="l12643"></a>12643 
<a name="l12644"></a>12644             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [edi]
<a name="l12645"></a>12645             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, [edx+eax*2]
<a name="l12646"></a>12646             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax
<a name="l12647"></a>12647 
<a name="l12648"></a>12648             add         edi, 2
<a name="l12649"></a>12649 
<a name="l12650"></a>12650 BlitNTL2:
<a name="l12651"></a>12651             clc
<a name="l12652"></a>12652             rcr         cl, 1
<a name="l12653"></a>12653             jnc         BlitNTL3
<a name="l12654"></a>12654 
<a name="l12655"></a>12655             mov         ax, [edi]
<a name="l12656"></a>12656             mov         ax, [edx+eax*2]
<a name="l12657"></a>12657             mov         [edi], ax
<a name="l12658"></a>12658 
<a name="l12659"></a>12659             mov         ax, [edi+2]
<a name="l12660"></a>12660             mov         ax, [edx+eax*2]
<a name="l12661"></a>12661             mov         [edi+2], ax
<a name="l12662"></a>12662 
<a name="l12663"></a>12663             add         edi, 4
<a name="l12664"></a>12664 
<a name="l12665"></a>12665 BlitNTL3:
<a name="l12666"></a>12666 
<a name="l12667"></a>12667             or          cl, cl
<a name="l12668"></a>12668             jz          BlitDispatch
<a name="l12669"></a>12669 
<a name="l12670"></a>12670 BlitNTL4:
<a name="l12671"></a>12671 
<a name="l12672"></a>12672             mov         ax, [edi]
<a name="l12673"></a>12673             mov         ax, [edx+eax*2]
<a name="l12674"></a>12674             mov         [edi], ax
<a name="l12675"></a>12675 
<a name="l12676"></a>12676             mov         ax, [edi+2]
<a name="l12677"></a>12677             mov         ax, [edx+eax*2]
<a name="l12678"></a>12678             mov         [edi+2], ax
<a name="l12679"></a>12679 
<a name="l12680"></a>12680             mov         ax, [edi+4]
<a name="l12681"></a>12681             mov         ax, [edx+eax*2]
<a name="l12682"></a>12682             mov         [edi+4], ax
<a name="l12683"></a>12683 
<a name="l12684"></a>12684             mov         ax, [edi+6]
<a name="l12685"></a>12685             mov         ax, [edx+eax*2]
<a name="l12686"></a>12686             mov         [edi+6], ax
<a name="l12687"></a>12687 
<a name="l12688"></a>12688             add         edi, 8
<a name="l12689"></a>12689             dec         cl
<a name="l12690"></a>12690             jnz         BlitNTL4
<a name="l12691"></a>12691 
<a name="l12692"></a>12692             jmp         BlitDispatch
<a name="l12693"></a>12693 
<a name="l12694"></a>12694 BlitTransparent:
<a name="l12695"></a>12695 
<a name="l12696"></a>12696             and         ecx, 07fH
<a name="l12697"></a>12697 <span class="comment">//          shl         ecx, 1</span>
<a name="l12698"></a>12698             add   ecx, ecx
<a name="l12699"></a>12699             add         edi, ecx
<a name="l12700"></a>12700             jmp         BlitDispatch
<a name="l12701"></a>12701 
<a name="l12702"></a>12702 
<a name="l12703"></a>12703 BlitDoneLine:
<a name="l12704"></a>12704 
<a name="l12705"></a>12705             dec         ebx
<a name="l12706"></a>12706             jz          BlitDone
<a name="l12707"></a>12707             add         edi, LineSkip
<a name="l12708"></a>12708             jmp         BlitDispatch
<a name="l12709"></a>12709 
<a name="l12710"></a>12710 
<a name="l12711"></a>12711 BlitDone:
<a name="l12712"></a>12712       }
<a name="l12713"></a>12713 
<a name="l12714"></a>12714       <span class="keywordflow">return</span>(TRUE);
<a name="l12715"></a>12715 
<a name="l12716"></a>12716 }
<a name="l12717"></a>12717 
<a name="l12718"></a>12718 
<a name="l12719"></a>12719 <span class="comment">/**********************************************************************************************</span>
<a name="l12720"></a>12720 <span class="comment"> Blt8BPPDataTo16BPPBufferTransparent</span>
<a name="l12721"></a>12721 <span class="comment"></span>
<a name="l12722"></a>12722 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l12723"></a>12723 <span class="comment">      buffer as a destination.</span>
<a name="l12724"></a>12724 <span class="comment"></span>
<a name="l12725"></a>12725 <span class="comment">**********************************************************************************************/</span>
<a name="l12726"></a>12726 
<a name="l12727"></a><a class="code" href="vobject__blitters_8h.html#65d08c28bcdf736db1c581522f9b5661">12727</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#65d08c28bcdf736db1c581522f9b5661">Blt8BPPDataTo16BPPBufferTransparent</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex )
<a name="l12728"></a>12728 {
<a name="l12729"></a>12729       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l12730"></a>12730       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l12731"></a>12731       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth;
<a name="l12732"></a>12732       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr;
<a name="l12733"></a>12733       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l12734"></a>12734       <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l12735"></a>12735       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l12736"></a>12736 
<a name="l12737"></a>12737 
<a name="l12738"></a>12738       <span class="comment">// Assertions</span>
<a name="l12739"></a>12739       Assert( hSrcVObject != NULL );
<a name="l12740"></a>12740       Assert( pBuffer != NULL );
<a name="l12741"></a>12741 
<a name="l12742"></a>12742       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l12743"></a>12743       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l12744"></a>12744       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l12745"></a>12745       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l12746"></a>12746       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l12747"></a>12747 
<a name="l12748"></a>12748       <span class="comment">// Add to start position of dest buffer</span>
<a name="l12749"></a>12749       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l12750"></a>12750       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l12751"></a>12751 
<a name="l12752"></a>12752       <span class="comment">// Validations</span>
<a name="l12753"></a>12753       CHECKF( iTempX &gt;= 0 );
<a name="l12754"></a>12754       CHECKF( iTempY &gt;= 0 );
<a name="l12755"></a>12755 
<a name="l12756"></a>12756 
<a name="l12757"></a>12757       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l12758"></a>12758       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l12759"></a>12759       p16BPPPalette = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#930609ad8d5cdbb05449df70bd83cfcd">pShadeCurrent</a>;
<a name="l12760"></a>12760       LineSkip=(uiDestPitchBYTES-(usWidth*2));
<a name="l12761"></a>12761 
<a name="l12762"></a>12762       __asm {
<a name="l12763"></a>12763 
<a name="l12764"></a>12764             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l12765"></a>12765             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l12766"></a>12766             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, p16BPPPalette
<a name="l12767"></a>12767             xor         eax, eax
<a name="l12768"></a>12768             xor         ebx, ebx
<a name="l12769"></a>12769             xor         ecx, ecx
<a name="l12770"></a>12770 
<a name="l12771"></a>12771 BlitDispatch:
<a name="l12772"></a>12772 
<a name="l12773"></a>12773             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l12774"></a>12774             inc         esi
<a name="l12775"></a>12775             or          cl, cl
<a name="l12776"></a>12776             js          BlitTransparent
<a name="l12777"></a>12777             jz          BlitDoneLine
<a name="l12778"></a>12778 
<a name="l12779"></a>12779 <span class="comment">//BlitNonTransLoop:</span>
<a name="l12780"></a>12780 
<a name="l12781"></a>12781             clc
<a name="l12782"></a>12782             rcr         cl, 1
<a name="l12783"></a>12783             jnc         BlitNTL2
<a name="l12784"></a>12784 
<a name="l12785"></a>12785             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         bl, [esi]
<a name="l12786"></a>12786             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [edx+ebx*2]
<a name="l12787"></a>12787             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax
<a name="l12788"></a>12788 
<a name="l12789"></a>12789             inc         esi
<a name="l12790"></a>12790             add         edi, 2
<a name="l12791"></a>12791 
<a name="l12792"></a>12792 BlitNTL2:
<a name="l12793"></a>12793             clc
<a name="l12794"></a>12794             rcr         cl, 1
<a name="l12795"></a>12795             jnc         BlitNTL3
<a name="l12796"></a>12796 
<a name="l12797"></a>12797             mov         bl, [esi]
<a name="l12798"></a>12798             mov         ax, [edx+ebx*2]
<a name="l12799"></a>12799             mov         [edi], ax
<a name="l12800"></a>12800 
<a name="l12801"></a>12801             mov         bl, [esi+1]
<a name="l12802"></a>12802             mov         ax, [edx+ebx*2]
<a name="l12803"></a>12803             mov         [edi+2], ax
<a name="l12804"></a>12804 
<a name="l12805"></a>12805             add         esi, 2
<a name="l12806"></a>12806             add         edi, 4
<a name="l12807"></a>12807 
<a name="l12808"></a>12808 BlitNTL3:
<a name="l12809"></a>12809 
<a name="l12810"></a>12810             or          cl, cl
<a name="l12811"></a>12811             jz          BlitDispatch
<a name="l12812"></a>12812 
<a name="l12813"></a>12813             xor         ebx, ebx
<a name="l12814"></a>12814 
<a name="l12815"></a>12815 BlitNTL4:
<a name="l12816"></a>12816 
<a name="l12817"></a>12817             mov         bl, [esi]
<a name="l12818"></a>12818             mov         ax, [edx+ebx*2]
<a name="l12819"></a>12819             mov         [edi], ax
<a name="l12820"></a>12820 
<a name="l12821"></a>12821             mov         bl, [esi+1]
<a name="l12822"></a>12822             mov         ax, [edx+ebx*2]
<a name="l12823"></a>12823             mov         [edi+2], ax
<a name="l12824"></a>12824 
<a name="l12825"></a>12825             mov         bl, [esi+2]
<a name="l12826"></a>12826             mov         ax, [edx+ebx*2]
<a name="l12827"></a>12827             mov         [edi+4], ax
<a name="l12828"></a>12828 
<a name="l12829"></a>12829             mov         bl, [esi+3]
<a name="l12830"></a>12830             mov         ax, [edx+ebx*2]
<a name="l12831"></a>12831             mov         [edi+6], ax
<a name="l12832"></a>12832 
<a name="l12833"></a>12833             add         esi, 4
<a name="l12834"></a>12834             add         edi, 8
<a name="l12835"></a>12835             dec         cl
<a name="l12836"></a>12836             jnz         BlitNTL4
<a name="l12837"></a>12837 
<a name="l12838"></a>12838             jmp         BlitDispatch
<a name="l12839"></a>12839 
<a name="l12840"></a>12840 BlitTransparent:
<a name="l12841"></a>12841 
<a name="l12842"></a>12842             and         ecx, 07fH
<a name="l12843"></a>12843 <span class="comment">//          shl         ecx, 1</span>
<a name="l12844"></a>12844             add   ecx, ecx
<a name="l12845"></a>12845             add         edi, ecx
<a name="l12846"></a>12846             jmp         BlitDispatch
<a name="l12847"></a>12847 
<a name="l12848"></a>12848 
<a name="l12849"></a>12849 BlitDoneLine:
<a name="l12850"></a>12850 
<a name="l12851"></a>12851             dec         usHeight
<a name="l12852"></a>12852             jz          BlitDone
<a name="l12853"></a>12853             add         edi, LineSkip
<a name="l12854"></a>12854             jmp         BlitDispatch
<a name="l12855"></a>12855 
<a name="l12856"></a>12856 
<a name="l12857"></a>12857 BlitDone:
<a name="l12858"></a>12858       }
<a name="l12859"></a>12859 
<a name="l12860"></a>12860       <span class="keywordflow">return</span>(TRUE);
<a name="l12861"></a>12861 
<a name="l12862"></a>12862 }
<a name="l12863"></a>12863 
<a name="l12864"></a>12864 
<a name="l12865"></a>12865 
<a name="l12866"></a>12866 <span class="comment">//*****************************************************************************************</span>
<a name="l12867"></a>12867 <span class="comment">// Blt8BPPDataTo16BPPBufferTransMirror</span>
<a name="l12868"></a>12868 <span class="comment">// </span>
<a name="l12869"></a>12869 <span class="comment">// Blits an 8bpp ETRLE to a 16-bit buffer, mirroring the image, with transparency.</span>
<a name="l12870"></a>12870 <span class="comment">// </span>
<a name="l12871"></a>12871 <span class="comment">// Returns BOOLEAN            - TRUE if successful</span>
<a name="l12872"></a>12872 <span class="comment">// </span>
<a name="l12873"></a>12873 <span class="comment">//  UINT16 *pBuffer           - 16bpp Destination buffer</span>
<a name="l12874"></a>12874 <span class="comment">// UINT32 uiDestPitchBYTES    - Destination pitch in bytes</span>
<a name="l12875"></a>12875 <span class="comment">// HVOBJECT hSrcVObject       - Source VOBJECT handle</span>
<a name="l12876"></a>12876 <span class="comment">// INT32 iX                   - X-location of blit</span>
<a name="l12877"></a>12877 <span class="comment">// INT32 iY                   - Y-location of blit</span>
<a name="l12878"></a>12878 <span class="comment">// UINT16 usIndex             - VOBJECT image index to blit from</span>
<a name="l12879"></a>12879 <span class="comment">//</span>
<a name="l12880"></a>12880 <span class="comment">// Created:  7/28/99 Derek Beland</span>
<a name="l12881"></a>12881 <span class="comment">//*****************************************************************************************</span>
<a name="l12882"></a><a class="code" href="vobject__blitters_8h.html#c7e7fb2140e20933339d080da2efc865">12882</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#c7e7fb2140e20933339d080da2efc865">Blt8BPPDataTo16BPPBufferTransMirror</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex )
<a name="l12883"></a>12883 {
<a name="l12884"></a>12884       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l12885"></a>12885       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l12886"></a>12886       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth;
<a name="l12887"></a>12887       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr;
<a name="l12888"></a>12888       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestSkip;
<a name="l12889"></a>12889       <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l12890"></a>12890       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l12891"></a>12891 
<a name="l12892"></a>12892 
<a name="l12893"></a>12893       <span class="comment">// Assertions</span>
<a name="l12894"></a>12894       Assert( hSrcVObject != NULL );
<a name="l12895"></a>12895       Assert( pBuffer != NULL );
<a name="l12896"></a>12896 
<a name="l12897"></a>12897       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l12898"></a>12898       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l12899"></a>12899       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l12900"></a>12900       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l12901"></a>12901       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l12902"></a>12902 
<a name="l12903"></a>12903       <span class="comment">// Add to start position of dest buffer</span>
<a name="l12904"></a>12904 <span class="comment">//    iTempX = iX + pTrav-&gt;sOffsetX;</span>
<a name="l12905"></a>12905       iTempX = iX + usWidth - pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>-1;
<a name="l12906"></a>12906       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l12907"></a>12907 
<a name="l12908"></a>12908       <span class="comment">// Validations</span>
<a name="l12909"></a>12909       CHECKF( iTempX &gt;= 0 );
<a name="l12910"></a>12910       CHECKF( iTempY &gt;= 0 );
<a name="l12911"></a>12911 
<a name="l12912"></a>12912 
<a name="l12913"></a>12913       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l12914"></a>12914       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l12915"></a>12915       p16BPPPalette = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#930609ad8d5cdbb05449df70bd83cfcd">pShadeCurrent</a>;
<a name="l12916"></a>12916       uiDestSkip=(uiDestPitchBYTES+(usWidth*2));
<a name="l12917"></a>12917 
<a name="l12918"></a>12918       __asm {
<a name="l12919"></a>12919 <span class="comment">// esi = pointer to source data</span>
<a name="l12920"></a>12920 <span class="comment">// edi = pointer to destination buffer</span>
<a name="l12921"></a>12921 <span class="comment">// eax = 16bpp pixel</span>
<a name="l12922"></a>12922 <span class="comment">// ebx = 8bpp pixel</span>
<a name="l12923"></a>12923 <span class="comment">// ecx = repeat count</span>
<a name="l12924"></a>12924 <span class="comment">// edx = pointer to 8-&gt;16bpp conversion table</span>
<a name="l12925"></a>12925 
<a name="l12926"></a>12926             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l12927"></a>12927             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l12928"></a>12928             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, p16BPPPalette
<a name="l12929"></a>12929             xor         eax, eax
<a name="l12930"></a>12930             xor         ebx, ebx
<a name="l12931"></a>12931             xor         ecx, ecx
<a name="l12932"></a>12932 
<a name="l12933"></a>12933 BlitDispatch:
<a name="l12934"></a>12934 
<a name="l12935"></a>12935 <span class="comment">// pick up a new byte</span>
<a name="l12936"></a>12936             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l12937"></a>12937             inc         esi
<a name="l12938"></a>12938             or          cl, cl
<a name="l12939"></a>12939 <span class="comment">// if bit 7 is set, the run is transparent</span>
<a name="l12940"></a>12940             js          BlitTransparent
<a name="l12941"></a>12941 <span class="comment">// if the byte is zero, it marks the end of current line</span>
<a name="l12942"></a>12942             jz          BlitDoneLine
<a name="l12943"></a>12943 
<a name="l12944"></a>12944 <span class="comment">//BlitNonTransLoop:</span>
<a name="l12945"></a>12945 
<a name="l12946"></a>12946 <span class="comment">// else we have a normal run of non-transparent bytes</span>
<a name="l12947"></a>12947 <span class="comment">// blit one byte of the count</span>
<a name="l12948"></a>12948             clc
<a name="l12949"></a>12949             rcr         cl, 1
<a name="l12950"></a>12950             jnc         BlitNTL2
<a name="l12951"></a>12951 
<a name="l12952"></a>12952             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         bl, [esi]
<a name="l12953"></a>12953             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [edx+ebx*2]
<a name="l12954"></a>12954             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax
<a name="l12955"></a>12955 
<a name="l12956"></a>12956             inc         esi
<a name="l12957"></a>12957             sub         edi, 2
<a name="l12958"></a>12958 
<a name="l12959"></a>12959 <span class="comment">// blit one word of the count</span>
<a name="l12960"></a>12960 BlitNTL2:
<a name="l12961"></a>12961             clc
<a name="l12962"></a>12962             rcr         cl, 1
<a name="l12963"></a>12963             jnc         BlitNTL3
<a name="l12964"></a>12964 
<a name="l12965"></a>12965             mov         bl, [esi]
<a name="l12966"></a>12966             mov         ax, [edx+ebx*2]
<a name="l12967"></a>12967             mov         [edi], ax
<a name="l12968"></a>12968 
<a name="l12969"></a>12969             mov         bl, [esi+1]
<a name="l12970"></a>12970             mov         ax, [edx+ebx*2]
<a name="l12971"></a>12971             mov         [edi-2], ax
<a name="l12972"></a>12972 
<a name="l12973"></a>12973             add         esi, 2
<a name="l12974"></a>12974             sub         edi, 4
<a name="l12975"></a>12975 
<a name="l12976"></a>12976 <span class="comment">// blit the rest four at a time (unrolled loop)</span>
<a name="l12977"></a>12977 BlitNTL3:
<a name="l12978"></a>12978 
<a name="l12979"></a>12979             or          cl, cl
<a name="l12980"></a>12980             jz          BlitDispatch
<a name="l12981"></a>12981 
<a name="l12982"></a>12982             xor         ebx, ebx
<a name="l12983"></a>12983 
<a name="l12984"></a>12984 BlitNTL4:
<a name="l12985"></a>12985 
<a name="l12986"></a>12986             mov         bl, [esi]
<a name="l12987"></a>12987             mov         ax, [edx+ebx*2]
<a name="l12988"></a>12988             mov         [edi], ax
<a name="l12989"></a>12989 
<a name="l12990"></a>12990             mov         bl, [esi+1]
<a name="l12991"></a>12991             mov         ax, [edx+ebx*2]
<a name="l12992"></a>12992             mov         [edi-2], ax
<a name="l12993"></a>12993 
<a name="l12994"></a>12994             mov         bl, [esi+2]
<a name="l12995"></a>12995             mov         ax, [edx+ebx*2]
<a name="l12996"></a>12996             mov         [edi-4], ax
<a name="l12997"></a>12997 
<a name="l12998"></a>12998             mov         bl, [esi+3]
<a name="l12999"></a>12999             mov         ax, [edx+ebx*2]
<a name="l13000"></a>13000             mov         [edi-6], ax
<a name="l13001"></a>13001 
<a name="l13002"></a>13002             add         esi, 4
<a name="l13003"></a>13003             sub         edi, 8
<a name="l13004"></a>13004             dec         cl
<a name="l13005"></a>13005             jnz         BlitNTL4
<a name="l13006"></a>13006 
<a name="l13007"></a>13007             jmp         BlitDispatch
<a name="l13008"></a>13008 
<a name="l13009"></a>13009 BlitTransparent:
<a name="l13010"></a>13010 
<a name="l13011"></a>13011             and         ecx, 07fH
<a name="l13012"></a>13012 <span class="comment">//          shl         ecx, 1</span>
<a name="l13013"></a>13013             add   ecx, ecx
<a name="l13014"></a>13014             sub         edi, ecx
<a name="l13015"></a>13015             jmp         BlitDispatch
<a name="l13016"></a>13016 
<a name="l13017"></a>13017 
<a name="l13018"></a>13018 BlitDoneLine:
<a name="l13019"></a>13019 
<a name="l13020"></a>13020             dec         usHeight
<a name="l13021"></a>13021             jz          BlitDone
<a name="l13022"></a>13022             add         edi, uiDestSkip
<a name="l13023"></a>13023             jmp         BlitDispatch
<a name="l13024"></a>13024 
<a name="l13025"></a>13025 
<a name="l13026"></a>13026 BlitDone:
<a name="l13027"></a>13027       }
<a name="l13028"></a>13028 
<a name="l13029"></a>13029       <span class="keywordflow">return</span>(TRUE);
<a name="l13030"></a>13030 
<a name="l13031"></a>13031 }
<a name="l13032"></a>13032 
<a name="l13033"></a>13033 
<a name="l13034"></a>13034 <span class="comment">/**********************************************************************************************</span>
<a name="l13035"></a>13035 <span class="comment"> Blt8BPPDataTo16BPPBufferTransparentClip</span>
<a name="l13036"></a>13036 <span class="comment"></span>
<a name="l13037"></a>13037 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l13038"></a>13038 <span class="comment">      buffer as a destination. Clips the brush.</span>
<a name="l13039"></a>13039 <span class="comment"></span>
<a name="l13040"></a>13040 <span class="comment">**********************************************************************************************/</span>
<a name="l13041"></a><a class="code" href="vobject__blitters_8h.html#14e4da1bd2d6201ec9f82c02c6ed9cab">13041</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#14e4da1bd2d6201ec9f82c02c6ed9cab">Blt8BPPDataTo16BPPBufferTransparentClip</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="structSGPRect.html">SGPRect</a> *clipregion)
<a name="l13042"></a>13042 {
<a name="l13043"></a>13043       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l13044"></a>13044       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l13045"></a>13045       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth, Unblitted;
<a name="l13046"></a>13046       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr;
<a name="l13047"></a>13047       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l13048"></a>13048   <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l13049"></a>13049       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY, LeftSkip, RightSkip, TopSkip, BottomSkip, BlitLength, BlitHeight;
<a name="l13050"></a>13050       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  ClipX1, ClipY1, ClipX2, ClipY2;
<a name="l13051"></a>13051 
<a name="l13052"></a>13052       <span class="comment">// Assertions</span>
<a name="l13053"></a>13053       Assert( hSrcVObject != NULL );
<a name="l13054"></a>13054       Assert( pBuffer != NULL );
<a name="l13055"></a>13055 
<a name="l13056"></a>13056       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l13057"></a>13057       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l13058"></a>13058       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l13059"></a>13059       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l13060"></a>13060       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l13061"></a>13061 
<a name="l13062"></a>13062       <span class="comment">// Add to start position of dest buffer</span>
<a name="l13063"></a>13063       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l13064"></a>13064       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l13065"></a>13065 
<a name="l13066"></a>13066       <span class="keywordflow">if</span>(clipregion==NULL)
<a name="l13067"></a>13067       {
<a name="l13068"></a>13068             ClipX1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l13069"></a>13069             ClipY1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l13070"></a>13070             ClipX2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l13071"></a>13071             ClipY2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l13072"></a>13072       }
<a name="l13073"></a>13073       <span class="keywordflow">else</span>
<a name="l13074"></a>13074       {
<a name="l13075"></a>13075             ClipX1=clipregion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l13076"></a>13076             ClipY1=clipregion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l13077"></a>13077             ClipX2=clipregion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l13078"></a>13078             ClipY2=clipregion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l13079"></a>13079       }
<a name="l13080"></a>13080 
<a name="l13081"></a>13081       <span class="comment">// Calculate rows hanging off each side of the screen</span>
<a name="l13082"></a>13082       LeftSkip=__min(ClipX1 - min(ClipX1, iTempX), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l13083"></a>13083       RightSkip=__min(max(ClipX2, (iTempX+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth)) - ClipX2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l13084"></a>13084       TopSkip=__min(ClipY1 - __min(ClipY1, iTempY), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l13085"></a>13085       BottomSkip=__min(__max(ClipY2, (iTempY+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight)) - ClipY2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l13086"></a>13086 
<a name="l13087"></a>13087       <span class="comment">// calculate the remaining rows and columns to blit</span>
<a name="l13088"></a>13088       BlitLength=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth-LeftSkip-RightSkip);
<a name="l13089"></a>13089       BlitHeight=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight-TopSkip-BottomSkip);
<a name="l13090"></a>13090 
<a name="l13091"></a>13091       <span class="comment">// check if whole thing is clipped</span>
<a name="l13092"></a>13092       <span class="keywordflow">if</span>((LeftSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth) || (RightSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth))
<a name="l13093"></a>13093             <span class="keywordflow">return</span>(TRUE);
<a name="l13094"></a>13094 
<a name="l13095"></a>13095       <span class="comment">// check if whole thing is clipped</span>
<a name="l13096"></a>13096       <span class="keywordflow">if</span>((TopSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight) || (BottomSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight))
<a name="l13097"></a>13097             <span class="keywordflow">return</span>(TRUE);
<a name="l13098"></a>13098 
<a name="l13099"></a>13099       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l13100"></a>13100       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l13101"></a>13101       p16BPPPalette = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#930609ad8d5cdbb05449df70bd83cfcd">pShadeCurrent</a>;
<a name="l13102"></a>13102       LineSkip=(uiDestPitchBYTES-(BlitLength*2));
<a name="l13103"></a>13103 
<a name="l13104"></a>13104       __asm {
<a name="l13105"></a>13105 
<a name="l13106"></a>13106             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l13107"></a>13107             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l13108"></a>13108             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, p16BPPPalette
<a name="l13109"></a>13109             xor         eax, eax
<a name="l13110"></a>13110             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, TopSkip
<a name="l13111"></a>13111             xor         ecx, ecx
<a name="l13112"></a>13112 
<a name="l13113"></a>13113             or          ebx, ebx                                        <span class="comment">// check for nothing clipped on top</span>
<a name="l13114"></a>13114             jz          LeftSkipSetup
<a name="l13115"></a>13115 
<a name="l13116"></a>13116 TopSkipLoop:                                                            <span class="comment">// Skips the number of lines clipped at the top</span>
<a name="l13117"></a>13117 
<a name="l13118"></a>13118             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l13119"></a>13119             inc         esi
<a name="l13120"></a>13120             or          cl, cl
<a name="l13121"></a>13121             js          TopSkipLoop
<a name="l13122"></a>13122             jz          TSEndLine
<a name="l13123"></a>13123 
<a name="l13124"></a>13124             add         esi, ecx
<a name="l13125"></a>13125             jmp         TopSkipLoop
<a name="l13126"></a>13126 
<a name="l13127"></a>13127 TSEndLine:
<a name="l13128"></a>13128             dec         ebx
<a name="l13129"></a>13129             jnz         TopSkipLoop
<a name="l13130"></a>13130 
<a name="l13131"></a>13131 
<a name="l13132"></a>13132 
<a name="l13133"></a>13133 
<a name="l13134"></a>13134 LeftSkipSetup:
<a name="l13135"></a>13135 
<a name="l13136"></a>13136             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l13137"></a>13137             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, LeftSkip                             <span class="comment">// check for nothing clipped on the left</span>
<a name="l13138"></a>13138             or          ebx, ebx
<a name="l13139"></a>13139             jz          BlitLineSetup
<a name="l13140"></a>13140 
<a name="l13141"></a>13141 LeftSkipLoop:
<a name="l13142"></a>13142 
<a name="l13143"></a>13143             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l13144"></a>13144             inc         esi
<a name="l13145"></a>13145 
<a name="l13146"></a>13146             or          cl, cl
<a name="l13147"></a>13147             js          LSTrans
<a name="l13148"></a>13148 
<a name="l13149"></a>13149             cmp         ecx, ebx
<a name="l13150"></a>13150             je          LSSkip2                                               <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l13151"></a>13151             jb          LSSkip1                                               <span class="comment">// if less, skip whole thing</span>
<a name="l13152"></a>13152 
<a name="l13153"></a>13153             add         esi, ebx                                        <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l13154"></a>13154             sub         ecx, ebx
<a name="l13155"></a>13155             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, BlitLength
<a name="l13156"></a>13156             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l13157"></a>13157             jmp         BlitNonTransLoop
<a name="l13158"></a>13158 
<a name="l13159"></a>13159 LSSkip2:
<a name="l13160"></a>13160             add         esi, ecx                                        <span class="comment">// skip whole run, and start blit with new run</span>
<a name="l13161"></a>13161             jmp         BlitLineSetup
<a name="l13162"></a>13162 
<a name="l13163"></a>13163 
<a name="l13164"></a>13164 LSSkip1:
<a name="l13165"></a>13165             add         esi, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l13166"></a>13166             sub         ebx, ecx
<a name="l13167"></a>13167             jmp         LeftSkipLoop
<a name="l13168"></a>13168 
<a name="l13169"></a>13169 
<a name="l13170"></a>13170 LSTrans:
<a name="l13171"></a>13171             and         ecx, 07fH
<a name="l13172"></a>13172             cmp         ecx, ebx
<a name="l13173"></a>13173             je          BlitLineSetup                             <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l13174"></a>13174             jb          LSTrans1                                        <span class="comment">// if less, skip whole thing</span>
<a name="l13175"></a>13175 
<a name="l13176"></a>13176             sub         ecx, ebx                                        <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l13177"></a>13177             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, BlitLength
<a name="l13178"></a>13178             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l13179"></a>13179             jmp         BlitTransparent
<a name="l13180"></a>13180 
<a name="l13181"></a>13181 
<a name="l13182"></a>13182 LSTrans1:
<a name="l13183"></a>13183             sub         ebx, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l13184"></a>13184             jmp         LeftSkipLoop
<a name="l13185"></a>13185 
<a name="l13186"></a>13186 
<a name="l13187"></a>13187 
<a name="l13188"></a>13188 
<a name="l13189"></a>13189 BlitLineSetup:                                                    <span class="comment">// Does any actual blitting (trans/non) for the line</span>
<a name="l13190"></a>13190             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, BlitLength
<a name="l13191"></a>13191             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l13192"></a>13192 
<a name="l13193"></a>13193 BlitDispatch:
<a name="l13194"></a>13194 
<a name="l13195"></a>13195             or          ebx, ebx                                        <span class="comment">// Check to see if we're done blitting</span>
<a name="l13196"></a>13196             jz          RightSkipLoop
<a name="l13197"></a>13197 
<a name="l13198"></a>13198             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l13199"></a>13199             inc         esi
<a name="l13200"></a>13200             or          cl, cl
<a name="l13201"></a>13201             js          BlitTransparent
<a name="l13202"></a>13202 
<a name="l13203"></a>13203 BlitNonTransLoop:                                           <span class="comment">// blit non-transparent pixels</span>
<a name="l13204"></a>13204 
<a name="l13205"></a>13205             cmp         ecx, ebx
<a name="l13206"></a>13206             jbe         BNTrans1
<a name="l13207"></a>13207 
<a name="l13208"></a>13208             sub         ecx, ebx
<a name="l13209"></a>13209             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, ecx
<a name="l13210"></a>13210             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, ebx
<a name="l13211"></a>13211 
<a name="l13212"></a>13212 BNTrans1:
<a name="l13213"></a>13213             sub         ebx, ecx
<a name="l13214"></a>13214 
<a name="l13215"></a>13215             clc
<a name="l13216"></a>13216             rcr         cl, 1
<a name="l13217"></a>13217             jnc         BlitNTL2
<a name="l13218"></a>13218 
<a name="l13219"></a>13219             xor         eax, eax
<a name="l13220"></a>13220             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l13221"></a>13221             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [edx+eax*2]
<a name="l13222"></a>13222             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax
<a name="l13223"></a>13223 
<a name="l13224"></a>13224             inc         esi
<a name="l13225"></a>13225             add         edi, 2
<a name="l13226"></a>13226 
<a name="l13227"></a>13227 BlitNTL2:
<a name="l13228"></a>13228             clc
<a name="l13229"></a>13229             rcr         cl, 1
<a name="l13230"></a>13230             jnc         BlitNTL3
<a name="l13231"></a>13231 
<a name="l13232"></a>13232             xor         eax, eax
<a name="l13233"></a>13233             mov         al, [esi]
<a name="l13234"></a>13234             mov         ax, [edx+eax*2]
<a name="l13235"></a>13235             mov         [edi], ax
<a name="l13236"></a>13236 
<a name="l13237"></a>13237             xor         eax, eax
<a name="l13238"></a>13238             mov         al, [esi+1]
<a name="l13239"></a>13239             mov         ax, [edx+eax*2]
<a name="l13240"></a>13240             mov         [edi+2], ax
<a name="l13241"></a>13241 
<a name="l13242"></a>13242             add         esi, 2
<a name="l13243"></a>13243             add         edi, 4
<a name="l13244"></a>13244 
<a name="l13245"></a>13245 BlitNTL3:
<a name="l13246"></a>13246 
<a name="l13247"></a>13247             or          cl, cl
<a name="l13248"></a>13248             jz          BlitLineEnd
<a name="l13249"></a>13249 
<a name="l13250"></a>13250 BlitNTL4:
<a name="l13251"></a>13251 
<a name="l13252"></a>13252             xor         eax, eax
<a name="l13253"></a>13253             mov         al, [esi]
<a name="l13254"></a>13254             mov         ax, [edx+eax*2]
<a name="l13255"></a>13255             mov         [edi], ax
<a name="l13256"></a>13256 
<a name="l13257"></a>13257             xor         eax, eax
<a name="l13258"></a>13258             mov         al, [esi+1]
<a name="l13259"></a>13259             mov         ax, [edx+eax*2]
<a name="l13260"></a>13260             mov         [edi+2], ax
<a name="l13261"></a>13261 
<a name="l13262"></a>13262             xor         eax, eax
<a name="l13263"></a>13263             mov         al, [esi+2]
<a name="l13264"></a>13264             mov         ax, [edx+eax*2]
<a name="l13265"></a>13265             mov         [edi+4], ax
<a name="l13266"></a>13266 
<a name="l13267"></a>13267             xor         eax, eax
<a name="l13268"></a>13268             mov         al, [esi+3]
<a name="l13269"></a>13269             mov         ax, [edx+eax*2]
<a name="l13270"></a>13270             mov         [edi+6], ax
<a name="l13271"></a>13271 
<a name="l13272"></a>13272             add         esi, 4
<a name="l13273"></a>13273             add         edi, 8
<a name="l13274"></a>13274             dec         cl
<a name="l13275"></a>13275             jnz         BlitNTL4
<a name="l13276"></a>13276 
<a name="l13277"></a>13277 BlitLineEnd:
<a name="l13278"></a>13278             add         esi, Unblitted
<a name="l13279"></a>13279             jmp         BlitDispatch
<a name="l13280"></a>13280 
<a name="l13281"></a>13281 BlitTransparent:                                                              <span class="comment">// skip transparent pixels</span>
<a name="l13282"></a>13282 
<a name="l13283"></a>13283             and         ecx, 07fH
<a name="l13284"></a>13284             cmp         ecx, ebx
<a name="l13285"></a>13285             jbe         BTrans1
<a name="l13286"></a>13286 
<a name="l13287"></a>13287             mov         ecx, ebx
<a name="l13288"></a>13288 
<a name="l13289"></a>13289 BTrans1:
<a name="l13290"></a>13290 
<a name="l13291"></a>13291             sub         ebx, ecx
<a name="l13292"></a>13292 <span class="comment">//          shl         ecx, 1</span>
<a name="l13293"></a>13293             add   ecx, ecx
<a name="l13294"></a>13294             add         edi, ecx
<a name="l13295"></a>13295             jmp         BlitDispatch
<a name="l13296"></a>13296 
<a name="l13297"></a>13297 
<a name="l13298"></a>13298 RightSkipLoop:                                                                      <span class="comment">// skip along until we hit and end-of-line marker</span>
<a name="l13299"></a>13299 
<a name="l13300"></a>13300 
<a name="l13301"></a>13301 RSLoop1:
<a name="l13302"></a>13302             mov         al, [esi]
<a name="l13303"></a>13303             inc         esi
<a name="l13304"></a>13304             or          al, al
<a name="l13305"></a>13305             jnz         RSLoop1
<a name="l13306"></a>13306 
<a name="l13307"></a>13307             dec         BlitHeight
<a name="l13308"></a>13308             jz          BlitDone
<a name="l13309"></a>13309             add         edi, LineSkip
<a name="l13310"></a>13310 
<a name="l13311"></a>13311             jmp         LeftSkipSetup
<a name="l13312"></a>13312 
<a name="l13313"></a>13313 
<a name="l13314"></a>13314 BlitDone:
<a name="l13315"></a>13315       }
<a name="l13316"></a>13316 
<a name="l13317"></a>13317       <span class="keywordflow">return</span>(TRUE);
<a name="l13318"></a>13318 
<a name="l13319"></a>13319 }
<a name="l13320"></a>13320 
<a name="l13321"></a>13321 
<a name="l13322"></a>13322 
<a name="l13323"></a>13323 
<a name="l13324"></a>13324 <span class="comment">/**********************************************************************************************</span>
<a name="l13325"></a>13325 <span class="comment"> BltIsClipped</span>
<a name="l13326"></a>13326 <span class="comment"></span>
<a name="l13327"></a>13327 <span class="comment">      Determines whether a given blit will need clipping or not. Returns TRUE/FALSE.</span>
<a name="l13328"></a>13328 <span class="comment"></span>
<a name="l13329"></a>13329 <span class="comment">**********************************************************************************************/</span>
<a name="l13330"></a><a class="code" href="vobject__blitters_8h.html#97c1d0ecc6c1d0f7ebf7837924a42d8b">13330</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#97c1d0ecc6c1d0f7ebf7837924a42d8b">BltIsClipped</a>(<a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="structSGPRect.html">SGPRect</a> *clipregion )
<a name="l13331"></a>13331 {
<a name="l13332"></a>13332       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth;
<a name="l13333"></a>13333   <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l13334"></a>13334       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l13335"></a>13335       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  ClipX1, ClipY1, ClipX2, ClipY2;
<a name="l13336"></a>13336 
<a name="l13337"></a>13337       <span class="comment">// Assertions</span>
<a name="l13338"></a>13338       Assert( hSrcVObject != NULL );
<a name="l13339"></a>13339 
<a name="l13340"></a>13340       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l13341"></a>13341       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l13342"></a>13342       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l13343"></a>13343       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l13344"></a>13344 
<a name="l13345"></a>13345       <span class="comment">// Add to start position of dest buffer</span>
<a name="l13346"></a>13346       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l13347"></a>13347       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l13348"></a>13348 
<a name="l13349"></a>13349       <span class="keywordflow">if</span>(clipregion==NULL)
<a name="l13350"></a>13350       {
<a name="l13351"></a>13351             ClipX1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l13352"></a>13352             ClipY1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l13353"></a>13353             ClipX2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l13354"></a>13354             ClipY2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l13355"></a>13355       }
<a name="l13356"></a>13356       <span class="keywordflow">else</span>
<a name="l13357"></a>13357       {
<a name="l13358"></a>13358             ClipX1=clipregion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l13359"></a>13359             ClipY1=clipregion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l13360"></a>13360             ClipX2=clipregion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l13361"></a>13361             ClipY2=clipregion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l13362"></a>13362       }
<a name="l13363"></a>13363 
<a name="l13364"></a>13364 
<a name="l13365"></a>13365       <span class="comment">// Calculate rows hanging off each side of the screen</span>
<a name="l13366"></a>13366       <span class="keywordflow">if</span>(__min(ClipX1 - min(ClipX1, iTempX), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth))
<a name="l13367"></a>13367             <span class="keywordflow">return</span>(TRUE);
<a name="l13368"></a>13368 
<a name="l13369"></a>13369       <span class="keywordflow">if</span>(__min(max(ClipX2, (iTempX+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth)) - ClipX2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth))
<a name="l13370"></a>13370             <span class="keywordflow">return</span>(TRUE);
<a name="l13371"></a>13371 
<a name="l13372"></a>13372       <span class="keywordflow">if</span>(__min(ClipY1 - __min(ClipY1, iTempY), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight))
<a name="l13373"></a>13373             <span class="keywordflow">return</span>(TRUE);
<a name="l13374"></a>13374 
<a name="l13375"></a>13375       <span class="keywordflow">if</span>(__min(__max(ClipY2, (iTempY+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight)) - ClipY2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight))
<a name="l13376"></a>13376             <span class="keywordflow">return</span>(TRUE);
<a name="l13377"></a>13377 
<a name="l13378"></a>13378       <span class="keywordflow">return</span>(FALSE);
<a name="l13379"></a>13379 }
<a name="l13380"></a>13380 
<a name="l13381"></a>13381 
<a name="l13382"></a>13382 
<a name="l13383"></a>13383 <span class="comment">/**********************************************************************************************</span>
<a name="l13384"></a>13384 <span class="comment"> Blt8BPPDataTo16BPPBufferShadowClip</span>
<a name="l13385"></a>13385 <span class="comment"></span>
<a name="l13386"></a>13386 <span class="comment">      Modifies the destination buffer. Darkens the destination pixels by 25%, using the source</span>
<a name="l13387"></a>13387 <span class="comment">      image as a mask. Any Non-zero index pixels are used to darken destination pixels. Blitter</span>
<a name="l13388"></a>13388 <span class="comment">      clips brush if it doesn't fit on the viewport.</span>
<a name="l13389"></a>13389 <span class="comment"></span>
<a name="l13390"></a>13390 <span class="comment">**********************************************************************************************/</span>
<a name="l13391"></a><a class="code" href="vobject__blitters_8h.html#5aaaa11ed9b8dcc56b11429fecf495ec">13391</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#5aaaa11ed9b8dcc56b11429fecf495ec">Blt8BPPDataTo16BPPBufferShadowClip</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="structSGPRect.html">SGPRect</a> *clipregion)
<a name="l13392"></a>13392 {
<a name="l13393"></a>13393       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l13394"></a>13394       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l13395"></a>13395       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth, Unblitted;
<a name="l13396"></a>13396       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr;
<a name="l13397"></a>13397       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l13398"></a>13398   <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l13399"></a>13399       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY, LeftSkip, RightSkip, TopSkip, BottomSkip, BlitLength, BlitHeight;
<a name="l13400"></a>13400       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  ClipX1, ClipY1, ClipX2, ClipY2;
<a name="l13401"></a>13401 
<a name="l13402"></a>13402       <span class="comment">// Assertions</span>
<a name="l13403"></a>13403       Assert( hSrcVObject != NULL );
<a name="l13404"></a>13404       Assert( pBuffer != NULL );
<a name="l13405"></a>13405 
<a name="l13406"></a>13406       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l13407"></a>13407       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l13408"></a>13408       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l13409"></a>13409       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l13410"></a>13410       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l13411"></a>13411 
<a name="l13412"></a>13412       <span class="comment">// Add to start position of dest buffer</span>
<a name="l13413"></a>13413       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l13414"></a>13414       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l13415"></a>13415 
<a name="l13416"></a>13416       <span class="keywordflow">if</span>(clipregion==NULL)
<a name="l13417"></a>13417       {
<a name="l13418"></a>13418             ClipX1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l13419"></a>13419             ClipY1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l13420"></a>13420             ClipX2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l13421"></a>13421             ClipY2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l13422"></a>13422       }
<a name="l13423"></a>13423       <span class="keywordflow">else</span>
<a name="l13424"></a>13424       {
<a name="l13425"></a>13425             ClipX1=clipregion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l13426"></a>13426             ClipY1=clipregion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l13427"></a>13427             ClipX2=clipregion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l13428"></a>13428             ClipY2=clipregion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l13429"></a>13429       }
<a name="l13430"></a>13430 
<a name="l13431"></a>13431       <span class="comment">// Calculate rows hanging off each side of the screen</span>
<a name="l13432"></a>13432       LeftSkip=__min(ClipX1 - min(ClipX1, iTempX), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l13433"></a>13433       RightSkip=__min(max(ClipX2, (iTempX+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth)) - ClipX2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l13434"></a>13434       TopSkip=__min(ClipY1 - __min(ClipY1, iTempY), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l13435"></a>13435       BottomSkip=__min(__max(ClipY2, (iTempY+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight)) - ClipY2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l13436"></a>13436 
<a name="l13437"></a>13437       <span class="comment">// calculate the remaining rows and columns to blit</span>
<a name="l13438"></a>13438       BlitLength=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth-LeftSkip-RightSkip);
<a name="l13439"></a>13439       BlitHeight=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight-TopSkip-BottomSkip);
<a name="l13440"></a>13440 
<a name="l13441"></a>13441       <span class="comment">// whole thing is clipped</span>
<a name="l13442"></a>13442       <span class="keywordflow">if</span>((LeftSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth) || (RightSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth))
<a name="l13443"></a>13443             <span class="keywordflow">return</span>(TRUE);
<a name="l13444"></a>13444 
<a name="l13445"></a>13445       <span class="comment">// whole thing is clipped</span>
<a name="l13446"></a>13446       <span class="keywordflow">if</span>((TopSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight) || (BottomSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight))
<a name="l13447"></a>13447             <span class="keywordflow">return</span>(TRUE);
<a name="l13448"></a>13448 
<a name="l13449"></a>13449       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l13450"></a>13450       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l13451"></a>13451       p16BPPPalette = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#930609ad8d5cdbb05449df70bd83cfcd">pShadeCurrent</a>;
<a name="l13452"></a>13452       LineSkip=(uiDestPitchBYTES-(BlitLength*2));
<a name="l13453"></a>13453 
<a name="l13454"></a>13454       __asm {
<a name="l13455"></a>13455 
<a name="l13456"></a>13456             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l13457"></a>13457             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l13458"></a>13458             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, OFFSET <a class="code" href="shading_8cpp.html#fd38e38bdd68f0da44ac96abacf3b2a6">ShadeTable</a>
<a name="l13459"></a>13459             xor         eax, eax
<a name="l13460"></a>13460             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, TopSkip
<a name="l13461"></a>13461             xor         ecx, ecx
<a name="l13462"></a>13462 
<a name="l13463"></a>13463             or          ebx, ebx                                        <span class="comment">// check for nothing clipped on top</span>
<a name="l13464"></a>13464             jz          LeftSkipSetup
<a name="l13465"></a>13465 
<a name="l13466"></a>13466 TopSkipLoop:                                                            <span class="comment">// Skips the number of lines clipped at the top</span>
<a name="l13467"></a>13467 
<a name="l13468"></a>13468             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l13469"></a>13469             inc         esi
<a name="l13470"></a>13470             or          cl, cl
<a name="l13471"></a>13471             js          TopSkipLoop
<a name="l13472"></a>13472             jz          TSEndLine
<a name="l13473"></a>13473 
<a name="l13474"></a>13474             add         esi, ecx
<a name="l13475"></a>13475             jmp         TopSkipLoop
<a name="l13476"></a>13476 
<a name="l13477"></a>13477 TSEndLine:
<a name="l13478"></a>13478             dec         ebx
<a name="l13479"></a>13479             jnz         TopSkipLoop
<a name="l13480"></a>13480 
<a name="l13481"></a>13481 
<a name="l13482"></a>13482 
<a name="l13483"></a>13483 
<a name="l13484"></a>13484 LeftSkipSetup:
<a name="l13485"></a>13485 
<a name="l13486"></a>13486             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l13487"></a>13487             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, LeftSkip                             <span class="comment">// check for nothing clipped on the left</span>
<a name="l13488"></a>13488             or          ebx, ebx
<a name="l13489"></a>13489             jz          BlitLineSetup
<a name="l13490"></a>13490 
<a name="l13491"></a>13491 LeftSkipLoop:
<a name="l13492"></a>13492 
<a name="l13493"></a>13493             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l13494"></a>13494             inc         esi
<a name="l13495"></a>13495 
<a name="l13496"></a>13496             or          cl, cl
<a name="l13497"></a>13497             js          LSTrans
<a name="l13498"></a>13498 
<a name="l13499"></a>13499             cmp         ecx, ebx
<a name="l13500"></a>13500             je          LSSkip2                                               <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l13501"></a>13501             jb          LSSkip1                                               <span class="comment">// if less, skip whole thing</span>
<a name="l13502"></a>13502 
<a name="l13503"></a>13503             add         esi, ebx                                        <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l13504"></a>13504             sub         ecx, ebx
<a name="l13505"></a>13505             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, BlitLength
<a name="l13506"></a>13506             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l13507"></a>13507             jmp         BlitNonTransLoop
<a name="l13508"></a>13508 
<a name="l13509"></a>13509 LSSkip2:
<a name="l13510"></a>13510             add         esi, ecx                                        <span class="comment">// skip whole run, and start blit with new run</span>
<a name="l13511"></a>13511             jmp         BlitLineSetup
<a name="l13512"></a>13512 
<a name="l13513"></a>13513 
<a name="l13514"></a>13514 LSSkip1:
<a name="l13515"></a>13515             add         esi, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l13516"></a>13516             sub         ebx, ecx
<a name="l13517"></a>13517             jmp         LeftSkipLoop
<a name="l13518"></a>13518 
<a name="l13519"></a>13519 
<a name="l13520"></a>13520 LSTrans:
<a name="l13521"></a>13521             and         ecx, 07fH
<a name="l13522"></a>13522             cmp         ecx, ebx
<a name="l13523"></a>13523             je          BlitLineSetup                             <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l13524"></a>13524             jb          LSTrans1                                        <span class="comment">// if less, skip whole thing</span>
<a name="l13525"></a>13525 
<a name="l13526"></a>13526             sub         ecx, ebx                                        <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l13527"></a>13527             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, BlitLength
<a name="l13528"></a>13528             jmp         BlitTransparent
<a name="l13529"></a>13529 
<a name="l13530"></a>13530 
<a name="l13531"></a>13531 LSTrans1:
<a name="l13532"></a>13532             sub         ebx, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l13533"></a>13533             jmp         LeftSkipLoop
<a name="l13534"></a>13534 
<a name="l13535"></a>13535 
<a name="l13536"></a>13536 
<a name="l13537"></a>13537 
<a name="l13538"></a>13538 BlitLineSetup:                                                    <span class="comment">// Does any actual blitting (trans/non) for the line</span>
<a name="l13539"></a>13539             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, BlitLength
<a name="l13540"></a>13540             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l13541"></a>13541 
<a name="l13542"></a>13542 BlitDispatch:
<a name="l13543"></a>13543 
<a name="l13544"></a>13544             or          ebx, ebx                                        <span class="comment">// Check to see if we're done blitting</span>
<a name="l13545"></a>13545             jz          RightSkipLoop
<a name="l13546"></a>13546 
<a name="l13547"></a>13547             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l13548"></a>13548             inc         esi
<a name="l13549"></a>13549             or          cl, cl
<a name="l13550"></a>13550             js          BlitTransparent
<a name="l13551"></a>13551 
<a name="l13552"></a>13552 BlitNonTransLoop:
<a name="l13553"></a>13553 
<a name="l13554"></a>13554             cmp         ecx, ebx
<a name="l13555"></a>13555             jbe         BNTrans1
<a name="l13556"></a>13556 
<a name="l13557"></a>13557             sub         ecx, ebx
<a name="l13558"></a>13558             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, ecx
<a name="l13559"></a>13559             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, ebx
<a name="l13560"></a>13560 
<a name="l13561"></a>13561 BNTrans1:
<a name="l13562"></a>13562             sub         ebx, ecx
<a name="l13563"></a>13563 
<a name="l13564"></a>13564             clc
<a name="l13565"></a>13565             rcr         cl, 1
<a name="l13566"></a>13566             jnc         BlitNTL2
<a name="l13567"></a>13567 
<a name="l13568"></a>13568             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [edi]
<a name="l13569"></a>13569             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, [edx+eax*2]
<a name="l13570"></a>13570             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax
<a name="l13571"></a>13571 
<a name="l13572"></a>13572             inc         esi
<a name="l13573"></a>13573             add         edi, 2
<a name="l13574"></a>13574 
<a name="l13575"></a>13575 BlitNTL2:
<a name="l13576"></a>13576             clc
<a name="l13577"></a>13577             rcr         cl, 1
<a name="l13578"></a>13578             jnc         BlitNTL3
<a name="l13579"></a>13579 
<a name="l13580"></a>13580             mov         ax, [edi]
<a name="l13581"></a>13581             mov         ax, [edx+eax*2]
<a name="l13582"></a>13582             mov         [edi], ax
<a name="l13583"></a>13583 
<a name="l13584"></a>13584             mov         ax, [edi+2]
<a name="l13585"></a>13585             mov         ax, [edx+eax*2]
<a name="l13586"></a>13586             mov         [edi+2], ax
<a name="l13587"></a>13587 
<a name="l13588"></a>13588             add         esi, 2
<a name="l13589"></a>13589             add         edi, 4
<a name="l13590"></a>13590 
<a name="l13591"></a>13591 BlitNTL3:
<a name="l13592"></a>13592 
<a name="l13593"></a>13593             or          cl, cl
<a name="l13594"></a>13594             jz          BlitLineEnd
<a name="l13595"></a>13595 
<a name="l13596"></a>13596 BlitNTL4:
<a name="l13597"></a>13597 
<a name="l13598"></a>13598             mov         ax, [edi]
<a name="l13599"></a>13599             mov         ax, [edx+eax*2]
<a name="l13600"></a>13600             mov         [edi], ax
<a name="l13601"></a>13601 
<a name="l13602"></a>13602             mov         ax, [edi+2]
<a name="l13603"></a>13603             mov         ax, [edx+eax*2]
<a name="l13604"></a>13604             mov         [edi+2], ax
<a name="l13605"></a>13605 
<a name="l13606"></a>13606             mov         ax, [edi+4]
<a name="l13607"></a>13607             mov         ax, [edx+eax*2]
<a name="l13608"></a>13608             mov         [edi+4], ax
<a name="l13609"></a>13609 
<a name="l13610"></a>13610             mov         ax, [edi+6]
<a name="l13611"></a>13611             mov         ax, [edx+eax*2]
<a name="l13612"></a>13612             mov         [edi+6], ax
<a name="l13613"></a>13613 
<a name="l13614"></a>13614             add         esi, 4
<a name="l13615"></a>13615             add         edi, 8
<a name="l13616"></a>13616             dec         cl
<a name="l13617"></a>13617             jnz         BlitNTL4
<a name="l13618"></a>13618 
<a name="l13619"></a>13619 BlitLineEnd:
<a name="l13620"></a>13620             add         esi, Unblitted
<a name="l13621"></a>13621             jmp         BlitDispatch
<a name="l13622"></a>13622 
<a name="l13623"></a>13623 BlitTransparent:
<a name="l13624"></a>13624 
<a name="l13625"></a>13625             and         ecx, 07fH
<a name="l13626"></a>13626             cmp         ecx, ebx
<a name="l13627"></a>13627             jbe         BTrans1
<a name="l13628"></a>13628 
<a name="l13629"></a>13629             mov         ecx, ebx
<a name="l13630"></a>13630 
<a name="l13631"></a>13631 BTrans1:
<a name="l13632"></a>13632 
<a name="l13633"></a>13633             sub         ebx, ecx
<a name="l13634"></a>13634 <span class="comment">//          shl         ecx, 1</span>
<a name="l13635"></a>13635             add   ecx, ecx
<a name="l13636"></a>13636             add         edi, ecx
<a name="l13637"></a>13637             jmp         BlitDispatch
<a name="l13638"></a>13638 
<a name="l13639"></a>13639 
<a name="l13640"></a>13640 RightSkipLoop:
<a name="l13641"></a>13641 
<a name="l13642"></a>13642 
<a name="l13643"></a>13643 RSLoop1:
<a name="l13644"></a>13644             mov         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l13645"></a>13645             inc         esi
<a name="l13646"></a>13646             or          al, al
<a name="l13647"></a>13647             jnz         RSLoop1
<a name="l13648"></a>13648 
<a name="l13649"></a>13649             dec         BlitHeight
<a name="l13650"></a>13650             jz          BlitDone
<a name="l13651"></a>13651             add         edi, LineSkip
<a name="l13652"></a>13652 
<a name="l13653"></a>13653             jmp         LeftSkipSetup
<a name="l13654"></a>13654 
<a name="l13655"></a>13655 
<a name="l13656"></a>13656 BlitDone:
<a name="l13657"></a>13657       }
<a name="l13658"></a>13658 
<a name="l13659"></a>13659       <span class="keywordflow">return</span>(TRUE);
<a name="l13660"></a>13660 
<a name="l13661"></a>13661 }
<a name="l13662"></a>13662 
<a name="l13663"></a>13663 
<a name="l13664"></a>13664 
<a name="l13665"></a>13665 <span class="comment">/**********************************************************************************************</span>
<a name="l13666"></a>13666 <span class="comment">      Blt16BPPBufferShadowRect</span>
<a name="l13667"></a>13667 <span class="comment"></span>
<a name="l13668"></a>13668 <span class="comment">            Darkens a rectangular area by 25%. This blitter is used by ShadowVideoObjectRect.</span>
<a name="l13669"></a>13669 <span class="comment"></span>
<a name="l13670"></a>13670 <span class="comment">      pBuffer                                   Pointer to a 16BPP buffer</span>
<a name="l13671"></a>13671 <span class="comment">      uiDestPitchBytes  Pitch of the destination surface</span>
<a name="l13672"></a>13672 <span class="comment">      area                                      An SGPRect, the area to darken</span>
<a name="l13673"></a>13673 <span class="comment"></span>
<a name="l13674"></a>13674 <span class="comment">*********************************************************************************************/</span>
<a name="l13675"></a><a class="code" href="vobject__blitters_8h.html#106d33f3d74d25892da7b0049de0f61d">13675</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#106d33f3d74d25892da7b0049de0f61d">Blt16BPPBufferShadowRect</a>(<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="structSGPRect.html">SGPRect</a> *area)
<a name="l13676"></a>13676 {
<a name="l13677"></a>13677 <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  width, height;
<a name="l13678"></a>13678 <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l13679"></a>13679 <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *DestPtr;
<a name="l13680"></a>13680 
<a name="l13681"></a>13681       <span class="comment">// Assertions</span>
<a name="l13682"></a>13682       Assert( pBuffer != NULL );
<a name="l13683"></a>13683 
<a name="l13684"></a>13684       <span class="comment">// Clipping</span>
<a name="l13685"></a>13685       <span class="keywordflow">if</span>( area-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a> &lt; <a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a> )
<a name="l13686"></a>13686             area-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a> = <a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l13687"></a>13687       <span class="keywordflow">if</span>( area-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a> &lt; <a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a> )
<a name="l13688"></a>13688             area-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a> = <a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l13689"></a>13689       <span class="keywordflow">if</span>( area-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a> &gt;= <a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a> )
<a name="l13690"></a>13690             area-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a> = <a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a> - 1;
<a name="l13691"></a>13691       <span class="keywordflow">if</span>( area-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a> &gt;= <a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a> )
<a name="l13692"></a>13692             area-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a> = <a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a> - 1;
<a name="l13693"></a>13693       <span class="comment">//CHECKF(area-&gt;iLeft &gt;= ClippingRect.iLeft );</span>
<a name="l13694"></a>13694       <span class="comment">//CHECKF(area-&gt;iTop &gt;= ClippingRect.iTop );</span>
<a name="l13695"></a>13695       <span class="comment">//CHECKF(area-&gt;iRight &lt;= ClippingRect.iRight );</span>
<a name="l13696"></a>13696       <span class="comment">//CHECKF(area-&gt;iBottom &lt;= ClippingRect.iBottom );</span>
<a name="l13697"></a>13697 
<a name="l13698"></a>13698       DestPtr=(pBuffer+(area-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>*(uiDestPitchBYTES/2))+area-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>);
<a name="l13699"></a>13699       width=area-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>-area-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>+1;
<a name="l13700"></a>13700       height=area-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>-area-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>+1;
<a name="l13701"></a>13701       LineSkip=(uiDestPitchBYTES-(width*2));
<a name="l13702"></a>13702 
<a name="l13703"></a>13703       CHECKF(width &gt;=1);
<a name="l13704"></a>13704       CHECKF(height &gt;=1);
<a name="l13705"></a>13705 
<a name="l13706"></a>13706       __asm {
<a name="l13707"></a>13707             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, OFFSET <a class="code" href="shading_8cpp.html#fd38e38bdd68f0da44ac96abacf3b2a6">ShadeTable</a>
<a name="l13708"></a>13708             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l13709"></a>13709             xor         eax, eax
<a name="l13710"></a>13710             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, LineSkip
<a name="l13711"></a>13711             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, height
<a name="l13712"></a>13712 
<a name="l13713"></a>13713 BlitNewLine:
<a name="l13714"></a>13714             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, width
<a name="l13715"></a>13715 
<a name="l13716"></a>13716 BlitLine:
<a name="l13717"></a>13717             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [edi]
<a name="l13718"></a>13718             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, [esi+eax*2]
<a name="l13719"></a>13719             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax
<a name="l13720"></a>13720             add         edi, 2
<a name="l13721"></a>13721             dec         ecx
<a name="l13722"></a>13722             jnz         BlitLine
<a name="l13723"></a>13723 
<a name="l13724"></a>13724             add         edi, ebx
<a name="l13725"></a>13725             dec         edx
<a name="l13726"></a>13726             jnz         BlitNewLine
<a name="l13727"></a>13727 }
<a name="l13728"></a>13728 
<a name="l13729"></a>13729       <span class="keywordflow">return</span>(TRUE);
<a name="l13730"></a>13730 }
<a name="l13731"></a>13731 
<a name="l13732"></a>13732 
<a name="l13733"></a>13733 <span class="comment">/**********************************************************************************************</span>
<a name="l13734"></a>13734 <span class="comment">      Blt16BPPBufferShadowRect</span>
<a name="l13735"></a>13735 <span class="comment"></span>
<a name="l13736"></a>13736 <span class="comment">            Darkens a rectangular area by 25%. This blitter is used by ShadowVideoObjectRect.</span>
<a name="l13737"></a>13737 <span class="comment"></span>
<a name="l13738"></a>13738 <span class="comment">      pBuffer                                   Pointer to a 16BPP buffer</span>
<a name="l13739"></a>13739 <span class="comment">      uiDestPitchBytes  Pitch of the destination surface</span>
<a name="l13740"></a>13740 <span class="comment">      area                                      An SGPRect, the area to darken</span>
<a name="l13741"></a>13741 <span class="comment"></span>
<a name="l13742"></a>13742 <span class="comment">*********************************************************************************************/</span>
<a name="l13743"></a><a class="code" href="vsurface_8cpp.html#fd25aaae9b3fd5483ea2bd2e91ef4d5c">13743</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#fd25aaae9b3fd5483ea2bd2e91ef4d5c">Blt16BPPBufferShadowRectAlternateTable</a>(<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="structSGPRect.html">SGPRect</a> *area)
<a name="l13744"></a>13744 {
<a name="l13745"></a>13745 <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  width, height;
<a name="l13746"></a>13746 <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l13747"></a>13747 <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *DestPtr;
<a name="l13748"></a>13748 
<a name="l13749"></a>13749       <span class="comment">// Assertions</span>
<a name="l13750"></a>13750       Assert( pBuffer != NULL );
<a name="l13751"></a>13751 
<a name="l13752"></a>13752       <span class="comment">// Clipping</span>
<a name="l13753"></a>13753       <span class="keywordflow">if</span>( area-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a> &lt; <a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a> )
<a name="l13754"></a>13754             area-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a> = <a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l13755"></a>13755       <span class="keywordflow">if</span>( area-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a> &lt; <a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a> )
<a name="l13756"></a>13756             area-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a> = <a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l13757"></a>13757       <span class="keywordflow">if</span>( area-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a> &gt;= <a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a> )
<a name="l13758"></a>13758             area-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a> = <a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a> - 1;
<a name="l13759"></a>13759       <span class="keywordflow">if</span>( area-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a> &gt;= <a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a> )
<a name="l13760"></a>13760             area-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a> = <a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a> - 1;
<a name="l13761"></a>13761       <span class="comment">//CHECKF(area-&gt;iLeft &gt;= ClippingRect.iLeft );</span>
<a name="l13762"></a>13762       <span class="comment">//CHECKF(area-&gt;iTop &gt;= ClippingRect.iTop );</span>
<a name="l13763"></a>13763       <span class="comment">//CHECKF(area-&gt;iRight &lt;= ClippingRect.iRight );</span>
<a name="l13764"></a>13764       <span class="comment">//CHECKF(area-&gt;iBottom &lt;= ClippingRect.iBottom );</span>
<a name="l13765"></a>13765 
<a name="l13766"></a>13766       DestPtr=(pBuffer+(area-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>*(uiDestPitchBYTES/2))+area-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>);
<a name="l13767"></a>13767       width=area-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>-area-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>+1;
<a name="l13768"></a>13768       height=area-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>-area-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>+1;
<a name="l13769"></a>13769       LineSkip=(uiDestPitchBYTES-(width*2));
<a name="l13770"></a>13770 
<a name="l13771"></a>13771       CHECKF(width &gt;=1);
<a name="l13772"></a>13772       CHECKF(height &gt;=1);
<a name="l13773"></a>13773 
<a name="l13774"></a>13774       __asm {
<a name="l13775"></a>13775             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, OFFSET <a class="code" href="shading_8cpp.html#7eb13b22491f30a4399f492394327161">IntensityTable</a>
<a name="l13776"></a>13776             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l13777"></a>13777             xor         eax, eax
<a name="l13778"></a>13778             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, LineSkip
<a name="l13779"></a>13779             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, height
<a name="l13780"></a>13780 
<a name="l13781"></a>13781 BlitNewLine:
<a name="l13782"></a>13782             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, width
<a name="l13783"></a>13783 
<a name="l13784"></a>13784 BlitLine:
<a name="l13785"></a>13785             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [edi]
<a name="l13786"></a>13786             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, [esi+eax*2]
<a name="l13787"></a>13787             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax
<a name="l13788"></a>13788             add         edi, 2
<a name="l13789"></a>13789             dec         ecx
<a name="l13790"></a>13790             jnz         BlitLine
<a name="l13791"></a>13791 
<a name="l13792"></a>13792             add         edi, ebx
<a name="l13793"></a>13793             dec         edx
<a name="l13794"></a>13794             jnz         BlitNewLine
<a name="l13795"></a>13795 }
<a name="l13796"></a>13796 
<a name="l13797"></a>13797       <span class="keywordflow">return</span>(TRUE);
<a name="l13798"></a>13798 }
<a name="l13799"></a>13799 
<a name="l13800"></a>13800 
<a name="l13801"></a>13801 <span class="comment">/**********************************************************************************************</span>
<a name="l13802"></a>13802 <span class="comment"> Blt8BPPDataTo16BPPBufferMonoShadow</span>
<a name="l13803"></a>13803 <span class="comment"></span>
<a name="l13804"></a>13804 <span class="comment">      Uses a bitmap an 8BPP template for blitting. Anywhere a 1 appears in the bitmap, a shadow</span>
<a name="l13805"></a>13805 <span class="comment">      is blitted to the destination (a black pixel). Any other value above zero is considered a</span>
<a name="l13806"></a>13806 <span class="comment">      forground color, and zero is background. If the parameter for the background color is zero,</span>
<a name="l13807"></a>13807 <span class="comment">      transparency is used for the background.</span>
<a name="l13808"></a>13808 <span class="comment"></span>
<a name="l13809"></a>13809 <span class="comment">**********************************************************************************************/</span>
<a name="l13810"></a><a class="code" href="vobject__blitters_8cpp.html#bd8cb7b42361b5e1a15f327d0b4a8474">13810</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#bd8cb7b42361b5e1a15f327d0b4a8474">Blt8BPPDataTo16BPPBufferMonoShadow</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usForeground, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usBackground)
<a name="l13811"></a>13811 {
<a name="l13812"></a>13812       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l13813"></a>13813       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l13814"></a>13814       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth;
<a name="l13815"></a>13815       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr;
<a name="l13816"></a>13816       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l13817"></a>13817       <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l13818"></a>13818       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l13819"></a>13819 
<a name="l13820"></a>13820 
<a name="l13821"></a>13821       <span class="comment">// Assertions</span>
<a name="l13822"></a>13822       Assert( hSrcVObject != NULL );
<a name="l13823"></a>13823       Assert( pBuffer != NULL );
<a name="l13824"></a>13824 
<a name="l13825"></a>13825       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l13826"></a>13826       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l13827"></a>13827       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l13828"></a>13828       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l13829"></a>13829       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l13830"></a>13830 
<a name="l13831"></a>13831       <span class="comment">// Add to start position of dest buffer</span>
<a name="l13832"></a>13832       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l13833"></a>13833       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l13834"></a>13834 
<a name="l13835"></a>13835       <span class="comment">// Validations</span>
<a name="l13836"></a>13836       CHECKF( iTempX &gt;= 0 );
<a name="l13837"></a>13837       CHECKF( iTempY &gt;= 0 );
<a name="l13838"></a>13838 
<a name="l13839"></a>13839 
<a name="l13840"></a>13840       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l13841"></a>13841       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l13842"></a>13842       p16BPPPalette = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#930609ad8d5cdbb05449df70bd83cfcd">pShadeCurrent</a>;
<a name="l13843"></a>13843       LineSkip=(uiDestPitchBYTES-(usWidth*2));
<a name="l13844"></a>13844 
<a name="l13845"></a>13845       __asm {
<a name="l13846"></a>13846 
<a name="l13847"></a>13847             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l13848"></a>13848             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l13849"></a>13849             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, p16BPPPalette
<a name="l13850"></a>13850             xor         eax, eax
<a name="l13851"></a>13851             xor         ebx, ebx
<a name="l13852"></a>13852             xor         ecx, ecx
<a name="l13853"></a>13853 
<a name="l13854"></a>13854 BlitDispatch:
<a name="l13855"></a>13855 
<a name="l13856"></a>13856             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l13857"></a>13857             inc         esi
<a name="l13858"></a>13858             or          cl, cl
<a name="l13859"></a>13859             js          BlitTransparent
<a name="l13860"></a>13860             jz          BlitDoneLine
<a name="l13861"></a>13861 
<a name="l13862"></a>13862 <span class="comment">//BlitNonTransLoop:</span>
<a name="l13863"></a>13863 
<a name="l13864"></a>13864             xor         ebx, ebx
<a name="l13865"></a>13865 
<a name="l13866"></a>13866 BlitNTL4:
<a name="l13867"></a>13867 
<a name="l13868"></a>13868             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         bl, [esi]
<a name="l13869"></a>13869             cmp         bl, 1
<a name="l13870"></a>13870             jb          BlitNTL5
<a name="l13871"></a>13871 
<a name="l13872"></a>13872             <span class="comment">// write a black shadow</span>
<a name="l13873"></a>13873             xor         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, ax
<a name="l13874"></a>13874             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax
<a name="l13875"></a>13875 
<a name="l13876"></a>13876             inc         esi
<a name="l13877"></a>13877             add         edi, 2
<a name="l13878"></a>13878             dec         cl
<a name="l13879"></a>13879             jnz         BlitNTL4
<a name="l13880"></a>13880 
<a name="l13881"></a>13881             jmp         BlitDispatch
<a name="l13882"></a>13882 
<a name="l13883"></a>13883 BlitNTL5:
<a name="l13884"></a>13884             or          bl, bl
<a name="l13885"></a>13885             jz          <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>
<a name="l13886"></a>13886 
<a name="l13887"></a>13887             mov         ax, usForeground
<a name="l13888"></a>13888             mov         [edi], ax
<a name="l13889"></a>13889 
<a name="l13890"></a>13890             inc         esi
<a name="l13891"></a>13891             add         edi, 2
<a name="l13892"></a>13892             dec         cl
<a name="l13893"></a>13893             jnz         BlitNTL4
<a name="l13894"></a>13894 
<a name="l13895"></a>13895             jmp         BlitDispatch
<a name="l13896"></a>13896 
<a name="l13897"></a>13897 <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>:
<a name="l13898"></a>13898             cmp         usBackground, 0
<a name="l13899"></a>13899             je          <a class="code" href="vobject__blitters_8cpp.html#d660d2ba340c8ef5d2d80c6365ad838f">BlitNTL7</a>
<a name="l13900"></a>13900 
<a name="l13901"></a>13901             mov         ax, usBackground
<a name="l13902"></a>13902             mov         [edi], ax
<a name="l13903"></a>13903 
<a name="l13904"></a>13904 <a class="code" href="vobject__blitters_8cpp.html#d660d2ba340c8ef5d2d80c6365ad838f">BlitNTL7</a>:
<a name="l13905"></a>13905             inc         esi
<a name="l13906"></a>13906             add         edi, 2
<a name="l13907"></a>13907             dec         cl
<a name="l13908"></a>13908             jnz         BlitNTL4
<a name="l13909"></a>13909 
<a name="l13910"></a>13910             jmp         BlitDispatch
<a name="l13911"></a>13911 
<a name="l13912"></a>13912 BlitTransparent:
<a name="l13913"></a>13913             and         ecx, 07fH
<a name="l13914"></a>13914 
<a name="l13915"></a>13915             mov         ax, usBackground
<a name="l13916"></a>13916             or          ax, ax
<a name="l13917"></a>13917             jz          BTrans1
<a name="l13918"></a>13918 
<a name="l13919"></a>13919             rep         stosw
<a name="l13920"></a>13920             jmp         BlitDispatch
<a name="l13921"></a>13921 
<a name="l13922"></a>13922 BTrans1:
<a name="l13923"></a>13923 <span class="comment">//          shl         ecx, 1</span>
<a name="l13924"></a>13924             add   ecx, ecx
<a name="l13925"></a>13925             add         edi, ecx
<a name="l13926"></a>13926             jmp         BlitDispatch
<a name="l13927"></a>13927 
<a name="l13928"></a>13928 
<a name="l13929"></a>13929 BlitDoneLine:
<a name="l13930"></a>13930 
<a name="l13931"></a>13931             dec         usHeight
<a name="l13932"></a>13932             jz          BlitDone
<a name="l13933"></a>13933             add         edi, LineSkip
<a name="l13934"></a>13934             jmp         BlitDispatch
<a name="l13935"></a>13935 
<a name="l13936"></a>13936 
<a name="l13937"></a>13937 BlitDone:
<a name="l13938"></a>13938       }
<a name="l13939"></a>13939 
<a name="l13940"></a>13940       <span class="keywordflow">return</span>(TRUE);
<a name="l13941"></a>13941 
<a name="l13942"></a>13942 }
<a name="l13943"></a>13943 
<a name="l13944"></a>13944 <span class="comment">/*</span>
<a name="l13945"></a>13945 <span class="comment">BOOLEAN Blt8BPPDataTo16BPPBufferFullTransparent( HVOBJECT hDestVObject, HVOBJECT hSrcVObject, UINT16 usX, UINT16 usY, SGPRect *srcRect )</span>
<a name="l13946"></a>13946 <span class="comment">{</span>
<a name="l13947"></a>13947 <span class="comment">      UINT32 uiSrcStart, uiDestStart, uiNumLines, uiLineSize;</span>
<a name="l13948"></a>13948 <span class="comment">//    UINT32 rows, cols;</span>
<a name="l13949"></a>13949 <span class="comment">      UINT8 *pSrc; //, *pSrcTemp;</span>
<a name="l13950"></a>13950 <span class="comment">      UINT16 *pDest; //*pDestTemp,</span>
<a name="l13951"></a>13951 <span class="comment">      UINT32      uiSrcPitch, uiDestPitch;</span>
<a name="l13952"></a>13952 <span class="comment">      UINT16 *p16BPPPalette;</span>
<a name="l13953"></a>13953 <span class="comment">      UINT16 usEffectiveSrcWidth;</span>
<a name="l13954"></a>13954 <span class="comment">      UINT16 usEffectiveDestWidth;</span>
<a name="l13955"></a>13955 <span class="comment">      UINT16 us16BPPSrcTransColor;</span>
<a name="l13956"></a>13956 <span class="comment">      UINT16 us16BPPDestTransColor;</span>
<a name="l13957"></a>13957 <span class="comment">//    UINT16 us16BPPValue;</span>
<a name="l13958"></a>13958 <span class="comment">      UINT32 count;</span>
<a name="l13959"></a>13959 <span class="comment">      UINT8  maskcolor;</span>
<a name="l13960"></a>13960 <span class="comment"></span>
<a name="l13961"></a>13961 <span class="comment">      // Assertions</span>
<a name="l13962"></a>13962 <span class="comment">      Assert( hSrcVObject != NULL );</span>
<a name="l13963"></a>13963 <span class="comment">      Assert( hDestVObject != NULL );</span>
<a name="l13964"></a>13964 <span class="comment"></span>
<a name="l13965"></a>13965 <span class="comment">      // Validations</span>
<a name="l13966"></a>13966 <span class="comment">      CHECKF( usX &gt;= 0 );</span>
<a name="l13967"></a>13967 <span class="comment">      CHECKF( usY &gt;= 0 );</span>
<a name="l13968"></a>13968 <span class="comment">      CHECKF( srcRect-&gt;iRight &gt; srcRect-&gt;iLeft );</span>
<a name="l13969"></a>13969 <span class="comment">      CHECKF( srcRect-&gt;iBottom &gt; srcRect-&gt;iTop );</span>
<a name="l13970"></a>13970 <span class="comment"></span>
<a name="l13971"></a>13971 <span class="comment">      p16BPPPalette = hSrcVObject-&gt;p16BPPPalette;</span>
<a name="l13972"></a>13972 <span class="comment">      CHECKF( p16BPPPalette != NULL );</span>
<a name="l13973"></a>13973 <span class="comment"></span>
<a name="l13974"></a>13974 <span class="comment">      // Lock Data</span>
<a name="l13975"></a>13975 <span class="comment">      pSrc = LockVideoObjectBuffer( hSrcVObject, &amp;uiSrcPitch );</span>
<a name="l13976"></a>13976 <span class="comment"></span>
<a name="l13977"></a>13977 <span class="comment">      // Effective width ( in PIXELS ) is Pitch ( in bytes ) converted to pitch ( IN PIXELS )</span>
<a name="l13978"></a>13978 <span class="comment">      usEffectiveSrcWidth = (UINT16)( uiSrcPitch / ( hSrcVObject-&gt;ubBitDepth / 8 ) );</span>
<a name="l13979"></a>13979 <span class="comment"></span>
<a name="l13980"></a>13980 <span class="comment">      pDest = (UINT16*)LockVideoObjectBuffer( hDestVObject, &amp;uiDestPitch );</span>
<a name="l13981"></a>13981 <span class="comment"></span>
<a name="l13982"></a>13982 <span class="comment">      // Effective width ( in PIXELS ) is Pitch ( in bytes ) converted to pitch ( IN PIXELS )</span>
<a name="l13983"></a>13983 <span class="comment">      usEffectiveDestWidth = (UINT16)( uiDestPitch / ( hDestVObject-&gt;ubBitDepth / 8 ) );</span>
<a name="l13984"></a>13984 <span class="comment"></span>
<a name="l13985"></a>13985 <span class="comment">      // Determine memcopy coordinates</span>
<a name="l13986"></a>13986 <span class="comment">      uiSrcStart = srcRect-&gt;iTop * usEffectiveSrcWidth + srcRect-&gt;iLeft;</span>
<a name="l13987"></a>13987 <span class="comment">      uiDestStart = usY * usEffectiveDestWidth + usX;</span>
<a name="l13988"></a>13988 <span class="comment">      uiNumLines = ( srcRect-&gt;iBottom - srcRect-&gt;iTop );</span>
<a name="l13989"></a>13989 <span class="comment">      uiLineSize = ( srcRect-&gt;iRight - srcRect-&gt;iLeft );</span>
<a name="l13990"></a>13990 <span class="comment"></span>
<a name="l13991"></a>13991 <span class="comment">      CHECKF( hDestVObject-&gt;usWidth &gt;= uiLineSize );</span>
<a name="l13992"></a>13992 <span class="comment">      CHECKF( hDestVObject-&gt;usHeight &gt;= uiNumLines );</span>
<a name="l13993"></a>13993 <span class="comment"></span>
<a name="l13994"></a>13994 <span class="comment">      // Find 16 BPP transparent color</span>
<a name="l13995"></a>13995 <span class="comment">      us16BPPSrcTransColor = Get16BPPColor( hSrcVObject-&gt;TransparentColor );</span>
<a name="l13996"></a>13996 <span class="comment">      for(count=0; (count &lt; 256) &amp;&amp; (p16BPPPalette[count]!=us16BPPSrcTransColor); count++);</span>
<a name="l13997"></a>13997 <span class="comment"></span>
<a name="l13998"></a>13998 <span class="comment">      if(count==256)</span>
<a name="l13999"></a>13999 <span class="comment">      {</span>
<a name="l14000"></a>14000 <span class="comment">            DebugMsg(TOPIC_VIDEOOBJECT, DBG_LEVEL_2, String( "Transparency color does not exist in palette table for source object" ));</span>
<a name="l14001"></a>14001 <span class="comment">            maskcolor=0;</span>
<a name="l14002"></a>14002 <span class="comment">      }</span>
<a name="l14003"></a>14003 <span class="comment">      else</span>
<a name="l14004"></a>14004 <span class="comment">                  maskcolor=(UINT8)count;</span>
<a name="l14005"></a>14005 <span class="comment"></span>
<a name="l14006"></a>14006 <span class="comment">      us16BPPDestTransColor = Get16BPPColor( hDestVObject-&gt;TransparentColor );</span>
<a name="l14007"></a>14007 <span class="comment"></span>
<a name="l14008"></a>14008 <span class="comment">      // Convert to Pixel specification</span>
<a name="l14009"></a>14009 <span class="comment">      pDest = pDest + uiDestStart;</span>
<a name="l14010"></a>14010 <span class="comment">      pSrc =  pSrc + uiSrcStart;</span>
<a name="l14011"></a>14011 <span class="comment"></span>
<a name="l14012"></a>14012 <span class="comment">      __asm {</span>
<a name="l14013"></a>14013 <span class="comment">            mov         esi, pSrc                                 // pointer to current line start address in source</span>
<a name="l14014"></a>14014 <span class="comment">            mov         edi, pDest                          // pointer to current line start address in destination</span>
<a name="l14015"></a>14015 <span class="comment">            mov         ecx, uiNumLines               // line counter (goes top to bottom)</span>
<a name="l14016"></a>14016 <span class="comment">            mov         edx, p16BPPPalette</span>
<a name="l14017"></a>14017 <span class="comment"></span>
<a name="l14018"></a>14018 <span class="comment">            mov         ebx, uiLineSize               // column counter (goes right to left)</span>
<a name="l14019"></a>14019 <span class="comment">            dec         ebx</span>
<a name="l14020"></a>14020 <span class="comment"></span>
<a name="l14021"></a>14021 <span class="comment">ReadMask:</span>
<a name="l14022"></a>14022 <span class="comment">            mov         ax, [edi+ebx*2]</span>
<a name="l14023"></a>14023 <span class="comment">            cmp         ax, us16BPPDestTransColor</span>
<a name="l14024"></a>14024 <span class="comment">            je          NextColumn</span>
<a name="l14025"></a>14025 <span class="comment">            xor         eax, eax                                  // clear out the top 24 bits</span>
<a name="l14026"></a>14026 <span class="comment">            mov         al, [esi+ebx]</span>
<a name="l14027"></a>14027 <span class="comment">            cmp         al, maskcolor</span>
<a name="l14028"></a>14028 <span class="comment">            je          NextColumn</span>
<a name="l14029"></a>14029 <span class="comment"></span>
<a name="l14030"></a>14030 <span class="comment">            shl         eax, 1                                          // make it into a word index</span>
<a name="l14031"></a>14031 <span class="comment">            mov         ax, [edx+eax]                       // get 16-bit version of 8-bit pixel</span>
<a name="l14032"></a>14032 <span class="comment">            mov         [edi+ebx*2], ax</span>
<a name="l14033"></a>14033 <span class="comment"></span>
<a name="l14034"></a>14034 <span class="comment">NextColumn:</span>
<a name="l14035"></a>14035 <span class="comment">            dec         ebx                                                   // decrement column counter</span>
<a name="l14036"></a>14036 <span class="comment">            jns         ReadMask                                  // loop until one line is done</span>
<a name="l14037"></a>14037 <span class="comment"></span>
<a name="l14038"></a>14038 <span class="comment">            dec         ecx                                                   // check line counter</span>
<a name="l14039"></a>14039 <span class="comment">            jz          DoneBlit                                  // done blitting, exit</span>
<a name="l14040"></a>14040 <span class="comment"></span>
<a name="l14041"></a>14041 <span class="comment">            add         esi, uiSrcPitch               // move line pointers down one line</span>
<a name="l14042"></a>14042 <span class="comment">            add         edi, uiDestPitch</span>
<a name="l14043"></a>14043 <span class="comment">            mov         ebx, uiLineSize               // column counter (goes right to left)</span>
<a name="l14044"></a>14044 <span class="comment">            dec         ebx</span>
<a name="l14045"></a>14045 <span class="comment">            jmp         ReadMask                                  // back into blitting on next line</span>
<a name="l14046"></a>14046 <span class="comment"></span>
<a name="l14047"></a>14047 <span class="comment">DoneBlit:                                                               // finished blit</span>
<a name="l14048"></a>14048 <span class="comment">            }</span>
<a name="l14049"></a>14049 <span class="comment"></span>
<a name="l14050"></a>14050 <span class="comment">      ReleaseVideoObjectBuffer( hSrcVObject );</span>
<a name="l14051"></a>14051 <span class="comment">      ReleaseVideoObjectBuffer( hDestVObject );</span>
<a name="l14052"></a>14052 <span class="comment"></span>
<a name="l14053"></a>14053 <span class="comment">      return( TRUE );</span>
<a name="l14054"></a>14054 <span class="comment"></span>
<a name="l14055"></a>14055 <span class="comment">}     */</span>
<a name="l14056"></a>14056 
<a name="l14057"></a>14057 
<a name="l14058"></a>14058 
<a name="l14059"></a>14059 
<a name="l14060"></a>14060 <span class="comment">// UTILITY FUNCTIONS FOR BLITTING</span>
<a name="l14061"></a>14061 <span class="comment">/*</span>
<a name="l14062"></a>14062 <span class="comment">BOOLEAN ClipReleatedSrcAndDestRectangles( HVOBJECT hDestVObject, HVOBJECT hSrcVObject, RECT *DestRect, RECT *SrcRect )</span>
<a name="l14063"></a>14063 <span class="comment">{</span>
<a name="l14064"></a>14064 <span class="comment"></span>
<a name="l14065"></a>14065 <span class="comment">      Assert( hDestVObject != NULL );</span>
<a name="l14066"></a>14066 <span class="comment">      Assert( hSrcVObject != NULL );</span>
<a name="l14067"></a>14067 <span class="comment"></span>
<a name="l14068"></a>14068 <span class="comment">      // Check for invalid start positions and clip by ignoring blit</span>
<a name="l14069"></a>14069 <span class="comment">      if ( DestRect-&gt;iLeft &gt;= hDestVObject-&gt;usWidth || DestRect-&gt;iTop &gt;= hDestVObject-&gt;usHeight )</span>
<a name="l14070"></a>14070 <span class="comment">      {</span>
<a name="l14071"></a>14071 <span class="comment">            return( FALSE );</span>
<a name="l14072"></a>14072 <span class="comment">      }</span>
<a name="l14073"></a>14073 <span class="comment"></span>
<a name="l14074"></a>14074 <span class="comment">      if ( SrcRect-&gt;iLeft &gt;= hSrcVObject-&gt;usWidth || SrcRect-&gt;iTop &gt;= hSrcVObject-&gt;usHeight )</span>
<a name="l14075"></a>14075 <span class="comment">      {</span>
<a name="l14076"></a>14076 <span class="comment">            return( FALSE );</span>
<a name="l14077"></a>14077 <span class="comment">      }</span>
<a name="l14078"></a>14078 <span class="comment"></span>
<a name="l14079"></a>14079 <span class="comment">      // For overruns</span>
<a name="l14080"></a>14080 <span class="comment">      // Clip destination rectangles</span>
<a name="l14081"></a>14081 <span class="comment">      if ( DestRect-&gt;iRight &gt; hDestVObject-&gt;usWidth )</span>
<a name="l14082"></a>14082 <span class="comment">      {</span>
<a name="l14083"></a>14083 <span class="comment">            // Both have to be modified or by default streching occurs</span>
<a name="l14084"></a>14084 <span class="comment">            DestRect-&gt;iRight = hDestVObject-&gt;usWidth;</span>
<a name="l14085"></a>14085 <span class="comment">            SrcRect-&gt;iRight = SrcRect-&gt;iLeft + ( DestRect-&gt;iRight - DestRect-&gt;iLeft );</span>
<a name="l14086"></a>14086 <span class="comment">      }</span>
<a name="l14087"></a>14087 <span class="comment">      if ( DestRect-&gt;iBottom &gt; hDestVObject-&gt;usHeight )</span>
<a name="l14088"></a>14088 <span class="comment">      {</span>
<a name="l14089"></a>14089 <span class="comment">            // Both have to be modified or by default streching occurs</span>
<a name="l14090"></a>14090 <span class="comment">            DestRect-&gt;iBottom = hDestVObject-&gt;usHeight;</span>
<a name="l14091"></a>14091 <span class="comment">            SrcRect-&gt;iBottom = SrcRect-&gt;iTop + ( DestRect-&gt;iBottom - DestRect-&gt;iTop );</span>
<a name="l14092"></a>14092 <span class="comment">      }</span>
<a name="l14093"></a>14093 <span class="comment"></span>
<a name="l14094"></a>14094 <span class="comment">      // Clip src rectangles</span>
<a name="l14095"></a>14095 <span class="comment">      if ( SrcRect-&gt;iRight &gt; hSrcVObject-&gt;usWidth )</span>
<a name="l14096"></a>14096 <span class="comment">      {</span>
<a name="l14097"></a>14097 <span class="comment">            // Both have to be modified or by default streching occurs</span>
<a name="l14098"></a>14098 <span class="comment">            SrcRect-&gt;iRight = hSrcVObject-&gt;usWidth;</span>
<a name="l14099"></a>14099 <span class="comment">            DestRect-&gt;iRight = DestRect-&gt;iLeft  + ( SrcRect-&gt;iRight - SrcRect-&gt;iLeft );</span>
<a name="l14100"></a>14100 <span class="comment">      }</span>
<a name="l14101"></a>14101 <span class="comment">      if ( SrcRect-&gt;iBottom &gt; hSrcVObject-&gt;usHeight )</span>
<a name="l14102"></a>14102 <span class="comment">      {</span>
<a name="l14103"></a>14103 <span class="comment">            // Both have to be modified or by default streching occurs</span>
<a name="l14104"></a>14104 <span class="comment">            SrcRect-&gt;iBottom = hSrcVObject-&gt;usHeight;</span>
<a name="l14105"></a>14105 <span class="comment">            DestRect-&gt;iBottom = DestRect-&gt;iTop + ( SrcRect-&gt;iBottom - SrcRect-&gt;iTop );</span>
<a name="l14106"></a>14106 <span class="comment">      }</span>
<a name="l14107"></a>14107 <span class="comment"></span>
<a name="l14108"></a>14108 <span class="comment">      // For underruns</span>
<a name="l14109"></a>14109 <span class="comment">      // Clip destination rectangles</span>
<a name="l14110"></a>14110 <span class="comment">      if ( DestRect-&gt;iLeft &lt; 0 )</span>
<a name="l14111"></a>14111 <span class="comment">      {</span>
<a name="l14112"></a>14112 <span class="comment">            // Both have to be modified or by default streching occurs</span>
<a name="l14113"></a>14113 <span class="comment">            DestRect-&gt;iLeft = 0;</span>
<a name="l14114"></a>14114 <span class="comment">            SrcRect-&gt;iLeft = SrcRect-&gt;iRight - ( DestRect-&gt;iRight - DestRect-&gt;iLeft );</span>
<a name="l14115"></a>14115 <span class="comment">      }</span>
<a name="l14116"></a>14116 <span class="comment">      if ( DestRect-&gt;iTop &lt; 0 )</span>
<a name="l14117"></a>14117 <span class="comment">      {</span>
<a name="l14118"></a>14118 <span class="comment">            // Both have to be modified or by default streching occurs</span>
<a name="l14119"></a>14119 <span class="comment">            DestRect-&gt;iTop = 0;</span>
<a name="l14120"></a>14120 <span class="comment">            SrcRect-&gt;iTop = SrcRect-&gt;iBottom - ( DestRect-&gt;iBottom - DestRect-&gt;iTop );</span>
<a name="l14121"></a>14121 <span class="comment">      }</span>
<a name="l14122"></a>14122 <span class="comment"></span>
<a name="l14123"></a>14123 <span class="comment">      // Clip src rectangles</span>
<a name="l14124"></a>14124 <span class="comment">      if ( SrcRect-&gt;iLeft &lt; 0 )</span>
<a name="l14125"></a>14125 <span class="comment">      {</span>
<a name="l14126"></a>14126 <span class="comment">            // Both have to be modified or by default streching occurs</span>
<a name="l14127"></a>14127 <span class="comment">            SrcRect-&gt;iLeft = 0;</span>
<a name="l14128"></a>14128 <span class="comment">            DestRect-&gt;iLeft = DestRect-&gt;iRight  - ( SrcRect-&gt;iRight - SrcRect-&gt;iLeft );</span>
<a name="l14129"></a>14129 <span class="comment">      }</span>
<a name="l14130"></a>14130 <span class="comment">      if ( SrcRect-&gt;iTop &lt; 0 )</span>
<a name="l14131"></a>14131 <span class="comment">      {</span>
<a name="l14132"></a>14132 <span class="comment">            // Both have to be modified or by default streching occurs</span>
<a name="l14133"></a>14133 <span class="comment">            SrcRect-&gt;iTop = 0;</span>
<a name="l14134"></a>14134 <span class="comment">            DestRect-&gt;iTop = DestRect-&gt;iBottom - ( SrcRect-&gt;iBottom - SrcRect-&gt;iTop );</span>
<a name="l14135"></a>14135 <span class="comment">      }</span>
<a name="l14136"></a>14136 <span class="comment"></span>
<a name="l14137"></a>14137 <span class="comment">      return( TRUE );</span>
<a name="l14138"></a>14138 <span class="comment">}</span>
<a name="l14139"></a>14139 <span class="comment"></span>
<a name="l14140"></a>14140 <span class="comment"></span>
<a name="l14141"></a>14141 <span class="comment">BOOLEAN FillSurface( HVOBJECT hDestVObject, blt_fx *pBltFx )</span>
<a name="l14142"></a>14142 <span class="comment">{</span>
<a name="l14143"></a>14143 <span class="comment">      DDBLTFX                        BlitterFX;</span>
<a name="l14144"></a>14144 <span class="comment"></span>
<a name="l14145"></a>14145 <span class="comment">      Assert( hDestVObject != NULL );</span>
<a name="l14146"></a>14146 <span class="comment">      CHECKF( pBltFx != NULL );</span>
<a name="l14147"></a>14147 <span class="comment"></span>
<a name="l14148"></a>14148 <span class="comment">      BlitterFX.dwSize = sizeof( DDBLTFX );</span>
<a name="l14149"></a>14149 <span class="comment">      BlitterFX.dwFillColor = pBltFx-&gt;ColorFill;</span>
<a name="l14150"></a>14150 <span class="comment"></span>
<a name="l14151"></a>14151 <span class="comment">      DDBltSurface( (LPDIRECTDRAWSURFACE2)hDestVObject-&gt;pSurfaceData, NULL, NULL, NULL, DDBLT_COLORFILL, &amp;BlitterFX );</span>
<a name="l14152"></a>14152 <span class="comment"></span>
<a name="l14153"></a>14153 <span class="comment">      if ( hDestVObject-&gt;fFlags &amp; VOBJECT_VIDEO_MEM_USAGE &amp;&amp; !hDestVObject-&gt;fFlags &amp; VOBJECT_RESERVED_SURFACE )</span>
<a name="l14154"></a>14154 <span class="comment">      {</span>
<a name="l14155"></a>14155 <span class="comment">            UpdateBackupSurface( hDestVObject );</span>
<a name="l14156"></a>14156 <span class="comment">      }</span>
<a name="l14157"></a>14157 <span class="comment"></span>
<a name="l14158"></a>14158 <span class="comment">      return( TRUE );</span>
<a name="l14159"></a>14159 <span class="comment">}</span>
<a name="l14160"></a>14160 <span class="comment"></span>
<a name="l14161"></a>14161 <span class="comment">BOOLEAN FillSurfaceRect( HVOBJECT hDestVObject, blt_fx *pBltFx )</span>
<a name="l14162"></a>14162 <span class="comment">{</span>
<a name="l14163"></a>14163 <span class="comment">      DDBLTFX                        BlitterFX;</span>
<a name="l14164"></a>14164 <span class="comment"></span>
<a name="l14165"></a>14165 <span class="comment">      Assert( hDestVObject != NULL );</span>
<a name="l14166"></a>14166 <span class="comment">      CHECKF( pBltFx != NULL );</span>
<a name="l14167"></a>14167 <span class="comment"></span>
<a name="l14168"></a>14168 <span class="comment">      BlitterFX.dwSize = sizeof( DDBLTFX );</span>
<a name="l14169"></a>14169 <span class="comment">      BlitterFX.dwFillColor = pBltFx-&gt;ColorFill;</span>
<a name="l14170"></a>14170 <span class="comment"></span>
<a name="l14171"></a>14171 <span class="comment">      DDBltSurface( (LPDIRECTDRAWSURFACE2)hDestVObject-&gt;pSurfaceData, (LPRECT)&amp;(pBltFx-&gt;FillRect), NULL, NULL, DDBLT_COLORFILL, &amp;BlitterFX );</span>
<a name="l14172"></a>14172 <span class="comment"></span>
<a name="l14173"></a>14173 <span class="comment">      if ( hDestVObject-&gt;fFlags &amp; VOBJECT_VIDEO_MEM_USAGE &amp;&amp; !hDestVObject-&gt;fFlags &amp; VOBJECT_RESERVED_SURFACE )</span>
<a name="l14174"></a>14174 <span class="comment">      {</span>
<a name="l14175"></a>14175 <span class="comment">            UpdateBackupSurface( hDestVObject );</span>
<a name="l14176"></a>14176 <span class="comment">      }</span>
<a name="l14177"></a>14177 <span class="comment"></span>
<a name="l14178"></a>14178 <span class="comment">      return( TRUE );</span>
<a name="l14179"></a>14179 <span class="comment">}</span>
<a name="l14180"></a>14180 <span class="comment"></span>
<a name="l14181"></a>14181 <span class="comment"></span>
<a name="l14182"></a>14182 <span class="comment">BOOLEAN BltVObjectUsingDD( HVOBJECT hDestVObject, HVOBJECT hSrcVObject, UINT32 fBltFlags, INT32 iDestX, INT32 iDestY, RECT *SrcRect )</span>
<a name="l14183"></a>14183 <span class="comment">{</span>
<a name="l14184"></a>14184 <span class="comment">      UINT32            uiDDFlags;</span>
<a name="l14185"></a>14185 <span class="comment">      RECT              DestRect;</span>
<a name="l14186"></a>14186 <span class="comment"></span>
<a name="l14187"></a>14187 <span class="comment">  // Blit using the correct blitter</span>
<a name="l14188"></a>14188 <span class="comment">      if ( fBltFlags &amp; VO_BLT_FAST )</span>
<a name="l14189"></a>14189 <span class="comment">      {</span>
<a name="l14190"></a>14190 <span class="comment"></span>
<a name="l14191"></a>14191 <span class="comment">            // Validations</span>
<a name="l14192"></a>14192 <span class="comment">            CHECKF( iDestX &gt;= 0 );</span>
<a name="l14193"></a>14193 <span class="comment">            CHECKF( iDestY &gt;= 0 );</span>
<a name="l14194"></a>14194 <span class="comment"></span>
<a name="l14195"></a>14195 <span class="comment">            // Default flags</span>
<a name="l14196"></a>14196 <span class="comment">            uiDDFlags = 0;</span>
<a name="l14197"></a>14197 <span class="comment"></span>
<a name="l14198"></a>14198 <span class="comment">            // Convert flags into DD flags, ( for transparency use, etc )</span>
<a name="l14199"></a>14199 <span class="comment">            if ( fBltFlags &amp; VO_BLT_USECOLORKEY )</span>
<a name="l14200"></a>14200 <span class="comment">            {</span>
<a name="l14201"></a>14201 <span class="comment">                  uiDDFlags != DDBLTFAST_SRCCOLORKEY;</span>
<a name="l14202"></a>14202 <span class="comment">            }</span>
<a name="l14203"></a>14203 <span class="comment"></span>
<a name="l14204"></a>14204 <span class="comment">            // Convert flags into DD flags, ( for transparency use, etc )</span>
<a name="l14205"></a>14205 <span class="comment">            if ( fBltFlags &amp; VO_BLT_USEDESTCOLORKEY )</span>
<a name="l14206"></a>14206 <span class="comment">            {</span>
<a name="l14207"></a>14207 <span class="comment">                  uiDDFlags != DDBLTFAST_DESTCOLORKEY;</span>
<a name="l14208"></a>14208 <span class="comment">            }</span>
<a name="l14209"></a>14209 <span class="comment"></span>
<a name="l14210"></a>14210 <span class="comment">            if ( uiDDFlags == 0 )</span>
<a name="l14211"></a>14211 <span class="comment">            {</span>
<a name="l14212"></a>14212 <span class="comment">                  // Default here is no colorkey</span>
<a name="l14213"></a>14213 <span class="comment">                  uiDDFlags = DDBLTFAST_NOCOLORKEY;</span>
<a name="l14214"></a>14214 <span class="comment">            }</span>
<a name="l14215"></a>14215 <span class="comment"></span>
<a name="l14216"></a>14216 <span class="comment">            DDBltFastSurface( (LPDIRECTDRAWSURFACE2)hDestVObject-&gt;pSurfaceData, iDestX, iDestY, (LPDIRECTDRAWSURFACE2)hSrcVObject-&gt;pSurfaceData, SrcRect, uiDDFlags );</span>
<a name="l14217"></a>14217 <span class="comment"></span>
<a name="l14218"></a>14218 <span class="comment">      }</span>
<a name="l14219"></a>14219 <span class="comment">      else</span>
<a name="l14220"></a>14220 <span class="comment">      {</span>
<a name="l14221"></a>14221 <span class="comment">            // Normal, specialized blit for clipping, etc</span>
<a name="l14222"></a>14222 <span class="comment"></span>
<a name="l14223"></a>14223 <span class="comment">            // Default flags</span>
<a name="l14224"></a>14224 <span class="comment">            uiDDFlags = DDBLT_WAIT;</span>
<a name="l14225"></a>14225 <span class="comment"></span>
<a name="l14226"></a>14226 <span class="comment">            // Convert flags into DD flags, ( for transparency use, etc )</span>
<a name="l14227"></a>14227 <span class="comment">            if ( fBltFlags &amp; VO_BLT_USECOLORKEY )</span>
<a name="l14228"></a>14228 <span class="comment">            {</span>
<a name="l14229"></a>14229 <span class="comment">                  uiDDFlags |= DDBLT_KEYSRC;</span>
<a name="l14230"></a>14230 <span class="comment">            }</span>
<a name="l14231"></a>14231 <span class="comment"></span>
<a name="l14232"></a>14232 <span class="comment">            // Setup dest rectangle</span>
<a name="l14233"></a>14233 <span class="comment">            DestRect.top =  (int)iDestY;</span>
<a name="l14234"></a>14234 <span class="comment">            DestRect.left = (int)iDestX;</span>
<a name="l14235"></a>14235 <span class="comment">            DestRect.bottom = (int)iDestY + ( SrcRect-&gt;iBottom - SrcRect-&gt;iTop );</span>
<a name="l14236"></a>14236 <span class="comment">            DestRect.right = (int)iDestX + ( SrcRect-&gt;iRight - SrcRect-&gt;iLeft );</span>
<a name="l14237"></a>14237 <span class="comment"></span>
<a name="l14238"></a>14238 <span class="comment">            // Do Clipping of rectangles</span>
<a name="l14239"></a>14239 <span class="comment">            if ( !ClipReleatedSrcAndDestRectangles( hDestVObject, hSrcVObject, &amp;DestRect, SrcRect ) )</span>
<a name="l14240"></a>14240 <span class="comment">            {</span>
<a name="l14241"></a>14241 <span class="comment">                  // Returns false because dest start is &gt; dest size</span>
<a name="l14242"></a>14242 <span class="comment">                  return( TRUE );</span>
<a name="l14243"></a>14243 <span class="comment">            }</span>
<a name="l14244"></a>14244 <span class="comment"></span>
<a name="l14245"></a>14245 <span class="comment">            DDBltSurface( (LPDIRECTDRAWSURFACE2)hDestVObject-&gt;pSurfaceData, &amp;DestRect, (LPDIRECTDRAWSURFACE2)hSrcVObject-&gt;pSurfaceData,</span>
<a name="l14246"></a>14246 <span class="comment">                                          SrcRect, uiDDFlags, NULL );</span>
<a name="l14247"></a>14247 <span class="comment"></span>
<a name="l14248"></a>14248 <span class="comment">      }</span>
<a name="l14249"></a>14249 <span class="comment"></span>
<a name="l14250"></a>14250 <span class="comment">      // Update backup surface with new data</span>
<a name="l14251"></a>14251 <span class="comment">      if ( hDestVObject-&gt;fFlags &amp; VOBJECT_VIDEO_MEM_USAGE &amp;&amp; !hDestVObject-&gt;fFlags &amp; VOBJECT_RESERVED_SURFACE )</span>
<a name="l14252"></a>14252 <span class="comment">      {</span>
<a name="l14253"></a>14253 <span class="comment">            UpdateBackupSurface( hDestVObject );</span>
<a name="l14254"></a>14254 <span class="comment">      }</span>
<a name="l14255"></a>14255 <span class="comment"></span>
<a name="l14256"></a>14256 <span class="comment">      return( TRUE );</span>
<a name="l14257"></a>14257 <span class="comment">}</span>
<a name="l14258"></a>14258 <span class="comment"></span>
<a name="l14259"></a>14259 <span class="comment"></span>
<a name="l14260"></a>14260 <span class="comment">// Blt to backup buffer</span>
<a name="l14261"></a>14261 <span class="comment">BOOLEAN UpdateBackupSurface( HVOBJECT hVObject )</span>
<a name="l14262"></a>14262 <span class="comment">{</span>
<a name="l14263"></a>14263 <span class="comment">      RECT        aRect;</span>
<a name="l14264"></a>14264 <span class="comment"></span>
<a name="l14265"></a>14265 <span class="comment">      // Assertions</span>
<a name="l14266"></a>14266 <span class="comment">      Assert( hVObject != NULL );</span>
<a name="l14267"></a>14267 <span class="comment"></span>
<a name="l14268"></a>14268 <span class="comment">      // Validations</span>
<a name="l14269"></a>14269 <span class="comment">      CHECKF( hVObject-&gt;pSavedSurfaceData != NULL );</span>
<a name="l14270"></a>14270 <span class="comment"></span>
<a name="l14271"></a>14271 <span class="comment">      aRect.top = (int)0;</span>
<a name="l14272"></a>14272 <span class="comment">      aRect.left = (int)0;</span>
<a name="l14273"></a>14273 <span class="comment">      aRect.bottom = (int)hVObject-&gt;usHeight;</span>
<a name="l14274"></a>14274 <span class="comment">      aRect.right = (int)hVObject-&gt;usWidth;</span>
<a name="l14275"></a>14275 <span class="comment"></span>
<a name="l14276"></a>14276 <span class="comment">      // Copy all contents into backup buffer</span>
<a name="l14277"></a>14277 <span class="comment">      DDBltFastSurface( (LPDIRECTDRAWSURFACE2)hVObject-&gt;pSurfaceData, 0, 0, (LPDIRECTDRAWSURFACE2)hVObject-&gt;pSavedSurfaceData, &amp;aRect, DDBLTFAST_NOCOLORKEY );</span>
<a name="l14278"></a>14278 <span class="comment"></span>
<a name="l14279"></a>14279 <span class="comment">      return( TRUE );</span>
<a name="l14280"></a>14280 <span class="comment"></span>
<a name="l14281"></a>14281 <span class="comment">}</span>
<a name="l14282"></a>14282 <span class="comment"></span>
<a name="l14283"></a>14283 <span class="comment">*/</span>
<a name="l14284"></a>14284 
<a name="l14285"></a>14285 
<a name="l14286"></a><a class="code" href="vobject__blitters_8h.html#b67013b0130be94761dd954425c178b0">14286</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#b67013b0130be94761dd954425c178b0">FillRect8BPP</a>(<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> x1, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> y1, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> x2, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> y2, <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> color)
<a name="l14287"></a>14287 {
<a name="l14288"></a>14288 <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>       x1real, y1real, x2real, y2real;
<a name="l14289"></a>14289 <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>      linelength, lines, lineskip;
<a name="l14290"></a>14290 <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>       *startoffset;
<a name="l14291"></a>14291 
<a name="l14292"></a>14292       <span class="comment">// check parameters</span>
<a name="l14293"></a>14293       Assert(pBuffer!=NULL);
<a name="l14294"></a>14294       Assert(uiDestPitchBYTES &gt; 0);
<a name="l14295"></a>14295       Assert(x2 &gt; x1);
<a name="l14296"></a>14296       Assert(y2 &gt; y1);
<a name="l14297"></a>14297 
<a name="l14298"></a>14298       <span class="comment">// clip edges of rect if hanging off screen</span>
<a name="l14299"></a>14299 
<a name="l14300"></a>14300       x1real=__max(0, x1);
<a name="l14301"></a>14301       x2real=__min(639, x2);
<a name="l14302"></a>14302       y1real=__max(0, y1);
<a name="l14303"></a>14303       y2real=__min(479, y2);
<a name="l14304"></a>14304 
<a name="l14305"></a>14305       startoffset=pBuffer+(y1real*uiDestPitchBYTES)+x1real;
<a name="l14306"></a>14306       lines=y2real-y1real+1;
<a name="l14307"></a>14307       linelength=x2real-x1real+1;
<a name="l14308"></a>14308       lineskip=uiDestPitchBYTES-linelength;
<a name="l14309"></a>14309 
<a name="l14310"></a>14310       __asm {
<a name="l14311"></a>14311             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, startoffset
<a name="l14312"></a>14312             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, color
<a name="l14313"></a>14313             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ah, al
<a name="l14314"></a>14314             shl         eax, 16
<a name="l14315"></a>14315             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         al, color
<a name="l14316"></a>14316             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ah, al
<a name="l14317"></a>14317             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, lines
<a name="l14318"></a>14318             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, linelength
<a name="l14319"></a>14319 
<a name="l14320"></a>14320 <span class="comment">// edi = destination pointer</span>
<a name="l14321"></a>14321 <span class="comment">// eax = dword of color value</span>
<a name="l14322"></a>14322 <span class="comment">// ebx = line length</span>
<a name="l14323"></a>14323 <span class="comment">// ecx = column counter</span>
<a name="l14324"></a>14324 <span class="comment">// edx = row counter</span>
<a name="l14325"></a>14325 
<a name="l14326"></a>14326 LineLoop:
<a name="l14327"></a>14327 
<a name="l14328"></a>14328             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, ebx
<a name="l14329"></a>14329 
<a name="l14330"></a>14330             clc
<a name="l14331"></a>14331             rcr         ecx, 1
<a name="l14332"></a>14332             jnc         FL2
<a name="l14333"></a>14333 
<a name="l14334"></a>14334             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], al
<a name="l14335"></a>14335             inc         edi
<a name="l14336"></a>14336 
<a name="l14337"></a>14337 FL2:
<a name="l14338"></a>14338             clc
<a name="l14339"></a>14339             rcr         ecx, 1
<a name="l14340"></a>14340             jnc         FL3
<a name="l14341"></a>14341             mov         [edi], <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>
<a name="l14342"></a>14342             add         edi, 2
<a name="l14343"></a>14343 
<a name="l14344"></a>14344 FL3:
<a name="l14345"></a>14345             or          ecx, ecx
<a name="l14346"></a>14346             jz          FillLineEnd
<a name="l14347"></a>14347 
<a name="l14348"></a>14348             rep         stosd
<a name="l14349"></a>14349 
<a name="l14350"></a>14350 FillLineEnd:
<a name="l14351"></a>14351             add         edi, lineskip
<a name="l14352"></a>14352             dec         edx
<a name="l14353"></a>14353             jnz         LineLoop
<a name="l14354"></a>14354 
<a name="l14355"></a>14355       }
<a name="l14356"></a>14356       <span class="keywordflow">return</span>(TRUE);
<a name="l14357"></a>14357 }
<a name="l14358"></a>14358 
<a name="l14359"></a><a class="code" href="vobject__blitters_8h.html#2f701bbe2b5ecf90bd734b16338211c7">14359</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#2f701bbe2b5ecf90bd734b16338211c7">FillRect16BPP</a>(<a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> x1, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> y1, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> x2, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> y2, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> color)
<a name="l14360"></a>14360 {
<a name="l14361"></a>14361 <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>       x1real, y1real, x2real, y2real;
<a name="l14362"></a>14362 <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>      linelength, lines, lineskip;
<a name="l14363"></a>14363 <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>            *startoffset;
<a name="l14364"></a>14364 
<a name="l14365"></a>14365       <span class="comment">// check parameters</span>
<a name="l14366"></a>14366       Assert(pBuffer!=NULL);
<a name="l14367"></a>14367       Assert(uiDestPitchBYTES &gt; 0);
<a name="l14368"></a>14368       Assert(x2 &gt; x1);
<a name="l14369"></a>14369       Assert(y2 &gt; y1);
<a name="l14370"></a>14370 
<a name="l14371"></a>14371       <span class="comment">// clip edges of rect if hanging off screen</span>
<a name="l14372"></a>14372 
<a name="l14373"></a>14373       x1real=__max(0, x1);
<a name="l14374"></a>14374       x2real=__min(639, x2);
<a name="l14375"></a>14375       y1real=__max(0, y1);
<a name="l14376"></a>14376       y2real=__min(479, y2);
<a name="l14377"></a>14377 
<a name="l14378"></a>14378       startoffset=pBuffer+(y1real*uiDestPitchBYTES/2)+x1real;
<a name="l14379"></a>14379       lines=y2real-y1real+1;
<a name="l14380"></a>14380       linelength=x2real-x1real+1;
<a name="l14381"></a>14381       lineskip=uiDestPitchBYTES-(linelength*2);
<a name="l14382"></a>14382 
<a name="l14383"></a>14383       __asm {
<a name="l14384"></a>14384             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, startoffset
<a name="l14385"></a>14385             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, color
<a name="l14386"></a>14386             shl         eax, 16
<a name="l14387"></a>14387             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, color
<a name="l14388"></a>14388             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, lines
<a name="l14389"></a>14389             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, linelength
<a name="l14390"></a>14390 
<a name="l14391"></a>14391 <span class="comment">// edi = destination pointer</span>
<a name="l14392"></a>14392 <span class="comment">// eax = dword of color value</span>
<a name="l14393"></a>14393 <span class="comment">// ebx = line length</span>
<a name="l14394"></a>14394 <span class="comment">// ecx = column counter</span>
<a name="l14395"></a>14395 <span class="comment">// edx = row counter</span>
<a name="l14396"></a>14396 
<a name="l14397"></a>14397 LineLoop:
<a name="l14398"></a>14398             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, ebx
<a name="l14399"></a>14399 
<a name="l14400"></a>14400             clc
<a name="l14401"></a>14401             rcr         ecx, 1
<a name="l14402"></a>14402             jnc         FL2
<a name="l14403"></a>14403 
<a name="l14404"></a>14404             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax
<a name="l14405"></a>14405             add         edi, 2
<a name="l14406"></a>14406 
<a name="l14407"></a>14407 FL2:
<a name="l14408"></a>14408             or          ecx, ecx
<a name="l14409"></a>14409             jz          FillLineEnd
<a name="l14410"></a>14410 
<a name="l14411"></a>14411             rep         stosd
<a name="l14412"></a>14412 
<a name="l14413"></a>14413 FillLineEnd:
<a name="l14414"></a>14414             add         edi, lineskip
<a name="l14415"></a>14415             dec         edx
<a name="l14416"></a>14416             jnz         LineLoop
<a name="l14417"></a>14417 
<a name="l14418"></a>14418       }
<a name="l14419"></a>14419       <span class="keywordflow">return</span>(TRUE);
<a name="l14420"></a>14420 }     
<a name="l14421"></a>14421 
<a name="l14422"></a>14422 
<a name="l14423"></a>14423 <span class="comment">/**********************************************************************************************</span>
<a name="l14424"></a>14424 <span class="comment"> BltIsClippedOrOffScreen</span>
<a name="l14425"></a>14425 <span class="comment"></span>
<a name="l14426"></a>14426 <span class="comment">      Determines whether a given blit will need clipping or not. Returns TRUE/FALSE.</span>
<a name="l14427"></a>14427 <span class="comment"></span>
<a name="l14428"></a>14428 <span class="comment">**********************************************************************************************/</span>
<a name="l14429"></a><a class="code" href="vobject__blitters_8h.html#7c57e2ca090faf5d628b8cc32e981d59">14429</a> <a class="code" href="Types_8h.html#2f68f0189367ead40015f7c0ec68eb9e">CHAR8</a> <a class="code" href="vobject__blitters_8cpp.html#7c57e2ca090faf5d628b8cc32e981d59">BltIsClippedOrOffScreen</a>( <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="structSGPRect.html">SGPRect</a> *clipregion )
<a name="l14430"></a>14430 {
<a name="l14431"></a>14431       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth;
<a name="l14432"></a>14432   <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l14433"></a>14433       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l14434"></a>14434       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  ClipX1, ClipY1, ClipX2, ClipY2;
<a name="l14435"></a>14435 
<a name="l14436"></a>14436       <span class="comment">// Assertions</span>
<a name="l14437"></a>14437       Assert( hSrcVObject != NULL );
<a name="l14438"></a>14438 
<a name="l14439"></a>14439       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l14440"></a>14440       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l14441"></a>14441       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l14442"></a>14442       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l14443"></a>14443 
<a name="l14444"></a>14444       <span class="comment">// Add to start position of dest buffer</span>
<a name="l14445"></a>14445       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l14446"></a>14446       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l14447"></a>14447 
<a name="l14448"></a>14448       <span class="keywordflow">if</span>(clipregion==NULL)
<a name="l14449"></a>14449       {
<a name="l14450"></a>14450             ClipX1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l14451"></a>14451             ClipY1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l14452"></a>14452             ClipX2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l14453"></a>14453             ClipY2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l14454"></a>14454       }
<a name="l14455"></a>14455       <span class="keywordflow">else</span>
<a name="l14456"></a>14456       {
<a name="l14457"></a>14457             ClipX1=clipregion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l14458"></a>14458             ClipY1=clipregion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l14459"></a>14459             ClipX2=clipregion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l14460"></a>14460             ClipY2=clipregion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l14461"></a>14461       }
<a name="l14462"></a>14462 
<a name="l14463"></a>14463 
<a name="l14464"></a>14464       <span class="comment">// Calculate rows hanging off each side of the screen</span>
<a name="l14465"></a>14465       <a class="code" href="vobject__blitters_8cpp.html#76a2f0aadb5a7f4e9d9e9df1d6bdea0b">gLeftSkip</a>=__min(ClipX1 - min(ClipX1, iTempX), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l14466"></a>14466       <a class="code" href="vobject__blitters_8cpp.html#032002a0b234e0864f34fff123d5da8a">gRightSkip</a>=__min(max(ClipX2, (iTempX+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth)) - ClipX2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l14467"></a>14467       <a class="code" href="vobject__blitters_8cpp.html#6962546a67abac08ad7524bb6b172f5c">gTopSkip</a>=__min(ClipY1 - __min(ClipY1, iTempY), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l14468"></a>14468       <a class="code" href="vobject__blitters_8cpp.html#3e6c3b744060355ea9244b358f00c109">gBottomSkip</a>=__min(__max(ClipY2, (iTempY+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight)) - ClipY2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l14469"></a>14469 
<a name="l14470"></a>14470       <a class="code" href="vobject__blitters_8cpp.html#a8801855d8661dd550fee4f76752746f">gfUsePreCalcSkips</a> = TRUE;
<a name="l14471"></a>14471 
<a name="l14472"></a>14472       <span class="comment">// check if whole thing is clipped</span>
<a name="l14473"></a>14473       <span class="keywordflow">if</span>((<a class="code" href="vobject__blitters_8cpp.html#76a2f0aadb5a7f4e9d9e9df1d6bdea0b">gLeftSkip</a> &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth) || (<a class="code" href="vobject__blitters_8cpp.html#032002a0b234e0864f34fff123d5da8a">gRightSkip</a> &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth))
<a name="l14474"></a>14474             <span class="keywordflow">return</span>(-1 );
<a name="l14475"></a>14475 
<a name="l14476"></a>14476       <span class="comment">// check if whole thing is clipped</span>
<a name="l14477"></a>14477       <span class="keywordflow">if</span>((<a class="code" href="vobject__blitters_8cpp.html#6962546a67abac08ad7524bb6b172f5c">gTopSkip</a> &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight) || (<a class="code" href="vobject__blitters_8cpp.html#3e6c3b744060355ea9244b358f00c109">gBottomSkip</a> &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight))
<a name="l14478"></a>14478             <span class="keywordflow">return</span>(-1 );
<a name="l14479"></a>14479 
<a name="l14480"></a>14480 
<a name="l14481"></a>14481       <span class="keywordflow">if</span> ( <a class="code" href="vobject__blitters_8cpp.html#76a2f0aadb5a7f4e9d9e9df1d6bdea0b">gLeftSkip</a> )
<a name="l14482"></a>14482             <span class="keywordflow">return</span>( TRUE );
<a name="l14483"></a>14483 
<a name="l14484"></a>14484       <span class="keywordflow">if</span> ( <a class="code" href="vobject__blitters_8cpp.html#032002a0b234e0864f34fff123d5da8a">gRightSkip</a> )
<a name="l14485"></a>14485             <span class="keywordflow">return</span>( TRUE );
<a name="l14486"></a>14486 
<a name="l14487"></a>14487       <span class="keywordflow">if</span> ( <a class="code" href="vobject__blitters_8cpp.html#6962546a67abac08ad7524bb6b172f5c">gTopSkip</a> )
<a name="l14488"></a>14488             <span class="keywordflow">return</span>( TRUE );
<a name="l14489"></a>14489 
<a name="l14490"></a>14490       <span class="keywordflow">if</span> ( <a class="code" href="vobject__blitters_8cpp.html#3e6c3b744060355ea9244b358f00c109">gBottomSkip</a> )
<a name="l14491"></a>14491             <span class="keywordflow">return</span>( TRUE );
<a name="l14492"></a>14492 
<a name="l14493"></a>14493 
<a name="l14494"></a>14494       <span class="keywordflow">return</span>(FALSE);
<a name="l14495"></a>14495 }
<a name="l14496"></a>14496 
<a name="l14497"></a>14497 
<a name="l14498"></a>14498 
<a name="l14499"></a>14499 
<a name="l14500"></a>14500 <span class="comment">// Blt8BPPDataTo16BPPBufferOutline</span>
<a name="l14501"></a>14501 <span class="comment">// ATE New blitter for rendering a differrent color for value 254. Can be transparent if fDoOutline is FALSE</span>
<a name="l14502"></a><a class="code" href="vobject__blitters_8h.html#27303f8396294f3f0e1367c808b636f1">14502</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#27303f8396294f3f0e1367c808b636f1">Blt8BPPDataTo16BPPBufferOutline</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> s16BPPColor, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fDoOutline )
<a name="l14503"></a>14503 {
<a name="l14504"></a>14504       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l14505"></a>14505       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth;
<a name="l14506"></a>14506       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr;
<a name="l14507"></a>14507       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l14508"></a>14508       <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l14509"></a>14509       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l14510"></a>14510       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l14511"></a>14511 
<a name="l14512"></a>14512 
<a name="l14513"></a>14513       <span class="comment">// Assertions</span>
<a name="l14514"></a>14514       Assert( hSrcVObject != NULL );
<a name="l14515"></a>14515       Assert( pBuffer != NULL );
<a name="l14516"></a>14516 
<a name="l14517"></a>14517       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l14518"></a>14518       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l14519"></a>14519       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l14520"></a>14520       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l14521"></a>14521       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l14522"></a>14522 
<a name="l14523"></a>14523       <span class="comment">// Add to start position of dest buffer</span>
<a name="l14524"></a>14524       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l14525"></a>14525       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l14526"></a>14526 
<a name="l14527"></a>14527       <span class="comment">// Validations</span>
<a name="l14528"></a>14528       CHECKF( iTempX &gt;= 0 );
<a name="l14529"></a>14529       CHECKF( iTempY &gt;= 0 );
<a name="l14530"></a>14530 
<a name="l14531"></a>14531 
<a name="l14532"></a>14532       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l14533"></a>14533       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l14534"></a>14534       LineSkip=(uiDestPitchBYTES-(usWidth*2));
<a name="l14535"></a>14535       p16BPPPalette = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#930609ad8d5cdbb05449df70bd83cfcd">pShadeCurrent</a>;
<a name="l14536"></a>14536 
<a name="l14537"></a>14537       __asm {
<a name="l14538"></a>14538 
<a name="l14539"></a>14539             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l14540"></a>14540             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l14541"></a>14541             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, p16BPPPalette
<a name="l14542"></a>14542             xor         eax, eax
<a name="l14543"></a>14543             xor         ecx, ecx
<a name="l14544"></a>14544 
<a name="l14545"></a>14545 BlitDispatch:
<a name="l14546"></a>14546 
<a name="l14547"></a>14547             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l14548"></a>14548             inc         esi
<a name="l14549"></a>14549             or          cl, cl
<a name="l14550"></a>14550             js          BlitTransparent
<a name="l14551"></a>14551             jz          BlitDoneLine
<a name="l14552"></a>14552 
<a name="l14553"></a>14553 <span class="comment">//BlitNonTransLoop:</span>
<a name="l14554"></a>14554 
<a name="l14555"></a>14555 BlitNTL4:
<a name="l14556"></a>14556 
<a name="l14557"></a>14557             xor         eax, eax
<a name="l14558"></a>14558             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l14559"></a>14559             cmp         al, 254
<a name="l14560"></a>14560             jne         <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>
<a name="l14561"></a>14561 
<a name="l14562"></a>14562             <span class="comment">//          DO OUTLINE</span>
<a name="l14563"></a>14563             <span class="comment">//          ONLY IF WE WANT IT!</span>
<a name="l14564"></a>14564             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         al, fDoOutline;
<a name="l14565"></a>14565             cmp         al,   1
<a name="l14566"></a>14566             jne         BlitNTL5
<a name="l14567"></a>14567 
<a name="l14568"></a>14568             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, s16BPPColor
<a name="l14569"></a>14569             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax
<a name="l14570"></a>14570             jmp         BlitNTL5
<a name="l14571"></a>14571 
<a name="l14572"></a>14572 
<a name="l14573"></a>14573 <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>:
<a name="l14574"></a>14574             mov         ax, [edx+eax*2]
<a name="l14575"></a>14575             mov         [edi], ax
<a name="l14576"></a>14576 
<a name="l14577"></a>14577 BlitNTL5:
<a name="l14578"></a>14578             inc         esi
<a name="l14579"></a>14579             add         edi, 2
<a name="l14580"></a>14580             dec         cl
<a name="l14581"></a>14581             jnz         BlitNTL4
<a name="l14582"></a>14582 
<a name="l14583"></a>14583             jmp         BlitDispatch
<a name="l14584"></a>14584 
<a name="l14585"></a>14585 
<a name="l14586"></a>14586 BlitTransparent:
<a name="l14587"></a>14587 
<a name="l14588"></a>14588             and         ecx, 07fH
<a name="l14589"></a>14589 <span class="comment">//          shl         ecx, 1</span>
<a name="l14590"></a>14590             add   ecx, ecx
<a name="l14591"></a>14591             add         edi, ecx
<a name="l14592"></a>14592             jmp         BlitDispatch
<a name="l14593"></a>14593 
<a name="l14594"></a>14594 
<a name="l14595"></a>14595 BlitDoneLine:
<a name="l14596"></a>14596 
<a name="l14597"></a>14597             dec         usHeight
<a name="l14598"></a>14598             jz          BlitDone
<a name="l14599"></a>14599             add         edi, LineSkip
<a name="l14600"></a>14600             jmp         BlitDispatch
<a name="l14601"></a>14601 
<a name="l14602"></a>14602 
<a name="l14603"></a>14603 BlitDone:
<a name="l14604"></a>14604       }
<a name="l14605"></a>14605 
<a name="l14606"></a>14606       <span class="keywordflow">return</span>(TRUE);
<a name="l14607"></a>14607 
<a name="l14608"></a>14608 }
<a name="l14609"></a>14609 
<a name="l14610"></a>14610 
<a name="l14611"></a>14611 <span class="comment">// ATE New blitter for rendering a differrent color for value 254. Can be transparent if fDoOutline is FALSE</span>
<a name="l14612"></a><a class="code" href="vobject__blitters_8h.html#7ff927fb37835f86186b90e513f1a3a8">14612</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#7ff927fb37835f86186b90e513f1a3a8">Blt8BPPDataTo16BPPBufferOutlineClip</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> s16BPPColor, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fDoOutline, <a class="code" href="structSGPRect.html">SGPRect</a> *clipregion )
<a name="l14613"></a>14613 {
<a name="l14614"></a>14614       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l14615"></a>14615       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth, Unblitted;
<a name="l14616"></a>14616       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr;
<a name="l14617"></a>14617       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l14618"></a>14618   <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l14619"></a>14619       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY, LeftSkip, RightSkip, TopSkip, BottomSkip, BlitLength, BlitHeight, LSCount;
<a name="l14620"></a>14620       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  ClipX1, ClipY1, ClipX2, ClipY2;
<a name="l14621"></a>14621       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l14622"></a>14622 
<a name="l14623"></a>14623 
<a name="l14624"></a>14624       <span class="comment">// Assertions</span>
<a name="l14625"></a>14625       Assert( hSrcVObject != NULL );
<a name="l14626"></a>14626       Assert( pBuffer != NULL );
<a name="l14627"></a>14627 
<a name="l14628"></a>14628       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l14629"></a>14629       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l14630"></a>14630       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l14631"></a>14631       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l14632"></a>14632       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l14633"></a>14633 
<a name="l14634"></a>14634       <span class="comment">// Add to start position of dest buffer</span>
<a name="l14635"></a>14635       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l14636"></a>14636       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l14637"></a>14637 
<a name="l14638"></a>14638       <span class="keywordflow">if</span>(clipregion==NULL)
<a name="l14639"></a>14639       {
<a name="l14640"></a>14640             ClipX1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l14641"></a>14641             ClipY1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l14642"></a>14642             ClipX2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l14643"></a>14643             ClipY2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l14644"></a>14644       }
<a name="l14645"></a>14645       <span class="keywordflow">else</span>
<a name="l14646"></a>14646       {
<a name="l14647"></a>14647             ClipX1=clipregion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l14648"></a>14648             ClipY1=clipregion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l14649"></a>14649             ClipX2=clipregion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l14650"></a>14650             ClipY2=clipregion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l14651"></a>14651       }
<a name="l14652"></a>14652 
<a name="l14653"></a>14653       <span class="comment">// Calculate rows hanging off each side of the screen</span>
<a name="l14654"></a>14654       LeftSkip=__min(ClipX1 - min(ClipX1, iTempX), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l14655"></a>14655       RightSkip=__min(max(ClipX2, (iTempX+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth)) - ClipX2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l14656"></a>14656       TopSkip=__min(ClipY1 - __min(ClipY1, iTempY), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l14657"></a>14657       BottomSkip=__min(__max(ClipY2, (iTempY+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight)) - ClipY2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l14658"></a>14658 
<a name="l14659"></a>14659       <span class="comment">// calculate the remaining rows and columns to blit</span>
<a name="l14660"></a>14660       BlitLength=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth-LeftSkip-RightSkip);
<a name="l14661"></a>14661       BlitHeight=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight-TopSkip-BottomSkip);
<a name="l14662"></a>14662 
<a name="l14663"></a>14663       <span class="comment">// check if whole thing is clipped</span>
<a name="l14664"></a>14664       <span class="keywordflow">if</span>((LeftSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth) || (RightSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth))
<a name="l14665"></a>14665             <span class="keywordflow">return</span>(TRUE);
<a name="l14666"></a>14666 
<a name="l14667"></a>14667       <span class="comment">// check if whole thing is clipped</span>
<a name="l14668"></a>14668       <span class="keywordflow">if</span>((TopSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight) || (BottomSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight))
<a name="l14669"></a>14669             <span class="keywordflow">return</span>(TRUE);
<a name="l14670"></a>14670 
<a name="l14671"></a>14671       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l14672"></a>14672       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l14673"></a>14673       LineSkip=(uiDestPitchBYTES-(BlitLength*2));
<a name="l14674"></a>14674       p16BPPPalette = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#930609ad8d5cdbb05449df70bd83cfcd">pShadeCurrent</a>;
<a name="l14675"></a>14675 
<a name="l14676"></a>14676       __asm {
<a name="l14677"></a>14677 
<a name="l14678"></a>14678             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l14679"></a>14679             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l14680"></a>14680             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, p16BPPPalette
<a name="l14681"></a>14681             xor         eax, eax
<a name="l14682"></a>14682             xor         ecx, ecx
<a name="l14683"></a>14683 
<a name="l14684"></a>14684             cmp         TopSkip, 0                                      <span class="comment">// check for nothing clipped on top</span>
<a name="l14685"></a>14685             je          LeftSkipSetup
<a name="l14686"></a>14686 
<a name="l14687"></a>14687 TopSkipLoop:                                                            <span class="comment">// Skips the number of lines clipped at the top</span>
<a name="l14688"></a>14688 
<a name="l14689"></a>14689             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l14690"></a>14690             inc         esi
<a name="l14691"></a>14691             or          cl, cl
<a name="l14692"></a>14692             js          TopSkipLoop
<a name="l14693"></a>14693             jz          TSEndLine
<a name="l14694"></a>14694 
<a name="l14695"></a>14695             add         esi, ecx
<a name="l14696"></a>14696             jmp         TopSkipLoop
<a name="l14697"></a>14697 
<a name="l14698"></a>14698 TSEndLine:
<a name="l14699"></a>14699             dec         TopSkip
<a name="l14700"></a>14700             jnz         TopSkipLoop
<a name="l14701"></a>14701 
<a name="l14702"></a>14702 LeftSkipSetup:
<a name="l14703"></a>14703 
<a name="l14704"></a>14704             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l14705"></a>14705             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, LeftSkip
<a name="l14706"></a>14706             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l14707"></a>14707             or          eax, eax
<a name="l14708"></a>14708             jz          BlitLineSetup
<a name="l14709"></a>14709 
<a name="l14710"></a>14710 LeftSkipLoop:
<a name="l14711"></a>14711 
<a name="l14712"></a>14712             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l14713"></a>14713             inc         esi
<a name="l14714"></a>14714 
<a name="l14715"></a>14715             or          cl, cl
<a name="l14716"></a>14716             js          LSTrans
<a name="l14717"></a>14717 
<a name="l14718"></a>14718             cmp         ecx, LSCount
<a name="l14719"></a>14719             je          LSSkip2                                               <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l14720"></a>14720             jb          LSSkip1                                               <span class="comment">// if less, skip whole thing</span>
<a name="l14721"></a>14721 
<a name="l14722"></a>14722             add         esi, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l14723"></a>14723             sub         ecx, LSCount
<a name="l14724"></a>14724             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l14725"></a>14725             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l14726"></a>14726             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l14727"></a>14727             jmp         BlitNonTransLoop
<a name="l14728"></a>14728 
<a name="l14729"></a>14729 LSSkip2:
<a name="l14730"></a>14730             add         esi, ecx                                        <span class="comment">// skip whole run, and start blit with new run</span>
<a name="l14731"></a>14731             jmp         BlitLineSetup
<a name="l14732"></a>14732 
<a name="l14733"></a>14733 
<a name="l14734"></a>14734 LSSkip1:
<a name="l14735"></a>14735             add         esi, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l14736"></a>14736             sub         LSCount, ecx
<a name="l14737"></a>14737             jmp         LeftSkipLoop
<a name="l14738"></a>14738 
<a name="l14739"></a>14739 
<a name="l14740"></a>14740 LSTrans:
<a name="l14741"></a>14741             and         ecx, 07fH
<a name="l14742"></a>14742             cmp         ecx, LSCount
<a name="l14743"></a>14743             je          BlitLineSetup                             <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l14744"></a>14744             jb          LSTrans1                                        <span class="comment">// if less, skip whole thing</span>
<a name="l14745"></a>14745 
<a name="l14746"></a>14746             sub         ecx, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l14747"></a>14747             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l14748"></a>14748             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l14749"></a>14749             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l14750"></a>14750             jmp         BlitTransparent
<a name="l14751"></a>14751 
<a name="l14752"></a>14752 
<a name="l14753"></a>14753 LSTrans1:
<a name="l14754"></a>14754             sub         LSCount, ecx                                          <span class="comment">// skip whole run, continue skipping</span>
<a name="l14755"></a>14755             jmp         LeftSkipLoop
<a name="l14756"></a>14756 
<a name="l14757"></a>14757 
<a name="l14758"></a>14758 BlitLineSetup:                                                    <span class="comment">// Does any actual blitting (trans/non) for the line</span>
<a name="l14759"></a>14759             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l14760"></a>14760             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l14761"></a>14761             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l14762"></a>14762 
<a name="l14763"></a>14763 BlitDispatch:
<a name="l14764"></a>14764 
<a name="l14765"></a>14765             cmp         LSCount, 0                                      <span class="comment">// Check to see if we're done blitting</span>
<a name="l14766"></a>14766             je          RightSkipLoop
<a name="l14767"></a>14767 
<a name="l14768"></a>14768             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l14769"></a>14769             inc         esi
<a name="l14770"></a>14770             or          cl, cl
<a name="l14771"></a>14771             js          BlitTransparent
<a name="l14772"></a>14772 
<a name="l14773"></a>14773 BlitNonTransLoop:                                           <span class="comment">// blit non-transparent pixels</span>
<a name="l14774"></a>14774 
<a name="l14775"></a>14775             cmp         ecx, LSCount
<a name="l14776"></a>14776             jbe         BNTrans1
<a name="l14777"></a>14777 
<a name="l14778"></a>14778             sub         ecx, LSCount
<a name="l14779"></a>14779             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, ecx
<a name="l14780"></a>14780             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, LSCount
<a name="l14781"></a>14781 
<a name="l14782"></a>14782 BNTrans1:
<a name="l14783"></a>14783             sub         LSCount, ecx
<a name="l14784"></a>14784 
<a name="l14785"></a>14785 BlitNTL1:
<a name="l14786"></a>14786             xor         eax, eax
<a name="l14787"></a>14787 
<a name="l14788"></a>14788             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l14789"></a>14789             cmp         al, 254
<a name="l14790"></a>14790             jne         BlitNTL3
<a name="l14791"></a>14791 
<a name="l14792"></a>14792             <span class="comment">//          DO OUTLINE</span>
<a name="l14793"></a>14793             <span class="comment">//          ONLY IF WE WANT IT!</span>
<a name="l14794"></a>14794             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         al, fDoOutline;
<a name="l14795"></a>14795             cmp         al,   1
<a name="l14796"></a>14796             jne         BlitNTL2
<a name="l14797"></a>14797 
<a name="l14798"></a>14798             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, s16BPPColor
<a name="l14799"></a>14799             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax
<a name="l14800"></a>14800             jmp         BlitNTL2
<a name="l14801"></a>14801 
<a name="l14802"></a>14802 BlitNTL3:
<a name="l14803"></a>14803             mov         ax, [edx+eax*2]
<a name="l14804"></a>14804             mov         [edi], ax
<a name="l14805"></a>14805 
<a name="l14806"></a>14806 BlitNTL2:
<a name="l14807"></a>14807             inc         esi
<a name="l14808"></a>14808             add         edi, 2
<a name="l14809"></a>14809             dec         cl
<a name="l14810"></a>14810             jnz         BlitNTL1
<a name="l14811"></a>14811 
<a name="l14812"></a>14812 <span class="comment">//BlitLineEnd:</span>
<a name="l14813"></a>14813             add         esi, Unblitted
<a name="l14814"></a>14814             jmp         BlitDispatch
<a name="l14815"></a>14815 
<a name="l14816"></a>14816 BlitTransparent:                                                              <span class="comment">// skip transparent pixels</span>
<a name="l14817"></a>14817 
<a name="l14818"></a>14818             and         ecx, 07fH
<a name="l14819"></a>14819             cmp         ecx, LSCount
<a name="l14820"></a>14820             jbe         BTrans1
<a name="l14821"></a>14821 
<a name="l14822"></a>14822             mov         ecx, LSCount
<a name="l14823"></a>14823 
<a name="l14824"></a>14824 BTrans1:
<a name="l14825"></a>14825 
<a name="l14826"></a>14826             sub         LSCount, ecx
<a name="l14827"></a>14827 <span class="comment">//          shl         ecx, 1</span>
<a name="l14828"></a>14828             add   ecx, ecx
<a name="l14829"></a>14829             add         edi, ecx
<a name="l14830"></a>14830             jmp         BlitDispatch
<a name="l14831"></a>14831 
<a name="l14832"></a>14832 
<a name="l14833"></a>14833 RightSkipLoop:                                                                      <span class="comment">// skip along until we hit and end-of-line marker</span>
<a name="l14834"></a>14834 
<a name="l14835"></a>14835 
<a name="l14836"></a>14836 RSLoop1:
<a name="l14837"></a>14837             mov         al, [esi]
<a name="l14838"></a>14838             inc         esi
<a name="l14839"></a>14839             or          al, al
<a name="l14840"></a>14840             jnz         RSLoop1
<a name="l14841"></a>14841 
<a name="l14842"></a>14842             dec         BlitHeight
<a name="l14843"></a>14843             jz          BlitDone
<a name="l14844"></a>14844             add         edi, LineSkip
<a name="l14845"></a>14845 
<a name="l14846"></a>14846             jmp         LeftSkipSetup
<a name="l14847"></a>14847 
<a name="l14848"></a>14848 
<a name="l14849"></a>14849 BlitDone:
<a name="l14850"></a>14850       }
<a name="l14851"></a>14851 
<a name="l14852"></a>14852       <span class="keywordflow">return</span>(TRUE);
<a name="l14853"></a>14853 
<a name="l14854"></a>14854 }
<a name="l14855"></a>14855 
<a name="l14856"></a>14856 
<a name="l14857"></a><a class="code" href="vobject__blitters_8h.html#f4d010546cacc6cb148e1ac8f06930cf">14857</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#f4d010546cacc6cb148e1ac8f06930cf">Blt8BPPDataTo16BPPBufferOutlineZClip</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> s16BPPColor, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fDoOutline, <a class="code" href="structSGPRect.html">SGPRect</a> *clipregion )
<a name="l14858"></a>14858 {
<a name="l14859"></a>14859       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l14860"></a>14860       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth, Unblitted;
<a name="l14861"></a>14861       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l14862"></a>14862       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l14863"></a>14863   <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l14864"></a>14864       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY, LeftSkip, RightSkip, TopSkip, BottomSkip, BlitLength, BlitHeight, LSCount;
<a name="l14865"></a>14865       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  ClipX1, ClipY1, ClipX2, ClipY2;
<a name="l14866"></a>14866       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l14867"></a>14867 
<a name="l14868"></a>14868 
<a name="l14869"></a>14869       <span class="comment">// Assertions</span>
<a name="l14870"></a>14870       Assert( hSrcVObject != NULL );
<a name="l14871"></a>14871       Assert( pBuffer != NULL );
<a name="l14872"></a>14872 
<a name="l14873"></a>14873       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l14874"></a>14874       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l14875"></a>14875       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l14876"></a>14876       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l14877"></a>14877       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l14878"></a>14878 
<a name="l14879"></a>14879       <span class="comment">// Add to start position of dest buffer</span>
<a name="l14880"></a>14880       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l14881"></a>14881       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l14882"></a>14882 
<a name="l14883"></a>14883       <span class="keywordflow">if</span>(clipregion==NULL)
<a name="l14884"></a>14884       {
<a name="l14885"></a>14885             ClipX1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l14886"></a>14886             ClipY1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l14887"></a>14887             ClipX2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l14888"></a>14888             ClipY2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l14889"></a>14889       }
<a name="l14890"></a>14890       <span class="keywordflow">else</span>
<a name="l14891"></a>14891       {
<a name="l14892"></a>14892             ClipX1=clipregion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l14893"></a>14893             ClipY1=clipregion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l14894"></a>14894             ClipX2=clipregion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l14895"></a>14895             ClipY2=clipregion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l14896"></a>14896       }
<a name="l14897"></a>14897 
<a name="l14898"></a>14898       <span class="comment">// Calculate rows hanging off each side of the screen</span>
<a name="l14899"></a>14899       LeftSkip=__min(ClipX1 - min(ClipX1, iTempX), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l14900"></a>14900       RightSkip=__min(max(ClipX2, (iTempX+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth)) - ClipX2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l14901"></a>14901       TopSkip=__min(ClipY1 - __min(ClipY1, iTempY), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l14902"></a>14902       BottomSkip=__min(__max(ClipY2, (iTempY+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight)) - ClipY2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l14903"></a>14903 
<a name="l14904"></a>14904       <span class="comment">// calculate the remaining rows and columns to blit</span>
<a name="l14905"></a>14905       BlitLength=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth-LeftSkip-RightSkip);
<a name="l14906"></a>14906       BlitHeight=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight-TopSkip-BottomSkip);
<a name="l14907"></a>14907 
<a name="l14908"></a>14908       <span class="comment">// check if whole thing is clipped</span>
<a name="l14909"></a>14909       <span class="keywordflow">if</span>((LeftSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth) || (RightSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth))
<a name="l14910"></a>14910             <span class="keywordflow">return</span>(TRUE);
<a name="l14911"></a>14911 
<a name="l14912"></a>14912       <span class="comment">// check if whole thing is clipped</span>
<a name="l14913"></a>14913       <span class="keywordflow">if</span>((TopSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight) || (BottomSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight))
<a name="l14914"></a>14914             <span class="keywordflow">return</span>(TRUE);
<a name="l14915"></a>14915 
<a name="l14916"></a>14916       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l14917"></a>14917       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l14918"></a>14918       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l14919"></a>14919 
<a name="l14920"></a>14920       LineSkip=(uiDestPitchBYTES-(BlitLength*2));
<a name="l14921"></a>14921       p16BPPPalette = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#930609ad8d5cdbb05449df70bd83cfcd">pShadeCurrent</a>;
<a name="l14922"></a>14922 
<a name="l14923"></a>14923       __asm {
<a name="l14924"></a>14924 
<a name="l14925"></a>14925             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l14926"></a>14926             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l14927"></a>14927             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, p16BPPPalette
<a name="l14928"></a>14928             xor         eax, eax
<a name="l14929"></a>14929             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l14930"></a>14930             xor         ecx, ecx
<a name="l14931"></a>14931 
<a name="l14932"></a>14932             cmp         TopSkip, 0                                      <span class="comment">// check for nothing clipped on top</span>
<a name="l14933"></a>14933             je          LeftSkipSetup
<a name="l14934"></a>14934 
<a name="l14935"></a>14935 TopSkipLoop:                                                            <span class="comment">// Skips the number of lines clipped at the top</span>
<a name="l14936"></a>14936 
<a name="l14937"></a>14937             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l14938"></a>14938             inc         esi
<a name="l14939"></a>14939             or          cl, cl
<a name="l14940"></a>14940             js          TopSkipLoop
<a name="l14941"></a>14941             jz          TSEndLine
<a name="l14942"></a>14942 
<a name="l14943"></a>14943             add         esi, ecx
<a name="l14944"></a>14944             jmp         TopSkipLoop
<a name="l14945"></a>14945 
<a name="l14946"></a>14946 TSEndLine:
<a name="l14947"></a>14947             dec         TopSkip
<a name="l14948"></a>14948             jnz         TopSkipLoop
<a name="l14949"></a>14949 
<a name="l14950"></a>14950 LeftSkipSetup:
<a name="l14951"></a>14951 
<a name="l14952"></a>14952             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l14953"></a>14953             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, LeftSkip
<a name="l14954"></a>14954             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l14955"></a>14955             or          eax, eax
<a name="l14956"></a>14956             jz          BlitLineSetup
<a name="l14957"></a>14957 
<a name="l14958"></a>14958 LeftSkipLoop:
<a name="l14959"></a>14959 
<a name="l14960"></a>14960             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l14961"></a>14961             inc         esi
<a name="l14962"></a>14962 
<a name="l14963"></a>14963             or          cl, cl
<a name="l14964"></a>14964             js          LSTrans
<a name="l14965"></a>14965 
<a name="l14966"></a>14966             cmp         ecx, LSCount
<a name="l14967"></a>14967             je          LSSkip2                                               <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l14968"></a>14968             jb          LSSkip1                                               <span class="comment">// if less, skip whole thing</span>
<a name="l14969"></a>14969 
<a name="l14970"></a>14970             add         esi, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l14971"></a>14971             sub         ecx, LSCount
<a name="l14972"></a>14972             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l14973"></a>14973             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l14974"></a>14974             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l14975"></a>14975             jmp         BlitNonTransLoop
<a name="l14976"></a>14976 
<a name="l14977"></a>14977 LSSkip2:
<a name="l14978"></a>14978             add         esi, ecx                                        <span class="comment">// skip whole run, and start blit with new run</span>
<a name="l14979"></a>14979             jmp         BlitLineSetup
<a name="l14980"></a>14980 
<a name="l14981"></a>14981 
<a name="l14982"></a>14982 LSSkip1:
<a name="l14983"></a>14983             add         esi, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l14984"></a>14984             sub         LSCount, ecx
<a name="l14985"></a>14985             jmp         LeftSkipLoop
<a name="l14986"></a>14986 
<a name="l14987"></a>14987 
<a name="l14988"></a>14988 LSTrans:
<a name="l14989"></a>14989             and         ecx, 07fH
<a name="l14990"></a>14990             cmp         ecx, LSCount
<a name="l14991"></a>14991             je          BlitLineSetup                             <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l14992"></a>14992             jb          LSTrans1                                        <span class="comment">// if less, skip whole thing</span>
<a name="l14993"></a>14993 
<a name="l14994"></a>14994             sub         ecx, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l14995"></a>14995             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l14996"></a>14996             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l14997"></a>14997             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l14998"></a>14998             jmp         BlitTransparent
<a name="l14999"></a>14999 
<a name="l15000"></a>15000 
<a name="l15001"></a>15001 LSTrans1:
<a name="l15002"></a>15002             sub         LSCount, ecx                                          <span class="comment">// skip whole run, continue skipping</span>
<a name="l15003"></a>15003             jmp         LeftSkipLoop
<a name="l15004"></a>15004 
<a name="l15005"></a>15005 
<a name="l15006"></a>15006 BlitLineSetup:                                                    <span class="comment">// Does any actual blitting (trans/non) for the line</span>
<a name="l15007"></a>15007             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l15008"></a>15008             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l15009"></a>15009             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l15010"></a>15010 
<a name="l15011"></a>15011 BlitDispatch:
<a name="l15012"></a>15012 
<a name="l15013"></a>15013             cmp         LSCount, 0                                      <span class="comment">// Check to see if we're done blitting</span>
<a name="l15014"></a>15014             je          RightSkipLoop
<a name="l15015"></a>15015 
<a name="l15016"></a>15016             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l15017"></a>15017             inc         esi
<a name="l15018"></a>15018             or          cl, cl
<a name="l15019"></a>15019             js          BlitTransparent
<a name="l15020"></a>15020 
<a name="l15021"></a>15021 BlitNonTransLoop:                                           <span class="comment">// blit non-transparent pixels</span>
<a name="l15022"></a>15022 
<a name="l15023"></a>15023             cmp         ecx, LSCount
<a name="l15024"></a>15024             jbe         BNTrans1
<a name="l15025"></a>15025 
<a name="l15026"></a>15026             sub         ecx, LSCount
<a name="l15027"></a>15027             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, ecx
<a name="l15028"></a>15028             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, LSCount
<a name="l15029"></a>15029 
<a name="l15030"></a>15030 BNTrans1:
<a name="l15031"></a>15031             sub         LSCount, ecx
<a name="l15032"></a>15032 
<a name="l15033"></a>15033 BlitNTL1:
<a name="l15034"></a>15034 
<a name="l15035"></a>15035             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, usZValue
<a name="l15036"></a>15036             cmp         ax, [ebx]
<a name="l15037"></a>15037             jb          BlitNTL2
<a name="l15038"></a>15038 
<a name="l15039"></a>15039             <span class="comment">// CHECK FOR OUTLINE...</span>
<a name="l15040"></a>15040             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l15041"></a>15041             cmp         al, 254
<a name="l15042"></a>15042             jne         BlitNTL3
<a name="l15043"></a>15043 
<a name="l15044"></a>15044             <span class="comment">//          DO OUTLINE</span>
<a name="l15045"></a>15045             <span class="comment">//          ONLY IF WE WANT IT!</span>
<a name="l15046"></a>15046             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         al, fDoOutline;
<a name="l15047"></a>15047             cmp         al,   1
<a name="l15048"></a>15048             jne         BlitNTL2
<a name="l15049"></a>15049 
<a name="l15050"></a>15050             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, s16BPPColor
<a name="l15051"></a>15051             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax
<a name="l15052"></a>15052             jmp         BlitNTL2
<a name="l15053"></a>15053 
<a name="l15054"></a>15054 BlitNTL3:
<a name="l15055"></a>15055 
<a name="l15056"></a>15056             <span class="comment">//Write to z-buffer</span>
<a name="l15057"></a>15057             mov         [ebx], ax
<a name="l15058"></a>15058 
<a name="l15059"></a>15059             xor         eax, eax
<a name="l15060"></a>15060 
<a name="l15061"></a>15061             mov         al, [esi]
<a name="l15062"></a>15062             mov         ax, [edx+eax*2]
<a name="l15063"></a>15063             mov         [edi], ax
<a name="l15064"></a>15064 
<a name="l15065"></a>15065 BlitNTL2:
<a name="l15066"></a>15066             inc         esi
<a name="l15067"></a>15067             add         edi, 2
<a name="l15068"></a>15068             inc         ebx
<a name="l15069"></a>15069             inc         ebx
<a name="l15070"></a>15070             dec         cl
<a name="l15071"></a>15071             jnz         BlitNTL1
<a name="l15072"></a>15072 
<a name="l15073"></a>15073 <span class="comment">//BlitLineEnd:</span>
<a name="l15074"></a>15074             add         esi, Unblitted
<a name="l15075"></a>15075             jmp         BlitDispatch
<a name="l15076"></a>15076 
<a name="l15077"></a>15077 BlitTransparent:                                                              <span class="comment">// skip transparent pixels</span>
<a name="l15078"></a>15078 
<a name="l15079"></a>15079             and         ecx, 07fH
<a name="l15080"></a>15080             cmp         ecx, LSCount
<a name="l15081"></a>15081             jbe         BTrans1
<a name="l15082"></a>15082 
<a name="l15083"></a>15083             mov         ecx, LSCount
<a name="l15084"></a>15084 
<a name="l15085"></a>15085 BTrans1:
<a name="l15086"></a>15086 
<a name="l15087"></a>15087             sub         LSCount, ecx
<a name="l15088"></a>15088 <span class="comment">//          shl         ecx, 1</span>
<a name="l15089"></a>15089             add   ecx, ecx
<a name="l15090"></a>15090             add         edi, ecx
<a name="l15091"></a>15091             add         ebx, ecx
<a name="l15092"></a>15092             jmp         BlitDispatch
<a name="l15093"></a>15093 
<a name="l15094"></a>15094 
<a name="l15095"></a>15095 RightSkipLoop:                                                                      <span class="comment">// skip along until we hit and end-of-line marker</span>
<a name="l15096"></a>15096 
<a name="l15097"></a>15097 
<a name="l15098"></a>15098 RSLoop1:
<a name="l15099"></a>15099             mov         al, [esi]
<a name="l15100"></a>15100             inc         esi
<a name="l15101"></a>15101             or          al, al
<a name="l15102"></a>15102             jnz         RSLoop1
<a name="l15103"></a>15103 
<a name="l15104"></a>15104             dec         BlitHeight
<a name="l15105"></a>15105             jz          BlitDone
<a name="l15106"></a>15106             add         edi, LineSkip
<a name="l15107"></a>15107             add         ebx, LineSkip
<a name="l15108"></a>15108 
<a name="l15109"></a>15109             jmp         LeftSkipSetup
<a name="l15110"></a>15110 
<a name="l15111"></a>15111 
<a name="l15112"></a>15112 BlitDone:
<a name="l15113"></a>15113       }
<a name="l15114"></a>15114 
<a name="l15115"></a>15115       <span class="keywordflow">return</span>(TRUE);
<a name="l15116"></a>15116 
<a name="l15117"></a>15117 }
<a name="l15118"></a>15118 
<a name="l15119"></a>15119 
<a name="l15120"></a><a class="code" href="vobject__blitters_8h.html#95d566b5a64da200a69701259972a94b">15120</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#95d566b5a64da200a69701259972a94b">Blt8BPPDataTo16BPPBufferOutlineZPixelateObscuredClip</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> s16BPPColor, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fDoOutline, <a class="code" href="structSGPRect.html">SGPRect</a> *clipregion )
<a name="l15121"></a>15121 {
<a name="l15122"></a>15122       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l15123"></a>15123       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth, Unblitted;
<a name="l15124"></a>15124       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l15125"></a>15125       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l15126"></a>15126   <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l15127"></a>15127       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY, LeftSkip, RightSkip, TopSkip, BottomSkip, BlitLength, BlitHeight, LSCount;
<a name="l15128"></a>15128       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  ClipX1, ClipY1, ClipX2, ClipY2;
<a name="l15129"></a>15129       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l15130"></a>15130       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiLineFlag;
<a name="l15131"></a>15131 
<a name="l15132"></a>15132 
<a name="l15133"></a>15133       <span class="comment">// Assertions</span>
<a name="l15134"></a>15134       Assert( hSrcVObject != NULL );
<a name="l15135"></a>15135       Assert( pBuffer != NULL );
<a name="l15136"></a>15136 
<a name="l15137"></a>15137       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l15138"></a>15138       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l15139"></a>15139       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l15140"></a>15140       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l15141"></a>15141       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l15142"></a>15142 
<a name="l15143"></a>15143       <span class="comment">// Add to start position of dest buffer</span>
<a name="l15144"></a>15144       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l15145"></a>15145       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l15146"></a>15146 
<a name="l15147"></a>15147       <span class="keywordflow">if</span>(clipregion==NULL)
<a name="l15148"></a>15148       {
<a name="l15149"></a>15149             ClipX1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l15150"></a>15150             ClipY1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l15151"></a>15151             ClipX2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l15152"></a>15152             ClipY2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l15153"></a>15153       }
<a name="l15154"></a>15154       <span class="keywordflow">else</span>
<a name="l15155"></a>15155       {
<a name="l15156"></a>15156             ClipX1=clipregion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l15157"></a>15157             ClipY1=clipregion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l15158"></a>15158             ClipX2=clipregion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l15159"></a>15159             ClipY2=clipregion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l15160"></a>15160       }
<a name="l15161"></a>15161 
<a name="l15162"></a>15162       <span class="comment">// Calculate rows hanging off each side of the screen</span>
<a name="l15163"></a>15163       LeftSkip=__min(ClipX1 - min(ClipX1, iTempX), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l15164"></a>15164       RightSkip=__min(max(ClipX2, (iTempX+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth)) - ClipX2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l15165"></a>15165       TopSkip=__min(ClipY1 - __min(ClipY1, iTempY), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l15166"></a>15166       BottomSkip=__min(__max(ClipY2, (iTempY+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight)) - ClipY2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l15167"></a>15167 
<a name="l15168"></a>15168       <span class="comment">// calculate the remaining rows and columns to blit</span>
<a name="l15169"></a>15169       BlitLength=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth-LeftSkip-RightSkip);
<a name="l15170"></a>15170       BlitHeight=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight-TopSkip-BottomSkip);
<a name="l15171"></a>15171 
<a name="l15172"></a>15172       <span class="comment">// check if whole thing is clipped</span>
<a name="l15173"></a>15173       <span class="keywordflow">if</span>((LeftSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth) || (RightSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth))
<a name="l15174"></a>15174             <span class="keywordflow">return</span>(TRUE);
<a name="l15175"></a>15175 
<a name="l15176"></a>15176       <span class="comment">// check if whole thing is clipped</span>
<a name="l15177"></a>15177       <span class="keywordflow">if</span>((TopSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight) || (BottomSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight))
<a name="l15178"></a>15178             <span class="keywordflow">return</span>(TRUE);
<a name="l15179"></a>15179 
<a name="l15180"></a>15180       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l15181"></a>15181       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l15182"></a>15182       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l15183"></a>15183 
<a name="l15184"></a>15184       LineSkip=(uiDestPitchBYTES-(BlitLength*2));
<a name="l15185"></a>15185       p16BPPPalette = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#930609ad8d5cdbb05449df70bd83cfcd">pShadeCurrent</a>;
<a name="l15186"></a>15186       uiLineFlag=(iTempY&amp;1);
<a name="l15187"></a>15187 
<a name="l15188"></a>15188 
<a name="l15189"></a>15189       __asm {
<a name="l15190"></a>15190 
<a name="l15191"></a>15191             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l15192"></a>15192             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l15193"></a>15193             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, p16BPPPalette
<a name="l15194"></a>15194             xor         eax, eax
<a name="l15195"></a>15195             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l15196"></a>15196             xor         ecx, ecx
<a name="l15197"></a>15197 
<a name="l15198"></a>15198             cmp         TopSkip, 0                                      <span class="comment">// check for nothing clipped on top</span>
<a name="l15199"></a>15199             je          LeftSkipSetup
<a name="l15200"></a>15200 
<a name="l15201"></a>15201 TopSkipLoop:                                                            <span class="comment">// Skips the number of lines clipped at the top</span>
<a name="l15202"></a>15202 
<a name="l15203"></a>15203             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l15204"></a>15204             inc         esi
<a name="l15205"></a>15205             or          cl, cl
<a name="l15206"></a>15206             js          TopSkipLoop
<a name="l15207"></a>15207             jz          TSEndLine
<a name="l15208"></a>15208 
<a name="l15209"></a>15209             add         esi, ecx
<a name="l15210"></a>15210             jmp         TopSkipLoop
<a name="l15211"></a>15211 
<a name="l15212"></a>15212 TSEndLine:
<a name="l15213"></a>15213             dec         TopSkip
<a name="l15214"></a>15214             jnz         TopSkipLoop
<a name="l15215"></a>15215 
<a name="l15216"></a>15216 LeftSkipSetup:
<a name="l15217"></a>15217 
<a name="l15218"></a>15218             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l15219"></a>15219             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, LeftSkip
<a name="l15220"></a>15220             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l15221"></a>15221             or          eax, eax
<a name="l15222"></a>15222             jz          BlitLineSetup
<a name="l15223"></a>15223 
<a name="l15224"></a>15224 LeftSkipLoop:
<a name="l15225"></a>15225 
<a name="l15226"></a>15226             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l15227"></a>15227             inc         esi
<a name="l15228"></a>15228 
<a name="l15229"></a>15229             or          cl, cl
<a name="l15230"></a>15230             js          LSTrans
<a name="l15231"></a>15231 
<a name="l15232"></a>15232             cmp         ecx, LSCount
<a name="l15233"></a>15233             je          LSSkip2                                               <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l15234"></a>15234             jb          LSSkip1                                               <span class="comment">// if less, skip whole thing</span>
<a name="l15235"></a>15235 
<a name="l15236"></a>15236             add         esi, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l15237"></a>15237             sub         ecx, LSCount
<a name="l15238"></a>15238             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l15239"></a>15239             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l15240"></a>15240             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l15241"></a>15241             jmp         BlitNonTransLoop
<a name="l15242"></a>15242 
<a name="l15243"></a>15243 LSSkip2:
<a name="l15244"></a>15244             add         esi, ecx                                        <span class="comment">// skip whole run, and start blit with new run</span>
<a name="l15245"></a>15245             jmp         BlitLineSetup
<a name="l15246"></a>15246 
<a name="l15247"></a>15247 
<a name="l15248"></a>15248 LSSkip1:
<a name="l15249"></a>15249             add         esi, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l15250"></a>15250             sub         LSCount, ecx
<a name="l15251"></a>15251             jmp         LeftSkipLoop
<a name="l15252"></a>15252 
<a name="l15253"></a>15253 
<a name="l15254"></a>15254 LSTrans:
<a name="l15255"></a>15255             and         ecx, 07fH
<a name="l15256"></a>15256             cmp         ecx, LSCount
<a name="l15257"></a>15257             je          BlitLineSetup                             <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l15258"></a>15258             jb          LSTrans1                                        <span class="comment">// if less, skip whole thing</span>
<a name="l15259"></a>15259 
<a name="l15260"></a>15260             sub         ecx, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l15261"></a>15261             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l15262"></a>15262             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l15263"></a>15263             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l15264"></a>15264             jmp         BlitTransparent
<a name="l15265"></a>15265 
<a name="l15266"></a>15266 
<a name="l15267"></a>15267 LSTrans1:
<a name="l15268"></a>15268             sub         LSCount, ecx                                          <span class="comment">// skip whole run, continue skipping</span>
<a name="l15269"></a>15269             jmp         LeftSkipLoop
<a name="l15270"></a>15270 
<a name="l15271"></a>15271 
<a name="l15272"></a>15272 BlitLineSetup:                                                    <span class="comment">// Does any actual blitting (trans/non) for the line</span>
<a name="l15273"></a>15273             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l15274"></a>15274             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l15275"></a>15275             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l15276"></a>15276 
<a name="l15277"></a>15277 BlitDispatch:
<a name="l15278"></a>15278 
<a name="l15279"></a>15279             cmp         LSCount, 0                                      <span class="comment">// Check to see if we're done blitting</span>
<a name="l15280"></a>15280             je          RightSkipLoop
<a name="l15281"></a>15281 
<a name="l15282"></a>15282             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l15283"></a>15283             inc         esi
<a name="l15284"></a>15284             or          cl, cl
<a name="l15285"></a>15285             js          BlitTransparent
<a name="l15286"></a>15286 
<a name="l15287"></a>15287 BlitNonTransLoop:                                           <span class="comment">// blit non-transparent pixels</span>
<a name="l15288"></a>15288 
<a name="l15289"></a>15289             cmp         ecx, LSCount
<a name="l15290"></a>15290             jbe         BNTrans1
<a name="l15291"></a>15291 
<a name="l15292"></a>15292             sub         ecx, LSCount
<a name="l15293"></a>15293             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, ecx
<a name="l15294"></a>15294             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, LSCount
<a name="l15295"></a>15295 
<a name="l15296"></a>15296 BNTrans1:
<a name="l15297"></a>15297             sub         LSCount, ecx
<a name="l15298"></a>15298 
<a name="l15299"></a>15299 BlitNTL1:
<a name="l15300"></a>15300 
<a name="l15301"></a>15301             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, usZValue
<a name="l15302"></a>15302             cmp         ax, [ebx]
<a name="l15303"></a>15303             jb          <a class="code" href="vobject__blitters_8cpp.html#abf905a085ab39598c9c71ca8e8a0a0e">BlitNTL8</a>
<a name="l15304"></a>15304 
<a name="l15305"></a>15305             <span class="comment">// Write it now!</span>
<a name="l15306"></a>15306             jmp <a class="code" href="vobject__blitters_8cpp.html#d660d2ba340c8ef5d2d80c6365ad838f">BlitNTL7</a>
<a name="l15307"></a>15307 
<a name="l15308"></a>15308 <a class="code" href="vobject__blitters_8cpp.html#abf905a085ab39598c9c71ca8e8a0a0e">BlitNTL8</a>:
<a name="l15309"></a>15309 
<a name="l15310"></a>15310             <a class="code" href="structtest.html">test</a>  uiLineFlag, 1
<a name="l15311"></a>15311             jz          <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>
<a name="l15312"></a>15312 
<a name="l15313"></a>15313             <a class="code" href="structtest.html">test</a>  edi, 2
<a name="l15314"></a>15314             jz          BlitNTL2
<a name="l15315"></a>15315             jmp         <a class="code" href="vobject__blitters_8cpp.html#0e7ffd1e4d81460c5ee051765cc57418">BlitNTL9</a>
<a name="l15316"></a>15316 
<a name="l15317"></a>15317 
<a name="l15318"></a>15318 <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>:
<a name="l15319"></a>15319 
<a name="l15320"></a>15320             <a class="code" href="structtest.html">test</a>  edi, 2
<a name="l15321"></a>15321             jnz         BlitNTL2
<a name="l15322"></a>15322 
<a name="l15323"></a>15323 <a class="code" href="vobject__blitters_8cpp.html#d660d2ba340c8ef5d2d80c6365ad838f">BlitNTL7</a>:
<a name="l15324"></a>15324 
<a name="l15325"></a>15325             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [ebx], ax
<a name="l15326"></a>15326 
<a name="l15327"></a>15327 <a class="code" href="vobject__blitters_8cpp.html#0e7ffd1e4d81460c5ee051765cc57418">BlitNTL9</a>:
<a name="l15328"></a>15328 
<a name="l15329"></a>15329             <span class="comment">// CHECK FOR OUTLINE...</span>
<a name="l15330"></a>15330             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l15331"></a>15331             cmp         al, 254
<a name="l15332"></a>15332             jne         BlitNTL3
<a name="l15333"></a>15333 
<a name="l15334"></a>15334             <span class="comment">//          DO OUTLINE</span>
<a name="l15335"></a>15335             <span class="comment">//          ONLY IF WE WANT IT!</span>
<a name="l15336"></a>15336             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         al, fDoOutline;
<a name="l15337"></a>15337             cmp         al,   1
<a name="l15338"></a>15338             jne         BlitNTL2
<a name="l15339"></a>15339 
<a name="l15340"></a>15340             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, s16BPPColor
<a name="l15341"></a>15341             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [<a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>], ax
<a name="l15342"></a>15342             jmp         BlitNTL2
<a name="l15343"></a>15343 
<a name="l15344"></a>15344 BlitNTL3:
<a name="l15345"></a>15345 
<a name="l15346"></a>15346             <span class="comment">//Write to z-buffer</span>
<a name="l15347"></a>15347             mov         [ebx], ax
<a name="l15348"></a>15348 
<a name="l15349"></a>15349             xor         eax, eax
<a name="l15350"></a>15350 
<a name="l15351"></a>15351             mov         al, [esi]
<a name="l15352"></a>15352             mov         ax, [edx+eax*2]
<a name="l15353"></a>15353             mov         [<a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>], ax
<a name="l15354"></a>15354 
<a name="l15355"></a>15355 BlitNTL2:
<a name="l15356"></a>15356             inc         esi
<a name="l15357"></a>15357             add         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, 2
<a name="l15358"></a>15358             inc         ebx
<a name="l15359"></a>15359             inc         ebx
<a name="l15360"></a>15360             dec         cl
<a name="l15361"></a>15361             jnz         BlitNTL1
<a name="l15362"></a>15362 
<a name="l15363"></a>15363 <span class="comment">//BlitLineEnd:</span>
<a name="l15364"></a>15364             add         esi, Unblitted
<a name="l15365"></a>15365             jmp         BlitDispatch
<a name="l15366"></a>15366 
<a name="l15367"></a>15367 BlitTransparent:                                                              <span class="comment">// skip transparent pixels</span>
<a name="l15368"></a>15368 
<a name="l15369"></a>15369             and         ecx, 07fH
<a name="l15370"></a>15370             cmp         ecx, LSCount
<a name="l15371"></a>15371             jbe         BTrans1
<a name="l15372"></a>15372 
<a name="l15373"></a>15373             mov         ecx, LSCount
<a name="l15374"></a>15374 
<a name="l15375"></a>15375 BTrans1:
<a name="l15376"></a>15376 
<a name="l15377"></a>15377             sub         LSCount, ecx
<a name="l15378"></a>15378 <span class="comment">//          shl         ecx, 1</span>
<a name="l15379"></a>15379             add   ecx, ecx
<a name="l15380"></a>15380             add         edi, ecx
<a name="l15381"></a>15381             add         ebx, ecx
<a name="l15382"></a>15382             jmp         BlitDispatch
<a name="l15383"></a>15383 
<a name="l15384"></a>15384 
<a name="l15385"></a>15385 RightSkipLoop:                                                                      <span class="comment">// skip along until we hit and end-of-line marker</span>
<a name="l15386"></a>15386 
<a name="l15387"></a>15387 
<a name="l15388"></a>15388 RSLoop1:
<a name="l15389"></a>15389             mov         al, [esi]
<a name="l15390"></a>15390             inc         esi
<a name="l15391"></a>15391             or          al, al
<a name="l15392"></a>15392             jnz         RSLoop1
<a name="l15393"></a>15393 
<a name="l15394"></a>15394             dec         BlitHeight
<a name="l15395"></a>15395             jz          BlitDone
<a name="l15396"></a>15396             add         edi, LineSkip
<a name="l15397"></a>15397             add         ebx, LineSkip
<a name="l15398"></a>15398             xor         uiLineFlag, 1
<a name="l15399"></a>15399 
<a name="l15400"></a>15400             jmp         LeftSkipSetup
<a name="l15401"></a>15401 
<a name="l15402"></a>15402 
<a name="l15403"></a>15403 BlitDone:
<a name="l15404"></a>15404       }
<a name="l15405"></a>15405 
<a name="l15406"></a>15406       <span class="keywordflow">return</span>(TRUE);
<a name="l15407"></a>15407 
<a name="l15408"></a>15408 }
<a name="l15409"></a>15409 
<a name="l15410"></a>15410 
<a name="l15411"></a>15411 
<a name="l15412"></a><a class="code" href="vobject__blitters_8h.html#4a8776f4fb57a9f9c1a750b9dba098f6">15412</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#4a8776f4fb57a9f9c1a750b9dba098f6">Blt8BPPDataTo16BPPBufferOutlineShadow</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex )
<a name="l15413"></a>15413 {
<a name="l15414"></a>15414       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l15415"></a>15415       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth;
<a name="l15416"></a>15416       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr;
<a name="l15417"></a>15417       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l15418"></a>15418       <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l15419"></a>15419       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l15420"></a>15420       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l15421"></a>15421 
<a name="l15422"></a>15422 
<a name="l15423"></a>15423       <span class="comment">// Assertions</span>
<a name="l15424"></a>15424       Assert( hSrcVObject != NULL );
<a name="l15425"></a>15425       Assert( pBuffer != NULL );
<a name="l15426"></a>15426 
<a name="l15427"></a>15427       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l15428"></a>15428       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l15429"></a>15429       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l15430"></a>15430       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l15431"></a>15431       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l15432"></a>15432 
<a name="l15433"></a>15433       <span class="comment">// Add to start position of dest buffer</span>
<a name="l15434"></a>15434       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l15435"></a>15435       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l15436"></a>15436 
<a name="l15437"></a>15437       <span class="comment">// Validations</span>
<a name="l15438"></a>15438       CHECKF( iTempX &gt;= 0 );
<a name="l15439"></a>15439       CHECKF( iTempY &gt;= 0 );
<a name="l15440"></a>15440 
<a name="l15441"></a>15441 
<a name="l15442"></a>15442       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l15443"></a>15443       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l15444"></a>15444       LineSkip=(uiDestPitchBYTES-(usWidth*2));
<a name="l15445"></a>15445       p16BPPPalette = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#930609ad8d5cdbb05449df70bd83cfcd">pShadeCurrent</a>;
<a name="l15446"></a>15446 
<a name="l15447"></a>15447       __asm {
<a name="l15448"></a>15448 
<a name="l15449"></a>15449             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l15450"></a>15450             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l15451"></a>15451             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, p16BPPPalette
<a name="l15452"></a>15452             xor         eax, eax
<a name="l15453"></a>15453             xor         ecx, ecx
<a name="l15454"></a>15454 
<a name="l15455"></a>15455 BlitDispatch:
<a name="l15456"></a>15456 
<a name="l15457"></a>15457             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l15458"></a>15458             inc         esi
<a name="l15459"></a>15459             or          cl, cl
<a name="l15460"></a>15460             js          BlitTransparent
<a name="l15461"></a>15461             jz          BlitDoneLine
<a name="l15462"></a>15462 
<a name="l15463"></a>15463 <span class="comment">//BlitNonTransLoop:</span>
<a name="l15464"></a>15464 
<a name="l15465"></a>15465 BlitNTL4:
<a name="l15466"></a>15466 
<a name="l15467"></a>15467             xor         eax, eax
<a name="l15468"></a>15468             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l15469"></a>15469             cmp         al, 254
<a name="l15470"></a>15470             je          BlitNTL5
<a name="l15471"></a>15471 
<a name="l15472"></a>15472             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [edi]
<a name="l15473"></a>15473             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, <a class="code" href="shading_8cpp.html#fd38e38bdd68f0da44ac96abacf3b2a6">ShadeTable</a>[eax*2]
<a name="l15474"></a>15474             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax
<a name="l15475"></a>15475 
<a name="l15476"></a>15476 
<a name="l15477"></a>15477 BlitNTL5:
<a name="l15478"></a>15478             inc         esi
<a name="l15479"></a>15479             add         edi, 2
<a name="l15480"></a>15480             dec         cl
<a name="l15481"></a>15481             jnz         BlitNTL4
<a name="l15482"></a>15482 
<a name="l15483"></a>15483             jmp         BlitDispatch
<a name="l15484"></a>15484 
<a name="l15485"></a>15485 
<a name="l15486"></a>15486 BlitTransparent:
<a name="l15487"></a>15487 
<a name="l15488"></a>15488             and         ecx, 07fH
<a name="l15489"></a>15489 <span class="comment">//          shl         ecx, 1</span>
<a name="l15490"></a>15490             add   ecx, ecx
<a name="l15491"></a>15491             add         edi, ecx
<a name="l15492"></a>15492             jmp         BlitDispatch
<a name="l15493"></a>15493 
<a name="l15494"></a>15494 
<a name="l15495"></a>15495 BlitDoneLine:
<a name="l15496"></a>15496 
<a name="l15497"></a>15497             dec         usHeight
<a name="l15498"></a>15498             jz          BlitDone
<a name="l15499"></a>15499             add         edi, LineSkip
<a name="l15500"></a>15500             jmp         BlitDispatch
<a name="l15501"></a>15501 
<a name="l15502"></a>15502 
<a name="l15503"></a>15503 BlitDone:
<a name="l15504"></a>15504       }
<a name="l15505"></a>15505 
<a name="l15506"></a>15506       <span class="keywordflow">return</span>(TRUE);
<a name="l15507"></a>15507 
<a name="l15508"></a>15508 }
<a name="l15509"></a>15509 
<a name="l15510"></a>15510 
<a name="l15511"></a>15511 
<a name="l15512"></a><a class="code" href="vobject__blitters_8h.html#278a68ece89e0015979866249c4394d5">15512</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#278a68ece89e0015979866249c4394d5">Blt8BPPDataTo16BPPBufferOutlineShadowClip</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="structSGPRect.html">SGPRect</a> *clipregion )
<a name="l15513"></a>15513 {
<a name="l15514"></a>15514       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l15515"></a>15515       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l15516"></a>15516       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth, Unblitted;
<a name="l15517"></a>15517       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr;
<a name="l15518"></a>15518       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l15519"></a>15519   <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l15520"></a>15520       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY, LeftSkip, RightSkip, TopSkip, BottomSkip, BlitLength, BlitHeight;
<a name="l15521"></a>15521       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  ClipX1, ClipY1, ClipX2, ClipY2;
<a name="l15522"></a>15522 
<a name="l15523"></a>15523       <span class="comment">// Assertions</span>
<a name="l15524"></a>15524       Assert( hSrcVObject != NULL );
<a name="l15525"></a>15525       Assert( pBuffer != NULL );
<a name="l15526"></a>15526 
<a name="l15527"></a>15527       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l15528"></a>15528       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l15529"></a>15529       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l15530"></a>15530       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l15531"></a>15531       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l15532"></a>15532 
<a name="l15533"></a>15533       <span class="comment">// Add to start position of dest buffer</span>
<a name="l15534"></a>15534       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l15535"></a>15535       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l15536"></a>15536 
<a name="l15537"></a>15537       <span class="keywordflow">if</span>(clipregion==NULL)
<a name="l15538"></a>15538       {
<a name="l15539"></a>15539             ClipX1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l15540"></a>15540             ClipY1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l15541"></a>15541             ClipX2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l15542"></a>15542             ClipY2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l15543"></a>15543       }
<a name="l15544"></a>15544       <span class="keywordflow">else</span>
<a name="l15545"></a>15545       {
<a name="l15546"></a>15546             ClipX1=clipregion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l15547"></a>15547             ClipY1=clipregion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l15548"></a>15548             ClipX2=clipregion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l15549"></a>15549             ClipY2=clipregion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l15550"></a>15550       }
<a name="l15551"></a>15551 
<a name="l15552"></a>15552       <span class="comment">// Calculate rows hanging off each side of the screen</span>
<a name="l15553"></a>15553       LeftSkip=__min(ClipX1 - min(ClipX1, iTempX), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l15554"></a>15554       RightSkip=__min(max(ClipX2, (iTempX+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth)) - ClipX2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l15555"></a>15555       TopSkip=__min(ClipY1 - __min(ClipY1, iTempY), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l15556"></a>15556       BottomSkip=__min(__max(ClipY2, (iTempY+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight)) - ClipY2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l15557"></a>15557 
<a name="l15558"></a>15558       <span class="comment">// calculate the remaining rows and columns to blit</span>
<a name="l15559"></a>15559       BlitLength=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth-LeftSkip-RightSkip);
<a name="l15560"></a>15560       BlitHeight=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight-TopSkip-BottomSkip);
<a name="l15561"></a>15561 
<a name="l15562"></a>15562       <span class="comment">// whole thing is clipped</span>
<a name="l15563"></a>15563       <span class="keywordflow">if</span>((LeftSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth) || (RightSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth))
<a name="l15564"></a>15564             <span class="keywordflow">return</span>(TRUE);
<a name="l15565"></a>15565 
<a name="l15566"></a>15566       <span class="comment">// whole thing is clipped</span>
<a name="l15567"></a>15567       <span class="keywordflow">if</span>((TopSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight) || (BottomSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight))
<a name="l15568"></a>15568             <span class="keywordflow">return</span>(TRUE);
<a name="l15569"></a>15569 
<a name="l15570"></a>15570       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l15571"></a>15571       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l15572"></a>15572       p16BPPPalette = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#930609ad8d5cdbb05449df70bd83cfcd">pShadeCurrent</a>;
<a name="l15573"></a>15573       LineSkip=(uiDestPitchBYTES-(BlitLength*2));
<a name="l15574"></a>15574 
<a name="l15575"></a>15575       __asm {
<a name="l15576"></a>15576 
<a name="l15577"></a>15577             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l15578"></a>15578             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l15579"></a>15579             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, OFFSET <a class="code" href="shading_8cpp.html#fd38e38bdd68f0da44ac96abacf3b2a6">ShadeTable</a>
<a name="l15580"></a>15580             xor         eax, eax
<a name="l15581"></a>15581             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, TopSkip
<a name="l15582"></a>15582             xor         ecx, ecx
<a name="l15583"></a>15583 
<a name="l15584"></a>15584             or          ebx, ebx                                        <span class="comment">// check for nothing clipped on top</span>
<a name="l15585"></a>15585             jz          LeftSkipSetup
<a name="l15586"></a>15586 
<a name="l15587"></a>15587 TopSkipLoop:                                                            <span class="comment">// Skips the number of lines clipped at the top</span>
<a name="l15588"></a>15588 
<a name="l15589"></a>15589             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l15590"></a>15590             inc         esi
<a name="l15591"></a>15591             or          cl, cl
<a name="l15592"></a>15592             js          TopSkipLoop
<a name="l15593"></a>15593             jz          TSEndLine
<a name="l15594"></a>15594 
<a name="l15595"></a>15595 
<a name="l15596"></a>15596 <span class="comment">// Check for outline as well</span>
<a name="l15597"></a>15597             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l15598"></a>15598             cmp         cl, 254
<a name="l15599"></a>15599             je          TopSkipLoop
<a name="l15600"></a>15600 <span class="comment">//</span>
<a name="l15601"></a>15601 
<a name="l15602"></a>15602             add         esi, ecx
<a name="l15603"></a>15603             jmp         TopSkipLoop
<a name="l15604"></a>15604 
<a name="l15605"></a>15605 TSEndLine:
<a name="l15606"></a>15606             dec         ebx
<a name="l15607"></a>15607             jnz         TopSkipLoop
<a name="l15608"></a>15608 
<a name="l15609"></a>15609 
<a name="l15610"></a>15610 
<a name="l15611"></a>15611 
<a name="l15612"></a>15612 LeftSkipSetup:
<a name="l15613"></a>15613 
<a name="l15614"></a>15614             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l15615"></a>15615             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, LeftSkip                             <span class="comment">// check for nothing clipped on the left</span>
<a name="l15616"></a>15616             or          ebx, ebx
<a name="l15617"></a>15617             jz          BlitLineSetup
<a name="l15618"></a>15618 
<a name="l15619"></a>15619 LeftSkipLoop:
<a name="l15620"></a>15620 
<a name="l15621"></a>15621             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l15622"></a>15622             inc         esi
<a name="l15623"></a>15623 
<a name="l15624"></a>15624             or          cl, cl
<a name="l15625"></a>15625             js          LSTrans
<a name="l15626"></a>15626 
<a name="l15627"></a>15627             cmp         ecx, ebx
<a name="l15628"></a>15628             je          LSSkip2                                               <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l15629"></a>15629             jb          LSSkip1                                               <span class="comment">// if less, skip whole thing</span>
<a name="l15630"></a>15630 
<a name="l15631"></a>15631             add         esi, ebx                                        <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l15632"></a>15632             sub         ecx, ebx
<a name="l15633"></a>15633             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, BlitLength
<a name="l15634"></a>15634             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l15635"></a>15635             jmp         BlitNonTransLoop
<a name="l15636"></a>15636 
<a name="l15637"></a>15637 LSSkip2:
<a name="l15638"></a>15638             add         esi, ecx                                        <span class="comment">// skip whole run, and start blit with new run</span>
<a name="l15639"></a>15639             jmp         BlitLineSetup
<a name="l15640"></a>15640 
<a name="l15641"></a>15641 
<a name="l15642"></a>15642 LSSkip1:
<a name="l15643"></a>15643             add         esi, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l15644"></a>15644             sub         ebx, ecx
<a name="l15645"></a>15645             jmp         LeftSkipLoop
<a name="l15646"></a>15646 
<a name="l15647"></a>15647 
<a name="l15648"></a>15648 LSTrans:
<a name="l15649"></a>15649             and         ecx, 07fH
<a name="l15650"></a>15650             cmp         ecx, ebx
<a name="l15651"></a>15651             je          BlitLineSetup                             <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l15652"></a>15652             jb          LSTrans1                                        <span class="comment">// if less, skip whole thing</span>
<a name="l15653"></a>15653 
<a name="l15654"></a>15654             sub         ecx, ebx                                        <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l15655"></a>15655             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, BlitLength
<a name="l15656"></a>15656             jmp         BlitTransparent
<a name="l15657"></a>15657 
<a name="l15658"></a>15658 
<a name="l15659"></a>15659 LSTrans1:
<a name="l15660"></a>15660             sub         ebx, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l15661"></a>15661             jmp         LeftSkipLoop
<a name="l15662"></a>15662 
<a name="l15663"></a>15663 
<a name="l15664"></a>15664 
<a name="l15665"></a>15665 
<a name="l15666"></a>15666 BlitLineSetup:                                                    <span class="comment">// Does any actual blitting (trans/non) for the line</span>
<a name="l15667"></a>15667             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, BlitLength
<a name="l15668"></a>15668             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l15669"></a>15669 
<a name="l15670"></a>15670 BlitDispatch:
<a name="l15671"></a>15671 
<a name="l15672"></a>15672             or          ebx, ebx                                        <span class="comment">// Check to see if we're done blitting</span>
<a name="l15673"></a>15673             jz          RightSkipLoop
<a name="l15674"></a>15674 
<a name="l15675"></a>15675             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l15676"></a>15676             inc         esi
<a name="l15677"></a>15677             or          cl, cl
<a name="l15678"></a>15678             js          BlitTransparent
<a name="l15679"></a>15679 
<a name="l15680"></a>15680 BlitNonTransLoop:
<a name="l15681"></a>15681 
<a name="l15682"></a>15682             cmp         ecx, ebx
<a name="l15683"></a>15683             jbe         BNTrans1
<a name="l15684"></a>15684 
<a name="l15685"></a>15685             sub         ecx, ebx
<a name="l15686"></a>15686             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, ecx
<a name="l15687"></a>15687             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, ebx
<a name="l15688"></a>15688 
<a name="l15689"></a>15689 BNTrans1:
<a name="l15690"></a>15690             sub         ebx, ecx
<a name="l15691"></a>15691 
<a name="l15692"></a>15692             clc
<a name="l15693"></a>15693             rcr         cl, 1
<a name="l15694"></a>15694             jnc         BlitNTL2
<a name="l15695"></a>15695 
<a name="l15696"></a>15696             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [edi]
<a name="l15697"></a>15697             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, [edx+eax*2]
<a name="l15698"></a>15698             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax
<a name="l15699"></a>15699 
<a name="l15700"></a>15700             inc         esi
<a name="l15701"></a>15701             add         edi, 2
<a name="l15702"></a>15702 
<a name="l15703"></a>15703 BlitNTL2:
<a name="l15704"></a>15704             clc
<a name="l15705"></a>15705             rcr         cl, 1
<a name="l15706"></a>15706             jnc         BlitNTL3
<a name="l15707"></a>15707 
<a name="l15708"></a>15708             mov         ax, [edi]
<a name="l15709"></a>15709             mov         ax, [edx+eax*2]
<a name="l15710"></a>15710             mov         [edi], ax
<a name="l15711"></a>15711 
<a name="l15712"></a>15712             mov         ax, [edi+2]
<a name="l15713"></a>15713             mov         ax, [edx+eax*2]
<a name="l15714"></a>15714             mov         [edi+2], ax
<a name="l15715"></a>15715 
<a name="l15716"></a>15716             add         esi, 2
<a name="l15717"></a>15717             add         edi, 4
<a name="l15718"></a>15718 
<a name="l15719"></a>15719 BlitNTL3:
<a name="l15720"></a>15720 
<a name="l15721"></a>15721             or          cl, cl
<a name="l15722"></a>15722             jz          BlitLineEnd
<a name="l15723"></a>15723 
<a name="l15724"></a>15724 BlitNTL4:
<a name="l15725"></a>15725 
<a name="l15726"></a>15726             mov         ax, [edi]
<a name="l15727"></a>15727             mov         ax, [edx+eax*2]
<a name="l15728"></a>15728             mov         [edi], ax
<a name="l15729"></a>15729 
<a name="l15730"></a>15730             mov         ax, [edi+2]
<a name="l15731"></a>15731             mov         ax, [edx+eax*2]
<a name="l15732"></a>15732             mov         [edi+2], ax
<a name="l15733"></a>15733 
<a name="l15734"></a>15734             mov         ax, [edi+4]
<a name="l15735"></a>15735             mov         ax, [edx+eax*2]
<a name="l15736"></a>15736             mov         [edi+4], ax
<a name="l15737"></a>15737 
<a name="l15738"></a>15738             mov         ax, [edi+6]
<a name="l15739"></a>15739             mov         ax, [edx+eax*2]
<a name="l15740"></a>15740             mov         [edi+6], ax
<a name="l15741"></a>15741 
<a name="l15742"></a>15742             add         esi, 4
<a name="l15743"></a>15743             add         edi, 8
<a name="l15744"></a>15744             dec         cl
<a name="l15745"></a>15745             jnz         BlitNTL4
<a name="l15746"></a>15746 
<a name="l15747"></a>15747 BlitLineEnd:
<a name="l15748"></a>15748             add         esi, Unblitted
<a name="l15749"></a>15749             jmp         BlitDispatch
<a name="l15750"></a>15750 
<a name="l15751"></a>15751 BlitTransparent:
<a name="l15752"></a>15752 
<a name="l15753"></a>15753             and         ecx, 07fH
<a name="l15754"></a>15754             cmp         ecx, ebx
<a name="l15755"></a>15755             jbe         BTrans1
<a name="l15756"></a>15756 
<a name="l15757"></a>15757             mov         ecx, ebx
<a name="l15758"></a>15758 
<a name="l15759"></a>15759 BTrans1:
<a name="l15760"></a>15760 
<a name="l15761"></a>15761             sub         ebx, ecx
<a name="l15762"></a>15762 <span class="comment">//          shl         ecx, 1</span>
<a name="l15763"></a>15763             add   ecx, ecx
<a name="l15764"></a>15764             add         edi, ecx
<a name="l15765"></a>15765             jmp         BlitDispatch
<a name="l15766"></a>15766 
<a name="l15767"></a>15767 
<a name="l15768"></a>15768 RightSkipLoop:
<a name="l15769"></a>15769 
<a name="l15770"></a>15770 
<a name="l15771"></a>15771 RSLoop1:
<a name="l15772"></a>15772             mov         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l15773"></a>15773             inc         esi
<a name="l15774"></a>15774             or          al, al
<a name="l15775"></a>15775             jnz         RSLoop1
<a name="l15776"></a>15776 
<a name="l15777"></a>15777             dec         BlitHeight
<a name="l15778"></a>15778             jz          BlitDone
<a name="l15779"></a>15779             add         edi, LineSkip
<a name="l15780"></a>15780 
<a name="l15781"></a>15781             jmp         LeftSkipSetup
<a name="l15782"></a>15782 
<a name="l15783"></a>15783 
<a name="l15784"></a>15784 BlitDone:
<a name="l15785"></a>15785       }
<a name="l15786"></a>15786 
<a name="l15787"></a>15787       <span class="keywordflow">return</span>(TRUE);
<a name="l15788"></a>15788 
<a name="l15789"></a>15789 }
<a name="l15790"></a>15790 
<a name="l15791"></a>15791 
<a name="l15792"></a><a class="code" href="vobject__blitters_8h.html#8e2cae6a877c14e853622672823b74f9">15792</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#8e2cae6a877c14e853622672823b74f9">Blt8BPPDataTo16BPPBufferOutlineZ</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> s16BPPColor, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fDoOutline )
<a name="l15793"></a>15793 {
<a name="l15794"></a>15794       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l15795"></a>15795       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l15796"></a>15796       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth;
<a name="l15797"></a>15797       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l15798"></a>15798       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l15799"></a>15799       <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l15800"></a>15800       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l15801"></a>15801 
<a name="l15802"></a>15802 
<a name="l15803"></a>15803       <span class="comment">// Assertions</span>
<a name="l15804"></a>15804       Assert( hSrcVObject != NULL );
<a name="l15805"></a>15805       Assert( pBuffer != NULL );
<a name="l15806"></a>15806 
<a name="l15807"></a>15807       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l15808"></a>15808       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l15809"></a>15809       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l15810"></a>15810       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l15811"></a>15811       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l15812"></a>15812 
<a name="l15813"></a>15813       <span class="comment">// Add to start position of dest buffer</span>
<a name="l15814"></a>15814       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l15815"></a>15815       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l15816"></a>15816 
<a name="l15817"></a>15817       <span class="comment">// Validations</span>
<a name="l15818"></a>15818       CHECKF( iTempX &gt;= 0 );
<a name="l15819"></a>15819       CHECKF( iTempY &gt;= 0 );
<a name="l15820"></a>15820 
<a name="l15821"></a>15821 
<a name="l15822"></a>15822       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l15823"></a>15823       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l15824"></a>15824       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l15825"></a>15825       p16BPPPalette = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#930609ad8d5cdbb05449df70bd83cfcd">pShadeCurrent</a>;
<a name="l15826"></a>15826       LineSkip=(uiDestPitchBYTES-(usWidth*2));
<a name="l15827"></a>15827 
<a name="l15828"></a>15828       __asm {
<a name="l15829"></a>15829 
<a name="l15830"></a>15830             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l15831"></a>15831             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l15832"></a>15832             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, p16BPPPalette
<a name="l15833"></a>15833             xor         eax, eax
<a name="l15834"></a>15834             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l15835"></a>15835             xor         ecx, ecx
<a name="l15836"></a>15836 
<a name="l15837"></a>15837 BlitDispatch:
<a name="l15838"></a>15838 
<a name="l15839"></a>15839             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l15840"></a>15840             inc         esi
<a name="l15841"></a>15841             or          cl, cl
<a name="l15842"></a>15842             js          BlitTransparent
<a name="l15843"></a>15843             jz          BlitDoneLine
<a name="l15844"></a>15844 
<a name="l15845"></a>15845 <span class="comment">//BlitNonTransLoop:</span>
<a name="l15846"></a>15846 
<a name="l15847"></a>15847             xor         eax, eax
<a name="l15848"></a>15848 
<a name="l15849"></a>15849 BlitNTL4:
<a name="l15850"></a>15850 
<a name="l15851"></a>15851             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, usZValue
<a name="l15852"></a>15852             cmp         ax, [ebx]
<a name="l15853"></a>15853             jb          BlitNTL5
<a name="l15854"></a>15854 
<a name="l15855"></a>15855             <span class="comment">// CHECK FOR OUTLINE, BLIT DIFFERENTLY IF WE WANT IT TO!</span>
<a name="l15856"></a>15856             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l15857"></a>15857             cmp         al, 254
<a name="l15858"></a>15858             jne         <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>
<a name="l15859"></a>15859 
<a name="l15860"></a>15860             <span class="comment">//          DO OUTLINE</span>
<a name="l15861"></a>15861             <span class="comment">//          ONLY IF WE WANT IT!</span>
<a name="l15862"></a>15862             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         al, fDoOutline;
<a name="l15863"></a>15863             cmp         al,   1
<a name="l15864"></a>15864             jne         BlitNTL5
<a name="l15865"></a>15865 
<a name="l15866"></a>15866             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, s16BPPColor
<a name="l15867"></a>15867             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax
<a name="l15868"></a>15868             jmp         BlitNTL5
<a name="l15869"></a>15869 
<a name="l15870"></a>15870 <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>:
<a name="l15871"></a>15871 
<a name="l15872"></a>15872             <span class="comment">//Donot write to z-buffer</span>
<a name="l15873"></a>15873             mov         [ebx], ax
<a name="l15874"></a>15874 
<a name="l15875"></a>15875             xor         ah, ah
<a name="l15876"></a>15876             mov         al, [esi]
<a name="l15877"></a>15877             mov         ax, [edx+eax*2]
<a name="l15878"></a>15878             mov         [edi], ax
<a name="l15879"></a>15879 
<a name="l15880"></a>15880 BlitNTL5:
<a name="l15881"></a>15881             inc         esi
<a name="l15882"></a>15882             inc         edi
<a name="l15883"></a>15883             inc         ebx
<a name="l15884"></a>15884             inc         edi
<a name="l15885"></a>15885             inc         ebx
<a name="l15886"></a>15886 
<a name="l15887"></a>15887             dec         cl
<a name="l15888"></a>15888             jnz         BlitNTL4
<a name="l15889"></a>15889 
<a name="l15890"></a>15890             jmp         BlitDispatch
<a name="l15891"></a>15891 
<a name="l15892"></a>15892 
<a name="l15893"></a>15893 BlitTransparent:
<a name="l15894"></a>15894 
<a name="l15895"></a>15895             and         ecx, 07fH
<a name="l15896"></a>15896 <span class="comment">//          shl         ecx, 1</span>
<a name="l15897"></a>15897             add   ecx, ecx
<a name="l15898"></a>15898             add         edi, ecx
<a name="l15899"></a>15899             add         ebx, ecx
<a name="l15900"></a>15900             jmp         BlitDispatch
<a name="l15901"></a>15901 
<a name="l15902"></a>15902 
<a name="l15903"></a>15903 BlitDoneLine:
<a name="l15904"></a>15904 
<a name="l15905"></a>15905             dec         usHeight
<a name="l15906"></a>15906             jz          BlitDone
<a name="l15907"></a>15907             add         edi, LineSkip
<a name="l15908"></a>15908             add         ebx, LineSkip
<a name="l15909"></a>15909             jmp         BlitDispatch
<a name="l15910"></a>15910 
<a name="l15911"></a>15911 
<a name="l15912"></a>15912 BlitDone:
<a name="l15913"></a>15913       }
<a name="l15914"></a>15914 
<a name="l15915"></a>15915       <span class="keywordflow">return</span>(TRUE);
<a name="l15916"></a>15916 
<a name="l15917"></a>15917 }
<a name="l15918"></a>15918 
<a name="l15919"></a>15919 
<a name="l15920"></a><a class="code" href="vobject__blitters_8h.html#d881b2e01360797cb5a653363ca7ffef">15920</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#d881b2e01360797cb5a653363ca7ffef">Blt8BPPDataTo16BPPBufferOutlineZPixelateObscured</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> s16BPPColor, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fDoOutline )
<a name="l15921"></a>15921 {
<a name="l15922"></a>15922       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l15923"></a>15923       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l15924"></a>15924       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth;
<a name="l15925"></a>15925       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l15926"></a>15926       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l15927"></a>15927       <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l15928"></a>15928       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l15929"></a>15929       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiLineFlag;
<a name="l15930"></a>15930 
<a name="l15931"></a>15931 
<a name="l15932"></a>15932       <span class="comment">// Assertions</span>
<a name="l15933"></a>15933       Assert( hSrcVObject != NULL );
<a name="l15934"></a>15934       Assert( pBuffer != NULL );
<a name="l15935"></a>15935 
<a name="l15936"></a>15936       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l15937"></a>15937       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l15938"></a>15938       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l15939"></a>15939       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l15940"></a>15940       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l15941"></a>15941 
<a name="l15942"></a>15942       <span class="comment">// Add to start position of dest buffer</span>
<a name="l15943"></a>15943       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l15944"></a>15944       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l15945"></a>15945 
<a name="l15946"></a>15946       <span class="comment">// Validations</span>
<a name="l15947"></a>15947       CHECKF( iTempX &gt;= 0 );
<a name="l15948"></a>15948       CHECKF( iTempY &gt;= 0 );
<a name="l15949"></a>15949 
<a name="l15950"></a>15950 
<a name="l15951"></a>15951       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l15952"></a>15952       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l15953"></a>15953       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l15954"></a>15954       p16BPPPalette = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#930609ad8d5cdbb05449df70bd83cfcd">pShadeCurrent</a>;
<a name="l15955"></a>15955       LineSkip=(uiDestPitchBYTES-(usWidth*2));
<a name="l15956"></a>15956       uiLineFlag=(iTempY&amp;1);
<a name="l15957"></a>15957 
<a name="l15958"></a>15958       __asm {
<a name="l15959"></a>15959 
<a name="l15960"></a>15960             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l15961"></a>15961             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l15962"></a>15962             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, p16BPPPalette
<a name="l15963"></a>15963             xor         eax, eax
<a name="l15964"></a>15964             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l15965"></a>15965             xor         ecx, ecx
<a name="l15966"></a>15966 
<a name="l15967"></a>15967 BlitDispatch:
<a name="l15968"></a>15968 
<a name="l15969"></a>15969             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l15970"></a>15970             inc         esi
<a name="l15971"></a>15971             or          cl, cl
<a name="l15972"></a>15972             js          BlitTransparent
<a name="l15973"></a>15973             jz          BlitDoneLine
<a name="l15974"></a>15974 
<a name="l15975"></a>15975 <span class="comment">//BlitNonTransLoop:</span>
<a name="l15976"></a>15976 
<a name="l15977"></a>15977             xor         eax, eax
<a name="l15978"></a>15978 
<a name="l15979"></a>15979 BlitNTL4:
<a name="l15980"></a>15980 
<a name="l15981"></a>15981             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, usZValue
<a name="l15982"></a>15982             cmp         ax, [ebx]
<a name="l15983"></a>15983             jbe         <a class="code" href="vobject__blitters_8cpp.html#abf905a085ab39598c9c71ca8e8a0a0e">BlitNTL8</a>
<a name="l15984"></a>15984 
<a name="l15985"></a>15985             <span class="comment">// Write it now!</span>
<a name="l15986"></a>15986             jmp <a class="code" href="vobject__blitters_8cpp.html#d660d2ba340c8ef5d2d80c6365ad838f">BlitNTL7</a>
<a name="l15987"></a>15987 
<a name="l15988"></a>15988 <a class="code" href="vobject__blitters_8cpp.html#abf905a085ab39598c9c71ca8e8a0a0e">BlitNTL8</a>:
<a name="l15989"></a>15989 
<a name="l15990"></a>15990             <a class="code" href="structtest.html">test</a>  uiLineFlag, 1
<a name="l15991"></a>15991             jz          <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>
<a name="l15992"></a>15992 
<a name="l15993"></a>15993             <a class="code" href="structtest.html">test</a>  edi, 2
<a name="l15994"></a>15994             jz          BlitNTL5
<a name="l15995"></a>15995             jmp         <a class="code" href="vobject__blitters_8cpp.html#0e7ffd1e4d81460c5ee051765cc57418">BlitNTL9</a>
<a name="l15996"></a>15996 
<a name="l15997"></a>15997 
<a name="l15998"></a>15998 <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>:
<a name="l15999"></a>15999 
<a name="l16000"></a>16000             <a class="code" href="structtest.html">test</a>  edi, 2
<a name="l16001"></a>16001             jnz         BlitNTL5
<a name="l16002"></a>16002 
<a name="l16003"></a>16003 <a class="code" href="vobject__blitters_8cpp.html#d660d2ba340c8ef5d2d80c6365ad838f">BlitNTL7</a>:
<a name="l16004"></a>16004 
<a name="l16005"></a>16005             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [ebx], ax
<a name="l16006"></a>16006 
<a name="l16007"></a>16007 <a class="code" href="vobject__blitters_8cpp.html#0e7ffd1e4d81460c5ee051765cc57418">BlitNTL9</a>:
<a name="l16008"></a>16008 
<a name="l16009"></a>16009             <span class="comment">// CHECK FOR OUTLINE, BLIT DIFFERENTLY IF WE WANT IT TO!</span>
<a name="l16010"></a>16010             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l16011"></a>16011             cmp         al, 254
<a name="l16012"></a>16012             jne         BlitNTL12
<a name="l16013"></a>16013 
<a name="l16014"></a>16014             <span class="comment">//          DO OUTLINE</span>
<a name="l16015"></a>16015             <span class="comment">//          ONLY IF WE WANT IT!</span>
<a name="l16016"></a>16016             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         al, fDoOutline;
<a name="l16017"></a>16017             cmp         al,   1
<a name="l16018"></a>16018             jne         BlitNTL5
<a name="l16019"></a>16019 
<a name="l16020"></a>16020             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, s16BPPColor
<a name="l16021"></a>16021             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [<a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>], ax
<a name="l16022"></a>16022             jmp         BlitNTL5
<a name="l16023"></a>16023 
<a name="l16024"></a>16024 BlitNTL12:
<a name="l16025"></a>16025 
<a name="l16026"></a>16026             xor         ah, ah
<a name="l16027"></a>16027             mov         al, [esi]
<a name="l16028"></a>16028             mov         ax, [edx+eax*2]
<a name="l16029"></a>16029             mov         [<a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>], ax
<a name="l16030"></a>16030 
<a name="l16031"></a>16031 BlitNTL5:
<a name="l16032"></a>16032             inc         esi
<a name="l16033"></a>16033             inc         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>
<a name="l16034"></a>16034             inc         ebx
<a name="l16035"></a>16035             inc         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>
<a name="l16036"></a>16036             inc         ebx
<a name="l16037"></a>16037 
<a name="l16038"></a>16038             dec         cl
<a name="l16039"></a>16039             jnz         BlitNTL4
<a name="l16040"></a>16040 
<a name="l16041"></a>16041             jmp         BlitDispatch
<a name="l16042"></a>16042 
<a name="l16043"></a>16043 
<a name="l16044"></a>16044 BlitTransparent:
<a name="l16045"></a>16045 
<a name="l16046"></a>16046             and         ecx, 07fH
<a name="l16047"></a>16047 <span class="comment">//          shl         ecx, 1</span>
<a name="l16048"></a>16048             add   ecx, ecx
<a name="l16049"></a>16049             add         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, ecx
<a name="l16050"></a>16050             add         ebx, ecx
<a name="l16051"></a>16051             jmp         BlitDispatch
<a name="l16052"></a>16052 
<a name="l16053"></a>16053 
<a name="l16054"></a>16054 BlitDoneLine:
<a name="l16055"></a>16055 
<a name="l16056"></a>16056             dec         usHeight
<a name="l16057"></a>16057             jz          BlitDone
<a name="l16058"></a>16058             add         edi, LineSkip
<a name="l16059"></a>16059             add         ebx, LineSkip
<a name="l16060"></a>16060             xor         uiLineFlag, 1
<a name="l16061"></a>16061             jmp         BlitDispatch
<a name="l16062"></a>16062 
<a name="l16063"></a>16063 
<a name="l16064"></a>16064 BlitDone:
<a name="l16065"></a>16065       }
<a name="l16066"></a>16066 
<a name="l16067"></a>16067       <span class="keywordflow">return</span>(TRUE);
<a name="l16068"></a>16068 
<a name="l16069"></a>16069 }
<a name="l16070"></a>16070 
<a name="l16071"></a>16071 
<a name="l16072"></a>16072 <span class="comment">// This is the same as above, but DONOT WRITE to Z!</span>
<a name="l16073"></a><a class="code" href="vobject__blitters_8h.html#8dd28de8cf3d30efae2ad5113dd7f1df">16073</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#8dd28de8cf3d30efae2ad5113dd7f1df">Blt8BPPDataTo16BPPBufferOutlineZNB</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="Types_8h.html#30f500129d8c688af07726d5d34ce52d">INT16</a> s16BPPColor, <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> fDoOutline )
<a name="l16074"></a>16074 {
<a name="l16075"></a>16075       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l16076"></a>16076       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l16077"></a>16077       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth;
<a name="l16078"></a>16078       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l16079"></a>16079       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l16080"></a>16080       <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l16081"></a>16081       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l16082"></a>16082 
<a name="l16083"></a>16083 
<a name="l16084"></a>16084       <span class="comment">// Assertions</span>
<a name="l16085"></a>16085       Assert( hSrcVObject != NULL );
<a name="l16086"></a>16086       Assert( pBuffer != NULL );
<a name="l16087"></a>16087 
<a name="l16088"></a>16088       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l16089"></a>16089       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l16090"></a>16090       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l16091"></a>16091       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l16092"></a>16092       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l16093"></a>16093 
<a name="l16094"></a>16094       <span class="comment">// Add to start position of dest buffer</span>
<a name="l16095"></a>16095       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l16096"></a>16096       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l16097"></a>16097 
<a name="l16098"></a>16098       <span class="comment">// Validations</span>
<a name="l16099"></a>16099       CHECKF( iTempX &gt;= 0 );
<a name="l16100"></a>16100       CHECKF( iTempY &gt;= 0 );
<a name="l16101"></a>16101 
<a name="l16102"></a>16102 
<a name="l16103"></a>16103       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l16104"></a>16104       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l16105"></a>16105       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l16106"></a>16106       p16BPPPalette = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#930609ad8d5cdbb05449df70bd83cfcd">pShadeCurrent</a>;
<a name="l16107"></a>16107       LineSkip=(uiDestPitchBYTES-(usWidth*2));
<a name="l16108"></a>16108 
<a name="l16109"></a>16109       __asm {
<a name="l16110"></a>16110 
<a name="l16111"></a>16111             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l16112"></a>16112             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l16113"></a>16113             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, p16BPPPalette
<a name="l16114"></a>16114             xor         eax, eax
<a name="l16115"></a>16115             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l16116"></a>16116             xor         ecx, ecx
<a name="l16117"></a>16117 
<a name="l16118"></a>16118 BlitDispatch:
<a name="l16119"></a>16119 
<a name="l16120"></a>16120             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l16121"></a>16121             inc         esi
<a name="l16122"></a>16122             or          cl, cl
<a name="l16123"></a>16123             js          BlitTransparent
<a name="l16124"></a>16124             jz          BlitDoneLine
<a name="l16125"></a>16125 
<a name="l16126"></a>16126 <span class="comment">//BlitNonTransLoop:</span>
<a name="l16127"></a>16127 
<a name="l16128"></a>16128             xor         eax, eax
<a name="l16129"></a>16129 
<a name="l16130"></a>16130 BlitNTL4:
<a name="l16131"></a>16131 
<a name="l16132"></a>16132             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, usZValue
<a name="l16133"></a>16133             cmp         ax, [ebx]
<a name="l16134"></a>16134             jb          BlitNTL5
<a name="l16135"></a>16135 
<a name="l16136"></a>16136             <span class="comment">// CHECK FOR OUTLINE, BLIT DIFFERENTLY IF WE WANT IT TO!</span>
<a name="l16137"></a>16137             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l16138"></a>16138             cmp         al, 254
<a name="l16139"></a>16139             jne         <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>
<a name="l16140"></a>16140 
<a name="l16141"></a>16141             <span class="comment">//          DO OUTLINE</span>
<a name="l16142"></a>16142             <span class="comment">//          ONLY IF WE WANT IT!</span>
<a name="l16143"></a>16143             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         al, fDoOutline;
<a name="l16144"></a>16144             cmp         al,   1
<a name="l16145"></a>16145             jne         BlitNTL5
<a name="l16146"></a>16146 
<a name="l16147"></a>16147             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, s16BPPColor
<a name="l16148"></a>16148             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax
<a name="l16149"></a>16149             jmp         BlitNTL5
<a name="l16150"></a>16150 
<a name="l16151"></a>16151 <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>:
<a name="l16152"></a>16152 
<a name="l16153"></a>16153             <span class="comment">//Donot write to z-buffer</span>
<a name="l16154"></a>16154             <span class="comment">//mov       [ebx], ax</span>
<a name="l16155"></a>16155 
<a name="l16156"></a>16156             xor         ah, ah
<a name="l16157"></a>16157             mov         al, [esi]
<a name="l16158"></a>16158             mov         ax, [edx+eax*2]
<a name="l16159"></a>16159             mov         [edi], ax
<a name="l16160"></a>16160 
<a name="l16161"></a>16161 BlitNTL5:
<a name="l16162"></a>16162             inc         esi
<a name="l16163"></a>16163             inc         edi
<a name="l16164"></a>16164             inc         ebx
<a name="l16165"></a>16165             inc         edi
<a name="l16166"></a>16166             inc         ebx
<a name="l16167"></a>16167 
<a name="l16168"></a>16168             dec         cl
<a name="l16169"></a>16169             jnz         BlitNTL4
<a name="l16170"></a>16170 
<a name="l16171"></a>16171             jmp         BlitDispatch
<a name="l16172"></a>16172 
<a name="l16173"></a>16173 
<a name="l16174"></a>16174 BlitTransparent:
<a name="l16175"></a>16175 
<a name="l16176"></a>16176             and         ecx, 07fH
<a name="l16177"></a>16177 <span class="comment">//          shl         ecx, 1</span>
<a name="l16178"></a>16178             add   ecx, ecx
<a name="l16179"></a>16179             add         edi, ecx
<a name="l16180"></a>16180             add         ebx, ecx
<a name="l16181"></a>16181             jmp         BlitDispatch
<a name="l16182"></a>16182 
<a name="l16183"></a>16183 
<a name="l16184"></a>16184 BlitDoneLine:
<a name="l16185"></a>16185 
<a name="l16186"></a>16186             dec         usHeight
<a name="l16187"></a>16187             jz          BlitDone
<a name="l16188"></a>16188             add         edi, LineSkip
<a name="l16189"></a>16189             add         ebx, LineSkip
<a name="l16190"></a>16190             jmp         BlitDispatch
<a name="l16191"></a>16191 
<a name="l16192"></a>16192 
<a name="l16193"></a>16193 BlitDone:
<a name="l16194"></a>16194       }
<a name="l16195"></a>16195 
<a name="l16196"></a>16196       <span class="keywordflow">return</span>(TRUE);
<a name="l16197"></a>16197 
<a name="l16198"></a>16198 }
<a name="l16199"></a>16199 
<a name="l16200"></a>16200 
<a name="l16201"></a>16201 <span class="comment">/**********************************************************************************************</span>
<a name="l16202"></a>16202 <span class="comment"> Blt8BPPDataTo16BPPBufferIntensityZ</span>
<a name="l16203"></a>16203 <span class="comment"></span>
<a name="l16204"></a>16204 <span class="comment">      Creates a shadow using a brush, but modifies the destination buffer only if the current</span>
<a name="l16205"></a>16205 <span class="comment">      Z level is equal to higher than what's in the Z buffer at that pixel location. It</span>
<a name="l16206"></a>16206 <span class="comment">      updates the Z buffer with the new Z level.</span>
<a name="l16207"></a>16207 <span class="comment"></span>
<a name="l16208"></a>16208 <span class="comment">**********************************************************************************************/</span>
<a name="l16209"></a><a class="code" href="vobject__blitters_8h.html#d0a6d50de1b3fefe31f7abfa8b5854d8">16209</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#d0a6d50de1b3fefe31f7abfa8b5854d8">Blt8BPPDataTo16BPPBufferIntensityZ</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex )
<a name="l16210"></a>16210 {
<a name="l16211"></a>16211       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l16212"></a>16212       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l16213"></a>16213       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth;
<a name="l16214"></a>16214       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l16215"></a>16215       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l16216"></a>16216       <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l16217"></a>16217       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l16218"></a>16218 
<a name="l16219"></a>16219 
<a name="l16220"></a>16220       <span class="comment">// Assertions</span>
<a name="l16221"></a>16221       Assert( hSrcVObject != NULL );
<a name="l16222"></a>16222       Assert( pBuffer != NULL );
<a name="l16223"></a>16223 
<a name="l16224"></a>16224       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l16225"></a>16225       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l16226"></a>16226       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l16227"></a>16227       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l16228"></a>16228       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l16229"></a>16229 
<a name="l16230"></a>16230       <span class="comment">// Add to start position of dest buffer</span>
<a name="l16231"></a>16231       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l16232"></a>16232       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l16233"></a>16233 
<a name="l16234"></a>16234       <span class="comment">// Validations</span>
<a name="l16235"></a>16235       CHECKF( iTempX &gt;= 0 );
<a name="l16236"></a>16236       CHECKF( iTempY &gt;= 0 );
<a name="l16237"></a>16237 
<a name="l16238"></a>16238 
<a name="l16239"></a>16239       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l16240"></a>16240       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l16241"></a>16241       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l16242"></a>16242       p16BPPPalette = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#930609ad8d5cdbb05449df70bd83cfcd">pShadeCurrent</a>;
<a name="l16243"></a>16243       LineSkip=(uiDestPitchBYTES-(usWidth*2));
<a name="l16244"></a>16244 
<a name="l16245"></a>16245       __asm {
<a name="l16246"></a>16246 
<a name="l16247"></a>16247             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l16248"></a>16248             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l16249"></a>16249             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, OFFSET <a class="code" href="shading_8cpp.html#7eb13b22491f30a4399f492394327161">IntensityTable</a>
<a name="l16250"></a>16250             xor         eax, eax
<a name="l16251"></a>16251             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l16252"></a>16252             xor         ecx, ecx
<a name="l16253"></a>16253 
<a name="l16254"></a>16254 BlitDispatch:
<a name="l16255"></a>16255 
<a name="l16256"></a>16256             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l16257"></a>16257             inc         esi
<a name="l16258"></a>16258             or          cl, cl
<a name="l16259"></a>16259             js          BlitTransparent
<a name="l16260"></a>16260             jz          BlitDoneLine
<a name="l16261"></a>16261 
<a name="l16262"></a>16262 <span class="comment">//BlitNonTransLoop:</span>
<a name="l16263"></a>16263 
<a name="l16264"></a>16264 BlitNTL4:
<a name="l16265"></a>16265 
<a name="l16266"></a>16266             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l16267"></a>16267             cmp         ax, usZValue
<a name="l16268"></a>16268             jae         BlitNTL5
<a name="l16269"></a>16269 
<a name="l16270"></a>16270             xor         eax, eax
<a name="l16271"></a>16271             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, [edi]
<a name="l16272"></a>16272             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, [edx+eax*2]
<a name="l16273"></a>16273             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax
<a name="l16274"></a>16274             mov         ax, usZValue
<a name="l16275"></a>16275             mov         [ebx], ax
<a name="l16276"></a>16276 
<a name="l16277"></a>16277 BlitNTL5:
<a name="l16278"></a>16278             inc         esi
<a name="l16279"></a>16279             add         edi, 2
<a name="l16280"></a>16280             add         ebx, 2
<a name="l16281"></a>16281             dec         cl
<a name="l16282"></a>16282             jnz         BlitNTL4
<a name="l16283"></a>16283 
<a name="l16284"></a>16284             jmp         BlitDispatch
<a name="l16285"></a>16285 
<a name="l16286"></a>16286 
<a name="l16287"></a>16287 BlitTransparent:
<a name="l16288"></a>16288 
<a name="l16289"></a>16289             and         ecx, 07fH
<a name="l16290"></a>16290 <span class="comment">//          shl         ecx, 1</span>
<a name="l16291"></a>16291             add   ecx, ecx
<a name="l16292"></a>16292             add         edi, ecx
<a name="l16293"></a>16293             add         ebx, ecx
<a name="l16294"></a>16294             jmp         BlitDispatch
<a name="l16295"></a>16295 
<a name="l16296"></a>16296 
<a name="l16297"></a>16297 BlitDoneLine:
<a name="l16298"></a>16298 
<a name="l16299"></a>16299             dec         usHeight
<a name="l16300"></a>16300             jz          BlitDone
<a name="l16301"></a>16301             add         edi, LineSkip
<a name="l16302"></a>16302             add         ebx, LineSkip
<a name="l16303"></a>16303             jmp         BlitDispatch
<a name="l16304"></a>16304 
<a name="l16305"></a>16305 
<a name="l16306"></a>16306 BlitDone:
<a name="l16307"></a>16307       }
<a name="l16308"></a>16308 
<a name="l16309"></a>16309       <span class="keywordflow">return</span>(TRUE);
<a name="l16310"></a>16310 
<a name="l16311"></a>16311 }
<a name="l16312"></a>16312 
<a name="l16313"></a>16313 <span class="comment">/**********************************************************************************************</span>
<a name="l16314"></a>16314 <span class="comment"> Blt8BPPDataTo16BPPBufferIntensityZClip</span>
<a name="l16315"></a>16315 <span class="comment"></span>
<a name="l16316"></a>16316 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l16317"></a>16317 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l16318"></a>16318 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on, and the Z value is</span>
<a name="l16319"></a>16319 <span class="comment">      updated to the current value, for any non-transparent pixels. The Z-buffer is 16 bit, and</span>
<a name="l16320"></a>16320 <span class="comment">      must be the same dimensions (including Pitch) as the destination.</span>
<a name="l16321"></a>16321 <span class="comment"></span>
<a name="l16322"></a>16322 <span class="comment">**********************************************************************************************/</span>
<a name="l16323"></a><a class="code" href="vobject__blitters_8h.html#0591e720bd23650c13fb2b49236a6c7d">16323</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#0591e720bd23650c13fb2b49236a6c7d">Blt8BPPDataTo16BPPBufferIntensityZClip</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="structSGPRect.html">SGPRect</a> *clipregion)
<a name="l16324"></a>16324 {
<a name="l16325"></a>16325       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l16326"></a>16326       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l16327"></a>16327       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth, Unblitted;
<a name="l16328"></a>16328       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l16329"></a>16329       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l16330"></a>16330   <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l16331"></a>16331       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY, LeftSkip, RightSkip, TopSkip, BottomSkip, BlitLength, BlitHeight, LSCount;
<a name="l16332"></a>16332       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  ClipX1, ClipY1, ClipX2, ClipY2;
<a name="l16333"></a>16333 
<a name="l16334"></a>16334       <span class="comment">// Assertions</span>
<a name="l16335"></a>16335       Assert( hSrcVObject != NULL );
<a name="l16336"></a>16336       Assert( pBuffer != NULL );
<a name="l16337"></a>16337 
<a name="l16338"></a>16338       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l16339"></a>16339       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l16340"></a>16340       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l16341"></a>16341       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l16342"></a>16342       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l16343"></a>16343 
<a name="l16344"></a>16344       <span class="comment">// Add to start position of dest buffer</span>
<a name="l16345"></a>16345       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l16346"></a>16346       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l16347"></a>16347 
<a name="l16348"></a>16348       <span class="keywordflow">if</span>(clipregion==NULL)
<a name="l16349"></a>16349       {
<a name="l16350"></a>16350             ClipX1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l16351"></a>16351             ClipY1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l16352"></a>16352             ClipX2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l16353"></a>16353             ClipY2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l16354"></a>16354       }
<a name="l16355"></a>16355       <span class="keywordflow">else</span>
<a name="l16356"></a>16356       {
<a name="l16357"></a>16357             ClipX1=clipregion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l16358"></a>16358             ClipY1=clipregion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l16359"></a>16359             ClipX2=clipregion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l16360"></a>16360             ClipY2=clipregion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l16361"></a>16361       }
<a name="l16362"></a>16362 
<a name="l16363"></a>16363       <span class="comment">// Calculate rows hanging off each side of the screen</span>
<a name="l16364"></a>16364       LeftSkip=__min(ClipX1 - min(ClipX1, iTempX), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l16365"></a>16365       RightSkip=__min(max(ClipX2, (iTempX+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth)) - ClipX2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l16366"></a>16366       TopSkip=__min(ClipY1 - __min(ClipY1, iTempY), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l16367"></a>16367       BottomSkip=__min(__max(ClipY2, (iTempY+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight)) - ClipY2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l16368"></a>16368 
<a name="l16369"></a>16369       <span class="comment">// calculate the remaining rows and columns to blit</span>
<a name="l16370"></a>16370       BlitLength=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth-LeftSkip-RightSkip);
<a name="l16371"></a>16371       BlitHeight=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight-TopSkip-BottomSkip);
<a name="l16372"></a>16372 
<a name="l16373"></a>16373       <span class="comment">// check if whole thing is clipped</span>
<a name="l16374"></a>16374       <span class="keywordflow">if</span>((LeftSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth) || (RightSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth))
<a name="l16375"></a>16375             <span class="keywordflow">return</span>(TRUE);
<a name="l16376"></a>16376 
<a name="l16377"></a>16377       <span class="comment">// check if whole thing is clipped</span>
<a name="l16378"></a>16378       <span class="keywordflow">if</span>((TopSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight) || (BottomSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight))
<a name="l16379"></a>16379             <span class="keywordflow">return</span>(TRUE);
<a name="l16380"></a>16380 
<a name="l16381"></a>16381       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l16382"></a>16382       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l16383"></a>16383       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l16384"></a>16384       p16BPPPalette = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#930609ad8d5cdbb05449df70bd83cfcd">pShadeCurrent</a>;
<a name="l16385"></a>16385       LineSkip=(uiDestPitchBYTES-(BlitLength*2));
<a name="l16386"></a>16386 
<a name="l16387"></a>16387       __asm {
<a name="l16388"></a>16388 
<a name="l16389"></a>16389             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l16390"></a>16390             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l16391"></a>16391             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, OFFSET <a class="code" href="shading_8cpp.html#7eb13b22491f30a4399f492394327161">IntensityTable</a>
<a name="l16392"></a>16392             xor         eax, eax
<a name="l16393"></a>16393             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l16394"></a>16394             xor         ecx, ecx
<a name="l16395"></a>16395 
<a name="l16396"></a>16396             cmp         TopSkip, 0                                      <span class="comment">// check for nothing clipped on top</span>
<a name="l16397"></a>16397             je          LeftSkipSetup
<a name="l16398"></a>16398 
<a name="l16399"></a>16399 TopSkipLoop:                                                            <span class="comment">// Skips the number of lines clipped at the top</span>
<a name="l16400"></a>16400 
<a name="l16401"></a>16401             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l16402"></a>16402             inc         esi
<a name="l16403"></a>16403             or          cl, cl
<a name="l16404"></a>16404             js          TopSkipLoop
<a name="l16405"></a>16405             jz          TSEndLine
<a name="l16406"></a>16406 
<a name="l16407"></a>16407             add         esi, ecx
<a name="l16408"></a>16408             jmp         TopSkipLoop
<a name="l16409"></a>16409 
<a name="l16410"></a>16410 TSEndLine:
<a name="l16411"></a>16411             dec         TopSkip
<a name="l16412"></a>16412             jnz         TopSkipLoop
<a name="l16413"></a>16413 
<a name="l16414"></a>16414 LeftSkipSetup:
<a name="l16415"></a>16415 
<a name="l16416"></a>16416             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l16417"></a>16417             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, LeftSkip
<a name="l16418"></a>16418             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l16419"></a>16419             or          eax, eax
<a name="l16420"></a>16420             jz          BlitLineSetup
<a name="l16421"></a>16421 
<a name="l16422"></a>16422 LeftSkipLoop:
<a name="l16423"></a>16423 
<a name="l16424"></a>16424             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l16425"></a>16425             inc         esi
<a name="l16426"></a>16426 
<a name="l16427"></a>16427             or          cl, cl
<a name="l16428"></a>16428             js          LSTrans
<a name="l16429"></a>16429 
<a name="l16430"></a>16430             cmp         ecx, LSCount
<a name="l16431"></a>16431             je          LSSkip2                                               <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l16432"></a>16432             jb          LSSkip1                                               <span class="comment">// if less, skip whole thing</span>
<a name="l16433"></a>16433 
<a name="l16434"></a>16434             add         esi, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l16435"></a>16435             sub         ecx, LSCount
<a name="l16436"></a>16436             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l16437"></a>16437             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l16438"></a>16438             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l16439"></a>16439             jmp         BlitNonTransLoop
<a name="l16440"></a>16440 
<a name="l16441"></a>16441 LSSkip2:
<a name="l16442"></a>16442             add         esi, ecx                                        <span class="comment">// skip whole run, and start blit with new run</span>
<a name="l16443"></a>16443             jmp         BlitLineSetup
<a name="l16444"></a>16444 
<a name="l16445"></a>16445 
<a name="l16446"></a>16446 LSSkip1:
<a name="l16447"></a>16447             add         esi, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l16448"></a>16448             sub         LSCount, ecx
<a name="l16449"></a>16449             jmp         LeftSkipLoop
<a name="l16450"></a>16450 
<a name="l16451"></a>16451 
<a name="l16452"></a>16452 LSTrans:
<a name="l16453"></a>16453             and         ecx, 07fH
<a name="l16454"></a>16454             cmp         ecx, LSCount
<a name="l16455"></a>16455             je          BlitLineSetup                             <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l16456"></a>16456             jb          LSTrans1                                        <span class="comment">// if less, skip whole thing</span>
<a name="l16457"></a>16457 
<a name="l16458"></a>16458             sub         ecx, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l16459"></a>16459             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l16460"></a>16460             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l16461"></a>16461             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l16462"></a>16462             jmp         BlitTransparent
<a name="l16463"></a>16463 
<a name="l16464"></a>16464 
<a name="l16465"></a>16465 LSTrans1:
<a name="l16466"></a>16466             sub         LSCount, ecx                                          <span class="comment">// skip whole run, continue skipping</span>
<a name="l16467"></a>16467             jmp         LeftSkipLoop
<a name="l16468"></a>16468 
<a name="l16469"></a>16469 
<a name="l16470"></a>16470 BlitLineSetup:                                                    <span class="comment">// Does any actual blitting (trans/non) for the line</span>
<a name="l16471"></a>16471             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l16472"></a>16472             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l16473"></a>16473             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l16474"></a>16474 
<a name="l16475"></a>16475 BlitDispatch:
<a name="l16476"></a>16476 
<a name="l16477"></a>16477             cmp         LSCount, 0                                      <span class="comment">// Check to see if we're done blitting</span>
<a name="l16478"></a>16478             je          RightSkipLoop
<a name="l16479"></a>16479 
<a name="l16480"></a>16480             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l16481"></a>16481             inc         esi
<a name="l16482"></a>16482             or          cl, cl
<a name="l16483"></a>16483             js          BlitTransparent
<a name="l16484"></a>16484 
<a name="l16485"></a>16485 BlitNonTransLoop:                                           <span class="comment">// blit non-transparent pixels</span>
<a name="l16486"></a>16486 
<a name="l16487"></a>16487             cmp         ecx, LSCount
<a name="l16488"></a>16488             jbe         BNTrans1
<a name="l16489"></a>16489 
<a name="l16490"></a>16490             sub         ecx, LSCount
<a name="l16491"></a>16491             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, ecx
<a name="l16492"></a>16492             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, LSCount
<a name="l16493"></a>16493 
<a name="l16494"></a>16494 BNTrans1:
<a name="l16495"></a>16495             sub         LSCount, ecx
<a name="l16496"></a>16496 
<a name="l16497"></a>16497 BlitNTL1:
<a name="l16498"></a>16498 
<a name="l16499"></a>16499             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l16500"></a>16500             cmp         ax, usZValue
<a name="l16501"></a>16501             jae         BlitNTL2
<a name="l16502"></a>16502 
<a name="l16503"></a>16503             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, usZValue
<a name="l16504"></a>16504             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [ebx], ax
<a name="l16505"></a>16505 
<a name="l16506"></a>16506             xor         eax, eax
<a name="l16507"></a>16507 
<a name="l16508"></a>16508             mov         ax, [edi]
<a name="l16509"></a>16509             mov         ax, [edx+eax*2]
<a name="l16510"></a>16510             mov         [edi], ax
<a name="l16511"></a>16511 
<a name="l16512"></a>16512 BlitNTL2:
<a name="l16513"></a>16513             inc         esi
<a name="l16514"></a>16514             add         edi, 2
<a name="l16515"></a>16515             add         ebx, 2
<a name="l16516"></a>16516             dec         cl
<a name="l16517"></a>16517             jnz         BlitNTL1
<a name="l16518"></a>16518 
<a name="l16519"></a>16519 <span class="comment">//BlitLineEnd:</span>
<a name="l16520"></a>16520             add         esi, Unblitted
<a name="l16521"></a>16521             jmp         BlitDispatch
<a name="l16522"></a>16522 
<a name="l16523"></a>16523 BlitTransparent:                                                              <span class="comment">// skip transparent pixels</span>
<a name="l16524"></a>16524 
<a name="l16525"></a>16525             and         ecx, 07fH
<a name="l16526"></a>16526             cmp         ecx, LSCount
<a name="l16527"></a>16527             jbe         BTrans1
<a name="l16528"></a>16528 
<a name="l16529"></a>16529             mov         ecx, LSCount
<a name="l16530"></a>16530 
<a name="l16531"></a>16531 BTrans1:
<a name="l16532"></a>16532 
<a name="l16533"></a>16533             sub         LSCount, ecx
<a name="l16534"></a>16534 <span class="comment">//          shl         ecx, 1</span>
<a name="l16535"></a>16535             add   ecx, ecx
<a name="l16536"></a>16536             add         edi, ecx
<a name="l16537"></a>16537             add         ebx, ecx
<a name="l16538"></a>16538             jmp         BlitDispatch
<a name="l16539"></a>16539 
<a name="l16540"></a>16540 
<a name="l16541"></a>16541 RightSkipLoop:                                                                      <span class="comment">// skip along until we hit and end-of-line marker</span>
<a name="l16542"></a>16542 
<a name="l16543"></a>16543 
<a name="l16544"></a>16544 RSLoop1:
<a name="l16545"></a>16545             mov         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l16546"></a>16546             inc         esi
<a name="l16547"></a>16547             or          al, al
<a name="l16548"></a>16548             jnz         RSLoop1
<a name="l16549"></a>16549 
<a name="l16550"></a>16550             dec         BlitHeight
<a name="l16551"></a>16551             jz          BlitDone
<a name="l16552"></a>16552             add         edi, LineSkip
<a name="l16553"></a>16553             add         ebx, LineSkip
<a name="l16554"></a>16554 
<a name="l16555"></a>16555             jmp         LeftSkipSetup
<a name="l16556"></a>16556 
<a name="l16557"></a>16557 
<a name="l16558"></a>16558 BlitDone:
<a name="l16559"></a>16559       }
<a name="l16560"></a>16560 
<a name="l16561"></a>16561       <span class="keywordflow">return</span>(TRUE);
<a name="l16562"></a>16562 
<a name="l16563"></a>16563 }
<a name="l16564"></a>16564 
<a name="l16565"></a>16565 <span class="comment">/**********************************************************************************************</span>
<a name="l16566"></a>16566 <span class="comment"> Blt8BPPDataTo16BPPBufferIntensityZNB</span>
<a name="l16567"></a>16567 <span class="comment"></span>
<a name="l16568"></a>16568 <span class="comment">      Creates a shadow using a brush, but modifies the destination buffer only if the current</span>
<a name="l16569"></a>16569 <span class="comment">      Z level is equal to higher than what's in the Z buffer at that pixel location. It does</span>
<a name="l16570"></a>16570 <span class="comment">      NOT update the Z buffer with the new Z value.</span>
<a name="l16571"></a>16571 <span class="comment"></span>
<a name="l16572"></a>16572 <span class="comment">**********************************************************************************************/</span>
<a name="l16573"></a><a class="code" href="vobject__blitters_8h.html#c8dcc6b957c3129f1b8e644a7c224a8a">16573</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#c8dcc6b957c3129f1b8e644a7c224a8a">Blt8BPPDataTo16BPPBufferIntensityZNB</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex )
<a name="l16574"></a>16574 {
<a name="l16575"></a>16575       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l16576"></a>16576       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l16577"></a>16577       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth;
<a name="l16578"></a>16578       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l16579"></a>16579       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l16580"></a>16580       <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l16581"></a>16581       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l16582"></a>16582 
<a name="l16583"></a>16583 
<a name="l16584"></a>16584       <span class="comment">// Assertions</span>
<a name="l16585"></a>16585       Assert( hSrcVObject != NULL );
<a name="l16586"></a>16586       Assert( pBuffer != NULL );
<a name="l16587"></a>16587 
<a name="l16588"></a>16588       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l16589"></a>16589       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l16590"></a>16590       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l16591"></a>16591       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l16592"></a>16592       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l16593"></a>16593 
<a name="l16594"></a>16594       <span class="comment">// Add to start position of dest buffer</span>
<a name="l16595"></a>16595       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l16596"></a>16596       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l16597"></a>16597 
<a name="l16598"></a>16598       <span class="comment">// Validations</span>
<a name="l16599"></a>16599       CHECKF( iTempX &gt;= 0 );
<a name="l16600"></a>16600       CHECKF( iTempY &gt;= 0 );
<a name="l16601"></a>16601 
<a name="l16602"></a>16602 
<a name="l16603"></a>16603       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l16604"></a>16604       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l16605"></a>16605       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l16606"></a>16606       p16BPPPalette = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#930609ad8d5cdbb05449df70bd83cfcd">pShadeCurrent</a>;
<a name="l16607"></a>16607       LineSkip=(uiDestPitchBYTES-(usWidth*2));
<a name="l16608"></a>16608 
<a name="l16609"></a>16609       __asm {
<a name="l16610"></a>16610 
<a name="l16611"></a>16611             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l16612"></a>16612             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l16613"></a>16613             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, OFFSET <a class="code" href="shading_8cpp.html#7eb13b22491f30a4399f492394327161">IntensityTable</a>
<a name="l16614"></a>16614             xor         eax, eax
<a name="l16615"></a>16615             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l16616"></a>16616             xor         ecx, ecx
<a name="l16617"></a>16617 
<a name="l16618"></a>16618 BlitDispatch:
<a name="l16619"></a>16619 
<a name="l16620"></a>16620             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l16621"></a>16621             inc         esi
<a name="l16622"></a>16622             or          cl, cl
<a name="l16623"></a>16623             js          BlitTransparent
<a name="l16624"></a>16624             jz          BlitDoneLine
<a name="l16625"></a>16625 
<a name="l16626"></a>16626 <span class="comment">//BlitNonTransLoop:</span>
<a name="l16627"></a>16627 
<a name="l16628"></a>16628 BlitNTL4:
<a name="l16629"></a>16629 
<a name="l16630"></a>16630             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l16631"></a>16631             cmp         ax, usZValue
<a name="l16632"></a>16632             jae         BlitNTL5
<a name="l16633"></a>16633 
<a name="l16634"></a>16634             xor         eax, eax
<a name="l16635"></a>16635             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, [edi]
<a name="l16636"></a>16636             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, [edx+eax*2]
<a name="l16637"></a>16637             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax
<a name="l16638"></a>16638 
<a name="l16639"></a>16639 BlitNTL5:
<a name="l16640"></a>16640             inc         esi
<a name="l16641"></a>16641             add         edi, 2
<a name="l16642"></a>16642             add         ebx, 2
<a name="l16643"></a>16643             dec         cl
<a name="l16644"></a>16644             jnz         BlitNTL4
<a name="l16645"></a>16645 
<a name="l16646"></a>16646             jmp         BlitDispatch
<a name="l16647"></a>16647 
<a name="l16648"></a>16648 
<a name="l16649"></a>16649 BlitTransparent:
<a name="l16650"></a>16650 
<a name="l16651"></a>16651             and         ecx, 07fH
<a name="l16652"></a>16652 <span class="comment">//          shl         ecx, 1</span>
<a name="l16653"></a>16653             add   ecx, ecx
<a name="l16654"></a>16654             add         edi, ecx
<a name="l16655"></a>16655             add         ebx, ecx
<a name="l16656"></a>16656             jmp         BlitDispatch
<a name="l16657"></a>16657 
<a name="l16658"></a>16658 
<a name="l16659"></a>16659 BlitDoneLine:
<a name="l16660"></a>16660 
<a name="l16661"></a>16661             dec         usHeight
<a name="l16662"></a>16662             jz          BlitDone
<a name="l16663"></a>16663             add         edi, LineSkip
<a name="l16664"></a>16664             add         ebx, LineSkip
<a name="l16665"></a>16665             jmp         BlitDispatch
<a name="l16666"></a>16666 
<a name="l16667"></a>16667 
<a name="l16668"></a>16668 BlitDone:
<a name="l16669"></a>16669       }
<a name="l16670"></a>16670 
<a name="l16671"></a>16671       <span class="keywordflow">return</span>(TRUE);
<a name="l16672"></a>16672 
<a name="l16673"></a>16673 }
<a name="l16674"></a>16674 
<a name="l16675"></a>16675 <span class="comment">/**********************************************************************************************</span>
<a name="l16676"></a>16676 <span class="comment"> Blt8BPPDataTo16BPPBufferIntensityZNBClip</span>
<a name="l16677"></a>16677 <span class="comment"></span>
<a name="l16678"></a>16678 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l16679"></a>16679 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l16680"></a>16680 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on, the Z value is</span>
<a name="l16681"></a>16681 <span class="comment">      not updated,      for any non-transparent pixels. The Z-buffer is 16 bit, and must be the</span>
<a name="l16682"></a>16682 <span class="comment">      same dimensions (including Pitch) as the destination.</span>
<a name="l16683"></a>16683 <span class="comment"></span>
<a name="l16684"></a>16684 <span class="comment">**********************************************************************************************/</span>
<a name="l16685"></a><a class="code" href="vobject__blitters_8h.html#33d3178b194f9f09a58b68b524689307">16685</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#33d3178b194f9f09a58b68b524689307">Blt8BPPDataTo16BPPBufferIntensityZNBClip</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="structSGPRect.html">SGPRect</a> *clipregion)
<a name="l16686"></a>16686 {
<a name="l16687"></a>16687       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l16688"></a>16688       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l16689"></a>16689       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth, Unblitted;
<a name="l16690"></a>16690       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l16691"></a>16691       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l16692"></a>16692   <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l16693"></a>16693       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY, LeftSkip, RightSkip, TopSkip, BottomSkip, BlitLength, BlitHeight, LSCount;
<a name="l16694"></a>16694       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  ClipX1, ClipY1, ClipX2, ClipY2;
<a name="l16695"></a>16695 
<a name="l16696"></a>16696       <span class="comment">// Assertions</span>
<a name="l16697"></a>16697       Assert( hSrcVObject != NULL );
<a name="l16698"></a>16698       Assert( pBuffer != NULL );
<a name="l16699"></a>16699 
<a name="l16700"></a>16700       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l16701"></a>16701       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l16702"></a>16702       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l16703"></a>16703       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l16704"></a>16704       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l16705"></a>16705 
<a name="l16706"></a>16706       <span class="comment">// Add to start position of dest buffer</span>
<a name="l16707"></a>16707       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l16708"></a>16708       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l16709"></a>16709 
<a name="l16710"></a>16710       <span class="keywordflow">if</span>(clipregion==NULL)
<a name="l16711"></a>16711       {
<a name="l16712"></a>16712             ClipX1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l16713"></a>16713             ClipY1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l16714"></a>16714             ClipX2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l16715"></a>16715             ClipY2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l16716"></a>16716       }
<a name="l16717"></a>16717       <span class="keywordflow">else</span>
<a name="l16718"></a>16718       {
<a name="l16719"></a>16719             ClipX1=clipregion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l16720"></a>16720             ClipY1=clipregion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l16721"></a>16721             ClipX2=clipregion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l16722"></a>16722             ClipY2=clipregion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l16723"></a>16723       }
<a name="l16724"></a>16724 
<a name="l16725"></a>16725       <span class="comment">// Calculate rows hanging off each side of the screen</span>
<a name="l16726"></a>16726       LeftSkip=__min(ClipX1 - min(ClipX1, iTempX), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l16727"></a>16727       RightSkip=__min(max(ClipX2, (iTempX+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth)) - ClipX2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l16728"></a>16728       TopSkip=__min(ClipY1 - __min(ClipY1, iTempY), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l16729"></a>16729       BottomSkip=__min(__max(ClipY2, (iTempY+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight)) - ClipY2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l16730"></a>16730 
<a name="l16731"></a>16731       <span class="comment">// calculate the remaining rows and columns to blit</span>
<a name="l16732"></a>16732       BlitLength=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth-LeftSkip-RightSkip);
<a name="l16733"></a>16733       BlitHeight=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight-TopSkip-BottomSkip);
<a name="l16734"></a>16734 
<a name="l16735"></a>16735       <span class="comment">// check if whole thing is clipped</span>
<a name="l16736"></a>16736       <span class="keywordflow">if</span>((LeftSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth) || (RightSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth))
<a name="l16737"></a>16737             <span class="keywordflow">return</span>(TRUE);
<a name="l16738"></a>16738 
<a name="l16739"></a>16739       <span class="comment">// check if whole thing is clipped</span>
<a name="l16740"></a>16740       <span class="keywordflow">if</span>((TopSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight) || (BottomSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight))
<a name="l16741"></a>16741             <span class="keywordflow">return</span>(TRUE);
<a name="l16742"></a>16742 
<a name="l16743"></a>16743       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l16744"></a>16744       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l16745"></a>16745       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l16746"></a>16746       p16BPPPalette = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#930609ad8d5cdbb05449df70bd83cfcd">pShadeCurrent</a>;
<a name="l16747"></a>16747       LineSkip=(uiDestPitchBYTES-(BlitLength*2));
<a name="l16748"></a>16748 
<a name="l16749"></a>16749       __asm {
<a name="l16750"></a>16750 
<a name="l16751"></a>16751             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l16752"></a>16752             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l16753"></a>16753             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, OFFSET <a class="code" href="shading_8cpp.html#7eb13b22491f30a4399f492394327161">IntensityTable</a>
<a name="l16754"></a>16754             xor         eax, eax
<a name="l16755"></a>16755             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l16756"></a>16756             xor         ecx, ecx
<a name="l16757"></a>16757 
<a name="l16758"></a>16758             cmp         TopSkip, 0                                      <span class="comment">// check for nothing clipped on top</span>
<a name="l16759"></a>16759             je          LeftSkipSetup
<a name="l16760"></a>16760 
<a name="l16761"></a>16761 TopSkipLoop:                                                            <span class="comment">// Skips the number of lines clipped at the top</span>
<a name="l16762"></a>16762 
<a name="l16763"></a>16763             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l16764"></a>16764             inc         esi
<a name="l16765"></a>16765             or          cl, cl
<a name="l16766"></a>16766             js          TopSkipLoop
<a name="l16767"></a>16767             jz          TSEndLine
<a name="l16768"></a>16768 
<a name="l16769"></a>16769             add         esi, ecx
<a name="l16770"></a>16770             jmp         TopSkipLoop
<a name="l16771"></a>16771 
<a name="l16772"></a>16772 TSEndLine:
<a name="l16773"></a>16773             dec         TopSkip
<a name="l16774"></a>16774             jnz         TopSkipLoop
<a name="l16775"></a>16775 
<a name="l16776"></a>16776 LeftSkipSetup:
<a name="l16777"></a>16777 
<a name="l16778"></a>16778             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l16779"></a>16779             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, LeftSkip
<a name="l16780"></a>16780             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l16781"></a>16781             or          eax, eax
<a name="l16782"></a>16782             jz          BlitLineSetup
<a name="l16783"></a>16783 
<a name="l16784"></a>16784 LeftSkipLoop:
<a name="l16785"></a>16785 
<a name="l16786"></a>16786             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l16787"></a>16787             inc         esi
<a name="l16788"></a>16788 
<a name="l16789"></a>16789             or          cl, cl
<a name="l16790"></a>16790             js          LSTrans
<a name="l16791"></a>16791 
<a name="l16792"></a>16792             cmp         ecx, LSCount
<a name="l16793"></a>16793             je          LSSkip2                                               <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l16794"></a>16794             jb          LSSkip1                                               <span class="comment">// if less, skip whole thing</span>
<a name="l16795"></a>16795 
<a name="l16796"></a>16796             add         esi, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l16797"></a>16797             sub         ecx, LSCount
<a name="l16798"></a>16798             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l16799"></a>16799             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l16800"></a>16800             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l16801"></a>16801             jmp         BlitNonTransLoop
<a name="l16802"></a>16802 
<a name="l16803"></a>16803 LSSkip2:
<a name="l16804"></a>16804             add         esi, ecx                                        <span class="comment">// skip whole run, and start blit with new run</span>
<a name="l16805"></a>16805             jmp         BlitLineSetup
<a name="l16806"></a>16806 
<a name="l16807"></a>16807 
<a name="l16808"></a>16808 LSSkip1:
<a name="l16809"></a>16809             add         esi, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l16810"></a>16810             sub         LSCount, ecx
<a name="l16811"></a>16811             jmp         LeftSkipLoop
<a name="l16812"></a>16812 
<a name="l16813"></a>16813 
<a name="l16814"></a>16814 LSTrans:
<a name="l16815"></a>16815             and         ecx, 07fH
<a name="l16816"></a>16816             cmp         ecx, LSCount
<a name="l16817"></a>16817             je          BlitLineSetup                             <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l16818"></a>16818             jb          LSTrans1                                        <span class="comment">// if less, skip whole thing</span>
<a name="l16819"></a>16819 
<a name="l16820"></a>16820             sub         ecx, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l16821"></a>16821             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l16822"></a>16822             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l16823"></a>16823             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l16824"></a>16824             jmp         BlitTransparent
<a name="l16825"></a>16825 
<a name="l16826"></a>16826 
<a name="l16827"></a>16827 LSTrans1:
<a name="l16828"></a>16828             sub         LSCount, ecx                                          <span class="comment">// skip whole run, continue skipping</span>
<a name="l16829"></a>16829             jmp         LeftSkipLoop
<a name="l16830"></a>16830 
<a name="l16831"></a>16831 
<a name="l16832"></a>16832 BlitLineSetup:                                                    <span class="comment">// Does any actual blitting (trans/non) for the line</span>
<a name="l16833"></a>16833             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l16834"></a>16834             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l16835"></a>16835             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l16836"></a>16836 
<a name="l16837"></a>16837 BlitDispatch:
<a name="l16838"></a>16838 
<a name="l16839"></a>16839             cmp         LSCount, 0                                      <span class="comment">// Check to see if we're done blitting</span>
<a name="l16840"></a>16840             je          RightSkipLoop
<a name="l16841"></a>16841 
<a name="l16842"></a>16842             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l16843"></a>16843             inc         esi
<a name="l16844"></a>16844             or          cl, cl
<a name="l16845"></a>16845             js          BlitTransparent
<a name="l16846"></a>16846 
<a name="l16847"></a>16847 BlitNonTransLoop:                                           <span class="comment">// blit non-transparent pixels</span>
<a name="l16848"></a>16848 
<a name="l16849"></a>16849             cmp         ecx, LSCount
<a name="l16850"></a>16850             jbe         BNTrans1
<a name="l16851"></a>16851 
<a name="l16852"></a>16852             sub         ecx, LSCount
<a name="l16853"></a>16853             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, ecx
<a name="l16854"></a>16854             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, LSCount
<a name="l16855"></a>16855 
<a name="l16856"></a>16856 BNTrans1:
<a name="l16857"></a>16857             sub         LSCount, ecx
<a name="l16858"></a>16858 
<a name="l16859"></a>16859 BlitNTL1:
<a name="l16860"></a>16860 
<a name="l16861"></a>16861             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l16862"></a>16862             cmp         ax, usZValue
<a name="l16863"></a>16863             jae         BlitNTL2
<a name="l16864"></a>16864 
<a name="l16865"></a>16865             xor         eax, eax
<a name="l16866"></a>16866 
<a name="l16867"></a>16867             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, [edi]
<a name="l16868"></a>16868             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, [edx+eax*2]
<a name="l16869"></a>16869             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax
<a name="l16870"></a>16870 
<a name="l16871"></a>16871 BlitNTL2:
<a name="l16872"></a>16872             inc         esi
<a name="l16873"></a>16873             add         edi, 2
<a name="l16874"></a>16874             add         ebx, 2
<a name="l16875"></a>16875             dec         cl
<a name="l16876"></a>16876             jnz         BlitNTL1
<a name="l16877"></a>16877 
<a name="l16878"></a>16878 <span class="comment">//BlitLineEnd:</span>
<a name="l16879"></a>16879             add         esi, Unblitted
<a name="l16880"></a>16880             jmp         BlitDispatch
<a name="l16881"></a>16881 
<a name="l16882"></a>16882 BlitTransparent:                                                              <span class="comment">// skip transparent pixels</span>
<a name="l16883"></a>16883 
<a name="l16884"></a>16884             and         ecx, 07fH
<a name="l16885"></a>16885             cmp         ecx, LSCount
<a name="l16886"></a>16886             jbe         BTrans1
<a name="l16887"></a>16887 
<a name="l16888"></a>16888             mov         ecx, LSCount
<a name="l16889"></a>16889 
<a name="l16890"></a>16890 BTrans1:
<a name="l16891"></a>16891 
<a name="l16892"></a>16892             sub         LSCount, ecx
<a name="l16893"></a>16893 <span class="comment">//          shl         ecx, 1</span>
<a name="l16894"></a>16894             add   ecx, ecx
<a name="l16895"></a>16895             add         edi, ecx
<a name="l16896"></a>16896             add         ebx, ecx
<a name="l16897"></a>16897             jmp         BlitDispatch
<a name="l16898"></a>16898 
<a name="l16899"></a>16899 
<a name="l16900"></a>16900 RightSkipLoop:                                                                      <span class="comment">// skip along until we hit and end-of-line marker</span>
<a name="l16901"></a>16901 
<a name="l16902"></a>16902 
<a name="l16903"></a>16903 RSLoop1:
<a name="l16904"></a>16904             mov         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l16905"></a>16905             inc         esi
<a name="l16906"></a>16906             or          al, al
<a name="l16907"></a>16907             jnz         RSLoop1
<a name="l16908"></a>16908 
<a name="l16909"></a>16909             dec         BlitHeight
<a name="l16910"></a>16910             jz          BlitDone
<a name="l16911"></a>16911             add         edi, LineSkip
<a name="l16912"></a>16912             add         ebx, LineSkip
<a name="l16913"></a>16913 
<a name="l16914"></a>16914             jmp         LeftSkipSetup
<a name="l16915"></a>16915 
<a name="l16916"></a>16916 
<a name="l16917"></a>16917 BlitDone:
<a name="l16918"></a>16918       }
<a name="l16919"></a>16919 
<a name="l16920"></a>16920       <span class="keywordflow">return</span>(TRUE);
<a name="l16921"></a>16921 
<a name="l16922"></a>16922 }
<a name="l16923"></a>16923 
<a name="l16924"></a>16924 
<a name="l16925"></a>16925 
<a name="l16926"></a>16926 <span class="comment">/**********************************************************************************************</span>
<a name="l16927"></a>16927 <span class="comment"> Blt8BPPDataTo16BPPBufferIntensityClip</span>
<a name="l16928"></a>16928 <span class="comment"></span>
<a name="l16929"></a>16929 <span class="comment">      Modifies the destination buffer. Darkens the destination pixels by 25%, using the source</span>
<a name="l16930"></a>16930 <span class="comment">      image as a mask. Any Non-zero index pixels are used to darken destination pixels. Blitter</span>
<a name="l16931"></a>16931 <span class="comment">      clips brush if it doesn't fit on the viewport.</span>
<a name="l16932"></a>16932 <span class="comment"></span>
<a name="l16933"></a>16933 <span class="comment">**********************************************************************************************/</span>
<a name="l16934"></a><a class="code" href="vobject__blitters_8h.html#3f0e6d04d94d9902859588d8713082fd">16934</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#3f0e6d04d94d9902859588d8713082fd">Blt8BPPDataTo16BPPBufferIntensityClip</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="structSGPRect.html">SGPRect</a> *clipregion)
<a name="l16935"></a>16935 {
<a name="l16936"></a>16936       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l16937"></a>16937       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l16938"></a>16938       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth, Unblitted;
<a name="l16939"></a>16939       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr;
<a name="l16940"></a>16940       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l16941"></a>16941   <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l16942"></a>16942       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY, LeftSkip, RightSkip, TopSkip, BottomSkip, BlitLength, BlitHeight;
<a name="l16943"></a>16943       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  ClipX1, ClipY1, ClipX2, ClipY2;
<a name="l16944"></a>16944 
<a name="l16945"></a>16945       <span class="comment">// Assertions</span>
<a name="l16946"></a>16946       Assert( hSrcVObject != NULL );
<a name="l16947"></a>16947       Assert( pBuffer != NULL );
<a name="l16948"></a>16948 
<a name="l16949"></a>16949       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l16950"></a>16950       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l16951"></a>16951       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l16952"></a>16952       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l16953"></a>16953       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l16954"></a>16954 
<a name="l16955"></a>16955       <span class="comment">// Add to start position of dest buffer</span>
<a name="l16956"></a>16956       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l16957"></a>16957       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l16958"></a>16958 
<a name="l16959"></a>16959       <span class="keywordflow">if</span>(clipregion==NULL)
<a name="l16960"></a>16960       {
<a name="l16961"></a>16961             ClipX1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l16962"></a>16962             ClipY1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l16963"></a>16963             ClipX2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l16964"></a>16964             ClipY2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l16965"></a>16965       }
<a name="l16966"></a>16966       <span class="keywordflow">else</span>
<a name="l16967"></a>16967       {
<a name="l16968"></a>16968             ClipX1=clipregion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l16969"></a>16969             ClipY1=clipregion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l16970"></a>16970             ClipX2=clipregion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l16971"></a>16971             ClipY2=clipregion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l16972"></a>16972       }
<a name="l16973"></a>16973 
<a name="l16974"></a>16974       <span class="comment">// Calculate rows hanging off each side of the screen</span>
<a name="l16975"></a>16975       LeftSkip=__min(ClipX1 - min(ClipX1, iTempX), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l16976"></a>16976       RightSkip=__min(max(ClipX2, (iTempX+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth)) - ClipX2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l16977"></a>16977       TopSkip=__min(ClipY1 - __min(ClipY1, iTempY), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l16978"></a>16978       BottomSkip=__min(__max(ClipY2, (iTempY+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight)) - ClipY2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l16979"></a>16979 
<a name="l16980"></a>16980       <span class="comment">// calculate the remaining rows and columns to blit</span>
<a name="l16981"></a>16981       BlitLength=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth-LeftSkip-RightSkip);
<a name="l16982"></a>16982       BlitHeight=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight-TopSkip-BottomSkip);
<a name="l16983"></a>16983 
<a name="l16984"></a>16984       <span class="comment">// whole thing is clipped</span>
<a name="l16985"></a>16985       <span class="keywordflow">if</span>((LeftSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth) || (RightSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth))
<a name="l16986"></a>16986             <span class="keywordflow">return</span>(TRUE);
<a name="l16987"></a>16987 
<a name="l16988"></a>16988       <span class="comment">// whole thing is clipped</span>
<a name="l16989"></a>16989       <span class="keywordflow">if</span>((TopSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight) || (BottomSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight))
<a name="l16990"></a>16990             <span class="keywordflow">return</span>(TRUE);
<a name="l16991"></a>16991 
<a name="l16992"></a>16992       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l16993"></a>16993       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l16994"></a>16994       p16BPPPalette = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#930609ad8d5cdbb05449df70bd83cfcd">pShadeCurrent</a>;
<a name="l16995"></a>16995       LineSkip=(uiDestPitchBYTES-(BlitLength*2));
<a name="l16996"></a>16996 
<a name="l16997"></a>16997       __asm {
<a name="l16998"></a>16998 
<a name="l16999"></a>16999             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l17000"></a>17000             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l17001"></a>17001             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, OFFSET <a class="code" href="shading_8cpp.html#7eb13b22491f30a4399f492394327161">IntensityTable</a>
<a name="l17002"></a>17002             xor         eax, eax
<a name="l17003"></a>17003             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, TopSkip
<a name="l17004"></a>17004             xor         ecx, ecx
<a name="l17005"></a>17005 
<a name="l17006"></a>17006             or          ebx, ebx                                        <span class="comment">// check for nothing clipped on top</span>
<a name="l17007"></a>17007             jz          LeftSkipSetup
<a name="l17008"></a>17008 
<a name="l17009"></a>17009 TopSkipLoop:                                                            <span class="comment">// Skips the number of lines clipped at the top</span>
<a name="l17010"></a>17010 
<a name="l17011"></a>17011             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l17012"></a>17012             inc         esi
<a name="l17013"></a>17013             or          cl, cl
<a name="l17014"></a>17014             js          TopSkipLoop
<a name="l17015"></a>17015             jz          TSEndLine
<a name="l17016"></a>17016 
<a name="l17017"></a>17017             add         esi, ecx
<a name="l17018"></a>17018             jmp         TopSkipLoop
<a name="l17019"></a>17019 
<a name="l17020"></a>17020 TSEndLine:
<a name="l17021"></a>17021             dec         ebx
<a name="l17022"></a>17022             jnz         TopSkipLoop
<a name="l17023"></a>17023 
<a name="l17024"></a>17024 
<a name="l17025"></a>17025 
<a name="l17026"></a>17026 
<a name="l17027"></a>17027 LeftSkipSetup:
<a name="l17028"></a>17028 
<a name="l17029"></a>17029             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l17030"></a>17030             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, LeftSkip                             <span class="comment">// check for nothing clipped on the left</span>
<a name="l17031"></a>17031             or          ebx, ebx
<a name="l17032"></a>17032             jz          BlitLineSetup
<a name="l17033"></a>17033 
<a name="l17034"></a>17034 LeftSkipLoop:
<a name="l17035"></a>17035 
<a name="l17036"></a>17036             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l17037"></a>17037             inc         esi
<a name="l17038"></a>17038 
<a name="l17039"></a>17039             or          cl, cl
<a name="l17040"></a>17040             js          LSTrans
<a name="l17041"></a>17041 
<a name="l17042"></a>17042             cmp         ecx, ebx
<a name="l17043"></a>17043             je          LSSkip2                                               <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l17044"></a>17044             jb          LSSkip1                                               <span class="comment">// if less, skip whole thing</span>
<a name="l17045"></a>17045 
<a name="l17046"></a>17046             add         esi, ebx                                        <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l17047"></a>17047             sub         ecx, ebx
<a name="l17048"></a>17048             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, BlitLength
<a name="l17049"></a>17049             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l17050"></a>17050             jmp         BlitNonTransLoop
<a name="l17051"></a>17051 
<a name="l17052"></a>17052 LSSkip2:
<a name="l17053"></a>17053             add         esi, ecx                                        <span class="comment">// skip whole run, and start blit with new run</span>
<a name="l17054"></a>17054             jmp         BlitLineSetup
<a name="l17055"></a>17055 
<a name="l17056"></a>17056 
<a name="l17057"></a>17057 LSSkip1:
<a name="l17058"></a>17058             add         esi, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l17059"></a>17059             sub         ebx, ecx
<a name="l17060"></a>17060             jmp         LeftSkipLoop
<a name="l17061"></a>17061 
<a name="l17062"></a>17062 
<a name="l17063"></a>17063 LSTrans:
<a name="l17064"></a>17064             and         ecx, 07fH
<a name="l17065"></a>17065             cmp         ecx, ebx
<a name="l17066"></a>17066             je          BlitLineSetup                             <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l17067"></a>17067             jb          LSTrans1                                        <span class="comment">// if less, skip whole thing</span>
<a name="l17068"></a>17068 
<a name="l17069"></a>17069             sub         ecx, ebx                                        <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l17070"></a>17070             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, BlitLength
<a name="l17071"></a>17071             jmp         BlitTransparent
<a name="l17072"></a>17072 
<a name="l17073"></a>17073 
<a name="l17074"></a>17074 LSTrans1:
<a name="l17075"></a>17075             sub         ebx, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l17076"></a>17076             jmp         LeftSkipLoop
<a name="l17077"></a>17077 
<a name="l17078"></a>17078 
<a name="l17079"></a>17079 
<a name="l17080"></a>17080 
<a name="l17081"></a>17081 BlitLineSetup:                                                    <span class="comment">// Does any actual blitting (trans/non) for the line</span>
<a name="l17082"></a>17082             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, BlitLength
<a name="l17083"></a>17083             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l17084"></a>17084 
<a name="l17085"></a>17085 BlitDispatch:
<a name="l17086"></a>17086 
<a name="l17087"></a>17087             or          ebx, ebx                                        <span class="comment">// Check to see if we're done blitting</span>
<a name="l17088"></a>17088             jz          RightSkipLoop
<a name="l17089"></a>17089 
<a name="l17090"></a>17090             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l17091"></a>17091             inc         esi
<a name="l17092"></a>17092             or          cl, cl
<a name="l17093"></a>17093             js          BlitTransparent
<a name="l17094"></a>17094 
<a name="l17095"></a>17095 BlitNonTransLoop:
<a name="l17096"></a>17096 
<a name="l17097"></a>17097             cmp         ecx, ebx
<a name="l17098"></a>17098             jbe         BNTrans1
<a name="l17099"></a>17099 
<a name="l17100"></a>17100             sub         ecx, ebx
<a name="l17101"></a>17101             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, ecx
<a name="l17102"></a>17102             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, ebx
<a name="l17103"></a>17103 
<a name="l17104"></a>17104 BNTrans1:
<a name="l17105"></a>17105             sub         ebx, ecx
<a name="l17106"></a>17106 
<a name="l17107"></a>17107             clc
<a name="l17108"></a>17108             rcr         cl, 1
<a name="l17109"></a>17109             jnc         BlitNTL2
<a name="l17110"></a>17110 
<a name="l17111"></a>17111             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [edi]
<a name="l17112"></a>17112             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, [edx+eax*2]
<a name="l17113"></a>17113             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax
<a name="l17114"></a>17114 
<a name="l17115"></a>17115             inc         esi
<a name="l17116"></a>17116             add         edi, 2
<a name="l17117"></a>17117 
<a name="l17118"></a>17118 BlitNTL2:
<a name="l17119"></a>17119             clc
<a name="l17120"></a>17120             rcr         cl, 1
<a name="l17121"></a>17121             jnc         BlitNTL3
<a name="l17122"></a>17122 
<a name="l17123"></a>17123             mov         ax, [edi]
<a name="l17124"></a>17124             mov         ax, [edx+eax*2]
<a name="l17125"></a>17125             mov         [edi], ax
<a name="l17126"></a>17126 
<a name="l17127"></a>17127             mov         ax, [edi+2]
<a name="l17128"></a>17128             mov         ax, [edx+eax*2]
<a name="l17129"></a>17129             mov         [edi+2], ax
<a name="l17130"></a>17130 
<a name="l17131"></a>17131             add         esi, 2
<a name="l17132"></a>17132             add         edi, 4
<a name="l17133"></a>17133 
<a name="l17134"></a>17134 BlitNTL3:
<a name="l17135"></a>17135 
<a name="l17136"></a>17136             or          cl, cl
<a name="l17137"></a>17137             jz          BlitLineEnd
<a name="l17138"></a>17138 
<a name="l17139"></a>17139 BlitNTL4:
<a name="l17140"></a>17140 
<a name="l17141"></a>17141             mov         ax, [edi]
<a name="l17142"></a>17142             mov         ax, [edx+eax*2]
<a name="l17143"></a>17143             mov         [edi], ax
<a name="l17144"></a>17144 
<a name="l17145"></a>17145             mov         ax, [edi+2]
<a name="l17146"></a>17146             mov         ax, [edx+eax*2]
<a name="l17147"></a>17147             mov         [edi+2], ax
<a name="l17148"></a>17148 
<a name="l17149"></a>17149             mov         ax, [edi+4]
<a name="l17150"></a>17150             mov         ax, [edx+eax*2]
<a name="l17151"></a>17151             mov         [edi+4], ax
<a name="l17152"></a>17152 
<a name="l17153"></a>17153             mov         ax, [edi+6]
<a name="l17154"></a>17154             mov         ax, [edx+eax*2]
<a name="l17155"></a>17155             mov         [edi+6], ax
<a name="l17156"></a>17156 
<a name="l17157"></a>17157             add         esi, 4
<a name="l17158"></a>17158             add         edi, 8
<a name="l17159"></a>17159             dec         cl
<a name="l17160"></a>17160             jnz         BlitNTL4
<a name="l17161"></a>17161 
<a name="l17162"></a>17162 BlitLineEnd:
<a name="l17163"></a>17163             add         esi, Unblitted
<a name="l17164"></a>17164             jmp         BlitDispatch
<a name="l17165"></a>17165 
<a name="l17166"></a>17166 BlitTransparent:
<a name="l17167"></a>17167 
<a name="l17168"></a>17168             and         ecx, 07fH
<a name="l17169"></a>17169             cmp         ecx, ebx
<a name="l17170"></a>17170             jbe         BTrans1
<a name="l17171"></a>17171 
<a name="l17172"></a>17172             mov         ecx, ebx
<a name="l17173"></a>17173 
<a name="l17174"></a>17174 BTrans1:
<a name="l17175"></a>17175 
<a name="l17176"></a>17176             sub         ebx, ecx
<a name="l17177"></a>17177 <span class="comment">//          shl         ecx, 1</span>
<a name="l17178"></a>17178             add   ecx, ecx
<a name="l17179"></a>17179             add         edi, ecx
<a name="l17180"></a>17180             jmp         BlitDispatch
<a name="l17181"></a>17181 
<a name="l17182"></a>17182 
<a name="l17183"></a>17183 RightSkipLoop:
<a name="l17184"></a>17184 
<a name="l17185"></a>17185 
<a name="l17186"></a>17186 RSLoop1:
<a name="l17187"></a>17187             mov         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l17188"></a>17188             inc         esi
<a name="l17189"></a>17189             or          al, al
<a name="l17190"></a>17190             jnz         RSLoop1
<a name="l17191"></a>17191 
<a name="l17192"></a>17192             dec         BlitHeight
<a name="l17193"></a>17193             jz          BlitDone
<a name="l17194"></a>17194             add         edi, LineSkip
<a name="l17195"></a>17195 
<a name="l17196"></a>17196             jmp         LeftSkipSetup
<a name="l17197"></a>17197 
<a name="l17198"></a>17198 
<a name="l17199"></a>17199 BlitDone:
<a name="l17200"></a>17200       }
<a name="l17201"></a>17201 
<a name="l17202"></a>17202       <span class="keywordflow">return</span>(TRUE);
<a name="l17203"></a>17203 
<a name="l17204"></a>17204 }
<a name="l17205"></a>17205 
<a name="l17206"></a>17206 
<a name="l17207"></a>17207 <span class="comment">/**********************************************************************************************</span>
<a name="l17208"></a>17208 <span class="comment"> Blt8BPPDataTo16BPPBufferIntensity</span>
<a name="l17209"></a>17209 <span class="comment"></span>
<a name="l17210"></a>17210 <span class="comment">      Modifies the destination buffer. Darkens the destination pixels by 25%, using the source</span>
<a name="l17211"></a>17211 <span class="comment">      image as a mask. Any Non-zero index pixels are used to darken destination pixels.</span>
<a name="l17212"></a>17212 <span class="comment"></span>
<a name="l17213"></a>17213 <span class="comment">**********************************************************************************************/</span>
<a name="l17214"></a><a class="code" href="vobject__blitters_8h.html#7f9c40dfb579d9ce43feebbc8196331f">17214</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#7f9c40dfb579d9ce43feebbc8196331f">Blt8BPPDataTo16BPPBufferIntensity</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex)
<a name="l17215"></a>17215 {
<a name="l17216"></a>17216       <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l17217"></a>17217       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset;
<a name="l17218"></a>17218       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth;
<a name="l17219"></a>17219       <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr;
<a name="l17220"></a>17220       <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l17221"></a>17221   <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l17222"></a>17222       <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY;
<a name="l17223"></a>17223 
<a name="l17224"></a>17224       <span class="comment">// Assertions</span>
<a name="l17225"></a>17225       Assert( hSrcVObject != NULL );
<a name="l17226"></a>17226       Assert( pBuffer != NULL );
<a name="l17227"></a>17227 
<a name="l17228"></a>17228       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l17229"></a>17229       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l17230"></a>17230       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l17231"></a>17231       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l17232"></a>17232       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l17233"></a>17233 
<a name="l17234"></a>17234       <span class="comment">// Add to start position of dest buffer</span>
<a name="l17235"></a>17235       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l17236"></a>17236       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l17237"></a>17237 
<a name="l17238"></a>17238       <span class="comment">// Validations</span>
<a name="l17239"></a>17239       CHECKF( iTempX &gt;= 0 );
<a name="l17240"></a>17240       CHECKF( iTempY &gt;= 0 );
<a name="l17241"></a>17241 
<a name="l17242"></a>17242 
<a name="l17243"></a>17243       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l17244"></a>17244       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*iTempY) + (iTempX*2);
<a name="l17245"></a>17245       p16BPPPalette = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#930609ad8d5cdbb05449df70bd83cfcd">pShadeCurrent</a>;
<a name="l17246"></a>17246       LineSkip=(uiDestPitchBYTES-(usWidth*2));
<a name="l17247"></a>17247 
<a name="l17248"></a>17248       __asm {
<a name="l17249"></a>17249 
<a name="l17250"></a>17250             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l17251"></a>17251             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l17252"></a>17252             xor         eax, eax
<a name="l17253"></a>17253             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, usHeight
<a name="l17254"></a>17254             xor         ecx, ecx
<a name="l17255"></a>17255             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, OFFSET <a class="code" href="shading_8cpp.html#7eb13b22491f30a4399f492394327161">IntensityTable</a>
<a name="l17256"></a>17256 
<a name="l17257"></a>17257 BlitDispatch:
<a name="l17258"></a>17258 
<a name="l17259"></a>17259 
<a name="l17260"></a>17260             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l17261"></a>17261             inc         esi
<a name="l17262"></a>17262             or          cl, cl
<a name="l17263"></a>17263             js          BlitTransparent
<a name="l17264"></a>17264             jz          BlitDoneLine
<a name="l17265"></a>17265 
<a name="l17266"></a>17266 <span class="comment">//BlitNonTransLoop:</span>
<a name="l17267"></a>17267 
<a name="l17268"></a>17268             xor         eax, eax
<a name="l17269"></a>17269 
<a name="l17270"></a>17270             add         esi, ecx
<a name="l17271"></a>17271 
<a name="l17272"></a>17272             clc
<a name="l17273"></a>17273             rcr         cl, 1
<a name="l17274"></a>17274             jnc         BlitNTL2
<a name="l17275"></a>17275 
<a name="l17276"></a>17276             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [edi]
<a name="l17277"></a>17277             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, [edx+eax*2]
<a name="l17278"></a>17278             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [edi], ax
<a name="l17279"></a>17279 
<a name="l17280"></a>17280             add         edi, 2
<a name="l17281"></a>17281 
<a name="l17282"></a>17282 BlitNTL2:
<a name="l17283"></a>17283             clc
<a name="l17284"></a>17284             rcr         cl, 1
<a name="l17285"></a>17285             jnc         BlitNTL3
<a name="l17286"></a>17286 
<a name="l17287"></a>17287             mov         ax, [edi]
<a name="l17288"></a>17288             mov         ax, [edx+eax*2]
<a name="l17289"></a>17289             mov         [edi], ax
<a name="l17290"></a>17290 
<a name="l17291"></a>17291             mov         ax, [edi+2]
<a name="l17292"></a>17292             mov         ax, [edx+eax*2]
<a name="l17293"></a>17293             mov         [edi+2], ax
<a name="l17294"></a>17294 
<a name="l17295"></a>17295             add         edi, 4
<a name="l17296"></a>17296 
<a name="l17297"></a>17297 BlitNTL3:
<a name="l17298"></a>17298 
<a name="l17299"></a>17299             or          cl, cl
<a name="l17300"></a>17300             jz          BlitDispatch
<a name="l17301"></a>17301 
<a name="l17302"></a>17302 BlitNTL4:
<a name="l17303"></a>17303 
<a name="l17304"></a>17304             mov         ax, [edi]
<a name="l17305"></a>17305             mov         ax, [edx+eax*2]
<a name="l17306"></a>17306             mov         [edi], ax
<a name="l17307"></a>17307 
<a name="l17308"></a>17308             mov         ax, [edi+2]
<a name="l17309"></a>17309             mov         ax, [edx+eax*2]
<a name="l17310"></a>17310             mov         [edi+2], ax
<a name="l17311"></a>17311 
<a name="l17312"></a>17312             mov         ax, [edi+4]
<a name="l17313"></a>17313             mov         ax, [edx+eax*2]
<a name="l17314"></a>17314             mov         [edi+4], ax
<a name="l17315"></a>17315 
<a name="l17316"></a>17316             mov         ax, [edi+6]
<a name="l17317"></a>17317             mov         ax, [edx+eax*2]
<a name="l17318"></a>17318             mov         [edi+6], ax
<a name="l17319"></a>17319 
<a name="l17320"></a>17320             add         edi, 8
<a name="l17321"></a>17321             dec         cl
<a name="l17322"></a>17322             jnz         BlitNTL4
<a name="l17323"></a>17323 
<a name="l17324"></a>17324             jmp         BlitDispatch
<a name="l17325"></a>17325 
<a name="l17326"></a>17326 BlitTransparent:
<a name="l17327"></a>17327 
<a name="l17328"></a>17328             and         ecx, 07fH
<a name="l17329"></a>17329 <span class="comment">//          shl         ecx, 1</span>
<a name="l17330"></a>17330             add   ecx, ecx
<a name="l17331"></a>17331             add         edi, ecx
<a name="l17332"></a>17332             jmp         BlitDispatch
<a name="l17333"></a>17333 
<a name="l17334"></a>17334 
<a name="l17335"></a>17335 BlitDoneLine:
<a name="l17336"></a>17336 
<a name="l17337"></a>17337             dec         ebx
<a name="l17338"></a>17338             jz          BlitDone
<a name="l17339"></a>17339             add         edi, LineSkip
<a name="l17340"></a>17340             jmp         BlitDispatch
<a name="l17341"></a>17341 
<a name="l17342"></a>17342 
<a name="l17343"></a>17343 BlitDone:
<a name="l17344"></a>17344       }
<a name="l17345"></a>17345 
<a name="l17346"></a>17346       <span class="keywordflow">return</span>(TRUE);
<a name="l17347"></a>17347 
<a name="l17348"></a>17348 }
<a name="l17349"></a>17349 
<a name="l17350"></a>17350 
<a name="l17351"></a>17351 <span class="comment">/**********************************************************************************************</span>
<a name="l17352"></a>17352 <span class="comment"> Blt8BPPDataTo16BPPBufferTransZClipPixelateObscured</span>
<a name="l17353"></a>17353 <span class="comment"></span>
<a name="l17354"></a>17354 <span class="comment">      Blits an image into the destination buffer, using an ETRLE brush as a source, and a 16-bit</span>
<a name="l17355"></a>17355 <span class="comment">      buffer as a destination. As it is blitting, it checks the Z value of the ZBuffer, and if the</span>
<a name="l17356"></a>17356 <span class="comment">      pixel's Z level is below that of the current pixel, it is written on, and the Z value is</span>
<a name="l17357"></a>17357 <span class="comment">      NOT updated to the current value,   for any non-transparent pixels. The Z-buffer is 16 bit, and</span>
<a name="l17358"></a>17358 <span class="comment">      must be the same dimensions (including Pitch) as the destination.</span>
<a name="l17359"></a>17359 <span class="comment"></span>
<a name="l17360"></a>17360 <span class="comment">      Blits every second pixel ("pixelates").</span>
<a name="l17361"></a>17361 <span class="comment"></span>
<a name="l17362"></a>17362 <span class="comment">**********************************************************************************************/</span>
<a name="l17363"></a><a class="code" href="vobject__blitters_8h.html#a18be3ffb32e8e75c8f74d8d7cda599c">17363</a> <a class="code" href="Types_8h.html#112e3146cb38b6ee95e64d85842e380a">BOOLEAN</a> <a class="code" href="vobject__blitters_8cpp.html#a18be3ffb32e8e75c8f74d8d7cda599c">Blt8BPPDataTo16BPPBufferTransZClipPixelateObscured</a>( <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pBuffer, <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiDestPitchBYTES, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *pZBuffer, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usZValue, <a class="code" href="structTAG__HVOBJECT.html">HVOBJECT</a> hSrcVObject, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iX, <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a> iY, <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> usIndex, <a class="code" href="structSGPRect.html">SGPRect</a> *clipregion)
<a name="l17364"></a>17364 {
<a name="l17365"></a>17365 <a class="code" href="Types_8h.html#09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> *p16BPPPalette;
<a name="l17366"></a>17366 <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> uiOffset, uiLineFlag;
<a name="l17367"></a>17367 <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> usHeight, usWidth, Unblitted;
<a name="l17368"></a>17368 <a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a>  *SrcPtr, *DestPtr, *ZPtr;
<a name="l17369"></a>17369 <a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a> LineSkip;
<a name="l17370"></a>17370 <a class="code" href="structtagETRLEObject.html">ETRLEObject</a> *pTrav;
<a name="l17371"></a>17371 <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  iTempX, iTempY, LeftSkip, RightSkip, TopSkip, BottomSkip, BlitLength, BlitHeight, LSCount;
<a name="l17372"></a>17372 <a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>  ClipX1, ClipY1, ClipX2, ClipY2;
<a name="l17373"></a>17373 
<a name="l17374"></a>17374       <span class="comment">// Assertions</span>
<a name="l17375"></a>17375       Assert( hSrcVObject != NULL );
<a name="l17376"></a>17376       Assert( pBuffer != NULL );
<a name="l17377"></a>17377 
<a name="l17378"></a>17378       <span class="comment">// Get Offsets from Index into structure</span>
<a name="l17379"></a>17379       pTrav = &amp;(hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5af164bcbef17ed088d55268ea4d7ffd">pETRLEObject</a>[ usIndex ] );
<a name="l17380"></a>17380       usHeight                      = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#78bb78f025afb71c9bb5026f8823c2c5">usHeight</a>;
<a name="l17381"></a>17381       usWidth                             = (<a class="code" href="Types_8h.html#e1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)pTrav-&gt;<a class="code" href="structtagETRLEObject.html#77505acd5ca79cbc055f7c9e840d5996">usWidth</a>;
<a name="l17382"></a>17382       uiOffset                      = pTrav-&gt;<a class="code" href="structtagETRLEObject.html#bfabcb7da216b23b31f38f8594279e0d">uiDataOffset</a>;
<a name="l17383"></a>17383 
<a name="l17384"></a>17384       <span class="comment">// Add to start position of dest buffer</span>
<a name="l17385"></a>17385       iTempX = iX + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#3849d30f42f8102e789cce737ff2359f">sOffsetX</a>;
<a name="l17386"></a>17386       iTempY = iY + pTrav-&gt;<a class="code" href="structtagETRLEObject.html#5b58d99112f1498e1f03b42f6c66dd76">sOffsetY</a>;
<a name="l17387"></a>17387 
<a name="l17388"></a>17388       <span class="keywordflow">if</span>(clipregion==NULL)
<a name="l17389"></a>17389       {
<a name="l17390"></a>17390             ClipX1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l17391"></a>17391             ClipY1=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l17392"></a>17392             ClipX2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l17393"></a>17393             ClipY2=<a class="code" href="vobject__blitters_8cpp.html#880a4a0e053285be78f868d0e8b7a101">ClippingRect</a>.<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l17394"></a>17394       }
<a name="l17395"></a>17395       <span class="keywordflow">else</span>
<a name="l17396"></a>17396       {
<a name="l17397"></a>17397             ClipX1=clipregion-&gt;<a class="code" href="structSGPRect.html#ff8e2060cadeb6fe24800e83e9eb7041">iLeft</a>;
<a name="l17398"></a>17398             ClipY1=clipregion-&gt;<a class="code" href="structSGPRect.html#d4c794d3a2deda1031b2bd5fa500dea7">iTop</a>;
<a name="l17399"></a>17399             ClipX2=clipregion-&gt;<a class="code" href="structSGPRect.html#555fe85d97dec81ee8fe61c365bf741a">iRight</a>;
<a name="l17400"></a>17400             ClipY2=clipregion-&gt;<a class="code" href="structSGPRect.html#3da8351ad1e68d9f710a57d7a7d8cb21">iBottom</a>;
<a name="l17401"></a>17401       }
<a name="l17402"></a>17402 
<a name="l17403"></a>17403       <span class="comment">// Calculate rows hanging off each side of the screen</span>
<a name="l17404"></a>17404       LeftSkip=__min(ClipX1 - min(ClipX1, iTempX), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l17405"></a>17405       RightSkip=__min(max(ClipX2, (iTempX+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth)) - ClipX2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth);
<a name="l17406"></a>17406       TopSkip=__min(ClipY1 - __min(ClipY1, iTempY), (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l17407"></a>17407       BottomSkip=__min(__max(ClipY2, (iTempY+(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight)) - ClipY2, (<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight);
<a name="l17408"></a>17408 
<a name="l17409"></a>17409       <span class="comment">// calculate the remaining rows and columns to blit</span>
<a name="l17410"></a>17410       BlitLength=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth-LeftSkip-RightSkip);
<a name="l17411"></a>17411       BlitHeight=((<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight-TopSkip-BottomSkip);
<a name="l17412"></a>17412 
<a name="l17413"></a>17413       <span class="comment">// check if whole thing is clipped</span>
<a name="l17414"></a>17414       <span class="keywordflow">if</span>((LeftSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth) || (RightSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usWidth))
<a name="l17415"></a>17415             <span class="keywordflow">return</span>(TRUE);
<a name="l17416"></a>17416 
<a name="l17417"></a>17417       <span class="comment">// check if whole thing is clipped</span>
<a name="l17418"></a>17418       <span class="keywordflow">if</span>((TopSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight) || (BottomSkip &gt;=(<a class="code" href="Types_8h.html#1137216524060afd426c34677fed058b">INT32</a>)usHeight))
<a name="l17419"></a>17419             <span class="keywordflow">return</span>(TRUE);
<a name="l17420"></a>17420 
<a name="l17421"></a>17421       SrcPtr= (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#5aa456b99925e4ed06ee7f5bde64ec3e">pPixData</a> + uiOffset;
<a name="l17422"></a>17422       DestPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l17423"></a>17423       ZPtr = (<a class="code" href="Types_8h.html#b27e9918b538ce9d8ca692479b375b6a">UINT8</a> *)pZBuffer + (uiDestPitchBYTES*(iTempY+TopSkip)) + ((iTempX+LeftSkip)*2);
<a name="l17424"></a>17424       p16BPPPalette = hSrcVObject-&gt;<a class="code" href="structTAG__HVOBJECT.html#930609ad8d5cdbb05449df70bd83cfcd">pShadeCurrent</a>;
<a name="l17425"></a>17425       LineSkip=(uiDestPitchBYTES-(BlitLength*2));
<a name="l17426"></a>17426       uiLineFlag=(iTempY&amp;1);
<a name="l17427"></a>17427 
<a name="l17428"></a>17428       __asm {
<a name="l17429"></a>17429 
<a name="l17430"></a>17430             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         esi, SrcPtr
<a name="l17431"></a>17431             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, DestPtr
<a name="l17432"></a>17432             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         edx, p16BPPPalette
<a name="l17433"></a>17433             xor         eax, eax
<a name="l17434"></a>17434             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ebx, ZPtr
<a name="l17435"></a>17435             xor         ecx, ecx
<a name="l17436"></a>17436 
<a name="l17437"></a>17437             cmp         TopSkip, 0                                      <span class="comment">// check for nothing clipped on top</span>
<a name="l17438"></a>17438             je          LeftSkipSetup
<a name="l17439"></a>17439 
<a name="l17440"></a>17440 TopSkipLoop:                                                            <span class="comment">// Skips the number of lines clipped at the top</span>
<a name="l17441"></a>17441 
<a name="l17442"></a>17442             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l17443"></a>17443             inc         esi
<a name="l17444"></a>17444             or          cl, cl
<a name="l17445"></a>17445             js          TopSkipLoop
<a name="l17446"></a>17446             jz          TSEndLine
<a name="l17447"></a>17447 
<a name="l17448"></a>17448             add         esi, ecx
<a name="l17449"></a>17449             jmp         TopSkipLoop
<a name="l17450"></a>17450 
<a name="l17451"></a>17451 TSEndLine:
<a name="l17452"></a>17452             xor         uiLineFlag, 1
<a name="l17453"></a>17453             dec         TopSkip
<a name="l17454"></a>17454             jnz         TopSkipLoop
<a name="l17455"></a>17455 
<a name="l17456"></a>17456 LeftSkipSetup:
<a name="l17457"></a>17457 
<a name="l17458"></a>17458             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l17459"></a>17459             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, LeftSkip
<a name="l17460"></a>17460             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l17461"></a>17461             or          eax, eax
<a name="l17462"></a>17462             jz          BlitLineSetup
<a name="l17463"></a>17463 
<a name="l17464"></a>17464 LeftSkipLoop:
<a name="l17465"></a>17465 
<a name="l17466"></a>17466             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l17467"></a>17467             inc         esi
<a name="l17468"></a>17468 
<a name="l17469"></a>17469             or          cl, cl
<a name="l17470"></a>17470             js          LSTrans
<a name="l17471"></a>17471 
<a name="l17472"></a>17472             cmp         ecx, LSCount
<a name="l17473"></a>17473             je          LSSkip2                                               <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l17474"></a>17474             jb          LSSkip1                                               <span class="comment">// if less, skip whole thing</span>
<a name="l17475"></a>17475 
<a name="l17476"></a>17476             add         esi, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l17477"></a>17477             sub         ecx, LSCount
<a name="l17478"></a>17478             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l17479"></a>17479             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l17480"></a>17480             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l17481"></a>17481             jmp         BlitNonTransLoop
<a name="l17482"></a>17482 
<a name="l17483"></a>17483 LSSkip2:
<a name="l17484"></a>17484             add         esi, ecx                                        <span class="comment">// skip whole run, and start blit with new run</span>
<a name="l17485"></a>17485             jmp         BlitLineSetup
<a name="l17486"></a>17486 
<a name="l17487"></a>17487 
<a name="l17488"></a>17488 LSSkip1:
<a name="l17489"></a>17489             add         esi, ecx                                        <span class="comment">// skip whole run, continue skipping</span>
<a name="l17490"></a>17490             sub         LSCount, ecx
<a name="l17491"></a>17491             jmp         LeftSkipLoop
<a name="l17492"></a>17492 
<a name="l17493"></a>17493 
<a name="l17494"></a>17494 LSTrans:
<a name="l17495"></a>17495             and         ecx, 07fH
<a name="l17496"></a>17496             cmp         ecx, LSCount
<a name="l17497"></a>17497             je          BlitLineSetup                             <span class="comment">// if equal, skip whole, and start blit with new run</span>
<a name="l17498"></a>17498             jb          LSTrans1                                        <span class="comment">// if less, skip whole thing</span>
<a name="l17499"></a>17499 
<a name="l17500"></a>17500             sub         ecx, LSCount                                          <span class="comment">// skip partial run, jump into normal loop for rest</span>
<a name="l17501"></a>17501             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l17502"></a>17502             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l17503"></a>17503             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l17504"></a>17504             jmp         BlitTransparent
<a name="l17505"></a>17505 
<a name="l17506"></a>17506 
<a name="l17507"></a>17507 LSTrans1:
<a name="l17508"></a>17508             sub         LSCount, ecx                                          <span class="comment">// skip whole run, continue skipping</span>
<a name="l17509"></a>17509             jmp         LeftSkipLoop
<a name="l17510"></a>17510 
<a name="l17511"></a>17511 
<a name="l17512"></a>17512 BlitLineSetup:                                                    <span class="comment">// Does any actual blitting (trans/non) for the line</span>
<a name="l17513"></a>17513             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         eax, BlitLength
<a name="l17514"></a>17514             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         LSCount, eax
<a name="l17515"></a>17515             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, 0
<a name="l17516"></a>17516 
<a name="l17517"></a>17517 BlitDispatch:
<a name="l17518"></a>17518 
<a name="l17519"></a>17519             cmp         LSCount, 0                                      <span class="comment">// Check to see if we're done blitting</span>
<a name="l17520"></a>17520             je          RightSkipLoop
<a name="l17521"></a>17521 
<a name="l17522"></a>17522             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         cl, [esi]
<a name="l17523"></a>17523             inc         esi
<a name="l17524"></a>17524             or          cl, cl
<a name="l17525"></a>17525             js          BlitTransparent
<a name="l17526"></a>17526 
<a name="l17527"></a>17527 BlitNonTransLoop:                                           <span class="comment">// blit non-transparent pixels</span>
<a name="l17528"></a>17528 
<a name="l17529"></a>17529             cmp         ecx, LSCount
<a name="l17530"></a>17530             jbe         BNTrans1
<a name="l17531"></a>17531 
<a name="l17532"></a>17532             sub         ecx, LSCount
<a name="l17533"></a>17533             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         Unblitted, ecx
<a name="l17534"></a>17534             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ecx, LSCount
<a name="l17535"></a>17535 
<a name="l17536"></a>17536 BNTrans1:
<a name="l17537"></a>17537             sub         LSCount, ecx
<a name="l17538"></a>17538 
<a name="l17539"></a>17539 BlitNTL1:
<a name="l17540"></a>17540 
<a name="l17541"></a>17541             <span class="comment">// OK, DO CHECK FOR Z FIRST!</span>
<a name="l17542"></a>17542             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         <a class="code" href="vobject__blitters_8cpp.html#8107fd28354a954e2572fdc25103ac45">ax</a>, [ebx]
<a name="l17543"></a>17543             cmp         ax, usZValue
<a name="l17544"></a>17544             jae         <a class="code" href="vobject__blitters_8cpp.html#abf905a085ab39598c9c71ca8e8a0a0e">BlitNTL8</a>
<a name="l17545"></a>17545 
<a name="l17546"></a>17546             <span class="comment">// ONLY WRITE DATA IF WE REALLY SHOULD</span>
<a name="l17547"></a>17547             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         ax, usZValue
<a name="l17548"></a>17548             <a class="code" href="vobject__blitters_8cpp.html#169a6ae8d80d1f41a6b41a7658cedac2">mov</a>         [ebx], ax
<a name="l17549"></a>17549             jmp   <a class="code" href="vobject__blitters_8cpp.html#d660d2ba340c8ef5d2d80c6365ad838f">BlitNTL7</a>
<a name="l17550"></a>17550 
<a name="l17551"></a>17551 <a class="code" href="vobject__blitters_8cpp.html#abf905a085ab39598c9c71ca8e8a0a0e">BlitNTL8</a>:
<a name="l17552"></a>17552 
<a name="l17553"></a>17553             <a class="code" href="structtest.html">test</a>  uiLineFlag, 1
<a name="l17554"></a>17554             jz          <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>
<a name="l17555"></a>17555 
<a name="l17556"></a>17556             <a class="code" href="structtest.html">test</a>  edi, 2
<a name="l17557"></a>17557             jz          BlitNTL2
<a name="l17558"></a>17558             jmp         <a class="code" href="vobject__blitters_8cpp.html#d660d2ba340c8ef5d2d80c6365ad838f">BlitNTL7</a>
<a name="l17559"></a>17559 
<a name="l17560"></a>17560 <a class="code" href="vobject__blitters_8cpp.html#568160eaea07539cbb8ad64e93fa1791">BlitNTL6</a>:
<a name="l17561"></a>17561             <a class="code" href="structtest.html">test</a>  edi, 2
<a name="l17562"></a>17562             jnz         BlitNTL2
<a name="l17563"></a>17563 
<a name="l17564"></a>17564 <a class="code" href="vobject__blitters_8cpp.html#d660d2ba340c8ef5d2d80c6365ad838f">BlitNTL7</a>:
<a name="l17565"></a>17565 
<a name="l17566"></a>17566             xor         eax, eax
<a name="l17567"></a>17567             mov         <a class="code" href="vobject__blitters_8cpp.html#747c4971268463ee2b55a13b4e407afa">al</a>, [esi]
<a name="l17568"></a>17568             mov         ax, [edx+eax*2]
<a name="l17569"></a>17569             mov         [<a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>], ax
<a name="l17570"></a>17570 
<a name="l17571"></a>17571 BlitNTL2:
<a name="l17572"></a>17572             inc         esi
<a name="l17573"></a>17573             add         <a class="code" href="vobject__blitters_8cpp.html#6ce9d9d5ef078ea60aab895540329f00">edi</a>, 2
<a name="l17574"></a>17574             add         ebx, 2
<a name="l17575"></a>17575             dec         cl
<a name="l17576"></a>17576             jnz         BlitNTL1
<a name="l17577"></a>17577 
<a name="l17578"></a>17578 <span class="comment">//BlitLineEnd:</span>
<a name="l17579"></a>17579             add         esi, Unblitted
<a name="l17580"></a>17580             jmp         BlitDispatch
<a name="l17581"></a>17581 
<a name="l17582"></a>17582 BlitTransparent:                                                              <span class="comment">// skip transparent pixels</span>
<a name="l17583"></a>17583 
<a name="l17584"></a>17584             and         ecx, 07fH
<a name="l17585"></a>17585             cmp         ecx, LSCount
<a name="l17586"></a>17586             jbe         BTrans1
<a name="l17587"></a>17587 
<a name="l17588"></a>17588             mov         ecx, LSCount
<a name="l17589"></a>17589 
<a name="l17590"></a>17590 BTrans1:
<a name="l17591"></a>17591 
<a name="l17592"></a>17592             sub         LSCount, ecx
<a name="l17593"></a>17593 <span class="comment">//          shl         ecx, 1</span>
<a name="l17594"></a>17594             add   ecx, ecx
<a name="l17595"></a>17595             add         edi, ecx
<a name="l17596"></a>17596             add         ebx, ecx
<a name="l17597"></a>17597             jmp         BlitDispatch
<a name="l17598"></a>17598 
<a name="l17599"></a>17599 
<a name="l17600"></a>17600 RightSkipLoop:                                                                      <span class="comment">// skip along until we hit and end-of-line marker</span>
<a name="l17601"></a>17601 
<a name="l17602"></a>17602 
<a name="l17603"></a>17603 RSLoop1:
<a name="l17604"></a>17604             mov         al, [esi]
<a name="l17605"></a>17605             inc         esi
<a name="l17606"></a>17606             or          al, al
<a name="l17607"></a>17607             jnz         RSLoop1
<a name="l17608"></a>17608 
<a name="l17609"></a>17609             xor         uiLineFlag, 1
<a name="l17610"></a>17610             dec         BlitHeight
<a name="l17611"></a>17611             jz          BlitDone
<a name="l17612"></a>17612             add         edi, LineSkip
<a name="l17613"></a>17613             add         ebx, LineSkip
<a name="l17614"></a>17614 
<a name="l17615"></a>17615             jmp         LeftSkipSetup
<a name="l17616"></a>17616 
<a name="l17617"></a>17617 
<a name="l17618"></a>17618 BlitDone:
<a name="l17619"></a>17619       }
<a name="l17620"></a>17620 
<a name="l17621"></a>17621       <span class="keywordflow">return</span>(TRUE);
<a name="l17622"></a>17622 
<a name="l17623"></a>17623 }     
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sat Sep 9 13:49:17 2006 for Build by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
